"use strict";
var alphaTab = (() => {
  var gp = Object.defineProperty;
  var Yh = Object.getOwnPropertyDescriptor;
  var Jh = Object.getOwnPropertyNames;
  var qh = Object.prototype.hasOwnProperty;
  var Oh = (p, t) => ((t = Symbol[p]) ? t : Symbol.for("Symbol." + p)),
    Gh = (p) => {
      throw TypeError(p);
    };
  var Bi = (p, t) => {
      for (var e in t) gp(p, e, { get: t[e], enumerable: !0 });
    },
    $h = (p, t, e, r) => {
      if ((t && typeof t == "object") || typeof t == "function")
        for (let i of Jh(t))
          !qh.call(p, i) &&
            i !== e &&
            gp(p, i, {
              get: () => t[i],
              enumerable: !(r = Yh(t, i)) || r.enumerable,
            });
      return p;
    };
  var Kh = (p) => $h(gp({}, "__esModule", { value: !0 }), p);
  var j = (p, t, e) => {
      if (t != null) {
        typeof t != "object" && typeof t != "function" && Gh("Object expected");
        var r, i;
        e && (r = t[Oh("asyncDispose")]),
          r === void 0 && ((r = t[Oh("dispose")]), e && (i = r)),
          typeof r != "function" && Gh("Object not disposable"),
          i &&
            (r = function () {
              try {
                i.call(this);
              } catch (n) {
                return Promise.reject(n);
              }
            }),
          p.push([e, r, t]);
      } else e && p.push([e]);
      return t;
    },
    ee = (p, t, e) => {
      var r =
          typeof SuppressedError == "function"
            ? SuppressedError
            : function (s, a, o, l) {
                return (
                  (l = Error(o)),
                  (l.name = "SuppressedError"),
                  (l.error = s),
                  (l.suppressed = a),
                  l
                );
              },
        i = (s) =>
          (t = e
            ? new r(s, t, "An error was suppressed during disposal")
            : ((e = !0), s)),
        n = (s) => {
          for (; (s = p.pop()); )
            try {
              var a = s[1] && s[1].call(s[2]);
              if (s[0]) return Promise.resolve(a).then(n, (o) => (i(o), n()));
            } catch (o) {
              i(o);
            }
          if (e) throw t;
        };
      return n();
    };
  var im = {};
  Bi(im, {
    AlphaTabApi: () => Oa,
    AlphaTabApiBase: () => Ia,
    AlphaTabError: () => te,
    AlphaTabErrorType: () => Qe,
    ConsoleLogger: () => po,
    CoreSettings: () => zn,
    DisplaySettings: () => da,
    EngravingSettings: () => Hn,
    EngravingStemInfo: () => Ki,
    Environment: () => J,
    ExporterSettings: () => wa,
    FileLoadError: () => Wr,
    FingeringMode: () => on,
    FontFileFormat: () => ga,
    FormatError: () => Oe,
    ImporterSettings: () => pa,
    LayoutMode: () => Ui,
    LogLevel: () => ns,
    Logger: () => w,
    NotationElement: () => me,
    NotationMode: () => gr,
    NotationSettings: () => Vs,
    PlayerMode: () => Un,
    PlayerOutputMode: () => fa,
    PlayerSettings: () => ha,
    ProgressEventArgs: () => Ra,
    RenderEngineFactory: () => Os,
    RenderingResources: () => ca,
    ResizeEventArgs: () => vs,
    ScrollMode: () => ma,
    Settings: () => kt,
    SlidePlaybackSettings: () => zo,
    StaveProfile: () => Bs,
    SystemsLayoutMode: () => Ts,
    TabRhythmMode: () => is,
    VibratoPlaybackSettings: () => Uo,
    WebPlatform: () => Yn,
    exporter: () => wh,
    importer: () => Th,
    io: () => kh,
    json: () => Hh,
    meta: () => Gi,
    midi: () => Ah,
    model: () => Ch,
    platform: () => Mh,
    rendering: () => Sp,
    synth: () => Ih,
  });
  var Yl = class {
    constructor(t) {
      this._targets = new Set();
      (this._callback = t),
        window.addEventListener("resize", this._onWindowResize.bind(this), !1);
    }
    observe(t) {
      this._targets.add(t);
    }
    unobserve(t) {
      this._targets.delete(t);
    }
    disconnect() {
      this._targets.clear();
    }
    _onWindowResize() {
      let t = [];
      for (let e of this._targets)
        t.push({
          target: e,
          contentRect: void 0,
          borderBoxSize: void 0,
          contentBoxSize: [],
          devicePixelContentBoxSize: [],
        });
      this._callback(t, this);
    }
  };
  var Jl = class {
    constructor(t) {
      this._elements = [];
      this._timer = null;
      (this._callback = t),
        window.addEventListener("resize", () => this._check, !0),
        document.addEventListener("scroll", () => this._check, !0);
    }
    _check() {
      this._timer ||
        (this._timer = setTimeout(() => {
          this._doCheck(), (this._timer = null);
        }, 100));
    }
    observe(t) {
      this._elements.indexOf(t) >= 0 || (this._elements.push(t), this._check());
    }
    unobserve(t) {
      this._elements = this._elements.filter((e) => e !== t);
    }
    _doCheck() {
      let t = [];
      for (let e of this._elements) {
        let r = e.getBoundingClientRect();
        r.top + r.height >= 0 &&
          r.top <= window.innerHeight &&
          r.left + r.width >= 0 &&
          r.left <= window.innerWidth &&
          t.push({ target: e, isIntersecting: !0 });
      }
      t.length && this._callback(t, this);
    }
  };
  typeof Symbol.dispose > "u" && (Symbol.dispose = Symbol("Symbol.dispose")),
    typeof window < "u" &&
      ("ResizeObserver" in globalThis || (globalThis.ResizeObserver = Yl),
      "IntersectionObserver" in globalThis ||
        (globalThis.IntersectionObserver = Jl),
      "replaceChildren" in Element.prototype ||
        ((Element.prototype.replaceChildren = function (...p) {
          (this.innerHTML = ""), this.append(...p);
        }),
        (Document.prototype.replaceChildren =
          Element.prototype.replaceChildren),
        (DocumentFragment.prototype.replaceChildren =
          Element.prototype.replaceChildren))),
    "replaceAll" in String.prototype ||
      (String.prototype.replaceAll = function (p, t) {
        return this.replace(new RegExp(p, "g"), t);
      });
  var Qe = ((r) => (
      (r[(r.General = 0)] = "General"),
      (r[(r.Format = 1)] = "Format"),
      (r[(r.AlphaTex = 2)] = "AlphaTex"),
      r
    ))(Qe || {}),
    te = class extends Error {
      constructor(t, e = "", r) {
        super(e ?? "", { cause: r }), (this.type = t);
      }
    };
  var an = class an {
    static print(t) {
      t("alphaTab " + an.version),
        t("commit: " + an.commit),
        t("build date: " + an.date);
    }
  };
  (an.version = "1.7.0"),
    (an.date = "2025-11-24T00:38:00.000Z"),
    (an.commit = "dev");
  var Gi = an;
  var st = ((P) => (
    (P[(P.PPP = 0)] = "PPP"),
    (P[(P.PP = 1)] = "PP"),
    (P[(P.P = 2)] = "P"),
    (P[(P.MP = 3)] = "MP"),
    (P[(P.MF = 4)] = "MF"),
    (P[(P.F = 5)] = "F"),
    (P[(P.FF = 6)] = "FF"),
    (P[(P.FFF = 7)] = "FFF"),
    (P[(P.PPPP = 8)] = "PPPP"),
    (P[(P.PPPPP = 9)] = "PPPPP"),
    (P[(P.PPPPPP = 10)] = "PPPPPP"),
    (P[(P.FFFF = 11)] = "FFFF"),
    (P[(P.FFFFF = 12)] = "FFFFF"),
    (P[(P.FFFFFF = 13)] = "FFFFFF"),
    (P[(P.SF = 14)] = "SF"),
    (P[(P.SFP = 15)] = "SFP"),
    (P[(P.SFPP = 16)] = "SFPP"),
    (P[(P.FP = 17)] = "FP"),
    (P[(P.RF = 18)] = "RF"),
    (P[(P.RFZ = 19)] = "RFZ"),
    (P[(P.SFZ = 20)] = "SFZ"),
    (P[(P.SFFZ = 21)] = "SFFZ"),
    (P[(P.FZ = 22)] = "FZ"),
    (P[(P.N = 23)] = "N"),
    (P[(P.PF = 24)] = "PF"),
    (P[(P.SFZP = 25)] = "SFZP"),
    P
  ))(st || {});
  var ve = class ve {
    static ticksToMillis(t, e) {
      return (t * (6e4 / (e * ve.QuarterTime))) | 0;
    }
    static millisToTicks(t, e) {
      return (t / (6e4 / (e * ve.QuarterTime))) | 0;
    }
    static toTicks(t) {
      return ve.valueToTicks(t);
    }
    static valueToTicks(t) {
      let e = t;
      return e < 0 && (e = 1 / -e), (ve.QuarterTime * (4 / e)) | 0;
    }
    static applyDot(t, e) {
      return e ? t + ((t / 4) | 0) * 3 : t + ((t / 2) | 0);
    }
    static applyTuplet(t, e, r) {
      return ((t * r) / e) | 0;
    }
    static removeTuplet(t, e, r) {
      return ((t * e) / r) | 0;
    }
    static dynamicToVelocity(t, e = 0) {
      let r = 1;
      switch (t) {
        case 0:
          r = ve._minVelocity + 0 * ve.VelocityIncrement;
          break;
        case 1:
          r = ve._minVelocity + 1 * ve.VelocityIncrement;
          break;
        case 2:
          r = ve._minVelocity + 2 * ve.VelocityIncrement;
          break;
        case 3:
          r = ve._minVelocity + 3 * ve.VelocityIncrement;
          break;
        case 4:
          r = ve._minVelocity + 4 * ve.VelocityIncrement;
          break;
        case 5:
          r = ve._minVelocity + 5 * ve.VelocityIncrement;
          break;
        case 6:
          r = ve._minVelocity + 6 * ve.VelocityIncrement;
          break;
        case 7:
          r = ve._minVelocity + 7 * ve.VelocityIncrement;
          break;
        case 8:
          r = 10;
          break;
        case 9:
          r = 5;
          break;
        case 10:
          r = 3;
          break;
        case 11:
          r = ve._minVelocity + 8 * ve.VelocityIncrement;
          break;
        case 12:
          r = ve._minVelocity + 9 * ve.VelocityIncrement;
          break;
        case 13:
          r = ve._minVelocity + 10 * ve.VelocityIncrement;
          break;
        case 14:
        case 15:
        case 25:
        case 16:
        case 20:
        case 22:
          r = ve._minVelocity + 6 * ve.VelocityIncrement;
          break;
        case 17:
          r = ve._minVelocity + 5 * ve.VelocityIncrement;
          break;
        case 18:
        case 19:
        case 21:
          r = ve._minVelocity + 5 * ve.VelocityIncrement;
          break;
        case 23:
          r = 1;
          break;
        case 24:
          r = ve._minVelocity + ((4.5 * ve.VelocityIncrement) | 0);
          break;
      }
      return (r += e * ve.VelocityIncrement), Math.min(Math.max(r, 1), 127);
    }
  };
  (ve.QuarterTime = 960), (ve._minVelocity = 15), (ve.VelocityIncrement = 16);
  var E = ve;
  var ar = ((s) => (
      (s[(s.Tempo = 0)] = "Tempo"),
      (s[(s.Volume = 1)] = "Volume"),
      (s[(s.Instrument = 2)] = "Instrument"),
      (s[(s.Balance = 3)] = "Balance"),
      (s[(s.SyncPoint = 4)] = "SyncPoint"),
      (s[(s.Bank = 4)] = "Bank"),
      s
    ))(ar || {}),
    Ur = class {
      constructor() {
        this.barOccurence = 0;
        this.millisecondOffset = 0;
      }
    },
    he = class p {
      constructor() {
        this.isLinear = !1;
        this.type = 0;
        this.value = 0;
        this.ratioPosition = 0;
        this.text = "";
        this.isVisible = !0;
      }
      static buildTempoAutomation(t, e, r, i, n = !0) {
        (i < 1 || i > 5) && (i = 2);
        let s = new Float32Array([1, 0.5, 1, 1.5, 2, 3]),
          a = new p();
        return (
          (a.type = 0),
          (a.isLinear = t),
          (a.ratioPosition = e),
          (a.value = r * s[i]),
          (a.isVisible = n),
          a
        );
      }
      static buildInstrumentAutomation(t, e, r) {
        let i = new p();
        return (
          (i.type = 2),
          (i.isLinear = t),
          (i.ratioPosition = e),
          (i.value = r),
          i
        );
      }
    };
  var I = class {
    constructor(t = 0, e = 0) {
      (this.offset = t), (this.value = e);
    }
  };
  (I.MaxPosition = 60), (I.MaxValue = 12);
  var Pt = ((r) => (
    (r[(r.Default = 0)] = "Default"),
    (r[(r.Gradual = 1)] = "Gradual"),
    (r[(r.Fast = 2)] = "Fast"),
    r
  ))(Pt || {});
  var fr = ((l) => (
    (l[(l.None = 0)] = "None"),
    (l[(l.Custom = 1)] = "Custom"),
    (l[(l.Bend = 2)] = "Bend"),
    (l[(l.Release = 3)] = "Release"),
    (l[(l.BendRelease = 4)] = "BendRelease"),
    (l[(l.Hold = 5)] = "Hold"),
    (l[(l.Prebend = 6)] = "Prebend"),
    (l[(l.PrebendBend = 7)] = "PrebendBend"),
    (l[(l.PrebendRelease = 8)] = "PrebendRelease"),
    l
  ))(fr || {});
  var Wt = ((n) => (
    (n[(n.None = 0)] = "None"),
    (n[(n.BrushUp = 1)] = "BrushUp"),
    (n[(n.BrushDown = 2)] = "BrushDown"),
    (n[(n.ArpeggioUp = 3)] = "ArpeggioUp"),
    (n[(n.ArpeggioDown = 4)] = "ArpeggioDown"),
    n
  ))(Wt || {});
  var br = ((r) => (
    (r[(r.None = 0)] = "None"),
    (r[(r.Crescendo = 1)] = "Crescendo"),
    (r[(r.Decrescendo = 2)] = "Decrescendo"),
    r
  ))(br || {});
  var _e = ((c) => (
    (c[(c.QuadrupleWhole = -4)] = "QuadrupleWhole"),
    (c[(c.DoubleWhole = -2)] = "DoubleWhole"),
    (c[(c.Whole = 1)] = "Whole"),
    (c[(c.Half = 2)] = "Half"),
    (c[(c.Quarter = 4)] = "Quarter"),
    (c[(c.Eighth = 8)] = "Eighth"),
    (c[(c.Sixteenth = 16)] = "Sixteenth"),
    (c[(c.ThirtySecond = 32)] = "ThirtySecond"),
    (c[(c.SixtyFourth = 64)] = "SixtyFourth"),
    (c[(c.OneHundredTwentyEighth = 128)] = "OneHundredTwentyEighth"),
    (c[(c.TwoHundredFiftySixth = 256)] = "TwoHundredFiftySixth"),
    c
  ))(_e || {});
  var Ce = ((i) => (
    (i[(i.None = 0)] = "None"),
    (i[(i.OnBeat = 1)] = "OnBeat"),
    (i[(i.BeforeBeat = 2)] = "BeforeBeat"),
    (i[(i.BendGrace = 3)] = "BendGrace"),
    i
  ))(Ce || {});
  var or = ((i) => (
    (i[(i.None = 0)] = "None"),
    (i[(i.Normal = 1)] = "Normal"),
    (i[(i.Heavy = 2)] = "Heavy"),
    (i[(i.Tenuto = 3)] = "Tenuto"),
    i
  ))(or || {});
  var Ar = ((a) => (
    (a[(a.Unknown = -2)] = "Unknown"),
    (a[(a.NoOrDead = -1)] = "NoOrDead"),
    (a[(a.Thumb = 0)] = "Thumb"),
    (a[(a.IndexFinger = 1)] = "IndexFinger"),
    (a[(a.MiddleFinger = 2)] = "MiddleFinger"),
    (a[(a.AnnularFinger = 3)] = "AnnularFinger"),
    (a[(a.LittleFinger = 4)] = "LittleFinger"),
    a
  ))(Ar || {});
  var Ht = ((a) => (
    (a[(a.None = 0)] = "None"),
    (a[(a.Natural = 1)] = "Natural"),
    (a[(a.Artificial = 2)] = "Artificial"),
    (a[(a.Pinch = 3)] = "Pinch"),
    (a[(a.Tap = 4)] = "Tap"),
    (a[(a.Semi = 5)] = "Semi"),
    (a[(a.Feedback = 6)] = "Feedback"),
    a
  ))(Ht || {});
  var lr = ((a) => (
    (a[(a.Default = 0)] = "Default"),
    (a[(a.ForceNone = 1)] = "ForceNone"),
    (a[(a.ForceNatural = 2)] = "ForceNatural"),
    (a[(a.ForceSharp = 3)] = "ForceSharp"),
    (a[(a.ForceDoubleSharp = 4)] = "ForceDoubleSharp"),
    (a[(a.ForceFlat = 5)] = "ForceFlat"),
    (a[(a.ForceDoubleFlat = 6)] = "ForceDoubleFlat"),
    a
  ))(lr || {});
  var Ze = ((n) => (
    (n[(n._15ma = 0)] = "_15ma"),
    (n[(n._8va = 1)] = "_8va"),
    (n[(n.Regular = 2)] = "Regular"),
    (n[(n._8vb = 3)] = "_8vb"),
    (n[(n._15mb = 4)] = "_15mb"),
    n
  ))(Ze || {});
  var Ut = ((r) => (
    (r[(r.None = 0)] = "None"),
    (r[(r.IntoFromBelow = 1)] = "IntoFromBelow"),
    (r[(r.IntoFromAbove = 2)] = "IntoFromAbove"),
    r
  ))(Ut || {});
  var At = ((a) => (
    (a[(a.None = 0)] = "None"),
    (a[(a.Shift = 1)] = "Shift"),
    (a[(a.Legato = 2)] = "Legato"),
    (a[(a.OutUp = 3)] = "OutUp"),
    (a[(a.OutDown = 4)] = "OutDown"),
    (a[(a.PickSlideDown = 5)] = "PickSlideDown"),
    (a[(a.PickSlideUp = 6)] = "PickSlideUp"),
    a
  ))(At || {});
  var Ue = ((r) => (
    (r[(r.None = 0)] = "None"),
    (r[(r.Slight = 1)] = "Slight"),
    (r[(r.Wide = 2)] = "Wide"),
    r
  ))(Ue || {});
  var is = ((i) => (
      (i[(i.Hidden = 0)] = "Hidden"),
      (i[(i.ShowWithBeams = 1)] = "ShowWithBeams"),
      (i[(i.ShowWithBars = 2)] = "ShowWithBars"),
      (i[(i.Automatic = 3)] = "Automatic"),
      i
    ))(is || {}),
    on = ((i) => (
      (i[(i.ScoreDefault = 0)] = "ScoreDefault"),
      (i[(i.ScoreForcePiano = 1)] = "ScoreForcePiano"),
      (i[(i.SingleNoteEffectBand = 2)] = "SingleNoteEffectBand"),
      (i[(i.SingleNoteEffectBandForcePiano = 3)] =
        "SingleNoteEffectBandForcePiano"),
      i
    ))(on || {}),
    gr = ((e) => (
      (e[(e.GuitarPro = 0)] = "GuitarPro"),
      (e[(e.SongBook = 1)] = "SongBook"),
      e
    ))(gr || {}),
    me = ((z) => (
      (z[(z.ScoreTitle = 0)] = "ScoreTitle"),
      (z[(z.ScoreSubTitle = 1)] = "ScoreSubTitle"),
      (z[(z.ScoreArtist = 2)] = "ScoreArtist"),
      (z[(z.ScoreAlbum = 3)] = "ScoreAlbum"),
      (z[(z.ScoreWords = 4)] = "ScoreWords"),
      (z[(z.ScoreMusic = 5)] = "ScoreMusic"),
      (z[(z.ScoreWordsAndMusic = 6)] = "ScoreWordsAndMusic"),
      (z[(z.ScoreCopyright = 7)] = "ScoreCopyright"),
      (z[(z.GuitarTuning = 8)] = "GuitarTuning"),
      (z[(z.TrackNames = 9)] = "TrackNames"),
      (z[(z.ChordDiagrams = 10)] = "ChordDiagrams"),
      (z[(z.ParenthesisOnTiedBends = 11)] = "ParenthesisOnTiedBends"),
      (z[(z.TabNotesOnTiedBends = 12)] = "TabNotesOnTiedBends"),
      (z[(z.ZerosOnDiveWhammys = 13)] = "ZerosOnDiveWhammys"),
      (z[(z.EffectAlternateEndings = 14)] = "EffectAlternateEndings"),
      (z[(z.EffectCapo = 15)] = "EffectCapo"),
      (z[(z.EffectChordNames = 16)] = "EffectChordNames"),
      (z[(z.EffectCrescendo = 17)] = "EffectCrescendo"),
      (z[(z.EffectDynamics = 18)] = "EffectDynamics"),
      (z[(z.EffectFadeIn = 19)] = "EffectFadeIn"),
      (z[(z.EffectFermata = 20)] = "EffectFermata"),
      (z[(z.EffectFingering = 21)] = "EffectFingering"),
      (z[(z.EffectHarmonics = 22)] = "EffectHarmonics"),
      (z[(z.EffectLetRing = 23)] = "EffectLetRing"),
      (z[(z.EffectLyrics = 24)] = "EffectLyrics"),
      (z[(z.EffectMarker = 25)] = "EffectMarker"),
      (z[(z.EffectOttavia = 26)] = "EffectOttavia"),
      (z[(z.EffectPalmMute = 27)] = "EffectPalmMute"),
      (z[(z.EffectPickSlide = 28)] = "EffectPickSlide"),
      (z[(z.EffectPickStroke = 29)] = "EffectPickStroke"),
      (z[(z.EffectSlightBeatVibrato = 30)] = "EffectSlightBeatVibrato"),
      (z[(z.EffectSlightNoteVibrato = 31)] = "EffectSlightNoteVibrato"),
      (z[(z.EffectTap = 32)] = "EffectTap"),
      (z[(z.EffectTempo = 33)] = "EffectTempo"),
      (z[(z.EffectText = 34)] = "EffectText"),
      (z[(z.EffectTrill = 35)] = "EffectTrill"),
      (z[(z.EffectTripletFeel = 36)] = "EffectTripletFeel"),
      (z[(z.EffectWhammyBar = 37)] = "EffectWhammyBar"),
      (z[(z.EffectWideBeatVibrato = 38)] = "EffectWideBeatVibrato"),
      (z[(z.EffectWideNoteVibrato = 39)] = "EffectWideNoteVibrato"),
      (z[(z.EffectLeftHandTap = 40)] = "EffectLeftHandTap"),
      (z[(z.EffectFreeTime = 41)] = "EffectFreeTime"),
      (z[(z.EffectSustainPedal = 42)] = "EffectSustainPedal"),
      (z[(z.EffectGolpe = 43)] = "EffectGolpe"),
      (z[(z.EffectWahPedal = 44)] = "EffectWahPedal"),
      (z[(z.EffectBeatBarre = 45)] = "EffectBeatBarre"),
      (z[(z.EffectNoteOrnament = 46)] = "EffectNoteOrnament"),
      (z[(z.EffectRasgueado = 47)] = "EffectRasgueado"),
      (z[(z.EffectDirections = 48)] = "EffectDirections"),
      (z[(z.EffectBeatTimer = 49)] = "EffectBeatTimer"),
      z
    ))(me || {}),
    co = class co {
      constructor() {
        this.notationMode = 0;
        this.fingeringMode = 0;
        this.showChordDiagramsOnBeats = !0;
        this.elements = new Map();
        this.rhythmMode = 3;
        this.rhythmHeight = 15;
        this.transpositionPitches = [];
        this.displayTranspositionPitches = [];
        this.smallGraceTabNotes = !0;
        this.extendBendArrowsOnTiedNotes = !0;
        this.extendLineEffectsToBeatEnd = !1;
        this.slurHeight = 5;
      }
      isNotationElementVisible(t) {
        return this.elements.has(t)
          ? this.elements.get(t)
          : co.defaultElements.has(t)
          ? co.defaultElements.get(t)
          : !0;
      }
    };
  co.defaultElements = new Map([[13, !1]]);
  var Vs = co;
  var Cr = class {
    constructor(t) {
      this._value = void 0;
      this._factory = t;
    }
    get hasValue() {
      return this._value !== void 0;
    }
    get value() {
      return (
        this._value === void 0 && (this._value = this._factory()), this._value
      );
    }
    reset() {
      this._value = void 0;
    }
  };
  var ns = ((n) => (
    (n[(n.None = 0)] = "None"),
    (n[(n.Debug = 1)] = "Debug"),
    (n[(n.Info = 2)] = "Info"),
    (n[(n.Warning = 3)] = "Warning"),
    (n[(n.Error = 4)] = "Error"),
    n
  ))(ns || {});
  var ss = class ss {
    static _format(t, e) {
      return `[AlphaTab][${t}] ${e}`;
    }
    debug(t, e, ...r) {
      console.debug(ss._format(t, e), ...r);
    }
    warning(t, e, ...r) {
      console.warn(ss._format(t, e), ...r);
    }
    info(t, e, ...r) {
      console.info(ss._format(t, e), ...r);
    }
    error(t, e, ...r) {
      console.error(ss._format(t, e), ...r);
    }
  };
  ss.logLevel = 2;
  var po = ss,
    yr = class yr {
      static _shouldLog(t) {
        return yr.logLevel !== 0 && t >= yr.logLevel;
      }
      static debug(t, e, ...r) {
        yr._shouldLog(1) && yr.log.debug(t, e, ...r);
      }
      static warning(t, e, ...r) {
        yr._shouldLog(3) && yr.log.warning(t, e, ...r);
      }
      static info(t, e, ...r) {
        yr._shouldLog(2) && yr.log.info(t, e, ...r);
      }
      static error(t, e, ...r) {
        yr._shouldLog(4) && yr.log.error(t, e, ...r);
      }
    };
  (yr.logLevel = 2), (yr.log = new po());
  var w = yr;
  var ln = ((r) => (
      (r[(r.NoBrackets = 0)] = "NoBrackets"),
      (r[(r.GroupStaves = 1)] = "GroupStaves"),
      (r[(r.GroupSimilarInstruments = 2)] = "GroupSimilarInstruments"),
      r
    ))(ln || {}),
    Ti = ((r) => (
      (r[(r.Hidden = 0)] = "Hidden"),
      (r[(r.FirstSystem = 1)] = "FirstSystem"),
      (r[(r.AllSystems = 2)] = "AllSystems"),
      r
    ))(Ti || {}),
    ki = ((e) => (
      (e[(e.FullName = 0)] = "FullName"),
      (e[(e.ShortName = 1)] = "ShortName"),
      e
    ))(ki || {}),
    vi = ((e) => (
      (e[(e.Horizontal = 0)] = "Horizontal"),
      (e[(e.Vertical = 1)] = "Vertical"),
      e
    ))(vi || {}),
    Ws = class {
      constructor() {
        this.hideDynamics = !1;
        this.bracketExtendMode = 1;
        this.useSystemSignSeparator = !1;
        this.globalDisplayTuning = !0;
        this.perTrackDisplayTuning = null;
        this.globalDisplayChordDiagramsOnTop = !0;
        this.perTrackChordDiagramsOnTop = null;
        this.singleTrackTrackNamePolicy = 1;
        this.multiTrackTrackNamePolicy = 1;
        this.firstSystemTrackNameMode = 1;
        this.otherSystemsTrackNameMode = 1;
        this.firstSystemTrackNameOrientation = 1;
        this.otherSystemsTrackNameOrientation = 1;
        this.multiTrackMultiBarRest = !1;
        this.perTrackMultiBarRest = null;
      }
    };
  var as = class {
    constructor() {
      this.masterBars = [];
      this.opening = null;
      this.closings = [];
      this.isClosed = !1;
    }
    get openings() {
      let t = this.opening;
      return t ? [t] : [];
    }
    get isOpened() {
      return this.opening?.isRepeatStart === !0;
    }
    addMasterBar(t) {
      this.opening === null && (this.opening = t),
        this.masterBars.push(t),
        (t.repeatGroup = this),
        t.isRepeatEnd && (this.closings.push(t), (this.isClosed = !0));
    }
  };
  var zt = class {
    constructor() {
      this.colors = new Map();
    }
  };
  var yt = ((n) => (
    (n[(n.Neutral = 0)] = "Neutral"),
    (n[(n.C3 = 1)] = "C3"),
    (n[(n.C4 = 2)] = "C4"),
    (n[(n.F4 = 3)] = "F4"),
    (n[(n.G2 = 4)] = "G2"),
    n
  ))(yt || {});
  var ur = ((i) => (
    (i[(i.None = 0)] = "None"),
    (i[(i.Simple = 1)] = "Simple"),
    (i[(i.FirstOfDouble = 2)] = "FirstOfDouble"),
    (i[(i.SecondOfDouble = 3)] = "SecondOfDouble"),
    i
  ))(ur || {});
  var zr = ((b) => (
    (b[(b.Cb = -7)] = "Cb"),
    (b[(b.Gb = -6)] = "Gb"),
    (b[(b.Db = -5)] = "Db"),
    (b[(b.Ab = -4)] = "Ab"),
    (b[(b.Eb = -3)] = "Eb"),
    (b[(b.Bb = -2)] = "Bb"),
    (b[(b.F = -1)] = "F"),
    (b[(b.C = 0)] = "C"),
    (b[(b.G = 1)] = "G"),
    (b[(b.D = 2)] = "D"),
    (b[(b.A = 3)] = "A"),
    (b[(b.E = 4)] = "E"),
    (b[(b.B = 5)] = "B"),
    (b[(b.FSharp = 6)] = "FSharp"),
    (b[(b.CSharp = 7)] = "CSharp"),
    b
  ))(zr || {});
  var Sr = ((e) => (
    (e[(e.Major = 0)] = "Major"), (e[(e.Minor = 1)] = "Minor"), e
  ))(Sr || {});
  var _i = ((r) => (
      (r[(r.Down = 0)] = "Down"),
      (r[(r.Hold = 1)] = "Hold"),
      (r[(r.Up = 2)] = "Up"),
      r
    ))(_i || {}),
    Xt = class {
      constructor() {
        this.ratioPosition = 0;
        this.pedalType = 0;
        this.nextPedalMarker = null;
        this.previousPedalMarker = null;
      }
    },
    Yt = ((x) => (
      (x[(x.StandardNotationRepeats = 0)] = "StandardNotationRepeats"),
      (x[(x.GuitarTabsRepeats = 1)] = "GuitarTabsRepeats"),
      (x[(x.SlashRepeats = 2)] = "SlashRepeats"),
      (x[(x.NumberedRepeats = 3)] = "NumberedRepeats"),
      (x[(x.StandardNotationBarNumber = 4)] = "StandardNotationBarNumber"),
      (x[(x.GuitarTabsBarNumber = 5)] = "GuitarTabsBarNumber"),
      (x[(x.SlashBarNumber = 6)] = "SlashBarNumber"),
      (x[(x.NumberedBarNumber = 7)] = "NumberedBarNumber"),
      (x[(x.StandardNotationBarLines = 8)] = "StandardNotationBarLines"),
      (x[(x.GuitarTabsBarLines = 9)] = "GuitarTabsBarLines"),
      (x[(x.SlashBarLines = 10)] = "SlashBarLines"),
      (x[(x.NumberedBarLines = 11)] = "NumberedBarLines"),
      (x[(x.StandardNotationClef = 12)] = "StandardNotationClef"),
      (x[(x.GuitarTabsClef = 13)] = "GuitarTabsClef"),
      (x[(x.StandardNotationKeySignature = 14)] =
        "StandardNotationKeySignature"),
      (x[(x.NumberedKeySignature = 15)] = "NumberedKeySignature"),
      (x[(x.StandardNotationTimeSignature = 16)] =
        "StandardNotationTimeSignature"),
      (x[(x.GuitarTabsTimeSignature = 17)] = "GuitarTabsTimeSignature"),
      (x[(x.SlashTimeSignature = 18)] = "SlashTimeSignature"),
      (x[(x.NumberedTimeSignature = 19)] = "NumberedTimeSignature"),
      (x[(x.StandardNotationStaffLine = 20)] = "StandardNotationStaffLine"),
      (x[(x.GuitarTabsStaffLine = 21)] = "GuitarTabsStaffLine"),
      (x[(x.SlashStaffLine = 22)] = "SlashStaffLine"),
      (x[(x.NumberedStaffLine = 23)] = "NumberedStaffLine"),
      x
    ))(Yt || {}),
    Hs = class extends zt {},
    cr = ((d) => (
      (d[(d.Automatic = 0)] = "Automatic"),
      (d[(d.Dashed = 1)] = "Dashed"),
      (d[(d.Dotted = 2)] = "Dotted"),
      (d[(d.Heavy = 3)] = "Heavy"),
      (d[(d.HeavyHeavy = 4)] = "HeavyHeavy"),
      (d[(d.HeavyLight = 5)] = "HeavyLight"),
      (d[(d.LightHeavy = 6)] = "LightHeavy"),
      (d[(d.LightLight = 7)] = "LightLight"),
      (d[(d.None = 8)] = "None"),
      (d[(d.Regular = 9)] = "Regular"),
      (d[(d.Short = 10)] = "Short"),
      (d[(d.Tick = 11)] = "Tick"),
      d
    ))(cr || {}),
    un = class un {
      constructor() {
        this.id = un._globalBarId++;
        this.index = 0;
        this.nextBar = null;
        this.previousBar = null;
        this.clef = 4;
        this.clefOttava = 2;
        this.voices = [];
        this.simileMark = 0;
        this._filledVoices = new Set([0]);
        this.displayScale = 1;
        this.displayWidth = -1;
        this.sustainPedals = [];
        this._isEmpty = !0;
        this._isRestOnly = !0;
        this.barLineLeft = 0;
        this.barLineRight = 0;
        this.keySignature = 0;
        this.keySignatureType = 0;
      }
      static resetIds() {
        un._globalBarId = 0;
      }
      get isMultiVoice() {
        return this._filledVoices.size > 1;
      }
      get filledVoices() {
        return this._filledVoices;
      }
      get masterBar() {
        return this.staff.track.score.masterBars[this.index];
      }
      get isEmpty() {
        return this._isEmpty;
      }
      get hasChanges() {
        return this.index === 0 ||
          this.keySignature !== this.previousBar.keySignature ||
          this.keySignatureType !== this.previousBar.keySignatureType ||
          this.clef !== this.previousBar.clef ||
          this.clefOttava !== this.previousBar.clefOttava
          ? !0
          : this.simileMark !== 0 ||
              this.sustainPedals.length > 0 ||
              this.barLineLeft !== 0 ||
              this.barLineRight !== 0;
      }
      get isRestOnly() {
        return this._isRestOnly;
      }
      getActualBarLineLeft(t) {
        return un._actualBarLine(this, !1, t);
      }
      getActualBarLineRight() {
        return un._actualBarLine(this, !0, !1);
      }
      static _automaticToActualType(t, e, r) {
        let i;
        return (
          e
            ? t.isRepeatEnd
              ? (i = 6)
              : t.nextMasterBar
              ? t.isFreeTime
                ? (i = 1)
                : t.isDoubleBar
                ? (i = 7)
                : (i = 9)
              : (i = 6)
            : t.isRepeatStart
            ? (i = 5)
            : r
            ? (i = 9)
            : (i = 8),
          i
        );
      }
      static _actualBarLine(t, e, r) {
        let i = t.masterBar,
          n = e ? t.barLineRight : t.barLineLeft,
          s;
        return n === 0 ? (s = un._automaticToActualType(i, e, r)) : (s = n), s;
      }
      addVoice(t) {
        (t.bar = this), (t.index = this.voices.length), this.voices.push(t);
      }
      finish(t, e = null) {
        this._filledVoices.clear(),
          this._filledVoices.add(0),
          (this._isEmpty = !0),
          (this._isRestOnly = !0);
        for (let i = 0, n = this.voices.length; i < n; i++) {
          let s = this.voices[i];
          s.finish(t, e),
            s.isEmpty || ((this._isEmpty = !1), this._filledVoices.add(i)),
            s.isRestOnly || (this._isRestOnly = !1);
        }
        let r = this.sustainPedals;
        if (r.length > 0) {
          let i = null;
          (this.sustainPedals = []),
            this.previousBar &&
              this.previousBar.sustainPedals.length > 0 &&
              ((i =
                this.previousBar.sustainPedals[
                  this.previousBar.sustainPedals.length - 1
                ]),
              i.pedalType === 2 && (i = null));
          let n = i !== null && i.pedalType !== 2;
          for (let s of r) {
            if (i && i.pedalType !== 2) {
              if (i.bar === this && s.ratioPosition <= i.ratioPosition)
                continue;
              (i.nextPedalMarker = s), (s.previousPedalMarker = i);
            }
            n && s.pedalType === 0 && (s.pedalType = 1),
              (s.bar = this),
              this.sustainPedals.push(s),
              (i = s);
          }
        } else if (
          this.previousBar &&
          this.previousBar.sustainPedals.length > 0
        ) {
          let i =
            this.previousBar.sustainPedals[
              this.previousBar.sustainPedals.length - 1
            ];
          if (i.pedalType !== 2) {
            let n = new Xt();
            (n.ratioPosition = 0),
              (n.bar = this),
              (n.pedalType = 1),
              this.sustainPedals.push(n),
              (i.nextPedalMarker = n),
              (n.previousPedalMarker = i);
          }
        }
      }
      calculateDuration() {
        let t = 0;
        for (let e of this.voices) {
          let r = e.calculateDuration();
          r > t && (t = r);
        }
        return t;
      }
    };
  un._globalBarId = 0;
  var at = un;
  var Vi = class {
    constructor() {
      this.beats = [];
      this.id = "empty";
      this.isComplete = !1;
    }
    addBeat(t) {
      (t.graceIndex = this.beats.length),
        (t.graceGroup = this),
        this.beats.push(t);
    }
    finish() {
      this.beats.length > 0 &&
        (this.id = `${this.beats[0].absoluteDisplayStart}_${this.beats[0].voice.index}`);
    }
  };
  var os = ((t) => ((t[(t.Glyphs = 0)] = "Glyphs"), t))(os || {}),
    Us = class extends zt {},
    ho = class ho {
      constructor() {
        this._isEmpty = !0;
        this._isRestOnly = !0;
        this.id = ho._globalVoiceId++;
        this.index = 0;
        this.beats = [];
      }
      static resetIds() {
        ho._globalVoiceId = 0;
      }
      get isEmpty() {
        return this._isEmpty;
      }
      forceNonEmpty() {
        this._isEmpty = !1;
      }
      get isRestOnly() {
        return this._isRestOnly;
      }
      insertBeat(t, e) {
        (e.nextBeat = t.nextBeat),
          e.nextBeat && (e.nextBeat.previousBeat = e),
          (e.previousBeat = t),
          (e.voice = this),
          (t.nextBeat = e),
          this.beats.splice(t.index + 1, 0, e);
      }
      addBeat(t) {
        (t.voice = this),
          (t.index = this.beats.length),
          this.beats.push(t),
          t.isEmpty || (this._isEmpty = !1),
          t.isRest || (this._isRestOnly = !1);
      }
      _chain(t, e = null) {
        if (this.bar) {
          if (t.index < this.beats.length - 1)
            (t.nextBeat = this.beats[t.index + 1]),
              (t.nextBeat.previousBeat = t);
          else if (t.isLastOfVoice && t.voice.bar.nextBar) {
            let r = this.bar.nextBar.voices[this.index];
            r.beats.length > 0 && (t.nextBeat = r.beats[0]),
              (t.nextBeat.previousBeat = t);
          }
          t.chain(e);
        }
      }
      addGraceBeat(t) {
        if (this.beats.length === 0) {
          this.addBeat(t);
          return;
        }
        let e = this.beats[this.beats.length - 1];
        this.beats.splice(this.beats.length - 1, 1),
          this.addBeat(t),
          this.addBeat(e),
          (this._isEmpty = !1),
          (this._isRestOnly = !1);
      }
      getBeatAtPlaybackStart(t) {
        return this._beatLookup.has(t) ? this._beatLookup.get(t) : null;
      }
      finish(t, e = null) {
        (this._isEmpty = !0),
          (this._isRestOnly = !0),
          (this._beatLookup = new Map());
        let r = null;
        for (let s = 0; s < this.beats.length; s++) {
          let a = this.beats[s];
          (a.index = s),
            this._chain(a, e),
            a.graceType === 0
              ? ((a.graceGroup = r), r && (r.isComplete = !0), (r = null))
              : (r || (r = new Vi()), r.addBeat(a)),
            a.isEmpty || (this._isEmpty = !1),
            a.isRest || (this._isRestOnly = !1);
        }
        let i = 0,
          n = 0;
        for (let s = 0; s < this.beats.length; s++) {
          let a = this.beats[s];
          if (((a.index = s), a.finish(t, e), a.graceType === 0)) {
            if (a.graceGroup) {
              let o = a.graceGroup.beats[0],
                l = a.graceGroup.beats[a.graceGroup.beats.length - 1];
              if (o.graceType !== 3) {
                let u = l.playbackStart + l.playbackDuration - o.playbackStart;
                switch (o.graceType) {
                  case 2:
                    o.previousBeat
                      ? ((o.previousBeat.playbackDuration -= u),
                        o.previousBeat.voice === this
                          ? (n =
                              o.previousBeat.playbackStart +
                              o.previousBeat.playbackDuration)
                          : (n = -u))
                      : (n = -u);
                    for (let c of a.graceGroup.beats)
                      this._beatLookup.delete(c.playbackStart),
                        (c.playbackStart = n),
                        this._beatLookup.set(c.playbackStart, a),
                        (n += c.playbackDuration);
                    break;
                  case 1:
                    (a.playbackDuration -= u),
                      l.voice === this
                        ? (n = l.playbackStart + l.playbackDuration)
                        : (n = -u);
                    break;
                }
              }
            }
            (a.displayStart = i),
              (a.playbackStart = n),
              this._beatLookup.set(a.playbackStart, a);
          } else (a.displayStart = i), (a.playbackStart = n);
          a.fermata
            ? this.bar.masterBar.addFermata(a.playbackStart, a.fermata)
            : (a.fermata = this.bar.masterBar.getFermata(a)),
            a.finishTuplet(),
            a.graceGroup && a.graceGroup.finish(),
            (i += a.displayDuration),
            (n += a.playbackDuration);
        }
      }
      calculateDuration() {
        if (this.isEmpty || this.beats.length === 0) return 0;
        let t = this.beats[this.beats.length - 1],
          e = this.beats[0];
        return t.playbackStart + t.playbackDuration - e.playbackStart;
      }
    };
  ho._globalVoiceId = 0;
  var ze = ho;
  var xe = ((r) => (
      (r[(r.Left = 0)] = "Left"),
      (r[(r.Center = 1)] = "Center"),
      (r[(r.Right = 2)] = "Right"),
      r
    ))(xe || {}),
    je = ((i) => (
      (i[(i.Top = 0)] = "Top"),
      (i[(i.Middle = 1)] = "Middle"),
      (i[(i.Bottom = 2)] = "Bottom"),
      (i[(i.Alphabetic = 3)] = "Alphabetic"),
      i
    ))(je || {}),
    Xr = class {
      constructor(t, e) {
        (this.width = t), (this.height = e);
      }
    },
    ge = class {
      static fillMusicFontSymbolSafe(t, e, r, i, n, s) {
        t.settings.display.resources.engravingSettings.hasSymbol(n) &&
          t.fillMusicFontSymbol(e, r, i, n, s);
      }
      static fillMusicFontSymbolsSafe(t, e, r, i, n, s) {
        let a = n.filter((o) =>
          t.settings.display.resources.engravingSettings.hasSymbol(o)
        );
        a.length !== 0 && t.fillMusicFontSymbols(e, r, i, a, s);
      }
    };
  var Mr = ((c) => (
      (c[(c.Title = 0)] = "Title"),
      (c[(c.SubTitle = 1)] = "SubTitle"),
      (c[(c.Artist = 2)] = "Artist"),
      (c[(c.Album = 3)] = "Album"),
      (c[(c.Words = 4)] = "Words"),
      (c[(c.Music = 5)] = "Music"),
      (c[(c.WordsAndMusic = 6)] = "WordsAndMusic"),
      (c[(c.Transcriber = 7)] = "Transcriber"),
      (c[(c.Copyright = 8)] = "Copyright"),
      (c[(c.CopyrightSecondLine = 9)] = "CopyrightSecondLine"),
      (c[(c.ChordDiagramList = 10)] = "ChordDiagramList"),
      c
    ))(Mr || {}),
    ql = class ql {
      constructor(t = "", e = void 0, r = 0) {
        (this.template = t), (this.isVisible = e), (this.textAlign = r);
      }
      static equals(t, e) {
        let r = t.isVisible !== void 0 ? t.isVisible : !0,
          i = e.isVisible !== void 0 ? e.isVisible : !0;
        return !(
          r !== i ||
          t.template !== e.template ||
          t.textAlign !== e.textAlign
        );
      }
      buildText(t) {
        let e = !1,
          r = !1,
          i = this.template.replace(ql._placeholderPattern, (n, s) => {
            r = !0;
            let a = "";
            switch (s) {
              case "TITLE":
                a = t.title;
                break;
              case "SUBTITLE":
                a = t.subTitle;
                break;
              case "ARTIST":
                a = t.artist;
                break;
              case "ALBUM":
                a = t.album;
                break;
              case "WORDS":
              case "WORDSMUSIC":
                a = t.words;
                break;
              case "MUSIC":
                a = t.music;
                break;
              case "TABBER":
                a = t.tab;
                break;
              case "COPYRIGHT":
                a = t.copyright;
                break;
              default:
                a = "";
                break;
            }
            return a && (e = !0), a;
          });
        return r && !e ? "" : i;
      }
    };
  ql._placeholderPattern = /%([^%]+)%/g;
  var ct = ql,
    Jt = class extends zt {
      constructor() {
        super(...arguments);
        this.headerAndFooter = new Map();
      }
    };
  Jt.defaultHeaderAndFooter = new Map([
    [0, new ct("%TITLE%", void 0, 1)],
    [1, new ct("%SUBTITLE%", void 0, 1)],
    [2, new ct("%ARTIST%", void 0, 1)],
    [3, new ct("%ALBUM%", void 0, 1)],
    [4, new ct("Words by %WORDS%", void 0, 0)],
    [5, new ct("Music by %MUSIC%", void 0, 2)],
    [6, new ct("Words & Music by %MUSIC%", void 0, 2)],
    [7, new ct("Tabbed by %TABBER%", !1, 2)],
    [8, new ct("%COPYRIGHT%", void 0, 1)],
    [9, new ct("All Rights Reserved - International Copyright Secured", !0, 1)],
  ]);
  var tt = class {
    constructor() {
      this._currentRepeatGroup = null;
      this._openedRepeatGroups = [];
      this._properlyOpenedRepeatGroups = 0;
      this.album = "";
      this.artist = "";
      this.copyright = "";
      this.instructions = "";
      this.music = "";
      this.notices = "";
      this.subTitle = "";
      this.title = "";
      this.words = "";
      this.tab = "";
      this.masterBars = [];
      this.tracks = [];
      this.defaultSystemsLayout = 3;
      this.systemsLayout = [];
      this.stylesheet = new Ws();
    }
    static resetIds() {
      at.resetIds(), Me.resetIds(), ze.resetIds(), Xe.resetIds();
    }
    get tempo() {
      return this.masterBars.length &&
        this.masterBars[0].tempoAutomations.length > 0
        ? this.masterBars[0].tempoAutomations[0].value
        : 120;
    }
    get tempoLabel() {
      return this.masterBars.length &&
        this.masterBars[0].tempoAutomations.length > 0
        ? this.masterBars[0].tempoAutomations[0].text
        : "";
    }
    rebuildRepeatGroups() {
      (this._currentRepeatGroup = null),
        (this._openedRepeatGroups = []),
        (this._properlyOpenedRepeatGroups = 0);
      for (let t of this.masterBars) this._addMasterBarToRepeatGroups(t);
    }
    addMasterBar(t) {
      (t.score = this),
        (t.index = this.masterBars.length),
        this.masterBars.length !== 0 &&
          ((t.previousMasterBar = this.masterBars[this.masterBars.length - 1]),
          (t.previousMasterBar.nextMasterBar = t),
          (t.start =
            t.previousMasterBar.start +
            (t.previousMasterBar.isAnacrusis
              ? 0
              : t.previousMasterBar.calculateDuration()))),
        this._addMasterBarToRepeatGroups(t),
        this.masterBars.push(t);
    }
    _addMasterBarToRepeatGroups(t) {
      t.isRepeatStart
        ? (this._currentRepeatGroup?.isClosed &&
            (this._openedRepeatGroups.pop(),
            this._properlyOpenedRepeatGroups--),
          (this._currentRepeatGroup = new as()),
          this._openedRepeatGroups.push(this._currentRepeatGroup),
          this._properlyOpenedRepeatGroups++)
        : this._currentRepeatGroup ||
          ((this._currentRepeatGroup = new as()),
          this._openedRepeatGroups.push(this._currentRepeatGroup)),
        this._currentRepeatGroup.addMasterBar(t),
        t.isRepeatEnd &&
          this._properlyOpenedRepeatGroups > 1 &&
          (this._openedRepeatGroups.pop(),
          this._properlyOpenedRepeatGroups--,
          (this._currentRepeatGroup =
            this._openedRepeatGroups.length > 0
              ? this._openedRepeatGroups[this._openedRepeatGroups.length - 1]
              : null));
    }
    addTrack(t) {
      (t.score = this), (t.index = this.tracks.length), this.tracks.push(t);
    }
    finish(t) {
      let e = new Map();
      for (let r = 0, i = this.tracks.length; r < i; r++)
        this.tracks[r].finish(t, e);
    }
    applyFlatSyncPoints(t) {
      for (let e of this.masterBars) e.syncPoints = void 0;
      for (let e of t) {
        let r = new he();
        (r.ratioPosition = Math.min(1, Math.max(0, e.barPosition))),
          (r.type = 4),
          (r.syncPointValue = new Ur()),
          (r.syncPointValue.millisecondOffset = e.millisecondOffset),
          (r.syncPointValue.barOccurence = e.barOccurence),
          e.barIndex < this.masterBars.length &&
            this.masterBars[e.barIndex].addSyncPoint(r);
      }
      for (let e of this.masterBars)
        e.syncPoints &&
          e.syncPoints.sort((r, i) => {
            let n =
              r.syncPointValue.barOccurence - i.syncPointValue.barOccurence;
            return n !== 0 ? n : r.ratioPosition - i.ratioPosition;
          });
    }
    exportFlatSyncPoints() {
      let t = [];
      for (let e of this.masterBars) {
        let r = e.syncPoints;
        if (r)
          for (let i of r)
            t.push({
              barIndex: e.index,
              barOccurence: i.syncPointValue.barOccurence,
              barPosition: i.ratioPosition,
              millisecondOffset: i.syncPointValue.millisecondOffset,
            });
      }
      return t;
    }
  };
  var Ct = ((a) => (
    (a[(a.NoTripletFeel = 0)] = "NoTripletFeel"),
    (a[(a.Triplet16th = 1)] = "Triplet16th"),
    (a[(a.Triplet8th = 2)] = "Triplet8th"),
    (a[(a.Dotted16th = 3)] = "Dotted16th"),
    (a[(a.Dotted8th = 4)] = "Dotted8th"),
    (a[(a.Scottish16th = 5)] = "Scottish16th"),
    (a[(a.Scottish8th = 6)] = "Scottish8th"),
    a
  ))(Ct || {});
  var ot = class {
    constructor() {
      this.alternateEndings = 0;
      this.nextMasterBar = null;
      this.previousMasterBar = null;
      this.index = 0;
      this.isDoubleBar = !1;
      this.isRepeatStart = !1;
      this.repeatCount = 0;
      this.timeSignatureNumerator = 4;
      this.timeSignatureDenominator = 4;
      this.timeSignatureCommon = !1;
      this.isFreeTime = !1;
      this.tripletFeel = 0;
      this.section = null;
      this.tempoAutomations = [];
      this.fermata = null;
      this.start = 0;
      this.isAnacrusis = !1;
      this.displayScale = 1;
      this.displayWidth = -1;
      this.directions = null;
    }
    get hasChanges() {
      return this.index === 0
        ? !1
        : this.timeSignatureCommon !==
            this.previousMasterBar.timeSignatureCommon ||
          this.timeSignatureNumerator !==
            this.previousMasterBar.timeSignatureNumerator ||
          this.timeSignatureDenominator !==
            this.previousMasterBar.timeSignatureDenominator ||
          this.tripletFeel !== this.previousMasterBar.tripletFeel
        ? !0
        : this.alternateEndings !== 0 ||
          this.isRepeatStart ||
          this.isRepeatEnd ||
          this.isFreeTime ||
          this.isSectionStart ||
          this.tempoAutomations.length > 0 ||
          (this.syncPoints && this.syncPoints.length > 0) ||
          (this.fermata !== null && this.fermata.size > 0) ||
          (this.directions !== null && this.directions.size > 0) ||
          this.isAnacrusis;
    }
    get keySignature() {
      return this.score.tracks[0].staves[0].bars[this.index].keySignature;
    }
    set keySignature(t) {
      this.score.tracks[0].staves[0].bars[this.index].keySignature = t;
    }
    get keySignatureType() {
      return this.score.tracks[0].staves[0].bars[this.index].keySignatureType;
    }
    set keySignatureType(t) {
      this.score.tracks[0].staves[0].bars[this.index].keySignatureType = t;
    }
    get isRepeatEnd() {
      return this.repeatCount > 0;
    }
    get isSectionStart() {
      return !!this.section;
    }
    get tempoAutomation() {
      return this.tempoAutomations.length > 0 ? this.tempoAutomations[0] : null;
    }
    calculateDuration(t = !0) {
      if (this.isAnacrusis && t) {
        let e = 0;
        for (let r of this.score.tracks)
          for (let i of r.staves) {
            let n =
              this.index < i.bars.length
                ? i.bars[this.index].calculateDuration()
                : 0;
            n > e && (e = n);
          }
        return e;
      }
      return (
        this.timeSignatureNumerator *
        E.valueToTicks(this.timeSignatureDenominator)
      );
    }
    addFermata(t, e) {
      let r = this.fermata;
      r === null && ((r = new Map()), (this.fermata = r)), r.set(t, e);
    }
    addDirection(t) {
      this.directions == null && (this.directions = new Set()),
        this.directions.add(t);
    }
    getFermata(t) {
      let e = this.fermata;
      return e === null
        ? null
        : e.has(t.playbackStart)
        ? e.get(t.playbackStart)
        : t.index === 0 && e.has(0)
        ? e.get(0)
        : null;
    }
    addSyncPoint(t) {
      this.syncPoints || (this.syncPoints = []), this.syncPoints.push(t);
    }
  };
  ot.MaxAlternateEndings = 8;
  var dt = class dt {};
  (dt.DefaultChannelCount = 17),
    (dt.MetronomeChannel = dt.DefaultChannelCount - 1),
    (dt.MetronomeKey = 33),
    (dt.AudioChannels = 2),
    (dt.MinVolume = 0),
    (dt.MinProgram = 0),
    (dt.MaxProgram = 127),
    (dt.MinPlaybackSpeed = 0.125),
    (dt.MaxPlaybackSpeed = 8),
    (dt.PercussionChannel = 9),
    (dt.PercussionBank = 128),
    (dt.MaxPitchWheel = 16384),
    (dt.MaxPitchWheel20 = 4294967296),
    (dt.DefaultPitchWheel = dt.MaxPitchWheel / 2),
    (dt.MicroBufferCount = 32),
    (dt.MicroBufferSize = 64);
  var Q = dt;
  var K = ((m) => (
    (m[(m.None = -1)] = "None"),
    (m[(m.Space = 32)] = "Space"),
    (m[(m.Brace = 57344)] = "Brace"),
    (m[(m.BracketTop = 57347)] = "BracketTop"),
    (m[(m.BracketBottom = 57348)] = "BracketBottom"),
    (m[(m.SystemDivider = 57351)] = "SystemDivider"),
    (m[(m.GClef = 57424)] = "GClef"),
    (m[(m.GClef15mb = 57425)] = "GClef15mb"),
    (m[(m.GClef8vb = 57426)] = "GClef8vb"),
    (m[(m.GClef8va = 57427)] = "GClef8va"),
    (m[(m.GClef15ma = 57428)] = "GClef15ma"),
    (m[(m.CClef = 57436)] = "CClef"),
    (m[(m.CClef8vb = 57437)] = "CClef8vb"),
    (m[(m.FClef = 57442)] = "FClef"),
    (m[(m.FClef15mb = 57443)] = "FClef15mb"),
    (m[(m.FClef8vb = 57444)] = "FClef8vb"),
    (m[(m.FClef8va = 57445)] = "FClef8va"),
    (m[(m.FClef15ma = 57446)] = "FClef15ma"),
    (m[(m.UnpitchedPercussionClef1 = 57449)] = "UnpitchedPercussionClef1"),
    (m[(m.SixStringTabClef = 57453)] = "SixStringTabClef"),
    (m[(m.FourStringTabClef = 57454)] = "FourStringTabClef"),
    (m[(m.Clef8 = 57469)] = "Clef8"),
    (m[(m.Clef15 = 57470)] = "Clef15"),
    (m[(m.TimeSig0 = 57472)] = "TimeSig0"),
    (m[(m.TimeSig1 = 57473)] = "TimeSig1"),
    (m[(m.TimeSig2 = 57474)] = "TimeSig2"),
    (m[(m.TimeSig3 = 57475)] = "TimeSig3"),
    (m[(m.TimeSig4 = 57476)] = "TimeSig4"),
    (m[(m.TimeSig5 = 57477)] = "TimeSig5"),
    (m[(m.TimeSig6 = 57478)] = "TimeSig6"),
    (m[(m.TimeSig7 = 57479)] = "TimeSig7"),
    (m[(m.TimeSig8 = 57480)] = "TimeSig8"),
    (m[(m.TimeSig9 = 57481)] = "TimeSig9"),
    (m[(m.TimeSigCommon = 57482)] = "TimeSigCommon"),
    (m[(m.TimeSigCutCommon = 57483)] = "TimeSigCutCommon"),
    (m[(m.NoteheadDoubleWholeSquare = 57505)] = "NoteheadDoubleWholeSquare"),
    (m[(m.NoteheadDoubleWhole = 57504)] = "NoteheadDoubleWhole"),
    (m[(m.NoteheadWhole = 57506)] = "NoteheadWhole"),
    (m[(m.NoteheadHalf = 57507)] = "NoteheadHalf"),
    (m[(m.NoteheadBlack = 57508)] = "NoteheadBlack"),
    (m[(m.NoteheadNull = 57509)] = "NoteheadNull"),
    (m[(m.NoteheadXOrnate = 57514)] = "NoteheadXOrnate"),
    (m[(m.NoteheadPlusDoubleWhole = 57516)] = "NoteheadPlusDoubleWhole"),
    (m[(m.NoteheadPlusWhole = 57517)] = "NoteheadPlusWhole"),
    (m[(m.NoteheadPlusHalf = 57518)] = "NoteheadPlusHalf"),
    (m[(m.NoteheadPlusBlack = 57519)] = "NoteheadPlusBlack"),
    (m[(m.NoteheadSquareWhite = 57528)] = "NoteheadSquareWhite"),
    (m[(m.NoteheadSquareBlack = 57529)] = "NoteheadSquareBlack"),
    (m[(m.NoteheadTriangleUpDoubleWhole = 57530)] =
      "NoteheadTriangleUpDoubleWhole"),
    (m[(m.NoteheadTriangleUpWhole = 57531)] = "NoteheadTriangleUpWhole"),
    (m[(m.NoteheadTriangleUpHalf = 57532)] = "NoteheadTriangleUpHalf"),
    (m[(m.NoteheadTriangleUpBlack = 57534)] = "NoteheadTriangleUpBlack"),
    (m[(m.NoteheadTriangleRightWhite = 57537)] = "NoteheadTriangleRightWhite"),
    (m[(m.NoteheadTriangleRightBlack = 57538)] = "NoteheadTriangleRightBlack"),
    (m[(m.NoteheadTriangleDownDoubleWhole = 57548)] =
      "NoteheadTriangleDownDoubleWhole"),
    (m[(m.NoteheadTriangleDownWhole = 57540)] = "NoteheadTriangleDownWhole"),
    (m[(m.NoteheadTriangleDownHalf = 57541)] = "NoteheadTriangleDownHalf"),
    (m[(m.NoteheadTriangleDownBlack = 57543)] = "NoteheadTriangleDownBlack"),
    (m[(m.NoteheadDiamondDoubleWhole = 57559)] = "NoteheadDiamondDoubleWhole"),
    (m[(m.NoteheadDiamondWhole = 57560)] = "NoteheadDiamondWhole"),
    (m[(m.NoteheadDiamondHalf = 57561)] = "NoteheadDiamondHalf"),
    (m[(m.NoteheadDiamondBlack = 57563)] = "NoteheadDiamondBlack"),
    (m[(m.NoteheadDiamondBlackWide = 57564)] = "NoteheadDiamondBlackWide"),
    (m[(m.NoteheadDiamondWhite = 57565)] = "NoteheadDiamondWhite"),
    (m[(m.NoteheadDiamondWhiteWide = 57566)] = "NoteheadDiamondWhiteWide"),
    (m[(m.NoteheadCircleXDoubleWhole = 57520)] = "NoteheadCircleXDoubleWhole"),
    (m[(m.NoteheadCircleXWhole = 57521)] = "NoteheadCircleXWhole"),
    (m[(m.NoteheadCircleXHalf = 57522)] = "NoteheadCircleXHalf"),
    (m[(m.NoteheadCircleX = 57523)] = "NoteheadCircleX"),
    (m[(m.NoteheadXDoubleWhole = 57510)] = "NoteheadXDoubleWhole"),
    (m[(m.NoteheadXWhole = 57511)] = "NoteheadXWhole"),
    (m[(m.NoteheadXHalf = 57512)] = "NoteheadXHalf"),
    (m[(m.NoteheadXBlack = 57513)] = "NoteheadXBlack"),
    (m[(m.NoteheadParenthesis = 57550)] = "NoteheadParenthesis"),
    (m[(m.NoteheadSlashedBlack1 = 57551)] = "NoteheadSlashedBlack1"),
    (m[(m.NoteheadSlashedBlack2 = 57552)] = "NoteheadSlashedBlack2"),
    (m[(m.NoteheadSlashedHalf1 = 57553)] = "NoteheadSlashedHalf1"),
    (m[(m.NoteheadSlashedHalf2 = 57554)] = "NoteheadSlashedHalf2"),
    (m[(m.NoteheadSlashedWhole1 = 57555)] = "NoteheadSlashedWhole1"),
    (m[(m.NoteheadSlashedWhole2 = 57556)] = "NoteheadSlashedWhole2"),
    (m[(m.NoteheadSlashedDoubleWhole1 = 57557)] =
      "NoteheadSlashedDoubleWhole1"),
    (m[(m.NoteheadSlashedDoubleWhole2 = 57558)] =
      "NoteheadSlashedDoubleWhole2"),
    (m[(m.NoteheadCircledBlack = 57572)] = "NoteheadCircledBlack"),
    (m[(m.NoteheadCircledHalf = 57573)] = "NoteheadCircledHalf"),
    (m[(m.NoteheadCircledWhole = 57574)] = "NoteheadCircledWhole"),
    (m[(m.NoteheadCircledDoubleWhole = 57575)] = "NoteheadCircledDoubleWhole"),
    (m[(m.NoteheadCircleSlash = 57591)] = "NoteheadCircleSlash"),
    (m[(m.NoteheadHeavyX = 57592)] = "NoteheadHeavyX"),
    (m[(m.NoteheadHeavyXHat = 57593)] = "NoteheadHeavyXHat"),
    (m[(m.NoteheadSlashHorizontalEnds = 57601)] =
      "NoteheadSlashHorizontalEnds"),
    (m[(m.NoteheadSlashWhiteWhole = 57602)] = "NoteheadSlashWhiteWhole"),
    (m[(m.NoteheadSlashWhiteHalf = 57603)] = "NoteheadSlashWhiteHalf"),
    (m[(m.NoteheadRoundWhiteWithDot = 57621)] = "NoteheadRoundWhiteWithDot"),
    (m[(m.NoteheadSquareBlackLarge = 57626)] = "NoteheadSquareBlackLarge"),
    (m[(m.NoteheadSquareBlackWhite = 57627)] = "NoteheadSquareBlackWhite"),
    (m[(m.NoteheadClusterDoubleWhole3rd = 57640)] =
      "NoteheadClusterDoubleWhole3rd"),
    (m[(m.NoteheadClusterWhole3rd = 57641)] = "NoteheadClusterWhole3rd"),
    (m[(m.NoteheadClusterHalf3rd = 57642)] = "NoteheadClusterHalf3rd"),
    (m[(m.NoteheadClusterQuarter3rd = 57643)] = "NoteheadClusterQuarter3rd"),
    (m[(m.NoteShapeRoundWhite = 57776)] = "NoteShapeRoundWhite"),
    (m[(m.NoteShapeRoundBlack = 57777)] = "NoteShapeRoundBlack"),
    (m[(m.NoteShapeSquareWhite = 57778)] = "NoteShapeSquareWhite"),
    (m[(m.NoteShapeSquareBlack = 57779)] = "NoteShapeSquareBlack"),
    (m[(m.NoteShapeTriangleRightWhite = 57780)] =
      "NoteShapeTriangleRightWhite"),
    (m[(m.NoteShapeTriangleRightBlack = 57781)] =
      "NoteShapeTriangleRightBlack"),
    (m[(m.NoteShapeTriangleLeftWhite = 57782)] = "NoteShapeTriangleLeftWhite"),
    (m[(m.NoteShapeTriangleLeftBlack = 57783)] = "NoteShapeTriangleLeftBlack"),
    (m[(m.NoteShapeDiamondWhite = 57784)] = "NoteShapeDiamondWhite"),
    (m[(m.NoteShapeDiamondBlack = 57785)] = "NoteShapeDiamondBlack"),
    (m[(m.NoteShapeTriangleUpWhite = 57786)] = "NoteShapeTriangleUpWhite"),
    (m[(m.NoteShapeTriangleUpBlack = 57787)] = "NoteShapeTriangleUpBlack"),
    (m[(m.NoteShapeMoonWhite = 57788)] = "NoteShapeMoonWhite"),
    (m[(m.NoteShapeMoonBlack = 57789)] = "NoteShapeMoonBlack"),
    (m[(m.NoteShapeTriangleRoundWhite = 57790)] =
      "NoteShapeTriangleRoundWhite"),
    (m[(m.NoteShapeTriangleRoundBlack = 57791)] =
      "NoteShapeTriangleRoundBlack"),
    (m[(m.NoteQuarterUp = 57813)] = "NoteQuarterUp"),
    (m[(m.Note8thUp = 57815)] = "Note8thUp"),
    (m[(m.MetNoteQuarterUp = 60581)] = "MetNoteQuarterUp"),
    (m[(m.MetNote8thUp = 60583)] = "MetNote8thUp"),
    (m[(m.MetAugmentationDot = 60599)] = "MetAugmentationDot"),
    (m[(m.ArrowheadBlackUp = 60280)] = "ArrowheadBlackUp"),
    (m[(m.ArrowheadBlackDown = 60284)] = "ArrowheadBlackDown"),
    (m[(m.AugmentationDot = 57831)] = "AugmentationDot"),
    (m[(m.TextBlackNoteLongStem = 57841)] = "TextBlackNoteLongStem"),
    (m[(m.TextBlackNoteFrac8thLongStem = 57843)] =
      "TextBlackNoteFrac8thLongStem"),
    (m[(m.TextBlackNoteFrac16thLongStem = 57845)] =
      "TextBlackNoteFrac16thLongStem"),
    (m[(m.TextBlackNoteFrac32ndLongStem = 57846)] =
      "TextBlackNoteFrac32ndLongStem"),
    (m[(m.TextCont8thBeamLongStem = 57848)] = "TextCont8thBeamLongStem"),
    (m[(m.TextCont16thBeamLongStem = 57850)] = "TextCont16thBeamLongStem"),
    (m[(m.TextCont32ndBeamLongStem = 57851)] = "TextCont32ndBeamLongStem"),
    (m[(m.TextAugmentationDot = 57852)] = "TextAugmentationDot"),
    (m[(m.TextTupletBracketStartLongStem = 57857)] =
      "TextTupletBracketStartLongStem"),
    (m[(m.TextTuplet3LongStem = 57858)] = "TextTuplet3LongStem"),
    (m[(m.TextTupletBracketEndLongStem = 57859)] =
      "TextTupletBracketEndLongStem"),
    (m[(m.Tremolo3 = 57890)] = "Tremolo3"),
    (m[(m.Tremolo2 = 57889)] = "Tremolo2"),
    (m[(m.Tremolo1 = 57888)] = "Tremolo1"),
    (m[(m.Flag8thUp = 57920)] = "Flag8thUp"),
    (m[(m.Flag8thDown = 57921)] = "Flag8thDown"),
    (m[(m.Flag16thUp = 57922)] = "Flag16thUp"),
    (m[(m.Flag16thDown = 57923)] = "Flag16thDown"),
    (m[(m.Flag32ndUp = 57924)] = "Flag32ndUp"),
    (m[(m.Flag32ndDown = 57925)] = "Flag32ndDown"),
    (m[(m.Flag64thUp = 57926)] = "Flag64thUp"),
    (m[(m.Flag64thDown = 57927)] = "Flag64thDown"),
    (m[(m.Flag128thUp = 57928)] = "Flag128thUp"),
    (m[(m.Flag128thDown = 57929)] = "Flag128thDown"),
    (m[(m.Flag256thUp = 57930)] = "Flag256thUp"),
    (m[(m.Flag256thDown = 57931)] = "Flag256thDown"),
    (m[(m.AccidentalFlat = 57952)] = "AccidentalFlat"),
    (m[(m.AccidentalNatural = 57953)] = "AccidentalNatural"),
    (m[(m.AccidentalSharp = 57954)] = "AccidentalSharp"),
    (m[(m.AccidentalDoubleSharp = 57955)] = "AccidentalDoubleSharp"),
    (m[(m.AccidentalDoubleFlat = 57956)] = "AccidentalDoubleFlat"),
    (m[(m.AccidentalQuarterToneFlatArrowUp = 57968)] =
      "AccidentalQuarterToneFlatArrowUp"),
    (m[(m.AccidentalQuarterToneSharpNaturalArrowUp = 57970)] =
      "AccidentalQuarterToneSharpNaturalArrowUp"),
    (m[(m.AccidentalThreeQuarterTonesSharpArrowUp = 57972)] =
      "AccidentalThreeQuarterTonesSharpArrowUp"),
    (m[(m.RepeatDot = 57412)] = "RepeatDot"),
    (m[(m.Segno = 57415)] = "Segno"),
    (m[(m.Coda = 57416)] = "Coda"),
    (m[(m.ArticAccentAbove = 58528)] = "ArticAccentAbove"),
    (m[(m.ArticAccentBelow = 58529)] = "ArticAccentBelow"),
    (m[(m.ArticStaccatoAbove = 58530)] = "ArticStaccatoAbove"),
    (m[(m.ArticStaccatoBelow = 58531)] = "ArticStaccatoBelow"),
    (m[(m.ArticTenutoAbove = 58532)] = "ArticTenutoAbove"),
    (m[(m.ArticTenutoBelow = 58533)] = "ArticTenutoBelow"),
    (m[(m.ArticMarcatoAbove = 58540)] = "ArticMarcatoAbove"),
    (m[(m.ArticMarcatoBelow = 58541)] = "ArticMarcatoBelow"),
    (m[(m.FermataAbove = 58560)] = "FermataAbove"),
    (m[(m.FermataShortAbove = 58564)] = "FermataShortAbove"),
    (m[(m.FermataLongAbove = 58566)] = "FermataLongAbove"),
    (m[(m.RestLonga = 58593)] = "RestLonga"),
    (m[(m.RestDoubleWhole = 58594)] = "RestDoubleWhole"),
    (m[(m.RestWhole = 58595)] = "RestWhole"),
    (m[(m.RestHalf = 58596)] = "RestHalf"),
    (m[(m.RestQuarter = 58597)] = "RestQuarter"),
    (m[(m.Rest8th = 58598)] = "Rest8th"),
    (m[(m.Rest16th = 58599)] = "Rest16th"),
    (m[(m.Rest32nd = 58600)] = "Rest32nd"),
    (m[(m.Rest64th = 58601)] = "Rest64th"),
    (m[(m.Rest128th = 58602)] = "Rest128th"),
    (m[(m.Rest256th = 58603)] = "Rest256th"),
    (m[(m.RestHBarLeft = 58607)] = "RestHBarLeft"),
    (m[(m.RestHBarMiddle = 58608)] = "RestHBarMiddle"),
    (m[(m.RestHBarRight = 58609)] = "RestHBarRight"),
    (m[(m.Repeat1Bar = 58624)] = "Repeat1Bar"),
    (m[(m.Repeat2Bars = 58625)] = "Repeat2Bars"),
    (m[(m.Ottava = 58640)] = "Ottava"),
    (m[(m.OttavaAlta = 58641)] = "OttavaAlta"),
    (m[(m.OttavaBassaVb = 58652)] = "OttavaBassaVb"),
    (m[(m.Quindicesima = 58644)] = "Quindicesima"),
    (m[(m.QuindicesimaAlta = 58645)] = "QuindicesimaAlta"),
    (m[(m.DynamicPPPPPP = 58663)] = "DynamicPPPPPP"),
    (m[(m.DynamicPPPPP = 58664)] = "DynamicPPPPP"),
    (m[(m.DynamicPPPP = 58665)] = "DynamicPPPP"),
    (m[(m.DynamicPPP = 58666)] = "DynamicPPP"),
    (m[(m.DynamicPP = 58667)] = "DynamicPP"),
    (m[(m.DynamicPiano = 58656)] = "DynamicPiano"),
    (m[(m.DynamicMP = 58668)] = "DynamicMP"),
    (m[(m.DynamicMF = 58669)] = "DynamicMF"),
    (m[(m.DynamicPF = 58670)] = "DynamicPF"),
    (m[(m.DynamicForte = 58658)] = "DynamicForte"),
    (m[(m.DynamicFF = 58671)] = "DynamicFF"),
    (m[(m.DynamicFFF = 58672)] = "DynamicFFF"),
    (m[(m.DynamicFFFF = 58673)] = "DynamicFFFF"),
    (m[(m.DynamicFFFFF = 58674)] = "DynamicFFFFF"),
    (m[(m.DynamicFFFFFF = 58675)] = "DynamicFFFFFF"),
    (m[(m.DynamicFortePiano = 58676)] = "DynamicFortePiano"),
    (m[(m.DynamicNiente = 58662)] = "DynamicNiente"),
    (m[(m.DynamicSforzando1 = 58678)] = "DynamicSforzando1"),
    (m[(m.DynamicSforzandoPiano = 58679)] = "DynamicSforzandoPiano"),
    (m[(m.DynamicSforzandoPianissimo = 58680)] = "DynamicSforzandoPianissimo"),
    (m[(m.DynamicSforzato = 58681)] = "DynamicSforzato"),
    (m[(m.DynamicSforzatoPiano = 58682)] = "DynamicSforzatoPiano"),
    (m[(m.DynamicSforzatoFF = 58683)] = "DynamicSforzatoFF"),
    (m[(m.DynamicRinforzando1 = 58684)] = "DynamicRinforzando1"),
    (m[(m.DynamicRinforzando2 = 58685)] = "DynamicRinforzando2"),
    (m[(m.DynamicForzando = 58677)] = "DynamicForzando"),
    (m[(m.DynamicCrescendoHairpin = 58686)] = "DynamicCrescendoHairpin"),
    (m[(m.GraceNoteSlashStemUp = 58724)] = "GraceNoteSlashStemUp"),
    (m[(m.GraceNoteSlashStemDown = 58725)] = "GraceNoteSlashStemDown"),
    (m[(m.OrnamentTrill = 58726)] = "OrnamentTrill"),
    (m[(m.OrnamentTurn = 58727)] = "OrnamentTurn"),
    (m[(m.OrnamentTurnInverted = 58728)] = "OrnamentTurnInverted"),
    (m[(m.OrnamentShortTrill = 58732)] = "OrnamentShortTrill"),
    (m[(m.OrnamentMordent = 58733)] = "OrnamentMordent"),
    (m[(m.StringsDownBow = 58896)] = "StringsDownBow"),
    (m[(m.StringsUpBow = 58898)] = "StringsUpBow"),
    (m[(m.KeyboardPedalPed = 58960)] = "KeyboardPedalPed"),
    (m[(m.KeyboardPedalUp = 58965)] = "KeyboardPedalUp"),
    (m[(m.PictEdgeOfCymbal = 59177)] = "PictEdgeOfCymbal"),
    (m[(m.GuitarString0 = 59443)] = "GuitarString0"),
    (m[(m.GuitarString1 = 59444)] = "GuitarString1"),
    (m[(m.GuitarString2 = 59445)] = "GuitarString2"),
    (m[(m.GuitarString3 = 59446)] = "GuitarString3"),
    (m[(m.GuitarString4 = 59447)] = "GuitarString4"),
    (m[(m.GuitarString5 = 59448)] = "GuitarString5"),
    (m[(m.GuitarString6 = 59449)] = "GuitarString6"),
    (m[(m.GuitarString7 = 59450)] = "GuitarString7"),
    (m[(m.GuitarString8 = 59451)] = "GuitarString8"),
    (m[(m.GuitarString9 = 59452)] = "GuitarString9"),
    (m[(m.GuitarOpenPedal = 59453)] = "GuitarOpenPedal"),
    (m[(m.GuitarClosePedal = 59455)] = "GuitarClosePedal"),
    (m[(m.GuitarGolpe = 59458)] = "GuitarGolpe"),
    (m[(m.GuitarFadeIn = 59459)] = "GuitarFadeIn"),
    (m[(m.GuitarFadeOut = 59460)] = "GuitarFadeOut"),
    (m[(m.GuitarVolumeSwell = 59461)] = "GuitarVolumeSwell"),
    (m[(m.FretboardFilledCircle = 59480)] = "FretboardFilledCircle"),
    (m[(m.FretboardX = 59481)] = "FretboardX"),
    (m[(m.FretboardO = 59482)] = "FretboardO"),
    (m[(m.Tuplet0 = 59520)] = "Tuplet0"),
    (m[(m.Tuplet1 = 59521)] = "Tuplet1"),
    (m[(m.Tuplet2 = 59522)] = "Tuplet2"),
    (m[(m.Tuplet3 = 59523)] = "Tuplet3"),
    (m[(m.Tuplet4 = 59524)] = "Tuplet4"),
    (m[(m.Tuplet5 = 59525)] = "Tuplet5"),
    (m[(m.Tuplet6 = 59526)] = "Tuplet6"),
    (m[(m.Tuplet7 = 59527)] = "Tuplet7"),
    (m[(m.Tuplet8 = 59528)] = "Tuplet8"),
    (m[(m.Tuplet9 = 59529)] = "Tuplet9"),
    (m[(m.TupletColon = 59530)] = "TupletColon"),
    (m[(m.WiggleTrill = 60068)] = "WiggleTrill"),
    (m[(m.GuitarVibratoStroke = 60082)] = "GuitarVibratoStroke"),
    (m[(m.GuitarWideVibratoStroke = 60083)] = "GuitarWideVibratoStroke"),
    (m[(m.WiggleVibratoMediumFast = 60126)] = "WiggleVibratoMediumFast"),
    (m[(m.WiggleSawtoothNarrow = 60090)] = "WiggleSawtoothNarrow"),
    (m[(m.WiggleSawtooth = 60091)] = "WiggleSawtooth"),
    (m[(m.OctaveBaselineM = 60565)] = "OctaveBaselineM"),
    (m[(m.OctaveBaselineB = 60563)] = "OctaveBaselineB"),
    (m[(m.GuitarLeftHandTapping = 59456)] = "GuitarLeftHandTapping"),
    (m[(m.Fingering0 = 60688)] = "Fingering0"),
    (m[(m.Fingering1 = 60689)] = "Fingering1"),
    (m[(m.Fingering2 = 60690)] = "Fingering2"),
    (m[(m.Fingering3 = 60691)] = "Fingering3"),
    (m[(m.Fingering4 = 60692)] = "Fingering4"),
    (m[(m.Fingering5 = 60693)] = "Fingering5"),
    (m[(m.FingeringPLower = 60695)] = "FingeringPLower"),
    (m[(m.FingeringTLower = 60696)] = "FingeringTLower"),
    (m[(m.FingeringILower = 60697)] = "FingeringILower"),
    (m[(m.FingeringMLower = 60698)] = "FingeringMLower"),
    (m[(m.FingeringALower = 60699)] = "FingeringALower"),
    (m[(m.FingeringCLower = 60700)] = "FingeringCLower"),
    m
  ))(K || {});
  var Ir = ((l) => (
    (l[(l.None = 0)] = "None"),
    (l[(l.Natural = 1)] = "Natural"),
    (l[(l.Sharp = 2)] = "Sharp"),
    (l[(l.Flat = 3)] = "Flat"),
    (l[(l.NaturalQuarterNoteUp = 4)] = "NaturalQuarterNoteUp"),
    (l[(l.SharpQuarterNoteUp = 5)] = "SharpQuarterNoteUp"),
    (l[(l.FlatQuarterNoteUp = 6)] = "FlatQuarterNoteUp"),
    (l[(l.DoubleSharp = 7)] = "DoubleSharp"),
    (l[(l.DoubleFlat = 8)] = "DoubleFlat"),
    l
  ))(Ir || {});
  var yp = class {
      constructor() {
        this.note = null;
        this.tone = new $l();
        this.octave = 0;
      }
      get realValue() {
        return this.octave * 12 + this.tone.noteValue;
      }
    },
    $l = class {
      constructor(t = 0, e = 0) {
        (this.noteValue = t), (this.accidentalMode = e);
      }
    },
    Ye = class Ye {
      static getIndex(t) {
        return Math.log2(Math.abs(t)) | 0;
      }
      static keySignatureIsFlat(t) {
        return t < 0;
      }
      static keySignatureIsNatural(t) {
        return t === 0;
      }
      static keySignatureIsSharp(t) {
        return t > 0;
      }
      static applyPitchOffsets(t, e) {
        for (let r = 0; r < e.tracks.length; r++) {
          if (r < t.notation.displayTranspositionPitches.length)
            for (let i of e.tracks[r].staves)
              i.displayTranspositionPitch =
                -t.notation.displayTranspositionPitches[r];
          if (r < t.notation.transpositionPitches.length)
            for (let i of e.tracks[r].staves)
              i.transpositionPitch = -t.notation.transpositionPitches[r];
        }
      }
      static isTuning(t) {
        return !!Ye.parseTuning(t);
      }
      static parseTuning(t) {
        let e = "",
          r = "";
        for (let s = 0; s < t.length; s++) {
          let a = t.charCodeAt(s);
          if (a >= 48 && a <= 57) {
            if (!e) return null;
            r += String.fromCharCode(a);
          } else if (e.length === 0)
            if (Ye.tuningLetters.has(a)) e += String.fromCharCode(a);
            else return null;
          else e += String.fromCharCode(a);
        }
        if (!r || !e) return null;
        let i = new yp();
        (i.octave = Number.parseInt(r, 10) + 1), (i.note = e.toLowerCase());
        let n = Ye.getToneForText(i.note);
        return n === null
          ? null
          : ((i.tone = n),
            i.tone.noteValue < 0 && (i.octave--, (i.tone.noteValue += 12)),
            i);
      }
      static getTuningForText(t) {
        let e = Ye.parseTuning(t);
        return e ? e.realValue : -1;
      }
      static getToneForText(t) {
        let e = t.substring(0, 1),
          r = t.substring(1),
          i,
          n;
        switch (e.toLowerCase()) {
          case "c":
            i = 0;
            break;
          case "d":
            i = 2;
            break;
          case "e":
            i = 4;
            break;
          case "f":
            i = 5;
            break;
          case "g":
            i = 7;
            break;
          case "a":
            i = 9;
            break;
          case "b":
            i = 11;
            break;
          default:
            return null;
        }
        if (!Ye.accidentalModeMapping.has(r)) return null;
        switch (((n = Ye.parseAccidentalMode(r)), n)) {
          case 0:
            break;
          case 1:
            break;
          case 2:
            break;
          case 3:
            i++;
            break;
          case 4:
            i += 2;
            break;
          case 5:
            i--;
            break;
          case 6:
            i -= 2;
            break;
        }
        return new $l(i, n);
      }
      static parseAccidentalMode(t) {
        let e = t.toLowerCase();
        return Ye.accidentalModeMapping.has(e)
          ? Ye.accidentalModeMapping.get(e)
          : 0;
      }
      static newGuid() {
        return `${
          Math.floor((1 + Math.random()) * 65536)
            .toString(16)
            .substring(1) +
          Math.floor((1 + Math.random()) * 65536)
            .toString(16)
            .substring(1)
        }-${Math.floor((1 + Math.random()) * 65536)
          .toString(16)
          .substring(1)}-${Math.floor((1 + Math.random()) * 65536)
          .toString(16)
          .substring(1)}-${Math.floor((1 + Math.random()) * 65536)
          .toString(16)
          .substring(1)}-${Math.floor((1 + Math.random()) * 65536)
          .toString(16)
          .substring(1)}${Math.floor((1 + Math.random()) * 65536)
          .toString(16)
          .substring(1)}${Math.floor((1 + Math.random()) * 65536)
          .toString(16)
          .substring(1)}`;
      }
      static isAlmostEqualTo(t, e) {
        return Math.abs(t - e) < 1e-5;
      }
      static toHexString(t, e = 0) {
        let r = "",
          i = "0123456789ABCDEF";
        do (r = String.fromCharCode(i.charCodeAt(t & 15)) + r), (t = t >> 4);
        while (t > 0);
        for (; r.length < e; ) r = `0${r}`;
        return r;
      }
      static getAlternateEndingsList(t) {
        let e = [];
        for (let r = 0; r < ot.MaxAlternateEndings; r++)
          (t & (1 << r)) !== 0 && e.push(r);
        return e;
      }
      static deltaFretToHarmonicValue(t) {
        switch (t) {
          case 2:
            return 2.4;
          case 3:
            return 3.2;
          case 4:
          case 5:
          case 7:
          case 9:
          case 12:
          case 16:
          case 17:
          case 19:
          case 24:
            return t;
          case 8:
            return 8.2;
          case 10:
            return 9.6;
          case 14:
          case 15:
            return 14.7;
          case 21:
          case 22:
            return 21.7;
          default:
            return 12;
        }
      }
      static clamp(t, e, r) {
        return t <= e ? e : t >= r ? r : t;
      }
      static buildMultiBarRestInfo(t, e, r) {
        if (!t) return null;
        let i = t[0].score.stylesheet;
        if (
          !(t.length > 1
            ? i.multiTrackMultiBarRest
            : i.perTrackMultiBarRest?.has(t[0].index) === !0)
        )
          return null;
        let s = new Map(),
          a = t[0].score,
          o = e,
          l = a.tempo;
        for (; o <= r; ) {
          let u = o,
            c = null;
          for (; o <= r; ) {
            let d = a.masterBars[o],
              h = !1;
            for (let b of d.tempoAutomations)
              b.value !== l && (h = !0), (l = b.value);
            if (
              d.alternateEndings ||
              (d.isRepeatStart && d.index !== u) ||
              d.isFreeTime ||
              d.isAnacrusis ||
              d.section !== null ||
              (d.index !== u && h) ||
              (d.fermata !== null && d.fermata.size > 0) ||
              (d.directions !== null && d.directions.size > 0) ||
              (u > e &&
                d.previousMasterBar &&
                (d.timeSignatureCommon !==
                  d.previousMasterBar.timeSignatureCommon ||
                  d.timeSignatureNumerator !==
                    d.previousMasterBar.timeSignatureNumerator ||
                  d.timeSignatureDenominator !==
                    d.previousMasterBar.timeSignatureDenominator ||
                  d.tripletFeel !== d.previousMasterBar.tripletFeel))
            )
              break;
            let f = !0;
            for (let b of t) {
              for (let y of b.staves) {
                let S = y.bars[d.index];
                if (!S.isRestOnly) {
                  f = !1;
                  break;
                }
                if (
                  S.index > 0 &&
                  (S.keySignature !== S.previousBar.keySignature ||
                    S.keySignatureType !== S.previousBar.keySignatureType)
                ) {
                  f = !1;
                  break;
                }
              }
              if (!f) break;
            }
            if (
              !f ||
              (o++,
              d.index > u && (c === null ? (c = [d.index]) : c.push(d.index)),
              d.isRepeatEnd)
            )
              break;
          }
          c ? s.set(u, c) : o++;
        }
        return s;
      }
      static computeFirstDisplayedBarIndex(t, e) {
        let r = e.display.startBar;
        return r--, (r = Math.min(t.masterBars.length - 1, Math.max(0, r))), r;
      }
      static computeLastDisplayedBarIndex(t, e, r) {
        let i = e.display.barCount;
        return (
          i < 0 && (i = t.masterBars.length),
          (i = r + i - 1),
          (i = Math.min(t.masterBars.length - 1, Math.max(0, i))),
          i
        );
      }
      static getOrCreateHeaderFooterStyle(t, e) {
        let r = t.style;
        t.style || ((r = new Jt()), (t.style = r));
        let i;
        if (r.headerAndFooter.has(e)) i = r.headerAndFooter.get(e);
        else {
          if (((i = new ct()), Jt.defaultHeaderAndFooter.has(e))) {
            let n = Jt.defaultHeaderAndFooter.get(e);
            (i.template = n.template), (i.textAlign = n.textAlign);
          }
          r.headerAndFooter.set(e, i);
        }
        return i;
      }
      static consolidate(t) {
        if (t.masterBars.length === 0) {
          let r = new ot();
          t.addMasterBar(r);
          let i = new he();
          (i.isLinear = !1),
            (i.type = 0),
            (i.value = t.tempo),
            r.tempoAutomations.push(i);
          let n = new at();
          t.tracks[0].staves[0].addBar(n);
          let s = new ze();
          n.addVoice(s);
          let a = new Me();
          (a.isEmpty = !0), s.addBeat(a);
          return;
        }
        let e = new Set([Q.PercussionChannel]);
        for (let r of t.tracks) {
          if (r.staves.length === 1 && r.staves[0].isPercussion)
            (r.playbackInfo.primaryChannel = Q.PercussionChannel),
              (r.playbackInfo.secondaryChannel = Q.PercussionChannel);
          else {
            if (r.playbackInfo.primaryChannel !== Q.PercussionChannel)
              for (; e.has(r.playbackInfo.primaryChannel); )
                r.playbackInfo.primaryChannel++;
            if (
              (e.add(r.playbackInfo.primaryChannel),
              r.playbackInfo.secondaryChannel !== Q.PercussionChannel)
            )
              for (; e.has(r.playbackInfo.secondaryChannel); )
                r.playbackInfo.secondaryChannel++;
            e.add(r.playbackInfo.secondaryChannel);
          }
          for (let i of r.staves) {
            for (let s of i.bars)
              for (let a of s.voices)
                if (a.isEmpty && a.beats.length === 0) {
                  let o = new Me();
                  (o.isEmpty = !0), a.addBeat(o);
                }
            let n = i.bars.length === 0 ? 1 : i.bars[0].voices.length;
            for (; i.bars.length < t.masterBars.length; ) {
              let s = new at();
              i.addBar(s);
              let a = s.previousBar;
              a &&
                ((s.clef = a.clef),
                (s.clefOttava = a.clefOttava),
                (s.keySignature = s.previousBar.keySignature),
                (s.keySignatureType = s.previousBar.keySignatureType));
              for (let o = 0; o < n; o++) {
                let l = new ze();
                s.addVoice(l);
                let u = new Me();
                (u.isEmpty = !0), l.addBeat(u);
              }
            }
          }
        }
        if (
          t.masterBars.length > 0 &&
          !t.masterBars[0].tempoAutomations.find(
            (i) => i.type === 0 && i.ratioPosition === 0
          )
        ) {
          let i = new he();
          (i.isLinear = !1),
            (i.type = 0),
            (i.value = t.tempo),
            (i.text = t.tempoLabel),
            (i.isVisible = !1),
            t.masterBars[0].tempoAutomations.push(i);
        }
      }
      static trimEmptyBarsAtEnd(t) {
        for (; t.masterBars.length > 1; ) {
          let e = t.masterBars.length - 1,
            r = t.masterBars[e];
          if (r.hasChanges) return;
          for (let i of t.tracks)
            for (let n of i.staves)
              if (e < n.bars.length) {
                let s = n.bars[e];
                if (!s.isEmpty || s.hasChanges) return;
              }
          for (let i of t.tracks)
            for (let n of i.staves)
              if (e < n.bars.length) {
                let s = n.bars[e];
                n.bars.pop(), (s.previousBar.nextBar = null);
              }
          t.masterBars.pop(), (r.previousMasterBar.nextMasterBar = null);
        }
      }
      static getAllMusicFontSymbols() {
        return (
          Ye._allMusicFontSymbols.length === 0 &&
            (Ye._allMusicFontSymbols = Object.values(K)
              .filter((t) => typeof t == "number")
              .map((t) => t)),
          Ye._allMusicFontSymbols
        );
      }
      static flooredDivision(t, e) {
        return t - e * Math.floor(t / e);
      }
      static _translateKeyTransposeTable(t) {
        let e = [];
        for (let r of t) {
          let i = [];
          e.push(i);
          for (let n of r) {
            let s =
              Number.parseInt(n.charAt(0), 10) * (n.charAt(1) === "b" ? -1 : 1);
            i.push(s);
          }
        }
        return e;
      }
      static transposeKey(t, e) {
        if (e === 0) return t;
        if (e < 0) {
          let i = Ye._keyTransposeTable[-e].indexOf(t);
          return i === -1 ? t : i - 7;
        } else return Ye._keyTransposeTable[e][t + 7];
      }
      static computeAccidental(t, e, r, i, n = null) {
        let a = t + 7,
          o = r % 12,
          l = a < 7 ? 3 : 2,
          u = Ye._keySignatureLookup[a][o],
          c = Ye.accidentalNotes[o],
          d = 0;
        if (i)
          switch (((d = c ? l : 1), d)) {
            case 1:
              d = 4;
              break;
            case 2:
              d = 5;
              break;
            case 3:
              d = 6;
              break;
          }
        else {
          switch (e) {
            case 3:
              d = 2;
              break;
            case 4:
              d = 7;
              break;
            case 5:
              d = 3;
              break;
            case 6:
              d = 8;
              break;
            default:
              c ? (d = l) : u && (d = 1);
              break;
          }
          d !== 0
            ? n != null
              ? n === d && (d = 0)
              : u && d === l && (d = 0)
            : n !== null && (n === 1 ? (d = 0) : (d = 1));
        }
        return d;
      }
      static toArticulationId(t) {
        return t.replace(/[^a-zA-Z0-9]/g, "").toLowerCase();
      }
    };
  (Ye.tuningLetters = new Set([
    67, 68, 69, 70, 71, 65, 66, 99, 100, 101, 102, 103, 97, 98, 35,
  ])),
    (Ye.reverseAccidentalModeMapping = new Map([
      [0, "d"],
      [1, "forcenone"],
      [2, "forcenatural"],
      [3, "#"],
      [4, "x"],
      [5, "b"],
      [6, "bb"],
    ])),
    (Ye.accidentalModeMapping = new Map([
      ["default", 0],
      ["d", 0],
      ["", 0],
      ["forcenone", 1],
      ["-", 1],
      ["forcenatural", 2],
      ["n", 2],
      ["forcesharp", 3],
      ["#", 3],
      ["forcedoublesharp", 4],
      ["##", 4],
      ["x", 4],
      ["forceflat", 5],
      ["b", 5],
      ["forcedoubleflat", 6],
      ["bb", 6],
    ])),
    (Ye._allMusicFontSymbols = []),
    (Ye.displayTranspositionPitches = new Map([
      [24, -12],
      [25, -12],
      [26, -12],
      [27, -12],
      [28, -12],
      [29, -12],
      [30, -12],
      [31, -12],
      [32, -12],
      [33, -12],
      [34, -12],
      [35, -12],
      [36, -12],
      [37, -12],
      [38, -12],
      [39, -12],
      [43, -12],
    ])),
    (Ye._keyTransposeTable = Ye._translateKeyTransposeTable([
      [
        "7b",
        "6b",
        "5b",
        "4b",
        "3b",
        "2b",
        "1b",
        "0#",
        "1#",
        "2#",
        "3#",
        "4#",
        "5#",
        "6#",
        "7#",
      ],
      [
        "2b",
        "1b",
        "0#",
        "1#",
        "2#",
        "3#",
        "4#",
        "5#",
        "6#",
        "7#",
        "4b",
        "3b",
        "2b",
        "1b",
        "0#",
      ],
      [
        "3#",
        "4#",
        "7b",
        "6b",
        "5b",
        "4b",
        "3b",
        "2b",
        "1b",
        "0#",
        "1#",
        "2#",
        "3#",
        "4#",
        "5#",
      ],
      [
        "4b",
        "3b",
        "2b",
        "1b",
        "0#",
        "1#",
        "2#",
        "3#",
        "4#",
        "5#",
        "6#",
        "7#",
        "4b",
        "3b",
        "2b",
      ],
      [
        "1#",
        "2#",
        "3#",
        "4#",
        "7b",
        "6b",
        "5b",
        "4b",
        "3b",
        "2b",
        "1b",
        "0#",
        "1#",
        "2#",
        "3#",
      ],
      [
        "6b",
        "5b",
        "4b",
        "3b",
        "2b",
        "1b",
        "0#",
        "1#",
        "2#",
        "3#",
        "4#",
        "5#",
        "6#",
        "7#",
        "4b",
      ],
      [
        "1b",
        "0#",
        "1#",
        "2#",
        "3#",
        "4#",
        "7b",
        "6#",
        "7#",
        "4b",
        "3b",
        "2b",
        "1b",
        "0#",
        "1#",
      ],
      [
        "4#",
        "7b",
        "6b",
        "5b",
        "4b",
        "3b",
        "2b",
        "1b",
        "0#",
        "1#",
        "2#",
        "3#",
        "4#",
        "5#",
        "6#",
      ],
      [
        "3b",
        "2b",
        "1b",
        "0#",
        "1#",
        "2#",
        "3#",
        "4#",
        "5#",
        "6#",
        "7#",
        "4b",
        "3b",
        "2b",
        "1b",
      ],
      [
        "2#",
        "3#",
        "4#",
        "7b",
        "6b",
        "5b",
        "4b",
        "3b",
        "2b",
        "1b",
        "0#",
        "1#",
        "2#",
        "3#",
        "4#",
      ],
      [
        "5b",
        "4b",
        "3b",
        "2b",
        "1b",
        "0#",
        "1#",
        "2#",
        "3#",
        "4#",
        "5#",
        "6#",
        "7#",
        "4b",
        "3b",
      ],
      [
        "0#",
        "1#",
        "2#",
        "3#",
        "4#",
        "7b",
        "6b",
        "6#",
        "4b",
        "3b",
        "2b",
        "1b",
        "0#",
        "1#",
        "2#",
      ],
    ])),
    (Ye._keySignatureLookup = [
      [!0, !0, !0, !0, !0, !0, !0, !0, !0, !0, !0, !0],
      [!0, !0, !0, !0, !0, !1, !0, !0, !0, !0, !0, !0],
      [!1, !0, !0, !0, !0, !1, !0, !0, !0, !0, !0, !0],
      [!1, !0, !0, !0, !0, !1, !1, !1, !0, !0, !0, !0],
      [!1, !1, !1, !0, !0, !1, !1, !1, !0, !0, !0, !0],
      [!1, !1, !1, !0, !0, !1, !1, !1, !1, !1, !0, !0],
      [!1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !0, !0],
      [!1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1],
      [!1, !1, !1, !1, !1, !0, !0, !1, !1, !1, !1, !1],
      [!0, !0, !1, !1, !1, !0, !0, !1, !1, !1, !1, !1],
      [!0, !0, !1, !1, !1, !0, !0, !0, !0, !1, !1, !1],
      [!0, !0, !0, !0, !1, !0, !0, !0, !0, !1, !1, !1],
      [!0, !0, !0, !0, !1, !0, !0, !0, !0, !0, !0, !1],
      [!0, !0, !0, !0, !0, !0, !0, !0, !0, !0, !0, !1],
      [!0, !0, !0, !0, !0, !0, !0, !0, !0, !0, !0, !0],
    ]),
    (Ye.accidentalNotes = [!1, !0, !1, !0, !1, !1, !0, !1, !0, !1, !0, !1]);
  var A = Ye;
  var dr = ((r) => (
    (r[(r.None = 0)] = "None"),
    (r[(r.Up = 1)] = "Up"),
    (r[(r.Down = 2)] = "Down"),
    r
  ))(dr || {});
  var xi = ((i) => (
      (i[(i.Above = 0)] = "Above"),
      (i[(i.Inside = 1)] = "Inside"),
      (i[(i.Below = 2)] = "Below"),
      (i[(i.Outside = 3)] = "Outside"),
      i
    ))(xi || {}),
    W = class {
      constructor(t = "", e = 0, r = 0, i = -1, n = -1, s = -1, a = -1, o = 1) {
        (this.elementType = t),
          (this.outputMidiNumber = r),
          (this.staffLine = e),
          (this.noteHeadDefault = i),
          (this.noteHeadHalf = n !== -1 ? n : i),
          (this.noteHeadWhole = s !== -1 ? s : i),
          (this.techniqueSymbol = a),
          (this.techniqueSymbolPlacement = o);
      }
      getSymbol(t) {
        switch (t) {
          case 1:
            return this.noteHeadWhole;
          case 2:
            return this.noteHeadHalf;
          default:
            return this.noteHeadDefault;
        }
      }
    };
  var Mt = class Mt {
    static articulationFromElementVariation(t, e) {
      return t < Mt._gp6ElementAndVariationToArticulation.length
        ? (e >= Mt._gp6ElementAndVariationToArticulation.length && (e = 0),
          Mt._gp6ElementAndVariationToArticulation[t][e])
        : 38;
    }
    static getArticulationName(t) {
      let e = Mt.getArticulation(t),
        r = t.percussionArticulation;
      e && (r = e.outputMidiNumber);
      for (let [i, n] of Mt.instrumentArticulationNames) if (n === r) return i;
      return "unknown";
    }
    static getArticulation(t) {
      let e = t.percussionArticulation;
      if (e < 0) return null;
      let r = t.beat.voice.bar.staff.track.percussionArticulations;
      return e < r.length ? r[e] : Mt.getArticulationByInputMidiNumber(e);
    }
    static getElementAndVariation(t) {
      let e = Mt.getArticulation(t);
      if (!e) return [-1, -1];
      for (
        let r = 0;
        r < Mt._gp6ElementAndVariationToArticulation.length;
        r++
      ) {
        let i = Mt._gp6ElementAndVariationToArticulation[r];
        for (let n = 0; n < i.length; n++)
          if (
            Mt.getArticulationByInputMidiNumber(i[n])?.outputMidiNumber ===
            e.outputMidiNumber
          )
            return [r, n];
      }
      return [-1, -1];
    }
    static getArticulationByInputMidiNumber(t) {
      return Mt.instrumentArticulations.has(t)
        ? Mt.instrumentArticulations.get(t)
        : null;
    }
  };
  (Mt._gp6ElementAndVariationToArticulation = [
    [35, 35, 35],
    [38, 91, 37],
    [99, 100, 99],
    [56, 100, 56],
    [102, 103, 102],
    [43, 43, 43],
    [45, 45, 45],
    [47, 47, 47],
    [48, 48, 48],
    [50, 50, 50],
    [42, 92, 46],
    [44, 44, 44],
    [57, 98, 57],
    [49, 97, 49],
    [55, 95, 55],
    [51, 93, 127],
    [52, 96, 52],
  ]),
    (Mt.instrumentArticulations = new Map([
      [38, new W("snare", 3, 38, 57508, 57507, 57506)],
      [37, new W("snare", 3, 37, 57513, 57513, 57513)],
      [91, new W("snare", 3, 38, 57565, 57565, 57565)],
      [42, new W("hiHat", -1, 42, 57513, 57513, 57513)],
      [92, new W("hiHat", -1, 46, 57591, 57591, 57591)],
      [46, new W("hiHat", -1, 46, 57523, 57523, 57523)],
      [44, new W("hiHat", 9, 44, 57513, 57513, 57513)],
      [35, new W("kickDrum", 8, 35, 57508, 57507, 57506)],
      [36, new W("kickDrum", 7, 36, 57508, 57507, 57506)],
      [50, new W("tom", 1, 50, 57508, 57507, 57506)],
      [48, new W("tom", 2, 48, 57508, 57507, 57506)],
      [47, new W("tom", 4, 47, 57508, 57507, 57506)],
      [45, new W("tom", 5, 45, 57508, 57507, 57506)],
      [43, new W("tom", 6, 43, 57508, 57507, 57506)],
      [93, new W("ride", 0, 51, 57513, 57513, 57513, 59177, 2)],
      [51, new W("ride", 0, 51, 57513, 57513, 57513)],
      [53, new W("ride", 0, 53, 57565, 57565, 57565)],
      [94, new W("ride", 0, 51, 57513, 57513, 57513, 58530, 0)],
      [55, new W("splash", -2, 55, 57513, 57513, 57513)],
      [95, new W("splash", -2, 55, 57513, 57513, 57513, 58530, 2)],
      [52, new W("china", -3, 52, 57593, 57593, 57593)],
      [96, new W("china", -3, 52, 57593, 57593, 57593)],
      [49, new W("crash", -2, 49, 57592, 57592, 57592)],
      [97, new W("crash", -2, 49, 57592, 57592, 57592, 58530, 2)],
      [57, new W("crash", -1, 57, 57592, 57592, 57592)],
      [98, new W("crash", -1, 57, 57592, 57592, 57592, 58530, 2)],
      [99, new W("cowbell", 1, 56, 57534, 57532, 57531)],
      [100, new W("cowbell", 1, 56, 57513, 57512, 57511)],
      [56, new W("cowbell", 0, 56, 57534, 57532, 57531)],
      [101, new W("cowbell", 0, 56, 57513, 57512, 57511)],
      [102, new W("cowbell", -1, 56, 57534, 57532, 57531)],
      [103, new W("cowbell", -1, 56, 57513, 57512, 57511)],
      [77, new W("woodblock", -9, 77, 57534, 57534, 57534)],
      [76, new W("woodblock", -10, 76, 57534, 57534, 57534)],
      [60, new W("bongo", -4, 60, 57508, 57507, 57506)],
      [104, new W("bongo", -5, 60, 57508, 57507, 57506, 57550, 1)],
      [105, new W("bongo", -6, 60, 57513, 57513, 57513)],
      [61, new W("bongo", -7, 61, 57508, 57507, 57506)],
      [106, new W("bongo", -8, 61, 57508, 57507, 57506, 57550, 1)],
      [107, new W("bongo", -16, 61, 57513, 57513, 57513)],
      [66, new W("timbale", 10, 66, 57508, 57507, 57506)],
      [65, new W("timbale", 9, 65, 57508, 57507, 57506)],
      [68, new W("agogo", 12, 68, 57508, 57507, 57506)],
      [67, new W("agogo", 11, 67, 57508, 57507, 57506)],
      [64, new W("conga", 17, 64, 57508, 57507, 57506)],
      [108, new W("conga", 16, 64, 57513, 57513, 57513)],
      [109, new W("conga", 15, 64, 57508, 57507, 57506, 57550, 1)],
      [63, new W("conga", 14, 63, 57508, 57507, 57506)],
      [110, new W("conga", 13, 63, 57513, 57513, 57513)],
      [62, new W("conga", 19, 62, 57508, 57507, 57506, 57550, 1)],
      [72, new W("whistle", -11, 72, 57508, 57507, 57506)],
      [71, new W("whistle", -17, 71, 57508, 57507, 57506)],
      [73, new W("guiro", 38, 73, 57508, 57507, 57506)],
      [74, new W("guiro", 37, 74, 57508, 57507, 57506)],
      [86, new W("surdo", 36, 86, 57508, 57507, 57506)],
      [87, new W("surdo", 35, 87, 57513, 57513, 57513, 57550, 1)],
      [54, new W("tambourine", 3, 54, 57534, 57534, 57534)],
      [111, new W("tambourine", 2, 54, 57534, 57534, 57534, 58898, 2)],
      [112, new W("tambourine", 1, 54, 57534, 57534, 57534, 58896, 2)],
      [113, new W("tambourine", -7, 54, 57513, 57513, 57513)],
      [79, new W("cuica", 30, 79, 57508, 57507, 57506)],
      [78, new W("cuica", 29, 78, 57513, 57513, 57513)],
      [58, new W("vibraslap", 28, 58, 57508, 57507, 57506)],
      [81, new W("triangle", 27, 81, 57508, 57507, 57506)],
      [80, new W("triangle", 26, 80, 57513, 57513, 57513, 57550, 1)],
      [114, new W("grancassa", 25, 43, 57508, 57507, 57506)],
      [115, new W("piatti", 18, 49, 57508, 57507, 57506)],
      [116, new W("piatti", 24, 49, 57513, 57513, 57513)],
      [69, new W("cabasa", 23, 69, 57508, 57507, 57506)],
      [117, new W("cabasa", 22, 69, 57508, 57507, 57506, 58898, 2)],
      [85, new W("castanets", 21, 85, 57508, 57507, 57506)],
      [75, new W("claves", 20, 75, 57508, 57507, 57506)],
      [70, new W("maraca", -12, 70, 57508, 57507, 57506)],
      [118, new W("maraca", -13, 70, 57508, 57507, 57506, 58898, 2)],
      [119, new W("maraca", -14, 70, 57508, 57507, 57506)],
      [120, new W("maraca", -15, 70, 57508, 57507, 57506, 58898, 2)],
      [82, new W("shaker", -23, 54, 57508, 57507, 57506)],
      [122, new W("shaker", -24, 54, 57508, 57507, 57506, 58898, 2)],
      [84, new W("bellTree", -18, 53, 57508, 57507, 57506)],
      [123, new W("bellTree", -19, 53, 57508, 57507, 57506, 58898, 2)],
      [83, new W("jingleBell", -20, 53, 57508, 57507, 57506)],
      [124, new W("unpitched", -21, 62, 57509, 57509, 57509, 59458, 0)],
      [125, new W("unpitched", -22, 62, 57509, 57509, 57509, 59458, 2)],
      [39, new W("handClap", 3, 39, 57508, 57507, 57506)],
      [40, new W("snare", 3, 40, 57508, 57507, 57506)],
      [31, new W("snare", 3, 40, 57552, 57552, 57552)],
      [41, new W("tom", 5, 41, 57508, 57507, 57506)],
      [59, new W("ride", 2, 59, 57513, 57513, 57513, 59177, 2)],
      [126, new W("ride", 2, 59, 57513, 57513, 57513)],
      [127, new W("ride", 2, 59, 57565, 57565, 57565)],
      [29, new W("ride", 2, 59, 57513, 57513, 57513, 58530, 0)],
      [30, new W("crash", -3, 49, 57513, 57513, 57513)],
      [33, new W("snare", 3, 37, 57513, 57513, 57513)],
      [34, new W("snare", 3, 38, 57508, 57508, 57508)],
    ])),
    (Mt.instrumentArticulationNames = new Map([
      ["Ride (choke)", 29],
      ["Cymbal (hit)", 30],
      ["Snare (side stick)", 31],
      ["Snare (side stick) 2", 33],
      ["Snare (hit)", 34],
      ["Kick (hit)", 35],
      ["Kick (hit) 2", 36],
      ["Snare (side stick) 3", 37],
      ["Snare (hit) 2", 38],
      ["Hand Clap (hit)", 39],
      ["Snare (hit) 3", 40],
      ["Low Floor Tom (hit)", 41],
      ["Hi-Hat (closed)", 42],
      ["Very Low Tom (hit)", 43],
      ["Pedal Hi-Hat (hit)", 44],
      ["Low Tom (hit)", 45],
      ["Hi-Hat (open)", 46],
      ["Mid Tom (hit)", 47],
      ["High Tom (hit)", 48],
      ["Crash high (hit)", 49],
      ["High Floor Tom (hit)", 50],
      ["Ride (middle)", 51],
      ["China (hit)", 52],
      ["Ride (bell)", 53],
      ["Tambourine (hit)", 54],
      ["Splash (hit)", 55],
      ["Cowbell medium (hit)", 56],
      ["Crash medium (hit)", 57],
      ["Vibraslap (hit)", 58],
      ["Ride (edge)", 59],
      ["Hand (hit)", 60],
      ["Hand (hit)", 61],
      ["Bongo high (hit)", 60],
      ["Bongo low (hit)", 61],
      ["Conga high (mute)", 62],
      ["Conga high (hit)", 63],
      ["Conga low (hit)", 64],
      ["Timbale high (hit)", 65],
      ["Timbale low (hit)", 66],
      ["Agogo high (hit)", 67],
      ["Agogo tow (hit)", 68],
      ["Cabasa (hit)", 69],
      ["Left Maraca (hit)", 70],
      ["Whistle high (hit)", 71],
      ["Whistle low (hit)", 72],
      ["Guiro (hit)", 73],
      ["Guiro (scrap-return)", 74],
      ["Claves (hit)", 75],
      ["Woodblock high (hit)", 76],
      ["Woodblock low (hit)", 77],
      ["Cuica (mute)", 78],
      ["Cuica (open)", 79],
      ["Triangle (rnute)", 80],
      ["Triangle (hit)", 81],
      ["Shaker (hit)", 82],
      ["Tinkle Bell (hat)", 83],
      ["Jingle Bell (hit)", 83],
      ["Bell Tree (hit)", 84],
      ["Castanets (hit)", 85],
      ["Surdo (hit)", 86],
      ["Surdo (mute)", 87],
      ["Snare (rim shot)", 91],
      ["Hi-Hat (half)", 92],
      ["Ride (edge) 2", 93],
      ["Ride (choke) 2", 94],
      ["Splash (choke)", 95],
      ["China (choke)", 96],
      ["Crash high (choke)", 97],
      ["Crash medium (choke)", 98],
      ["Cowbell low (hit)", 99],
      ["Cowbell low (tip)", 100],
      ["Cowbell medium (tip)", 101],
      ["Cowbell high (hit)", 102],
      ["Cowbell high (tip)", 103],
      ["Hand (mute)", 104],
      ["Hand (slap)", 105],
      ["Hand (mute) 2", 106],
      ["Hand (slap) 2", 107],
      ["Conga low (slap)", 108],
      ["Conga low (mute)", 109],
      ["Conga high (slap)", 110],
      ["Tambourine (return)", 111],
      ["Tambourine (roll)", 112],
      ["Tambourine (hand)", 113],
      ["Grancassa (hit)", 114],
      ["Piatti (hat)", 115],
      ["Piatti (hand)", 116],
      ["Cabasa (return)", 117],
      ["Left Maraca (return)", 118],
      ["Right Maraca (hit)", 119],
      ["Right Maraca (return)", 120],
      ["Shaker (return)", 122],
      ["Bell Tee (return)", 123],
      ["Golpe (thumb)", 124],
      ["Golpe (finger)", 125],
      ["Ride (middle) 2", 126],
      ["Ride (bell) 2", 127],
    ]));
  var He = Mt;
  var Br = ((n) => (
    (n[(n.None = 0)] = "None"),
    (n[(n.InvertedTurn = 1)] = "InvertedTurn"),
    (n[(n.Turn = 2)] = "Turn"),
    (n[(n.UpperMordent = 3)] = "UpperMordent"),
    (n[(n.LowerMordent = 4)] = "LowerMordent"),
    n
  ))(Br || {});
  var wi = class {
      constructor() {
        this.tieDestinationNoteId = -1;
        this.tieOriginNoteId = -1;
        this.slurDestinationNoteId = -1;
        this.slurOriginNoteId = -1;
        this.hammerPullDestinationNoteId = -1;
        this.hammerPullOriginNoteId = -1;
        this.slideTargetNoteId = -1;
        this.slideOriginNoteId = -1;
      }
    },
    qt = ((c) => (
      (c[(c.Effects = 0)] = "Effects"),
      (c[(c.StandardNotationNoteHead = 1)] = "StandardNotationNoteHead"),
      (c[(c.StandardNotationAccidentals = 2)] = "StandardNotationAccidentals"),
      (c[(c.StandardNotationEffects = 3)] = "StandardNotationEffects"),
      (c[(c.GuitarTabFretNumber = 4)] = "GuitarTabFretNumber"),
      (c[(c.GuitarTabEffects = 5)] = "GuitarTabEffects"),
      (c[(c.SlashNoteHead = 6)] = "SlashNoteHead"),
      (c[(c.SlashEffects = 7)] = "SlashEffects"),
      (c[(c.NumberedNumber = 8)] = "NumberedNumber"),
      (c[(c.NumberedAccidentals = 9)] = "NumberedAccidentals"),
      (c[(c.NumberedEffects = 10)] = "NumberedEffects"),
      c
    ))(qt || {}),
    cn = class extends zt {},
    It = class It {
      constructor() {
        this.id = It.globalNoteId++;
        this.index = 0;
        this.accentuated = 0;
        this.bendType = 0;
        this.bendStyle = 0;
        this.bendOrigin = null;
        this.isContinuedBend = !1;
        this.bendPoints = null;
        this.maxBendPoint = null;
        this.fret = -1;
        this.string = -1;
        this.showStringNumber = !1;
        this.octave = -1;
        this.tone = -1;
        this.percussionArticulation = -1;
        this.isVisible = !0;
        this.isLeftHandTapped = !1;
        this.isHammerPullOrigin = !1;
        this.hammerPullOrigin = null;
        this.hammerPullDestination = null;
        this.isSlurDestination = !1;
        this.slurOrigin = null;
        this.slurDestination = null;
        this.harmonicType = 0;
        this.harmonicValue = 0;
        this.isGhost = !1;
        this.isLetRing = !1;
        this.letRingDestination = null;
        this.isPalmMute = !1;
        this.palmMuteDestination = null;
        this.isDead = !1;
        this.isDeadVisual = !1;
        this.isStaccato = !1;
        this.slideInType = 0;
        this.slideOutType = 0;
        this.slideTarget = null;
        this.slideOrigin = null;
        this.vibrato = 0;
        this.tieOrigin = null;
        this.tieDestination = null;
        this.isTieDestination = !1;
        this.leftHandFinger = -2;
        this.rightHandFinger = -2;
        this.trillValue = -1;
        this.trillSpeed = 32;
        this.durationPercent = 1;
        this.accidentalMode = 0;
        this.dynamics = 5;
        this.isEffectSlurOrigin = !1;
        this.hasEffectSlur = !1;
        this.effectSlurOrigin = null;
        this.effectSlurDestination = null;
        this.ornament = 0;
        this._noteIdBag = null;
      }
      static resetIds() {
        It.globalNoteId = 0;
      }
      get hasBend() {
        return this.bendPoints !== null && this.bendType !== 0;
      }
      get isStringed() {
        return this.string >= 0;
      }
      get isPiano() {
        return !this.isStringed && this.octave >= 0 && this.tone >= 0;
      }
      get isPercussion() {
        return !this.isStringed && this.percussionArticulation >= 0;
      }
      get element() {
        return this.isPercussion ? He.getElementAndVariation(this)[0] : -1;
      }
      get variation() {
        return this.isPercussion ? He.getElementAndVariation(this)[1] : -1;
      }
      get isHammerPullDestination() {
        return !!this.hammerPullOrigin;
      }
      get isSlurOrigin() {
        return !!this.slurDestination;
      }
      get isHarmonic() {
        return this.harmonicType !== 0;
      }
      get isTieOrigin() {
        return this.tieDestination !== null;
      }
      get isFingering() {
        return this.leftHandFinger !== -2 || this.rightHandFinger !== -2;
      }
      get trillFret() {
        return this.trillValue - this.stringTuning;
      }
      get isTrill() {
        return this.trillValue >= 0;
      }
      get isEffectSlurDestination() {
        return !!this.effectSlurOrigin;
      }
      get stringTuning() {
        return (
          this.beat.voice.bar.staff.capo +
          It.getStringTuning(this.beat.voice.bar.staff, this.string)
        );
      }
      static getStringTuning(t, e) {
        return t.tuning.length > 0
          ? t.tuning[t.tuning.length - (e - 1) - 1]
          : 0;
      }
      get realValue() {
        return this.calculateRealValue(!0, !0);
      }
      get realValueWithoutHarmonic() {
        return this.calculateRealValue(!0, !1);
      }
      calculateRealValue(t, e) {
        let r = t ? this.beat.voice.bar.staff.transpositionPitch : 0;
        if (e) {
          let i = this.calculateRealValue(t, !1);
          return (
            this.isStringed &&
              (this.harmonicType === 1
                ? (i = this.harmonicPitch + this.stringTuning - r)
                : (i += this.harmonicPitch)),
            i
          );
        }
        return this.isPercussion
          ? this.percussionArticulation
          : this.isStringed
          ? this.fret + this.stringTuning - r
          : this.isPiano
          ? this.octave * 12 + this.tone - r
          : 0;
      }
      get harmonicPitch() {
        if (this.harmonicType === 0 || !this.isStringed) return 0;
        let t = this.harmonicValue;
        return A.isAlmostEqualTo(t, 2.4)
          ? 36
          : A.isAlmostEqualTo(t, 2.7)
          ? 34
          : t < 3
          ? 0
          : t <= 3.5
          ? 31
          : t <= 4
          ? 28
          : t <= 5
          ? 24
          : t <= 6
          ? 34
          : t <= 7
          ? 19
          : t <= 8.5
          ? 36
          : t <= 9
          ? 28
          : t <= 10
          ? 34
          : t <= 11
          ? 0
          : t <= 12
          ? 12
          : t < 14
          ? 0
          : t <= 15
          ? 34
          : t <= 16
          ? 28
          : t <= 17
          ? 36
          : t <= 18
          ? 0
          : t <= 19
          ? 19
          : t <= 21
          ? 0
          : t <= 22
          ? 36
          : t <= 24
          ? 24
          : 0;
      }
      get initialBendValue() {
        return this.hasBend
          ? Math.floor(this.bendPoints[0].value / 2)
          : this.bendOrigin
          ? Math.floor(
              this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length - 1]
                .value / 2
            )
          : this.isTieDestination && this.tieOrigin.bendOrigin
          ? Math.floor(
              this.tieOrigin.bendOrigin.bendPoints[
                this.tieOrigin.bendOrigin.bendPoints.length - 1
              ].value / 2
            )
          : this.beat.hasWhammyBar
          ? Math.floor(this.beat.whammyBarPoints[0].value / 2)
          : this.beat.isContinuedWhammy
          ? Math.floor(
              this.beat.previousBeat.whammyBarPoints[
                this.beat.previousBeat.whammyBarPoints.length - 1
              ].value / 2
            )
          : 0;
      }
      get displayValue() {
        return this.displayValueWithoutBend + this.initialBendValue;
      }
      get displayValueWithoutBend() {
        let t = this.realValue;
        switch (
          (this.harmonicType !== 1 &&
            this.harmonicType !== 0 &&
            (t -= this.harmonicPitch),
          this.beat.ottava)
        ) {
          case 0:
            t -= 24;
            break;
          case 1:
            t -= 12;
            break;
          case 2:
            break;
          case 3:
            t += 12;
            break;
          case 4:
            t += 24;
            break;
        }
        switch (this.beat.voice.bar.clefOttava) {
          case 0:
            t -= 24;
            break;
          case 1:
            t -= 12;
            break;
          case 2:
            break;
          case 3:
            t += 12;
            break;
          case 4:
            t += 24;
            break;
        }
        return t - this.beat.voice.bar.staff.displayTranspositionPitch;
      }
      get hasQuarterToneOffset() {
        return this.hasBend
          ? this.bendPoints[0].value % 2 !== 0
          : this.bendOrigin
          ? this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length - 1]
              .value %
              2 !==
            0
          : this.beat.hasWhammyBar
          ? this.beat.whammyBarPoints[0].value % 2 !== 0
          : this.beat.isContinuedWhammy
          ? this.beat.previousBeat.whammyBarPoints[
              this.beat.previousBeat.whammyBarPoints.length - 1
            ].value %
              2 !==
            0
          : !1;
      }
      addBendPoint(t) {
        let e = this.bendPoints;
        e === null && ((e = []), (this.bendPoints = e)),
          e.push(t),
          (!this.maxBendPoint || t.value > this.maxBendPoint.value) &&
            (this.maxBendPoint = t),
          this.bendType === 0 && (this.bendType = 1);
      }
      finish(t, e = null) {
        let r = new Cr(() => It.nextNoteOnSameLine(this)),
          i = t && t.notation.notationMode === 1;
        if (
          (this.isTieDestination &&
            (this.chain(e),
            i &&
              this.tieOrigin &&
              this.tieOrigin.isLetRing &&
              (this.isLetRing = !0)),
          this.isLetRing &&
            (!r.value || !r.value.isLetRing
              ? (this.letRingDestination = this)
              : (this.letRingDestination = r.value),
            i &&
              this.isTieDestination &&
              !this.tieOrigin.hasBend &&
              (this.isVisible = !1)),
          this.isPalmMute &&
            (!r.value || !r.value.isPalmMute
              ? (this.palmMuteDestination = this)
              : (this.palmMuteDestination = r.value)),
          this.isHammerPullOrigin)
        ) {
          let o = It.findHammerPullDestination(this);
          o
            ? ((this.hammerPullDestination = o), (o.hammerPullOrigin = this))
            : (this.isHammerPullOrigin = !1);
        }
        switch (this.slideOutType) {
          case 1:
          case 2:
            this.slideTarget || (this.slideTarget = r.value),
              this.slideTarget
                ? (this.slideTarget.slideOrigin = this)
                : (this.slideOutType = 0);
            break;
        }
        let n = null;
        this.isHammerPullOrigin && this.hammerPullDestination
          ? (n = this.hammerPullDestination)
          : this.slideOutType === 2 &&
            this.slideTarget &&
            (n = this.slideTarget),
          n &&
            ((this.hasEffectSlur = !0),
            this.effectSlurOrigin && this.beat.pickStroke === 0
              ? ((this.effectSlurOrigin.effectSlurDestination = n),
                (this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin =
                  this.effectSlurOrigin),
                (this.effectSlurOrigin = null))
              : ((this.isEffectSlurOrigin = !0),
                (this.effectSlurDestination = n),
                (this.effectSlurDestination.effectSlurOrigin = this)));
        let s = this.bendPoints,
          a = s != null && s.length > 0;
        if (a) {
          let o = this.isTieDestination && this.tieOrigin.hasBend;
          this.isContinuedBend = o;
        } else this.bendType = 0;
        if (a && this.bendType === 1) {
          if (s.length === 4) {
            let o = s[0],
              l = s[1],
              u = s[2],
              c = s[3];
            l.value === u.value
              ? c.value > o.value
                ? l.value > c.value
                  ? (this.bendType = 4)
                  : !this.isContinuedBend && o.value > 0
                  ? ((this.bendType = 7), s.splice(2, 1), s.splice(1, 1))
                  : ((this.bendType = 2), s.splice(2, 1), s.splice(1, 1))
                : c.value < o.value
                ? this.isContinuedBend
                  ? ((this.bendType = 3), s.splice(2, 1), s.splice(1, 1))
                  : ((this.bendType = 8), s.splice(2, 1), s.splice(1, 1))
                : l.value > o.value
                ? (this.bendType = 4)
                : o.value > 0 && !this.isContinuedBend
                ? ((this.bendType = 6), s.splice(2, 1), s.splice(1, 1))
                : ((this.bendType = 5), s.splice(2, 1), s.splice(1, 1))
              : w.warning(
                  "Model",
                  "Unsupported bend type detected, fallback to custom",
                  null
                );
          } else if (s.length === 2) {
            let o = s[0],
              l = s[1];
            l.value > o.value
              ? !this.isContinuedBend && o.value > 0
                ? (this.bendType = 7)
                : (this.bendType = 2)
              : l.value < o.value
              ? this.isContinuedBend
                ? (this.bendType = 3)
                : (this.bendType = 8)
              : o.value > 0 && !this.isContinuedBend
              ? (this.bendType = 6)
              : (this.bendType = 5);
          }
        }
        this.initialBendValue > 0 && (this.accidentalMode = 0);
      }
      static nextNoteOnSameLine(t) {
        let e = t.beat.nextBeat;
        for (
          ;
          e &&
          e.voice.bar.index <=
            t.beat.voice.bar.index + It._maxOffsetForSameLineSearch;

        ) {
          if (t.isStringed) {
            let r = e.getNoteOnString(t.string);
            if (r) return r;
          } else if (t.index < e.notes.length) {
            return e.notes[t.index];
          }
          e = e.nextBeat;
        }
        return null;
      }
      static findHammerPullDestination(t) {
        let e = t.beat.nextBeat;
        for (
          ;
          e &&
          e.voice.bar.index <=
            t.beat.voice.bar.index + It._maxOffsetForSameLineSearch;

        ) {
          if (!t.isStringed) {
            if (t.index < e.notes.length) return e.notes[t.index];
            e = e.nextBeat;
            continue;
          }
          let r = e.getNoteOnString(t.string);
          if (r) return r;
          for (let i = t.string; i > 0; i--)
            if (((r = e.getNoteOnString(i)), r)) {
              if (r.isLeftHandTapped) return r;
              break;
            }
          for (let i = t.string; i <= t.beat.voice.bar.staff.tuning.length; i++)
            if (((r = e.getNoteOnString(i)), r)) {
              if (r.isLeftHandTapped) return r;
              break;
            }
          e = e.nextBeat;
        }
        return null;
      }
      static findTieOrigin(t) {
        let e = t.beat.previousBeat;
        for (
          ;
          e &&
          e.voice.bar.index >=
            t.beat.voice.bar.index - It._maxOffsetForSameLineSearch;

        ) {
          if (t.isStringed) {
            let r = e.getNoteOnString(t.string);
            if (r) return r;
          } else if (t.octave === -1 && t.tone === -1) {
            if (t.index < e.notes.length) return e.notes[t.index];
          } else {
            let r = e.getNoteWithRealValue(t.realValue);
            if (r) return r;
          }
          e = e.previousBeat;
        }
        return null;
      }
      chain(t = null) {
        if (t !== null)
          if (this._noteIdBag !== null) {
            let e;
            t.has(It._noteIdLookupKey)
              ? (e = t.get(It._noteIdLookupKey))
              : ((e = new Map()), t.set(It._noteIdLookupKey, e)),
              (this._noteIdBag.hammerPullDestinationNoteId !== -1 ||
                this._noteIdBag.tieDestinationNoteId !== -1 ||
                this._noteIdBag.slurDestinationNoteId !== -1 ||
                this._noteIdBag.slideTargetNoteId !== -1) &&
                e.set(this.id, this),
              this._noteIdBag.hammerPullOriginNoteId !== -1 &&
                ((this.hammerPullOrigin = e.get(
                  this._noteIdBag.hammerPullOriginNoteId
                )),
                (this.hammerPullOrigin.hammerPullDestination = this)),
              this._noteIdBag.tieOriginNoteId !== -1 &&
                ((this.tieOrigin = e.get(this._noteIdBag.tieOriginNoteId)),
                (this.tieOrigin.tieDestination = this)),
              this._noteIdBag.slurOriginNoteId !== -1 &&
                ((this.slurOrigin = e.get(this._noteIdBag.slurOriginNoteId)),
                (this.slurOrigin.slurDestination = this)),
              this._noteIdBag.slideOriginNoteId !== -1 &&
                ((this.slideOrigin = e.get(this._noteIdBag.slideOriginNoteId)),
                (this.slideOrigin.slideTarget = this)),
              (this._noteIdBag = null);
          } else {
            if (!this.isTieDestination && this.tieOrigin === null) return;
            let e = this.tieOrigin ?? It.findTieOrigin(this);
            e
              ? ((e.tieDestination = this),
                (this.tieOrigin = e),
                (this.fret = e.fret),
                (this.octave = e.octave),
                (this.tone = e.tone),
                e.hasBend && (this.bendOrigin = this.tieOrigin))
              : (this.isTieDestination = !1);
          }
      }
      toJson(t) {
        this.tieDestination !== null &&
          t.set("tiedestinationnoteid", this.tieDestination.id),
          this.tieOrigin !== null &&
            t.set("tieoriginnoteid", this.tieOrigin.id),
          this.slurDestination !== null &&
            t.set("slurdestinationnoteid", this.slurDestination.id),
          this.slurOrigin !== null &&
            t.set("sluroriginnoteid", this.slurOrigin.id),
          this.hammerPullOrigin !== null &&
            t.set("hammerpulloriginnoteid", this.hammerPullOrigin.id),
          this.hammerPullDestination !== null &&
            t.set("hammerpulldestinationnoteid", this.hammerPullDestination.id),
          this.slideTarget !== null &&
            t.set("slidetargetnoteid", this.slideTarget.id),
          this.slideOrigin !== null &&
            t.set("slideoriginnoteid", this.slideOrigin.id);
      }
      setProperty(t, e) {
        switch (t) {
          case "tiedestinationnoteid":
            return (
              this._noteIdBag == null && (this._noteIdBag = new wi()),
              (this._noteIdBag.tieDestinationNoteId = e),
              !0
            );
          case "tieoriginnoteid":
            return (
              this._noteIdBag == null && (this._noteIdBag = new wi()),
              (this._noteIdBag.tieOriginNoteId = e),
              !0
            );
          case "slurdestinationnoteid":
            return (
              this._noteIdBag == null && (this._noteIdBag = new wi()),
              (this._noteIdBag.slurDestinationNoteId = e),
              !0
            );
          case "sluroriginnoteid":
            return (
              this._noteIdBag == null && (this._noteIdBag = new wi()),
              (this._noteIdBag.slurOriginNoteId = e),
              !0
            );
          case "hammerpulloriginnoteid":
            return (
              this._noteIdBag == null && (this._noteIdBag = new wi()),
              (this._noteIdBag.hammerPullOriginNoteId = e),
              !0
            );
          case "hammerpulldestinationnoteid":
            return (
              this._noteIdBag == null && (this._noteIdBag = new wi()),
              (this._noteIdBag.hammerPullDestinationNoteId = e),
              !0
            );
          case "slidetargetnoteid":
            return (
              this._noteIdBag == null && (this._noteIdBag = new wi()),
              (this._noteIdBag.slideTargetNoteId = e),
              !0
            );
          case "slideoriginnoteid":
            return (
              this._noteIdBag == null && (this._noteIdBag = new wi()),
              (this._noteIdBag.slideOriginNoteId = e),
              !0
            );
        }
        return !1;
      }
    };
  (It.globalNoteId = 0),
    (It._maxOffsetForSameLineSearch = 3),
    (It._noteIdLookupKey = "NoteIdLookup");
  var Xe = It;
  var pt = class pt {
    constructor(t) {
      this._isEqualLengthTuplet = !0;
      this.totalDuration = 0;
      this.beats = [];
      this.isFull = !1;
      this.voice = t;
    }
    check(t) {
      if (this.beats.length === 0)
        return (
          this.beats.push(t), (this.totalDuration += t.playbackDuration), !0
        );
      if (t.graceType !== 0) return !0;
      if (
        t.voice !== this.voice ||
        this.isFull ||
        t.tupletNumerator !== this.beats[0].tupletNumerator ||
        t.tupletDenominator !== this.beats[0].tupletDenominator
      )
        return !1;
      if (
        (t.playbackDuration !== this.beats[0].playbackDuration &&
          (this._isEqualLengthTuplet = !1),
        this.beats.push(t),
        (this.totalDuration += t.playbackDuration),
        this._isEqualLengthTuplet)
      )
        this.beats.length === this.beats[0].tupletNumerator &&
          (this.isFull = !0);
      else {
        let e =
          (this.beats[0].tupletNumerator / this.beats[0].tupletDenominator) | 0;
        for (let r of pt._allTicks)
          if (this.totalDuration === r * e) {
            this.isFull = !0;
            break;
          }
      }
      return !0;
    }
  };
  (pt._halfTicks = 1920),
    (pt._quarterTicks = 960),
    (pt._eighthTicks = 480),
    (pt._sixteenthTicks = 240),
    (pt._thirtySecondTicks = 120),
    (pt._sixtyFourthTicks = 60),
    (pt._oneHundredTwentyEighthTicks = 30),
    (pt._twoHundredFiftySixthTicks = 15),
    (pt._allTicks = [
      pt._halfTicks,
      pt._quarterTicks,
      pt._eighthTicks,
      pt._sixteenthTicks,
      pt._thirtySecondTicks,
      pt._sixtyFourthTicks,
      pt._oneHundredTwentyEighthTicks,
      pt._twoHundredFiftySixthTicks,
    ]);
  var zs = pt;
  var Yr = ((a) => (
    (a[(a.None = 0)] = "None"),
    (a[(a.Custom = 1)] = "Custom"),
    (a[(a.Dive = 2)] = "Dive"),
    (a[(a.Dip = 3)] = "Dip"),
    (a[(a.Hold = 4)] = "Hold"),
    (a[(a.Predive = 5)] = "Predive"),
    (a[(a.PrediveDive = 6)] = "PrediveDive"),
    a
  ))(Yr || {});
  var Jr = ((r) => (
    (r[(r.None = 0)] = "None"),
    (r[(r.Thumb = 1)] = "Thumb"),
    (r[(r.Finger = 2)] = "Finger"),
    r
  ))(Jr || {});
  var Tr = ((i) => (
    (i[(i.None = 0)] = "None"),
    (i[(i.FadeIn = 1)] = "FadeIn"),
    (i[(i.FadeOut = 2)] = "FadeOut"),
    (i[(i.VolumeSwell = 3)] = "VolumeSwell"),
    i
  ))(Tr || {});
  var Lr = ((r) => (
    (r[(r.None = 0)] = "None"),
    (r[(r.Open = 1)] = "Open"),
    (r[(r.Closed = 2)] = "Closed"),
    r
  ))(Lr || {});
  var qr = ((r) => (
    (r[(r.None = 0)] = "None"),
    (r[(r.Full = 1)] = "Full"),
    (r[(r.Half = 2)] = "Half"),
    r
  ))(qr || {});
  var $r = ((T) => (
    (T[(T.None = 0)] = "None"),
    (T[(T.Ii = 1)] = "Ii"),
    (T[(T.Mi = 2)] = "Mi"),
    (T[(T.MiiTriplet = 3)] = "MiiTriplet"),
    (T[(T.MiiAnapaest = 4)] = "MiiAnapaest"),
    (T[(T.PmpTriplet = 5)] = "PmpTriplet"),
    (T[(T.PmpAnapaest = 6)] = "PmpAnapaest"),
    (T[(T.PeiTriplet = 7)] = "PeiTriplet"),
    (T[(T.PeiAnapaest = 8)] = "PeiAnapaest"),
    (T[(T.PaiTriplet = 9)] = "PaiTriplet"),
    (T[(T.PaiAnapaest = 10)] = "PaiAnapaest"),
    (T[(T.AmiTriplet = 11)] = "AmiTriplet"),
    (T[(T.AmiAnapaest = 12)] = "AmiAnapaest"),
    (T[(T.Ppp = 13)] = "Ppp"),
    (T[(T.Amii = 14)] = "Amii"),
    (T[(T.Amip = 15)] = "Amip"),
    (T[(T.Eami = 16)] = "Eami"),
    (T[(T.Eamii = 17)] = "Eamii"),
    (T[(T.Peami = 18)] = "Peami"),
    T
  ))($r || {});
  var Dr = ((i) => (
      (i[(i.Auto = 0)] = "Auto"),
      (i[(i.ForceSplitToNext = 1)] = "ForceSplitToNext"),
      (i[(i.ForceMergeWithNext = 2)] = "ForceMergeWithNext"),
      (i[(i.ForceSplitOnSecondaryToNext = 3)] = "ForceSplitOnSecondaryToNext"),
      i
    ))(Dr || {}),
    Je = ((g) => (
      (g[(g.Effects = 0)] = "Effects"),
      (g[(g.StandardNotationStem = 1)] = "StandardNotationStem"),
      (g[(g.StandardNotationFlags = 2)] = "StandardNotationFlags"),
      (g[(g.StandardNotationBeams = 3)] = "StandardNotationBeams"),
      (g[(g.StandardNotationTuplet = 4)] = "StandardNotationTuplet"),
      (g[(g.StandardNotationEffects = 5)] = "StandardNotationEffects"),
      (g[(g.StandardNotationRests = 6)] = "StandardNotationRests"),
      (g[(g.GuitarTabStem = 7)] = "GuitarTabStem"),
      (g[(g.GuitarTabFlags = 8)] = "GuitarTabFlags"),
      (g[(g.GuitarTabBeams = 9)] = "GuitarTabBeams"),
      (g[(g.GuitarTabTuplet = 10)] = "GuitarTabTuplet"),
      (g[(g.GuitarTabEffects = 11)] = "GuitarTabEffects"),
      (g[(g.GuitarTabRests = 12)] = "GuitarTabRests"),
      (g[(g.SlashStem = 13)] = "SlashStem"),
      (g[(g.SlashFlags = 14)] = "SlashFlags"),
      (g[(g.SlashBeams = 15)] = "SlashBeams"),
      (g[(g.SlashTuplet = 16)] = "SlashTuplet"),
      (g[(g.SlashRests = 17)] = "SlashRests"),
      (g[(g.SlashEffects = 18)] = "SlashEffects"),
      (g[(g.NumberedDuration = 19)] = "NumberedDuration"),
      (g[(g.NumberedEffects = 20)] = "NumberedEffects"),
      (g[(g.NumberedRests = 21)] = "NumberedRests"),
      (g[(g.NumberedTuplet = 22)] = "NumberedTuplet"),
      g
    ))(Je || {}),
    Ys = class extends zt {},
    Xs = class Xs {
      constructor() {
        this.id = Xs._globalBeatId++;
        this.index = 0;
        this.previousBeat = null;
        this.nextBeat = null;
        this.notes = [];
        this.noteStringLookup = new Map();
        this.noteValueLookup = new Map();
        this.isEmpty = !1;
        this.whammyStyle = 0;
        this.ottava = 2;
        this.fermata = null;
        this.isLegatoOrigin = !1;
        this.minNote = null;
        this.maxNote = null;
        this.maxStringNote = null;
        this.minStringNote = null;
        this.duration = 4;
        this.isLetRing = !1;
        this.isPalmMute = !1;
        this.automations = [];
        this.dots = 0;
        this.fade = 0;
        this.lyrics = null;
        this.pop = !1;
        this.slap = !1;
        this.tap = !1;
        this.text = null;
        this.slashed = !1;
        this.deadSlapped = !1;
        this.brushType = 0;
        this.brushDuration = 0;
        this.tupletDenominator = -1;
        this.tupletNumerator = -1;
        this.tupletGroup = null;
        this.isContinuedWhammy = !1;
        this.whammyBarType = 0;
        this.whammyBarPoints = null;
        this.maxWhammyPoint = null;
        this.minWhammyPoint = null;
        this.vibrato = 0;
        this.chordId = null;
        this.graceType = 0;
        this.graceGroup = null;
        this.graceIndex = -1;
        this.pickStroke = 0;
        this.tremoloSpeed = null;
        this.crescendo = 0;
        this.displayStart = 0;
        this.playbackStart = 0;
        this.displayDuration = 0;
        this.playbackDuration = 0;
        this.golpe = 0;
        this.dynamics = 5;
        this.invertBeamDirection = !1;
        this.preferredBeamDirection = null;
        this.isEffectSlurOrigin = !1;
        this.effectSlurOrigin = null;
        this.effectSlurDestination = null;
        this.beamingMode = 0;
        this.wahPedal = 0;
        this.barreFret = -1;
        this.barreShape = 0;
        this.rasgueado = 0;
        this.showTimer = !1;
        this.timer = null;
      }
      static resetIds() {
        Xs._globalBeatId = 0;
      }
      get isLastOfVoice() {
        return this.index === this.voice.beats.length - 1;
      }
      get isLegatoDestination() {
        return !!this.previousBeat && this.previousBeat.isLegatoOrigin;
      }
      get isRest() {
        return this.isEmpty || (!this.deadSlapped && this.notes.length === 0);
      }
      get isFullBarRest() {
        return (
          this.isRest && this.voice.beats.length === 1 && this.duration === 1
        );
      }
      get fadeIn() {
        return this.fade === 1;
      }
      set fadeIn(t) {
        this.fade = t ? 1 : 0;
      }
      get hasRasgueado() {
        return this.rasgueado !== 0;
      }
      get hasTuplet() {
        return (
          !(this.tupletDenominator === -1 && this.tupletNumerator === -1) &&
          !(this.tupletDenominator === 1 && this.tupletNumerator === 1)
        );
      }
      get hasWhammyBar() {
        return this.whammyBarPoints !== null && this.whammyBarType !== 0;
      }
      get hasChord() {
        return !!this.chordId;
      }
      get chord() {
        return this.chordId
          ? this.voice.bar.staff.getChord(this.chordId)
          : null;
      }
      get isTremolo() {
        return !!this.tremoloSpeed;
      }
      get displayEnd() {
        return this.displayStart + this.displayDuration;
      }
      get absoluteDisplayStart() {
        return this.voice.bar.masterBar.start + this.displayStart;
      }
      get absolutePlaybackStart() {
        return this.voice.bar.masterBar.start + this.playbackStart;
      }
      get isEffectSlurDestination() {
        return !!this.effectSlurOrigin;
      }
      get isBarre() {
        return this.barreShape !== 0 && this.barreFret >= 0;
      }
      addWhammyBarPoint(t) {
        let e = this.whammyBarPoints;
        e === null && ((e = []), (this.whammyBarPoints = e)),
          e.push(t),
          (!this.maxWhammyPoint || t.value > this.maxWhammyPoint.value) &&
            (this.maxWhammyPoint = t),
          (!this.minWhammyPoint || t.value < this.minWhammyPoint.value) &&
            (this.minWhammyPoint = t),
          this.whammyBarType === 0 && (this.whammyBarType = 1);
      }
      removeWhammyBarPoint(t) {
        let e = this.whammyBarPoints;
        if (e === null || t < 0 || t >= e.length) return;
        e.splice(t, 1);
        let r = e[t];
        if (r === this.maxWhammyPoint) {
          this.maxWhammyPoint = null;
          for (let i of e)
            (!this.maxWhammyPoint || i.value > this.maxWhammyPoint.value) &&
              (this.maxWhammyPoint = i);
        }
        if (r === this.minWhammyPoint) {
          this.minWhammyPoint = null;
          for (let i of e)
            (!this.minWhammyPoint || i.value < this.minWhammyPoint.value) &&
              (this.minWhammyPoint = i);
        }
      }
      addNote(t) {
        (t.beat = this),
          (t.index = this.notes.length),
          this.notes.push(t),
          t.isStringed && this.noteStringLookup.set(t.string, t);
      }
      removeNote(t) {
        let e = this.notes.indexOf(t);
        e >= 0 &&
          (this.notes.splice(e, 1),
          t.isStringed && this.noteStringLookup.delete(t.string));
      }
      getAutomation(t) {
        for (let e = 0, r = this.automations.length; e < r; e++) {
          let i = this.automations[e];
          if (i.type === t) return i;
        }
        return null;
      }
      getNoteOnString(t) {
        return this.noteStringLookup.has(t)
          ? this.noteStringLookup.get(t)
          : null;
      }
      _calculateDuration() {
        if (this.overrideDisplayDuration !== void 0)
          return this.overrideDisplayDuration;
        if (this.isFullBarRest)
          return this.voice.bar.masterBar.calculateDuration();
        let t = E.toTicks(this.duration);
        return (
          this.dots === 2
            ? (t = E.applyDot(t, !0))
            : this.dots === 1 && (t = E.applyDot(t, !1)),
          this.tupletDenominator > 0 &&
            this.tupletNumerator >= 0 &&
            (t = E.applyTuplet(
              t,
              this.tupletNumerator,
              this.tupletDenominator
            )),
          t
        );
      }
      updateDurations() {
        let t = this._calculateDuration();
        switch (((this.playbackDuration = t), this.graceType)) {
          case 2:
          case 1:
            switch (this.duration) {
              case 16:
                this.playbackDuration = E.toTicks(64);
                break;
              case 32:
                this.playbackDuration = E.toTicks(128);
                break;
              default:
                this.playbackDuration = E.toTicks(32);
                break;
            }
            this.displayDuration = 0;
            break;
          case 3:
            (this.playbackDuration /= 2), (this.displayDuration = 0);
            break;
          default:
            this.displayDuration = t;
            let e = this.previousBeat;
            e &&
              e.graceType === 3 &&
              (this.playbackDuration = e.playbackDuration);
            break;
        }
      }
      finishTuplet() {
        let t = this.previousBeat,
          e = t ? t.tupletGroup : null;
        (this.hasTuplet || (this.graceType !== 0 && e)) &&
          ((!t || !e || !e.check(this)) &&
            ((e = new zs(this.voice)), e.check(this)),
          (this.tupletGroup = e));
        let r = this.voice.bar.masterBar.calculateDuration(!1),
          i = [];
        for (let n of this.automations)
          n.ratioPosition === 0 && (n.ratioPosition = this.playbackStart / r),
            n.type !== 0 && i.push(n);
        this.automations = i;
      }
      finish(t, e = null) {
        switch (
          (this.getAutomation(2) === null &&
            this.index === 0 &&
            this.voice.index === 0 &&
            this.voice.bar.index === 0 &&
            this.voice.bar.staff.index === 0 &&
            this.automations.push(
              he.buildInstrumentAutomation(
                !1,
                0,
                this.voice.bar.staff.track.playbackInfo.program
              )
            ),
          this.graceType)
        ) {
          case 1:
          case 2:
            let u = this.graceGroup.beats.length;
            u === 1
              ? (this.duration = 8)
              : u === 2
              ? (this.duration = 16)
              : (this.duration = 32);
            break;
        }
        this.brushType === 0 && (this.brushDuration = 0);
        let r = t ? t.notation.notationMode : 0,
          i = this.text === "grad" || this.text === "grad.";
        i && r === 1 && (this.text = "");
        let n = !1;
        (this.minNote = null),
          (this.maxNote = null),
          (this.minStringNote = null),
          (this.maxStringNote = null);
        let s = 0,
          a = !1;
        for (let u = 0, c = this.notes.length; u < c; u++) {
          let d = this.notes[u];
          if (
            ((d.dynamics = this.dynamics),
            d.finish(t, e),
            d.isLetRing && (this.isLetRing = !0),
            d.isPalmMute && (this.isPalmMute = !0),
            r === 1 && d.hasBend && this.graceType !== 3)
          ) {
            if (!d.isTieOrigin)
              switch (d.bendType) {
                case 2:
                case 8:
                case 7:
                  n = !0;
                  break;
              }
            i || d.bendStyle === 1
              ? ((i = !0), (d.bendStyle = 1), (n = !1))
              : (d.bendStyle = 2);
          }
          d.isVisible &&
            (s++,
            (!this.minNote || d.realValue < this.minNote.realValue) &&
              (this.minNote = d),
            (!this.maxNote || d.realValue > this.maxNote.realValue) &&
              (this.maxNote = d),
            (!this.minStringNote || d.string < this.minStringNote.string) &&
              (this.minStringNote = d),
            (!this.maxStringNote || d.string > this.maxStringNote.string) &&
              (this.maxStringNote = d),
            d.hasEffectSlur && (a = !0));
        }
        if (
          (a &&
            (this.effectSlurOrigin
              ? ((this.effectSlurOrigin.effectSlurDestination = this.nextBeat),
                this.effectSlurOrigin.effectSlurDestination &&
                  (this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin =
                    this.effectSlurOrigin),
                (this.effectSlurOrigin = null))
              : ((this.isEffectSlurOrigin = !0),
                (this.effectSlurDestination = this.nextBeat),
                this.effectSlurDestination &&
                  (this.effectSlurDestination.effectSlurOrigin = this))),
          this.notes.length > 0 && s === 0 && (this.isEmpty = !0),
          !this.isRest && (!this.isLetRing || !this.isPalmMute))
        ) {
          let u = this.previousBeat;
          for (; u && u.isRest; )
            this.isLetRing || (u.isLetRing = !1),
              this.isPalmMute || (u.isPalmMute = !1),
              (u = u.previousBeat);
        } else
          this.isRest &&
            this.previousBeat &&
            t &&
            t.notation.notationMode === 0 &&
            (this.previousBeat.isLetRing && (this.isLetRing = !0),
            this.previousBeat.isPalmMute && (this.isPalmMute = !0));
        let o = this.whammyBarPoints,
          l = o !== null && o.length > 0;
        if (l) {
          let u = !!this.previousBeat && this.previousBeat.hasWhammyBar;
          this.isContinuedWhammy = u;
        } else this.whammyBarType = 0;
        if (l && this.whammyBarType === 1) {
          if ((r === 1 && (this.whammyStyle = i ? 1 : 2), o.length === 4)) {
            let u = o[0],
              c = o[1],
              d = o[2],
              h = o[3];
            c.value === d.value &&
              ((u.value < c.value && c.value < h.value) ||
              (u.value > c.value && c.value > h.value)
                ? (u.value !== 0 && !this.isContinuedWhammy
                    ? (this.whammyBarType = 6)
                    : (this.whammyBarType = 2),
                  o.splice(2, 1),
                  o.splice(1, 1))
                : (u.value > c.value && c.value < h.value) ||
                  (u.value < c.value && c.value > h.value)
                ? ((this.whammyBarType = 3),
                  (c.offset === d.offset || r === 1) && o.splice(2, 1))
                : u.value === c.value &&
                  c.value === h.value &&
                  (u.value !== 0 && !this.isContinuedWhammy
                    ? (this.whammyBarType = 5)
                    : (this.whammyBarType = 4),
                  o.splice(2, 1),
                  o.splice(1, 1)));
          } else if (o.length === 2) {
            let u = o[0],
              c = o[1];
            u.value < c.value || u.value > c.value
              ? u.value !== 0 && !this.isContinuedWhammy
                ? (this.whammyBarType = 6)
                : (this.whammyBarType = 2)
              : u.value === c.value &&
                (u.value !== 0 && !this.isContinuedWhammy
                  ? (this.whammyBarType = 5)
                  : (this.whammyBarType = 4));
          }
        }
        if ((this.updateDurations(), n)) {
          let u = dn.clone(this);
          (u.id = Xs._globalBeatId++), (u.pickStroke = 0);
          for (let c = 0, d = u.notes.length; c < d; c++) {
            let h = u.notes[c],
              f = this.notes[c];
            if (
              ((h.bendType = 0),
              (h.maxBendPoint = null),
              (h.bendPoints = null),
              (h.bendStyle = 0),
              (h.id = Xe.globalNoteId++),
              f.isTieOrigin &&
                ((h.tieDestination = f.tieDestination),
                (f.tieDestination.tieOrigin = h)),
              f.isTieDestination &&
                ((h.tieOrigin = f.tieOrigin ? f.tieOrigin : null),
                (f.tieOrigin.tieDestination = h)),
              f.hasBend && f.isTieOrigin)
            ) {
              let b = Xe.findTieOrigin(f);
              if (b && b.hasBend) {
                h.bendType = 5;
                let y = f.bendPoints[f.bendPoints.length - 1];
                h.addBendPoint(new I(0, y.value)),
                  h.addBendPoint(new I(I.MaxPosition, y.value));
              }
            }
            h.isTieDestination = !0;
          }
          (this.graceType = 3),
            (this.graceGroup = new Vi()),
            this.graceGroup.addBeat(this),
            (this.graceGroup.isComplete = !0),
            this.graceGroup.finish(),
            this.updateDurations(),
            this.voice.insertBeat(this, u),
            (u.graceGroup = new Vi()),
            u.graceGroup.addBeat(this),
            (u.graceGroup.isComplete = !0),
            u.graceGroup.finish();
        }
      }
      isBefore(t) {
        return (
          this.voice.bar.index < t.voice.bar.index ||
          (t.voice.bar.index === this.voice.bar.index && this.index < t.index)
        );
      }
      isAfter(t) {
        return (
          this.voice.bar.index > t.voice.bar.index ||
          (t.voice.bar.index === this.voice.bar.index && this.index > t.index)
        );
      }
      hasNoteOnString(t) {
        return this.noteStringLookup.has(t);
      }
      getNoteWithRealValue(t) {
        return this.noteValueLookup.has(t) ? this.noteValueLookup.get(t) : null;
      }
      chain(t = null) {
        for (let e of this.notes)
          this.noteValueLookup.set(e.realValue, e), e.chain(t);
      }
    };
  Xs._globalBeatId = 0;
  var Me = Xs;
  var Js = class {
    static clone(t) {
      let e = new I();
      return (e.offset = t.offset), (e.value = t.value), e;
    }
  };
  var qs = class {
    static clone(t) {
      let e = new Xe();
      if (
        ((e.index = t.index),
        (e.accentuated = t.accentuated),
        (e.bendType = t.bendType),
        (e.bendStyle = t.bendStyle),
        (e.isContinuedBend = t.isContinuedBend),
        t.bendPoints)
      ) {
        e.bendPoints = [];
        for (let r of t.bendPoints) e.addBendPoint(Js.clone(r));
      }
      return (
        (e.fret = t.fret),
        (e.string = t.string),
        (e.showStringNumber = t.showStringNumber),
        (e.octave = t.octave),
        (e.tone = t.tone),
        (e.percussionArticulation = t.percussionArticulation),
        (e.isVisible = t.isVisible),
        (e.isLeftHandTapped = t.isLeftHandTapped),
        (e.isHammerPullOrigin = t.isHammerPullOrigin),
        (e.isSlurDestination = t.isSlurDestination),
        (e.harmonicType = t.harmonicType),
        (e.harmonicValue = t.harmonicValue),
        (e.isGhost = t.isGhost),
        (e.isLetRing = t.isLetRing),
        (e.isPalmMute = t.isPalmMute),
        (e.isDead = t.isDead),
        (e.isDeadVisual = t.isDeadVisual),
        (e.isStaccato = t.isStaccato),
        (e.slideInType = t.slideInType),
        (e.slideOutType = t.slideOutType),
        (e.vibrato = t.vibrato),
        (e.isTieDestination = t.isTieDestination),
        (e.leftHandFinger = t.leftHandFinger),
        (e.rightHandFinger = t.rightHandFinger),
        (e.trillValue = t.trillValue),
        (e.trillSpeed = t.trillSpeed),
        (e.durationPercent = t.durationPercent),
        (e.accidentalMode = t.accidentalMode),
        (e.dynamics = t.dynamics),
        (e.ornament = t.ornament),
        e
      );
    }
  };
  var Kl = class {
    static clone(t) {
      let e = new Ur();
      return (
        (e.barOccurence = t.barOccurence),
        (e.millisecondOffset = t.millisecondOffset),
        e
      );
    }
  };
  var Ql = class {
    static clone(t) {
      let e = new he();
      return (
        (e.isLinear = t.isLinear),
        (e.type = t.type),
        (e.value = t.value),
        (e.syncPointValue = t.syncPointValue
          ? Kl.clone(t.syncPointValue)
          : void 0),
        (e.ratioPosition = t.ratioPosition),
        (e.text = t.text),
        (e.isVisible = t.isVisible),
        e
      );
    }
  };
  var dn = class {
    static clone(t) {
      let e = new Me();
      (e.index = t.index), (e.notes = []);
      for (let r of t.notes) e.addNote(qs.clone(r));
      (e.isEmpty = t.isEmpty),
        (e.whammyStyle = t.whammyStyle),
        (e.ottava = t.ottava),
        (e.isLegatoOrigin = t.isLegatoOrigin),
        (e.duration = t.duration),
        (e.isLetRing = t.isLetRing),
        (e.isPalmMute = t.isPalmMute),
        (e.automations = []);
      for (let r of t.automations) e.automations.push(Ql.clone(r));
      if (
        ((e.dots = t.dots),
        (e.fade = t.fade),
        (e.lyrics = t.lyrics ? t.lyrics.slice() : null),
        (e.pop = t.pop),
        (e.slap = t.slap),
        (e.tap = t.tap),
        (e.text = t.text),
        (e.slashed = t.slashed),
        (e.deadSlapped = t.deadSlapped),
        (e.brushType = t.brushType),
        (e.brushDuration = t.brushDuration),
        (e.tupletDenominator = t.tupletDenominator),
        (e.tupletNumerator = t.tupletNumerator),
        (e.isContinuedWhammy = t.isContinuedWhammy),
        (e.whammyBarType = t.whammyBarType),
        t.whammyBarPoints)
      ) {
        e.whammyBarPoints = [];
        for (let r of t.whammyBarPoints) e.addWhammyBarPoint(Js.clone(r));
      }
      return (
        (e.vibrato = t.vibrato),
        (e.chordId = t.chordId),
        (e.graceType = t.graceType),
        (e.pickStroke = t.pickStroke),
        (e.tremoloSpeed = t.tremoloSpeed),
        (e.crescendo = t.crescendo),
        (e.displayStart = t.displayStart),
        (e.playbackStart = t.playbackStart),
        (e.displayDuration = t.displayDuration),
        (e.playbackDuration = t.playbackDuration),
        (e.overrideDisplayDuration = t.overrideDisplayDuration),
        (e.golpe = t.golpe),
        (e.dynamics = t.dynamics),
        (e.invertBeamDirection = t.invertBeamDirection),
        (e.preferredBeamDirection = t.preferredBeamDirection),
        (e.isEffectSlurOrigin = t.isEffectSlurOrigin),
        (e.beamingMode = t.beamingMode),
        (e.wahPedal = t.wahPedal),
        (e.barreFret = t.barreFret),
        (e.barreShape = t.barreShape),
        (e.rasgueado = t.rasgueado),
        (e.showTimer = t.showTimer),
        (e.timer = t.timer),
        e
      );
    }
  };
  var Hi = ((r) => (
      (r[(r.Hint = 0)] = "Hint"),
      (r[(r.Warning = 1)] = "Warning"),
      (r[(r.Error = 2)] = "Error"),
      r
    ))(Hi || {}),
    pn = ((U) => (
      (U[(U.AT001 = 1)] = "AT001"),
      (U[(U.AT002 = 2)] = "AT002"),
      (U[(U.AT003 = 3)] = "AT003"),
      (U[(U.AT004 = 4)] = "AT004"),
      (U[(U.AT005 = 5)] = "AT005"),
      (U[(U.AT006 = 6)] = "AT006"),
      (U[(U.AT200 = 200)] = "AT200"),
      (U[(U.AT201 = 201)] = "AT201"),
      (U[(U.AT202 = 202)] = "AT202"),
      (U[(U.AT203 = 203)] = "AT203"),
      (U[(U.AT204 = 204)] = "AT204"),
      (U[(U.AT205 = 205)] = "AT205"),
      (U[(U.AT206 = 206)] = "AT206"),
      (U[(U.AT207 = 207)] = "AT207"),
      (U[(U.AT208 = 208)] = "AT208"),
      (U[(U.AT209 = 209)] = "AT209"),
      (U[(U.AT210 = 210)] = "AT210"),
      (U[(U.AT211 = 211)] = "AT211"),
      (U[(U.AT212 = 212)] = "AT212"),
      (U[(U.AT213 = 213)] = "AT213"),
      (U[(U.AT214 = 214)] = "AT214"),
      (U[(U.AT215 = 215)] = "AT215"),
      (U[(U.AT216 = 216)] = "AT216"),
      (U[(U.AT217 = 217)] = "AT217"),
      (U[(U.AT218 = 218)] = "AT218"),
      (U[(U.AT300 = 300)] = "AT300"),
      (U[(U.AT301 = 301)] = "AT301"),
      (U[(U.AT302 = 302)] = "AT302"),
      (U[(U.AT303 = 303)] = "AT303"),
      (U[(U.AT304 = 304)] = "AT304"),
      (U[(U.AT305 = 305)] = "AT305"),
      (U[(U.AT306 = 306)] = "AT306"),
      (U[(U.AT400 = 400)] = "AT400"),
      U
    ))(pn || {}),
    Ni = class {
      constructor() {
        this._hasErrors = !1;
        this.items = [];
      }
      get errors() {
        return this.items.filter((t) => t.severity === 2);
      }
      get hasErrors() {
        return this._hasErrors;
      }
      push(t) {
        this.items.push(t), t.severity === 2 && (this._hasErrors = !0);
      }
      [Symbol.iterator]() {
        return this.items[Symbol.iterator]();
      }
    },
    Wi = class extends Error {},
    $s = ((e) => (
      (e[(e.Auto = 0)] = "Auto"), (e[(e.Explicit = 1)] = "Explicit"), e
    ))($s || {}),
    ls = ((r) => (
      (r[(r.Pitched = 0)] = "Pitched"),
      (r[(r.Fretted = 1)] = "Fretted"),
      (r[(r.Articulation = 2)] = "Articulation"),
      r
    ))(ls || {});
  var Kr = ((T) => (
    (T[(T.TargetFine = 0)] = "TargetFine"),
    (T[(T.TargetSegno = 1)] = "TargetSegno"),
    (T[(T.TargetSegnoSegno = 2)] = "TargetSegnoSegno"),
    (T[(T.TargetCoda = 3)] = "TargetCoda"),
    (T[(T.TargetDoubleCoda = 4)] = "TargetDoubleCoda"),
    (T[(T.JumpDaCapo = 5)] = "JumpDaCapo"),
    (T[(T.JumpDaCapoAlCoda = 6)] = "JumpDaCapoAlCoda"),
    (T[(T.JumpDaCapoAlDoubleCoda = 7)] = "JumpDaCapoAlDoubleCoda"),
    (T[(T.JumpDaCapoAlFine = 8)] = "JumpDaCapoAlFine"),
    (T[(T.JumpDalSegno = 9)] = "JumpDalSegno"),
    (T[(T.JumpDalSegnoAlCoda = 10)] = "JumpDalSegnoAlCoda"),
    (T[(T.JumpDalSegnoAlDoubleCoda = 11)] = "JumpDalSegnoAlDoubleCoda"),
    (T[(T.JumpDalSegnoAlFine = 12)] = "JumpDalSegnoAlFine"),
    (T[(T.JumpDalSegnoSegno = 13)] = "JumpDalSegnoSegno"),
    (T[(T.JumpDalSegnoSegnoAlCoda = 14)] = "JumpDalSegnoSegnoAlCoda"),
    (T[(T.JumpDalSegnoSegnoAlDoubleCoda = 15)] =
      "JumpDalSegnoSegnoAlDoubleCoda"),
    (T[(T.JumpDalSegnoSegnoAlFine = 16)] = "JumpDalSegnoSegnoAlFine"),
    (T[(T.JumpDaCoda = 17)] = "JumpDaCoda"),
    (T[(T.JumpDaDoubleCoda = 18)] = "JumpDaDoubleCoda"),
    T
  ))(Kr || {});
  var Fr = ((r) => (
      (r[(r.Short = 0)] = "Short"),
      (r[(r.Medium = 1)] = "Medium"),
      (r[(r.Long = 2)] = "Long"),
      r
    ))(Fr || {}),
    kr = class {
      constructor() {
        this.type = 0;
        this.length = 0;
      }
    };
  var G = class G {
    static _toEnum(t, e) {
      return e;
    }
    static *_basicMappingIterator(t) {
      for (let [e, r] of Object.entries(t).filter(
        (i) => typeof i[1] == "number"
      ))
        yield [
          (e.startsWith("_") ? e.substring(1) : e).toLowerCase(),
          G._toEnum(t, r),
        ];
    }
    static _basic(t, e) {
      let r = new Map(G._basicMappingIterator(t));
      if (e) for (let i of e) r.set(i[0], i[1]);
      return r;
    }
    static _reverse(t) {
      let e = new Map();
      for (let [r, i] of t) e.has(i) || e.set(i, r);
      return e;
    }
  };
  (G.whammyTypes = G._basic(Yr)),
    (G.whammyTypesReversed = G._reverse(G.whammyTypes)),
    (G.bendStyles = G._basic(Pt)),
    (G.bendStylesReversed = G._reverse(G.bendStyles)),
    (G.graceTypes = new Map([
      ["ob", 1],
      ["b", 3],
      ["bb", 2],
    ])),
    (G.graceTypesReversed = G._reverse(G.graceTypes)),
    (G.fermataTypes = G._basic(Fr)),
    (G.fermataTypesReversed = G._reverse(G.fermataTypes)),
    (G.accidentalModes = G._basic($s)),
    (G.accidentalModesReversed = G._reverse(G.accidentalModes)),
    (G.barreShapes = G._basic(qr)),
    (G.barreShapesReversed = G._reverse(G.barreShapes)),
    (G.ottava = G._basic(Ze)),
    (G.ottavaReversed = G._reverse(G.ottava)),
    (G.rasgueadoPatterns = G._basic($r)),
    (G.rasgueadoPatternsReversed = G._reverse(G.rasgueadoPatterns)),
    (G.dynamics = G._basic(st)),
    (G.dynamicsReversed = G._reverse(G.dynamics)),
    (G.bracketExtendModes = G._basic(ln)),
    (G.bracketExtendModesReversed = G._reverse(G.bracketExtendModes)),
    (G.trackNamePolicies = G._basic(Ti)),
    (G.trackNamePoliciesReversed = G._reverse(G.trackNamePolicies)),
    (G.trackNameOrientations = G._basic(vi)),
    (G.trackNameOrientationsReversed = G._reverse(G.trackNameOrientations)),
    (G.trackNameMode = G._basic(ki)),
    (G.trackNameModeReversed = G._reverse(G.trackNameMode)),
    (G.textAligns = G._basic(xe)),
    (G.textAlignsReversed = G._reverse(G.textAligns)),
    (G.bendTypes = G._basic(fr)),
    (G.bendTypesReversed = G._reverse(G.bendTypes)),
    (G.keySignatures = G._basic(zr, [
      ["cbmajor", -7],
      ["abminor", -7],
      ["gbmajor", -6],
      ["ebminor", -6],
      ["dbmajor", -5],
      ["bbminor", -5],
      ["abmajor", -4],
      ["fminor", -4],
      ["ebmajor", -3],
      ["cminor", -3],
      ["bbmajor", -2],
      ["gminor", -2],
      ["fmajor", -1],
      ["dminor", -1],
      ["cmajor", 0],
      ["aminor", 0],
      ["gmajor", 1],
      ["eminor", 1],
      ["dmajor", 2],
      ["bminor", 2],
      ["amajor", 3],
      ["f#minor", 3],
      ["emajor", 4],
      ["c#minor", 4],
      ["bmajor", 5],
      ["g#minor", 5],
      ["f#", 6],
      ["f#major", 6],
      ["d#minor", 6],
      ["c#", 7],
      ["c#major", 7],
      ["a#minor", 7],
    ])),
    (G.keySignaturesMajorReversed = new Map([
      [-7, "cb"],
      [-6, "gb"],
      [-5, "db"],
      [-4, "ab"],
      [-3, "eb"],
      [-2, "bb"],
      [-1, "f"],
      [0, "c"],
      [1, "g"],
      [2, "d"],
      [3, "a"],
      [4, "e"],
      [5, "b"],
      [6, "f#"],
      [7, "c#"],
    ])),
    (G.keySignaturesMinorReversed = new Map([
      [-7, "abminor"],
      [-6, "ebminor"],
      [-5, "bbminor"],
      [-4, "fminor"],
      [-3, "cminor"],
      [-2, "gminor"],
      [-1, "dminor"],
      [0, "aminor"],
      [1, "eminor"],
      [2, "bminor"],
      [3, "f#minor"],
      [4, "c#minor"],
      [5, "g#minor"],
      [6, "d#minor"],
      [7, "a#minor"],
    ])),
    (G.keySignatureTypes = new Map([
      ["cb", 0],
      ["cbmajor", 0],
      ["abminor", 1],
      ["gb", 0],
      ["gbmajor", 0],
      ["ebminor", 1],
      ["db", 0],
      ["dbmajor", 0],
      ["bbminor", 1],
      ["ab", 0],
      ["abmajor", 0],
      ["fminor", 1],
      ["eb", 0],
      ["ebmajor", 0],
      ["cminor", 1],
      ["bb", 0],
      ["bbmajor", 0],
      ["gminor", 1],
      ["f", 0],
      ["fmajor", 0],
      ["dminor", 1],
      ["c", 0],
      ["cmajor", 0],
      ["aminor", 1],
      ["g", 0],
      ["gmajor", 0],
      ["eminor", 1],
      ["d", 0],
      ["dmajor", 0],
      ["bminor", 1],
      ["a", 0],
      ["amajor", 0],
      ["f#minor", 1],
      ["e", 0],
      ["emajor", 0],
      ["c#minor", 1],
      ["b", 0],
      ["bmajor", 0],
      ["g#minor", 1],
      ["f#", 0],
      ["f#major", 0],
      ["d#minor", 1],
      ["c#", 0],
      ["c#major", 0],
      ["a#minor", 1],
    ])),
    (G.clefs = G._basic(yt, [
      ["treble", 4],
      ["bass", 3],
      ["alto", 1],
      ["tenor", 2],
      ["n", 0],
    ])),
    (G.clefsReversed = G._reverse(G.clefs)),
    (G.tripletFeels = G._basic(Ct, [
      ["no", 0],
      ["none", 0],
      ["t16", 1],
      ["triplet-16th", 1],
      ["t8", 2],
      ["triplet-8th", 2],
      ["d16", 3],
      ["dotted-16th", 3],
      ["d8", 4],
      ["dotted-8th", 4],
      ["s16", 5],
      ["scottish-16th", 5],
      ["s8", 6],
      ["scottish-8th", 6],
    ])),
    (G.tripletFeelsReversed = G._reverse(G.tripletFeels)),
    (G.barLines = G._basic(cr)),
    (G.barLinesReversed = G._reverse(G.barLines)),
    (G.ottavia = G._basic(Ze)),
    (G.ottaviaReversed = G._reverse(G.ottavia)),
    (G.simileMarks = G._basic(ur)),
    (G.simileMarksReversed = G._reverse(G.simileMarks)),
    (G.directions = new Map([
      ["fine", 0],
      ["segno", 1],
      ["segnosegno", 2],
      ["coda", 3],
      ["doublecoda", 4],
      ["dacapo", 5],
      ["dacapoalcoda", 6],
      ["dacapoaldoublecoda", 7],
      ["dacapoalfine", 8],
      ["dalsegno", 9],
      ["dalsegnoalcoda", 10],
      ["dalsegnoaldoublecoda", 11],
      ["dalsegnoalfine", 12],
      ["dalsegnosegno", 13],
      ["dalsegnosegnoalcoda", 14],
      ["dalsegnosegnoaldoublecoda", 15],
      ["dalsegnosegnoalfine", 16],
      ["dacoda", 17],
      ["dadoublecoda", 18],
    ])),
    (G.directionsReversed = G._reverse(G.directions));
  var re = G;
  var St = ((x) => (
    (x[(x.Dot = 0)] = "Dot"),
    (x[(x.Backslash = 1)] = "Backslash"),
    (x[(x.DoubleBackslash = 2)] = "DoubleBackslash"),
    (x[(x.Pipe = 3)] = "Pipe"),
    (x[(x.LBrace = 4)] = "LBrace"),
    (x[(x.RBrace = 5)] = "RBrace"),
    (x[(x.LParen = 6)] = "LParen"),
    (x[(x.RParen = 7)] = "RParen"),
    (x[(x.Colon = 8)] = "Colon"),
    (x[(x.Asterisk = 9)] = "Asterisk"),
    (x[(x.Ident = 10)] = "Ident"),
    (x[(x.Tag = 11)] = "Tag"),
    (x[(x.Meta = 12)] = "Meta"),
    (x[(x.Values = 13)] = "Values"),
    (x[(x.Props = 14)] = "Props"),
    (x[(x.Prop = 15)] = "Prop"),
    (x[(x.Number = 16)] = "Number"),
    (x[(x.String = 17)] = "String"),
    (x[(x.Score = 18)] = "Score"),
    (x[(x.Bar = 19)] = "Bar"),
    (x[(x.Beat = 20)] = "Beat"),
    (x[(x.Duration = 21)] = "Duration"),
    (x[(x.NoteList = 22)] = "NoteList"),
    (x[(x.Note = 23)] = "Note"),
    x
  ))(St || {});
  var C = class C {
    static _valueType(t, e, r, i) {
      return {
        expectedTypes: new Set(t),
        parseMode: e,
        allowedValues: r ? new Set(r) : void 0,
        reservedIdentifiers: i ? new Set(i) : void 0,
      };
    }
    static _basicList(t) {
      return t.map((e) => C._valueType(e[0], e[1]));
    }
  };
  (C._scoreInfoValueListTypes = [
    C._valueType([17, 10], 0),
    C._valueType([17], 1),
    C._valueType([17, 10], 1, Array.from(re.textAligns.keys())),
  ]),
    (C._scoreInfoTemplateValueListTypes = [
      C._valueType([17], 0),
      C._valueType([17, 10], 1, Array.from(re.textAligns.keys())),
    ]),
    (C._numberOnlyValueListTypes = C._basicList([[[16], 0]])),
    (C._textLikeValueListTypes = C._basicList([[[17, 10], 0]])),
    (C.chordPropertyValueListTypes = new Map([
      ["firstfret", C._numberOnlyValueListTypes],
      ["showdiagram", C._basicList([[[17, 10, 16], 1]])],
      ["showfingering", C._basicList([[[17, 10, 16], 1]])],
      ["showname", C._basicList([[[17, 10, 16], 1]])],
      ["barre", C._basicList([[[16], 7]])],
    ])),
    (C.tuningPropertyValueListTypes = new Map([
      ["hide", void 0],
      ["label", C._basicList([[[17], 0]])],
    ])),
    (C.staffPropertyValueListTypes = new Map([
      ["score", C._basicList([[[16], 1]])],
      ["tabs", void 0],
      ["slash", void 0],
      ["numbered", void 0],
    ])),
    (C.trackPropertyValueListTypes = new Map([
      ["color", C._textLikeValueListTypes],
      ["defaultsystemslayout", C._numberOnlyValueListTypes],
      ["volume", C._numberOnlyValueListTypes],
      ["balance", C._numberOnlyValueListTypes],
      ["bank", C._numberOnlyValueListTypes],
      ["systemslayout", C._basicList([[[16], 7]])],
      ["instrument", C._basicList([[[10, 17, 16], 0]])],
      ["mute", void 0],
      ["solo", void 0],
      ["multibarrest", void 0],
    ])),
    (C.beatPropertyValueListTypes = new Map([
      ["f", void 0],
      ["fo", void 0],
      ["vs", void 0],
      ["v", void 0],
      ["vw", void 0],
      ["s", void 0],
      ["p", void 0],
      ["tt", void 0],
      ["dd", void 0],
      ["d", void 0],
      ["su", void 0],
      ["sd", void 0],
      ["cre", void 0],
      ["dec", void 0],
      ["spd", void 0],
      ["sph", void 0],
      ["spu", void 0],
      ["spe", void 0],
      ["slashed", void 0],
      ["ds", void 0],
      ["glpf", void 0],
      ["glpt", void 0],
      ["waho", void 0],
      ["wahc", void 0],
      ["legatoorigin", void 0],
      ["timer", void 0],
      [
        "tu",
        C._basicList([
          [[16], 0],
          [[16], 1],
        ]),
      ],
      ["txt", C._textLikeValueListTypes],
      [
        "lyrics",
        C._basicList([
          [[16], 1],
          [[17], 0],
        ]),
      ],
      [
        "tb",
        [
          C._valueType([17, 10], 1),
          C._valueType([17, 10], 1),
          C._valueType([16], 6),
        ],
      ],
      [
        "tbe",
        [
          C._valueType([17, 10], 1, Array.from(re.whammyTypes.keys())),
          C._valueType([17, 10], 1, Array.from(re.bendStyles.keys())),
          C._valueType([16], 6),
        ],
      ],
      ["bu", C._basicList([[[16], 1]])],
      ["bd", C._basicList([[[16], 1]])],
      ["au", C._basicList([[[16], 1]])],
      ["ad", C._basicList([[[16], 1]])],
      ["ch", C._textLikeValueListTypes],
      ["gr", [C._valueType([17, 10], 1, Array.from(re.graceTypes.keys()))]],
      ["dy", C._textLikeValueListTypes],
      [
        "tempo",
        [
          C._valueType([16], 0),
          C._valueType([17], 1),
          C._valueType([10], 1, ["hide"]),
        ],
      ],
      ["volume", C._numberOnlyValueListTypes],
      ["balance", C._numberOnlyValueListTypes],
      ["tp", C._numberOnlyValueListTypes],
      [
        "barre",
        [
          C._valueType([16], 0),
          C._valueType([17, 10], 1, Array.from(re.barreShapes.keys())),
        ],
      ],
      ["rasg", C._textLikeValueListTypes],
      ["ot", C._textLikeValueListTypes],
      ["instrument", C._basicList([[[10, 17, 16], 0]])],
      ["bank", C._numberOnlyValueListTypes],
      [
        "fermata",
        [
          C._valueType([17, 10], 1, Array.from(re.fermataTypes.keys())),
          C._valueType([16], 3),
        ],
      ],
      ["beam", C._textLikeValueListTypes],
    ])),
    (C.beatDurationPropertyValueListTypes = new Map([
      [
        "tu",
        C._basicList([
          [[16], 0],
          [[16], 1],
        ]),
      ],
    ])),
    (C.notePropertyValueListTypes = new Map([
      ["nh", C._basicList([[[16], 1]])],
      ["ah", C._basicList([[[16], 1]])],
      ["th", C._basicList([[[16], 1]])],
      ["ph", C._basicList([[[16], 1]])],
      ["sh", C._basicList([[[16], 1]])],
      ["fh", C._basicList([[[16], 1]])],
      ["v", void 0],
      ["vw", void 0],
      ["sl", void 0],
      ["ss", void 0],
      ["sib", void 0],
      ["sia", void 0],
      ["sou", void 0],
      ["sod", void 0],
      ["psd", void 0],
      ["psu", void 0],
      ["h", void 0],
      ["lht", void 0],
      ["g", void 0],
      ["ac", void 0],
      ["hac", void 0],
      ["ten", void 0],
      ["pm", void 0],
      ["st", void 0],
      ["lr", void 0],
      ["x", void 0],
      ["-", void 0],
      ["t", void 0],
      ["turn", void 0],
      ["iturn", void 0],
      ["umordent", void 0],
      ["lmordent", void 0],
      ["string", void 0],
      ["hide", void 0],
      [
        "b",
        [
          C._valueType([17, 10], 1),
          C._valueType([17, 10], 1),
          C._valueType([16], 6),
        ],
      ],
      [
        "be",
        [
          C._valueType([17, 10], 1, Array.from(re.bendTypes.keys())),
          C._valueType([17, 10], 1, Array.from(re.bendStyles.keys())),
          C._valueType([16], 6),
        ],
      ],
      [
        "tr",
        C._basicList([
          [[16], 0],
          [[16], 1],
        ]),
      ],
      ["lf", C._basicList([[[16], 1]])],
      ["rf", C._basicList([[[16], 1]])],
      ["acc", C._textLikeValueListTypes],
      ["slur", C._textLikeValueListTypes],
    ])),
    (C.structuralMetaDataValueListTypes = new Map([
      [
        "track",
        C._basicList([
          [[17], 1],
          [[17], 1],
        ]),
      ],
      ["staff", void 0],
      ["voice", void 0],
    ])),
    (C.staffMetaDataValueListTypes = new Map([
      [
        "tuning",
        [
          C._valueType([10, 17], 5, ["piano", "none", "voice"]),
          C._valueType([10, 17], 7),
        ],
      ],
      [
        "chord",
        C._basicList([
          [[10, 17], 0],
          [[10, 17, 16], 7],
        ]),
      ],
      ["capo", C._numberOnlyValueListTypes],
      ["instrument", C._basicList([[[10, 17, 16], 0]])],
      ["bank", C._numberOnlyValueListTypes],
      [
        "lyrics",
        C._basicList([
          [[16], 1],
          [[17], 0],
        ]),
      ],
      [
        "articulation",
        C._basicList([
          [[17, 10], 0],
          [[16], 1],
        ]),
      ],
      ["displaytranspose", C._numberOnlyValueListTypes],
      ["transpose", C._numberOnlyValueListTypes],
    ])),
    (C.scoreMetaDataValueListTypes = new Map([
      ["title", C._scoreInfoValueListTypes],
      ["subtitle", C._scoreInfoValueListTypes],
      ["artist", C._scoreInfoValueListTypes],
      ["album", C._scoreInfoValueListTypes],
      ["words", C._scoreInfoValueListTypes],
      ["music", C._scoreInfoValueListTypes],
      ["wordsandmusic", C._scoreInfoTemplateValueListTypes],
      ["copyright", C._scoreInfoValueListTypes],
      ["copyright2", C._scoreInfoTemplateValueListTypes],
      ["instructions", C._scoreInfoValueListTypes],
      ["notices", C._scoreInfoValueListTypes],
      ["tab", C._scoreInfoValueListTypes],
      ["defaultsystemslayout", C._numberOnlyValueListTypes],
      ["systemslayout", C._basicList([[[16], 7]])],
      ["hidedynamics", void 0],
      ["showdynamics", void 0],
      ["usesystemsignseparator", void 0],
      ["multibarrest", void 0],
      ["bracketextendmode", C._textLikeValueListTypes],
      ["singletracktracknamepolicy", C._textLikeValueListTypes],
      ["multitracktracknamepolicy", C._textLikeValueListTypes],
      ["firstsystemtracknamemode", C._textLikeValueListTypes],
      ["othersystemstracknamemode", C._textLikeValueListTypes],
      ["firstsystemtracknameorientation", C._textLikeValueListTypes],
      ["othersystemstracknameorientation", C._textLikeValueListTypes],
    ])),
    (C.barMetaDataValueListTypes = new Map([
      [
        "tempo",
        [
          C._valueType([16], 2),
          C._valueType([17], 1),
          C._valueType([16], 4),
          C._valueType([10], 1, ["hide"]),
        ],
      ],
      ["rc", C._numberOnlyValueListTypes],
      ["ae", C._basicList([[[16], 6]])],
      [
        "ts",
        C._basicList([
          [[17, 10], 5],
          [[16], 0],
          [[16], 0],
        ]),
      ],
      ["ks", C._textLikeValueListTypes],
      ["clef", C._basicList([[[10, 17, 16], 0]])],
      [
        "section",
        [
          C._valueType([17, 10], 0),
          C._valueType([17, 10], 1, void 0, ["x", "-", "r"]),
        ],
      ],
      ["tf", C._basicList([[[10, 17, 16], 0]])],
      ["barlineleft", C._textLikeValueListTypes],
      ["barlineright", C._textLikeValueListTypes],
      ["accidentals", C._textLikeValueListTypes],
      ["jump", C._textLikeValueListTypes],
      ["ottava", C._textLikeValueListTypes],
      ["simile", C._textLikeValueListTypes],
      ["width", C._numberOnlyValueListTypes],
      ["scale", C._basicList([[[16], 2]])],
      ["spd", C._basicList([[[16], 2]])],
      ["spu", C._basicList([[[16], 2]])],
      ["sph", C._basicList([[[16], 2]])],
      ["ft", void 0],
      ["ro", void 0],
      ["ac", void 0],
      ["db", void 0],
      [
        "sync",
        C._basicList([
          [[16], 0],
          [[16], 0],
          [[16], 0],
          [[16], 3],
        ]),
      ],
    ])),
    (C.metaDataValueListTypes = [
      C.scoreMetaDataValueListTypes,
      C.staffMetaDataValueListTypes,
      C.structuralMetaDataValueListTypes,
      C.barMetaDataValueListTypes,
    ]);
  var Ie = C;
  var v = class p {
    static ident(t) {
      return { nodeType: 10, text: t };
    }
    static string(t) {
      return { nodeType: 17, text: t };
    }
    static number(t) {
      return { nodeType: 16, value: t };
    }
    static meta(t, e, r) {
      return {
        nodeType: 12,
        tag: {
          nodeType: 11,
          prefix: { nodeType: 1 },
          tag: { nodeType: 10, text: t },
        },
        values: e,
        properties: r,
        propertiesBeforeValues: !1,
      };
    }
    static identMeta(t, e) {
      return p.meta(t, p.identValue(e));
    }
    static numberMeta(t, e) {
      return p.meta(t, p.numberValue(e));
    }
    static values(t, e = void 0) {
      let r = { nodeType: 13, values: t.filter((n) => n !== void 0) };
      if (
        ((e === void 0 ? r.values.length > 1 : e) &&
          ((r.openParenthesis = { nodeType: 6 }),
          (r.closeParenthesis = { nodeType: 7 })),
        r.values.length !== 0)
      )
        return r;
    }
    static stringValue(t) {
      return p.values([p.string(t)]);
    }
    static identValue(t) {
      return p.values([p.ident(t)]);
    }
    static numberValue(t) {
      return p.values([p.number(t)]);
    }
    static props(t) {
      let e = {
        nodeType: 14,
        properties: [],
        openBrace: { nodeType: 4 },
        closeBrace: { nodeType: 5 },
      };
      for (let r of t)
        r &&
          e.properties.push({
            nodeType: 15,
            property: p.ident(r[0]),
            values: r[1],
          });
      return e;
    }
    static prop(t, e, r) {
      t.push({ nodeType: 15, property: p.ident(e), values: r });
    }
  };
  var hn = class hn {
    static getValue(t) {
      return (
        hn._values || (hn._values = new Map()),
        (t = t.toLowerCase().replaceAll(" ", "")),
        hn._values.has(t) ? hn._values.get(t) : 0
      );
    }
    static getName(t) {
      for (let [e, r] of hn._values) if (r === t) return e;
      return t.toString();
    }
    static isPiano(t) {
      return t <= 7 || (t >= 16 && t <= 23);
    }
    static isGuitar(t) {
      return (t >= 24 && t <= 39) || t === 105 || t === 43;
    }
    static isBass(t) {
      return t >= 32 && t <= 39;
    }
    static bankToLsbMsb(t) {
      let e = t & 127,
        r = (t >> 7) & 127;
      return [e, r];
    }
  };
  hn._values = new Map([
    ["acousticgrandpiano", 0],
    ["brightacousticpiano", 1],
    ["electricgrandpiano", 2],
    ["honkytonkpiano", 3],
    ["electricpiano1", 4],
    ["electricpiano2", 5],
    ["harpsichord", 6],
    ["clavinet", 7],
    ["celesta", 8],
    ["glockenspiel", 9],
    ["musicbox", 10],
    ["vibraphone", 11],
    ["marimba", 12],
    ["xylophone", 13],
    ["tubularbells", 14],
    ["dulcimer", 15],
    ["drawbarorgan", 16],
    ["percussiveorgan", 17],
    ["rockorgan", 18],
    ["churchorgan", 19],
    ["reedorgan", 20],
    ["accordion", 21],
    ["harmonica", 22],
    ["tangoaccordion", 23],
    ["acousticguitarnylon", 24],
    ["acousticguitarsteel", 25],
    ["electricguitarjazz", 26],
    ["electricguitarclean", 27],
    ["electricguitarmuted", 28],
    ["overdrivenguitar", 29],
    ["distortionguitar", 30],
    ["guitarharmonics", 31],
    ["acousticbass", 32],
    ["electricbassfinger", 33],
    ["electricbasspick", 34],
    ["fretlessbass", 35],
    ["slapbass1", 36],
    ["slapbass2", 37],
    ["synthbass1", 38],
    ["synthbass2", 39],
    ["violin", 40],
    ["viola", 41],
    ["cello", 42],
    ["contrabass", 43],
    ["tremolostrings", 44],
    ["pizzicatostrings", 45],
    ["orchestralharp", 46],
    ["timpani", 47],
    ["stringensemble1", 48],
    ["stringensemble2", 49],
    ["synthstrings1", 50],
    ["synthstrings2", 51],
    ["choiraahs", 52],
    ["voiceoohs", 53],
    ["synthvoice", 54],
    ["orchestrahit", 55],
    ["trumpet", 56],
    ["trombone", 57],
    ["tuba", 58],
    ["mutedtrumpet", 59],
    ["frenchhorn", 60],
    ["brasssection", 61],
    ["synthbrass1", 62],
    ["synthbrass2", 63],
    ["sopranosax", 64],
    ["altosax", 65],
    ["tenorsax", 66],
    ["baritonesax", 67],
    ["oboe", 68],
    ["englishhorn", 69],
    ["bassoon", 70],
    ["clarinet", 71],
    ["piccolo", 72],
    ["flute", 73],
    ["recorder", 74],
    ["panflute", 75],
    ["blownbottle", 76],
    ["shakuhachi", 77],
    ["whistle", 78],
    ["ocarina", 79],
    ["lead1square", 80],
    ["lead2sawtooth", 81],
    ["lead3calliope", 82],
    ["lead4chiff", 83],
    ["lead5charang", 84],
    ["lead6voice", 85],
    ["lead7fifths", 86],
    ["lead8bassandlead", 87],
    ["pad1newage", 88],
    ["pad2warm", 89],
    ["pad3polysynth", 90],
    ["pad4choir", 91],
    ["pad5bowed", 92],
    ["pad6metallic", 93],
    ["pad7halo", 94],
    ["pad8sweep", 95],
    ["fx1rain", 96],
    ["fx2soundtrack", 97],
    ["fx3crystal", 98],
    ["fx4atmosphere", 99],
    ["fx5brightness", 100],
    ["fx6goblins", 101],
    ["fx7echoes", 102],
    ["fx8scifi", 103],
    ["sitar", 104],
    ["banjo", 105],
    ["shamisen", 106],
    ["koto", 107],
    ["kalimba", 108],
    ["bagpipe", 109],
    ["fiddle", 110],
    ["shanai", 111],
    ["tinklebell", 112],
    ["agogo", 113],
    ["steeldrums", 114],
    ["woodblock", 115],
    ["taikodrum", 116],
    ["melodictom", 117],
    ["synthdrum", 118],
    ["reversecymbal", 119],
    ["guitarfretnoise", 120],
    ["breathnoise", 121],
    ["seashore", 122],
    ["birdtweet", 123],
    ["telephonering", 124],
    ["helicopter", 125],
    ["applause", 126],
    ["gunshot", 127],
  ]);
  var Lt = hn;
  var Bt = class {
    constructor() {
      this.name = "";
      this.firstFret = 1;
      this.strings = [];
      this.barreFrets = [];
      this.showName = !0;
      this.showDiagram = !0;
      this.showFingering = !0;
    }
    get uniqueId() {
      return [
        this.name,
        this.firstFret.toString(),
        this.strings.join(","),
        this.barreFrets.join(","),
        this.showDiagram.toString(),
        this.showFingering.toString(),
        this.showName.toString(),
      ].join("|");
    }
  };
  var Oe = class extends te {
    constructor(t) {
      super(1, t);
    }
  };
  var Qr = class Qr {
    constructor(t, e, r, i = 255) {
      this.raw = 0;
      (this.raw =
        ((i & 255) << 24) | ((t & 255) << 16) | ((e & 255) << 8) | (r & 255)),
        this.updateRgba();
    }
    updateRgba() {
      this.a === 255
        ? (this.rgba = `#${A.toHexString(this.r, 2)}${A.toHexString(
            this.g,
            2
          )}${A.toHexString(this.b, 2)}`)
        : (this.rgba = `rgba(${this.r},${this.g},${this.b},${this.a / 255})`);
    }
    get a() {
      return (this.raw >> 24) & 255;
    }
    get r() {
      return (this.raw >> 16) & 255;
    }
    get g() {
      return (this.raw >> 8) & 255;
    }
    get b() {
      return this.raw & 255;
    }
    static random(t = 100) {
      return new Qr(
        (Math.random() * 255) | 0,
        (Math.random() * 255) | 0,
        (Math.random() * 255) | 0,
        t
      );
    }
    static fromJson(t) {
      if (t instanceof Qr) return t;
      switch (typeof t) {
        case "number": {
          let e = new Qr(0, 0, 0, 0);
          return (e.raw = t), e.updateRgba(), e;
        }
        case "string": {
          let e = t;
          if (e.startsWith("#")) {
            if (e.length === 4)
              return new Qr(
                Number.parseInt(e[1], 16) * 17,
                Number.parseInt(e[2], 16) * 17,
                Number.parseInt(e[3], 16) * 17
              );
            if (e.length === 5)
              return new Qr(
                Number.parseInt(e[1], 16) * 17,
                Number.parseInt(e[2], 16) * 17,
                Number.parseInt(e[3], 16) * 17,
                Number.parseInt(e[4], 16) * 17
              );
            if (e.length === 7)
              return new Qr(
                Number.parseInt(e.substring(1, 3), 16),
                Number.parseInt(e.substring(3, 5), 16),
                Number.parseInt(e.substring(5, 7), 16)
              );
            if (e.length === 9)
              return new Qr(
                Number.parseInt(e.substring(1, 3), 16),
                Number.parseInt(e.substring(3, 5), 16),
                Number.parseInt(e.substring(5, 7), 16),
                Number.parseInt(e.substring(7, 9), 16)
              );
          } else if (e.startsWith("rgba") || e.startsWith("rgb")) {
            let r = e.indexOf("("),
              i = e.lastIndexOf(")");
            if (r === -1 || i === -1)
              throw new Oe("No values specified for rgb/rgba function");
            let n = e.substring(r + 1, i).split(",");
            if (n.length === 3)
              return new Qr(
                Number.parseInt(n[0], 10),
                Number.parseInt(n[1], 10),
                Number.parseInt(n[2], 10)
              );
            if (n.length === 4)
              return new Qr(
                Number.parseInt(n[0], 10),
                Number.parseInt(n[1], 10),
                Number.parseInt(n[2], 10),
                Number.parseFloat(n[3]) * 255
              );
          }
          return null;
        }
      }
      throw new Oe("Unsupported format for color");
    }
    static toJson(t) {
      return t === null ? null : t.raw;
    }
  };
  Qr.BlackRgb = "#000000";
  var ae = Qr;
  var ht = class ht {
    constructor() {
      this.startBar = 0;
      this.text = "";
    }
    finish(t = !1) {
      (this.chunks = []), this._parse(this.text, 0, this.chunks, t);
    }
    _parse(t, e, r, i) {
      if (!t) return;
      let n = 1,
        s = 1,
        a = !1,
        o = 0;
      for (; e < t.length; ) {
        let l = t.charCodeAt(e);
        switch (n) {
          case 0:
            switch (l) {
              case ht._charCodeLF:
              case ht._charCodeCR:
              case ht._charCodeTab:
                break;
              case ht._charCodeSpace:
                if (!a) {
                  n = s;
                  continue;
                }
                break;
              default:
                (a = !1), (n = s);
                continue;
            }
            break;
          case 1:
            if (l === ht._charCodeBrackedOpen) n = 3;
            else {
              (o = e), (n = 2);
              continue;
            }
            break;
          case 3:
            l === ht._charCodeBrackedClose && (n = 1);
            break;
          case 2:
            switch (l) {
              case ht._charCodeDash:
                n = 4;
                break;
              case ht._charCodeCR:
              case ht._charCodeLF:
              case ht._charCodeSpace:
                let u = t.substr(o, e - o);
                this._addChunk(u, i), (n = 0), (s = 1);
                break;
            }
            break;
          case 4:
            if (l !== ht._charCodeDash) {
              let u = t.substr(o, e - o);
              this._addChunk(u, i), (a = !0), (n = 0), (s = 1);
              continue;
            }
            break;
        }
        e += 1;
      }
      n === 2 && e !== o && this._addChunk(t.substr(o, e - o), i);
    }
    _addChunk(t, e) {
      (t = this._prepareChunk(t)),
        (!e || (t.length > 0 && t !== "-")) && this.chunks.push(t);
    }
    _prepareChunk(t) {
      let e = t.split("+").join(" "),
        r = e.length;
      for (; r > 0 && e.charAt(r - 1) === "_"; ) r--;
      return r !== e.length ? e.substr(0, r) : e;
    }
  };
  (ht._charCodeLF = 10),
    (ht._charCodeTab = 9),
    (ht._charCodeCR = 13),
    (ht._charCodeSpace = 32),
    (ht._charCodeBrackedClose = 93),
    (ht._charCodeBrackedOpen = 91),
    (ht._charCodeDash = 45);
  var Rr = ht;
  var vr = class {
    constructor() {
      this.marker = "";
      this.text = "";
    }
  };
  var D = class D {
    static getTextForTuning(t, e) {
      let r = D.getTextPartsForTuning(t);
      return e ? r.join("") : r[0];
    }
    static getTextPartsForTuning(t, e = -1) {
      let r = (t / 12) | 0,
        i = t % 12;
      return [D.noteNames[i], (r + e).toString()];
    }
    static getDefaultTuningFor(t) {
      if (D._defaultTunings.has(t)) {
        let e = D._defaultTunings.get(t);
        return new D(e.name, e.tunings, e.isStandard);
      }
      return null;
    }
    static getPresetsFor(t) {
      switch (t) {
        case 7:
          return D._sevenStrings;
        case 6:
          return D._sixStrings;
        case 5:
          return D._fiveStrings;
        case 4:
          return D._fourStrings;
      }
      return [];
    }
    static initialize() {
      D._defaultTunings.set(
        7,
        new D("Guitar 7 strings", [64, 59, 55, 50, 45, 40, 35], !0)
      ),
        D._sevenStrings.push(D._defaultTunings.get(7)),
        D._defaultTunings.set(
          6,
          new D("Guitar Standard Tuning", [64, 59, 55, 50, 45, 40], !0)
        ),
        D._sixStrings.push(D._defaultTunings.get(6)),
        D._sixStrings.push(
          new D("Guitar Tune down \xBD step", [63, 58, 54, 49, 44, 39], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Tune down 1 step", [62, 57, 53, 48, 43, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Tune down 2 step", [60, 55, 51, 46, 41, 36], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Dropped D Tuning", [64, 59, 55, 50, 45, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Dropped D Tuning variant", [64, 57, 55, 50, 45, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Double Dropped D Tuning", [62, 59, 55, 50, 45, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Dropped E Tuning", [66, 61, 57, 52, 47, 40], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Dropped C Tuning", [62, 57, 53, 48, 43, 36], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open C Tuning", [64, 60, 55, 48, 43, 36], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open Cm Tuning", [63, 60, 55, 48, 43, 36], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open C6 Tuning", [64, 57, 55, 48, 43, 36], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open Cmaj7 Tuning", [64, 59, 55, 52, 43, 36], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open D Tuning", [62, 57, 54, 50, 45, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open Dm Tuning", [62, 57, 53, 50, 45, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open D5 Tuning", [62, 57, 50, 50, 45, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open D6 Tuning", [62, 59, 54, 50, 45, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open Dsus4 Tuning", [62, 57, 55, 50, 45, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open E Tuning", [64, 59, 56, 52, 47, 40], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open Em Tuning", [64, 59, 55, 52, 47, 40], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open Esus11 Tuning", [64, 59, 55, 52, 45, 40], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open F Tuning", [65, 60, 53, 48, 45, 41], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open G Tuning", [62, 59, 55, 50, 43, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open Gm Tuning", [62, 58, 55, 50, 43, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open G6 Tuning", [64, 59, 55, 50, 43, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open Gsus4 Tuning", [62, 60, 55, 50, 43, 38], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open A Tuning", [64, 61, 57, 52, 45, 40], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Open Am Tuning", [64, 60, 57, 52, 45, 40], !1)
        ),
        D._sixStrings.push(
          new D("Guitar Nashville Tuning", [64, 59, 67, 62, 57, 52], !1)
        ),
        D._sixStrings.push(
          new D("Bass 6 Strings Tuning", [48, 43, 38, 33, 28, 23], !1)
        ),
        D._sixStrings.push(
          new D("Lute or Vihuela Tuning", [64, 59, 54, 50, 45, 40], !1)
        ),
        D._defaultTunings.set(
          5,
          new D("Bass 5 Strings Tuning", [43, 38, 33, 28, 23], !0)
        ),
        D._fiveStrings.push(D._defaultTunings.get(5)),
        D._fiveStrings.push(
          new D("Banjo Dropped C Tuning", [62, 59, 55, 48, 67], !1)
        ),
        D._fiveStrings.push(
          new D("Banjo Open D Tuning", [62, 57, 54, 50, 69], !1)
        ),
        D._fiveStrings.push(
          new D("Banjo Open G Tuning", [62, 59, 55, 50, 67], !1)
        ),
        D._fiveStrings.push(
          new D("Banjo G Minor Tuning", [62, 58, 55, 50, 67], !1)
        ),
        D._fiveStrings.push(
          new D("Banjo G Modal Tuning", [62, 57, 55, 50, 67], !1)
        ),
        D._defaultTunings.set(
          4,
          new D("Bass Standard Tuning", [43, 38, 33, 28], !0)
        ),
        D._fourStrings.push(D._defaultTunings.get(4)),
        D._fourStrings.push(
          new D("Bass Tune down \xBD step", [42, 37, 32, 27], !1)
        ),
        D._fourStrings.push(
          new D("Bass Tune down 1 step", [41, 36, 31, 26], !1)
        ),
        D._fourStrings.push(
          new D("Bass Tune down 2 step", [39, 34, 29, 24], !1)
        ),
        D._fourStrings.push(
          new D("Bass Dropped D Tuning", [43, 38, 33, 26], !1)
        ),
        D._fourStrings.push(new D("Ukulele C Tuning", [45, 40, 36, 43], !1)),
        D._fourStrings.push(new D("Ukulele G Tuning", [52, 47, 43, 38], !1)),
        D._fourStrings.push(
          new D("Mandolin Standard Tuning", [64, 57, 50, 43], !1)
        ),
        D._fourStrings.push(
          new D("Mandolin or Violin Tuning", [76, 69, 62, 55], !1)
        ),
        D._fourStrings.push(new D("Viola Tuning", [69, 62, 55, 48], !1)),
        D._fourStrings.push(new D("Cello Tuning", [57, 50, 43, 36], !1));
    }
    static findTuning(t) {
      let e = D.getPresetsFor(t.length);
      for (let r = 0, i = e.length; r < i; r++) {
        let n = e[r],
          s = !0;
        for (let a = 0, o = t.length; a < o; a++)
          if (t[a] !== n.tunings[a]) {
            s = !1;
            break;
          }
        if (s) return new D(n.name, n.tunings, n.isStandard);
      }
      return null;
    }
    constructor(t = "", e = null, r = !1) {
      (this.isStandard = r), (this.name = t), (this.tunings = e ?? []);
    }
    reset() {
      (this.isStandard = !1), (this.name = ""), (this.tunings = []);
    }
    finish() {
      let t = D.findTuning(this.tunings);
      t &&
        (this.name.length === 0 && (this.name = t.name),
        (this.isStandard = t.isStandard));
    }
  };
  (D._sevenStrings = []),
    (D._sixStrings = []),
    (D._fiveStrings = []),
    (D._fourStrings = []),
    (D._defaultTunings = new Map()),
    (D.noteNames = [
      "C",
      "Db",
      "D",
      "Eb",
      "E",
      "F",
      "Gb",
      "G",
      "Ab",
      "A",
      "Bb",
      "B",
    ]);
  var lt = D;
  lt.initialize();
  var Zl = class Zl {
    constructor() {
      this.index = 0;
      this.bars = [];
      this.chords = null;
      this.capo = 0;
      this.transpositionPitch = 0;
      this.displayTranspositionPitch = 0;
      this.stringTuning = new lt("", [], !1);
      this.showSlash = !1;
      this.showNumbered = !1;
      this.showTablature = !0;
      this.showStandardNotation = !0;
      this.isPercussion = !1;
      this.standardNotationLineCount = Zl.DefaultStandardNotationLineCount;
      this._filledVoices = new Set([0]);
    }
    get tuning() {
      return this.stringTuning.tunings;
    }
    get tuningName() {
      return this.stringTuning.name;
    }
    get isStringed() {
      return this.stringTuning.tunings.length > 0;
    }
    get filledVoices() {
      return this._filledVoices;
    }
    finish(t, e = null) {
      this.isPercussion &&
        ((this.stringTuning.tunings = []),
        (this.showTablature = !1),
        (this.displayTranspositionPitch = 0)),
        this.stringTuning.finish();
      for (let r = 0, i = this.bars.length; r < i; r++) {
        this.bars[r].finish(t, e);
        for (let n of this.bars[r].filledVoices) this._filledVoices.add(n);
      }
    }
    addChord(t, e) {
      e.staff = this;
      let r = this.chords;
      r === null && ((r = new Map()), (this.chords = r)), r.set(t, e);
    }
    hasChord(t) {
      return this.chords?.has(t) ?? !1;
    }
    getChord(t) {
      return this.chords?.get(t) ?? null;
    }
    addBar(t) {
      let e = this.bars;
      (t.staff = this),
        (t.index = e.length),
        e.length > 0 &&
          ((t.previousBar = e[e.length - 1]), (t.previousBar.nextBar = t)),
        e.push(t);
    }
  };
  Zl.DefaultStandardNotationLineCount = 5;
  var _r = Zl;
  var mn = class {
    constructor() {
      this.volume = 15;
      this.balance = 8;
      this.port = 1;
      this.program = 0;
      this.bank = 0;
      this.primaryChannel = 0;
      this.secondaryChannel = 0;
      this.isMute = !1;
      this.isSolo = !1;
    }
  };
  var fn = ((i) => (
      (i[(i.TrackName = 0)] = "TrackName"),
      (i[(i.BracesAndBrackets = 1)] = "BracesAndBrackets"),
      (i[(i.SystemSeparator = 2)] = "SystemSeparator"),
      (i[(i.StringTuning = 3)] = "StringTuning"),
      i
    ))(fn || {}),
    Ks = class extends zt {},
    mo = class mo {
      constructor() {
        this.index = 0;
        this.staves = [];
        this.playbackInfo = new mn();
        this.color = new ae(200, 0, 0, 255);
        this.name = "";
        this.isVisibleOnMultiTrack = !0;
        this.shortName = "";
        this.defaultSystemsLayout = 3;
        this.systemsLayout = [];
        this.percussionArticulations = [];
      }
      get isPercussion() {
        return this.staves.some((t) => t.isPercussion);
      }
      addLineBreaks(t) {
        this.lineBreaks || (this.lineBreaks = new Set()),
          this.lineBreaks.add(t);
      }
      ensureStaveCount(t) {
        for (; this.staves.length < t; ) this.addStaff(new _r());
      }
      addStaff(t) {
        (t.index = this.staves.length), (t.track = this), this.staves.push(t);
      }
      finish(t, e = null) {
        this.shortName ||
          ((this.shortName = this.name),
          this.shortName.length > mo._shortNameMaxLength &&
            (this.shortName = this.shortName.substr(
              0,
              mo._shortNameMaxLength
            )));
        for (let r of this.staves)
          r.finish(t, e), r.isPercussion && (this.playbackInfo.program = 0);
      }
      applyLyrics(t) {
        for (let r of t) r.finish();
        let e = this.staves[0];
        for (let r = 0; r < t.length; r++) {
          let i = t[r];
          if (i.startBar >= 0 && i.startBar < e.bars.length) {
            let n = e.bars[i.startBar].voices[0].beats[0];
            for (let s = 0; s < i.chunks.length && n; s++) {
              for (; n && (n.isEmpty || n.isRest); ) n = n.nextBeat;
              n &&
                (n.lyrics ||
                  ((n.lyrics = new Array(t.length)), n.lyrics.fill("")),
                (n.lyrics[r] = i.chunks[s]),
                (n = n.nextBeat));
            }
          }
        }
      }
    };
  mo._shortNameMaxLength = 10;
  var Tt = mo;
  var Sp = {};
  Bi(Sp, {
    BarBounds: () => bn,
    BeamDirection: () => Ne,
    BeatBounds: () => gn,
    Bounds: () => we,
    BoundsLookup: () => zi,
    MasterBarBounds: () => yn,
    NoteBounds: () => xr,
    RenderFinishedEventArgs: () => $t,
    ScoreRenderer: () => ui,
    StaffSystemBounds: () => Sn,
  });
  var $t = class {
    constructor() {
      this.id = A.newGuid();
      this.x = 0;
      this.y = 0;
      this.width = 0;
      this.height = 0;
      this.totalWidth = 0;
      this.totalHeight = 0;
      this.firstMasterBarIndex = -1;
      this.lastMasterBarIndex = -1;
      this.renderResult = null;
    }
  };
  var Ui = ((e) => (
    (e[(e.Page = 0)] = "Page"), (e[(e.Horizontal = 1)] = "Horizontal"), e
  ))(Ui || {});
  var Be = class {
      constructor(t = void 0) {
        this._listeners = [];
        this._fireOnRegister = t;
      }
      on(t) {
        return (
          this._listeners.push(t),
          this._fireOnRegister?.() && t(),
          () => {
            this.off(t);
          }
        );
      }
      off(t) {
        this._listeners = this._listeners.filter((e) => e !== t);
      }
      trigger() {
        for (let t of this._listeners) t();
      }
    },
    Z = class {
      constructor(t = void 0) {
        this._listeners = [];
        this._fireOnRegister = t;
      }
      on(t) {
        if ((this._listeners.push(t), this._fireOnRegister)) {
          let e = this._fireOnRegister();
          e !== null && t(e);
        }
        return () => {
          this.off(t);
        };
      }
      off(t) {
        this._listeners = this._listeners.filter((e) => e !== t);
      }
      trigger(t) {
        for (let e of this._listeners) e(t);
      }
    };
  var bn = class {
    constructor() {
      this.beats = [];
    }
    addBeat(t) {
      (t.barBounds = this), this.beats.push(t), this.masterBarBounds.addBeat(t);
    }
    findBeatAtPos(t) {
      let e = null;
      for (let r of this.beats)
        if (!e || r.realBounds.x < t) e = r;
        else if (r.realBounds.x > t) break;
      return e;
    }
    finish(t = 1) {
      this.realBounds.scaleWith(t),
        this.visualBounds.scaleWith(t),
        this.beats.sort((e, r) => e.realBounds.x - r.realBounds.x);
      for (let e of this.beats) e.finish(t);
    }
  };
  var gn = class {
    constructor() {
      this.onNotesX = 0;
      this.notes = null;
    }
    addNote(t) {
      this.notes || (this.notes = []),
        (t.beatBounds = this),
        this.notes.push(t);
    }
    findNoteAtPos(t, e) {
      let r = this.notes;
      if (!r) return null;
      for (let i of r) {
        let n = i.noteHeadBounds.y + i.noteHeadBounds.h,
          s = i.noteHeadBounds.x + i.noteHeadBounds.w;
        if (
          i.noteHeadBounds.x <= t &&
          i.noteHeadBounds.y <= e &&
          t <= s &&
          e <= n
        )
          return i.note;
      }
      return null;
    }
    finish(t = 1) {
      if (
        (this.realBounds.scaleWith(t),
        this.visualBounds.scaleWith(t),
        (this.onNotesX *= t),
        this.notes)
      )
        for (let e of this.notes) e.finish(t);
    }
  };
  var we = class {
    constructor() {
      this.x = 0;
      this.y = 0;
      this.w = 0;
      this.h = 0;
    }
    scaleWith(t) {
      (this.x *= t), (this.y *= t), (this.w *= t), (this.h *= t);
    }
  };
  var yn = class {
    constructor() {
      this.index = 0;
      this.isFirstOfLine = !1;
      this.bars = [];
      this.staffSystemBounds = null;
    }
    get staveGroupBounds() {
      return this.staffSystemBounds;
    }
    addBar(t) {
      (t.masterBarBounds = this), this.bars.push(t);
    }
    findBeatAtPos(t) {
      let e = null,
        r = 1e7;
      for (let i of this.bars) {
        let n = i.findBeatAtPos(t);
        if (n && (!e || e.realBounds.x < n.realBounds.x)) {
          let s = Math.abs(n.realBounds.x - t);
          (!e || s < r) && (e = n);
        }
      }
      return e ? e.beat : null;
    }
    finish(t = 1) {
      this.realBounds.scaleWith(t),
        this.visualBounds.scaleWith(t),
        this.lineAlignedBounds.scaleWith(t),
        this.bars.sort((e, r) =>
          e.realBounds.y < r.realBounds.y
            ? -1
            : e.realBounds.y > r.realBounds.y
            ? 1
            : e.realBounds.x < r.realBounds.x
            ? -1
            : e.realBounds.x > r.realBounds.x
            ? 1
            : 0
        );
      for (let e of this.bars) e.finish(t);
    }
    addBeat(t) {
      this.staffSystemBounds.boundsLookup.addBeat(t);
    }
  };
  var xr = class {
    finish(t = 1) {
      this.noteHeadBounds.scaleWith(t);
    }
  };
  var Sn = class {
    constructor() {
      this.index = 0;
      this.bars = [];
    }
    finish(t = 1) {
      this.realBounds.scaleWith(t), this.visualBounds.scaleWith(t);
      for (let e of this.bars) e.finish(t);
    }
    addBar(t) {
      this.boundsLookup.addMasterBar(t),
        (t.staffSystemBounds = this),
        this.bars.push(t);
    }
    findBarAtPos(t) {
      let e = null;
      for (let r of this.bars)
        if (!e || r.realBounds.x < t) e = r;
        else if (t > r.realBounds.x + r.realBounds.w) break;
      return e;
    }
  };
  var zi = class p {
    constructor() {
      this._beatLookup = new Map();
      this._masterBarLookup = new Map();
      this._currentStaffSystem = null;
      this.staffSystems = [];
      this.isFinished = !1;
    }
    toJson() {
      let t = {},
        e = [];
      t.staffSystems = e;
      for (let r of this.staffSystems) {
        let i = {};
        (i.visualBounds = this._boundsToJson(r.visualBounds)),
          (i.realBounds = this._boundsToJson(r.realBounds)),
          (i.bars = []);
        for (let n of r.bars) {
          let s = {};
          (s.lineAlignedBounds = this._boundsToJson(n.lineAlignedBounds)),
            (s.visualBounds = this._boundsToJson(n.visualBounds)),
            (s.realBounds = this._boundsToJson(n.realBounds)),
            (s.index = n.index),
            (s.bars = []);
          for (let a of n.bars) {
            let o = {};
            (o.visualBounds = this._boundsToJson(a.visualBounds)),
              (o.realBounds = this._boundsToJson(a.realBounds)),
              (o.beats = []);
            for (let l of a.beats) {
              let u = {};
              (u.visualBounds = this._boundsToJson(l.visualBounds)),
                (u.realBounds = this._boundsToJson(l.realBounds)),
                (u.onNotesX = l.onNotesX);
              let c = u;
              if (
                ((c.beatIndex = l.beat.index),
                (c.voiceIndex = l.beat.voice.index),
                (c.barIndex = l.beat.voice.bar.index),
                (c.staffIndex = l.beat.voice.bar.staff.index),
                (c.trackIndex = l.beat.voice.bar.staff.track.index),
                l.notes)
              ) {
                let d = [];
                u.notes = d;
                for (let h of l.notes) {
                  let f = {},
                    b = f;
                  (b.index = h.note.index),
                    (f.noteHeadBounds = this._boundsToJson(h.noteHeadBounds)),
                    d.push(f);
                }
              }
              o.beats.push(u);
            }
            s.bars.push(o);
          }
          i.bars.push(s);
        }
        e.push(i);
      }
      return t;
    }
    static fromJson(t, e) {
      let r = new p(),
        i = t.staffSystems;
      for (let n of i) {
        let s = new Sn();
        (s.visualBounds = p._boundsFromJson(n.visualBounds)),
          (s.realBounds = p._boundsFromJson(n.realBounds)),
          r.addStaffSystem(s);
        for (let a of n.bars) {
          let o = new yn();
          (o.index = a.index),
            (o.isFirstOfLine = a.isFirstOfLine),
            (o.lineAlignedBounds = p._boundsFromJson(a.lineAlignedBounds)),
            (o.visualBounds = p._boundsFromJson(a.visualBounds)),
            (o.realBounds = p._boundsFromJson(a.realBounds)),
            s.addBar(o);
          for (let l of a.bars) {
            let u = new bn();
            (u.visualBounds = p._boundsFromJson(l.visualBounds)),
              (u.realBounds = p._boundsFromJson(l.realBounds)),
              o.addBar(u);
            for (let c of l.beats) {
              let d = new gn();
              (d.visualBounds = p._boundsFromJson(c.visualBounds)),
                (d.realBounds = p._boundsFromJson(c.realBounds)),
                (d.onNotesX = c.onNotesX);
              let h = c;
              if (
                ((d.beat =
                  e.tracks[h.trackIndex].staves[h.staffIndex].bars[
                    h.barIndex
                  ].voices[h.voiceIndex].beats[h.beatIndex]),
                c.notes)
              ) {
                d.notes = [];
                for (let f of c.notes) {
                  let b = new xr(),
                    y = f;
                  (b.note = d.beat.notes[y.index]),
                    (b.noteHeadBounds = p._boundsFromJson(f.noteHeadBounds)),
                    d.addNote(b);
                }
              }
              u.addBeat(d);
            }
          }
        }
      }
      return r;
    }
    static _boundsFromJson(t) {
      let e = new we();
      return (e.x = t.x), (e.y = t.y), (e.w = t.w), (e.h = t.h), e;
    }
    _boundsToJson(t) {
      let e = {};
      return (e.x = t.x), (e.y = t.y), (e.w = t.w), (e.h = t.h), e;
    }
    finish(t = 1) {
      for (let e of this.staffSystems) e.finish(t);
      this.isFinished = !0;
    }
    addStaffSystem(t) {
      (t.index = this.staffSystems.length),
        (t.boundsLookup = this),
        this.staffSystems.push(t),
        (this._currentStaffSystem = t);
    }
    addMasterBar(t) {
      t.staffSystemBounds
        ? this._masterBarLookup.set(t.index, t)
        : ((t.staffSystemBounds = this._currentStaffSystem),
          this._masterBarLookup.set(t.index, t),
          this._currentStaffSystem.addBar(t));
    }
    addBeat(t) {
      this._beatLookup.has(t.beat.id) || this._beatLookup.set(t.beat.id, []),
        this._beatLookup.get(t.beat.id)?.push(t);
    }
    findMasterBarByIndex(t) {
      return this._masterBarLookup.has(t) ? this._masterBarLookup.get(t) : null;
    }
    findMasterBar(t) {
      let e = t.index;
      return this._masterBarLookup.has(e) ? this._masterBarLookup.get(e) : null;
    }
    findBeat(t) {
      let e = this.findBeats(t);
      return e ? e[0] : null;
    }
    findBeats(t) {
      let e = t.id;
      return this._beatLookup.has(e) ? this._beatLookup.get(e) : null;
    }
    getBeatAtPos(t, e) {
      let r = 0,
        i = this.staffSystems.length - 1,
        n = -1;
      for (; r <= i; ) {
        let o = ((i + r) / 2) | 0,
          l = this.staffSystems[o];
        if (e >= l.realBounds.y && e <= l.realBounds.y + l.realBounds.h) {
          n = o;
          break;
        }
        e < l.realBounds.y ? (i = o - 1) : (r = o + 1);
      }
      if (n === -1) return null;
      let a = this.staffSystems[n].findBarAtPos(t);
      return a ? a.findBeatAtPos(t) : null;
    }
    getNoteAtPos(t, e, r) {
      let i = this.findBeats(t);
      if (i)
        for (let n of i) {
          let s = n.findNoteAtPos(e, r);
          if (s) return s;
        }
      return null;
    }
  };
  var ui = class {
    constructor(t) {
      this._currentLayoutMode = 0;
      this._currentRenderEngine = null;
      this._renderedTracks = null;
      this.canvas = null;
      this.score = null;
      this.tracks = null;
      this.layout = null;
      this.boundsLookup = null;
      this.width = 0;
      this.preRender = new Z();
      this.renderFinished = new Z();
      this.partialRenderFinished = new Z();
      this.partialLayoutFinished = new Z();
      this.postRenderFinished = new Be();
      this.error = new Z();
      (this.settings = t), this._recreateCanvas(), this._recreateLayout();
    }
    destroy() {
      (this.score = null),
        this.canvas?.destroy(),
        (this.canvas = null),
        (this.layout = null),
        (this.boundsLookup = null),
        (this.tracks = null);
    }
    _recreateCanvas() {
      return this._currentRenderEngine !== this.settings.core.engine
        ? (this.canvas?.destroy(),
          (this.canvas = J.getRenderEngineFactory(
            this.settings.core.engine
          ).createCanvas()),
          (this._currentRenderEngine = this.settings.core.engine),
          !0)
        : !1;
    }
    _recreateLayout() {
      return !this.layout ||
        this._currentLayoutMode !== this.settings.display.layoutMode
        ? ((this.layout = J.getLayoutEngineFactory(
            this.settings.display.layoutMode
          ).createLayout(this)),
          (this._currentLayoutMode = this.settings.display.layoutMode),
          !0)
        : !1;
    }
    renderScore(t, e) {
      try {
        this.score = t;
        let r = null;
        if (t != null && e != null) {
          if (!e) r = t.tracks.slice(0);
          else {
            r = [];
            for (let i of e)
              i >= 0 && i < t.tracks.length && r.push(t.tracks[i]);
          }
          r.length === 0 && t.tracks.length > 0 && r.push(t.tracks[0]);
        }
        (this.tracks = r), this.render();
      } catch (r) {
        this.error.trigger(r);
      }
    }
    renderTracks(t) {
      t.length === 0 ? (this.score = null) : (this.score = t[0].score),
        (this.tracks = t),
        this.render();
    }
    updateSettings(t) {
      this.settings = t;
    }
    renderResult(t) {
      try {
        let e = this.layout;
        e
          ? (w.debug("Rendering", `Request render of lazy partial ${t}`),
            e.renderLazyPartial(t))
          : w.warning(
              "Rendering",
              `Request render of lazy partial ${t} ignored, no layout exists`
            );
      } catch (e) {
        this.error.trigger(e);
      }
    }
    render() {
      if (this.width === 0) {
        w.warning(
          "Rendering",
          "AlphaTab skipped rendering because of width=0 (element invisible)",
          null
        );
        return;
      }
      if (
        ((this.boundsLookup = new zi()),
        this._recreateCanvas(),
        (this.canvas.lineWidth = 1),
        (this.canvas.settings = this.settings),
        !this.tracks || this.tracks.length === 0 || !this.score)
      )
        w.debug(
          "Rendering",
          "Clearing rendered tracks because no score or tracks are set"
        ),
          this.preRender.trigger(!1),
          (this._renderedTracks = null),
          this._onRenderFinished(),
          this.postRenderFinished.trigger(),
          w.debug("Rendering", "Clearing finished");
      else {
        w.debug("Rendering", `Rendering ${this.tracks.length} tracks`);
        for (let t = 0; t < this.tracks.length; t++) {
          let e = this.tracks[t];
          w.debug("Rendering", `Track ${t}: ${e.name}`);
        }
        this.preRender.trigger(!1),
          this._recreateLayout(),
          this._layoutAndRender(),
          w.debug("Rendering", "Rendering finished");
      }
    }
    resizeRender() {
      this._recreateLayout() ||
      this._recreateCanvas() ||
      this._renderedTracks !== this.tracks ||
      !this.tracks
        ? (w.debug(
            "Rendering",
            "Starting full rerendering due to layout or canvas change",
            null
          ),
          this.render())
        : this.layout.supportsResize
        ? (w.debug("Rendering", "Starting optimized rerendering for resize"),
          (this.boundsLookup = new zi()),
          this.preRender.trigger(!0),
          (this.canvas.settings = this.settings),
          this.layout.resize(),
          this._onRenderFinished(),
          this.postRenderFinished.trigger())
        : w.debug(
            "Rendering",
            "Current layout does not support dynamic resizing, nothing was done",
            null
          ),
        w.debug("Rendering", "Resize finished");
    }
    _layoutAndRender() {
      w.debug(
        "Rendering",
        `Rendering at scale ${this.settings.display.scale} with layout ${this.layout.name}`,
        null
      ),
        this.layout.layoutAndRender(),
        (this._renderedTracks = this.tracks),
        this._onRenderFinished(),
        this.postRenderFinished.trigger();
    }
    _onRenderFinished() {
      this.boundsLookup?.finish(this.settings.display.scale);
      let t = new $t();
      (t.totalHeight = this.layout.height),
        (t.totalWidth = this.layout.width),
        (t.renderResult = this.canvas.onRenderFinished()),
        this.renderFinished.trigger(t);
    }
  };
  var Ne = ((e) => ((e[(e.Up = 0)] = "Up"), (e[(e.Down = 1)] = "Down"), e))(
    Ne || {}
  );
  var Y = class Y {
    constructor() {
      this._allKnownBarMetaDataTags = void 0;
      this._knownScoreMetaDataTags = void 0;
      this._knownStructuralMetaDataTags = void 0;
      this._knownBarMetaDataTags = void 0;
      this._knownStaffMetaDataTags = void 0;
      this._knownBeatDurationProperties = void 0;
      this._knownBeatProperties = void 0;
      this._knownNoteProperties = void 0;
    }
    applyScoreMetaData(t, e, r) {
      let i = this._checkValueListTypes(
        t,
        [Ie.scoreMetaDataValueListTypes],
        r,
        r.tag.tag.text.toLowerCase(),
        r.values
      );
      if (i !== void 0) return i;
      switch (r.tag.tag.text.toLowerCase()) {
        case "title":
          return (
            (e.title = r.values.values[0].text),
            this._headerFooterStyle(t, e, 0, r),
            0
          );
        case "subtitle":
          return (
            (e.subTitle = r.values.values[0].text),
            this._headerFooterStyle(t, e, 1, r),
            0
          );
        case "artist":
          return (
            (e.artist = r.values.values[0].text),
            this._headerFooterStyle(t, e, 2, r),
            0
          );
        case "album":
          return (
            (e.album = r.values.values[0].text),
            this._headerFooterStyle(t, e, 3, r),
            0
          );
        case "words":
          return (
            (e.words = r.values.values[0].text),
            this._headerFooterStyle(t, e, 4, r),
            0
          );
        case "music":
          return (
            (e.music = r.values.values[0].text),
            this._headerFooterStyle(t, e, 5, r),
            0
          );
        case "copyright":
          return (
            (e.copyright = r.values.values[0].text),
            this._headerFooterStyle(t, e, 8, r),
            0
          );
        case "instructions":
          return (e.instructions = r.values.values[0].text), 0;
        case "notices":
          return (e.notices = r.values.values[0].text), 0;
        case "tab":
          return (
            (e.tab = r.values.values[0].text),
            this._headerFooterStyle(t, e, 7, r),
            0
          );
        case "copyright2":
          return this._headerFooterStyle(t, e, 9, r, 0), 0;
        case "wordsandmusic":
          return this._headerFooterStyle(t, e, 6, r, 0), 0;
        case "defaultsystemslayout":
          return (e.defaultSystemsLayout = r.values.values[0].value), 0;
        case "systemslayout":
          for (let d of r.values.values) e.systemsLayout.push(d.value);
          return 0;
        case "hidedynamics":
          return (e.stylesheet.hideDynamics = !0), 0;
        case "showdynamics":
          return (e.stylesheet.hideDynamics = !1), 0;
        case "bracketextendmode":
          let n = Y._parseEnumValue(
            t,
            r.values,
            "bracket extend mode",
            re.bracketExtendModes
          );
          return n === void 0 ? 1 : ((e.stylesheet.bracketExtendMode = n), 0);
        case "usesystemsignseparator":
          return (e.stylesheet.useSystemSignSeparator = !0), 0;
        case "multibarrest":
          return (e.stylesheet.multiTrackMultiBarRest = !0), 0;
        case "singletracktracknamepolicy":
          let s = Y._parseEnumValue(
            t,
            r.values,
            "track name policy",
            re.trackNamePolicies
          );
          return s === void 0
            ? 1
            : ((e.stylesheet.singleTrackTrackNamePolicy = s), 0);
        case "multitracktracknamepolicy":
          let a = Y._parseEnumValue(
            t,
            r.values,
            "track name policy",
            re.trackNamePolicies
          );
          return a === void 0
            ? 1
            : ((e.stylesheet.multiTrackTrackNamePolicy = a), 0);
        case "firstsystemtracknamemode":
          let o = Y._parseEnumValue(
            t,
            r.values,
            "track name mode",
            re.trackNameMode
          );
          return o === void 0
            ? 1
            : ((e.stylesheet.firstSystemTrackNameMode = o), 0);
        case "othersystemstracknamemode":
          let l = Y._parseEnumValue(
            t,
            r.values,
            "track name mode",
            re.trackNameMode
          );
          return l === void 0
            ? 1
            : ((e.stylesheet.otherSystemsTrackNameMode = l), 0);
        case "firstsystemtracknameorientation":
          let u = Y._parseEnumValue(
            t,
            r.values,
            "track name orientation",
            re.trackNameOrientations
          );
          return u === void 0
            ? 1
            : ((e.stylesheet.firstSystemTrackNameOrientation = u), 0);
        case "othersystemstracknameorientation":
          let c = Y._parseEnumValue(
            t,
            r.values,
            "track name orientation",
            re.trackNameOrientations
          );
          return c === void 0
            ? 1
            : ((e.stylesheet.otherSystemsTrackNameOrientation = c), 0);
        default:
          return 2;
      }
    }
    _checkValueListTypes(t, e, r, i, n) {
      let s = e.find((o) => o.has(i));
      if (!s) return 2;
      let a = s.get(i);
      if (a === void 0) {
        n &&
          t.addSemanticDiagnostic({
            code: 300,
            message: "Expected no values, but found some. Values are ignored.",
            start: n.start,
            end: n.end,
            severity: 1,
          });
        return;
      }
      if (!this._validateValueListTypes(t, a, r, n)) return 1;
    }
    applyStaffMetaData(t, e, r) {
      let i = this._checkValueListTypes(
        t,
        [Ie.staffMetaDataValueListTypes],
        r,
        r.tag.tag.text.toLowerCase(),
        r.values
      );
      if (i !== void 0) return i;
      switch (r.tag.tag.text.toLowerCase()) {
        case "capo":
          return (e.capo = r.values.values[0].value), 0;
        case "tuning":
          let n = [],
            s = !1,
            a = "";
          for (let d = 0; d < r.values.values.length; d++) {
            let h = r.values.values[d],
              f = h.text;
            switch (f) {
              case "piano":
              case "none":
              case "voice":
                t.applyStaffNoteKind(e, 0), (d = r.values.values.length);
                break;
              case "hide":
                (s = !0),
                  t.addSemanticDiagnostic({
                    code: 305,
                    message:
                      "This value should be rather specified via the properties.",
                    start: h.start,
                    end: h.end,
                    severity: 1,
                  });
                break;
              default:
                let b = A.parseTuning(f);
                if (b) n.push(b.realValue);
                else if (d === r.values.values.length - 1 && n.length > 0)
                  (a = f),
                    t.addSemanticDiagnostic({
                      code: 305,
                      message:
                        "This value should be rather specified via the properties.",
                      start: h.start,
                      end: h.end,
                      severity: 1,
                    });
                else {
                  let y = Array.from(A.tuningLetters).join(","),
                    S = Array.from(A.accidentalModeMapping.keys()).join(",");
                  t.addSemanticDiagnostic({
                    code: 209,
                    message: `Unexpected tuning value '${f}', expected: <note><accidental><octave> where <note>=oneOf(${y}) <accidental>=oneOf(${S}), <octave>=number`,
                    start: h.start,
                    end: h.end,
                    severity: 2,
                  });
                }
                break;
            }
          }
          return (
            t.state.staffHasExplicitTuning.add(e),
            t.state.staffTuningApplied.delete(e),
            (e.stringTuning = new lt()),
            (e.stringTuning.tunings = n),
            (e.stringTuning.name = a),
            this._tuningProperties(t, e, e.stringTuning, r),
            s &&
              (e.track.score.stylesheet.perTrackDisplayTuning ||
                (e.track.score.stylesheet.perTrackDisplayTuning = new Map()),
              e.track.score.stylesheet.perTrackDisplayTuning.set(
                e.track.index,
                !1
              )),
            0
          );
        case "instrument":
          return (
            t.state.staffTuningApplied.delete(e),
            this._readTrackInstrument(t, e.track, r.values),
            0
          );
        case "bank":
          return (e.track.playbackInfo.bank = r.values.values[0].value), 0;
        case "lyrics":
          let o = new Rr();
          return (
            (o.startBar = 0),
            (o.text = ""),
            r.values.values.length === 2
              ? ((o.startBar = r.values.values[0].value),
                (o.text = r.values.values[1].text))
              : (o.text = r.values.values[0].text),
            t.state.lyrics.get(e.track.index).push(o),
            0
          );
        case "chord":
          let l = new Bt();
          this._chordProperties(t, l, r), (l.name = r.values.values[0].text);
          for (let d = 1; d < r.values.values.length; d++) {
            let h = r.values.values[d];
            if (h.nodeType === 16) l.strings.push(h.value);
            else if (h.nodeType === 10) {
              let f = h.text;
              f === "x"
                ? l.strings.push(-1)
                : t.addSemanticDiagnostic({
                    code: 209,
                    message: `Unexpected chord value '${f}', expected: 'x'`,
                    severity: 2,
                    start: h.start,
                    end: h.end,
                  });
            }
          }
          return e.addChord(Y._getChordId(e, l.name), l), 0;
        case "articulation":
          let u = t.state.percussionArticulationNames,
            c = r.values.values[0].text;
          if (c === "defaults") {
            for (let [d, h] of He.instrumentArticulationNames)
              u.set(d.toLowerCase(), h), u.set(A.toArticulationId(d), h);
            return 0;
          }
          if (r.values.values.length === 2) {
            let d = r.values.values[1].value;
            if (He.instrumentArticulations.has(d))
              return u.set(c.toLowerCase(), d), 0;
            {
              let h = Array.from(He.instrumentArticulations.keys())
                .map((f) => `${f}`)
                .join(",");
              return (
                t.addSemanticDiagnostic({
                  code: 209,
                  message: `Unexpected articulation value '${d}', expected: ${h}`,
                  start: r.values.values[1].start,
                  end: r.values.values[1].end,
                  severity: 2,
                }),
                1
              );
            }
          }
          return 0;
        case "accidentals":
          return Y._handleAccidentalMode(t, r.values);
        case "displaytranspose":
          return (
            (e.displayTranspositionPitch = r.values.values[0].value * -1),
            t.state.staffHasExplicitDisplayTransposition.add(e),
            0
          );
        case "transpose":
          return (e.transpositionPitch = r.values.values[0].value * -1), 0;
        default:
          return 2;
      }
    }
    applyBarMetaData(t, e, r) {
      let i = this._checkValueListTypes(
        t,
        [Ie.barMetaDataValueListTypes],
        r,
        r.tag.tag.text.toLowerCase(),
        r.values
      );
      if (i !== void 0) return i;
      switch (r.tag.tag.text.toLowerCase()) {
        case "sync":
          let n = this._buildSyncPoint(r);
          return t.state.syncPoints.push(n), 0;
        case "tempo":
          let s = 0,
            a = r.values.values[s++].value,
            o = "",
            l = !0,
            u = 0;
          for (; s < r.values.values.length; ) {
            switch (r.values.values[s].nodeType) {
              case 10:
              case 17:
                let g = r.values.values[s].text;
                g === "hide" ? (l = !1) : (o = g);
                break;
              case 16:
                u = r.values.values[s].value;
                break;
            }
            s++;
          }
          let c = e.masterBar.tempoAutomations.find(
            (g) => g.ratioPosition === u
          );
          return (
            c || ((c = new he()), e.masterBar.tempoAutomations.push(c)),
            (c.isLinear = !1),
            (c.type = 0),
            (c.value = a),
            (c.text = o),
            (c.ratioPosition = u),
            (c.isVisible = l),
            0
          );
        case "rc":
          return (e.masterBar.repeatCount = r.values.values[0].value), 0;
        case "ae":
          for (let g of r.values.values)
            if (g.nodeType === 16) {
              let x = g.value;
              if (x < 1 || x > 31)
                return (
                  t.addSemanticDiagnostic({
                    code: 211,
                    message:
                      "Value is out of valid range. Allowed range: %s, Actual Value: %s",
                    severity: 2,
                    start: g.start,
                    end: g.end,
                  }),
                  1
                );
              e.masterBar.alternateEndings |= 1 << (x - 1);
            } else
              t.addSemanticDiagnostic({
                code: 202,
                message: `Unexpected '${
                  St[g.nodeType]
                }' token. Expected one of following: ${St[16]}`,
                severity: 2,
                start: g.start,
                end: g.end,
              });
          return 0;
        case "ts":
          switch (r.values.values[0].nodeType) {
            case 16:
              (e.masterBar.timeSignatureNumerator = r.values.values[0].value),
                (e.masterBar.timeSignatureDenominator =
                  r.values.values[1].value);
              break;
            case 10:
            case 17:
              let g = r.values.values[0].text;
              if (g.toLowerCase() === "common")
                (e.masterBar.timeSignatureCommon = !0),
                  (e.masterBar.timeSignatureNumerator = 4),
                  (e.masterBar.timeSignatureDenominator = 4);
              else
                return (
                  t.addSemanticDiagnostic({
                    code: 209,
                    message: `Unexpected time signature value '${g}', expected: common or two numbers`,
                    severity: 2,
                    start: r.values.values[0].start,
                    end: r.values.values[0].end,
                  }),
                  1
                );
              break;
          }
          return 0;
        case "ks":
          let d = Y._parseEnumValue(
            t,
            r.values,
            "key signature",
            re.keySignatures
          );
          if (d === void 0) return 1;
          let h = Y._parseEnumValue(
            t,
            r.values,
            "key signature type",
            re.keySignatureTypes
          );
          return h === void 0
            ? 1
            : ((e.keySignature = d), (e.keySignatureType = h), 0);
        case "clef":
          switch (r.values.values[0].nodeType) {
            case 10:
            case 17:
              let g = Y._parseEnumValue(t, r.values, "clef", re.clefs);
              if (g === void 0) return 1;
              e.clef = g;
              break;
            case 16:
              let x = r.values.values[0].value;
              switch (x) {
                case 0:
                  e.clef = 0;
                  break;
                case 43:
                  e.clef = 4;
                  break;
                case 65:
                  e.clef = 3;
                  break;
                case 48:
                  e.clef = 1;
                  break;
                case 60:
                  e.clef = 2;
                  break;
                default:
                  return (
                    t.addSemanticDiagnostic({
                      code: 209,
                      message: `Unexpected clef value '${x}', expected: ${Array.from(
                        re.clefs.keys()
                      ).join(",")}`,
                      severity: 2,
                      start: r.values.values[0].start,
                      end: r.values.values[0].end,
                    }),
                    1
                  );
              }
              break;
          }
          return 0;
        case "section":
          let f = new vr();
          return (
            r.values.values.length === 1
              ? (f.text = r.values.values[0].text)
              : ((f.marker = r.values.values[0].text),
                (f.text = r.values.values[1].text)),
            (e.masterBar.section = f),
            0
          );
        case "tf":
          switch (r.values.values[0].nodeType) {
            case 10:
            case 17:
              let g = Y._parseEnumValue(
                t,
                r.values,
                "triplet feel",
                re.tripletFeels
              );
              if (g === void 0) return 1;
              e.masterBar.tripletFeel = g;
              break;
            case 16:
              let x = r.values.values[0].value;
              switch (x) {
                case 0:
                  e.masterBar.tripletFeel = 0;
                  break;
                case 1:
                  e.masterBar.tripletFeel = 1;
                  break;
                case 2:
                  e.masterBar.tripletFeel = 2;
                  break;
                case 3:
                  e.masterBar.tripletFeel = 3;
                  break;
                case 4:
                  e.masterBar.tripletFeel = 4;
                  break;
                case 5:
                  e.masterBar.tripletFeel = 5;
                  break;
                case 6:
                  e.masterBar.tripletFeel = 6;
                  break;
                default:
                  return (
                    t.addSemanticDiagnostic({
                      code: 209,
                      message: `Unexpected triplet feel value '${x}', expected: ${Array.from(
                        re.tripletFeels.keys()
                      ).join(",")}`,
                      severity: 2,
                      start: r.values.values[0].start,
                      end: r.values.values[0].end,
                    }),
                    1
                  );
              }
              break;
          }
          return 0;
        case "barlineleft":
          let b = Y._parseEnumValue(t, r.values, "bar line", re.barLines);
          return b === void 0 ? 1 : ((e.barLineLeft = b), 0);
        case "barlineright":
          let y = Y._parseEnumValue(t, r.values, "bar line", re.barLines);
          return y === void 0 ? 1 : ((e.barLineRight = y), 0);
        case "accidentals":
          return Y._handleAccidentalMode(t, r.values);
        case "jump":
          let S = Y._parseEnumValue(t, r.values, "direction", re.directions);
          return S === void 0 ? 1 : (e.masterBar.addDirection(S), 0);
        case "ottava":
          let k = Y._parseEnumValue(t, r.values, "clef ottava", re.ottavia);
          return k === void 0 ? 1 : ((e.clefOttava = k), 0);
        case "simile":
          let T = Y._parseEnumValue(t, r.values, "simile mark", re.simileMarks);
          return T === void 0 ? 1 : ((e.simileMark = T), 0);
        case "width":
          return (
            (e.masterBar.displayWidth = r.values.values[0].value),
            (e.displayWidth = e.masterBar.displayWidth),
            0
          );
        case "scale":
          return (
            (e.masterBar.displayScale = r.values.values[0].value),
            (e.displayScale = e.masterBar.displayScale),
            0
          );
        case "spd":
          let O = new Xt();
          return (
            (O.pedalType = 0),
            (O.ratioPosition = r.values.values[0].value),
            e.sustainPedals.push(O),
            0
          );
        case "spu":
          let N = new Xt();
          return (
            (N.pedalType = 2),
            (N.ratioPosition = r.values.values[0].value),
            e.sustainPedals.push(N),
            0
          );
        case "sph":
          let R = new Xt();
          return (
            (R.pedalType = 1),
            (R.ratioPosition = r.values.values[0].value),
            e.sustainPedals.push(R),
            0
          );
        case "ft":
          return (e.masterBar.isFreeTime = !0), 0;
        case "ro":
          return (e.masterBar.isRepeatStart = !0), 0;
        case "ac":
          return (e.masterBar.isAnacrusis = !0), 0;
        case "db":
          return (e.masterBar.isDoubleBar = !0), (e.barLineRight = 7), 0;
        default:
          return 2;
      }
    }
    static _handleAccidentalMode(t, e) {
      let r = Y._parseEnumValue(t, e, "accidental mode", re.accidentalModes);
      return r === void 0 ? 1 : ((t.state.accidentalMode = r), 0);
    }
    static _getChordId(t, e) {
      return e.toLowerCase() + t.index + t.track.index;
    }
    _buildSyncPoint(t) {
      let e = t.values.values[0].value,
        r = t.values.values[1].value,
        i = t.values.values[2].value,
        n = 0;
      return (
        t.values.values.length > 3 && (n = t.values.values[3].value),
        { barIndex: e, barOccurence: r, barPosition: n, millisecondOffset: i }
      );
    }
    _validateValueListTypes(t, e, r, i) {
      let n = !1,
        s = 0,
        a = 0;
      if (!i)
        if (
          e.some(
            (l) => l.parseMode === 0 || l.parseMode === 2 || l.parseMode === 6
          )
        ) {
          let l = Y._buildExpectedTypesMessage(e);
          return (
            t.addSemanticDiagnostic({
              code: 210,
              message: `Missing value. Expected following values: ${l}`,
              severity: 2,
              start: r.start,
              end: r.end,
            }),
            !1
          );
        } else return !0;
      if (i.validated) return !0;
      for (; s < e.length; ) {
        let o = e[s],
          l = a < i.values.length ? i.values[a] : void 0;
        if (
          l &&
          o.expectedTypes.has(l.nodeType) &&
          this._checkRestrictions(o, l)
        )
          switch (o.parseMode) {
            case 5:
              (s = e.length), a++;
              break;
            case 7:
            case 6:
              a++;
              break;
            default:
              s++, a++;
              break;
          }
        else if (l)
          switch (o.parseMode) {
            case 7:
            case 6:
              s++;
              break;
            case 0:
            case 2:
              (n = !0),
                t.addSemanticDiagnostic({
                  code: 209,
                  message: `Unexpected required value '${
                    St[l.nodeType]
                  }', expected: ${Y._buildExpectedTypesMessage([o])}`,
                  severity: 2,
                  start: l.start,
                  end: l.end,
                }),
                s++,
                a++;
              break;
            case 1:
            case 3:
            case 4:
            case 5:
              s++;
              break;
          }
        else
          switch (o.parseMode) {
            case 7:
            case 6:
              s++;
              break;
            case 0:
            case 2:
              (n = !0),
                t.addSemanticDiagnostic({
                  code: 210,
                  message: `Missing values. Expected following values: ${Y._buildExpectedTypesMessage(
                    [o]
                  )}`,
                  severity: 2,
                  start: i.end,
                  end: i.end,
                }),
                (s = e.length);
              break;
            case 1:
            case 3:
            case 4:
            case 5:
              s++;
              break;
          }
      }
      if (a < i.values.length)
        for (; a < i.values.length; ) {
          let o = Y._buildExpectedTypesMessage(e),
            l = i.values[a];
          t.addSemanticDiagnostic({
            code: 209,
            message: `Unexpected additional value '${
              St[l.nodeType]
            }', expected: ${o}`,
            severity: 2,
            start: l.start,
            end: l.end,
          }),
            a++;
        }
      return !n;
    }
    _checkRestrictions(t, e) {
      switch (e.nodeType) {
        case 10:
          let r = e;
          return t?.allowedValues
            ? t.allowedValues.has(r.text.toLowerCase())
            : t?.reservedIdentifiers
            ? !t.reservedIdentifiers.has(r.text.toLowerCase())
            : !0;
        case 17:
          let i = e;
          return t?.allowedValues
            ? t.allowedValues.has(i.text.toLowerCase())
            : !0;
        default:
          return !0;
      }
    }
    _headerFooterStyle(t, e, r, i, n = 1) {
      let s = i.values.values.length - n;
      if (s < 1) return;
      let a = A.getOrCreateHeaderFooterStyle(e, r);
      a.isVisible === void 0 && (a.isVisible = !0);
      let o = i.values.values[n].text;
      if ((o ? (a.template = o) : (a.isVisible = !1), s < 2)) return;
      let l = Y._parseEnumValue(t, i.values, "textAlign", re.textAligns, n + 1);
      l !== void 0 && (a.textAlign = l);
    }
    static _buildExpectedTypesMessage(t) {
      let e = [];
      for (let r of t) {
        let i = Array.from(r.expectedTypes)
          .map((n) => St[n])
          .join("|");
        switch (r.parseMode) {
          case 0:
          case 2:
            e.push(`required(${i})`);
            break;
          case 1:
          case 3:
            e.push(`optional(${i})`);
            break;
          case 5:
            e.push(`only(${i})`);
            break;
          case 7:
            e.push(`listOf(${i})`);
            break;
        }
      }
      return e.join(",");
    }
    _readTrackInstrument(t, e, r) {
      switch (r.values[0].nodeType) {
        case 16:
          let i = r.values[0].value;
          i >= 0 && i <= 127
            ? (e.playbackInfo.program = i)
            : t.addSemanticDiagnostic({
                code: 211,
                message: `Value is out of valid range. Allowed range: 0-127, Actual Value: ${i}`,
                start: r.values[0].start,
                end: r.values[0].end,
                severity: 2,
              });
          break;
        case 10:
        case 17:
          let n = r.values[0].text.toLowerCase();
          if (n === "percussion") {
            for (let s of e.staves) t.applyStaffNoteKind(s, 2);
            (e.playbackInfo.primaryChannel = Q.PercussionChannel),
              (e.playbackInfo.secondaryChannel = Q.PercussionChannel);
          } else e.playbackInfo.program = Lt.getValue(n);
          break;
      }
    }
    _chordProperties(t, e, r) {
      if (r.properties) {
        for (let i of r.properties.properties)
          if (this._checkProperty(t, [Ie.chordPropertyValueListTypes], i))
            switch (i.property.text.toLowerCase()) {
              case "firstfret":
                e.firstFret = i.values.values[0].value;
                break;
              case "showdiagram":
                e.showDiagram = Y._booleanLikeValue(i.values.values, 0);
                break;
              case "showfingering":
                e.showFingering = Y._booleanLikeValue(i.values.values, 0);
                break;
              case "showname":
                e.showName = Y._booleanLikeValue(i.values.values, 0);
                break;
              case "barre":
                e.barreFrets = i.values.values.map((n) => n.value);
                break;
            }
      }
    }
    _tuningProperties(t, e, r, i) {
      if (i.properties) {
        for (let n of i.properties.properties)
          if (this._checkProperty(t, [Ie.tuningPropertyValueListTypes], n))
            switch (n.property.text.toLowerCase()) {
              case "hide":
                e.track.score.stylesheet.perTrackDisplayTuning ||
                  (e.track.score.stylesheet.perTrackDisplayTuning = new Map()),
                  e.track.score.stylesheet.perTrackDisplayTuning.set(
                    e.track.index,
                    !1
                  );
                break;
              case "label":
                r.name = n.values.values[0].text;
                break;
            }
      }
    }
    static _booleanLikeValue(t, e) {
      if (e >= t.length) return !0;
      let r = t[e];
      switch (r.nodeType) {
        case 17:
        case 10:
          return r.text !== "false";
        case 16:
          return r.value !== 0;
        default:
          return !1;
      }
    }
    applyStructuralMetaData(t, e) {
      switch (e.tag.tag.text.toLowerCase()) {
        case "staff":
          let r = t.startNewStaff();
          return this._staffProperties(t, r, e), 1;
        case "track":
          let i = t.startNewTrack();
          return (
            e.values &&
              e.values.values.length > 0 &&
              ((i.name = e.values.values[0].text),
              e.values.values.length > 1 &&
                (i.shortName = e.values.values[1].text)),
            this._trackProperties(t, i, e),
            0
          );
        case "voice":
          return t.startNewVoice(), 2;
        default:
          return 4;
      }
    }
    _checkProperty(t, e, r) {
      let i = this._checkValueListTypes(
        t,
        e,
        r,
        r.property.text.toLowerCase(),
        r.values
      );
      if (i !== void 0)
        switch (i) {
          case 0:
          case 1:
            return !1;
          case 2:
            let n = e.flatMap((s) => Array.from(s.keys()));
            return (
              t.addSemanticDiagnostic({
                code: 212,
                message: `Unrecogized property '${r.property.text}', expected one of ${n}`,
                severity: 2,
                start: r.start,
                end: r.end,
              }),
              !1
            );
        }
      return !0;
    }
    _staffProperties(t, e, r) {
      if (!r.properties) return;
      let i = !1,
        n = !1,
        s = !1,
        a = !1;
      for (let o of r.properties.properties)
        if (this._checkProperty(t, [Ie.staffPropertyValueListTypes], o))
          switch (o.property.text.toLowerCase()) {
            case "score":
              (i = !0),
                o.values &&
                  o.values.values.length > 0 &&
                  (e.standardNotationLineCount = o.values.values[0].value);
              break;
            case "tabs":
              n = !0;
              break;
            case "slash":
              s = !0;
              break;
            case "numbered":
              a = !0;
              break;
          }
      (i || n || s || a) &&
        ((e.showStandardNotation = i),
        (e.showTablature = n),
        (e.showSlash = s),
        (e.showNumbered = a));
    }
    _trackProperties(t, e, r) {
      if (r.properties) {
        for (let i of r.properties.properties)
          if (this._checkProperty(t, [Ie.trackPropertyValueListTypes], i))
            switch (i.property.text.toLowerCase()) {
              case "color":
                try {
                  e.color = ae.fromJson(i.values.values[0].text);
                } catch {
                  t.addSemanticDiagnostic({
                    code: 213,
                    message: "Invalid format for color",
                    severity: 2,
                    start: i.values.values[0].start,
                    end: i.values.values[0].end,
                  });
                }
                break;
              case "defaultsystemslayout":
                e.defaultSystemsLayout = i.values.values[0].value;
                break;
              case "systemslayout":
                e.systemsLayout = i.values.values.map((n) => n.value);
                break;
              case "volume":
                e.playbackInfo.volume = i.values.values[0].value;
                break;
              case "balance":
                e.playbackInfo.balance = i.values.values[0].value;
                break;
              case "mute":
                e.playbackInfo.isMute = !0;
                break;
              case "solo":
                e.playbackInfo.isSolo = !0;
                break;
              case "multibarrest":
                e.score.stylesheet.perTrackMultiBarRest ||
                  (e.score.stylesheet.perTrackMultiBarRest = new Set()),
                  e.score.stylesheet.perTrackMultiBarRest.add(e.index);
                break;
              case "instrument":
                this._readTrackInstrument(t, e, i.values);
                break;
              case "bank":
                e.playbackInfo.bank = i.values.values[0].value;
                break;
            }
      }
    }
    applyBeatDurationProperty(t, e) {
      let r = this._checkValueListTypes(
        t,
        [Ie.beatDurationPropertyValueListTypes],
        e,
        e.property.text.toLowerCase(),
        e.values
      );
      if (r !== void 0) return r;
      switch (e.property.text.toLowerCase()) {
        case "tu":
          if (e.values.values.length === 2)
            (t.state.currentTupletNumerator = e.values.values[0].value),
              (t.state.currentTupletDenominator = e.values.values[1].value);
          else {
            let i = e.values.values[0].value;
            t.state.currentTupletNumerator = i;
            let n = Y._getTupletDenominator(i);
            n < 0
              ? (t.addSemanticDiagnostic({
                  code: 209,
                  message: `Unexpected default tuplet value '${i}', expected: 3, 5, 6, 7, 9, 10, 11 or 12`,
                  severity: 2,
                  start: e.values.values[0].start,
                  end: e.values.values[0].end,
                }),
                (t.state.currentTupletNumerator = -1),
                (t.state.currentTupletDenominator = -1))
              : (t.state.currentTupletDenominator = n);
          }
          return 0;
      }
      return 2;
    }
    static _getTupletDenominator(t) {
      switch (t) {
        case 3:
          return 2;
        case 5:
          return 4;
        case 6:
          return 4;
        case 7:
          return 4;
        case 9:
          return 8;
        case 10:
          return 8;
        case 11:
          return 8;
        case 12:
          return 8;
        default:
          return -1;
      }
    }
    get allKnownMetaDataTags() {
      if (!this._allKnownBarMetaDataTags) {
        this._allKnownBarMetaDataTags = new Set();
        let t = [
          Ie.scoreMetaDataValueListTypes.keys(),
          Ie.structuralMetaDataValueListTypes.keys(),
          Ie.staffMetaDataValueListTypes.keys(),
          Ie.barMetaDataValueListTypes.keys(),
        ];
        for (let e of t) for (let r of e) this._allKnownBarMetaDataTags.add(r);
      }
      return this._allKnownBarMetaDataTags;
    }
    get knownScoreMetaDataTags() {
      return (
        this._knownScoreMetaDataTags ||
          (this._knownScoreMetaDataTags = new Set(
            Ie.scoreMetaDataValueListTypes.keys()
          )),
        this._knownScoreMetaDataTags
      );
    }
    get knownStructuralMetaDataTags() {
      return (
        this._knownStructuralMetaDataTags ||
          (this._knownStructuralMetaDataTags = new Set(
            Ie.structuralMetaDataValueListTypes.keys()
          )),
        this._knownStructuralMetaDataTags
      );
    }
    get knownBarMetaDataTags() {
      return (
        this._knownBarMetaDataTags ||
          (this._knownBarMetaDataTags = new Set(
            Ie.barMetaDataValueListTypes.keys()
          )),
        this._knownBarMetaDataTags
      );
    }
    get knownStaffMetaDataTags() {
      return (
        this._knownStaffMetaDataTags ||
          (this._knownStaffMetaDataTags = new Set(
            Ie.staffMetaDataValueListTypes.keys()
          )),
        this._knownStaffMetaDataTags
      );
    }
    get knownBeatDurationProperties() {
      return (
        this._knownBeatDurationProperties ||
          (this._knownBeatDurationProperties = new Set(
            Ie.beatDurationPropertyValueListTypes.keys()
          )),
        this._knownBeatDurationProperties
      );
    }
    get knownBeatProperties() {
      return (
        this._knownBeatProperties ||
          (this._knownBeatProperties = new Set(
            Ie.beatPropertyValueListTypes.keys()
          )),
        this._knownBeatProperties
      );
    }
    get knownNoteProperties() {
      return (
        this._knownNoteProperties ||
          (this._knownNoteProperties = new Set(
            Ie.notePropertyValueListTypes.keys()
          )),
        this._knownNoteProperties
      );
    }
    applyBeatProperty(t, e, r) {
      let i = r.property.text.toLowerCase(),
        n = this._checkValueListTypes(
          t,
          [Ie.beatPropertyValueListTypes],
          r,
          i,
          r.values
        );
      if (n !== void 0) return n;
      switch (i) {
        case "f":
          return (e.fade = 1), 0;
        case "fo":
          return (e.fade = 2), 0;
        case "vs":
          return (e.fade = 3), 0;
        case "v":
          return (e.vibrato = 1), 0;
        case "vw":
          return (e.vibrato = 2), 0;
        case "s":
          return (e.slap = !0), 0;
        case "p":
          return (e.pop = !0), 0;
        case "tt":
          return (e.tap = !0), 0;
        case "txt":
          return (e.text = r.values.values[0].text), 0;
        case "lyrics":
          let s = 0,
            a = "";
          for (
            r.values.values.length === 2
              ? ((s = r.values.values[0].value), (a = r.values.values[1].text))
              : (a = r.values.values[0].text),
              e.lyrics || (e.lyrics = []);
            e.lyrics.length <= s;

          )
            e.lyrics.push("");
          return (e.lyrics[s] = a), 0;
        case "dd":
          return (e.dots = 2), 0;
        case "d":
          return (e.dots = 1), 0;
        case "su":
          return (e.pickStroke = 1), 0;
        case "sd":
          return (e.pickStroke = 2), 0;
        case "tu":
          if (r.values.values.length === 2)
            (e.tupletNumerator = r.values.values[0].value),
              (e.tupletDenominator = r.values.values[1].value);
          else {
            let M = r.values.values[0].value;
            e.tupletNumerator = M;
            let P = Y._getTupletDenominator(M);
            if (P < 0)
              return (
                t.addSemanticDiagnostic({
                  code: 209,
                  message: `Unexpected default tuplet value '${M}', expected: 3, 5, 6, 7, 9, 10, 11 or 12`,
                  severity: 2,
                  start: r.values.values[0].start,
                  end: r.values.values[0].end,
                }),
                (e.tupletNumerator = -1),
                (e.tupletDenominator = -1),
                1
              );
            e.tupletDenominator = P;
          }
          return 0;
        case "tb":
        case "tbe":
          let o = 0;
          switch (r.values.values[o].nodeType) {
            case 10:
            case 17:
              let M = Y._parseEnumValue(
                t,
                r.values,
                "whammy type",
                re.whammyTypes,
                o
              );
              if (M === void 0) return 1;
              (e.whammyBarType = M), o++;
              break;
          }
          switch (r.values.values[o].nodeType) {
            case 10:
            case 17:
              let M = Y._parseEnumValue(
                t,
                r.values,
                "whammy style",
                re.bendStyles,
                o
              );
              if (M === void 0) return 1;
              (e.whammyStyle = M), o++;
              break;
          }
          let l = this._getBendPoints(t, r, o, i === "tbe");
          if (l) for (let M of l) e.addWhammyBarPoint(M);
          return 0;
        case "bu":
          return Y._applyBrush(e, r, 1, 0.25), 0;
        case "bd":
          return Y._applyBrush(e, r, 2, 0.25), 0;
        case "au":
          return Y._applyBrush(e, r, 3, 1), 0;
        case "ad":
          return Y._applyBrush(e, r, 4, 1), 0;
        case "ch": {
          let M = e.voice.bar.staff,
            P = r.values.values[0].text,
            H = Y._getChordId(M, P);
          if (!M.hasChord(H)) {
            let X = new Bt();
            (X.showDiagram = !1), (X.name = P), M.addChord(H, X);
          }
          return (t.state.currentChordId = H), Y.applyChordToBeat(e, H, !0), 0;
        }
        case "gr":
          if (r.values && r.values.values.length > 0) {
            let M = Y._parseEnumValue(
              t,
              r.values,
              "whammy style",
              re.graceTypes
            );
            if (M === void 0) return 1;
            e.graceType = M;
          } else e.graceType = 2;
          return 0;
        case "dy":
          let u = Y._parseEnumValue(t, r.values, "dynamic", re.dynamics);
          return u === void 0
            ? 1
            : ((e.dynamics = u), (t.state.currentDynamics = u), 0);
        case "cre":
          return (e.crescendo = 1), 0;
        case "dec":
          return (e.crescendo = 2), 0;
        case "tempo":
          let c = r.values.values[0].value,
            d = "",
            h = !0;
          if (r.values.values.length > 2) {
            d = r.values.values[1].text;
            let M = r.values.values[2].text;
            if (M === "hide") h = !1;
            else
              return (
                t.addSemanticDiagnostic({
                  code: 209,
                  message: `Unexpected third tempo property value '${M}', expected: 'hide'`,
                  severity: 2,
                  start: r.values.values[2].start,
                  end: r.values.values[2].end,
                }),
                1
              );
          } else
            r.values.values.length > 1 &&
              ((d = r.values.values[1].text),
              d === "hide" && ((h = !1), (d = "")));
          let f = new he();
          return (
            (f.isLinear = !1),
            (f.type = 0),
            (f.value = c),
            (f.text = d),
            (f.isVisible = h),
            e.automations.push(f),
            e.voice.bar.masterBar.tempoAutomations.push(f),
            0
          );
        case "volume":
          let b = new he();
          return (
            (b.isLinear = !0),
            (b.type = 1),
            (b.value = r.values.values[0].value),
            e.automations.push(b),
            0
          );
        case "balance":
          let y = new he();
          return (
            (y.isLinear = !0),
            (y.type = 3),
            (y.value = A.clamp(r.values.values[0].value, 0, 16)),
            e.automations.push(y),
            0
          );
        case "tp":
          if (((e.tremoloSpeed = 8), r.values && r.values.values.length > 0)) {
            let M = r.values.values[0].value;
            switch (M) {
              case 8:
                e.tremoloSpeed = 8;
                break;
              case 16:
                e.tremoloSpeed = 16;
                break;
              case 32:
                e.tremoloSpeed = 32;
                break;
              default:
                return (
                  t.addSemanticDiagnostic({
                    code: 209,
                    message: `Unexpected tremolo speed value '${M}, expected: 8, 16 or 32`,
                    severity: 2,
                    start: r.values.values[0].start,
                    end: r.values.values[0].end,
                  }),
                  1
                );
            }
          }
          return 0;
        case "spd":
          return Y._applySustainPedal(t, e, 0), 0;
        case "sph":
          return Y._applySustainPedal(t, e, 1), 0;
        case "spu":
          return Y._applySustainPedal(t, e, 2), 0;
        case "spe":
          return Y._applySustainPedal(t, e, 2, !0), 0;
        case "slashed":
          return (e.slashed = !0), 0;
        case "ds":
          return (
            (e.deadSlapped = !0),
            e.notes.length === 1 &&
              e.notes[0].isDead &&
              e.removeNote(e.notes[0]),
            0
          );
        case "glpf":
          return (e.golpe = 2), 0;
        case "glpt":
          return (e.golpe = 1), 0;
        case "waho":
          return (e.wahPedal = 1), 0;
        case "wahc":
          return (e.wahPedal = 2), 0;
        case "barre":
          if (
            ((e.barreFret = r.values.values[0].value),
            (e.barreShape = 1),
            r.values.values.length > 1)
          ) {
            let M = Y._parseEnumValue(
              t,
              r.values,
              "barre shape",
              re.barreShapes,
              1
            );
            if (M === void 0) return 1;
            e.barreShape = M;
          }
          return 0;
        case "rasg":
          let S = Y._parseEnumValue(
            t,
            r.values,
            "rasgueado pattern",
            re.rasgueadoPatterns
          );
          return S === void 0 ? 1 : ((e.rasgueado = S), 0);
        case "ot":
          let k = Y._parseEnumValue(t, r.values, "ottava", re.ottava);
          return k === void 0 ? 1 : ((e.ottava = k), 0);
        case "legatoorigin":
          return (e.isLegatoOrigin = !0), 0;
        case "instrument":
          let T = 0;
          switch (r.values.values[0].nodeType) {
            case 10:
            case 17:
              T = Lt.getValue(r.values.values[0].text);
              break;
            case 16:
              T = r.values.values[0].value;
              break;
          }
          let O = new he();
          return (
            (O.isLinear = !1),
            (O.type = 2),
            (O.value = T),
            e.automations.push(O),
            0
          );
        case "bank":
          let N = new he();
          return (
            (N.isLinear = !1),
            (N.type = 4),
            (N.value = r.values.values[0].value),
            e.automations.push(N),
            0
          );
        case "fermata":
          let R = Y._parseEnumValue(t, r.values, "fermata", re.fermataTypes);
          if (R === void 0) return 1;
          let g = new kr();
          return (
            (g.type = R),
            r.values.values.length > 1 && (g.length = r.values.values[1].value),
            (e.fermata = g),
            0
          );
        case "beam":
          let x = r.values.values[0].text;
          switch (x.toLowerCase()) {
            case "invert":
              e.invertBeamDirection = !0;
              break;
            case "up":
              e.preferredBeamDirection = 0;
              break;
            case "down":
              e.preferredBeamDirection = 1;
              break;
            case "auto":
              e.beamingMode = 0;
              break;
            case "split":
              e.beamingMode = 1;
              break;
            case "merge":
              e.beamingMode = 2;
              break;
            case "splitsecondary":
              e.beamingMode = 3;
              break;
            default:
              let M = [
                "invert",
                "up",
                "down",
                "auto",
                "split",
                "merge",
                "splitsecondary",
              ];
              return (
                t.addSemanticDiagnostic({
                  code: 209,
                  message: `Unexpected beam value '${x}', expected: ${M.join(
                    ","
                  )}`,
                  severity: 2,
                  start: r.values.values[0].start,
                  end: r.values.values[0].end,
                }),
                1
              );
          }
          return 0;
        case "timer":
          return (e.showTimer = !0), 0;
      }
      return 2;
    }
    static _applySustainPedal(t, e, r, i = !1) {
      let n = new Xt();
      (n.pedalType = r),
        i
          ? (n.ratioPosition = 1)
          : (n.ratioPosition = 0.001 * e.voice.bar.sustainPedals.length),
        t.state.sustainPedalToBeat.set(n, e),
        e.voice.bar.sustainPedals.push(n);
    }
    static _applyBrush(t, e, r, i) {
      (t.brushType = r),
        e.values && e.values.values.length > 0
          ? (t.brushDuration = e.values.values[0].value)
          : (t.updateDurations(),
            (t.brushDuration = (t.playbackDuration * i) / t.notes.length));
    }
    applyNoteProperty(t, e, r) {
      let i = r.property.text.toLowerCase(),
        n = this._checkValueListTypes(
          t,
          [Ie.notePropertyValueListTypes],
          r,
          i,
          r.values
        );
      if (n !== void 0) return n;
      switch (i) {
        case "b":
        case "be":
          let s = 0;
          switch (r.values.values[s].nodeType) {
            case 10:
            case 17:
              let h = Y._parseEnumValue(
                t,
                r.values,
                "bend type",
                re.bendTypes,
                s
              );
              if (h === void 0) return 1;
              (e.bendType = h), s++;
              break;
          }
          switch (r.values.values[s].nodeType) {
            case 10:
            case 17:
              let h = Y._parseEnumValue(
                t,
                r.values,
                "bend style",
                re.bendStyles,
                s
              );
              if (h === void 0) return 1;
              (e.bendStyle = h), s++;
              break;
          }
          let a = this._getBendPoints(t, r, s, i === "be");
          if (a) for (let h of a) e.addBendPoint(h);
          return 0;
        case "nh":
          return (
            (e.harmonicType = 1),
            (e.harmonicValue = A.deltaFretToHarmonicValue(e.fret)),
            0
          );
        case "ah":
          return (
            (e.harmonicType = 2),
            (e.harmonicValue = Y._harmonicValue(r.values, e.harmonicValue)),
            0
          );
        case "th":
          return (
            (e.harmonicType = 4),
            (e.harmonicValue = Y._harmonicValue(r.values, e.harmonicValue)),
            0
          );
        case "ph":
          return (
            (e.harmonicType = 3),
            (e.harmonicValue = Y._harmonicValue(r.values, e.harmonicValue)),
            0
          );
        case "sh":
          return (
            (e.harmonicType = 5),
            (e.harmonicValue = Y._harmonicValue(r.values, e.harmonicValue)),
            0
          );
        case "fh":
          return (
            (e.harmonicType = 6),
            (e.harmonicValue = Y._harmonicValue(r.values, e.harmonicValue)),
            0
          );
        case "tr":
          let o = r.values.values[0].value,
            l = 16;
          if (r.values.values.length > 1) {
            let h = r.values.values[1].value;
            switch (h) {
              case 16:
                l = 16;
                break;
              case 32:
                l = 32;
                break;
              case 64:
                l = 64;
                break;
              default:
                return (
                  t.addSemanticDiagnostic({
                    code: 209,
                    message: `Unexpected trill duration value '${h}', expected: 16, 32 or 64`,
                    severity: 2,
                    start: r.values.values[1].start,
                    end: r.values.values[1].end,
                  }),
                  1
                );
            }
          }
          return (e.trillValue = o + e.stringTuning), (e.trillSpeed = l), 0;
        case "v":
          return (e.vibrato = 1), 0;
        case "vw":
          return (e.vibrato = 2), 0;
        case "sl":
          return (e.slideOutType = 2), 0;
        case "ss":
          return (e.slideOutType = 1), 0;
        case "sib":
          return (e.slideInType = 1), 0;
        case "sia":
          return (e.slideInType = 2), 0;
        case "sou":
          return (e.slideOutType = 3), 0;
        case "sod":
          return (e.slideOutType = 4), 0;
        case "psd":
          return (e.slideOutType = 5), 0;
        case "psu":
          return (e.slideOutType = 6), 0;
        case "h":
          return (e.isHammerPullOrigin = !0), 0;
        case "lht":
          return (e.isLeftHandTapped = !0), 0;
        case "g":
          return (e.isGhost = !0), 0;
        case "ac":
          return (e.accentuated = 1), 0;
        case "hac":
          return (e.accentuated = 2), 0;
        case "ten":
          return (e.accentuated = 3), 0;
        case "pm":
          return (e.isPalmMute = !0), 0;
        case "st":
          return (e.isStaccato = !0), 0;
        case "lr":
          return (e.isLetRing = !0), 0;
        case "x":
          return (e.isDead = !0), 0;
        case "-":
        case "t":
          return (e.isTieDestination = !0), 0;
        case "lf":
          let u = 0;
          if (r.values && r.values.values.length > 0) {
            let h = Y._toFinger(t, r.values);
            if (h === void 0) return 1;
            u = h;
          }
          return (e.leftHandFinger = u), 0;
        case "rf":
          let c = 0;
          if (r.values && r.values.values.length > 0) {
            let h = Y._toFinger(t, r.values);
            if (h === void 0) return 1;
            c = h;
          }
          return (e.rightHandFinger = c), 0;
        case "acc":
          return (
            (e.accidentalMode = A.parseAccidentalMode(r.values.values[0].text)),
            0
          );
        case "turn":
          return (e.ornament = 2), 0;
        case "iturn":
          return (e.ornament = 1), 0;
        case "umordent":
          return (e.ornament = 3), 0;
        case "lmordent":
          return (e.ornament = 4), 0;
        case "string":
          return (e.showStringNumber = !0), 0;
        case "hide":
          return (e.isVisible = !1), 0;
        case "slur":
          let d = r.values.values[0].text;
          if (t.state.slurs.has(d)) {
            let h = t.state.slurs.get(d);
            (h.slurDestination = e),
              (e.slurOrigin = h),
              (e.isSlurDestination = !0);
          } else t.state.slurs.set(d, e);
          return 0;
        default:
          return this.applyBeatProperty(t, e.beat, r);
      }
      return 2;
    }
    static _toFinger(t, e) {
      let r = e.values[0].value;
      switch (r) {
        case 1:
          return 0;
        case 2:
          return 1;
        case 3:
          return 2;
        case 4:
          return 3;
        case 5:
          return 4;
        default:
          t.addSemanticDiagnostic({
            code: 211,
            message: `Value is out of valid range. Allowed range: 1-5, Actual Value: ${r}`,
            start: e.values[0].start,
            end: e.values[0].end,
            severity: 2,
          });
          return;
      }
    }
    static _harmonicValue(t, e) {
      return t && (e = t.values[0].value), e;
    }
    _getBendPoints(t, e, r, i) {
      let n = e.values.values,
        s = n.length - r,
        a = e.values;
      s > 0 &&
        n[r].nodeType === 13 &&
        ((n = n[r].values), (r = 0), (s = n.length), (a = n[r]));
      let o = i ? 2 : 1;
      if (s % o !== 0) {
        let c = Math.ceil(s / o),
          d = c * o;
        t.addSemanticDiagnostic({
          code: 214,
          message: `The '${e.property.text}' effect needs ${o} values per item. With ${c} points, ${d} values are needed, only ${s} values found.`,
          severity: 2,
          start: a.end,
          end: a.end,
        });
        return;
      }
      let l = [],
        u = r;
      for (; u < n.length; ) {
        let c = 0,
          d = 0;
        i
          ? ((c = n[u++].value), (d = n[u++].value))
          : ((c = 0), (d = n[u++].value)),
          l.push(new I(c, d));
      }
      if (l.length > 0) {
        if ((l.length > 60 && l.splice(60, l.length - 60), i))
          l.sort((c, d) => c.offset - d.offset);
        else {
          let c = l.length,
            d = (I.MaxPosition / (c - 1)) | 0,
            h = 0;
          for (; h < c; ) (l[h].offset = Math.min(I.MaxPosition, h * d)), h++;
        }
        return l;
      } else return;
    }
    static _parseEnumValue(t, e, r, i, n = 0) {
      if (n >= e.values.length) return;
      let s = e.values[n].text;
      if (i.has(s.toLowerCase())) return i.get(s.toLowerCase());
      t.addSemanticDiagnostic({
        code: 209,
        message: `Unexpected ${r} value '${s}', expected: ${Array.from(
          i.keys()
        ).join(",")}`,
        severity: 2,
        start: e.values[n].start,
        end: e.values[n].end,
      });
    }
    buildScoreMetaDataNodes(t) {
      let e = [];
      return (
        Y._buildScoreInfoMeta(e, "album", t, t.album, 3),
        Y._buildScoreInfoMeta(e, "artist", t, t.artist, 2),
        Y._buildScoreInfoMeta(e, "copyright", t, t.copyright, 8),
        Y._buildScoreInfoMeta(e, "copyright2", t, void 0, 9),
        Y._buildScoreInfoMeta(e, "wordsandmusic", t, void 0, 6, !0),
        Y._buildScoreInfoMeta(e, "instructions", t, t.instructions, void 0),
        Y._buildScoreInfoMeta(e, "music", t, t.music, 5),
        Y._buildScoreInfoMeta(e, "notices", t, t.notices, void 0),
        Y._buildScoreInfoMeta(e, "subtitle", t, t.subTitle, 1),
        Y._buildScoreInfoMeta(e, "title", t, t.title, 0),
        Y._buildScoreInfoMeta(e, "words", t, t.words, 4),
        Y._buildScoreInfoMeta(e, "tab", t, t.tab, 7),
        t.defaultSystemsLayout !== Y._defaultScore.defaultSystemsLayout &&
          e.push(v.numberMeta("defaultSystemsLayout", t.defaultSystemsLayout)),
        t.systemsLayout.length > 0 &&
          e.push(
            v.meta(
              "systemsLayout",
              v.values(t.systemsLayout.map((r) => v.number(r)))
            )
          ),
        Y._buildStyleSheetMetaData(e, t.stylesheet),
        e.length > 0 &&
          (e[0].leadingComments = [{ text: "Score Metadata", multiLine: !1 }]),
        e
      );
    }
    static _buildStyleSheetMetaData(t, e) {
      let r = t.length;
      e.hideDynamics && t.push(v.meta("hideDynamics")),
        e.bracketExtendMode !== Y._defaultScore.stylesheet.bracketExtendMode &&
          t.push(
            v.identMeta(
              "bracketExtendMode",
              re.bracketExtendModesReversed.get(e.bracketExtendMode)
            )
          ),
        e.useSystemSignSeparator && t.push(v.meta("useSystemSignSeparator")),
        e.multiTrackMultiBarRest && t.push(v.meta("multiBarRest")),
        e.singleTrackTrackNamePolicy !==
          Y._defaultScore.stylesheet.singleTrackTrackNamePolicy &&
          t.push(
            v.identMeta(
              "singleTrackTrackNamePolicy",
              re.trackNamePoliciesReversed.get(e.singleTrackTrackNamePolicy)
            )
          ),
        e.multiTrackTrackNamePolicy !==
          Y._defaultScore.stylesheet.multiTrackTrackNamePolicy &&
          t.push(
            v.identMeta(
              "multiTrackTrackNamePolicy",
              re.trackNamePoliciesReversed.get(e.multiTrackTrackNamePolicy)
            )
          ),
        e.firstSystemTrackNameMode !==
          Y._defaultScore.stylesheet.firstSystemTrackNameMode &&
          t.push(
            v.identMeta(
              "firstSystemTrackNameMode",
              re.trackNameModeReversed.get(e.firstSystemTrackNameMode)
            )
          ),
        e.otherSystemsTrackNameMode !==
          Y._defaultScore.stylesheet.otherSystemsTrackNameMode &&
          t.push(
            v.identMeta(
              "otherSystemsTrackNameMode",
              re.trackNameModeReversed.get(e.otherSystemsTrackNameMode)
            )
          ),
        e.firstSystemTrackNameOrientation !==
          Y._defaultScore.stylesheet.firstSystemTrackNameOrientation &&
          t.push(
            v.identMeta(
              "firstSystemTrackNameOrientation",
              re.trackNameOrientationsReversed.get(
                e.firstSystemTrackNameOrientation
              )
            )
          ),
        e.otherSystemsTrackNameOrientation !==
          Y._defaultScore.stylesheet.otherSystemsTrackNameOrientation &&
          t.push(
            v.identMeta(
              "otherSystemsTrackNameOrientation",
              re.trackNameOrientationsReversed.get(
                e.otherSystemsTrackNameOrientation
              )
            )
          ),
        r < t.length &&
          (t[r].leadingComments = [
            { multiLine: !1, text: "Score Stylesheet" },
          ]);
    }
    static _buildScoreInfoMeta(t, e, r, i, n, s = !1) {
      if (i !== void 0 && i.length === 0 && !s) return;
      let a = [];
      if ((i !== void 0 && a.push(v.string(i)), n !== void 0)) {
        let o =
            r.style && r.style.headerAndFooter.has(n)
              ? r.style.headerAndFooter.get(n)
              : void 0,
          l = Jt.defaultHeaderAndFooter.has(n)
            ? Jt.defaultHeaderAndFooter.get(n)
            : void 0;
        o &&
          (!l || !ct.equals(l, o)) &&
          (a.push(v.string(o.isVisible === !1 ? "" : o.template)),
          a.push(v.ident(re.textAlignsReversed.get(o.textAlign))));
      }
      (i === void 0 && a.length === 0) ||
        (i !== void 0 && i.length === 0 && a.length === 1) ||
        t.push(v.meta(e, v.values(a)));
    }
    buildSyncPointNodes(t) {
      let e = [],
        r = t.exportFlatSyncPoints();
      for (let i of r)
        e.push(
          v.meta(
            "sync",
            v.values([
              v.number(i.barIndex),
              v.number(i.barOccurence),
              v.number(i.millisecondOffset),
              i.barPosition > 0 ? v.number(i.barPosition) : void 0,
            ])
          )
        );
      return e;
    }
    buildBarMetaDataNodes(t, e, r, i) {
      let n = [];
      if ((Y._buildStructuralMetaDataNodes(e, t, n, i, r), !e)) return n;
      r === 0 &&
        t.index === 0 &&
        t.track.index === 0 &&
        Y._buildMasterBarMetaDataNodes(n, e.masterBar);
      let s = n.length;
      r === 0 &&
        e.index === 0 &&
        t.index === 0 &&
        t.track.index === 0 &&
        n.push(v.identMeta("accidentals", "auto")),
        (e.index === 0 || e.clef !== e.previousBar?.clef) &&
          n.push(v.identMeta("clef", re.clefsReversed.get(e.clef))),
        ((e.index === 0 && e.clefOttava !== 2) ||
          e.clefOttava !== e.previousBar?.clefOttava) &&
          n.push(v.identMeta("ottava", re.ottavaReversed.get(e.clefOttava))),
        ((e.index === 0 && e.simileMark !== 0) ||
          e.simileMark !== e.previousBar?.simileMark) &&
          n.push(
            v.identMeta("simile", re.simileMarksReversed.get(e.simileMark))
          ),
        e.displayScale !== 1 && n.push(v.numberMeta("scale", e.displayScale)),
        e.displayWidth > 0 && n.push(v.numberMeta("width", e.displayWidth));
      for (let a of e.sustainPedals) {
        let o = "";
        switch (a.pedalType) {
          case 0:
            o = "spd";
            break;
          case 1:
            o = "sph";
            break;
          case 2:
            o = "spu";
            break;
        }
        o && n.push(v.numberMeta(o, a.ratioPosition));
      }
      if (
        (e.barLineLeft !== 0 &&
          n.push(
            v.identMeta("barLineLeft", re.barLinesReversed.get(e.barLineLeft))
          ),
        e.barLineRight !== 0 &&
          n.push(
            v.identMeta("barLineRight", re.barLinesReversed.get(e.barLineRight))
          ),
        e.index === 0 ||
          e.keySignature !== e.previousBar.keySignature ||
          e.keySignatureType !== e.previousBar.keySignatureType)
      ) {
        let a = "";
        e.keySignatureType === 1
          ? (a = re.keySignaturesMinorReversed.get(e.keySignature))
          : (a = re.keySignaturesMajorReversed.get(e.keySignature)),
          n.push(v.identMeta("ks", a));
      }
      return (
        s < n.length &&
          (n[s].leadingComments = [
            { multiLine: !1, text: `Bar ${e.index + 1} Metadata` },
          ]),
        n
      );
    }
    static _buildStaffMetaDataNodes(t, e) {
      let r = t.length;
      if (
        (e.capo !== 0 && t.push(v.numberMeta("capo", e.capo)), e.isPercussion)
      )
        t.push(v.identMeta("articulation", "defaults"));
      else if (e.isStringed) {
        let n = v.meta(
          "tuning",
          v.values(
            e.stringTuning.tunings.map((s) =>
              v.ident(lt.getTextForTuning(s, !0))
            )
          )
        );
        t.push(n),
          e.track.score.stylesheet.perTrackDisplayTuning &&
            e.track.score.stylesheet.perTrackDisplayTuning.has(e.track.index) &&
            (n.properties = v.props([["hide", void 0]])),
          e.stringTuning.name.length > 0 &&
            (n.properties ?? (n.properties = v.props([])),
            v.prop(
              n.properties.properties,
              "label",
              v.stringValue(e.stringTuning.name)
            ));
      }
      e.transpositionPitch !== 0 &&
        t.push(v.numberMeta("transpose", -e.transpositionPitch));
      let i = A.displayTranspositionPitches.has(e.track.playbackInfo.program)
        ? A.displayTranspositionPitches.get(e.track.playbackInfo.program)
        : 0;
      if (
        (e.displayTranspositionPitch !== i &&
          t.push(
            v.numberMeta("displaytranspose", -e.displayTranspositionPitch)
          ),
        e.chords != null)
      )
        for (let [n, s] of e.chords) t.push(Y._buildChordNode(s));
      r < t.length &&
        (t[r].leadingComments = [
          { multiLine: !1, text: `Staff ${e.index + 1} Metadata` },
        ]);
    }
    static _buildChordNode(t) {
      let e = v.meta(
        "chord",
        v.stringValue(t.name),
        v.props([
          t.firstFret >= 0 ? ["firstfret", v.numberValue(t.firstFret)] : void 0,
          ["showdiagram", v.identValue(t.showDiagram ? "true" : "false")],
          ["showfingering", v.identValue(t.showFingering ? "true" : "false")],
          ["showname", v.identValue(t.showName ? "true" : "false")],
          t.barreFrets.length > 0
            ? ["barre", v.values(t.barreFrets.map((r) => v.number(r)))]
            : void 0,
        ])
      );
      e.propertiesBeforeValues = !0;
      for (let r = 0; r < t.staff.tuning.length; r++)
        r < t.strings.length && t.strings[r] >= 0
          ? e.values.values.push(v.number(t.strings[r]))
          : e.values.values.push(v.ident("x"));
      return e;
    }
    static _buildMasterBarMetaDataNodes(t, e) {
      let r = t.length;
      if (
        (e.alternateEndings !== 0 &&
          t.push(
            v.meta(
              "ae",
              v.values(
                A.getAlternateEndingsList(e.alternateEndings).map((i) =>
                  v.number(i + 1)
                )
              )
            )
          ),
        e.isRepeatStart && t.push(v.meta("ro")),
        e.isRepeatEnd && t.push(v.numberMeta("rc", e.repeatCount)),
        (e.index === 0 ||
          e.timeSignatureCommon !== e.previousMasterBar?.timeSignatureCommon ||
          e.timeSignatureNumerator !==
            e.previousMasterBar.timeSignatureNumerator ||
          e.timeSignatureDenominator !==
            e.previousMasterBar.timeSignatureDenominator) &&
          (e.timeSignatureCommon
            ? t.push(v.identMeta("ts", "common"))
            : t.push(
                v.meta(
                  "ts",
                  v.values([
                    v.number(e.timeSignatureNumerator),
                    v.number(e.timeSignatureDenominator),
                  ])
                )
              )),
        ((e.index > 0 && e.tripletFeel !== e.previousMasterBar?.tripletFeel) ||
          (e.index === 0 && e.tripletFeel !== 0)) &&
          t.push(v.identMeta("tf", re.tripletFeelsReversed.get(e.tripletFeel))),
        e.isFreeTime && t.push(v.meta("ft")),
        e.section != null &&
          t.push(
            v.meta(
              "section",
              v.values([v.string(e.section.marker), v.string(e.section.text)])
            )
          ),
        e.isAnacrusis && t.push(v.meta("ac")),
        e.displayScale !== 1 && t.push(v.numberMeta("scale", e.displayScale)),
        e.displayWidth > 0 && t.push(v.numberMeta("width", e.displayWidth)),
        e.directions)
      )
        for (let i of e.directions)
          t.push(v.identMeta("jump", re.directionsReversed.get(i)));
      for (let i of e.tempoAutomations) {
        let n = v.meta(
          "tempo",
          v.values([
            v.number(i.value),
            i.text ? v.string(i.text) : void 0,
            i.ratioPosition > 0 ? v.number(i.ratioPosition) : void 0,
            i.isVisible ? void 0 : v.ident("hide"),
          ])
        );
        n.values.values.length === 1 &&
          ((n.values.openParenthesis = void 0),
          (n.values.closeParenthesis = void 0)),
          t.push(n);
      }
      r < t.length &&
        (t[r].leadingComments = [
          { multiLine: !1, text: `Masterbar ${e.index + 1} Metadata` },
        ]);
    }
    static _buildStructuralMetaDataNodes(t, e, r, i, n) {
      if (
        (t === void 0 || t.index === 0) &&
        (n === 0 &&
          (e.index === 0 && r.push(Y._buildNewTrackNode(e.track)),
          r.push(Y._buildNewStaffNode(e)),
          Y._buildStaffMetaDataNodes(r, e)),
        i)
      ) {
        let s = v.meta("voice");
        (s.trailingComments = [{ multiLine: !0, text: `Voice ${n + 1}` }]),
          r.push(s);
      }
    }
    static _buildNewStaffNode(t) {
      let e = v.meta(
        "staff",
        void 0,
        v.props([
          t.showStandardNotation
            ? [
                "score",
                v.values([
                  t.standardNotationLineCount !==
                  _r.DefaultStandardNotationLineCount
                    ? v.number(t.standardNotationLineCount)
                    : void 0,
                ]),
              ]
            : void 0,
          t.showTablature ? ["tabs", void 0] : void 0,
          t.showSlash ? ["slash", void 0] : void 0,
          t.showNumbered ? ["numbered", void 0] : void 0,
        ])
      );
      return (
        e.properties &&
          e.properties.properties.length > 0 &&
          (e.properties.properties[0].leadingComments = [
            { multiLine: !1, text: "Staff Properties" },
          ]),
        e
      );
    }
    static _buildNewTrackNode(t) {
      let e = v.meta(
        "track",
        v.values([
          v.string(t.name),
          t.shortName.length > 0 ? v.string(t.shortName) : void 0,
        ]),
        v.props([
          t.color.rgba !== Y._defaultTrack.color.rgba
            ? ["color", v.stringValue(t.color.rgba)]
            : void 0,
          t.defaultSystemsLayout !== Y._defaultTrack.defaultSystemsLayout
            ? ["defaultSystemsLayout", v.numberValue(t.defaultSystemsLayout)]
            : void 0,
          t.systemsLayout.length
            ? [
                "systemsLayout",
                v.values(t.systemsLayout.map((r) => v.number(r))),
              ]
            : void 0,
          ["volume", v.numberValue(t.playbackInfo.volume)],
          ["balance", v.numberValue(t.playbackInfo.balance)],
          t.playbackInfo.isMute ? ["mute", void 0] : void 0,
          t.playbackInfo.isSolo ? ["solo", void 0] : void 0,
          t.score.stylesheet.perTrackMultiBarRest &&
          t.score.stylesheet.perTrackMultiBarRest.has(t.index)
            ? ["multiBarRest", void 0]
            : void 0,
          [
            "instrument",
            v.identValue(
              t.isPercussion ? "percussion" : Lt.getName(t.playbackInfo.program)
            ),
          ],
          t.playbackInfo.bank > 0
            ? ["bank", v.numberValue(t.playbackInfo.bank)]
            : void 0,
        ])
      );
      return (
        e.properties &&
          e.properties.properties.length > 0 &&
          (e.properties.properties[0].leadingComments = [
            { multiLine: !1, text: "Track Properties" },
          ]),
        e
      );
    }
    buildNoteEffects(t) {
      let e = [];
      if (t.hasBend) {
        let i = v.values(
          [
            v.ident(re.bendTypesReversed.get(t.bendType)),
            t.bendStyle !== 0
              ? v.ident(re.bendStylesReversed.get(t.bendStyle))
              : void 0,
          ],
          !0
        );
        for (let n of t.bendPoints)
          i.values.push(v.number(n.offset)), i.values.push(v.number(n.value));
        v.prop(e, "be", i);
      }
      let r = "";
      switch (t.harmonicType) {
        case 1:
          v.prop(e, "nh");
          break;
        case 2:
          r = "ah";
          break;
        case 3:
          r = "ph";
          break;
        case 4:
          r = "th";
          break;
        case 5:
          r = "sh";
          break;
        case 6:
          r = "fh";
          break;
      }
      switch (
        (r && v.prop(e, r, v.numberValue(t.harmonicValue)),
        t.showStringNumber && v.prop(e, "string"),
        t.isTrill &&
          v.prop(
            e,
            "tr",
            v.values([v.number(t.trillFret), v.number(t.trillSpeed)])
          ),
        t.vibrato)
      ) {
        case 1:
          v.prop(e, "v");
          break;
        case 2:
          v.prop(e, "vw");
          break;
      }
      switch (t.slideInType) {
        case 1:
          v.prop(e, "sib");
          break;
        case 2:
          v.prop(e, "sia");
          break;
      }
      switch (t.slideOutType) {
        case 1:
          v.prop(e, "ss");
          break;
        case 2:
          v.prop(e, "sl");
          break;
        case 3:
          v.prop(e, "sou");
          break;
        case 4:
          v.prop(e, "sod");
          break;
        case 5:
          v.prop(e, "psd");
          break;
        case 6:
          v.prop(e, "psu");
          break;
      }
      switch (
        (t.isHammerPullOrigin && v.prop(e, "h"),
        t.isLeftHandTapped && v.prop(e, "lht"),
        t.isGhost && v.prop(e, "g"),
        t.accentuated)
      ) {
        case 1:
          v.prop(e, "ac");
          break;
        case 2:
          v.prop(e, "hac");
          break;
        case 3:
          v.prop(e, "ten");
          break;
      }
      if (
        (t.isPalmMute && v.prop(e, "pm"),
        t.isStaccato && v.prop(e, "st"),
        t.isLetRing && v.prop(e, "lr"),
        t.isDead && v.prop(e, "x"),
        t.isTieDestination && v.prop(e, "t"),
        t.leftHandFinger >= 0 &&
          v.prop(e, "lf", v.numberValue(t.leftHandFinger + 1)),
        t.rightHandFinger >= 0 &&
          v.prop(e, "rf", v.numberValue(t.rightHandFinger + 1)),
        t.isVisible || v.prop(e, "hide"),
        t.isSlurOrigin)
      ) {
        let i = `s${t.id}`;
        v.prop(e, "slur", v.identValue(i));
      }
      if (t.isSlurDestination) {
        let i = `s${t.slurOrigin.id}`;
        v.prop(e, "slur", v.identValue(i));
      }
      switch (
        (t.accidentalMode !== 0 &&
          v.prop(
            e,
            "acc",
            v.identValue(A.reverseAccidentalModeMapping.get(t.accidentalMode))
          ),
        t.ornament)
      ) {
        case 1:
          v.prop(e, "iturn");
          break;
        case 2:
          v.prop(e, "turn");
          break;
        case 3:
          v.prop(e, "umordent");
          break;
        case 4:
          v.prop(e, "lmordent");
          break;
      }
      return e;
    }
    buildBeatEffects(t) {
      let e = [];
      switch (t.fade) {
        case 1:
          v.prop(e, "f");
          break;
        case 2:
          v.prop(e, "fo");
          break;
        case 3:
          v.prop(e, "vs");
          break;
      }
      if (
        (t.vibrato === 1 ? v.prop(e, "v") : t.vibrato === 2 && v.prop(e, "vw"),
        t.slap && v.prop(e, "s"),
        t.pop && v.prop(e, "p"),
        t.tap && v.prop(e, "tt"),
        t.dots >= 2 ? v.prop(e, "dd") : t.dots > 0 && v.prop(e, "d"),
        t.pickStroke === 1
          ? v.prop(e, "su")
          : t.pickStroke === 2 && v.prop(e, "sd"),
        t.hasTuplet &&
          v.prop(
            e,
            "tu",
            v.values([
              v.number(t.tupletNumerator),
              v.number(t.tupletDenominator),
            ])
          ),
        t.hasWhammyBar)
      ) {
        let s = v.values(
          [
            v.ident(re.whammyTypesReversed.get(t.whammyBarType)),
            v.ident(re.bendStylesReversed.get(t.whammyStyle)),
          ],
          !0
        );
        for (let a of t.whammyBarPoints)
          s.values.push(v.number(a.offset)), s.values.push(v.number(a.value));
        v.prop(e, "tbe", s);
      }
      let r = "";
      switch (t.brushType) {
        case 1:
          r = "bu";
          break;
        case 2:
          r = "bd";
          break;
        case 3:
          r = "au";
          break;
        case 4:
          r = "ad";
          break;
      }
      if (
        (r && v.prop(e, r, v.numberValue(t.brushDuration)),
        t.chord != null && v.prop(e, "ch", v.stringValue(t.chord.name)),
        t.ottava !== 2 &&
          v.prop(e, "ot", v.identValue(re.ottavaReversed.get(t.ottava))),
        t.hasRasgueado &&
          v.prop(
            e,
            "rasg",
            v.identValue(re.rasgueadoPatternsReversed.get(t.rasgueado))
          ),
        t.text != null && v.prop(e, "txt", v.stringValue(t.text)),
        t.lyrics != null && t.lyrics.length > 0)
      )
        if (t.lyrics.length > 1)
          for (let s = 0; s < t.lyrics.length; s++)
            v.prop(e, "lyrics", v.values([v.number(s), v.string(t.lyrics[s])]));
        else v.prop(e, "lyrics", v.stringValue(t.lyrics[0]));
      switch (
        (t.graceType !== 0 &&
          v.prop(
            e,
            "gr",
            t.graceType === 2
              ? void 0
              : v.identValue(re.graceTypesReversed.get(t.graceType))
          ),
        t.isTremolo && v.prop(e, "tp", v.numberValue(t.tremoloSpeed)),
        t.crescendo)
      ) {
        case 1:
          v.prop(e, "cre");
          break;
        case 2:
          v.prop(e, "dec");
          break;
      }
      ((t.voice.bar.index === 0 && t.index === 0) ||
        t.dynamics !== t.previousBeat?.dynamics) &&
        v.prop(e, "dy", v.identValue(re.dynamicsReversed.get(t.dynamics))),
        t.fermata != null &&
          v.prop(
            e,
            "fermata",
            v.values([
              v.ident(re.fermataTypesReversed.get(t.fermata.type)),
              v.number(t.fermata.length),
            ])
          ),
        t.isLegatoOrigin && v.prop(e, "legatoorigin");
      for (let s of t.automations)
        switch (s.type) {
          case 0:
            v.prop(
              e,
              "tempo",
              v.values([
                v.number(s.value),
                s.text.length === 0 ? void 0 : v.string(s.text),
              ])
            );
            break;
          case 1:
            v.prop(e, "volume", v.numberValue(s.value));
            break;
          case 2:
            t.voice.bar.staff.isPercussion ||
              v.prop(e, "instrument", v.identValue(Lt.getName(s.value)));
            break;
          case 3:
            v.prop(e, "balance", v.numberValue(s.value));
            break;
        }
      switch (t.wahPedal) {
        case 1:
          v.prop(e, "waho");
          break;
        case 2:
          v.prop(e, "wahc");
          break;
      }
      switch (
        (t.isBarre &&
          v.prop(
            e,
            "barre",
            v.values([
              v.number(t.barreFret),
              v.ident(re.barreShapesReversed.get(t.barreShape)),
            ])
          ),
        t.slashed && v.prop(e, "slashed"),
        t.deadSlapped && v.prop(e, "ds"),
        t.golpe)
      ) {
        case 1:
          v.prop(e, "glpt");
          break;
        case 2:
          v.prop(e, "glpf");
          break;
      }
      t.invertBeamDirection
        ? v.prop(e, "beam", v.identValue("invert"))
        : t.preferredBeamDirection !== null &&
          v.prop(e, "beam", v.identValue(Ne[t.preferredBeamDirection]));
      let n = "";
      switch (t.beamingMode) {
        case 1:
          n = "split";
          break;
        case 2:
          n = "merge";
          break;
        case 3:
          n = "splitsecondary";
          break;
      }
      return (
        n && v.prop(e, "beam", v.identValue(n)),
        t.showTimer && v.prop(e, "timer"),
        e
      );
    }
    static applyChordToBeat(t, e, r) {
      let i = t.voice.bar.staff,
        n = i.tuning.length;
      r && (t.chordId = e);
      let s = i.getChord(e);
      if (s)
        for (let a of t.notes) {
          let o = n - a.string;
          o >= 0 &&
            o < s.strings.length &&
            s.strings[o] === a.fret &&
            (a.isDeadVisual = !0);
        }
    }
  };
  (Y.instance = new Y()),
    (Y._defaultScore = new tt()),
    (Y._defaultTrack = new Tt());
  var us = Y;
  var fo = class fo {
    readMetaDataValues(t, e) {
      let r = e.tag.text.toLowerCase();
      for (let i of Ie.metaDataValueListTypes)
        if (i.has(r)) {
          let n = i.get(r);
          return n ? this._readTypedValueList(t, n) : void 0;
        }
      throw (
        (t.addParserDiagnostic({
          code: 204,
          message: `Unrecognized metadata '${e.tag.text}'.`,
          severity: 2,
          start: e.start,
          end: e.end,
        }),
        new Wi())
      );
    }
    readMetaDataPropertyValues(t, e, r) {
      switch (e.tag.text.toLowerCase()) {
        case "track":
          return this._readPropertyValues(
            t,
            [Ie.trackPropertyValueListTypes],
            r
          );
        case "chord":
          return this._readPropertyValues(
            t,
            [Ie.chordPropertyValueListTypes],
            r
          );
        case "tuning":
          return this._readPropertyValues(
            t,
            [Ie.tuningPropertyValueListTypes],
            r
          );
        case "staff":
          return this._readPropertyValues(
            t,
            [Ie.staffPropertyValueListTypes],
            r
          );
        default:
          return;
      }
    }
    readBeatPropertyValues(t, e) {
      return this._readPropertyValues(t, [Ie.beatPropertyValueListTypes], e);
    }
    readDurationChangePropertyValues(t, e) {
      return this._readPropertyValues(
        t,
        [Ie.beatDurationPropertyValueListTypes],
        e
      );
    }
    readNotePropertyValues(t, e) {
      return this._readPropertyValues(
        t,
        [Ie.notePropertyValueListTypes, Ie.beatPropertyValueListTypes],
        e
      );
    }
    _readPropertyValues(t, e, r) {
      let i = r.property.text.toLowerCase(),
        n = new Set([10, 5]);
      for (let s of e)
        if (s.has(i)) {
          let a = s.get(i);
          return a ? this._readTypedValueList(t, a, n) : void 0;
        }
      throw (
        (t.addParserDiagnostic({
          code: 205,
          message: `Unrecognized property '${r.property.text}'.`,
          severity: 2,
          start: r.property.start,
          end: r.property.end,
        }),
        new Wi())
      );
    }
    _readTypedValueList(t, e, r) {
      let i = [],
        n = t.lexer.peekToken()?.start,
        s = !1,
        a = r !== void 0,
        o = 0;
      for (; o < e.length; ) {
        let u = e[o],
          c = t.lexer.peekToken();
        if (u.parseMode === 4) {
          a = !1;
          break;
        }
        if (
          c &&
          (u.expectedTypes.has(c.nodeType) || fo._isValueListMatch(c, u)) &&
          this._handleTypeValueListItem(t, i, c, u)
        )
          switch (u.parseMode) {
            case 5:
              o = e.length;
              break;
            case 7:
              break;
            default:
              o++;
              break;
          }
        else
          switch (u.parseMode) {
            case 7:
              o++;
              break;
            case 0:
            case 2:
              t.unexpectedToken(c, Array.from(u.expectedTypes), !0), (s = !0);
              break;
            case 1:
            case 3:
            case 5:
              o++;
              break;
            case 6:
              o++;
              break;
          }
      }
      if (s) throw new Wi();
      if (a) {
        let u = t.lexer.peekToken();
        for (; u && !r.has(u.nodeType); )
          this._handleTypeValueListItem(t, i, u, void 0)
            ? (u = t.lexer.peekToken())
            : (u = void 0);
      }
      if (i.length === 0) return;
      let l = v.values(i, !1);
      return (
        (l.start = n),
        (l.end = t.lexer.previousTokenEndLocation()),
        (l.validated = !0),
        l
      );
    }
    _handleTypeValueListItem(t, e, r, i) {
      switch (r.nodeType) {
        case 10:
          let n = r;
          if (i?.allowedValues)
            if (i.allowedValues.has(n.text.toLowerCase()))
              e.push(n), t.lexer.advance();
            else return !1;
          else if (i?.reservedIdentifiers)
            if (!i.reservedIdentifiers.has(n.text.toLowerCase()))
              e.push(n), t.lexer.advance();
            else return !1;
          else e.push(n), t.lexer.advance();
          return !0;
        case 17:
          let s = r;
          return (
            i?.allowedValues
              ? i.allowedValues.has(s.text.toLowerCase()) &&
                (e.push(s), t.lexer.advance())
              : (e.push(s), t.lexer.advance()),
            !0
          );
        case 16:
          switch (i?.parseMode ?? 1) {
            case 2:
            case 3:
              e.push(t.lexer.extendToFloat(r)), t.lexer.advance();
              break;
            default:
              e.push(r), t.lexer.advance();
              break;
          }
          return !0;
        case 6:
          let o = t.valueList();
          if (o) for (let l of o.values) e.push(l);
          return !0;
      }
      return !1;
    }
    static _isValueListMatch(t, e) {
      return t.nodeType !== 6
        ? !1
        : e.expectedTypes.has(13) || e.parseMode === 7 || e.parseMode === 6;
    }
  };
  fo.instance = new fo();
  var jl = fo;
  var Ge = class Ge {
    static float64ToBytes(t) {
      return Ge._dataView.setFloat64(0, t, !0), Ge._conversionByteArray;
    }
    static bytesToInt64LE(t) {
      Ge._conversionByteArray.set(t, 0);
      let e = Ge._dataView.getBigInt64(0, !0);
      return e <= Number.MAX_SAFE_INTEGER && e >= Number.MIN_SAFE_INTEGER
        ? Number(e)
        : Number.MAX_SAFE_INTEGER;
    }
    static bytesToFloat64LE(t) {
      return Ge._conversionByteArray.set(t, 0), Ge._dataView.getFloat64(0, !0);
    }
    static bytesToFloat32LE(t) {
      return Ge._conversionByteArray.set(t, 0), Ge._dataView.getFloat32(0, !0);
    }
    static float32BEToBytes(t) {
      return (
        Ge._dataView.setFloat32(0, t, !1), Ge._conversionByteArray.slice(0, 4)
      );
    }
    static uint16ToInt16(t) {
      return Ge._dataView.setUint16(0, t, !0), Ge._dataView.getInt16(0, !0);
    }
    static int16ToUint32(t) {
      return Ge._dataView.setInt16(0, t, !0), Ge._dataView.getUint32(0, !0);
    }
    static int32ToUint16(t) {
      return Ge._dataView.setInt32(0, t, !0), Ge._dataView.getUint16(0, !0);
    }
    static int32ToInt16(t) {
      return Ge._dataView.setInt32(0, t, !0), Ge._dataView.getInt16(0, !0);
    }
    static int32ToUint32(t) {
      return Ge._dataView.setInt32(0, t, !0), Ge._dataView.getUint32(0, !0);
    }
    static uint8ToInt8(t) {
      return Ge._dataView.setUint8(0, t), Ge._dataView.getInt8(0);
    }
  };
  (Ge._conversionBuffer = new ArrayBuffer(8)),
    (Ge._conversionByteArray = new Uint8Array(Ge._conversionBuffer)),
    (Ge._dataView = new DataView(Ge._conversionBuffer));
  var ye = Ge;
  var B = class p {
    static readInt32BE(t) {
      let e = t.readByte(),
        r = t.readByte(),
        i = t.readByte(),
        n = t.readByte();
      return (e << 24) | (r << 16) | (i << 8) | n;
    }
    static readFloat32BE(t) {
      let e = new Uint8Array(4);
      return t.read(e, 0, e.length), e.reverse(), ye.bytesToFloat32LE(e);
    }
    static readFloat64BE(t) {
      let e = new Uint8Array(8);
      return t.read(e, 0, e.length), e.reverse(), ye.bytesToFloat64LE(e);
    }
    static readInt32LE(t) {
      let e = t.readByte(),
        r = t.readByte(),
        i = t.readByte();
      return (t.readByte() << 24) | (i << 16) | (r << 8) | e;
    }
    static readInt64LE(t) {
      let e = new Uint8Array(8);
      return t.read(e, 0, e.length), ye.bytesToInt64LE(e);
    }
    static readUInt32LE(t) {
      let e = t.readByte(),
        r = t.readByte(),
        i = t.readByte();
      return (t.readByte() << 24) | (i << 16) | (r << 8) | e;
    }
    static decodeUInt32LE(t, e) {
      let r = t[e],
        i = t[e + 1],
        n = t[e + 2];
      return (t[e + 3] << 24) | (n << 16) | (i << 8) | r;
    }
    static readUInt16LE(t) {
      let e = t.readByte(),
        r = t.readByte();
      return ye.int32ToUint16((r << 8) | e);
    }
    static readInt16LE(t) {
      let e = t.readByte(),
        r = t.readByte();
      return ye.int32ToInt16((r << 8) | e);
    }
    static readUInt32BE(t) {
      let e = t.readByte(),
        r = t.readByte(),
        i = t.readByte(),
        n = t.readByte();
      return ye.int32ToUint32((e << 24) | (r << 16) | (i << 8) | n);
    }
    static readUInt16BE(t) {
      let e = t.readByte(),
        r = t.readByte();
      return ye.int32ToInt16((e << 8) | r);
    }
    static readInt16BE(t) {
      let e = t.readByte(),
        r = t.readByte();
      return ye.int32ToInt16((e << 8) | r);
    }
    static readByteArray(t, e) {
      let r = new Uint8Array(e);
      return t.read(r, 0, e), r;
    }
    static read8BitChars(t, e) {
      let r = new Uint8Array(e);
      return t.read(r, 0, r.length), p.toString(r, "utf-8");
    }
    static read8BitString(t) {
      let e = "",
        r = t.readByte();
      for (; r !== 0; ) (e += String.fromCharCode(r)), (r = t.readByte());
      return e;
    }
    static read8BitStringLength(t, e) {
      let r = "",
        i = -1;
      for (let s = 0; s < e; s++) {
        let a = t.readByte();
        a === 0 && i === -1 && (i = s), (r += String.fromCharCode(a));
      }
      let n = r;
      return i >= 0 ? n.substr(0, i) : n;
    }
    static readSInt8(t) {
      let e = t.readByte();
      return ((e & 255) >> 7) * -256 + (e & 255);
    }
    static readInt24(t, e) {
      let r = t[e] | (t[e + 1] << 8) | (t[e + 2] << 16);
      return (r & 8388608) === 8388608 && (r = r | (255 << 24)), r;
    }
    static readInt16(t, e) {
      return ye.int32ToInt16(t[e] | (t[e + 1] << 8));
    }
    static toString(t, e) {
      let r = p._detectEncoding(t);
      return (
        r && (e = r), e || (e = "utf-8"), new TextDecoder(e).decode(t.buffer)
      );
    }
    static _detectEncoding(t) {
      return t.length > 2 && t[0] === 254 && t[1] === 255
        ? "utf-16be"
        : t.length > 2 && t[0] === 255 && t[1] === 254
        ? "utf-16le"
        : t.length > 4 &&
          t[0] === 0 &&
          t[1] === 0 &&
          t[2] === 254 &&
          t[3] === 255
        ? "utf-32be"
        : t.length > 4 &&
          t[0] === 255 &&
          t[1] === 254 &&
          t[2] === 0 &&
          t[3] === 0
        ? "utf-32le"
        : null;
    }
    static stringToBytes(t) {
      return new TextEncoder().encode(t);
    }
    static writeInt32BE(t, e) {
      t.writeByte((e >> 24) & 255),
        t.writeByte((e >> 16) & 255),
        t.writeByte((e >> 8) & 255),
        t.writeByte((e >> 0) & 255);
    }
    static writeInt32LE(t, e) {
      t.writeByte((e >> 0) & 255),
        t.writeByte((e >> 8) & 255),
        t.writeByte((e >> 16) & 255),
        t.writeByte((e >> 24) & 255);
    }
    static writeUInt16LE(t, e) {
      t.writeByte((e >> 0) & 255), t.writeByte((e >> 8) & 255);
    }
    static writeInt16LE(t, e) {
      t.writeByte((e >> 0) & 255), t.writeByte((e >> 8) & 255);
    }
    static writeInt16BE(t, e) {
      t.writeByte((e >> 8) & 255), t.writeByte((e >> 0) & 255);
    }
    static writeFloat32BE(t, e) {
      let r = ye.float32BEToBytes(e);
      t.write(r, 0, r.length);
    }
    static *iterateCodepoints(t) {
      let e = 0;
      for (; e < t.length; ) {
        let r = t.charCodeAt(e);
        p.isLeadingSurrogate(r) &&
          e + 1 < t.length &&
          (e++, (r = (r - 55296) * 1024 + (t.charCodeAt(e) - 56320) + 65536)),
          e++,
          yield r;
      }
    }
    static isLeadingSurrogate(t) {
      return t >= 55296 && t <= 56319;
    }
    static isTrailingSurrogate(t) {
      return t >= 56320 && t <= 57343;
    }
  };
  var Le = class Le {
    constructor(t) {
      this._codepoint = Le._eof;
      this._offset = 0;
      this._line = 1;
      this._col = 1;
      this._fatalError = !1;
      this._tokenStart = { line: 0, col: 0, offset: 0 };
      this.lexerDiagnostics = new Ni();
      (this._codepoints = [...B.iterateCodepoints(t)]),
        (this._offset = 0),
        (this._line = 1),
        (this._col = 1),
        (this._codepoint =
          this._codepoints.length > 0 ? this._codepoints[0] : Le._eof);
    }
    peekToken() {
      if (this._fatalError) return;
      let t = this._peekedToken;
      return t || ((t = this._readToken()), (this._peekedToken = t), t);
    }
    extendToFloat(t) {
      if (
        this._codepoint !== 46 ||
        this._offset + 1 >= this._codepoints.length ||
        !Le._isDigit(this._codepoints[this._offset + 1])
      )
        return t;
      let e = this._offset + 2;
      for (; e < this._codepoints.length && Le._isDigit(this._codepoints[e]); )
        e++;
      if (
        e < this._codepoints.length &&
        Le._isIdentifierCharacter(this._codepoints[e])
      )
        return t;
      let r = e - this._offset - 1;
      return (
        (this._offset += r),
        (this._col += r),
        this._nextCodepoint(),
        (t.end = this._currentLexerLocation()),
        (t.value = Number.parseFloat(
          String.fromCodePoint(
            ...this._codepoints.slice(t.start.offset, t.end.offset)
          )
        )),
        t
      );
    }
    advance() {
      (this._previousToken = this._peekedToken), (this._peekedToken = void 0);
    }
    _nextCodepoint() {
      let t = this._codepoints,
        e = this._offset;
      if (e < t.length - 1) {
        ++e;
        let r = t[e];
        return (
          (this._codepoint = r),
          r === 10
            ? ((this._trailingCommentNode = void 0),
              ++this._line,
              (this._col = 1))
            : ++this._col,
          (this._offset = e),
          r
        );
      } else
        this._codepoint !== Le._eof &&
          ((this._codepoint = Le._eof), ++this._col, (this._offset = t.length));
      return Le._eof;
    }
    previousTokenEndLocation() {
      return this._previousToken?.end ?? this._currentLexerLocation();
    }
    currentTokenLocation() {
      return this._peekedToken?.start ?? this._currentLexerLocation();
    }
    _currentLexerLocation() {
      return { line: this._line, col: this._col, offset: this._offset };
    }
    _readToken() {
      for (this._leadingComments = void 0; this._codepoint !== Le._eof; )
        if (
          ((this._tokenStart = this._currentLexerLocation()),
          Le._terminalTokens.has(this._codepoint))
        ) {
          let t = Le._terminalTokens.get(this._codepoint)(this);
          if (t) return (this._trailingCommentNode = t), t;
        } else if (Le._isIdentifierCharacter(this._codepoint)) {
          let t = this._numberOrIdentifier();
          return (this._trailingCommentNode = t), t;
        } else this._codepoint = this._nextCodepoint();
    }
    _comment() {
      (this._codepoint = this._nextCodepoint()),
        this._codepoint === 47
          ? this._singleLineComment()
          : this._codepoint === 42
          ? this._multiLineComment()
          : (this.lexerDiagnostics.push({
              code: 1,
              message: `Unexpected character at comment start, expected '//' or '/*' but found '/${String.fromCodePoint(
                this._codepoint
              )}'`,
              severity: 2,
              start: this._tokenStart,
              end: this._currentLexerLocation(),
            }),
            (this._fatalError = !0));
    }
    _metaCommand() {
      let t = this._currentLexerLocation();
      this._codepoint = this._nextCodepoint();
      let e, r;
      this._codepoint === 92
        ? ((this._codepoint = this._nextCodepoint()),
          (r = this._currentLexerLocation()),
          (e = { nodeType: 2, start: t, end: r }))
        : ((r = this._currentLexerLocation()),
          (e = { nodeType: 1, start: t, end: r }));
      let i = "";
      for (; Le._isIdentifierCharacter(this._codepoint); )
        (i += String.fromCodePoint(this._codepoint)),
          (this._codepoint = this._nextCodepoint());
      if (i.length === 0) {
        this.lexerDiagnostics.push({
          code: 2,
          message: "Missing identifier after meta data start",
          severity: 2,
          start: this._tokenStart,
          end: this._currentLexerLocation(),
        });
        return;
      }
      return {
        nodeType: 11,
        leadingComments: this._leadingComments,
        start: this._tokenStart,
        end: this._currentLexerLocation(),
        prefix: e,
        tag: {
          nodeType: 10,
          text: i,
          start: r,
          end: this._currentLexerLocation(),
        },
      };
    }
    _token(t) {
      return (
        (t.leadingComments = this._leadingComments),
        (t.start = this._tokenStart),
        (t.end = this._currentLexerLocation()),
        (this._codepoint = this._nextCodepoint()),
        t
      );
    }
    _string() {
      let t = this._codepoint;
      this._codepoint = this._nextCodepoint();
      let e = "",
        r = -1;
      for (; this._codepoint !== t && this._codepoint !== Le._eof; ) {
        let n = -1;
        if (this._codepoint === 92)
          if (
            ((this._codepoint = this._nextCodepoint()), this._codepoint === 92)
          )
            n = 92;
          else if (this._codepoint === t) n = t;
          else if (this._codepoint === 82 || this._codepoint === 114) n = 13;
          else if (this._codepoint === 78 || this._codepoint === 110) n = 10;
          else if (this._codepoint === 84 || this._codepoint === 116) n = 9;
          else if (this._codepoint === 117) {
            let s = "";
            for (let a = 0; a < 4; a++) {
              if (
                ((this._codepoint = this._nextCodepoint()),
                this._codepoint === Le._eof)
              ) {
                this.lexerDiagnostics.push({
                  code: 3,
                  message:
                    "Unexpected end of file. Need 4 hex characters on a \\uXXXX escape sequence",
                  severity: 2,
                  start: this._tokenStart,
                  end: this._currentLexerLocation(),
                }),
                  (this._fatalError = !0);
                return;
              }
              s += String.fromCodePoint(this._codepoint);
            }
            if (((n = Number.parseInt(s, 16)), Number.isNaN(n))) {
              this.lexerDiagnostics.push({
                code: 4,
                message:
                  "Invalid unicode value. Need 4 hex characters on a \\uXXXX escape sequence.",
                severity: 2,
                start: this._tokenStart,
                end: this._currentLexerLocation(),
              }),
                (this._fatalError = !0);
              return;
            }
          } else {
            this.lexerDiagnostics.push({
              code: 5,
              message: `Unsupported escape sequence. Expected '\\n', '\\r', '\\t', or '\\uXXXX' but found '\\${String.fromCodePoint(
                this._codepoint
              )}'.`,
              severity: 2,
              start: this._tokenStart,
              end: this._currentLexerLocation(),
            }),
              (this._fatalError = !0);
            return;
          }
        else n = this._codepoint;
        B.isLeadingSurrogate(r) && B.isTrailingSurrogate(n)
          ? ((n = (r - 55296) * 1024 + (n - 56320) + 65536),
            (e += String.fromCodePoint(n)))
          : B.isLeadingSurrogate(n) ||
            (B.isLeadingSurrogate(r) && (e += String.fromCodePoint(r)),
            n > 0 && (e += String.fromCodePoint(n))),
          (r = n),
          (this._codepoint = this._nextCodepoint());
      }
      if (this._codepoint === Le._eof) {
        this.lexerDiagnostics.push({
          code: 6,
          message: "Unexpected end of file. String not closed.",
          severity: 2,
          start: this._tokenStart,
          end: this._currentLexerLocation(),
        }),
          (this._fatalError = !0);
        return;
      }
      let i = {
        nodeType: 17,
        text: e,
        leadingComments: this._leadingComments,
        start: this._tokenStart,
        end: this._currentLexerLocation(),
      };
      return (this._codepoint = this._nextCodepoint()), i;
    }
    _multiLineComment() {
      let t = this._trailingCommentNode,
        e = {
          start: this._tokenStart,
          end: this._currentLexerLocation(),
          text: "",
          multiLine: !0,
        };
      for (; this._codepoint !== Le._eof; )
        if (this._codepoint === 42)
          if (
            ((this._codepoint = this._nextCodepoint()), this._codepoint === 47)
          ) {
            this._codepoint = this._nextCodepoint();
            break;
          } else
            (e.text += `*${String.fromCodePoint(this._codepoint)}`),
              (e.end.line = this._line),
              (e.end.col = this._col),
              (e.end.offset = this._offset);
        else
          (this._codepoint = this._nextCodepoint()),
            (e.text += String.fromCodePoint(this._codepoint)),
            (e.end.line = this._line),
            (e.end.col = this._col),
            (e.end.offset = this._offset);
      t
        ? (t.trailingComments ?? (t.trailingComments = []),
          t.trailingComments.push(e))
        : (this._leadingComments ?? (this._leadingComments = []),
          this._leadingComments.push(e));
    }
    _numberOrIdentifier() {
      let t = "",
        e = !0,
        r = this._codepoint;
      r === 45 &&
        ((t += String.fromCodePoint(r)),
        (r = this._nextCodepoint()),
        Le._isDigit(r) || (e = !1));
      let i = !0;
      do
        e
          ? Le._isDigit(r)
            ? ((t += String.fromCodePoint(r)),
              (r = this._nextCodepoint()),
              (i = !0))
            : Le._isIdentifierCharacter(r)
            ? ((e = !1),
              (t += String.fromCodePoint(r)),
              (r = this._nextCodepoint()),
              (i = !0))
            : (i = !1)
          : Le._isIdentifierCharacter(r)
          ? ((t += String.fromCodePoint(r)),
            (r = this._nextCodepoint()),
            (i = !0))
          : (i = !1);
      while (i);
      return e
        ? {
            nodeType: 16,
            leadingComments: this._leadingComments,
            start: this._tokenStart,
            end: this._currentLexerLocation(),
            value: Number.parseInt(t, 10),
          }
        : {
            nodeType: 10,
            leadingComments: this._leadingComments,
            start: this._tokenStart,
            end: this._currentLexerLocation(),
            text: t,
          };
    }
    _singleLineComment() {
      let t = this._trailingCommentNode,
        e = {
          start: this._tokenStart,
          end: this._currentLexerLocation(),
          text: "",
          multiLine: !1,
        },
        r = this._codepoint;
      for (
        ;
        r !== Le._eof &&
        ((r = this._nextCodepoint()), r !== 10 && r !== Le._eof);

      )
        (e.text += String.fromCodePoint(r)),
          (e.end.line = this._line),
          (e.end.col = this._col),
          (e.end.offset = this._offset);
      t
        ? (t.trailingComments ?? (t.trailingComments = []),
          t.trailingComments.push(e))
        : (this._leadingComments ?? (this._leadingComments = []),
          this._leadingComments.push(e));
    }
    _whitespace() {
      let t = this._codepoint;
      for (; Le._isWhiteSpace(t); )
        t === 10 && (this._trailingCommentNode = void 0),
          (t = this._nextCodepoint());
    }
    static _isDigit(t) {
      return t >= 48 && t <= 57;
    }
    static _buildNonIdentifierChars() {
      let t = new Set();
      for (let e of Le._terminalTokens.keys()) t.add(e);
      return t.delete(45), t.add(Le._eof), t;
    }
    static _isIdentifierCharacter(t) {
      return !Le._nonIdentifierChars.has(t);
    }
    static _isWhiteSpace(t) {
      return t === 32 || t === 10 || t === 13 || t === 9 || t === 11;
    }
  };
  (Le._eof = 0),
    (Le._terminalTokens = new Map([
      [47, (t) => t._comment()],
      [34, (t) => t._string()],
      [39, (t) => t._string()],
      [45, (t) => t._numberOrIdentifier()],
      [46, (t) => t._token({ nodeType: 0 })],
      [58, (t) => t._token({ nodeType: 8 })],
      [40, (t) => t._token({ nodeType: 6 })],
      [41, (t) => t._token({ nodeType: 7 })],
      [123, (t) => t._token({ nodeType: 4 })],
      [125, (t) => t._token({ nodeType: 5 })],
      [124, (t) => t._token({ nodeType: 3 })],
      [42, (t) => t._token({ nodeType: 9 })],
      [92, (t) => t._metaCommand()],
      [9, (t) => t._whitespace()],
      [10, (t) => t._whitespace()],
      [11, (t) => t._whitespace()],
      [13, (t) => t._whitespace()],
      [32, (t) => t._whitespace()],
    ])),
    (Le._nonIdentifierChars = Le._buildNonIdentifierChars());
  var Qs = Le;
  var cs = class {
    constructor(t) {
      this._metaDataReader = jl.instance;
      this.parserDiagnostics = new Ni();
      this.lexer = new Qs(t);
    }
    get lexerDiagnostics() {
      return this.lexer.lexerDiagnostics;
    }
    addParserDiagnostic(t) {
      this.parserDiagnostics.push(t);
    }
    unexpectedToken(t, e, r) {
      if (
        (t
          ? this.addParserDiagnostic({
              code: 202,
              message: `Unexpected '${
                St[t.nodeType]
              }' token. Expected one of following: ${e
                .map((i) => St[i])
                .join(",")}`,
              severity: 2,
              start: t.start,
              end: t.end,
            })
          : this.addParserDiagnostic({
              code: 203,
              start: this.lexer.currentTokenLocation(),
              end: this.lexer.currentTokenLocation(),
              severity: 2,
              message: "Unexpected end of file.",
            }),
        r)
      )
        throw new Wi();
    }
    read() {
      return this._score(), this._scoreNode;
    }
    _score() {
      this._scoreNode = {
        nodeType: 18,
        bars: [],
        start: this.lexer.currentTokenLocation(),
      };
      try {
        this._bars();
      } catch (t) {
        if (!(t instanceof Wi)) throw t;
      } finally {
        this._scoreNode.end = this.lexer.previousTokenEndLocation();
      }
    }
    _bars() {
      let t = this.lexer.peekToken();
      for (; t; ) this._bar(), (t = this.lexer.peekToken());
    }
    _bar() {
      let t = {
        nodeType: 19,
        metaData: [],
        beats: [],
        pipe: void 0,
        start: this.lexer.currentTokenLocation(),
      };
      try {
        this._barMetaData(t), this._barBeats(t);
        let e = this.lexer.peekToken();
        e?.nodeType === 3 && ((t.pipe = e), this.lexer.advance()),
          (t.metaData.length > 0 || t.beats.length > 0 || t.pipe) &&
            ((t.end = this.lexer.previousTokenEndLocation()),
            this._scoreNode.bars.push(t));
      } finally {
        t.end = this.lexer.previousTokenEndLocation();
      }
    }
    _barMetaData(t) {
      let e = this.lexer.peekToken();
      for (; e && (e.nodeType === 11 || e.nodeType === 0); )
        e.nodeType === 0
          ? (this.lexer.advance(),
            this.addParserDiagnostic({
              code: 400,
              message:
                "The dots separating score metadata, score contents and the sync points can be removed.",
              severity: 0,
              start: e.start,
              end: e.end,
            }))
          : t.metaData.push(this._metaData()),
          (e = this.lexer.peekToken());
    }
    _barBeats(t) {
      let e = this.lexer.peekToken();
      for (; e && e.nodeType !== 3 && e.nodeType !== 0 && e.nodeType !== 11; ) {
        let r = this._beat();
        r && t.beats.push(r), (e = this.lexer.peekToken());
      }
    }
    _beat() {
      let t = {
        nodeType: 20,
        durationChange: void 0,
        notes: void 0,
        rest: void 0,
        beatEffects: void 0,
        beatMultiplier: void 0,
        beatMultiplierValue: void 0,
        start: this.lexer.peekToken()?.start,
      };
      try {
        if (
          ((t.durationChange = this._beatDurationChange()),
          this._beatContent(t),
          !t.notes && !t.rest)
        )
          return t;
        this._beatDuration(t),
          this._beatMultiplier(t),
          (t.beatEffects = this._properties((e) =>
            this._metaDataReader.readBeatPropertyValues(this, e)
          )),
          t.beatMultiplierValue !== void 0 &&
            t.beatEffects?.openBrace &&
            this.addParserDiagnostic({
              code: 304,
              message:
                "The beat multiplier should be specified after the beat effects.",
              severity: 1,
              start: t.beatMultiplier.start,
              end: t.beatMultiplierValue.end,
            }),
          this._beatMultiplier(t);
      } finally {
        t.end = this.lexer.previousTokenEndLocation();
      }
      return t;
    }
    _beatDuration(t) {
      let e = this.lexer.peekToken();
      if (e?.nodeType !== 0) return;
      (t.durationDot = e), this.lexer.advance();
      let r = this.lexer.peekToken();
      if (r?.nodeType === 16) {
        (t.durationValue = r), this.lexer.advance();
        return;
      } else if (r?.nodeType === 11) {
        t.durationDot = void 0;
        return;
      } else if (r) this.unexpectedToken(r, [16], !0);
      else return;
    }
    _beatDurationChange() {
      let t = this.lexer.peekToken();
      if (t?.nodeType !== 8) return;
      this.lexer.advance();
      let e = {
        nodeType: 21,
        colon: t,
        value: void 0,
        properties: void 0,
        start: t.start,
      };
      try {
        let r = this.lexer.peekToken();
        if (!r || r.nodeType !== 16) {
          this.addParserDiagnostic({
            code: 201,
            message: "Missing duration value after ':'.",
            severity: 2,
            start: t.start,
            end: t.end,
          });
          return;
        }
        this.lexer.advance(),
          (e.value = r),
          (e.properties = this._properties((i) =>
            this._metaDataReader.readDurationChangePropertyValues(this, i)
          ));
      } finally {
        e.end = this.lexer.previousTokenEndLocation();
      }
      return e;
    }
    _beatContent(t) {
      let e = this.lexer.peekToken();
      if (e)
        if (e.nodeType === 10 && e.text === "r")
          (t.rest = e), this.lexer.advance();
        else if (e.nodeType === 6) t.notes = this._noteList(e);
        else {
          let r = this._note(e);
          r &&
            (t.notes = {
              nodeType: 22,
              openParenthesis: void 0,
              notes: [r],
              closeParenthesis: void 0,
              start: r.start,
              end: r.end,
            });
        }
    }
    _beatMultiplier(t) {
      let e = this.lexer.peekToken();
      if (!e || e.nodeType !== 9) return;
      this.lexer.advance(), (t.beatMultiplier = e);
      let r = this.lexer.peekToken();
      if (!r || r.nodeType !== 16) {
        this.addParserDiagnostic({
          code: 200,
          message: "Missing beat multiplier value after '*'.",
          severity: 2,
          start: t.beatMultiplier.start,
          end: t.beatMultiplier.end,
        });
        return;
      }
      (t.beatMultiplierValue = r), this.lexer.advance();
    }
    _noteList(t) {
      let e = {
        nodeType: 22,
        openParenthesis: void 0,
        notes: [],
        closeParenthesis: void 0,
        start: this.lexer.currentTokenLocation(),
      };
      try {
        (e.openParenthesis = t), this.lexer.advance();
        let r = this.lexer.peekToken();
        for (; r && r.nodeType !== 7; ) {
          let n = this._note(r);
          if (n) e.notes.push(n);
          else break;
          r = this.lexer.peekToken();
        }
        let i = this.lexer.peekToken();
        i?.nodeType === 7
          ? ((e.closeParenthesis = i), this.lexer.advance())
          : this.addParserDiagnostic({
              code: 206,
              message: "Unexpected end of file. Group not closed.",
              severity: 2,
              start: i?.start ?? this.lexer.currentTokenLocation(),
              end: i?.end ?? this.lexer.currentTokenLocation(),
            });
      } finally {
        e.end = this.lexer.previousTokenEndLocation();
      }
      return e;
    }
    _note(t) {
      let e = {
        nodeType: 23,
        noteValue: { nodeType: 10, text: "" },
        start: t.start,
      };
      try {
        let r = !1;
        switch (t.nodeType) {
          case 16:
            (e.noteValue = t), this.lexer.advance(), (r = !0);
            break;
          case 17:
            switch (
              ((e.noteValue = t), this.lexer.advance(), e.noteValue.text)
            ) {
              case "x":
              case "-":
                r = !0;
                break;
            }
            break;
          case 10:
            switch (
              ((e.noteValue = t), this.lexer.advance(), e.noteValue.text)
            ) {
              case "x":
              case "-":
                r = !0;
                break;
            }
            break;
          default:
            this.unexpectedToken(t, [16, 17, 10], !0);
            return;
        }
        if (r) {
          let i = this.lexer.peekToken();
          if (i?.nodeType === 0) {
            let n = i;
            this.lexer.advance();
            let s = this.lexer.peekToken();
            if (!s) {
              this.unexpectedToken(s, [16], !0);
              return;
            }
            if (s.nodeType === 11) return e;
            if (s.nodeType === 16)
              (e.noteStringDot = n), (e.noteString = s), this.lexer.advance();
            else {
              this.unexpectedToken(s, [16], !0);
              return;
            }
          }
        }
        e.noteEffects = this._properties((i) =>
          this._metaDataReader.readNotePropertyValues(this, i)
        );
      } finally {
        e.end = this.lexer.previousTokenEndLocation();
      }
      return e;
    }
    _metaData() {
      let t = this.lexer.peekToken();
      if (!t || t.nodeType !== 11) return;
      let e = {
        nodeType: 12,
        tag: t,
        start: t.start,
        properties: void 0,
        propertiesBeforeValues: !1,
      };
      this.lexer.advance();
      try {
        this.lexer.peekToken()?.nodeType === 4
          ? ((e.propertiesBeforeValues = !0),
            (e.properties = this._properties((i) =>
              this._metaDataReader.readMetaDataPropertyValues(this, e.tag, i)
            )),
            (e.values = this.valueList()),
            e.values ||
              ((e.values = this._metaDataReader.readMetaDataValues(
                this,
                e.tag
              )),
              e.values &&
                e.values.values.length > 1 &&
                (this.addParserDiagnostic({
                  code: 301,
                  message:
                    "Metadata values should be wrapped into parenthesis.",
                  severity: 1,
                  start: e.values?.start ?? e.start,
                  end: e.values?.end ?? e.end,
                }),
                this.addParserDiagnostic({
                  code: 302,
                  message:
                    "Metadata values should be placed before metadata properties.",
                  severity: 1,
                  start: e.values?.start ?? e.start,
                  end: e.values?.end ?? e.end,
                }))))
          : ((e.values = this.valueList()),
            e.values ||
              ((e.values = this._metaDataReader.readMetaDataValues(
                this,
                e.tag
              )),
              e.values &&
                e.values.values.length > 1 &&
                this.addParserDiagnostic({
                  code: 301,
                  message:
                    "Metadata values should be wrapped into parenthesis.",
                  severity: 1,
                  start: e.values?.start ?? e.start,
                  end: e.values?.end ?? e.end,
                })),
            (e.properties = this._properties((i) =>
              this._metaDataReader.readMetaDataPropertyValues(this, e.tag, i)
            )));
      } finally {
        e.end = this.lexer.previousTokenEndLocation();
      }
      return e;
    }
    _properties(t) {
      let e = this.lexer.peekToken();
      if (!e || e.nodeType !== 4) return;
      let r = {
        nodeType: 14,
        openBrace: e,
        properties: [],
        closeBrace: void 0,
        start: e.start,
      };
      this.lexer.advance();
      try {
        let i = this.lexer.peekToken();
        for (; i?.nodeType === 10; )
          r.properties.push(this._property(i, t)), (i = this.lexer.peekToken());
        let n = this.lexer.peekToken();
        n?.nodeType === 5
          ? ((r.closeBrace = n), this.lexer.advance())
          : this.addParserDiagnostic({
              code: 206,
              message: "Unexpected end of file. Group not closed.",
              severity: 2,
              start: this.lexer.currentTokenLocation(),
              end: this.lexer.currentTokenLocation(),
            });
      } finally {
        r.end = this.lexer.previousTokenEndLocation();
      }
      return r;
    }
    _property(t, e) {
      let r = { nodeType: 15, property: t, values: void 0 };
      this.lexer.advance(), (r.start = r.property.start);
      try {
        (r.values = this.valueList()),
          r.values ||
            ((r.values = e(r)),
            r.values &&
              r.values.values.length > 1 &&
              this.addParserDiagnostic({
                code: 303,
                message: "Property values should be wrapped into parenthesis.",
                severity: 1,
                start: r.values.start,
                end: r.values.end,
              }));
      } finally {
        r.end = this.lexer.previousTokenEndLocation();
      }
      return r;
    }
    valueList() {
      let t = this.lexer.peekToken();
      if (t?.nodeType !== 6) return;
      let e = {
        nodeType: 13,
        openParenthesis: t,
        values: [],
        closeParenthesis: void 0,
        start: t.start,
      };
      this.lexer.advance();
      try {
        let r = this.lexer.peekToken();
        for (; r && r?.nodeType !== 7; ) {
          switch (r.nodeType) {
            case 10:
              e.values.push(r), this.lexer.advance();
              break;
            case 17:
              e.values.push(r), this.lexer.advance();
              break;
            case 16:
              e.values.push(this.lexer.extendToFloat(r)), this.lexer.advance();
              break;
            default:
              this.unexpectedToken(r, [10, 17, 16], !1), this.lexer.advance();
              break;
          }
          r = this.lexer.peekToken();
        }
        let i = this.lexer.peekToken();
        i?.nodeType === 7
          ? ((e.closeParenthesis = i), this.lexer.advance())
          : this.addParserDiagnostic({
              code: 206,
              message: "Unexpected end of file. Group not closed.",
              severity: 2,
              start: this.lexer.currentTokenLocation(),
              end: this.lexer.currentTokenLocation(),
            });
      } finally {
        e.end = this.lexer.previousTokenEndLocation();
      }
      return e;
    }
  };
  var Kt = class {
    init(t, e) {
      (this.data = t), (this.settings = e), tt.resetIds();
    }
  };
  var ke = class extends te {
    constructor(t = null, e) {
      super(1, t ?? "Unsupported format", e);
    }
  };
  var Se = class p {
    constructor() {
      this.length = 0;
      this.position = 0;
    }
    get bytesWritten() {
      return this.position;
    }
    getBuffer() {
      return this._buffer;
    }
    static empty() {
      return p.withCapacity(0);
    }
    static withCapacity(t) {
      let e = new p();
      return (e._buffer = new Uint8Array(t)), e;
    }
    static fromBuffer(t) {
      let e = new p();
      return (e._buffer = t), (e.length = t.length), e;
    }
    static fromString(t) {
      let e = B.stringToBytes(t);
      return p.fromBuffer(e);
    }
    reset() {
      this.position = 0;
    }
    skip(t) {
      this.position += t;
    }
    readByte() {
      return this.length - this.position <= 0
        ? -1
        : this._buffer[this.position++];
    }
    read(t, e, r) {
      let i = this.length - this.position;
      return (
        i > r && (i = r),
        i <= 0
          ? 0
          : (t.set(this._buffer.subarray(this.position, this.position + i), e),
            (this.position += i),
            i)
      );
    }
    writeByte(t) {
      let e = this.position + 1;
      this._ensureCapacity(e),
        (this._buffer[this.position] = t & 255),
        e > this.length && (this.length = e),
        (this.position = e);
    }
    write(t, e, r) {
      let i = this.position + r;
      this._ensureCapacity(i);
      let n = Math.min(r, t.length - e);
      this._buffer.set(t.subarray(e, e + n), this.position),
        i > this.length && (this.length = i),
        (this.position = i);
    }
    _ensureCapacity(t) {
      if (t > this._buffer.length) {
        let e = t;
        e < 256 && (e = 256),
          e < this._buffer.length * 2 && (e = this._buffer.length * 2);
        let r = new Uint8Array(e);
        this.length > 0 && r.set(this._buffer.subarray(0, 0 + this.length), 0),
          (this._buffer = r);
      }
    }
    readAll() {
      return this.toArray();
    }
    toArray() {
      let t = new Uint8Array(this.length);
      return t.set(this._buffer.subarray(0, 0 + this.length), 0), t;
    }
    copyTo(t) {
      t.write(this._buffer, 0, this.length);
    }
  };
  var Zs = class p extends te {
      *iterateDiagnostics() {
        if (this.lexerDiagnostics)
          for (let t of this.lexerDiagnostics.items) yield t;
        if (this.parserDiagnostics)
          for (let t of this.parserDiagnostics.items) yield t;
        if (this.semanticDiagnostics)
          for (let t of this.semanticDiagnostics.items) yield t;
      }
      constructor(t, e, r, i) {
        super(2, t),
          (this.lexerDiagnostics = e),
          (this.parserDiagnostics = r),
          (this.semanticDiagnostics = i);
      }
      toString() {
        return [
          this.message,
          "lexer diagnostics:",
          p._diagnosticsToString(this.lexerDiagnostics, "  "),
          "parser diagnostics:",
          p._diagnosticsToString(this.parserDiagnostics, "  "),
          "semantic diagnostics:",
          p._diagnosticsToString(this.semanticDiagnostics, "  "),
        ].join(`
`);
      }
      static _diagnosticsToString(t, e) {
        return t
          ? t.items.map(
              (r) =>
                `${e}${Hi[r.severity]} AT${r.code
                  .toString()
                  .padStart(3, "0")}${p._locationToString(r)}: ${r.message}`
            ).join(`
`)
          : `${e}none`;
      }
      static _locationToString(t) {
        let e = "";
        return (
          t.start && (e += `(${t.start.line},${t.start.col})`),
          t.end &&
            (e.length > 0 && (e += "->"),
            (e += `(${t.end.line},${t.end.col})`)),
          e
        );
      }
    },
    eu = class {
      constructor() {
        this.trackChannel = 0;
        this.barIndex = 0;
        this.voiceIndex = 0;
        this.ignoredInitialVoice = !1;
        this.ignoredInitialStaff = !1;
        this.ignoredInitialTrack = !1;
        this.currentDuration = 4;
        this.articulationValueToIndex = new Map();
        this.hasAnyProperData = !1;
        this.percussionArticulationNames = new Map();
        this.slurs = new Map();
        this.lyrics = new Map();
        this.sustainPedalToBeat = new Map();
        this.staffTuningApplied = new Set();
        this.staffNoteKind = new Map();
        this.staffHasExplicitTuning = new Set();
        this.staffHasExplicitDisplayTransposition = new Set();
        this.staffDisplayTranspositionApplied = new Set();
        this.staffInitialClef = new Map();
        this.syncPoints = [];
        this.currentDynamics = 5;
        this.accidentalMode = 1;
        this.currentTupletNumerator = -1;
        this.currentTupletDenominator = -1;
        this.currentChordId = null;
      }
    },
    Ei = class extends Kt {
      constructor() {
        super(...arguments);
        this._handler = us.instance;
        this._state = new eu();
        this.logErrors = !1;
        this.semanticDiagnostics = new Ni();
      }
      get state() {
        return this._state;
      }
      get name() {
        return "AlphaTex";
      }
      get lexerDiagnostics() {
        return this._parser.lexerDiagnostics;
      }
      get parserDiagnostics() {
        return this._parser.parserDiagnostics;
      }
      addSemanticDiagnostic(e) {
        this.semanticDiagnostics.push(e);
      }
      initFromString(e, r) {
        (this.data = Se.empty()),
          (this._parser = new cs(e)),
          (this.settings = r),
          tt.resetIds();
      }
      readScore() {
        (this._state = new eu()),
          this._createDefaultScore(),
          this.data.length > 0 &&
            (this._parser = new cs(
              B.toString(this.data.readAll(), this.settings.importer.encoding)
            ));
        let e;
        try {
          e = this._parser.read();
        } catch (r) {
          throw (
            (this.logErrors &&
              w.error(
                "AlphaTex",
                `Error while parsing alphaTex: ${r.toString()}`
              ),
            new ke("Error parsing alphaTex, check inner error for details", r))
          );
        }
        if (
          this._parser.parserDiagnostics.hasErrors ||
          this._parser.lexer.lexerDiagnostics.hasErrors
        ) {
          let r = new Zs(
            "There are errors in the parsed alphaTex, check the diagnostics for details",
            this.lexerDiagnostics,
            this.parserDiagnostics,
            this.semanticDiagnostics
          );
          throw (
            (this.logErrors &&
              w.error(
                "AlphaTex",
                `Error while parsing alphaTex: ${r.toString()}`
              ),
            new ke(
              "Error parsing alphaTex, check diagnostics on inner error for details",
              r
            ))
          );
        }
        if (e.bars.length === 0) throw new ke("No alphaTex data found");
        if ((this._bars(e), this.semanticDiagnostics.hasErrors))
          if (this._state.hasAnyProperData) {
            let r = new Zs(
              "There are errors in the parsed alphaTex, check the diagnostics for details",
              this.lexerDiagnostics,
              this.parserDiagnostics,
              this.semanticDiagnostics
            );
            throw (
              (this.logErrors &&
                w.error(
                  "AlphaTex",
                  `Error while parsing alphaTex: ${r.toString()}`
                ),
              r)
            );
          } else throw new ke("No alphaTex data found");
        A.consolidate(this._state.score),
          this._state.score.finish(this.settings),
          A.trimEmptyBarsAtEnd(this._state.score),
          this._state.score.rebuildRepeatGroups(),
          this._state.score.applyFlatSyncPoints(this._state.syncPoints);
        for (let [r, i] of this._state.lyrics)
          this._state.score.tracks[r].applyLyrics(i);
        for (let [r, i] of this._state.sustainPedalToBeat)
          if (r.ratioPosition < 1) {
            let n = i.voice.bar.masterBar.calculateDuration();
            r.ratioPosition = i.playbackStart / n;
          }
        return this._state.score;
      }
      _createDefaultScore() {
        (this._state.score = new tt()), this._newTrack();
      }
      _newTrack() {
        (this._state.currentTrack = new Tt()),
          this._state.currentTrack.ensureStaveCount(1),
          (this._state.currentTrack.playbackInfo.program = 25),
          (this._state.currentTrack.playbackInfo.primaryChannel = this._state
            .trackChannel++),
          (this._state.currentTrack.playbackInfo.secondaryChannel = this._state
            .trackChannel++);
        let e = this._state.currentTrack.staves[0];
        (e.displayTranspositionPitch = 0),
          (e.stringTuning = lt.getDefaultTuningFor(6)),
          this._state.articulationValueToIndex.clear(),
          this._beginStaff(e),
          this._state.score.addTrack(this._state.currentTrack),
          this._state.lyrics.set(this._state.currentTrack.index, []),
          (this._state.currentDynamics = 5),
          (this._state.currentTupletDenominator = -1),
          (this._state.currentTupletNumerator = -1);
      }
      _beginStaff(e) {
        this._state.currentStaff &&
          (this._detectTuningForStaff(this._state.currentStaff),
          this._handleTransposition(this._state.currentStaff)),
          (this._state.currentStaff = e),
          (this._state.currentChordId = null),
          this._state.slurs.clear(),
          (this._state.barIndex = 0),
          (this._state.voiceIndex = 0);
      }
      _bars(e) {
        if (e.bars.length > 0) for (let r of e.bars) this._bar(r);
        else
          this._newBar(this._state.currentStaff),
            this._detectTuningForStaff(this._state.currentStaff),
            this._handleTransposition(this._state.currentStaff);
      }
      _bar(e) {
        this._state.currentChordId = null;
        let r = this._barMeta(e);
        this._detectTuningForStaff(this._state.currentStaff),
          this._handleTransposition(this._state.currentStaff),
          r.index === 0 &&
            this._state.staffInitialClef.has(this._state.currentStaff) &&
            (r.clef = this._state.staffInitialClef.get(
              this._state.currentStaff
            ));
        let i = r.voices[this._state.voiceIndex];
        for (let n of e.beats) this._beat(i, n);
        if (i.beats.length === 0) {
          let n = new Me();
          (n.isEmpty = !0), i.addBeat(n);
        }
      }
      _beat(e, r) {
        if (
          (r.durationChange && this._beatDuration(r.durationChange),
          !r.notes && !r.rest)
        )
          return;
        let i = new Me();
        if ((e.addBeat(i), r.notes))
          for (let s of r.notes.notes) this._note(i, s);
        else r.rest;
        r.durationValue &&
          (this._state.currentDuration = this._parseDuration(r.durationValue)),
          (i.duration = this._state.currentDuration),
          (i.dynamics = this._state.currentDynamics),
          this._state.currentTupletNumerator !== -1 &&
            !i.hasTuplet &&
            ((i.tupletNumerator = this._state.currentTupletNumerator),
            (i.tupletDenominator = this._state.currentTupletDenominator));
        let n = 1;
        r.beatMultiplierValue !== void 0 && (n = r.beatMultiplierValue.value),
          r.beatEffects && this._beatEffects(i, r.beatEffects),
          !i.chordId &&
            this._state.currentChordId &&
            us.applyChordToBeat(i, this._state.currentChordId, !1);
        for (let s = 0; s < n - 1; s++) e.addBeat(dn.clone(i));
      }
      _beatEffects(e, r) {
        for (let i of r.properties)
          switch (this._handler.applyBeatProperty(this, e, i)) {
            case 0:
            case 1:
              this._state.hasAnyProperData = !0;
              break;
            case 2:
              let s = Array.from(this._handler.knownBeatProperties).join(",");
              this.addSemanticDiagnostic({
                code: 212,
                message: `Unrecogized property '${i.property.text}', expected one of ${s}`,
                severity: 2,
                start: i.start,
                end: i.end,
              });
              break;
          }
      }
      _beatDuration(e) {
        if (
          (e.value &&
            (this._state.currentDuration = this._parseDuration(e.value)),
          (this._state.currentTupletNumerator = -1),
          (this._state.currentTupletDenominator = -1),
          e.properties)
        )
          for (let r of e.properties.properties)
            switch (this._handler.applyBeatDurationProperty(this, r)) {
              case 0:
              case 1:
                this._state.hasAnyProperData = !0;
                break;
              case 2:
                let n = Array.from(
                  this._handler.knownBeatDurationProperties
                ).join(",");
                this.addSemanticDiagnostic({
                  code: 212,
                  message: `Unrecogized property '${r.property.text}', expected one of ${n}`,
                  severity: 2,
                  start: r.start,
                  end: r.end,
                });
                break;
            }
      }
      _parseDuration(e) {
        switch (e.value) {
          case -4:
            return -4;
          case -2:
            return -2;
          case 1:
            return 1;
          case 2:
            return 2;
          case 4:
            return 4;
          case 8:
            return 8;
          case 16:
            return 16;
          case 32:
            return 32;
          case 64:
            return 64;
          case 128:
            return 128;
          case 256:
            return 256;
          default:
            return (
              this.addSemanticDiagnostic({
                code: 209,
                message: `Unexpected duration value '${e.value}', expected: -4, -2, 1, 2, 4, 8, 16, 32, 64, 128 or 256`,
                severity: 2,
                start: e.start,
                end: e.end,
              }),
              this._state.currentDuration
            );
        }
      }
      _note(e, r) {
        let i = !1,
          n = !1,
          s = -1,
          a = -1,
          o = -1,
          l = 0,
          u = r.noteValue,
          c,
          d = this._state.staffNoteKind.has(this._state.currentStaff)
            ? this._state.staffNoteKind.get(this._state.currentStaff)
            : void 0;
        switch (u.nodeType) {
          case 16:
            (s = u.value), r.noteString !== void 0 ? (c = 1) : (c = 2);
            break;
          case 17:
          case 10:
            let f = u.text;
            if (((i = f === "x"), (n = f === "-"), n || i))
              (s = 0), (c = void 0);
            else {
              let b = A.parseTuning(f);
              if (b)
                (c = 0),
                  (a = b.octave),
                  (o = b.tone.noteValue),
                  this._state.accidentalMode === 1 &&
                    (l = b.tone.accidentalMode);
              else {
                c = 2;
                let y = f.toLowerCase(),
                  S = this._state.percussionArticulationNames;
                if (d === void 0 && S.size === 0)
                  for (let [k, T] of He.instrumentArticulationNames)
                    S.set(k.toLowerCase(), T), S.set(A.toArticulationId(k), T);
                if (S.has(y)) s = S.get(y);
                else {
                  this.addSemanticDiagnostic({
                    code: 209,
                    message: `Unexpected percussion articulation value '${y}', expected: oneOf(${Array.from(
                      this._state.percussionArticulationNames.keys()
                    ).join(",")}).`,
                    severity: 2,
                    start: u.start,
                    end: u.end,
                  }),
                    (s = Array.from(
                      He.instrumentArticulationNames.values()
                    )[0]);
                  return;
                }
              }
            }
            break;
        }
        c !== void 0
          ? d === void 0
            ? ((d = c), this.applyStaffNoteKind(this._state.currentStaff, d))
            : d !== c &&
              this.addSemanticDiagnostic({
                code: 218,
                message: `Wrong note kind '${ls[c]}' for staff with note kind ''${ls[d]}'. Do not mix incompatible staves and notes.`,
                severity: 2,
              })
          : d !== void 0 && (c = d);
        let h = new Xe();
        if (
          ((h.isDead = i),
          (i || n) && (h.fret = s),
          (h.isTieDestination = n),
          c !== void 0 && c === d)
        )
          switch (c) {
            case 0:
              (h.octave = a), (h.tone = o), (h.accidentalMode = l);
              break;
            case 1:
              if (!r.noteString) {
                this.addSemanticDiagnostic({
                  code: 207,
                  message: "Missing string for fretted note.",
                  severity: 2,
                  start: u.end,
                  end: u.end,
                });
                return;
              }
              let f = r.noteString.value;
              if (f < 1 || f > this._state.currentStaff.tuning.length) {
                this.addSemanticDiagnostic({
                  code: 208,
                  message: `Note string is out of range. Available range: 1-${this._state.currentStaff.tuning.length}`,
                  severity: 2,
                  start: u.end,
                  end: u.end,
                });
                return;
              }
              (h.string = this._state.currentStaff.tuning.length - (f - 1)),
                n || (h.fret = s);
              break;
            case 2:
              let b = 0;
              if (this._state.articulationValueToIndex.has(s))
                b = this._state.articulationValueToIndex.get(s);
              else {
                b = this._state.currentTrack.percussionArticulations.length;
                let y = He.getArticulationByInputMidiNumber(s);
                if (y === null) {
                  this.addSemanticDiagnostic({
                    code: 209,
                    message: `Unexpected articulation value '${s}', expected: oneOf(${Array.from(
                      He.instrumentArticulations.keys()
                    ).join(",")}).`,
                    severity: 2,
                    start: u.end,
                    end: u.end,
                  });
                  return;
                }
                this._state.currentTrack.percussionArticulations.push(y),
                  this._state.articulationValueToIndex.set(s, b);
              }
              h.percussionArticulation = b;
              break;
          }
        e.addNote(h),
          (this._state.hasAnyProperData = !0),
          r.noteEffects && this._noteEffects(h, r.noteEffects);
      }
      getStaffNoteKind(e) {
        return this._state.staffNoteKind.has(e)
          ? this._state.staffNoteKind.get(e)
          : void 0;
      }
      applyStaffNoteKind(e, r) {
        switch ((this._state.staffNoteKind.set(e, r), r)) {
          case 0:
            (e.isPercussion = !1),
              e.stringTuning.reset(),
              this._state.staffHasExplicitDisplayTransposition.has(e) ||
                (e.displayTranspositionPitch = 0);
            break;
          case 1:
            (e.isPercussion = !1),
              this._detectTuningForStaff(e),
              this._handleTransposition(e);
            break;
          case 2:
            (e.isPercussion = !0),
              e.stringTuning.reset(),
              this._state.staffHasExplicitDisplayTransposition.has(e) ||
                (e.displayTranspositionPitch = 0);
            break;
        }
      }
      _noteEffects(e, r) {
        for (let i of r.properties) {
          let n = this._handler.applyNoteProperty(this, e, i);
          switch (
            (n === 2 && (n = this._handler.applyBeatProperty(this, e.beat, i)),
            n)
          ) {
            case 0:
            case 1:
              break;
            case 2:
              let s = Array.from(this._handler.knownNoteProperties)
                .concat(Array.from(this._handler.knownBeatProperties))
                .join(",");
              this.addSemanticDiagnostic({
                code: 212,
                message: `Unrecogized property '${i.property.text}', expected one of ${s}`,
                severity: 2,
                start: i.start,
                end: i.end,
              });
              break;
          }
        }
      }
      _handleTransposition(e) {
        if (
          !this._state.staffDisplayTranspositionApplied.has(e) &&
          !this._state.staffHasExplicitDisplayTransposition.has(e)
        ) {
          let r = e.track.playbackInfo.program;
          A.displayTranspositionPitches.has(r)
            ? (e.displayTranspositionPitch =
                A.displayTranspositionPitches.get(r))
            : (this._state.currentStaff.displayTranspositionPitch = 0),
            this._state.staffDisplayTranspositionApplied.add(e);
        }
      }
      _detectTuningForStaff(e) {
        let r = e.track.playbackInfo.program;
        !this._state.staffTuningApplied.has(e) &&
          !this._state.staffHasExplicitTuning.has(e) &&
          (e.stringTuning.reset(),
          r === 15
            ? (e.stringTuning.tunings = lt.getDefaultTuningFor(6).tunings)
            : r >= 24 && r <= 31
            ? (e.stringTuning.tunings = lt.getDefaultTuningFor(6).tunings)
            : r >= 32 && r <= 39
            ? ((e.stringTuning.tunings = [43, 38, 33, 28]),
              this._state.staffInitialClef.set(e, 3))
            : r === 40 ||
              r === 44 ||
              r === 45 ||
              r === 48 ||
              r === 49 ||
              r === 50 ||
              r === 51
            ? (e.stringTuning.tunings = [52, 57, 50, 43])
            : r === 41
            ? (e.stringTuning.tunings = [57, 50, 43, 36])
            : r === 42
            ? (e.stringTuning.tunings = [45, 38, 31, 24])
            : r === 43
            ? (e.stringTuning.tunings = [43, 38, 33, 28])
            : r === 105
            ? (e.stringTuning.tunings = [50, 47, 43, 38, 55])
            : r === 106
            ? (e.stringTuning.tunings = [57, 52, 45])
            : r === 107
            ? (e.stringTuning.tunings = [52, 45, 38, 31])
            : r === 110
            ? (e.stringTuning.tunings = [64, 57, 50, 43])
            : this._state.staffNoteKind.has(e) &&
              this._state.staffNoteKind.get(e) === 1 &&
              (e.stringTuning = lt.getDefaultTuningFor(6)),
          this._state.staffTuningApplied.add(e));
      }
      _barMeta(e) {
        let r = this._state.score.masterBars.length > 0 ? void 0 : [],
          i = this._state.currentStaff,
          n = !1,
          s = !1,
          a = !1,
          o = () => {
            r &&
              ((r = void 0),
              (i = this._state.currentStaff),
              (n = !1),
              (s = !1),
              (a = !1));
          },
          l = new Cr(() => {
            let u = this._newBar(this._state.currentStaff);
            if (r) {
              for (let c of r) this._handler.applyBarMetaData(this, u, c);
              o();
            }
            return u;
          });
        for (let u of e.metaData) {
          let c = u.tag.tag.text.toLowerCase();
          if (this._handler.knownStructuralMetaDataTags.has(c)) {
            switch (
              ((this._state.hasAnyProperData = !0),
              this._handler.applyStructuralMetaData(this, u))
            ) {
              case 0:
                s || n ? (a = !0) : ((n = !0), (i = this._state.currentStaff)),
                  l.reset();
                break;
              case 1:
                s ? (a = !0) : ((s = !0), (i = this._state.currentStaff)),
                  l.reset();
                break;
            }
            if (r && a)
              if (i.bars.length === 0) {
                let h = new at();
                i.addBar(h);
                let f = new ze();
                if (
                  (h.addVoice(f),
                  i.bars.length > this._state.score.masterBars.length)
                ) {
                  let b = new ot();
                  this._state.score.addMasterBar(b);
                }
                for (let b of r) this._handler.applyBarMetaData(this, h, b);
                o();
              } else
                throw new te(
                  2,
                  "Unexpected internal error, didn't expect a filled staff after multiple \\track and/or \\staff tags. Please report this problem providing the input alphaTex."
                );
          } else if (
            this._handler.knownScoreMetaDataTags.has(
              u.tag.tag.text.toLowerCase()
            )
          )
            (this._state.hasAnyProperData = !0),
              this._handler.applyScoreMetaData(this, this._state.score, u);
          else if (
            this._handler.knownStaffMetaDataTags.has(
              u.tag.tag.text.toLowerCase()
            )
          )
            (this._state.hasAnyProperData = !0),
              this._handler.applyStaffMetaData(
                this,
                this._state.currentStaff,
                u
              ),
              this.addSemanticDiagnostic({
                code: 306,
                message:
                  "This staff metadata tag should be specified as staff property.",
                severity: 1,
                start: u.start,
                end: u.end,
              });
          else if (
            this._handler.knownBarMetaDataTags.has(u.tag.tag.text.toLowerCase())
          )
            (this._state.hasAnyProperData = !0),
              r ? r.push(u) : this._handler.applyBarMetaData(this, l.value, u);
          else {
            let d = Array.from(this._handler.allKnownMetaDataTags).join(",");
            this.addSemanticDiagnostic({
              code: 204,
              message: `Unrecognized metadata '${u.tag.tag.text}', expected one of: ${d}`,
              severity: 2,
              start: u.tag.start,
              end: u.tag.end,
            });
          }
        }
        return l.value;
      }
      _newBar(e) {
        if (this._state.barIndex < e.bars.length) {
          let n = e.bars[this._state.barIndex];
          return this._state.barIndex++, n;
        }
        let r = e.bars.length === 0 ? 1 : e.bars[0].voices.length,
          i = new at();
        e.addBar(i),
          i.previousBar &&
            ((i.clef = i.previousBar.clef),
            (i.clefOttava = i.previousBar.clefOttava),
            (i.keySignature = i.previousBar.keySignature),
            (i.keySignatureType = i.previousBar.keySignatureType)),
          this._state.barIndex++,
          i.index > 0 && (i.clef = i.previousBar.clef);
        for (let n = 0; n < r; n++) {
          let s = new ze();
          i.addVoice(s);
        }
        if (
          this._state.currentStaff.bars.length >
          this._state.score.masterBars.length
        ) {
          let n = new ot();
          this._state.score.addMasterBar(n),
            n.index > 0 &&
              ((n.timeSignatureDenominator =
                n.previousMasterBar.timeSignatureDenominator),
              (n.timeSignatureNumerator =
                n.previousMasterBar.timeSignatureNumerator),
              (n.tripletFeel = n.previousMasterBar.tripletFeel));
        }
        return i;
      }
      startNewStaff() {
        if (
          ((this._state.ignoredInitialVoice = !1),
          this._state.ignoredInitialStaff ||
            this._state.currentTrack.staves[0].bars.length > 0)
        ) {
          let e = this._state.currentStaff.isPercussion;
          this._state.currentTrack.ensureStaveCount(
            this._state.currentTrack.staves.length + 1
          );
          let r =
            this._state.currentTrack.staves[
              this._state.currentTrack.staves.length - 1
            ];
          this._beginStaff(r),
            e && this.applyPercussionStaff(this._state.currentStaff),
            (this._state.currentDynamics = 5);
        } else this._state.ignoredInitialStaff = !0;
        return this._state.currentStaff;
      }
      applyPercussionStaff(e) {
        (e.isPercussion = !0),
          (e.showTablature = !1),
          (e.track.playbackInfo.program = 0);
      }
      startNewTrack() {
        return (
          (this._state.ignoredInitialVoice = !1),
          (this._state.ignoredInitialStaff = !1),
          this._state.ignoredInitialTrack ||
          this._state.score.masterBars.length > 0
            ? this._newTrack()
            : (this._state.ignoredInitialTrack = !0),
          this._state.currentTrack
        );
      }
      startNewVoice() {
        if (
          this._state.voiceIndex === 0 &&
          (this._state.currentStaff.bars.length === 0 ||
            (this._state.currentStaff.bars.length === 1 &&
              this._state.currentStaff.bars[0].isEmpty &&
              !this._state.ignoredInitialVoice))
        ) {
          this._state.ignoredInitialVoice = !0;
          return;
        }
        for (let e of this._state.currentStaff.bars) {
          let r = new ze();
          e.addVoice(r);
        }
        this._state.voiceIndex++,
          (this._state.barIndex = 0),
          (this._state.currentTupletDenominator = -1),
          (this._state.currentTupletNumerator = -1);
      }
    };
  var bo = class {},
    Bn = class extends bo {
      constructor(t) {
        super(), (this.n = t);
      }
    },
    ci = class extends bo {
      constructor(t, e) {
        super(), (this.left = t), (this.right = e);
      }
    },
    ds = class extends bo {
      constructor(t, e) {
        super(), (this.n = t), (this.table = e);
      }
    };
  var ps = class p {
    static make(t, e, r, i) {
      let n = [],
        s = [];
      if (i > 32) throw new Oe("Invalid huffman");
      for (let l = 0; l < i; l++) n.push(0), s.push(0);
      for (let l = 0; l < r; l++) {
        let u = t[l + e];
        if (u >= i) throw new Oe("Invalid huffman");
        n[u]++;
      }
      let a = 0;
      for (let l = 1; l < i - 1; l++) (a = (a + n[l]) << 1), (s[l] = a);
      let o = new Map();
      for (let l = 0; l < r; l++) {
        let u = t[l + e];
        if (u !== 0) {
          let c = s[u - 1];
          (s[u - 1] = c + 1), o.set((c << 5) | u, l);
        }
      }
      return p._treeCompress(
        new ci(p._treeMake(o, i, 0, 1), p._treeMake(o, i, 1, 1))
      );
    }
    static _treeMake(t, e, r, i) {
      if (i > e) throw new Oe("Invalid huffman");
      let n = (r << 5) | i;
      return t.has(n)
        ? new Bn(t.get(n))
        : ((r = r << 1),
          (i += 1),
          new ci(p._treeMake(t, e, r, i), p._treeMake(t, e, r | 1, i)));
    }
    static _treeCompress(t) {
      let e = p._treeDepth(t);
      if (e === 0) return t;
      if (e === 1) {
        if (t instanceof ci)
          return new ci(p._treeCompress(t.left), p._treeCompress(t.right));
        throw new Oe("assert");
      }
      let r = 1 << e,
        i = [];
      for (let n = 0; n < r; n++) i.push(new Bn(-1));
      return p._treeWalk(i, 0, 0, e, t), new ds(e, i);
    }
    static _treeWalk(t, e, r, i, n) {
      n instanceof ci && i > 0
        ? (p._treeWalk(t, e, r + 1, i - 1, n.left),
          p._treeWalk(t, e | (1 << r), r + 1, i - 1, n.right))
        : (t[e] = p._treeCompress(n));
    }
    static _treeDepth(t) {
      if (t instanceof Bn) return 0;
      if (t instanceof ds) throw new Oe("assert");
      if (t instanceof ci) {
        let e = p._treeDepth(t.left),
          r = p._treeDepth(t.right);
        return 1 + (e < r ? e : r);
      }
      return 0;
    }
  };
  var di = class di {
    constructor() {
      this.buffer = new Uint8Array(di._bufferSize);
      this.pos = 0;
    }
    slide() {
      let t = new Uint8Array(di._bufferSize);
      (this.pos -= di._size),
        t.set(this.buffer.subarray(di._size, di._size + this.pos), 0),
        (this.buffer = t);
    }
    addBytes(t, e, r) {
      this.pos + r > di._bufferSize && this.slide(),
        this.buffer.set(t.subarray(e, e + r), this.pos),
        (this.pos += r);
    }
    addByte(t) {
      this.pos === di._bufferSize && this.slide(),
        (this.buffer[this.pos] = t),
        this.pos++;
    }
    getLastChar() {
      return this.buffer[this.pos - 1];
    }
    available() {
      return this.pos;
    }
  };
  (di._size = 32768), (di._bufferSize = 65536);
  var Bp = di,
    Dt = class Dt {
      constructor(t) {
        this._nbits = 0;
        this._bits = 0;
        this._state = 1;
        this._isFinal = !1;
        this._huffman = Dt._fixedHuffman;
        this._huffdist = null;
        this._len = 0;
        this._dist = 0;
        this._needed = 0;
        this._output = null;
        this._outpos = 0;
        this._lengths = [];
        this._window = new Bp();
        this._input = t;
        for (let e = 0; e < 19; e++) this._lengths.push(-1);
      }
      static _buildFixedHuffman() {
        let t = [];
        for (let e = 0; e < 288; e++)
          t.push(e <= 143 ? 8 : e <= 255 ? 9 : e <= 279 ? 7 : 8);
        return ps.make(t, 0, 288, 10);
      }
      readBytes(t, e, r) {
        if (((this._needed = r), (this._outpos = e), (this._output = t), r > 0))
          for (; this._inflateLoop(); );
        return r - this._needed;
      }
      _inflateLoop() {
        switch (this._state) {
          case 0:
            let t = this._input.readByte();
            if ((t & 15) !== 8) throw new Oe("Invalid data");
            let r = this._input.readByte(),
              i = (r & 32) !== 0;
            if (((t << 8) + r) % 31 !== 0) throw new Oe("Invalid data");
            if (i) throw new Oe("Unsupported dictionary");
            return (this._state = 1), !0;
          case 4:
            return (this._state = 7), !0;
          case 7:
            return !1;
          case 1:
            switch (((this._isFinal = this._getBit()), this._getBits(2))) {
              case 0:
                if (
                  ((this._len = B.readUInt16LE(this._input)),
                  B.readUInt16LE(this._input) !== 65535 - this._len)
                )
                  throw new Oe("Invalid data");
                this._state = 3;
                let u = this._inflateLoop();
                return this._resetBits(), u;
              case 1:
                return (
                  (this._huffman = Dt._fixedHuffman),
                  (this._huffdist = null),
                  (this._state = 2),
                  !0
                );
              case 2:
                let c = this._getBits(5) + 257,
                  d = this._getBits(5) + 1,
                  h = this._getBits(4) + 4;
                for (let b = 0; b < h; b++)
                  this._lengths[Dt._codeLengthsPos[b]] = this._getBits(3);
                for (let b = h; b < 19; b++)
                  this._lengths[Dt._codeLengthsPos[b]] = 0;
                this._huffman = ps.make(this._lengths, 0, 19, 8);
                let f = [];
                for (let b = 0; b < c + d; b++) f.push(0);
                return (
                  this._inflateLengths(f, c + d),
                  (this._huffdist = ps.make(f, c, d, 16)),
                  (this._huffman = ps.make(f, 0, c, 16)),
                  (this._state = 2),
                  !0
                );
              default:
                throw new Oe("Invalid data");
            }
          case 3: {
            let l = this._len < this._needed ? this._len : this._needed,
              u = B.readByteArray(this._input, l);
            return (
              (this._len -= l),
              this._addBytes(u, 0, l),
              this._len === 0 && (this._state = this._isFinal ? 4 : 1),
              this._needed > 0
            );
          }
          case 6: {
            let l = this._len < this._needed ? this._len : this._needed;
            return (
              this._addDistOne(l),
              (this._len -= l),
              this._len === 0 && (this._state = 2),
              this._needed > 0
            );
          }
          case 5:
            for (; this._len > 0 && this._needed > 0; ) {
              let l = this._len < this._dist ? this._len : this._dist,
                u = this._needed < l ? this._needed : l;
              this._addDist(this._dist, u), (this._len -= u);
            }
            return this._len === 0 && (this._state = 2), this._needed > 0;
          case 2:
            let n = this._applyHuffman(this._huffman);
            if (n < 256) return this._addByte(n), this._needed > 0;
            if (n === 256) return (this._state = this._isFinal ? 4 : 1), !0;
            n = (n - 257) & 255;
            let s = Dt._lenExtraBitsTbl[n];
            if (s === -1) throw new Oe("Invalid data");
            this._len = Dt._lenBaseValTbl[n] + this._getBits(s);
            let a = this._huffdist,
              o = a ? this._applyHuffman(a) : this._getRevBits(5);
            if (((s = Dt._distExtraBitsTbl[o]), s === -1))
              throw new Oe("Invalid data");
            if (
              ((this._dist = Dt._distBaseValTbl[o] + this._getBits(s)),
              this._dist > this._window.available())
            )
              throw new Oe("Invalid data");
            return (this._state = this._dist === 1 ? 6 : 5), !0;
        }
        return !1;
      }
      _addDistOne(t) {
        let e = this._window.getLastChar();
        for (let r = 0; r < t; r++) this._addByte(e);
      }
      _addByte(t) {
        this._window.addByte(t),
          (this._output[this._outpos] = t),
          this._needed--,
          this._outpos++;
      }
      _addDist(t, e) {
        this._addBytes(this._window.buffer, this._window.pos - t, e);
      }
      _getBit() {
        this._nbits === 0 &&
          ((this._nbits = 8), (this._bits = this._input.readByte()));
        let t = (this._bits & 1) === 1;
        return this._nbits--, (this._bits = this._bits >> 1), t;
      }
      _getBits(t) {
        for (; this._nbits < t; )
          (this._bits = this._bits | (this._input.readByte() << this._nbits)),
            (this._nbits += 8);
        let e = this._bits & ((1 << t) - 1);
        return (this._nbits -= t), (this._bits = this._bits >> t), e;
      }
      _getRevBits(t) {
        return t === 0
          ? 0
          : this._getBit()
          ? (1 << (t - 1)) | this._getRevBits(t - 1)
          : this._getRevBits(t - 1);
      }
      _resetBits() {
        (this._bits = 0), (this._nbits = 0);
      }
      _addBytes(t, e, r) {
        this._window.addBytes(t, e, r),
          this._output.set(t.subarray(e, e + r), this._outpos),
          (this._needed -= r),
          (this._outpos += r);
      }
      _inflateLengths(t, e) {
        let r = 0,
          i = 0;
        for (; r < e; ) {
          let n = this._applyHuffman(this._huffman);
          switch (n) {
            case 0:
            case 1:
            case 2:
            case 3:
            case 4:
            case 5:
            case 6:
            case 7:
            case 8:
            case 9:
            case 10:
            case 11:
            case 12:
            case 13:
            case 14:
            case 15:
              (i = n), (t[r] = n), r++;
              break;
            case 16:
              let s = r + 3 + this._getBits(2);
              if (s > e) throw new Oe("Invalid data");
              for (; r < s; ) (t[r] = i), r++;
              break;
            case 17:
              if (((r += 3 + this._getBits(3)), r > e))
                throw new Oe("Invalid data");
              break;
            case 18:
              if (((r += 11 + this._getBits(7)), r > e))
                throw new Oe("Invalid data");
              break;
            default:
              throw new Oe("Invalid data");
          }
        }
      }
      _applyHuffman(t) {
        if (t instanceof Bn) return t.n;
        if (t instanceof ci)
          return this._applyHuffman(this._getBit() ? t.right : t.left);
        if (t instanceof ds)
          return this._applyHuffman(t.table[this._getBits(t.n)]);
        throw new Oe("Invalid data");
      }
    };
  (Dt._lenExtraBitsTbl = [
    0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5,
    5, 5, 5, 0, -1, -1,
  ]),
    (Dt._lenBaseValTbl = [
      3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31, 35, 43, 51, 59,
      67, 83, 99, 115, 131, 163, 195, 227, 258,
    ]),
    (Dt._distExtraBitsTbl = [
      0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10,
      11, 11, 12, 12, 13, 13, -1, -1,
    ]),
    (Dt._distBaseValTbl = [
      1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193, 257, 385, 513,
      769, 1025, 1537, 2049, 3073, 4097, 6145, 8193, 12289, 16385, 24577,
    ]),
    (Dt._codeLengthsPos = [
      16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15,
    ]),
    (Dt._fixedHuffman = Dt._buildFixedHuffman());
  var tu = Dt;
  var qe = class {
    constructor(t, e) {
      this.fullName = t;
      let r = t.lastIndexOf("/");
      (this.fileName =
        r === -1 || r === t.length - 1 ? this.fullName : t.substr(r + 1)),
        (this.data = e);
    }
  };
  (qe.OptionalDataDescriptorSignature = 134695760),
    (qe.CompressionMethodDeflate = 8),
    (qe.LocalFileHeaderSignature = 67324752),
    (qe.CentralFileHeaderSignature = 33639248),
    (qe.EndOfCentralDirSignature = 101010256);
  var Tn = class {
    constructor(t) {
      this._readable = t;
    }
    read() {
      let t = [];
      for (;;) {
        let e = this._readEntry();
        if (!e) break;
        t.push(e);
      }
      return t;
    }
    _readEntry() {
      let t = this._readable;
      if (B.readInt32LE(t) !== qe.LocalFileHeaderSignature) return null;
      B.readUInt16LE(t);
      let r = B.readUInt16LE(t),
        i = B.readUInt16LE(t),
        n = i !== 0;
      if (n && i !== qe.CompressionMethodDeflate) return null;
      B.readInt16LE(this._readable),
        B.readInt16LE(this._readable),
        B.readInt32LE(t),
        B.readInt32LE(t);
      let s = B.readInt32LE(t),
        a = B.readInt16LE(t),
        o = B.readInt16LE(t),
        l = B.toString(B.readByteArray(t, a), "utf-8");
      t.skip(o);
      let u;
      if (n) {
        let c = Se.empty(),
          d = new tu(this._readable),
          h = new Uint8Array(65536);
        for (;;) {
          let f = d.readBytes(h, 0, h.length);
          if ((c.write(h, 0, f), f < h.length)) break;
        }
        u = c.toArray();
      } else u = B.readByteArray(this._readable, s);
      return (
        (r & 8) !== 0 &&
          (B.readInt32LE(this._readable) ===
            qe.OptionalDataDescriptorSignature && B.readInt32LE(this._readable),
          B.readInt32LE(this._readable),
          B.readInt32LE(this._readable)),
        new qe(l, u)
      );
    }
  };
  var wr = class p {
    constructor() {
      this.nodeType = 0;
      this.localName = null;
      this.value = null;
      this.childNodes = [];
      this.attributes = new Map();
      this.firstChild = null;
      this.firstElement = null;
    }
    *childElements() {
      for (let t of this.childNodes) t.nodeType === 1 && (yield t);
    }
    addChild(t) {
      this.childNodes.push(t),
        (this.firstChild = t),
        (t.nodeType === 1 || t.nodeType === 3) && (this.firstElement = t);
    }
    getAttribute(t, e = "") {
      return this.attributes.has(t) ? this.attributes.get(t) : e;
    }
    getElementsByTagName(t, e = !1) {
      let r = [];
      return this._searchElementsByTagName(this.childNodes, r, t, e), r;
    }
    _searchElementsByTagName(t, e, r, i = !1) {
      for (let n of t)
        n && n.nodeType === 1 && n.localName === r && e.push(n),
          i && this._searchElementsByTagName(n.childNodes, e, r, !0);
    }
    findChildElement(t) {
      for (let e of this.childNodes)
        if (e && e.nodeType === 1 && e.localName === t) return e;
      return null;
    }
    addElement(t) {
      let e = new p();
      return (e.nodeType = 1), (e.localName = t), this.addChild(e), e;
    }
    get innerText() {
      if (this.nodeType === 1 || this.nodeType === 4) {
        if (this.firstElement && this.firstElement.nodeType === 3)
          return this.firstElement.innerText;
        let t = "";
        for (let r of this.childNodes) t += r.innerText?.toString();
        return t.trim();
      }
      return this.value ?? "";
    }
    set innerText(t) {
      let e = new p();
      (e.nodeType = 2), (e.value = t), (this.childNodes = [e]);
    }
    setCData(t) {
      let e = new p();
      (e.nodeType = 3), (e.value = t), (this.childNodes = [e]);
    }
  };
  var Qt = class extends te {
    constructor(e, r, i) {
      super(1, e);
      this.pos = 0;
      (this.xml = r), (this.pos = i);
    }
  };
  var q = class q {
    static parse(t, e, r) {
      let i = t.charCodeAt(e),
        n = 1,
        s = 1,
        a = 0,
        o = "",
        l = 1,
        u = null,
        c = null,
        d = 0,
        h = 0;
      for (; e < t.length; ) {
        switch (((i = t.charCodeAt(e)), n)) {
          case 0:
            switch (i) {
              case q.CharCodeLF:
              case q.CharCodeCR:
              case q.CharCodeTab:
              case q.CharCodeSpace:
                break;
              default:
                n = s;
                continue;
            }
            break;
          case 1:
            if (i === q.CharCodeLowerThan) (n = 0), (s = 2);
            else {
              (a = e), (n = 13);
              continue;
            }
            break;
          case 13:
            if (i === q.CharCodeLowerThan) {
              o += t.substr(a, e - a);
              let f = new wr();
              (f.nodeType = 2),
                (f.value = o),
                (o = ""),
                r.addChild(f),
                (n = 0),
                (s = 2);
            } else
              i === q.CharCodeAmp &&
                ((o += t.substr(a, e - a)), (n = 18), (l = 13), (a = e + 1));
            break;
          case 17:
            if (
              i === q.CharCodeBrackedClose &&
              t.charCodeAt(e + 1) === q.CharCodeBrackedClose &&
              t.charCodeAt(e + 2) === q.CharCodeGreaterThan
            ) {
              let f = new wr();
              (f.nodeType = 3),
                (f.value = t.substr(a, e - a)),
                r.addChild(f),
                (e += 2),
                (n = 1);
            }
            break;
          case 2:
            switch (i) {
              case q.CharCodeExclamation:
                if (t.charCodeAt(e + 1) === q.CharCodeBrackedOpen) {
                  if (((e += 2), t.substr(e, 6).toUpperCase() !== "CDATA["))
                    throw new Qt("Expected <![CDATA[", t, e);
                  (e += 5), (n = 17), (a = e + 1);
                } else if (
                  t.charCodeAt(e + 1) === q.CharCodeUpperD ||
                  t.charCodeAt(e + 1) === q.CharCodeLowerD
                ) {
                  if (t.substr(e + 2, 6).toUpperCase() !== "OCTYPE")
                    throw new Qt("Expected <!DOCTYPE", t, e);
                  (e += 8), (n = 16), (a = e + 1);
                } else {
                  if (
                    t.charCodeAt(e + 1) !== q.CharCodeMinus ||
                    t.charCodeAt(e + 2) !== q.CharCodeMinus
                  )
                    throw new Qt("Expected <!--", t, e);
                  (e += 2), (n = 15), (a = e + 1);
                }
                break;
              case q.CharCodeQuestion:
                (n = 14), (a = e);
                break;
              case q.CharCodeSlash:
                if (!r) throw new Qt("Expected node name", t, e);
                (a = e + 1), (n = 0), (s = 10);
                break;
              default:
                (n = 3), (a = e);
                continue;
            }
            break;
          case 3:
            if (!q._isValidChar(i)) {
              if (e === a) throw new Qt("Expected node name", t, e);
              (u = new wr()),
                (u.nodeType = 1),
                (u.localName = t.substr(a, e - a)),
                r.addChild(u),
                (n = 0),
                (s = 4);
              continue;
            }
            break;
          case 4:
            switch (i) {
              case q.CharCodeSlash:
                n = 11;
                break;
              case q.CharCodeGreaterThan:
                n = 9;
                break;
              default:
                (n = 5), (a = e);
                continue;
            }
            break;
          case 5:
            if (!q._isValidChar(i)) {
              if (a === e) throw new Qt("Expected attribute name", t, e);
              if (((c = t.substr(a, e - a)), u.attributes.has(c)))
                throw new Qt(`Duplicate attribute [${c}]`, t, e);
              (n = 0), (s = 6);
              continue;
            }
            break;
          case 6:
            if (i === q.CharCodeEquals) (n = 0), (s = 7);
            else throw new Qt("Expected =", t, e);
            break;
          case 7:
            switch (i) {
              case q.CharCodeDoubleQuote:
              case q.CharCodeSingleQuote:
                (o = ""), (n = 8), (a = e + 1), (h = i);
                break;
            }
            break;
          case 8:
            switch (i) {
              case q.CharCodeAmp:
                (o += t.substr(a, e - a)), (n = 18), (l = 8), (a = e + 1);
                break;
              default:
                if (i === h) {
                  o += t.substr(a, e - a);
                  let f = o;
                  (o = ""), u.attributes.set(c, f), (n = 0), (s = 4);
                }
                break;
            }
            break;
          case 9:
            (e = q.parse(t, e, u)), (a = e), (n = 1);
            break;
          case 11:
            if (i === q.CharCodeGreaterThan) n = 1;
            else throw new Qt("Expected >", t, e);
            break;
          case 12:
            if (i === q.CharCodeGreaterThan) return e;
            throw new Qt("Expected >", t, e);
          case 10:
            if (!q._isValidChar(i)) {
              if (a === e) throw new Qt("Expected node name", t, e);
              if (t.substr(a, e - a) !== r.localName)
                throw new Qt(`Expected </${r.localName}>`, t, e);
              (n = 0), (s = 12);
              continue;
            }
            break;
          case 15:
            i === q.CharCodeMinus &&
              t.charCodeAt(e + 1) === q.CharCodeMinus &&
              t.charCodeAt(e + 2) === q.CharCodeGreaterThan &&
              ((e += 2), (n = 1));
            break;
          case 16:
            if (i === q.CharCodeBrackedOpen) d++;
            else if (i === q.CharCodeBrackedClose) d--;
            else if (i === q.CharCodeGreaterThan && d === 0) {
              let f = new wr();
              (f.nodeType = 5),
                (f.value = t.substr(a, e - a)),
                r.addChild(f),
                (n = 1);
            }
            break;
          case 14:
            i === q.CharCodeQuestion &&
              t.charCodeAt(e + 1) === q.CharCodeGreaterThan &&
              (e++, (n = 1));
            break;
          case 18:
            if (i === q.CharCodeSemi) {
              let f = t.substr(a, e - a);
              if (f.charCodeAt(0) === q.CharCodeSharp) {
                let b =
                  f.charCodeAt(1) === q.CharCodeLowerX
                    ? Number.parseInt(`0${f.substr(1, f.length - 1)}`, 10)
                    : Number.parseInt(f.substr(1, f.length - 1), 10);
                o += String.fromCharCode(b);
              } else
                q._escapes.has(f)
                  ? (o += q._escapes.get(f))
                  : (o += `&${f};`?.toString());
              (a = e + 1), (n = l);
            } else
              !q._isValidChar(i) &&
                i !== q.CharCodeSharp &&
                ((o += "&"),
                (o += t.substr(a, e - a)),
                e--,
                (a = e + 1),
                (n = l));
            break;
        }
        e++;
      }
      if ((n === 1 && ((a = e), (n = 13)), n === 13)) {
        if (e !== a) {
          o += t.substr(a, e - a);
          let f = new wr();
          (f.nodeType = 2), (f.value = o), r.addChild(f);
        }
        return e;
      }
      if (n === 18 && l === 13) {
        (o += "&"), (o += t.substr(a, e - a));
        let f = new wr();
        return (f.nodeType = 2), (f.value = o), r.addChild(f), e;
      }
      throw new Qt("Unexpected end", t, e);
    }
    static _isValidChar(t) {
      return (
        (t >= q.CharCodeLowerA && t <= q.CharCodeLowerZ) ||
        (t >= q.CharCodeUpperA && t <= q.CharCodeUpperZ) ||
        (t >= q.CharCode0 && t <= q.CharCode9) ||
        t === q.CharCodeColon ||
        t === q.CharCodeDot ||
        t === q.CharCodeUnderscore ||
        t === q.CharCodeMinus
      );
    }
  };
  (q.CharCodeLF = 10),
    (q.CharCodeTab = 9),
    (q.CharCodeCR = 13),
    (q.CharCodeSpace = 32),
    (q.CharCodeLowerThan = 60),
    (q.CharCodeAmp = 38),
    (q.CharCodeBrackedClose = 93),
    (q.CharCodeBrackedOpen = 91),
    (q.CharCodeGreaterThan = 62),
    (q.CharCodeExclamation = 33),
    (q.CharCodeUpperD = 68),
    (q.CharCodeLowerD = 100),
    (q.CharCodeMinus = 45),
    (q.CharCodeQuestion = 63),
    (q.CharCodeSlash = 47),
    (q.CharCodeEquals = 61),
    (q.CharCodeDoubleQuote = 34),
    (q.CharCodeSingleQuote = 39),
    (q.CharCodeSharp = 35),
    (q.CharCodeLowerX = 120),
    (q.CharCodeLowerA = 97),
    (q.CharCodeLowerZ = 122),
    (q.CharCodeUpperA = 65),
    (q.CharCodeUpperZ = 90),
    (q.CharCode0 = 48),
    (q.CharCode9 = 57),
    (q.CharCodeColon = 58),
    (q.CharCodeDot = 46),
    (q.CharCodeUnderscore = 95),
    (q.CharCodeSemi = 59),
    (q._escapes = new Map([
      ["lt", "<"],
      ["gt", ">"],
      ["amp", "&"],
      ["quot", '"'],
      ["apos", "'"],
    ]));
  var ru = q;
  var nu = class p {
    constructor(t, e) {
      this._result = [];
      (this._indention = t),
        (this._xmlHeader = e),
        (this._currentIndention = ""),
        (this._isStartOfLine = !0);
    }
    writeNode(t) {
      switch (t.nodeType) {
        case 0:
          break;
        case 1:
          this._result.length > 0 && this._writeLine(),
            this._write(`<${t.localName}`);
          for (let [e, r] of t.attributes)
            this._write(` ${e}="`),
              this._writeAttributeValue(r),
              this._write('"');
          if (t.childNodes.length === 0) this._write("/>");
          else {
            if (
              (this._write(">"), t.childNodes.length === 1 && !t.firstElement)
            )
              this.writeNode(t.childNodes[0]);
            else {
              this._indent();
              for (let e of t.childNodes)
                (e.nodeType === 1 || e.nodeType === 6) && this.writeNode(e);
              this._unindend(), this._writeLine();
            }
            this._write(`</${t.localName}>`);
          }
          break;
        case 2:
          t.value && this._write(t.value);
          break;
        case 3:
          t.value !== null && this._write(`<![CDATA[${t.value}]]>`);
          break;
        case 4:
          this._xmlHeader &&
            this._write('<?xml version="1.0" encoding="utf-8"?>');
          for (let e of t.childNodes) this.writeNode(e);
          break;
        case 5:
          this._write(`<!DOCTYPE ${t.value}>`);
          break;
        case 6:
          this._write(`<!-- ${t.value} -->`);
          break;
      }
    }
    _unindend() {
      this._currentIndention = this._currentIndention.substr(
        0,
        this._currentIndention.length - this._indention.length
      );
    }
    _indent() {
      this._currentIndention += this._indention;
    }
    _writeAttributeValue(t) {
      for (let e = 0; e < t.length; e++) {
        let r = t.charAt(e);
        switch (r) {
          case "<":
            this._result.push("&lt;");
            break;
          case ">":
            this._result.push("&gt;");
            break;
          case "&":
            this._result.push("&amp;");
            break;
          case "'":
            this._result.push("&apos;");
            break;
          case '"':
            this._result.push("&quot;");
            break;
          default:
            this._result.push(r);
            break;
        }
      }
    }
    static write(t, e, r) {
      let i = new p(e, r);
      return i.writeNode(t), i.toString();
    }
    _write(t) {
      this._isStartOfLine && this._result.push(this._currentIndention),
        this._result.push(t),
        (this._isStartOfLine = !1);
    }
    _writeLine(t = null) {
      t && this._write(t),
        this._indention.length > 0 &&
          !this._isStartOfLine &&
          (this._result.push(`
`),
          (this._isStartOfLine = !0));
    }
    toString() {
      return this._result.join("").trimRight();
    }
  };
  var pi = class extends wr {
    constructor() {
      super(), (this.nodeType = 4);
    }
    parse(t) {
      ru.parse(t, 0, this);
    }
    toString() {
      return this.toFormattedString();
    }
    toFormattedString(t = "", e = !1) {
      return nu.write(this, t, e);
    }
  };
  var hi = class {
    constructor() {
      this.noteRange = 1;
      this.x = 0;
      this.y = 0;
    }
  };
  var go = class extends hi {
      constructor() {
        super(...arguments);
        this.align = 0;
        this.frame = 0;
        this.text = "";
        this.fontFace = "";
        this.weight = 0;
        this.height = 0;
      }
    },
    su = class extends hi {
      constructor() {
        super(...arguments);
        this.chord = new Bt();
      }
    },
    au = class extends hi {},
    ou = class extends hi {},
    Tp = class extends hi {
      constructor() {
        super(...arguments);
        this.number = 0;
      }
    },
    lu = class extends hi {
      constructor() {
        super(...arguments);
        this.decrescendo = !1;
      }
    },
    yo = class extends hi {
      constructor() {
        super(...arguments);
        this.allNumbers = !1;
        this.firstNumber = 0;
        this.lastNumber = 0;
      }
    },
    kp = class extends hi {
      constructor() {
        super(...arguments);
        this.octave = 1;
      }
    },
    vp = class extends hi {},
    _p = class {
      constructor() {
        this.defaultClef = 4;
        this.description = "";
        this.percussion = !1;
        this.instrument = 0;
        this.volume = 0;
        this.transpose = 0;
        this.index = 0;
      }
    },
    xp = class {
      constructor() {
        this.from = 0;
        this.to = 0;
        this.curly = !1;
      }
    },
    wp = class {
      constructor() {
        this.currentBarIndex = -1;
        this.currentBarComplete = !0;
        this.currentBarDuration = 0;
        this.currentPosition = 0;
        this.voiceStemDir = null;
        this.repeatCount = 0;
        this.repeatEnd = null;
      }
    },
    uu = class p {
      constructor() {
        this._trackChannel = 0;
        this._beamingMode = 0;
        this._isFirstSystem = !0;
        this._initialTempo = -1;
        this._staffLookup = new Map();
        this._brackets = [];
        this._staffLayoutLookup = new Map();
        this._staffLayouts = [];
        this._timeSignature = new ot();
        this._voiceStates = new Map();
      }
      parseXml(t, e) {
        (this._galleryObjects = new Map()),
          (this._tieStarts = []),
          (this._tieStartIds = new Map()),
          (this._voiceCounts = new Map()),
          (this._slurs = new Map()),
          (this._crescendo = new Map()),
          (this._isFirstSystem = !0);
        let r = new pi();
        try {
          r.parse(t);
        } catch (i) {
          throw new ke("Could not parse XML", i);
        }
        this._parseDom(r), this._consolidate(), this.score.finish(e);
      }
      _consolidate() {
        A.consolidate(this.score),
          p._applyEffectRange(this._slurs, (t, e) => {
            e.isLegatoOrigin = !0;
          }),
          p._applyEffectRange(this._crescendo, (t, e) => {
            e.crescendo = t.decrescendo ? 2 : 1;
          });
      }
      static _applyEffectRange(t, e) {
        for (let [r, i] of t) {
          let n = i.noteRange,
            s = r;
          for (let a = 0; a < n; a++)
            if ((e(i, s), s.index + 1 < s.voice.beats.length))
              s = s.voice.beats[s.index + 1];
            else if (s.voice.bar.index + 1 < s.voice.bar.staff.bars.length)
              s =
                s.voice.bar.staff.bars[s.voice.bar.index + 1].voices[
                  s.voice.index
                ].beats[0];
            else break;
        }
      }
      _parseDom(t) {
        let e = t.firstElement;
        if (!e) throw new ke("No valid XML");
        if (e.localName === "score") {
          this.score = new tt();
          for (let r of e.childElements())
            switch (r.localName) {
              case "info":
                this._parseInfo(r);
                break;
              case "layout":
                this._parseLayout(r);
                break;
              case "gallery":
                this._parseGallery(r);
                break;
              case "pageObjects":
                this._parsePageObjects(r);
                break;
              case "systems":
                this._parseSystems(r);
                break;
            }
        } else throw new ke('Root node of XML was not "score"');
      }
      _parseLayout(t) {
        for (let n of t.childElements())
          switch (n.localName) {
            case "staves":
              this._parseLayoutStaves(n);
              break;
            case "brackets":
              this._parseBrackets(n);
              break;
          }
        let e = this._brackets.filter((n) => !!n.curly);
        e.sort((n, s) => n.from - s.from);
        let r = 0,
          i = null;
        for (let n = 0; n < this._staffLayouts.length; n++) {
          let s = this._staffLayouts[n];
          for (; r < e.length && n > e[r].to; ) r++;
          i && r < e.length && n > e[r].from && n <= e[r].to
            ? i.ensureStaveCount(i.staves.length + 1)
            : ((i = new Tt()),
              i.ensureStaveCount(1),
              (i.name = s.description),
              (i.playbackInfo.volume = Math.floor((s.volume / 128) * 16)),
              (i.playbackInfo.program = s.instrument),
              s.percussion
                ? ((i.playbackInfo.primaryChannel = 9),
                  (i.playbackInfo.secondaryChannel = 9))
                : ((i.playbackInfo.primaryChannel = this._trackChannel++),
                  (i.playbackInfo.secondaryChannel = this._trackChannel++)),
              this.score.addTrack(i));
          let a = i.staves[i.staves.length - 1];
          (a.isPercussion = s.percussion),
            (a.transpositionPitch = s.transpose),
            (a.displayTranspositionPitch = 0),
            (a.showTablature = !1),
            this._staffLookup.set(s.index, a);
        }
      }
      _parseBrackets(t) {
        for (let e of t.childElements())
          e.localName === "bracket" && this._parseBracket(e);
      }
      _parseBracket(t) {
        let e = new xp();
        (e.from = Number.parseInt(t.getAttribute("from"), 10)),
          (e.to = Number.parseInt(t.getAttribute("to"), 10)),
          t.attributes.has("curly") &&
            (e.curly = t.attributes.get("curly") === "true"),
          this._brackets.push(e);
      }
      _parseLayoutStaves(t) {
        for (let e of t.childElements())
          e.localName === "staffLayout" && this._parseStaffLayout(e);
      }
      _parseStaffLayout(t) {
        let e = new _p();
        e.description = t.getAttribute("description");
        for (let r of t.childElements())
          switch (r.localName) {
            case "notation":
              r.attributes.has("defaultClef") &&
                (e.defaultClef = this._parseClef(
                  r.attributes.get("defaultClef")
                ));
              break;
            case "sound":
              r.attributes.has("percussion") &&
                (e.percussion = r.attributes.get("percussion") === "true"),
                r.attributes.has("instr") &&
                  (e.instrument = Number.parseInt(
                    r.attributes.get("instr"),
                    10
                  )),
                r.attributes.has("volume") &&
                  (e.volume = Number.parseInt(r.attributes.get("volume"), 10)),
                r.attributes.has("transpose") &&
                  (e.transpose = Number.parseInt(
                    r.attributes.get("transpose"),
                    10
                  ));
              break;
          }
        this._staffLayoutLookup.set(e.description, e),
          (e.index = this._staffLayouts.length),
          this._staffLayouts.push(e);
      }
      _parseClef(t) {
        switch (t) {
          case "treble":
            return 4;
          case "bass":
            return 3;
          case "alto":
            return 2;
          case "tenor":
            return 2;
        }
        return 4;
      }
      _parseClefOttava(t) {
        return t.endsWith("-") ? 3 : t.endsWith("+") ? 1 : 2;
      }
      _parseSystems(t) {
        for (let e of t.childElements())
          e.localName === "system" && this._parseSystem(e);
      }
      _parseSystem(t) {
        t.attributes.has("tempo") &&
          this.score.masterBars.length === 0 &&
          (this._initialTempo = Number.parseInt(t.attributes.get("tempo"), 10)),
          t.getAttribute("beamGrouping") === "0" && (this._beamingMode = 1);
        for (let e of t.childElements())
          e.localName === "staves" && this._parseStaves(t, e);
        this._isFirstSystem = !1;
      }
      _parseStaves(t, e) {
        let r = this.score.masterBars.length;
        for (let i of e.childElements())
          i.localName === "staff" && this._parseStaff(t, r, i);
      }
      _parseStaff(t, e, r) {
        let i = r.getAttribute("layout");
        (this._currentStaffLayout = this._staffLayoutLookup.get(i)),
          (this._timeSignature.timeSignatureNumerator = 4),
          (this._timeSignature.timeSignatureDenominator = 4),
          (this._timeSignature.timeSignatureCommon = !1),
          this._parseTime(r.getAttribute("defaultTime"));
        let n = this._staffLookup.get(this._currentStaffLayout.index);
        for (; n.bars.length < e; ) this._addNewBar(n);
        for (let s of r.childElements())
          s.localName === "voices" && this._parseVoices(i, n, t, e, s);
      }
      _parseTime(t) {
        switch (t) {
          case "allaBreve":
          case "C":
            (this._timeSignature.timeSignatureNumerator = 2),
              (this._timeSignature.timeSignatureDenominator = 2),
              (this._timeSignature.timeSignatureCommon = !0);
            break;
          case "longAllaBreve":
            (this._timeSignature.timeSignatureNumerator = 4),
              (this._timeSignature.timeSignatureDenominator = 4),
              (this._timeSignature.timeSignatureCommon = !0);
            break;
          default:
            if (t.indexOf("/") > 0) {
              let e = t.split("/");
              (this._timeSignature.timeSignatureNumerator = Number.parseInt(
                e[0],
                10
              )),
                (this._timeSignature.timeSignatureDenominator = Number.parseInt(
                  e[1],
                  10
                )),
                (this._timeSignature.timeSignatureCommon = !1);
            }
            break;
        }
      }
      _parseVoices(t, e, r, i, n) {
        let s = 0;
        for (let a of n.childElements())
          a.localName === "voice" && (this._parseVoice(t, e, r, s, i, a), s++);
      }
      _getOrCreateBar(t, e) {
        return e < t.bars.length ? t.bars[e] : this._addNewBar(t);
      }
      _addNewBar(t) {
        let e = new at();
        if (
          (t.bars.length > 0
            ? ((e.clef = t.bars[t.bars.length - 1].clef),
              (e.clefOttava = t.bars[t.bars.length - 1].clefOttava),
              (e.keySignature = t.bars[t.bars.length - 1].keySignature),
              (e.keySignatureType = t.bars[t.bars.length - 1].keySignatureType))
            : (e.clef = this._currentStaffLayout.defaultClef),
          t.addBar(e),
          t.bars.length > this.score.masterBars.length)
        ) {
          let r = new ot();
          this.score.addMasterBar(r),
            r.index > 0
              ? (r.tripletFeel = r.previousMasterBar.tripletFeel)
              : this._initialTempo > 0 &&
                r.tempoAutomations.push(
                  he.buildTempoAutomation(!1, 0, this._initialTempo, 0)
                ),
            (r.timeSignatureDenominator =
              this._timeSignature.timeSignatureDenominator),
            (r.timeSignatureNumerator =
              this._timeSignature.timeSignatureNumerator),
            (r.timeSignatureCommon = this._timeSignature.timeSignatureCommon);
        }
        return e;
      }
      _newBar(t, e) {
        this._currentVoiceState.currentBarIndex++,
          (this._currentBar = this._getOrCreateBar(
            t,
            this._currentVoiceState.currentBarIndex
          )),
          (this._currentVoiceState.currentBarDuration =
            this._currentBar.masterBar.calculateDuration(!1)),
          (this._currentVoiceState.currentBarComplete = !1),
          (this._currentVoiceState.currentPosition = 0),
          this._ensureVoice(t, e);
      }
      _parseVoice(t, e, r, i, n, s) {
        let a = `${t}_${i}`;
        if (
          (this._currentVoiceState &&
            !this._currentVoiceState.currentBarComplete &&
            (this._currentBar.masterBar.isAnacrusis = !0),
          this._voiceStates.has(a)
            ? ((this._currentVoiceState = this._voiceStates.get(a)),
              (this._currentBar = this._getOrCreateBar(
                e,
                this._currentVoiceState.currentBarIndex
              )),
              this._ensureVoice(e, i))
            : ((this._currentVoiceState = new wp()),
              (this._currentVoiceState.currentBarIndex = n - 1),
              this._voiceStates.set(a, this._currentVoiceState),
              this._newBar(e, i)),
          s.attributes.has("stemDir"))
        )
          switch (s.attributes.get("stemDir")) {
            case "up":
              this._currentVoiceState.voiceStemDir = 0;
              break;
            case "down":
              this._currentVoiceState.voiceStemDir = 1;
              break;
            default:
              this._currentVoiceState.voiceStemDir = null;
              break;
          }
        else this._currentVoiceState.voiceStemDir = null;
        let o = s.findChildElement("noteObjects");
        if (r.attributes.has("tempo")) {
          let l = new he();
          (l.isLinear = !0),
            (l.type = 0),
            (l.value = Number.parseInt(r.attributes.get("tempo"), 10)),
            (l.ratioPosition =
              this._currentVoiceState.currentPosition /
              this._currentVoiceState.currentBarDuration),
            this._currentBar.masterBar.tempoAutomations.push(l);
        }
        if (o)
          for (let l of o.childElements())
            switch (
              (this._currentVoiceState.currentBarComplete &&
                l.localName !== "barline" &&
                this._newBar(e, i),
              l.localName)
            ) {
              case "clefSign":
                (this._currentBar.clef = this._parseClef(
                  l.getAttribute("clef")
                )),
                  (this._currentBar.clefOttava = this._parseClefOttava(
                    l.getAttribute("clef")
                  ));
                break;
              case "keySign":
                this._currentBar.keySignature = Number.parseInt(
                  l.getAttribute("fifths"),
                  10
                );
                break;
              case "timeSign":
                this._parseTime(l.getAttribute("time")),
                  (this._currentBar.masterBar.timeSignatureDenominator =
                    this._timeSignature.timeSignatureDenominator),
                  (this._currentBar.masterBar.timeSignatureNumerator =
                    this._timeSignature.timeSignatureNumerator),
                  (this._currentBar.masterBar.timeSignatureCommon =
                    this._timeSignature.timeSignatureCommon),
                  (this._currentVoiceState.currentPosition = 0),
                  (this._currentVoiceState.currentBarDuration =
                    this._currentBar.masterBar.calculateDuration(!1));
                break;
              case "barline":
                switch (l.getAttribute("type")) {
                  case "double":
                    (this._currentBar.barLineRight = 7),
                      this._currentVoiceState.currentBarComplete ||
                        (this._currentBar.masterBar.isAnacrusis = !0),
                      (this._currentVoiceState.currentBarComplete = !0);
                    break;
                  case "end":
                    this._currentVoiceState.currentBarComplete ||
                      (this._currentBar.masterBar.isAnacrusis = !0);
                    break;
                  case "repEnd":
                    (this._currentVoiceState.repeatEnd =
                      this._currentBar.masterBar),
                      this._currentBar.masterBar.repeatCount <
                        this._currentVoiceState.repeatCount &&
                        (this._currentBar.masterBar.repeatCount =
                          this._currentVoiceState.repeatCount),
                      this._parseBarDrawObject(l),
                      this._currentVoiceState.currentBarComplete ||
                        (this._currentBar.masterBar.isAnacrusis = !0),
                      (this._currentVoiceState.currentBarComplete = !0);
                    break;
                  case "repBegin":
                    this._newBar(e, i),
                      (this._currentBar.masterBar.isRepeatStart = !0),
                      (this._currentVoiceState.repeatEnd = null),
                      (this._currentVoiceState.repeatCount = 0);
                    break;
                  case "repEndBegin":
                    (this._currentVoiceState.repeatEnd =
                      this._currentBar.masterBar),
                      this._currentBar.masterBar.repeatCount <
                        this._currentVoiceState.repeatCount &&
                        (this._currentBar.masterBar.repeatCount =
                          this._currentVoiceState.repeatCount),
                      this._parseBarDrawObject(l),
                      this._newBar(e, i),
                      (this._currentBar.masterBar.isRepeatStart = !0);
                    break;
                  case "dashed":
                    this._currentVoiceState.currentBarComplete ||
                      (this._currentBar.masterBar.isAnacrusis = !0),
                      (this._currentVoiceState.currentBarComplete = !0);
                    break;
                  default:
                    this._currentVoiceState.currentBarComplete ||
                      (this._currentBar.masterBar.isAnacrusis = !0),
                      (this._currentVoiceState.currentBarComplete = !0);
                    break;
                }
                break;
              case "chord":
                let u = new Me();
                this._initFromPreviousBeat(u, this._currentVoice),
                  (u.beamingMode = this._beamingMode),
                  this._currentVoiceState.voiceStemDir &&
                    (u.preferredBeamDirection =
                      this._currentVoiceState.voiceStemDir),
                  this._parseDuration(u, l.findChildElement("duration")),
                  u.updateDurations(),
                  (this._currentVoiceState.currentPosition +=
                    u.playbackDuration),
                  this._currentVoice.addBeat(u),
                  this._parseChord(u, l),
                  this._currentVoiceState.currentPosition >=
                    this._currentVoiceState.currentBarDuration &&
                    (this._currentVoiceState.currentBarComplete = !0);
                break;
              case "rest":
                let c = this._parseRestDurations(
                  l.findChildElement("duration")
                );
                c &&
                  (this._initFromPreviousBeat(c, this._currentVoice),
                  c.updateDurations(),
                  (this._currentVoiceState.currentPosition +=
                    c.playbackDuration),
                  this._currentVoice.addBeat(c),
                  this._currentVoiceState.currentPosition >=
                    this._currentVoiceState.currentBarDuration &&
                    (this._currentVoiceState.currentBarComplete = !0));
                break;
            }
      }
      _initFromPreviousBeat(t, e) {
        let r = this._getLastBeat(e);
        r && (t.dynamics = r.dynamics);
      }
      _getLastBeat(t) {
        if (t.beats.length > 0) return t.beats[t.beats.length - 1];
        if (t.bar.index > 0) {
          let e = t.bar.staff.bars[t.bar.index - 1];
          if (t.index < e.voices.length) {
            let r = e.voices[t.index];
            return this._getLastBeat(r);
          }
        }
        return null;
      }
      _ensureVoice(t, e) {
        for (; this._currentBar.voices.length < e + 1; )
          this._currentBar.addVoice(new ze());
        (!this._voiceCounts.has(t.track.index) ||
          this._voiceCounts.get(t.track.index) <
            this._currentBar.voices.length) &&
          this._voiceCounts.set(t.track.index, this._currentBar.voices.length),
          (this._currentVoice = this._currentBar.voices[e]);
      }
      _parseChord(t, e) {
        let r = new Xe();
        for (let i of e.childElements())
          switch (i.localName) {
            case "stem":
              switch (i.getAttribute("dir")) {
                case "up":
                  t.preferredBeamDirection = 0;
                  break;
                case "down":
                  t.preferredBeamDirection = 1;
                  break;
              }
              break;
            case "articulation":
              switch (i.getAttribute("type")) {
                case "staccato":
                  r.isStaccato = !0;
                  break;
                case "normalAccent":
                  r.accentuated = 1;
                  break;
                case "strongAccent":
                  r.accentuated = 2;
                  break;
              }
              break;
            case "lyric":
              this._parseLyric(t, i);
              break;
            case "drawObjects":
              this._parseBeatDrawObject(t, i);
              break;
            case "heads":
              this._parseHeads(t, r, i);
              break;
            case "beam":
              switch (i.getAttribute("group")) {
                case "force":
                  t.beamingMode = 2;
                  break;
                case "divide":
                  t.beamingMode = 1;
                  break;
              }
              break;
          }
      }
      _parseHeads(t, e, r) {
        for (let i of r.childElements())
          i.localName === "head" && this._parseHead(t, e, i);
      }
      _parseHead(t, e, r) {
        let i = new Xe(),
          n = A.parseTuning(r.getAttribute("pitch"));
        (i.octave = n.octave - 1),
          (i.tone = n.tone.noteValue),
          (i.isStaccato = e.isStaccato),
          (i.accentuated = e.accentuated),
          t.addNote(i);
        for (let s of r.childElements())
          switch (s.localName) {
            case "alter":
              s.attributes.has("step") &&
                (i.tone += Number.parseInt(s.attributes.get("step"), 10));
              break;
            case "tie":
              s.attributes.has("begin")
                ? this._tieStartIds.has(i.id) ||
                  (this._tieStartIds.set(i.id, !0), this._tieStarts.push(i))
                : s.attributes.has("end") &&
                  this._tieStarts.length > 0 &&
                  !i.isTieDestination &&
                  ((i.isTieDestination = !0),
                  (i.tieOrigin = this._tieStarts[0]),
                  this._tieStarts.splice(0, 1),
                  this._tieStartIds.delete(i.id));
              break;
          }
      }
      _parseBeatDrawObject(t, e) {
        for (let r of e.childElements())
          switch (r.localName) {
            case "drawObj":
              let i = this._parseDrawObj(r);
              if (i) {
                if (i instanceof go)
                  i.fontFace.startsWith("capella")
                    ? i.text === "u"
                      ? ((t.fermata = new kr()), (t.fermata.type = 1))
                      : i.text === "f"
                      ? (t.dynamics = 5)
                      : i.text === "j" && (t.dynamics = 4)
                    : this._isFirstSystem &&
                      this.score.title === "" &&
                      i.align === 1 &&
                      i.height > 16 &&
                      i.weight > 400
                    ? (this.score.title = i.text)
                    : this._isFirstSystem &&
                      this.score.artist === "" &&
                      i.align === 1 &&
                      i.y < 0
                    ? (this.score.artist = i.text)
                    : this._isFirstSystem &&
                      this.score.music === "" &&
                      i.align === 2 &&
                      i.y < 0
                    ? (this.score.music = i.text)
                    : i.text.startsWith("by capella") || (t.text = i.text);
                else if (!(i instanceof su))
                  if (i instanceof ou) t.vibrato = 1;
                  else if (i instanceof lu)
                    (t.crescendo = i.decrescendo ? 2 : 1),
                      i.noteRange++,
                      this._crescendo.set(t, i);
                  else if (i instanceof au) {
                    let n = i;
                    this._slurs.set(t, n);
                  } else i instanceof yo && this._applyVolta(i);
              }
              break;
          }
      }
      _parseBarDrawObject(t) {
        for (let e of t.childElements())
          if (e.localName === "drawObj") {
            let r = this._parseDrawObj(e);
            r && r instanceof yo && this._applyVolta(r);
          }
      }
      _applyVolta(t) {
        if (
          (t.lastNumber > 0
            ? ((this._currentVoiceState.repeatCount = t.lastNumber),
              this._currentVoiceState.repeatEnd &&
                this._currentVoiceState.repeatEnd.repeatCount <
                  this._currentVoiceState.repeatCount &&
                (this._currentVoiceState.repeatEnd.repeatCount =
                  this._currentVoiceState.repeatCount))
            : t.firstNumber > 0 &&
              ((this._currentVoiceState.repeatCount = t.firstNumber),
              this._currentVoiceState.repeatEnd &&
                this._currentVoiceState.repeatEnd.repeatCount <
                  this._currentVoiceState.repeatCount &&
                (this._currentVoiceState.repeatEnd.repeatCount =
                  this._currentVoiceState.repeatCount)),
          t.lastNumber > 0 && t.firstNumber > 0)
        ) {
          let e = 0;
          for (let r = t.firstNumber; r <= t.lastNumber; r++)
            e = e | (1 << (r - 1));
          this._currentBar.masterBar.alternateEndings = e;
        } else
          t.lastNumber > 0
            ? (this._currentBar.masterBar.alternateEndings =
                1 << (t.lastNumber - 1))
            : t.firstNumber > 0 &&
              (this._currentBar.masterBar.alternateEndings =
                1 << (t.firstNumber - 1));
      }
      _parseLyric(t, e) {
        for (let r of e.childElements())
          if (r.localName === "verse") {
            t.lyrics || (t.lyrics = []);
            let i = r.innerText;
            r.getAttribute("hyphen") === "true" && (i += "-"), t.lyrics.push(i);
          }
      }
      _parseRestDurations(t) {
        let e = t.getAttribute("base");
        if (e.indexOf("/") !== -1) {
          let i = new Me();
          return (
            (i.beamingMode = this._beamingMode), this._parseDuration(i, t), i
          );
        }
        if (Number.parseInt(e, 10) === 1) {
          let i = new Me();
          return (i.beamingMode = this._beamingMode), (i.duration = 1), i;
        }
        return w.warning("Importer", "Multi-Bar rests are not supported"), null;
      }
      _parseDurationValue(t) {
        switch (t) {
          case "2/1":
            return -2;
          case "1/1":
            return 1;
          case "1/2":
            return 2;
          case "1/4":
            return 4;
          case "1/8":
            return 8;
          case "1/16":
            return 16;
          case "1/32":
            return 32;
          case "1/64":
            return 64;
          case "1/128":
            return 128;
          default:
            return w.warning("Importer", "Unsupported duration"), 4;
        }
      }
      _parseDuration(t, e) {
        let r = e.getAttribute("base");
        (t.duration = this._parseDurationValue(r)),
          e.attributes.has("dots") &&
            (t.dots = Number.parseInt(e.attributes.get("dots"), 10));
        let i = e.findChildElement("tuplet");
        if (i) {
          t.tupletNumerator = Number.parseInt(i.getAttribute("count"), 10);
          let n = i.getAttribute("tripartite") === "true" ? 3 : 1,
            s = i.getAttribute("prolong") === "true" ? 0 : 1,
            a = 0;
          for (; n * Math.pow(2, a + s) < t.tupletNumerator; ) a++;
          t.tupletDenominator = n * Math.pow(2, a);
        }
      }
      _parsePageObjects(t) {
        for (let e of t.childElements())
          switch (e.localName) {
            case "drawObj":
              let r = this._parseDrawObj(e);
              if (r && r instanceof go)
                switch (r.align) {
                  case 1:
                    this.score.title
                      ? this.score.subTitle ||
                        (this.score.subTitle = e.innerText)
                      : (this.score.title = e.innerText);
                    break;
                  case 2:
                    this.score.artist || (this.score.artist = e.innerText);
                    break;
                }
              break;
          }
      }
      _parseGallery(t) {
        for (let e of t.childElements())
          if (e.localName === "drawObj") {
            let r = this._parseDrawObj(e);
            r && this._galleryObjects.set(e.getAttribute("name"), r);
          }
      }
      _parseDrawObj(t) {
        let e = null,
          r = 1;
        for (let i of t.childElements())
          switch (i.localName) {
            case "text":
              e = this._parseText(i);
              break;
            case "guitar":
              e = this._parseGuitar(i);
              break;
            case "slur":
              e = this._parseSlur(i);
              break;
            case "wavyLine":
              e = this._parseWavyLine(i);
              break;
            case "bracket":
              e = this._parseTupletBracket(i);
              break;
            case "wedge":
              e = this._parseWedge(i);
              break;
            case "volta":
              e = this._parseVolta(i);
              break;
            case "octaveClef":
              e = this._parseOctaveClef(i);
              break;
            case "trill":
              e = this._parseTrill(i);
              break;
            case "basic":
              i.attributes.has("noteRange") &&
                (r = Number.parseInt(i.attributes.get("noteRange"), 10));
              break;
          }
        return e && (e.noteRange = r), e;
      }
      _parseTrill(t) {
        return new vp();
      }
      _parseOctaveClef(t) {
        let e = new kp();
        return (
          t.attributes.has("octave") &&
            (e.octave = Number.parseInt(t.attributes.get("octave"), 10)),
          e
        );
      }
      _parseVolta(t) {
        let e = new yo();
        return (
          (e.allNumbers = t.attributes.get("allNumbers") === "true"),
          t.attributes.has("firstNumber") &&
            (e.firstNumber = Number.parseInt(
              t.attributes.get("firstNumber"),
              10
            )),
          t.attributes.has("lastNumber") &&
            (e.lastNumber = Number.parseInt(
              t.attributes.get("lastNumber"),
              10
            )),
          e
        );
      }
      _parseWedge(t) {
        let e = new lu();
        return (e.decrescendo = t.attributes.get("decrescendo") === "true"), e;
      }
      _parseTupletBracket(t) {
        let e = new Tp();
        return (
          t.attributes.has("number") &&
            (e.number = Number.parseInt(t.attributes.get("number"), 10)),
          e
        );
      }
      _parseWavyLine(t) {
        return new ou();
      }
      _parseSlur(t) {
        return new au();
      }
      _parseGuitar(t) {
        let e = new su(),
          r = t.innerText.trim();
        for (let i = 0; i < r.length; i++)
          r.charAt(i) === "/"
            ? e.chord.strings.push(0)
            : e.chord.strings.push(Number.parseInt(r.charAt(i), 10));
        return e;
      }
      _parseText(t) {
        let e = new go();
        switch (
          (t.attributes.has("x") &&
            (e.x = Number.parseFloat(t.attributes.get("x"))),
          t.attributes.has("x") &&
            (e.y = Number.parseFloat(t.attributes.get("y"))),
          t.getAttribute("align"))
        ) {
          case "left":
            e.align = 0;
            break;
          case "center":
            e.align = 1;
            break;
          case "right":
            e.align = 2;
            break;
        }
        switch (t.getAttribute("frame")) {
          case "rectangle":
            e.frame = 1;
            break;
          case "ellipse":
            e.frame = 2;
            break;
          case "circle":
            e.frame = 3;
            break;
          case "none":
            e.frame = 0;
            break;
        }
        if (t.firstElement)
          for (let r of t.childElements())
            switch (r.localName) {
              case "font":
                (e.fontFace = r.getAttribute("face")),
                  r.attributes.has("weight") &&
                    (e.weight = Number.parseInt(
                      r.attributes.get("weight"),
                      10
                    )),
                  r.attributes.has("height") &&
                    (e.height = Number.parseInt(
                      r.attributes.get("height"),
                      10
                    ));
                break;
              case "content":
                e.text = r.innerText;
                break;
            }
        else e.text = t.innerText;
        return e;
      }
      _parseInfo(t) {
        for (let e of t.childElements())
          switch (e.localName) {
            case "author":
              this.score.tab = e.firstChild.innerText;
              break;
            case "comment":
              this.score.notices = e.firstChild.innerText;
              break;
          }
      }
    };
  var cu = class extends Kt {
    get name() {
      return "Capella";
    }
    readScore() {
      w.debug(this.name, "Loading ZIP entries");
      let t = new Tn(this.data),
        e,
        r = null;
      if (
        ((e = t.read()), w.debug(this.name, "Zip entries loaded"), e.length > 0)
      )
        for (let i of e)
          i.fileName === "score.xml" &&
            (r = B.toString(i.data, this.settings.importer.encoding));
      else
        this.data.reset(),
          (r = B.toString(
            this.data.readAll(),
            this.settings.importer.encoding
          ));
      if (!r) throw new ke("No valid capella file");
      w.debug(this.name, "Start Parsing score.xml");
      try {
        let i = new uu();
        return (
          i.parseXml(r, this.settings),
          w.debug(this.name, "score.xml parsed"),
          i.score
        );
      } catch (i) {
        throw new ke("Failed to parse CapXML", i);
      }
    }
  };
  var Pi = class Pi extends Kt {
    constructor() {
      super(...arguments);
      this._versionNumber = 0;
      this._globalTripletFeel = 0;
      this._lyricsTrack = 0;
      this._lyrics = [];
      this._barCount = 0;
      this._trackCount = 0;
      this._playbackInfos = [];
      this._doubleBars = new Set();
      this._clefsPerTrack = new Map();
      this._keySignatures = new Map();
      this._beatTextChunksByTrack = new Map();
      this._directionLookup = new Map();
    }
    get name() {
      return "Guitar Pro 3-5";
    }
    readScore() {
      if (
        (this._directionLookup.clear(),
        this.readVersion(),
        (this._score = new tt()),
        this.readScoreInformation(),
        this._versionNumber < 500 &&
          (this._globalTripletFeel = pe.gpReadBool(this.data) ? 2 : 0),
        this._versionNumber >= 400 && this.readLyrics(),
        this._versionNumber >= 510 && this.data.skip(19),
        (this._initialTempo = he.buildTempoAutomation(!1, 0, 0, 0)),
        this._versionNumber >= 500 &&
          (this.readPageSetup(),
          (this._initialTempo.text = pe.gpReadStringIntByte(
            this.data,
            this.settings.importer.encoding
          ))),
        (this._initialTempo.value = B.readInt32LE(this.data)),
        this._versionNumber >= 510 && pe.gpReadBool(this.data),
        B.readInt32LE(this.data),
        this._versionNumber >= 400 && this.data.readByte(),
        this.readPlaybackInfos(),
        this._versionNumber >= 500 &&
          (this._readDirection(3),
          this._readDirection(4),
          this._readDirection(1),
          this._readDirection(2),
          this._readDirection(0),
          this._readDirection(5),
          this._readDirection(6),
          this._readDirection(7),
          this._readDirection(8),
          this._readDirection(9),
          this._readDirection(10),
          this._readDirection(11),
          this._readDirection(12),
          this._readDirection(13),
          this._readDirection(14),
          this._readDirection(15),
          this._readDirection(16),
          this._readDirection(17),
          this._readDirection(18),
          this.data.skip(4)),
        (this._barCount = B.readInt32LE(this.data)),
        (this._trackCount = B.readInt32LE(this.data)),
        this.readMasterBars(),
        this.readTracks(),
        this.readBars(),
        this._score.masterBars.length > 0)
      ) {
        let e = he.buildTempoAutomation(!1, 0, this._score.tempo, 2);
        (e.text = this._score.tempoLabel),
          this._score.masterBars[0].tempoAutomations.push(e);
      }
      return (
        A.consolidate(this._score),
        this._score.finish(this.settings),
        this._lyrics &&
          this._lyricsTrack >= 0 &&
          this._score.tracks[this._lyricsTrack].applyLyrics(this._lyrics),
        this._score
      );
    }
    _readDirection(e) {
      let r = B.readInt16LE(this.data);
      if (r === -1) return;
      r--;
      let i;
      this._directionLookup.has(r)
        ? (i = this._directionLookup.get(r))
        : ((i = []), this._directionLookup.set(r, i)),
        i.push(e);
    }
    readVersion() {
      let e = pe.gpReadStringByteLength(
        this.data,
        30,
        this.settings.importer.encoding
      );
      if (!e.startsWith(Pi._versionString)) throw new ke("Unsupported format");
      e = e.substr(Pi._versionString.length + 1);
      let r = e.indexOf(".");
      (this._versionNumber =
        100 * Number.parseInt(e.substr(0, r), 10) +
        Number.parseInt(e.substr(r + 1), 10)),
        w.debug(this.name, `Guitar Pro version ${e} detected`);
    }
    readScoreInformation() {
      (this._score.title = pe.gpReadStringIntUnused(
        this.data,
        this.settings.importer.encoding
      )),
        (this._score.subTitle = pe.gpReadStringIntUnused(
          this.data,
          this.settings.importer.encoding
        )),
        (this._score.artist = pe.gpReadStringIntUnused(
          this.data,
          this.settings.importer.encoding
        )),
        (this._score.album = pe.gpReadStringIntUnused(
          this.data,
          this.settings.importer.encoding
        )),
        (this._score.words = pe.gpReadStringIntUnused(
          this.data,
          this.settings.importer.encoding
        )),
        (this._score.music =
          this._versionNumber >= 500
            ? pe.gpReadStringIntUnused(
                this.data,
                this.settings.importer.encoding
              )
            : this._score.words),
        (this._score.copyright = pe.gpReadStringIntUnused(
          this.data,
          this.settings.importer.encoding
        )),
        (this._score.tab = pe.gpReadStringIntUnused(
          this.data,
          this.settings.importer.encoding
        )),
        (this._score.instructions = pe.gpReadStringIntUnused(
          this.data,
          this.settings.importer.encoding
        ));
      let e = B.readInt32LE(this.data),
        r = "";
      for (let i = 0; i < e; i++)
        i > 0 &&
          (r += `\r
`),
          (r += pe
            .gpReadStringIntUnused(this.data, this.settings.importer.encoding)
            ?.toString());
      this._score.notices = r;
    }
    readLyrics() {
      (this._lyrics = []), (this._lyricsTrack = B.readInt32LE(this.data) - 1);
      for (let e = 0; e < 5; e++) {
        let r = new Rr();
        (r.startBar = B.readInt32LE(this.data) - 1),
          (r.text = pe.gpReadStringInt(
            this.data,
            this.settings.importer.encoding
          )),
          this._lyrics.push(r);
      }
    }
    readPageSetup() {
      this.data.skip(28);
      let e = B.readInt16LE(this.data);
      (A.getOrCreateHeaderFooterStyle(this._score, 0).isVisible =
        (e & 1) !== 0),
        (A.getOrCreateHeaderFooterStyle(this._score, 0).template =
          pe.gpReadStringIntByte(this.data, this.settings.importer.encoding)),
        (A.getOrCreateHeaderFooterStyle(this._score, 1).isVisible =
          (e & 2) !== 0),
        (A.getOrCreateHeaderFooterStyle(this._score, 1).template =
          pe.gpReadStringIntByte(this.data, this.settings.importer.encoding)),
        (A.getOrCreateHeaderFooterStyle(this._score, 2).isVisible =
          (e & 4) !== 0),
        (A.getOrCreateHeaderFooterStyle(this._score, 2).template =
          pe.gpReadStringIntByte(this.data, this.settings.importer.encoding)),
        (A.getOrCreateHeaderFooterStyle(this._score, 3).isVisible =
          (e & 8) !== 0),
        (A.getOrCreateHeaderFooterStyle(this._score, 3).template =
          pe.gpReadStringIntByte(this.data, this.settings.importer.encoding)),
        (A.getOrCreateHeaderFooterStyle(this._score, 4).isVisible =
          (e & 16) !== 0),
        (A.getOrCreateHeaderFooterStyle(this._score, 4).template =
          pe.gpReadStringIntByte(this.data, this.settings.importer.encoding)),
        (A.getOrCreateHeaderFooterStyle(this._score, 5).isVisible =
          (e & 32) !== 0),
        (A.getOrCreateHeaderFooterStyle(this._score, 5).template =
          pe.gpReadStringIntByte(this.data, this.settings.importer.encoding)),
        (A.getOrCreateHeaderFooterStyle(this._score, 6).isVisible =
          (e & 64) !== 0),
        (A.getOrCreateHeaderFooterStyle(this._score, 6).template =
          pe.gpReadStringIntByte(this.data, this.settings.importer.encoding)),
        (A.getOrCreateHeaderFooterStyle(this._score, 8).isVisible =
          (e & 128) !== 0),
        (A.getOrCreateHeaderFooterStyle(this._score, 8).template =
          pe.gpReadStringIntByte(this.data, this.settings.importer.encoding)),
        (A.getOrCreateHeaderFooterStyle(this._score, 9).isVisible =
          (e & 128) !== 0),
        (A.getOrCreateHeaderFooterStyle(this._score, 9).template =
          pe.gpReadStringIntByte(this.data, this.settings.importer.encoding)),
        pe.gpReadStringIntByte(this.data, this.settings.importer.encoding);
    }
    readPlaybackInfos() {
      this._playbackInfos = [];
      let e = 0;
      for (let r = 0; r < 64; r++) {
        let i = new mn();
        (i.primaryChannel = e++),
          (i.secondaryChannel = e++),
          (i.program = B.readInt32LE(this.data)),
          (i.volume = this.data.readByte()),
          (i.balance = this.data.readByte()),
          this.data.skip(6),
          this._playbackInfos.push(i);
      }
    }
    readMasterBars() {
      for (let e = 0; e < this._barCount; e++) this.readMasterBar();
    }
    readMasterBar() {
      let e = null;
      this._score.masterBars.length > 0 &&
        (e = this._score.masterBars[this._score.masterBars.length - 1]);
      let r = new ot();
      !e &&
        this._initialTempo.value > 0 &&
        r.tempoAutomations.push(this._initialTempo);
      let i = this.data.readByte();
      if (
        ((i & 1) !== 0
          ? (r.timeSignatureNumerator = this.data.readByte())
          : e && (r.timeSignatureNumerator = e.timeSignatureNumerator),
        (i & 2) !== 0
          ? (r.timeSignatureDenominator = this.data.readByte())
          : e && (r.timeSignatureDenominator = e.timeSignatureDenominator),
        (r.isRepeatStart = (i & 4) !== 0),
        (i & 8) !== 0 &&
          (r.repeatCount =
            this.data.readByte() + (this._versionNumber >= 500 ? 0 : 1)),
        (i & 16) !== 0 && this._versionNumber < 500)
      ) {
        let a = e,
          o = 0;
        for (; a && !((a.isRepeatEnd && a !== e) || a.isRepeatStart); )
          (o = o | a.alternateEndings), (a = a.previousMasterBar);
        let l = 0,
          u = this.data.readByte();
        for (let c = 0; c < 8; c++) {
          let d = 1 << c;
          u > c && (o & d) === 0 && (l = l | d);
        }
        r.alternateEndings = l;
      }
      if ((i & 32) !== 0) {
        let a = new vr();
        (a.text = pe.gpReadStringIntByte(
          this.data,
          this.settings.importer.encoding
        )),
          (a.marker = ""),
          pe.gpReadColor(this.data, !1),
          (r.section = a);
      }
      if (
        ((i & 64) !== 0 &&
          this._keySignatures.set(this._score.masterBars.length, [
            B.readSInt8(this.data),
            this.data.readByte(),
          ]),
        this._versionNumber >= 500 && (i & 3) !== 0 && this.data.skip(4),
        this._versionNumber >= 500 &&
          (r.alternateEndings = this.data.readByte()),
        this._versionNumber >= 500)
      ) {
        switch (this.data.readByte()) {
          case 1:
            r.tripletFeel = 2;
            break;
          case 2:
            r.tripletFeel = 1;
            break;
        }
        this.data.readByte();
      } else r.tripletFeel = this._globalTripletFeel;
      let n = (i & 128) !== 0;
      r.isDoubleBar = n;
      let s = this._score.masterBars.length;
      if (this._directionLookup.has(s))
        for (let a of this._directionLookup.get(s)) r.addDirection(a);
      this._score.addMasterBar(r), n && this._doubleBars.add(r.index);
    }
    readTracks() {
      for (let e = 0; e < this._trackCount; e++) this.readTrack();
    }
    readTrack() {
      let e = new Tt();
      e.ensureStaveCount(1), this._score.addTrack(e);
      let r = e.staves[0],
        i = this.data.readByte();
      (e.name = pe.gpReadStringByteLength(
        this.data,
        40,
        this.settings.importer.encoding
      )),
        (i & 1) !== 0 && (r.isPercussion = !0),
        this._versionNumber >= 500 && (e.isVisibleOnMultiTrack = (i & 8) !== 0),
        this._score.stylesheet.perTrackDisplayTuning === null &&
          (this._score.stylesheet.perTrackDisplayTuning = new Map()),
        this._score.stylesheet.perTrackDisplayTuning.set(
          e.index,
          (i & 128) !== 0
        );
      let n = B.readInt32LE(this.data),
        s = [];
      for (let u = 0; u < 7; u++) {
        let c = B.readInt32LE(this.data);
        n > u && s.push(c);
      }
      r.stringTuning.tunings = s;
      let a = B.readInt32LE(this.data),
        o = B.readInt32LE(this.data) - 1,
        l = B.readInt32LE(this.data) - 1;
      if ((this.data.skip(4), o >= 0 && o < this._playbackInfos.length)) {
        let u = this._playbackInfos[o];
        (u.port = a),
          (u.isSolo = (i & 16) !== 0),
          (u.isMute = (i & 32) !== 0),
          (u.secondaryChannel = l),
          Lt.isGuitar(u.program) && (r.displayTranspositionPitch = -12),
          (e.playbackInfo = u);
      }
      if (
        ((r.capo = B.readInt32LE(this.data)),
        (e.color = pe.gpReadColor(this.data, !1)),
        this._versionNumber >= 500)
      ) {
        let u = this.data.readByte();
        (r.showTablature = (u & 1) !== 0),
          (r.showStandardNotation = (u & 2) !== 0);
        let c = (u & 100) !== 0;
        this._score.stylesheet.perTrackChordDiagramsOnTop === null &&
          (this._score.stylesheet.perTrackChordDiagramsOnTop = new Map()),
          this._score.stylesheet.perTrackChordDiagramsOnTop.set(e.index, c),
          this.data.readByte(),
          this.data.readByte(),
          (e.playbackInfo.bank = this.data.readByte()),
          this.data.readByte(),
          B.readInt32LE(this.data) === 12
            ? this._clefsPerTrack.set(o, 3)
            : this._clefsPerTrack.set(o, 4),
          B.readInt32LE(this.data),
          B.readInt32LE(this.data),
          this.data.skip(10),
          this.data.readByte(),
          this.data.readByte(),
          this._readRseBank(),
          this._versionNumber >= 510 &&
            (this.data.skip(4),
            pe.gpReadStringIntByte(this.data, this.settings.importer.encoding),
            pe.gpReadStringIntByte(this.data, this.settings.importer.encoding));
      } else
        Lt.isBass(e.playbackInfo.program)
          ? this._clefsPerTrack.set(o, 3)
          : this._clefsPerTrack.set(o, 4);
    }
    readBars() {
      for (let e = 0; e < this._barCount; e++)
        for (let r = 0; r < this._trackCount; r++)
          this.readBar(this._score.tracks[r]);
    }
    readBar(e) {
      let r = new at(),
        i = e.staves[0];
      if (
        (i.isPercussion
          ? (r.clef = 0)
          : this._clefsPerTrack.has(e.index) &&
            (r.clef = this._clefsPerTrack.get(e.index)),
        i.addBar(r),
        this._keySignatures.has(r.index))
      ) {
        let s = this._keySignatures.get(r.index);
        (r.keySignature = s[0]), (r.keySignatureType = s[1]);
      } else
        r.index > 0 &&
          ((r.keySignature = r.previousBar.keySignature),
          (r.keySignatureType = r.previousBar.keySignatureType));
      this._doubleBars.has(r.index) && (r.barLineRight = 7);
      let n = 1;
      this._versionNumber >= 500 && (this.data.readByte(), (n = 2));
      for (let s = 0; s < n; s++) this.readVoice(e, r);
    }
    readVoice(e, r) {
      let i = B.readInt32LE(this.data);
      if (i === 0) return;
      let n = new ze();
      r.addVoice(n);
      for (let s = 0; s < i; s++) this.readBeat(e, r, n);
    }
    readBeat(e, r, i) {
      let n = new Me(),
        s = this.data.readByte();
      if (((s & 1) !== 0 && (n.dots = 1), (s & 64) !== 0)) {
        let c = this.data.readByte();
        n.isEmpty = (c & 2) === 0;
      }
      switch ((i.addBeat(n), B.readSInt8(this.data))) {
        case -2:
          n.duration = 1;
          break;
        case -1:
          n.duration = 2;
          break;
        case 0:
          n.duration = 4;
          break;
        case 1:
          n.duration = 8;
          break;
        case 2:
          n.duration = 16;
          break;
        case 3:
          n.duration = 32;
          break;
        case 4:
          n.duration = 64;
          break;
        default:
          n.duration = 4;
          break;
      }
      if ((s & 32) !== 0)
        switch (
          ((n.tupletNumerator = B.readInt32LE(this.data)), n.tupletNumerator)
        ) {
          case 1:
            n.tupletDenominator = 1;
            break;
          case 3:
            n.tupletDenominator = 2;
            break;
          case 5:
          case 6:
          case 7:
            n.tupletDenominator = 4;
            break;
          case 9:
          case 10:
          case 11:
          case 12:
          case 13:
            n.tupletDenominator = 8;
            break;
          case 2:
          case 4:
          case 8:
            break;
          default:
            (n.tupletNumerator = 1), (n.tupletDenominator = 1);
            break;
        }
      (s & 2) !== 0 && this.readChord(n);
      let o =
        this.settings.importer.beatTextAsLyrics &&
        e.index !== this._lyricsTrack;
      if ((s & 4) !== 0) {
        let c = pe.gpReadStringIntUnused(
          this.data,
          this.settings.importer.encoding
        );
        if (o) {
          let d = new Rr();
          (d.text = c.trim()), d.finish(!0);
          let h = [];
          for (let f = d.chunks.length - 1; f >= 0; f--) h.push(d.chunks[f]);
          this._beatTextChunksByTrack.set(e.index, h);
        } else n.text = c;
      }
      let l = 0;
      (s & 8) !== 0 && (l = this.readBeatEffects(n)),
        (s & 16) !== 0 && this.readMixTableChange(n);
      let u = this.data.readByte();
      for (let c = 6; c >= 0; c--)
        if ((u & (1 << c)) !== 0 && 6 - c < r.staff.tuning.length) {
          let d = this.readNote(e, r, i, n, 6 - c);
          l !== 0 &&
            ((d.harmonicType = l),
            d.harmonicType === 1 &&
              (d.harmonicValue = A.deltaFretToHarmonicValue(d.fret)));
        }
      if (this._versionNumber >= 500) {
        let c = B.readInt16LE(this.data);
        if (
          ((c & 1) !== 0 &&
            n.index > 0 &&
            (i.beats[n.index - 1].beamingMode = 1),
          (c & 2) !== 0 && (n.preferredBeamDirection = 1),
          (c & 4) !== 0 &&
            n.index > 0 &&
            (i.beats[n.index - 1].beamingMode = 2),
          (c & 8) !== 0 && (n.preferredBeamDirection = 0),
          (c & 16) !== 0 && (n.ottava = 1),
          (c & 32) !== 0 && (n.ottava = 3),
          (c & 64) !== 0 && (n.ottava = 0),
          (c & 256) !== 0 && (n.ottava = 4),
          (c & 2048) !== 0)
        ) {
          let d = this.data.readByte() !== 0;
          n.index > 0 && d && (i.beats[n.index - 1].beamingMode = 3);
        }
      }
      o &&
        !n.isRest &&
        this._beatTextChunksByTrack.has(e.index) &&
        this._beatTextChunksByTrack.get(e.index).length > 0 &&
        (n.lyrics = [this._beatTextChunksByTrack.get(e.index).pop()]);
    }
    readChord(e) {
      let r = new Bt(),
        i = A.newGuid();
      if (this._versionNumber >= 500) {
        this.data.skip(17),
          (r.name = pe.gpReadStringByteLength(
            this.data,
            21,
            this.settings.importer.encoding
          )),
          this.data.skip(4),
          (r.firstFret = B.readInt32LE(this.data));
        for (let a = 0; a < 7; a++) {
          let o = B.readInt32LE(this.data);
          a < e.voice.bar.staff.tuning.length && r.strings.push(o);
        }
        let n = this.data.readByte(),
          s = new Uint8Array(5);
        this.data.read(s, 0, s.length);
        for (let a = 0; a < n; a++) r.barreFrets.push(s[a]);
        this.data.skip(26);
      } else if (this.data.readByte() !== 0)
        if (this._versionNumber >= 400) {
          this.data.skip(16),
            (r.name = pe.gpReadStringByteLength(
              this.data,
              21,
              this.settings.importer.encoding
            )),
            this.data.skip(4),
            (r.firstFret = B.readInt32LE(this.data));
          for (let a = 0; a < 7; a++) {
            let o = B.readInt32LE(this.data);
            a < e.voice.bar.staff.tuning.length && r.strings.push(o);
          }
          let n = this.data.readByte(),
            s = new Uint8Array(5);
          this.data.read(s, 0, s.length);
          for (let a = 0; a < n; a++) r.barreFrets.push(s[a]);
          this.data.skip(26);
        } else {
          this.data.skip(25),
            (r.name = pe.gpReadStringByteLength(
              this.data,
              34,
              this.settings.importer.encoding
            )),
            (r.firstFret = B.readInt32LE(this.data));
          for (let n = 0; n < 6; n++) {
            let s = B.readInt32LE(this.data);
            n < e.voice.bar.staff.tuning.length && r.strings.push(s);
          }
          this.data.skip(36);
        }
      else {
        let n = this._versionNumber >= 406 ? 7 : 6;
        if (
          ((r.name = pe.gpReadStringIntByte(
            this.data,
            this.settings.importer.encoding
          )),
          (r.firstFret = B.readInt32LE(this.data)),
          r.firstFret > 0)
        )
          for (let s = 0; s < n; s++) {
            let a = B.readInt32LE(this.data);
            s < e.voice.bar.staff.tuning.length && r.strings.push(a);
          }
      }
      r.name && ((e.chordId = i), e.voice.bar.staff.addChord(e.chordId, r));
    }
    readBeatEffects(e) {
      let r = this.data.readByte(),
        i = 0;
      if (
        (this._versionNumber >= 400 && (i = this.data.readByte()),
        (r & 16) !== 0 && (e.fade = 1),
        ((this._versionNumber < 400 && (r & 1) !== 0) || (r & 2) !== 0) &&
          (e.vibrato = 1),
        (i & 1) !== 0 && (e.rasgueado = 1),
        (r & 32) !== 0 && this._versionNumber >= 400)
      )
        switch (B.readSInt8(this.data)) {
          case 1:
            e.tap = !0;
            break;
          case 2:
            e.slap = !0;
            break;
          case 3:
            e.pop = !0;
            break;
        }
      else if ((r & 32) !== 0) {
        switch (B.readSInt8(this.data)) {
          case 1:
            e.tap = !0;
            break;
          case 2:
            e.slap = !0;
            break;
          case 3:
            e.pop = !0;
            break;
        }
        this.data.skip(4);
      }
      if (((i & 4) !== 0 && this.readTremoloBarEffect(e), (r & 64) !== 0)) {
        let n = 0,
          s = 0;
        this._versionNumber < 500
          ? ((s = this.data.readByte()), (n = this.data.readByte()))
          : ((n = this.data.readByte()), (s = this.data.readByte())),
          n > 0
            ? ((e.brushType = 1), (e.brushDuration = Pi._toStrokeValue(n)))
            : s > 0 &&
              ((e.brushType = 2), (e.brushDuration = Pi._toStrokeValue(s)));
      }
      if ((i & 2) !== 0)
        switch (B.readSInt8(this.data)) {
          case 0:
            e.pickStroke = 0;
            break;
          case 1:
            e.pickStroke = 1;
            break;
          case 2:
            e.pickStroke = 2;
            break;
        }
      if (this._versionNumber < 400) {
        if ((r & 4) !== 0) return 1;
        if ((r & 8) !== 0) return 2;
      }
      return 0;
    }
    readTremoloBarEffect(e) {
      this.data.readByte(), B.readInt32LE(this.data);
      let r = B.readInt32LE(this.data);
      if (r > 0)
        for (let i = 0; i < r; i++) {
          let n = new I(0, 0);
          (n.offset = B.readInt32LE(this.data)),
            (n.value = (B.readInt32LE(this.data) / Pi._bendStep) | 0),
            pe.gpReadBool(this.data),
            e.addWhammyBarPoint(n);
        }
    }
    static _toStrokeValue(e) {
      switch (e) {
        case 1:
          return 30;
        case 2:
          return 30;
        case 3:
          return 60;
        case 4:
          return 120;
        case 5:
          return 240;
        case 6:
          return 480;
        default:
          return 0;
      }
    }
    _readRseBank() {
      this.data.skip(4),
        this.data.skip(4),
        this.data.skip(4),
        this.data.skip(4);
    }
    readMixTableChange(e) {
      let r = new Np();
      (r.instrument = B.readSInt8(this.data)),
        this._versionNumber >= 500 && this._readRseBank(),
        (r.volume = B.readSInt8(this.data)),
        (r.balance = B.readSInt8(this.data));
      let i = B.readSInt8(this.data),
        n = B.readSInt8(this.data),
        s = B.readSInt8(this.data),
        a = B.readSInt8(this.data);
      if (
        (this._versionNumber >= 500 &&
          (r.tempoName = pe.gpReadStringIntByte(
            this.data,
            this.settings.importer.encoding
          )),
        (r.tempo = B.readInt32LE(this.data)),
        r.volume >= 0 && this.data.readByte(),
        r.balance >= 0 && this.data.readByte(),
        i >= 0 && this.data.readByte(),
        n >= 0 && this.data.readByte(),
        s >= 0 && this.data.readByte(),
        a >= 0 && this.data.readByte(),
        r.tempo >= 0 &&
          ((r.duration = B.readSInt8(this.data)),
          this._versionNumber >= 510 && this.data.readByte()),
        this._versionNumber >= 400 && this.data.readByte(),
        this._versionNumber >= 500)
      ) {
        let o = B.readSInt8(this.data);
        o >= 100 ? (e.wahPedal = 2) : o >= 0 && (e.wahPedal = 1);
      }
      if (
        (this._versionNumber >= 510 &&
          (pe.gpReadStringIntByte(this.data, this.settings.importer.encoding),
          pe.gpReadStringIntByte(this.data, this.settings.importer.encoding)),
        r.volume >= 0)
      ) {
        let o = new he();
        (o.isLinear = !0),
          (o.type = 1),
          (o.value = r.volume),
          e.automations.push(o);
      }
      if (r.balance >= 0) {
        let o = new he();
        (o.isLinear = !0),
          (o.type = 3),
          (o.value = r.balance),
          e.automations.push(o);
      }
      if (r.instrument >= 0) {
        let o = new he();
        (o.isLinear = !0),
          (o.type = 2),
          (o.value = r.instrument),
          e.automations.push(o);
      }
      if (r.tempo >= 0) {
        let o = new he();
        (o.isLinear = !0),
          (o.type = 0),
          (o.value = r.tempo),
          e.automations.push(o),
          e.voice.bar.masterBar.tempoAutomations.some(
            (l) => l.ratioPosition === o.ratioPosition && l.value === o.value
          ) || e.voice.bar.masterBar.tempoAutomations.push(o);
      }
    }
    readNote(e, r, i, n, s) {
      let a = new Xe();
      a.string = r.staff.tuning.length - s;
      let o = this.data.readByte();
      if (
        ((o & 2) !== 0
          ? (a.accentuated = 2)
          : (o & 64) !== 0 && (a.accentuated = 1),
        (a.isGhost = (o & 4) !== 0),
        (o & 32) !== 0)
      ) {
        let u = this.data.readByte();
        u === 3 ? (a.isDead = !0) : u === 2 && (a.isTieDestination = !0);
      }
      if (
        ((o & 1) !== 0 &&
          this._versionNumber < 500 &&
          (this.data.readByte(), this.data.readByte()),
        (o & 16) !== 0)
      ) {
        let u = B.readSInt8(this.data);
        (a.dynamics = this.toDynamicValue(u)), (n.dynamics = a.dynamics);
      }
      (o & 32) !== 0 && (a.fret = B.readSInt8(this.data)),
        (o & 128) !== 0 &&
          ((a.leftHandFinger = B.readSInt8(this.data)),
          (a.rightHandFinger = B.readSInt8(this.data)));
      let l = !1;
      if (
        (this._versionNumber >= 500 &&
          ((o & 1) !== 0 && (a.durationPercent = B.readFloat64BE(this.data)),
          (l = (this.data.readByte() & 2) !== 0)),
        n.addNote(a),
        (o & 8) !== 0 && this.readNoteEffects(e, i, n, a),
        r.staff.isPercussion &&
          ((a.percussionArticulation = a.fret), (a.string = -1), (a.fret = -1)),
        l)
      ) {
        let u = A.computeAccidental(
          r.keySignature,
          0,
          a.realValueWithoutHarmonic,
          !1
        );
        u === 2 ? (a.accidentalMode = 5) : u === 3 && (a.accidentalMode = 3);
      }
      return a;
    }
    toDynamicValue(e) {
      switch (e) {
        case 1:
          return 0;
        case 2:
          return 1;
        case 3:
          return 2;
        case 4:
          return 3;
        case 5:
          return 4;
        case 6:
          return 5;
        case 7:
          return 6;
        case 8:
          return 7;
        default:
          return 5;
      }
    }
    readNoteEffects(e, r, i, n) {
      let s = this.data.readByte(),
        a = 0;
      this._versionNumber >= 400 && (a = this.data.readByte()),
        (s & 1) !== 0 && this.readBend(n),
        (s & 16) !== 0 && this.readGrace(r, n),
        (a & 4) !== 0 && this.readTremoloPicking(i),
        (a & 8) !== 0
          ? this.readSlide(n)
          : this._versionNumber < 400 && (s & 4) !== 0 && (n.slideOutType = 1),
        (a & 16) !== 0 && this.readArtificialHarmonic(n),
        (a & 32) !== 0 && this.readTrill(n),
        (n.isLetRing = (s & 8) !== 0),
        (n.isHammerPullOrigin = (s & 2) !== 0),
        (a & 64) !== 0 && (n.vibrato = 1),
        (n.isPalmMute = (a & 2) !== 0),
        (n.isStaccato = (a & 1) !== 0);
    }
    readBend(e) {
      this.data.readByte(), B.readInt32LE(this.data);
      let r = B.readInt32LE(this.data);
      if (r > 0)
        for (let i = 0; i < r; i++) {
          let n = new I(0, 0);
          (n.offset = B.readInt32LE(this.data)),
            (n.value = (B.readInt32LE(this.data) / Pi._bendStep) | 0),
            pe.gpReadBool(this.data),
            e.addBendPoint(n);
        }
    }
    readGrace(e, r) {
      let i = new Me(),
        n = new Xe();
      switch (
        ((n.string = r.string),
        (n.fret = B.readSInt8(this.data)),
        (i.duration = 32),
        (i.dynamics = this.toDynamicValue(B.readSInt8(this.data))),
        B.readSInt8(this.data))
      ) {
        case 0:
          break;
        case 1:
          (n.slideOutType = 2), (n.slideTarget = r);
          break;
        case 2:
          break;
        case 3:
          n.isHammerPullOrigin = !0;
          break;
      }
      if (
        ((n.dynamics = i.dynamics),
        this.data.skip(1),
        this._versionNumber < 500)
      )
        i.graceType = 2;
      else {
        let a = this.data.readByte();
        (n.isDead = (a & 1) !== 0), (i.graceType = (a & 2) !== 0 ? 1 : 2);
      }
      e.addGraceBeat(i), i.addNote(n);
    }
    readTremoloPicking(e) {
      switch (this.data.readByte()) {
        case 1:
          e.tremoloSpeed = 8;
          break;
        case 2:
          e.tremoloSpeed = 16;
          break;
        case 3:
          e.tremoloSpeed = 32;
          break;
      }
    }
    readSlide(e) {
      if (this._versionNumber >= 500) {
        let r = B.readSInt8(this.data);
        (r & 1) !== 0
          ? (e.slideOutType = 1)
          : (r & 2) !== 0
          ? (e.slideOutType = 2)
          : (r & 4) !== 0
          ? (e.slideOutType = 4)
          : (r & 8) !== 0 && (e.slideOutType = 3),
          (r & 16) !== 0
            ? (e.slideInType = 1)
            : (r & 32) !== 0 && (e.slideInType = 2);
      } else
        switch (B.readSInt8(this.data)) {
          case 1:
            e.slideOutType = 1;
            break;
          case 2:
            e.slideOutType = 2;
            break;
          case 3:
            e.slideOutType = 4;
            break;
          case 4:
            e.slideOutType = 3;
            break;
          case -1:
            e.slideInType = 1;
            break;
          case -2:
            e.slideInType = 2;
            break;
        }
    }
    readArtificialHarmonic(e) {
      let r = this.data.readByte();
      if (this._versionNumber >= 500)
        switch (r) {
          case 1:
            (e.harmonicType = 1),
              (e.harmonicValue = A.deltaFretToHarmonicValue(e.fret));
            break;
          case 2:
            this.data.readByte(),
              this.data.readByte(),
              this.data.readByte(),
              (e.harmonicType = 2);
            break;
          case 3:
            (e.harmonicType = 4),
              (e.harmonicValue = A.deltaFretToHarmonicValue(
                this.data.readByte()
              ));
            break;
          case 4:
            (e.harmonicType = 3), (e.harmonicValue = 12);
            break;
          case 5:
            (e.harmonicType = 5), (e.harmonicValue = 12);
            break;
        }
      else if (this._versionNumber >= 400)
        switch (r) {
          case 1:
            e.harmonicType = 1;
            break;
          case 3:
            e.harmonicType = 4;
            break;
          case 4:
            e.harmonicType = 3;
            break;
          case 5:
            e.harmonicType = 5;
            break;
          case 15:
            e.harmonicType = 2;
            break;
          case 17:
            e.harmonicType = 2;
            break;
          case 22:
            e.harmonicType = 2;
            break;
        }
    }
    readTrill(e) {
      switch (
        ((e.trillValue = this.data.readByte() + e.stringTuning),
        this.data.readByte())
      ) {
        case 1:
          e.trillSpeed = 16;
          break;
        case 2:
          e.trillSpeed = 32;
          break;
        case 3:
          e.trillSpeed = 64;
          break;
      }
    }
  };
  (Pi._versionString = "FICHIER GUITAR PRO "), (Pi._bendStep = 25);
  var du = Pi,
    pe = class p {
      static gpReadColor(t, e = !1) {
        let r = t.readByte(),
          i = t.readByte(),
          n = t.readByte(),
          s = 255;
        return e ? (s = t.readByte()) : t.skip(1), new ae(r, i, n, s);
      }
      static gpReadBool(t) {
        return t.readByte() !== 0;
      }
      static gpReadStringIntUnused(t, e) {
        return t.skip(4), p.gpReadString(t, t.readByte(), e);
      }
      static gpReadStringInt(t, e) {
        return p.gpReadString(t, B.readInt32LE(t), e);
      }
      static gpReadStringIntByte(t, e) {
        let r = B.readInt32LE(t) - 1;
        return t.readByte(), p.gpReadString(t, r, e);
      }
      static gpReadString(t, e, r) {
        let i = new Uint8Array(e);
        return t.read(i, 0, i.length), B.toString(i, r);
      }
      static gpWriteString(t, e) {
        let r = B.stringToBytes(e);
        t.writeByte(e.length), t.write(r, 0, r.length);
      }
      static gpReadStringByteLength(t, e, r) {
        let i = t.readByte(),
          n = p.gpReadString(t, i, r);
        return i < e && t.skip(e - i), n;
      }
    },
    Np = class {
      constructor() {
        this.volume = -1;
        this.balance = -1;
        this.instrument = -1;
        this.tempoName = "";
        this.tempo = -1;
        this.duration = -1;
      }
    };
  var kn = class p {
    constructor(t) {
      this._types = new Map();
      this.raw = new Map();
      t && this._read(t);
    }
    _read(t) {
      let e = Se.fromBuffer(t),
        r = B.readInt32BE(e);
      for (let i = 0; i < r; i++) {
        let n = pe.gpReadString(e, e.readByte(), "utf-8"),
          s = e.readByte();
        switch ((this._types.set(n, s), s)) {
          case 0:
            let a = e.readByte() === 1;
            this.addValue(n, a);
            break;
          case 1:
            let o = B.readInt32BE(e);
            this.addValue(n, o);
            break;
          case 2:
            let l = B.readFloat32BE(e);
            this.addValue(n, l);
            break;
          case 3:
            let u = pe.gpReadString(e, B.readInt16BE(e), "utf-8");
            this.addValue(n, u);
            break;
          case 4:
            let c = B.readInt32BE(e),
              d = B.readInt32BE(e);
            this.addValue(n, new I(c, d));
            break;
          case 5:
            let h = B.readInt32BE(e),
              f = B.readInt32BE(e);
            this.addValue(n, new I(h, f));
            break;
          case 6:
            let b = new we();
            (b.x = B.readInt32BE(e)),
              (b.y = B.readInt32BE(e)),
              (b.w = B.readInt32BE(e)),
              (b.h = B.readInt32BE(e)),
              this.addValue(n, b);
            break;
          case 7:
            let y = pe.gpReadColor(e, !0);
            this.addValue(n, y);
            break;
        }
      }
    }
    apply(t) {
      for (let [e, r] of this.raw)
        switch (e) {
          case "StandardNotation/hideDynamics":
            t.stylesheet.hideDynamics = r;
            break;
          case "System/bracketExtendMode":
            t.stylesheet.bracketExtendMode = r;
            break;
          case "Global/useSystemSignSeparator":
            t.stylesheet.useSystemSignSeparator = r;
            break;
          case "Global/DisplayTuning":
            t.stylesheet.globalDisplayTuning = r;
            break;
          case "Global/DrawChords":
            t.stylesheet.globalDisplayChordDiagramsOnTop = r;
            break;
          case "System/showTrackNameSingle":
            r || (t.stylesheet.singleTrackTrackNamePolicy = 0);
            break;
          case "System/showTrackNameMulti":
            r || (t.stylesheet.multiTrackTrackNamePolicy = 0);
            break;
          case "System/trackNameModeSingle":
            if (t.stylesheet.singleTrackTrackNamePolicy !== 0)
              switch (r) {
                case 0:
                  t.stylesheet.singleTrackTrackNamePolicy = 1;
                  break;
                case 1:
                  t.stylesheet.singleTrackTrackNamePolicy = 1;
                  break;
                case 2:
                  t.stylesheet.singleTrackTrackNamePolicy = 2;
                  break;
              }
            break;
          case "System/trackNameModeMulti":
            if (t.stylesheet.multiTrackTrackNamePolicy !== 0)
              switch (r) {
                case 0:
                  t.stylesheet.multiTrackTrackNamePolicy = 1;
                  break;
                case 1:
                  t.stylesheet.multiTrackTrackNamePolicy = 1;
                  break;
                case 2:
                  t.stylesheet.multiTrackTrackNamePolicy = 2;
                  break;
              }
            break;
          case "System/shortTrackNameOnFirstSystem":
            r
              ? (t.stylesheet.firstSystemTrackNameMode = 1)
              : (t.stylesheet.firstSystemTrackNameMode = 0);
            break;
          case "System/shortTrackNameOnOtherSystems":
            r
              ? (t.stylesheet.otherSystemsTrackNameMode = 1)
              : (t.stylesheet.otherSystemsTrackNameMode = 0);
            break;
          case "System/horizontalTrackNameOnFirstSystem":
            r
              ? (t.stylesheet.firstSystemTrackNameOrientation = 0)
              : (t.stylesheet.firstSystemTrackNameOrientation = 1);
            break;
          case "System/horizontalTrackNameOnOtherSystems":
            r
              ? (t.stylesheet.otherSystemsTrackNameOrientation = 0)
              : (t.stylesheet.otherSystemsTrackNameOrientation = 1);
            break;
          case "Header/Title":
            A.getOrCreateHeaderFooterStyle(t, 0).template = r;
            break;
          case "Header/TitleAlignment":
            A.getOrCreateHeaderFooterStyle(t, 0).textAlign =
              this._toTextAlign(r);
            break;
          case "Header/drawTitle":
            A.getOrCreateHeaderFooterStyle(t, 0).isVisible = r;
            break;
          case "Header/Subtitle":
            A.getOrCreateHeaderFooterStyle(t, 1).template = r;
            break;
          case "Header/SubtitleAlignment":
            A.getOrCreateHeaderFooterStyle(t, 1).textAlign =
              this._toTextAlign(r);
            break;
          case "Header/drawSubtitle":
            A.getOrCreateHeaderFooterStyle(t, 1).isVisible = r;
            break;
          case "Header/Artist":
            A.getOrCreateHeaderFooterStyle(t, 2).template = r;
            break;
          case "Header/ArtistAlignment":
            A.getOrCreateHeaderFooterStyle(t, 2).textAlign =
              this._toTextAlign(r);
            break;
          case "Header/drawArtist":
            A.getOrCreateHeaderFooterStyle(t, 2).isVisible = r;
            break;
          case "Header/Album":
            A.getOrCreateHeaderFooterStyle(t, 3).template = r;
            break;
          case "Header/AlbumAlignment":
            A.getOrCreateHeaderFooterStyle(t, 3).textAlign =
              this._toTextAlign(r);
            break;
          case "Header/drawAlbum":
            A.getOrCreateHeaderFooterStyle(t, 3).isVisible = r;
            break;
          case "Header/Words":
            A.getOrCreateHeaderFooterStyle(t, 4).template = r;
            break;
          case "Header/WordsAlignment":
            A.getOrCreateHeaderFooterStyle(t, 4).textAlign =
              this._toTextAlign(r);
            break;
          case "Header/drawWords":
            A.getOrCreateHeaderFooterStyle(t, 4).isVisible = r;
            break;
          case "Header/Music":
            A.getOrCreateHeaderFooterStyle(t, 5).template = r;
            break;
          case "Header/MusicAlignment":
            A.getOrCreateHeaderFooterStyle(t, 5).textAlign =
              this._toTextAlign(r);
            break;
          case "Header/drawMusic":
            A.getOrCreateHeaderFooterStyle(t, 5).isVisible = r;
            break;
          case "Header/WordsAndMusic":
            A.getOrCreateHeaderFooterStyle(t, 6).template = r;
            break;
          case "Header/WordsAndMusicAlignment":
            A.getOrCreateHeaderFooterStyle(t, 6).textAlign =
              this._toTextAlign(r);
            break;
          case "Header/drawWordsAndMusic":
            A.getOrCreateHeaderFooterStyle(t, 6).isVisible = r;
            break;
          case "Header/Tabber":
            A.getOrCreateHeaderFooterStyle(t, 7).template = r;
            break;
          case "Header/TabberAlignment":
            A.getOrCreateHeaderFooterStyle(t, 7).textAlign =
              this._toTextAlign(r);
            break;
          case "Header/drawTabber":
            A.getOrCreateHeaderFooterStyle(t, 7).isVisible = r;
            break;
          case "Footer/Copyright":
            A.getOrCreateHeaderFooterStyle(t, 8).template = r;
            break;
          case "Footer/CopyrightAlignment":
            A.getOrCreateHeaderFooterStyle(t, 8).textAlign =
              this._toTextAlign(r);
            break;
          case "Footer/drawCopyright":
            A.getOrCreateHeaderFooterStyle(t, 8).isVisible = r;
            break;
          case "Footer/Copyright2":
            A.getOrCreateHeaderFooterStyle(t, 9).template = r;
            break;
          case "Footer/Copyright2Alignment":
            A.getOrCreateHeaderFooterStyle(t, 9).textAlign =
              this._toTextAlign(r);
            break;
          case "Footer/drawCopyright2":
            A.getOrCreateHeaderFooterStyle(t, 9).isVisible = r;
            break;
        }
    }
    _toTextAlign(t) {
      switch (t) {
        case 0:
          return 0;
        case 1:
          return 1;
        case 2:
          return 2;
      }
      return 0;
    }
    addValue(t, e, r) {
      this.raw.set(t, e), r !== void 0 && this._types.set(t, r);
    }
    writeTo(t) {
      B.writeInt32BE(t, this.raw.size);
      for (let [e, r] of this.raw) {
        let i = this._getDataType(e, r);
        switch ((pe.gpWriteString(t, e), t.writeByte(i), i)) {
          case 0:
            t.writeByte(r ? 1 : 0);
            break;
          case 1:
            B.writeInt32BE(t, r);
            break;
          case 2:
            B.writeFloat32BE(t, r);
            break;
          case 3:
            let n = B.stringToBytes(r);
            B.writeInt16BE(t, n.length), t.write(n, 0, n.length);
            break;
          case 4:
            B.writeInt32BE(t, r.offset), B.writeInt32BE(t, r.value);
            break;
          case 5:
            B.writeInt32BE(t, r.offset), B.writeInt32BE(t, r.value);
            break;
          case 6:
            B.writeInt32BE(t, r.x),
              B.writeInt32BE(t, r.y),
              B.writeInt32BE(t, r.w),
              B.writeInt32BE(t, r.h);
            break;
          case 7:
            t.writeByte(r.r),
              t.writeByte(r.g),
              t.writeByte(r.b),
              t.writeByte(r.a);
            break;
        }
      }
    }
    _getDataType(t, e) {
      if (this._types.has(t)) return this._types.get(t);
      let r = typeof e;
      switch (typeof e) {
        case "string":
          return 3;
        case "number":
          let i = e | 0;
          return e === i ? 1 : 2;
        case "object":
          if (e instanceof I) return 4;
          if (e instanceof we) return 6;
          if (e instanceof ae) return 7;
          break;
      }
      throw new te(0, `Unknown value type in BinaryStylesheet: ${r}`);
    }
    static writeForScore(t) {
      let e = new p();
      switch (
        (e.addValue(
          "StandardNotation/hideDynamics",
          t.stylesheet.hideDynamics,
          0
        ),
        e.addValue(
          "System/bracketExtendMode",
          t.stylesheet.bracketExtendMode,
          1
        ),
        e.addValue(
          "Global/useSystemSignSeparator",
          t.stylesheet.useSystemSignSeparator,
          0
        ),
        e.addValue("Global/DisplayTuning", t.stylesheet.globalDisplayTuning, 0),
        e.addValue(
          "Global/DrawChords",
          t.stylesheet.globalDisplayChordDiagramsOnTop,
          0
        ),
        t.stylesheet.singleTrackTrackNamePolicy)
      ) {
        case 0:
          e.addValue("System/showTrackNameSingle", !1, 0);
          break;
        case 1:
          e.addValue("System/trackNameModeSingle", 0, 1);
          break;
        case 2:
          e.addValue("System/trackNameModeSingle", 2, 1);
          break;
      }
      switch (t.stylesheet.multiTrackTrackNamePolicy) {
        case 0:
          e.addValue("System/showTrackNameMulti", !1, 0);
          break;
        case 1:
          e.addValue("System/trackNameModeMulti", 0, 1);
          break;
        case 2:
          e.addValue("System/trackNameModeMulti", 2, 1);
          break;
      }
      switch (t.stylesheet.firstSystemTrackNameMode) {
        case 0:
          e.addValue("System/shortTrackNameOnFirstSystem", !1, 0);
          break;
        case 1:
          e.addValue("System/shortTrackNameOnFirstSystem", !0, 0);
          break;
      }
      switch (t.stylesheet.otherSystemsTrackNameMode) {
        case 0:
          e.addValue("System/shortTrackNameOnOtherSystems", !1, 0);
          break;
        case 1:
          e.addValue("System/shortTrackNameOnOtherSystems", !0, 0);
          break;
      }
      switch (t.stylesheet.firstSystemTrackNameOrientation) {
        case 0:
          e.addValue("System/horizontalTrackNameOnFirstSystem", !0, 0);
          break;
        case 1:
          e.addValue("System/horizontalTrackNameOnFirstSystem", !1, 0);
          break;
      }
      switch (t.stylesheet.otherSystemsTrackNameOrientation) {
        case 0:
          e.addValue("System/horizontalTrackNameOnOtherSystems", !0, 0);
          break;
        case 1:
          e.addValue("System/horizontalTrackNameOnOtherSystems", !1, 0);
          break;
      }
      let r = t.style;
      if (r)
        for (let [n, s] of r.headerAndFooter)
          switch (n) {
            case 0:
              p._addHeaderAndFooter(e, s, "Header/", "Title");
              break;
            case 1:
              p._addHeaderAndFooter(e, s, "Header/", "Subtitle");
              break;
            case 2:
              p._addHeaderAndFooter(e, s, "Header/", "Artist");
              break;
            case 3:
              p._addHeaderAndFooter(e, s, "Header/", "Album");
              break;
            case 4:
              p._addHeaderAndFooter(e, s, "Header/", "Words");
              break;
            case 5:
              p._addHeaderAndFooter(e, s, "Header/", "Music");
              break;
            case 6:
              p._addHeaderAndFooter(e, s, "Header/", "WordsAndMusic");
              break;
            case 7:
              p._addHeaderAndFooter(e, s, "Header/", "Tabber");
              break;
            case 8:
              p._addHeaderAndFooter(e, s, "Footer/", "Copyright");
              break;
            case 9:
              p._addHeaderAndFooter(e, s, "Footer/", "Copyright2");
              break;
          }
      let i = Se.withCapacity(128);
      return e.writeTo(i), i.toArray();
    }
    static _addHeaderAndFooter(t, e, r, i) {
      t.addValue(`${r}${i}`, e.template, 3),
        t.addValue(`${r}${i}Alignment`, e.textAlign, 1),
        e.isVisible !== void 0 && t.addValue(`${r}draw${i}`, e.isVisible, 0);
    }
  };
  var vn = class {};
  var Ep = class {
      constructor() {
        this.id = "";
        this.dots = 0;
        this.tupletDenominator = -1;
        this.tupletNumerator = -1;
        this.value = 4;
      }
    },
    Pp = class {
      constructor() {
        this.name = "";
        this.path = "";
        this.role = "";
        this.program = 0;
        this.bank = 0;
      }
      get uniqueId() {
        return `${this.path};${this.name};${this.role}`;
      }
    },
    F = class F {
      constructor() {
        this._hasAnacrusis = !1;
        this._skipApplyLyrics = !1;
        this._backingTrackPadding = 0;
        this._doubleBars = new Set();
        this._keySignatures = new Map();
        this._transposeKeySignaturePerTrack = new Map();
      }
      parseXml(t, e) {
        (this._masterTrackAutomations = new Map()),
          (this._automationsPerTrackIdAndBarIndex = new Map()),
          (this._sustainPedalsPerTrackIdAndBarIndex = new Map()),
          (this._tracksMapping = []),
          (this._tracksById = new Map()),
          (this._masterBars = []),
          (this._barsOfMasterBar = []),
          (this._voicesOfBar = new Map()),
          (this._barsById = new Map()),
          (this._voiceById = new Map()),
          (this._beatsOfVoice = new Map()),
          (this._beatById = new Map()),
          (this._rhythmOfBeat = new Map()),
          (this._rhythmById = new Map()),
          (this._notesOfBeat = new Map()),
          (this._noteById = new Map()),
          (this._tappedNotes = new Map()),
          (this._lyricsByTrack = new Map()),
          (this._soundsByTrack = new Map()),
          (this._skipApplyLyrics = !1);
        let r = new pi();
        try {
          r.parse(t);
        } catch (i) {
          throw new ke("Could not parse XML", i);
        }
        if (
          (this._parseDom(r),
          this._buildModel(),
          A.consolidate(this.score),
          this.score.finish(e),
          !this._skipApplyLyrics && this._lyricsByTrack.size > 0)
        )
          for (let [i, n] of this._lyricsByTrack)
            this._tracksById.get(i).applyLyrics(n);
      }
      _parseDom(t) {
        let e = t.firstElement;
        if (e)
          if (e.localName === "GPIF") {
            this.score = new tt();
            for (let r of e.childElements())
              switch (r.localName) {
                case "Score":
                  this._parseScoreNode(r);
                  break;
                case "MasterTrack":
                  this._parseMasterTrackNode(r);
                  break;
                case "BackingTrack":
                  this._parseBackingTrackNode(r);
                  break;
                case "Tracks":
                  this._parseTracksNode(r);
                  break;
                case "MasterBars":
                  this._parseMasterBarsNode(r);
                  break;
                case "Bars":
                  this._parseBars(r);
                  break;
                case "Voices":
                  this._parseVoices(r);
                  break;
                case "Beats":
                  this._parseBeats(r);
                  break;
                case "Notes":
                  this._parseNotes(r);
                  break;
                case "Rhythms":
                  this._parseRhythms(r);
                  break;
                case "Assets":
                  this._parseAssets(r);
                  break;
              }
          } else throw new ke("Root node of XML was not GPIF");
      }
      _parseAssets(t) {
        for (let e of t.childElements())
          e.localName === "Asset" &&
            e.getAttribute("id") === this._backingTrackAssetId &&
            this._parseBackingTrackAsset(e);
      }
      _parseBackingTrackAsset(t) {
        let e = "";
        for (let i of t.childElements())
          i.localName === "EmbeddedFilePath" && (e = i.innerText);
        let r = this.loadAsset;
        if (r) {
          let i = r(e);
          i
            ? (this.score.backingTrack.rawAudioFile = i)
            : (this.score.backingTrack = void 0);
        }
      }
      _parseScoreNode(t) {
        for (let e of t.childElements())
          switch (e.localName) {
            case "Title":
              this.score.title = e.innerText;
              break;
            case "SubTitle":
              this.score.subTitle = e.innerText;
              break;
            case "Artist":
              this.score.artist = e.innerText;
              break;
            case "Album":
              this.score.album = e.innerText;
              break;
            case "Words":
              this.score.words = e.innerText;
              break;
            case "Music":
              this.score.music = e.innerText;
              break;
            case "WordsAndMusic":
              let r = e.innerText;
              r !== "" &&
                (r && !this.score.words && (this.score.words = r),
                r && !this.score.music && (this.score.music = r));
              break;
            case "Copyright":
              this.score.copyright = e.innerText;
              break;
            case "Tabber":
              this.score.tab = e.innerText;
              break;
            case "Instructions":
              this.score.instructions = e.innerText;
              break;
            case "Notices":
              this.score.notices = e.innerText;
              break;
            case "ScoreSystemsDefaultLayout":
              this.score.defaultSystemsLayout = F._parseIntSafe(e.innerText, 4);
              break;
            case "ScoreSystemsLayout":
              this.score.systemsLayout = F._splitSafe(e.innerText).map((i) =>
                F._parseIntSafe(i, 4)
              );
              break;
          }
      }
      static _parseIntSafe(t, e) {
        if (!t) return e;
        let r = Number.parseInt(t, 10);
        return Number.isNaN(r) ? e : r;
      }
      static _parseFloatSafe(t, e) {
        if (!t) return e;
        let r = Number.parseFloat(t);
        return Number.isNaN(r) ? e : r;
      }
      static _splitSafe(t, e = " ") {
        return t
          ? t
              .split(e)
              .map((r) => r.trim())
              .filter((r) => r.length > 0)
          : [];
      }
      _parseBackingTrackNode(t) {
        let e = new vn(),
          r = !1,
          i = "",
          n = "";
        for (let s of t.childElements())
          switch (s.localName) {
            case "Enabled":
              r = s.innerText === "true";
              break;
            case "Source":
              i = s.innerText;
              break;
            case "AssetId":
              n = s.innerText;
              break;
            case "FramePadding":
              this._backingTrackPadding =
                (F._parseIntSafe(s.innerText, 0) / F._sampleRate) * 1e3;
              break;
          }
        r &&
          i === "Local" &&
          ((this.score.backingTrack = e), (this._backingTrackAssetId = n));
      }
      _parseMasterTrackNode(t) {
        for (let e of t.childElements())
          switch (e.localName) {
            case "Automations":
              this._parseAutomations(
                e,
                this._masterTrackAutomations,
                null,
                null
              );
              break;
            case "Tracks":
              this._tracksMapping = F._splitSafe(e.innerText);
              break;
            case "Anacrusis":
              this._hasAnacrusis = !0;
              break;
          }
      }
      _parseAutomations(t, e, r, i) {
        for (let n of t.childElements())
          n.localName === "Automation" && this._parseAutomation(n, e, r, i);
      }
      _parseAutomation(t, e, r, i) {
        let n = null,
          s = !1,
          a = -1,
          o = 0,
          l = 0,
          u = null,
          c = 0,
          d = null,
          h,
          f = !0;
        for (let y of t.childElements())
          switch (y.localName) {
            case "Type":
              n = y.innerText;
              break;
            case "Linear":
              s = y.innerText.toLowerCase() === "true";
              break;
            case "Bar":
              a = F._parseIntSafe(y.innerText, 0);
              break;
            case "Position":
              o = F._parseFloatSafe(y.innerText, 0);
              break;
            case "Value":
              if (y.firstElement && y.firstElement.nodeType === 3)
                u = y.innerText;
              else if (
                y.firstElement &&
                y.firstElement.nodeType === 1 &&
                n === "SyncPoint"
              ) {
                h = new Ur();
                for (let S of y.childElements())
                  switch (S.localName) {
                    case "BarIndex":
                      a = F._parseIntSafe(S.innerText, 0);
                      break;
                    case "BarOccurrence":
                      h.barOccurence = F._parseIntSafe(S.innerText, 0);
                      break;
                    case "FrameOffset":
                      let k = F._parseFloatSafe(S.innerText, 0);
                      h.millisecondOffset = (k / F._sampleRate) * 1e3;
                      break;
                  }
              } else {
                let S = F._splitSafe(y.innerText);
                S.length === 1
                  ? ((l = F._parseFloatSafe(S[0], 0)), (c = 1))
                  : ((l = F._parseFloatSafe(S[0], 0)),
                    (c = F._parseIntSafe(S[1], 0)));
              }
              break;
            case "Text":
              d = y.innerText;
              break;
            case "Visible":
              f = y.innerText.toLowerCase() === "true";
              break;
          }
        if (!n) return;
        let b = [];
        switch (n) {
          case "Tempo":
            b.push(he.buildTempoAutomation(s, o, l, c, f));
            break;
          case "SyncPoint":
            let y = new he();
            (y.type = 4),
              (y.isLinear = s),
              (y.ratioPosition = o),
              (y.syncPointValue = h),
              (y.isVisible = f),
              b.push(y);
            break;
          case "Sound":
            if (u && r && r.has(u)) {
              let S = new he();
              (S.type = 4),
                (S.ratioPosition = o),
                (S.value = r.get(u).bank),
                (S.isVisible = f),
                b.push(S);
              let k = he.buildInstrumentAutomation(s, o, r.get(u).program);
              b.push(k);
            }
            break;
          case "SustainPedal":
            if (i) {
              let S;
              i.has(a) ? (S = i.get(a)) : ((S = []), i.set(a, S));
              let k = new Xt();
              switch (((k.ratioPosition = o), c)) {
                case 1:
                  k.pedalType = 0;
                  break;
                case 3:
                  k.pedalType = 2;
                  break;
              }
              S.push(k);
            }
            break;
        }
        if (b.length) {
          if (d) for (let y of b) y.text = d;
          if (a >= 0) {
            e.has(a) || e.set(a, []);
            for (let y of b) e.get(a).push(y);
          }
        }
      }
      _parseTracksNode(t) {
        for (let e of t.childElements())
          e.localName === "Track" && this._parseTrack(e);
      }
      _parseTrack(t) {
        this._articulationByName = new Map();
        let e = new Tt();
        e.ensureStaveCount(1);
        let r = e.staves[0];
        r.showStandardNotation = !0;
        let i = t.getAttribute("id");
        for (let n of t.childElements())
          switch (n.localName) {
            case "Name":
              e.name = n.innerText;
              break;
            case "Color":
              let s = F._splitSafe(n.innerText);
              if (s.length >= 3) {
                let l = F._parseIntSafe(s[0], 0),
                  u = F._parseIntSafe(s[1], 0),
                  c = F._parseIntSafe(s[2], 0);
                e.color = new ae(l, u, c, 255);
              }
              break;
            case "Instrument":
              let a = n.getAttribute("ref");
              (a.endsWith("-gs") || a.endsWith("GrandStaff")) &&
                (e.ensureStaveCount(2),
                (e.staves[1].showStandardNotation = !0));
              break;
            case "InstrumentSet":
              this._parseInstrumentSet(e, n);
              break;
            case "NotationPatch":
              this._parseNotationPatch(e, n);
              break;
            case "ShortName":
              e.shortName = n.innerText;
              break;
            case "SystemsDefautLayout":
              e.defaultSystemsLayout = F._parseIntSafe(n.innerText, 4);
              break;
            case "SystemsLayout":
              e.systemsLayout = F._splitSafe(n.innerText).map((l) =>
                F._parseIntSafe(l, 4)
              );
              break;
            case "Lyrics":
              this._parseLyrics(i, n);
              break;
            case "Properties":
              this._parseTrackProperties(e, n);
              break;
            case "GeneralMidi":
            case "MidiConnection":
            case "MIDISettings":
              this._parseGeneralMidi(e, n);
              break;
            case "Sounds":
              this._parseSounds(i, e, n);
              break;
            case "PlaybackState":
              let o = n.innerText;
              (e.playbackInfo.isSolo = o === "Solo"),
                (e.playbackInfo.isMute = o === "Mute");
              break;
            case "PartSounding":
              this._parsePartSounding(i, e, n);
              break;
            case "Staves":
              this._parseStaves(e, n);
              break;
            case "Transpose":
              this._parseTranspose(i, e, n);
              break;
            case "RSE":
              this._parseRSE(e, n);
              break;
            case "Automations":
              this._parseTrackAutomations(i, n);
              break;
          }
        this._tracksById.set(i, e);
      }
      _parseTrackAutomations(t, e) {
        let r = new Map();
        this._automationsPerTrackIdAndBarIndex.set(t, r);
        let i = new Map();
        this._sustainPedalsPerTrackIdAndBarIndex.set(t, i),
          this._parseAutomations(e, r, this._soundsByTrack.get(t), i);
      }
      _parseNotationPatch(t, e) {
        for (let r of e.childElements())
          switch (r.localName) {
            case "LineCount":
              let i = F._parseIntSafe(r.innerText, 5);
              for (let n of t.staves) n.standardNotationLineCount = i;
              break;
            case "Elements":
              this._parseElements(t, r);
              break;
          }
      }
      _parseInstrumentSet(t, e) {
        for (let r of e.childElements())
          switch (r.localName) {
            case "Type":
              if (r.innerText === "drumKit")
                for (let n of t.staves) n.isPercussion = !0;
              break;
            case "Elements":
              this._parseElements(t, r);
              break;
            case "LineCount":
              let i = F._parseIntSafe(r.innerText, 5);
              for (let n of t.staves) n.standardNotationLineCount = i;
              break;
          }
      }
      _parseElements(t, e) {
        for (let r of e.childElements())
          r.localName === "Element" && this._parseElement(t, r);
      }
      _parseElement(t, e) {
        let r = e.findChildElement("Type")?.innerText ?? "";
        for (let i of e.childElements())
          switch (i.localName) {
            case "Name":
            case "Articulations":
              this._parseArticulations(t, i, r);
              break;
          }
      }
      _parseArticulations(t, e, r) {
        for (let i of e.childElements())
          i.localName === "Articulation" && this._parseArticulation(t, i, r);
      }
      _parseArticulation(t, e, r) {
        let i = new W();
        (i.outputMidiNumber = -1), (i.elementType = r);
        let n = "";
        for (let s of e.childElements()) {
          let a = s.innerText;
          switch (s.localName) {
            case "Name":
              n = s.innerText;
              break;
            case "OutputMidiNumber":
              i.outputMidiNumber = F._parseIntSafe(a, 0);
              break;
            case "TechniqueSymbol":
              i.techniqueSymbol = this._parseTechniqueSymbol(a);
              break;
            case "TechniquePlacement":
              switch (a) {
                case "outside":
                  i.techniqueSymbolPlacement = 3;
                  break;
                case "inside":
                  i.techniqueSymbolPlacement = 1;
                  break;
                case "above":
                  i.techniqueSymbolPlacement = 0;
                  break;
                case "below":
                  i.techniqueSymbolPlacement = 2;
                  break;
              }
              break;
            case "Noteheads":
              let o = F._splitSafe(a);
              o.length >= 1 && (i.noteHeadDefault = this._parseNoteHead(o[0])),
                o.length >= 2 && (i.noteHeadHalf = this._parseNoteHead(o[1])),
                o.length >= 3 && (i.noteHeadWhole = this._parseNoteHead(o[2])),
                i.noteHeadHalf === -1 && (i.noteHeadHalf = i.noteHeadDefault),
                i.noteHeadWhole === -1 && (i.noteHeadWhole = i.noteHeadDefault);
              break;
            case "StaffLine":
              i.staffLine = F._parseIntSafe(a, 0);
              break;
          }
        }
        i.outputMidiNumber !== -1
          ? (t.percussionArticulations.push(i),
            n.length > 0 && this._articulationByName.set(n, i))
          : n.length > 0 &&
            this._articulationByName.has(n) &&
            (this._articulationByName.get(n).staffLine = i.staffLine);
      }
      _parseTechniqueSymbol(t) {
        switch (t) {
          case "pictEdgeOfCymbal":
            return 59177;
          case "articStaccatoAbove":
            return 58530;
          case "noteheadParenthesis":
            return 57550;
          case "stringsUpBow":
            return 58898;
          case "stringsDownBow":
            return 58896;
          case "guitarGolpe":
            return 59458;
          default:
            return -1;
        }
      }
      _parseNoteHead(t) {
        switch (t) {
          case "noteheadDoubleWholeSquare":
            return 57505;
          case "noteheadDoubleWhole":
            return 57504;
          case "noteheadWhole":
            return 57506;
          case "noteheadHalf":
            return 57507;
          case "noteheadBlack":
            return 57508;
          case "noteheadNull":
            return 57509;
          case "noteheadXOrnate":
            return 57514;
          case "noteheadTriangleUpWhole":
            return 57531;
          case "noteheadTriangleUpHalf":
            return 57532;
          case "noteheadTriangleUpBlack":
            return 57534;
          case "noteheadDiamondBlackWide":
            return 57564;
          case "noteheadDiamondWhite":
            return 57565;
          case "noteheadDiamondWhiteWide":
            return 57566;
          case "noteheadCircleX":
            return 57523;
          case "noteheadXWhole":
            return 57511;
          case "noteheadXHalf":
            return 57512;
          case "noteheadXBlack":
            return 57513;
          case "noteheadParenthesis":
            return 57550;
          case "noteheadSlashedBlack2":
            return 57552;
          case "noteheadCircleSlash":
            return 57591;
          case "noteheadHeavyX":
            return 57592;
          case "noteheadHeavyXHat":
            return 57593;
          default:
            return w.warning("GPIF", "Unknown notehead symbol", t), -1;
        }
      }
      _parseStaves(t, e) {
        let r = 0;
        for (let i of e.childElements())
          if (i.localName === "Staff") {
            t.ensureStaveCount(r + 1);
            let n = t.staves[r];
            this._parseStaff(n, i), r++;
          }
      }
      _parseStaff(t, e) {
        for (let r of e.childElements())
          r.localName === "Properties" && this._parseStaffProperties(t, r);
      }
      _parseStaffProperties(t, e) {
        for (let r of e.childElements())
          r.localName === "Property" && this._parseStaffProperty(t, r);
      }
      _parseStaffProperty(t, e) {
        switch (e.getAttribute("name")) {
          case "Tuning":
            for (let n of e.childElements())
              switch (n.localName) {
                case "Pitches":
                  let s = F._splitSafe(
                      e.findChildElement("Pitches")?.innerText
                    ),
                    a = new Array(s.length);
                  for (let o = 0; o < a.length; o++)
                    a[a.length - 1 - o] = F._parseIntSafe(s[o], 0);
                  t.stringTuning.tunings = a;
                  break;
                case "Label":
                  t.stringTuning.name = n.innerText;
                  break;
              }
            t.isPercussion || (t.showTablature = !0);
            break;
          case "DiagramCollection":
          case "ChordCollection":
            this._parseDiagramCollectionForStaff(t, e);
            break;
          case "CapoFret":
            let i = F._parseIntSafe(e.findChildElement("Fret")?.innerText, 0);
            t.capo = i;
            break;
        }
      }
      _parseLyrics(t, e) {
        let r = [];
        for (let i of e.childElements())
          i.localName === "Line" && r.push(this._parseLyricsLine(i));
        this._lyricsByTrack.set(t, r);
      }
      _parseLyricsLine(t) {
        let e = new Rr();
        for (let r of t.childElements())
          switch (r.localName) {
            case "Offset":
              e.startBar = F._parseIntSafe(r.innerText, 0);
              break;
            case "Text":
              e.text = r.innerText;
              break;
          }
        return e;
      }
      _parseDiagramCollectionForTrack(t, e) {
        let r = e.findChildElement("Items");
        if (r)
          for (let i of r.childElements())
            i.localName === "Item" && this._parseDiagramItemForTrack(t, i);
      }
      _parseDiagramCollectionForStaff(t, e) {
        let r = e.findChildElement("Items");
        if (r)
          for (let i of r.childElements())
            i.localName === "Item" && this._parseDiagramItemForStaff(t, i);
      }
      _parseDiagramItemForTrack(t, e) {
        let r = new Bt(),
          i = e.getAttribute("id");
        for (let n of t.staves) n.addChord(i, r);
        this._parseDiagramItemForChord(r, e);
      }
      _parseDiagramItemForStaff(t, e) {
        let r = new Bt(),
          i = e.getAttribute("id");
        t.addChord(i, r), this._parseDiagramItemForChord(r, e);
      }
      _parseDiagramItemForChord(t, e) {
        t.name = e.getAttribute("name");
        let r = e.findChildElement("Diagram");
        if (!r) {
          (t.showDiagram = !1), (t.showFingering = !1);
          return;
        }
        let i = F._parseIntSafe(r.getAttribute("stringCount"), 6),
          n = F._parseIntSafe(r.getAttribute("baseFret"), 0);
        t.firstFret = n + 1;
        for (let s = 0; s < i; s++) t.strings.push(-1);
        for (let s of r.childElements())
          switch (s.localName) {
            case "Fret":
              let a = F._parseIntSafe(s.getAttribute("string"), 0);
              t.strings[i - a - 1] =
                n + F._parseIntSafe(s.getAttribute("fret"), 0);
              break;
            case "Fingering":
              let o = new Map();
              for (let l of s.childElements())
                switch (l.localName) {
                  case "Position":
                    let u = -2,
                      c = n + F._parseIntSafe(l.getAttribute("fret"), 0);
                    switch (l.getAttribute("finger")) {
                      case "Index":
                        u = 1;
                        break;
                      case "Middle":
                        u = 2;
                        break;
                      case "Rank":
                        u = 3;
                        break;
                      case "Pinky":
                        u = 4;
                        break;
                      case "Thumb":
                        u = 0;
                        break;
                      case "None":
                        break;
                    }
                    u !== -2 &&
                      (o.has(u) ? t.barreFrets.push(c) : o.set(u, !0));
                    break;
                }
              break;
            case "Property":
              switch (s.getAttribute("name")) {
                case "ShowName":
                  t.showName = s.getAttribute("value") === "true";
                  break;
                case "ShowDiagram":
                  t.showDiagram = s.getAttribute("value") === "true";
                  break;
                case "ShowFingering":
                  t.showFingering = s.getAttribute("value") === "true";
                  break;
              }
              break;
          }
      }
      _parseTrackProperties(t, e) {
        for (let r of e.childElements())
          r.localName === "Property" && this._parseTrackProperty(t, r);
      }
      _parseTrackProperty(t, e) {
        switch (e.getAttribute("name")) {
          case "Tuning":
            let i = F._splitSafe(e.findChildElement("Pitches")?.innerText),
              n = new Array(i.length);
            for (let a = 0; a < n.length; a++)
              n[n.length - 1 - a] = F._parseIntSafe(i[a], 0);
            for (let a of t.staves)
              (a.stringTuning.tunings = n),
                (a.showStandardNotation = !0),
                (a.showTablature = !0);
            break;
          case "DiagramCollection":
          case "ChordCollection":
            this._parseDiagramCollectionForTrack(t, e);
            break;
          case "CapoFret":
            let s = F._parseIntSafe(e.findChildElement("Fret")?.innerText, 0);
            for (let a of t.staves) a.capo = s;
            break;
        }
      }
      _parseGeneralMidi(t, e) {
        for (let i of e.childElements())
          switch (i.localName) {
            case "Program":
              t.playbackInfo.program = F._parseIntSafe(i.innerText, 0);
              break;
            case "Port":
              t.playbackInfo.port = F._parseIntSafe(i.innerText, 0);
              break;
            case "PrimaryChannel":
              t.playbackInfo.primaryChannel = F._parseIntSafe(i.innerText, 0);
              break;
            case "SecondaryChannel":
              t.playbackInfo.secondaryChannel = F._parseIntSafe(i.innerText, 0);
              break;
          }
        if (e.getAttribute("table") === "Percussion")
          for (let i of t.staves) i.isPercussion = !0;
      }
      _parseSounds(t, e, r) {
        for (let i of r.childElements())
          i.localName === "Sound" && this._parseSound(t, e, i);
      }
      _parseSound(t, e, r) {
        let i = new Pp();
        for (let n of r.childElements())
          switch (n.localName) {
            case "Name":
              i.name = n.innerText;
              break;
            case "Path":
              i.path = n.innerText;
              break;
            case "Role":
              i.role = n.innerText;
              break;
            case "MIDI":
              this._parseSoundMidi(i, n);
              break;
          }
        this._soundsByTrack.has(t) ||
          (this._soundsByTrack.set(t, new Map()),
          (e.playbackInfo.program = i.program),
          (e.playbackInfo.bank = i.bank)),
          this._soundsByTrack.get(t).set(i.uniqueId, i);
      }
      _parseSoundMidi(t, e) {
        let r = 0,
          i = 0;
        for (let n of e.childElements())
          switch (n.localName) {
            case "Program":
              t.program = F._parseIntSafe(n.innerText, 0);
              break;
            case "MSB":
              r = F._parseIntSafe(n.innerText, 0);
              break;
            case "LSB":
              i = F._parseIntSafe(n.innerText, 0);
              break;
          }
        t.bank = ((r & 127) << 7) | i;
      }
      _parsePartSounding(t, e, r) {
        for (let i of r.childElements())
          switch (i.localName) {
            case "TranspositionPitch":
              for (let s of e.staves)
                s.displayTranspositionPitch = F._parseIntSafe(i.innerText, 0);
              break;
            case "NominalKey":
              let n = Math.max(0, lt.noteNames.indexOf(i.innerText));
              this._transposeKeySignaturePerTrack.set(t, n);
              break;
          }
      }
      _parseTranspose(t, e, r) {
        let i = 0,
          n = 0;
        for (let o of r.childElements())
          switch (o.localName) {
            case "Chromatic":
              n = F._parseIntSafe(o.innerText, 0);
              break;
            case "Octave":
              i = F._parseIntSafe(o.innerText, 0);
              break;
          }
        let s = i * 12 + n;
        for (let o of e.staves) o.displayTranspositionPitch = s;
        let a = A.flooredDivision(s, 12);
        this._transposeKeySignaturePerTrack.set(t, a);
      }
      _parseRSE(t, e) {
        for (let r of e.childElements())
          r.localName === "ChannelStrip" && this._parseChannelStrip(t, r);
      }
      _parseChannelStrip(t, e) {
        for (let r of e.childElements())
          r.localName === "Parameters" &&
            this._parseChannelStripParameters(t, r);
      }
      _parseChannelStripParameters(t, e) {
        if (e.firstChild && e.firstChild.value) {
          let r = F._splitSafe(e.firstChild.value);
          r.length >= 12 &&
            ((t.playbackInfo.balance = Math.floor(
              F._parseFloatSafe(r[11], 0.5) * 16
            )),
            (t.playbackInfo.volume = Math.floor(
              F._parseFloatSafe(r[12], 0.9) * 16
            )));
        }
      }
      _parseMasterBarsNode(t) {
        for (let e of t.childElements())
          e.localName === "MasterBar" && this._parseMasterBar(e);
      }
      _parseMasterBar(t) {
        let e = new ot();
        this._masterBars.length === 0 &&
          this._hasAnacrusis &&
          (e.isAnacrusis = !0);
        for (let r of t.childElements())
          switch (r.localName) {
            case "Time":
              let i = r.innerText.split("/");
              (e.timeSignatureNumerator = F._parseIntSafe(i[0], 4)),
                (e.timeSignatureDenominator = F._parseIntSafe(i[1], 4));
              break;
            case "FreeTime":
              e.isFreeTime = !0;
              break;
            case "DoubleBar":
              (e.isDoubleBar = !0), this._doubleBars.add(e);
              break;
            case "Section":
              (e.section = new vr()),
                (e.section.marker =
                  r.findChildElement("Letter")?.innerText ?? ""),
                (e.section.text = r.findChildElement("Text")?.innerText ?? "");
              break;
            case "Repeat":
              r.getAttribute("start").toLowerCase() === "true" &&
                (e.isRepeatStart = !0),
                r.getAttribute("end").toLowerCase() === "true" &&
                  r.getAttribute("count") &&
                  (e.repeatCount = F._parseIntSafe(r.getAttribute("count"), 1));
              break;
            case "AlternateEndings":
              let n = F._splitSafe(r.innerText),
                s = 0;
              for (let u = 0; u < n.length; u++)
                s = s | (1 << (-1 + F._parseIntSafe(n[u], 0)));
              e.alternateEndings = s;
              break;
            case "Bars":
              this._barsOfMasterBar.push(F._splitSafe(r.innerText));
              break;
            case "TripletFeel":
              switch (r.innerText) {
                case "NoTripletFeel":
                  e.tripletFeel = 0;
                  break;
                case "Triplet8th":
                  e.tripletFeel = 2;
                  break;
                case "Triplet16th":
                  e.tripletFeel = 1;
                  break;
                case "Dotted8th":
                  e.tripletFeel = 4;
                  break;
                case "Dotted16th":
                  e.tripletFeel = 3;
                  break;
                case "Scottish8th":
                  e.tripletFeel = 6;
                  break;
                case "Scottish16th":
                  e.tripletFeel = 5;
                  break;
              }
              break;
            case "Key":
              let a = F._parseIntSafe(
                  r.findChildElement("AccidentalCount")?.innerText,
                  0
                ),
                o = r.findChildElement("Mode"),
                l = 0;
              if (o)
                switch (o.innerText.toLowerCase()) {
                  case "major":
                    l = 0;
                    break;
                  case "minor":
                    l = 1;
                    break;
                }
              this._keySignatures.set(this._masterBars.length, [a, l]);
              break;
            case "Fermatas":
              this._parseFermatas(e, r);
              break;
            case "XProperties":
              this._parseMasterBarXProperties(e, r);
              break;
            case "Directions":
              this._parseDirections(e, r);
              break;
          }
        this._masterBars.push(e);
      }
      _parseDirections(t, e) {
        for (let r of e.childElements())
          switch (r.localName) {
            case "Target":
              switch (r.innerText) {
                case "Coda":
                  t.addDirection(3);
                  break;
                case "DoubleCoda":
                  t.addDirection(4);
                  break;
                case "Segno":
                  t.addDirection(1);
                  break;
                case "SegnoSegno":
                  t.addDirection(2);
                  break;
                case "Fine":
                  t.addDirection(0);
                  break;
              }
              break;
            case "Jump":
              switch (r.innerText) {
                case "DaCapo":
                  t.addDirection(5);
                  break;
                case "DaCapoAlCoda":
                  t.addDirection(6);
                  break;
                case "DaCapoAlDoubleCoda":
                  t.addDirection(7);
                  break;
                case "DaCapoAlFine":
                  t.addDirection(8);
                  break;
                case "DaSegno":
                  t.addDirection(9);
                  break;
                case "DaSegnoAlCoda":
                  t.addDirection(10);
                  break;
                case "DaSegnoAlDoubleCoda":
                  t.addDirection(11);
                  break;
                case "DaSegnoAlFine":
                  t.addDirection(12);
                  break;
                case "DaSegnoSegno":
                  t.addDirection(13);
                  break;
                case "DaSegnoSegnoAlCoda":
                  t.addDirection(14);
                  break;
                case "DaSegnoSegnoAlDoubleCoda":
                  t.addDirection(15);
                  break;
                case "DaSegnoSegnoAlFine":
                  t.addDirection(16);
                  break;
                case "DaCoda":
                  t.addDirection(17);
                  break;
                case "DaDoubleCoda":
                  t.addDirection(18);
                  break;
              }
              break;
          }
      }
      _parseFermatas(t, e) {
        for (let r of e.childElements())
          r.localName === "Fermata" && this._parseFermata(t, r);
      }
      _parseFermata(t, e) {
        let r = 0,
          i = new kr();
        for (let n of e.childElements())
          switch (n.localName) {
            case "Type":
              switch (n.innerText) {
                case "Short":
                  i.type = 0;
                  break;
                case "Medium":
                  i.type = 1;
                  break;
                case "Long":
                  i.type = 2;
                  break;
              }
              break;
            case "Length":
              i.length = F._parseFloatSafe(n.innerText, 0);
              break;
            case "Offset":
              let s = n.innerText.split("/");
              if (s.length === 2) {
                let a = F._parseIntSafe(s[0], 4),
                  o = F._parseIntSafe(s[1], 4);
                r = ((a / o) * E.QuarterTime) | 0;
              }
              break;
          }
        t.addFermata(r, i);
      }
      _parseBars(t) {
        for (let e of t.childElements())
          e.localName === "Bar" && this._parseBar(e);
      }
      _parseBar(t) {
        let e = new at(),
          r = t.getAttribute("id");
        for (let i of t.childElements())
          switch (i.localName) {
            case "Voices":
              this._voicesOfBar.set(r, F._splitSafe(i.innerText));
              break;
            case "Clef":
              switch (i.innerText) {
                case "Neutral":
                  e.clef = 0;
                  break;
                case "G2":
                  e.clef = 4;
                  break;
                case "F4":
                  e.clef = 3;
                  break;
                case "C4":
                  e.clef = 2;
                  break;
                case "C3":
                  e.clef = 1;
                  break;
              }
              break;
            case "Ottavia":
              switch (i.innerText) {
                case "8va":
                  e.clefOttava = 1;
                  break;
                case "15ma":
                  e.clefOttava = 0;
                  break;
                case "8vb":
                  e.clefOttava = 3;
                  break;
                case "15mb":
                  e.clefOttava = 4;
                  break;
              }
              break;
            case "SimileMark":
              switch (i.innerText) {
                case "Simple":
                  e.simileMark = 1;
                  break;
                case "FirstOfDouble":
                  e.simileMark = 2;
                  break;
                case "SecondOfDouble":
                  e.simileMark = 3;
                  break;
              }
              break;
            case "XProperties":
              this._parseBarXProperties(i, e);
              break;
          }
        this._barsById.set(r, e);
      }
      _parseVoices(t) {
        for (let e of t.childElements())
          e.localName === "Voice" && this._parseVoice(e);
      }
      _parseVoice(t) {
        let e = new ze(),
          r = t.getAttribute("id");
        for (let i of t.childElements())
          i.localName === "Beats" &&
            this._beatsOfVoice.set(r, F._splitSafe(i.innerText));
        this._voiceById.set(r, e);
      }
      _parseBeats(t) {
        for (let e of t.childElements())
          e.localName === "Beat" && this._parseBeat(e);
      }
      _parseBeat(t) {
        let e = new Me(),
          r = t.getAttribute("id");
        for (let i of t.childElements())
          switch (i.localName) {
            case "Notes":
              this._notesOfBeat.set(r, F._splitSafe(i.innerText));
              break;
            case "Rhythm":
              this._rhythmOfBeat.set(r, i.getAttribute("ref"));
              break;
            case "Fadding":
              switch (i.innerText) {
                case "FadeIn":
                  e.fade = 1;
                  break;
                case "FadeOut":
                  e.fade = 2;
                  break;
                case "VolumeSwell":
                  e.fade = 3;
                  break;
              }
              break;
            case "Tremolo":
              switch (i.innerText) {
                case "1/2":
                  e.tremoloSpeed = 8;
                  break;
                case "1/4":
                  e.tremoloSpeed = 16;
                  break;
                case "1/8":
                  e.tremoloSpeed = 32;
                  break;
              }
              break;
            case "Chord":
              e.chordId = i.innerText;
              break;
            case "Hairpin":
              switch (i.innerText) {
                case "Crescendo":
                  e.crescendo = 1;
                  break;
                case "Decrescendo":
                  e.crescendo = 2;
                  break;
              }
              break;
            case "Arpeggio":
              i.innerText === "Up" ? (e.brushType = 3) : (e.brushType = 4);
              break;
            case "Properties":
              this._parseBeatProperties(i, e);
              break;
            case "XProperties":
              this._parseBeatXProperties(i, e);
              break;
            case "FreeText":
              e.text = i.innerText;
              break;
            case "TransposedPitchStemOrientation":
              switch (i.innerText) {
                case "Upward":
                  e.preferredBeamDirection = 0;
                  break;
                case "Downward":
                  e.preferredBeamDirection = 1;
                  break;
              }
              break;
            case "Dynamic":
              switch (i.innerText) {
                case "PPP":
                  e.dynamics = 0;
                  break;
                case "PP":
                  e.dynamics = 1;
                  break;
                case "P":
                  e.dynamics = 2;
                  break;
                case "MP":
                  e.dynamics = 3;
                  break;
                case "MF":
                  e.dynamics = 4;
                  break;
                case "F":
                  e.dynamics = 5;
                  break;
                case "FF":
                  e.dynamics = 6;
                  break;
                case "FFF":
                  e.dynamics = 7;
                  break;
              }
              break;
            case "GraceNotes":
              switch (i.innerText) {
                case "OnBeat":
                  e.graceType = 1;
                  break;
                case "BeforeBeat":
                  e.graceType = 2;
                  break;
              }
              break;
            case "Legato":
              i.getAttribute("origin") === "true" && (e.isLegatoOrigin = !0);
              break;
            case "Whammy":
              let n = new I(0, 0);
              (n.value = this._toBendValue(
                F._parseFloatSafe(i.getAttribute("originValue"), 0)
              )),
                (n.offset = this._toBendOffset(
                  F._parseFloatSafe(i.getAttribute("originOffset"), 0)
                )),
                e.addWhammyBarPoint(n);
              let s = new I(0, 0);
              (s.value = this._toBendValue(
                F._parseFloatSafe(i.getAttribute("middleValue"), 0)
              )),
                (s.offset = this._toBendOffset(
                  F._parseFloatSafe(i.getAttribute("middleOffset1"), 0)
                )),
                e.addWhammyBarPoint(s);
              let a = new I(0, 0);
              (a.value = this._toBendValue(
                F._parseFloatSafe(i.getAttribute("middleValue"), 0)
              )),
                (a.offset = this._toBendOffset(
                  F._parseFloatSafe(i.getAttribute("middleOffset2"), 0)
                )),
                e.addWhammyBarPoint(a);
              let o = new I(0, 0);
              (o.value = this._toBendValue(
                F._parseFloatSafe(i.getAttribute("destinationValue"), 0)
              )),
                (o.offset = this._toBendOffset(
                  F._parseFloatSafe(i.getAttribute("destinationOffset"), 0)
                )),
                e.addWhammyBarPoint(o);
              break;
            case "Ottavia":
              switch (i.innerText) {
                case "8va":
                  e.ottava = 1;
                  break;
                case "8vb":
                  e.ottava = 3;
                  break;
                case "15ma":
                  e.ottava = 0;
                  break;
                case "15mb":
                  e.ottava = 4;
                  break;
              }
              break;
            case "Lyrics":
              (e.lyrics = this._parseBeatLyrics(i)),
                (this._skipApplyLyrics = !0);
              break;
            case "Slashed":
              e.slashed = !0;
              break;
            case "DeadSlapped":
              e.deadSlapped = !0;
              break;
            case "Golpe":
              switch (i.innerText) {
                case "Finger":
                  e.golpe = 2;
                  break;
                case "Thumb":
                  e.golpe = 1;
                  break;
              }
              break;
            case "Wah":
              switch (i.innerText) {
                case "Open":
                  e.wahPedal = 1;
                  break;
                case "Closed":
                  e.wahPedal = 2;
                  break;
              }
              break;
            case "UserTransposedPitchStemOrientation":
              switch (i.innerText) {
                case "Downward":
                  e.preferredBeamDirection = 1;
                  break;
                case "Upward":
                  e.preferredBeamDirection = 0;
                  break;
              }
              break;
            case "Timer":
              (e.showTimer = !0),
                (e.timer = F._parseIntSafe(i.innerText, -1)),
                e.timer < 0 && (e.timer = null);
              break;
          }
        this._beatById.set(r, e);
      }
      _parseBeatLyrics(t) {
        let e = [];
        for (let r of t.childElements())
          r.localName === "Line" && e.push(r.innerText);
        return e;
      }
      _parseBeatXProperties(t, e) {
        for (let r of t.childElements())
          switch (r.localName) {
            case "XProperty":
              let i = r.getAttribute("id"),
                n = 0;
              switch (i) {
                case "1124204546":
                  switch (
                    ((n = F._parseIntSafe(
                      r.findChildElement("Int")?.innerText,
                      0
                    )),
                    n)
                  ) {
                    case 1:
                      e.beamingMode = 2;
                      break;
                    case 2:
                      e.beamingMode = 1;
                      break;
                  }
                  break;
                case "1124204552":
                  (n = F._parseIntSafe(
                    r.findChildElement("Int")?.innerText,
                    0
                  )),
                    n === 1 && e.beamingMode !== 1 && (e.beamingMode = 3);
                  break;
                case "1124204545":
                  (n = F._parseIntSafe(
                    r.findChildElement("Int")?.innerText,
                    0
                  )),
                    (e.invertBeamDirection = n === 1);
                  break;
                case "687935489":
                  (n = F._parseIntSafe(
                    r.findChildElement("Int")?.innerText,
                    0
                  )),
                    (e.brushDuration = n);
                  break;
              }
              break;
          }
      }
      _parseBarXProperties(t, e) {
        for (let r of t.childElements())
          switch (r.localName) {
            case "XProperty":
              if (r.getAttribute("id") === "1124139520") {
                let n =
                  r.findChildElement("Double") ?? r.findChildElement("Float");
                e.displayScale = F._parseFloatSafe(n?.innerText, 1);
              }
              break;
          }
      }
      _parseMasterBarXProperties(t, e) {
        for (let r of e.childElements())
          r.localName === "XProperty" &&
            r.getAttribute("id") === "1124073984" &&
            (t.displayScale = F._parseFloatSafe(
              r.findChildElement("Double")?.innerText,
              1
            ));
      }
      _parseBeatProperties(t, e) {
        let r = !1,
          i = null,
          n = null,
          s = null,
          a = null,
          o = null;
        for (let l of t.childElements())
          switch (l.localName) {
            case "Property":
              switch (l.getAttribute("name")) {
                case "Brush":
                  l.findChildElement("Direction")?.innerText === "Up"
                    ? (e.brushType = 1)
                    : (e.brushType = 2);
                  break;
                case "PickStroke":
                  l.findChildElement("Direction")?.innerText === "Up"
                    ? (e.pickStroke = 1)
                    : (e.pickStroke = 2);
                  break;
                case "Slapped":
                  l.findChildElement("Enable") && (e.slap = !0);
                  break;
                case "Popped":
                  l.findChildElement("Enable") && (e.pop = !0);
                  break;
                case "VibratoWTremBar":
                  switch (l.findChildElement("Strength")?.innerText) {
                    case "Wide":
                      e.vibrato = 2;
                      break;
                    case "Slight":
                      e.vibrato = 1;
                      break;
                  }
                  break;
                case "WhammyBar":
                  r = !0;
                  break;
                case "WhammyBarExtend":
                  break;
                case "WhammyBarOriginValue":
                  i || (i = new I(0, 0)),
                    (i.value = this._toBendValue(
                      F._parseFloatSafe(
                        l.findChildElement("Float")?.innerText,
                        0
                      )
                    ));
                  break;
                case "WhammyBarOriginOffset":
                  i || (i = new I(0, 0)),
                    (i.offset = this._toBendOffset(
                      F._parseFloatSafe(
                        l.findChildElement("Float")?.innerText,
                        0
                      )
                    ));
                  break;
                case "WhammyBarMiddleValue":
                  n = this._toBendValue(
                    F._parseFloatSafe(l.findChildElement("Float")?.innerText, 0)
                  );
                  break;
                case "WhammyBarMiddleOffset1":
                  s = this._toBendOffset(
                    F._parseFloatSafe(l.findChildElement("Float")?.innerText, 0)
                  );
                  break;
                case "WhammyBarMiddleOffset2":
                  a = this._toBendOffset(
                    F._parseFloatSafe(l.findChildElement("Float")?.innerText, 0)
                  );
                  break;
                case "WhammyBarDestinationValue":
                  o || (o = new I(I.MaxPosition, 0)),
                    (o.value = this._toBendValue(
                      F._parseFloatSafe(
                        l.findChildElement("Float")?.innerText,
                        0
                      )
                    ));
                  break;
                case "WhammyBarDestinationOffset":
                  o || (o = new I(0, 0)),
                    (o.offset = this._toBendOffset(
                      F._parseFloatSafe(
                        l.findChildElement("Float")?.innerText,
                        0
                      )
                    ));
                  break;
                case "BarreFret":
                  e.barreFret = F._parseIntSafe(
                    l.findChildElement("Fret")?.innerText,
                    0
                  );
                  break;
                case "BarreString":
                  switch (l.findChildElement("String")?.innerText) {
                    case "0":
                      e.barreShape = 1;
                      break;
                    case "1":
                      e.barreShape = 2;
                      break;
                  }
                  break;
                case "Rasgueado":
                  switch (l.findChildElement("Rasgueado")?.innerText) {
                    case "ii_1":
                      e.rasgueado = 1;
                      break;
                    case "mi_1":
                      e.rasgueado = 2;
                      break;
                    case "mii_1":
                      e.rasgueado = 3;
                      break;
                    case "mii_2":
                      e.rasgueado = 4;
                      break;
                    case "pmp_1":
                      e.rasgueado = 5;
                      break;
                    case "pmp_2":
                      e.rasgueado = 6;
                      break;
                    case "pei_1":
                      e.rasgueado = 7;
                      break;
                    case "pei_2":
                      e.rasgueado = 8;
                      break;
                    case "pai_1":
                      e.rasgueado = 9;
                      break;
                    case "pai_2":
                      e.rasgueado = 10;
                      break;
                    case "ami_1":
                      e.rasgueado = 11;
                      break;
                    case "ami_2":
                      e.rasgueado = 12;
                      break;
                    case "ppp_1":
                      e.rasgueado = 13;
                      break;
                    case "amii_1":
                      e.rasgueado = 14;
                      break;
                    case "amip_1":
                      e.rasgueado = 15;
                      break;
                    case "eami_1":
                      e.rasgueado = 16;
                      break;
                    case "eamii_1":
                      e.rasgueado = 17;
                      break;
                    case "peami_1":
                      e.rasgueado = 18;
                      break;
                  }
                  break;
              }
              break;
          }
        r &&
          (i || (i = new I(0, 0)),
          o || (o = new I(I.MaxPosition, 0)),
          e.addWhammyBarPoint(i),
          s && n && e.addWhammyBarPoint(new I(s, n)),
          a && n && e.addWhammyBarPoint(new I(a, n)),
          !s &&
            !a &&
            n &&
            e.addWhammyBarPoint(new I((I.MaxPosition / 2) | 0, n)),
          e.addWhammyBarPoint(o));
      }
      _parseNotes(t) {
        for (let e of t.childElements())
          e.localName === "Note" && this._parseNote(e);
      }
      _parseNote(t) {
        let e = new Xe(),
          r = t.getAttribute("id");
        for (let i of t.childElements())
          switch (i.localName) {
            case "Properties":
              this._parseNoteProperties(i, e, r);
              break;
            case "AntiAccent":
              i.innerText.toLowerCase() === "normal" && (e.isGhost = !0);
              break;
            case "LetRing":
              e.isLetRing = !0;
              break;
            case "Trill":
              (e.trillValue = F._parseIntSafe(i.innerText, -1)),
                (e.trillSpeed = 16);
              break;
            case "Accent":
              let n = F._parseIntSafe(i.innerText, 0);
              (n & 1) !== 0 && (e.isStaccato = !0),
                (n & 4) !== 0 && (e.accentuated = 2),
                (n & 8) !== 0 && (e.accentuated = 1),
                (n & 16) !== 0 && (e.accentuated = 3);
              break;
            case "Tie":
              i.getAttribute("destination").toLowerCase() === "true" &&
                (e.isTieDestination = !0);
              break;
            case "Vibrato":
              switch (i.innerText) {
                case "Slight":
                  e.vibrato = 1;
                  break;
                case "Wide":
                  e.vibrato = 2;
                  break;
              }
              break;
            case "LeftFingering":
              switch (i.innerText) {
                case "P":
                  e.leftHandFinger = 0;
                  break;
                case "I":
                  e.leftHandFinger = 1;
                  break;
                case "M":
                  e.leftHandFinger = 2;
                  break;
                case "A":
                  e.leftHandFinger = 3;
                  break;
                case "C":
                  e.leftHandFinger = 4;
                  break;
              }
              break;
            case "RightFingering":
              switch (i.innerText) {
                case "P":
                  e.rightHandFinger = 0;
                  break;
                case "I":
                  e.rightHandFinger = 1;
                  break;
                case "M":
                  e.rightHandFinger = 2;
                  break;
                case "A":
                  e.rightHandFinger = 3;
                  break;
                case "C":
                  e.rightHandFinger = 4;
                  break;
              }
              break;
            case "InstrumentArticulation":
              e.percussionArticulation = F._parseIntSafe(i.innerText, 0);
              break;
            case "Ornament":
              switch (i.innerText) {
                case "Turn":
                  e.ornament = 2;
                  break;
                case "InvertedTurn":
                  e.ornament = 1;
                  break;
                case "UpperMordent":
                  e.ornament = 3;
                  break;
                case "LowerMordent":
                  e.ornament = 4;
                  break;
              }
              break;
          }
        this._noteById.set(r, e);
      }
      _parseNoteProperties(t, e, r) {
        let i = !1,
          n = null,
          s = null,
          a = null,
          o = null,
          l = null,
          u = -1,
          c = -1,
          d = !1;
        for (let h of t.childElements())
          switch (h.localName) {
            case "Property":
              switch (h.getAttribute("name")) {
                case "ShowStringNumber":
                  h.findChildElement("Enable") && (e.showStringNumber = !0);
                  break;
                case "String":
                  e.string =
                    F._parseIntSafe(
                      h.findChildElement("String")?.innerText,
                      0
                    ) + 1;
                  break;
                case "Fret":
                  e.fret = F._parseIntSafe(
                    h.findChildElement("Fret")?.innerText,
                    0
                  );
                  break;
                case "Element":
                  u = F._parseIntSafe(
                    h.findChildElement("Element")?.innerText,
                    0
                  );
                  break;
                case "Variation":
                  c = F._parseIntSafe(
                    h.findChildElement("Variation")?.innerText,
                    0
                  );
                  break;
                case "Tapped":
                  this._tappedNotes.set(r, !0);
                  break;
                case "HarmonicType":
                  let b = h.findChildElement("HType");
                  if (b)
                    switch (b.innerText) {
                      case "NoHarmonic":
                        e.harmonicType = 0;
                        break;
                      case "Natural":
                        e.harmonicType = 1;
                        break;
                      case "Artificial":
                        e.harmonicType = 2;
                        break;
                      case "Pinch":
                        e.harmonicType = 3;
                        break;
                      case "Tap":
                        e.harmonicType = 4;
                        break;
                      case "Semi":
                        e.harmonicType = 5;
                        break;
                      case "Feedback":
                        e.harmonicType = 6;
                        break;
                    }
                  break;
                case "HarmonicFret":
                  let y = h.findChildElement("HFret");
                  y && (e.harmonicValue = F._parseFloatSafe(y.innerText, 0));
                  break;
                case "Muted":
                  h.findChildElement("Enable") && (e.isDead = !0);
                  break;
                case "PalmMuted":
                  h.findChildElement("Enable") && (e.isPalmMute = !0);
                  break;
                case "Octave":
                  (e.octave = F._parseIntSafe(
                    h.findChildElement("Number")?.innerText,
                    0
                  )),
                    e.tone === -1 && (e.tone = 0);
                  break;
                case "Tone":
                  e.tone = F._parseIntSafe(
                    h.findChildElement("Step")?.innerText,
                    0
                  );
                  break;
                case "ConcertPitch":
                  d || this._parseConcertPitch(h, e);
                  break;
                case "TransposedPitch":
                  (e.accidentalMode = 0),
                    this._parseConcertPitch(h, e),
                    (d = !0);
                  break;
                case "Bended":
                  i = !0;
                  break;
                case "BendOriginValue":
                  n || (n = new I(0, 0)),
                    (n.value = this._toBendValue(
                      F._parseFloatSafe(
                        h.findChildElement("Float")?.innerText,
                        0
                      )
                    ));
                  break;
                case "BendOriginOffset":
                  n || (n = new I(0, 0)),
                    (n.offset = this._toBendOffset(
                      F._parseFloatSafe(
                        h.findChildElement("Float")?.innerText,
                        0
                      )
                    ));
                  break;
                case "BendMiddleValue":
                  s = this._toBendValue(
                    F._parseFloatSafe(h.findChildElement("Float")?.innerText, 0)
                  );
                  break;
                case "BendMiddleOffset1":
                  a = this._toBendOffset(
                    F._parseFloatSafe(h.findChildElement("Float")?.innerText, 0)
                  );
                  break;
                case "BendMiddleOffset2":
                  o = this._toBendOffset(
                    F._parseFloatSafe(h.findChildElement("Float")?.innerText, 0)
                  );
                  break;
                case "BendDestinationValue":
                  l || (l = new I(I.MaxPosition, 0)),
                    (l.value = this._toBendValue(
                      F._parseFloatSafe(
                        h.findChildElement("Float")?.innerText,
                        0
                      )
                    ));
                  break;
                case "BendDestinationOffset":
                  l || (l = new I(0, 0)),
                    (l.offset = this._toBendOffset(
                      F._parseFloatSafe(
                        h.findChildElement("Float")?.innerText,
                        0
                      )
                    ));
                  break;
                case "HopoOrigin":
                  h.findChildElement("Enable") && (e.isHammerPullOrigin = !0);
                  break;
                case "HopoDestination":
                  break;
                case "LeftHandTapped":
                  e.isLeftHandTapped = !0;
                  break;
                case "Slide":
                  let S = F._parseIntSafe(
                    h.findChildElement("Flags")?.innerText,
                    0
                  );
                  (S & 1) !== 0
                    ? (e.slideOutType = 1)
                    : (S & 2) !== 0
                    ? (e.slideOutType = 2)
                    : (S & 4) !== 0
                    ? (e.slideOutType = 4)
                    : (S & 8) !== 0 && (e.slideOutType = 3),
                    (S & 16) !== 0
                      ? (e.slideInType = 1)
                      : (S & 32) !== 0 && (e.slideInType = 2),
                    (S & 64) !== 0
                      ? (e.slideOutType = 5)
                      : (S & 128) !== 0 && (e.slideOutType = 6);
                  break;
              }
              break;
          }
        i &&
          (n || (n = new I(0, 0)),
          l || (l = new I(I.MaxPosition, 0)),
          e.addBendPoint(n),
          a && s && e.addBendPoint(new I(a, s)),
          o && s && e.addBendPoint(new I(o, s)),
          !a && !o && s && e.addBendPoint(new I((I.MaxPosition / 2) | 0, s)),
          e.addBendPoint(l)),
          u !== -1 &&
            c !== -1 &&
            (e.percussionArticulation = He.articulationFromElementVariation(
              u,
              c
            ));
      }
      _parseConcertPitch(t, e) {
        let r = t.findChildElement("Pitch");
        if (r)
          for (let i of r.childElements())
            switch (i.localName) {
              case "Accidental":
                switch (i.innerText) {
                  case "x":
                    e.accidentalMode = 4;
                    break;
                  case "#":
                    e.accidentalMode = 3;
                    break;
                  case "b":
                    e.accidentalMode = 5;
                    break;
                  case "bb":
                    e.accidentalMode = 6;
                    break;
                }
                break;
            }
      }
      _toBendValue(t) {
        return (t * F._bendPointValueFactor) | 0;
      }
      _toBendOffset(t) {
        return t * F._bendPointPositionFactor;
      }
      _parseRhythms(t) {
        for (let e of t.childElements())
          e.localName === "Rhythm" && this._parseRhythm(e);
      }
      _parseRhythm(t) {
        let e = new Ep(),
          r = t.getAttribute("id");
        e.id = r;
        for (let i of t.childElements())
          switch (i.localName) {
            case "NoteValue":
              switch (i.innerText) {
                case "Long":
                  e.value = -4;
                  break;
                case "DoubleWhole":
                  e.value = -2;
                  break;
                case "Whole":
                  e.value = 1;
                  break;
                case "Half":
                  e.value = 2;
                  break;
                case "Quarter":
                  e.value = 4;
                  break;
                case "Eighth":
                  e.value = 8;
                  break;
                case "16th":
                  e.value = 16;
                  break;
                case "32nd":
                  e.value = 32;
                  break;
                case "64th":
                  e.value = 64;
                  break;
                case "128th":
                  e.value = 128;
                  break;
                case "256th":
                  e.value = 256;
                  break;
              }
              break;
            case "PrimaryTuplet":
              (e.tupletNumerator = F._parseIntSafe(i.getAttribute("num"), -1)),
                (e.tupletDenominator = F._parseIntSafe(
                  i.getAttribute("den"),
                  -1
                ));
              break;
            case "AugmentationDot":
              e.dots = F._parseIntSafe(i.getAttribute("count"), 0);
              break;
          }
        this._rhythmById.set(r, e);
      }
      _buildModel() {
        for (let i = 0, n = this._masterBars.length; i < n; i++) {
          let s = this._masterBars[i];
          this.score.addMasterBar(s);
        }
        let t = this._masterBars[this._masterBars.length - 1];
        this._doubleBars.has(t) &&
          (this._doubleBars.delete(t), (t.isDoubleBar = !1));
        let e = [];
        for (let i of this._tracksMapping) {
          if (!i) continue;
          let n = this._tracksById.get(i);
          this.score.addTrack(n), e.push(i);
        }
        let r;
        for (let i of this._barsOfMasterBar) {
          let n = 0,
            s = 0;
          (r = [0, 0]),
            this._transposeKeySignaturePerTrack.has(e[0]) &&
              (r = [
                A.transposeKey(
                  r[0],
                  this._transposeKeySignaturePerTrack.get(e[0])
                ),
                r[1],
              ]);
          for (let a = 0; a < i.length && s < this.score.tracks.length; a++) {
            let o = i[a];
            if (o !== F._invalidId) {
              let l = this._barsById.get(o),
                u = this.score.tracks[s],
                c = u.staves[n];
              c.addBar(l);
              let d = c.bars.length - 1;
              if (
                (this._keySignatures.has(d) &&
                  ((r = this._keySignatures.get(d)),
                  this._transposeKeySignaturePerTrack.has(e[s]) &&
                    (r = [
                      A.transposeKey(
                        r[0],
                        this._transposeKeySignaturePerTrack.get(e[s])
                      ),
                      r[1],
                    ])),
                (l.keySignature = r[0]),
                (l.keySignatureType = r[1]),
                this._doubleBars.has(l.masterBar) && (l.barLineRight = 7),
                this._voicesOfBar.has(o))
              )
                for (let h of this._voicesOfBar.get(o))
                  if (h !== F._invalidId) {
                    let f = this._voiceById.get(h);
                    if ((l.addVoice(f), this._beatsOfVoice.has(h))) {
                      for (let b of this._beatsOfVoice.get(h))
                        if (b !== F._invalidId) {
                          let y = dn.clone(this._beatById.get(b));
                          f.addBeat(y);
                          let S = this._rhythmOfBeat.get(b),
                            k = this._rhythmById.get(S);
                          if (
                            ((y.duration = k.value),
                            (y.dots = k.dots),
                            (y.tupletNumerator = k.tupletNumerator),
                            (y.tupletDenominator = k.tupletDenominator),
                            this._notesOfBeat.has(b))
                          ) {
                            for (let T of this._notesOfBeat.get(b))
                              if (T !== F._invalidId) {
                                let O = qs.clone(this._noteById.get(T));
                                c.isPercussion
                                  ? ((O.fret = -1), (O.string = -1))
                                  : (O.percussionArticulation = -1),
                                  y.addNote(O),
                                  this._tappedNotes.has(T) && (y.tap = !0);
                              }
                          }
                        }
                    }
                  } else {
                    let f = new ze();
                    l.addVoice(f);
                    let b = new Me();
                    (b.isEmpty = !0), (b.duration = 4), f.addBeat(b);
                  }
              n === u.staves.length - 1 ? (s++, (n = 0)) : n++,
                (r = [0, 0]),
                s < e.length &&
                  this._transposeKeySignaturePerTrack.has(e[s]) &&
                  (r = [
                    A.transposeKey(
                      r[0],
                      this._transposeKeySignaturePerTrack.get(e[s])
                    ),
                    r[1],
                  ]);
            } else s++;
          }
        }
        for (let i of this._tracksMapping) {
          if (!i) continue;
          let n = this._tracksById.get(i),
            s = !1;
          for (let a of n.staves)
            if (a.isPercussion) {
              s = !0;
              break;
            }
          if (
            (s || (n.percussionArticulations = []),
            this._automationsPerTrackIdAndBarIndex.has(i))
          ) {
            let a = this._automationsPerTrackIdAndBarIndex.get(i);
            for (let [o, l] of a)
              if (n.staves.length > 0 && o < n.staves[0].bars.length) {
                let u = n.staves[0].bars[o];
                if (u.voices.length > 0 && u.voices[0].beats.length > 0) {
                  let c = u.voices[0].beats[0];
                  for (let d of l)
                    (d.type === 4 && d.value === 0 && u.index === 0) ||
                      c.automations.push(d);
                }
              }
          }
          if (this._sustainPedalsPerTrackIdAndBarIndex.has(i)) {
            let a = this._sustainPedalsPerTrackIdAndBarIndex.get(i);
            for (let [o, l] of a)
              if (n.staves.length > 0 && o < n.staves[0].bars.length) {
                let u = n.staves[0].bars[o];
                u.sustainPedals = l;
              }
          }
        }
        for (let [i, n] of this._masterTrackAutomations) {
          let s = this.score.masterBars[i];
          for (let a = 0, o = n.length; a < o; a++) {
            let l = n[a];
            switch (l.type) {
              case 0:
                s.tempoAutomations.push(l);
                break;
              case 4:
                (l.syncPointValue.millisecondOffset -=
                  this._backingTrackPadding),
                  s.addSyncPoint(l);
                break;
            }
          }
        }
      }
    };
  (F._invalidId = "-1"),
    (F._bendPointPositionFactor = I.MaxPosition / 100),
    (F._bendPointValueFactor = 1 / 25),
    (F._sampleRate = 44100);
  var js = F;
  var So = class {
      constructor() {
        this.isMultiRest = !1;
        this.trackViewGroups = [];
      }
    },
    pu = class {
      constructor() {
        this.showNumbered = !1;
        this.showSlash = !1;
        this.showStandardNotation = !1;
        this.showTablature = !1;
      }
    },
    _n = class {
      constructor(t) {
        this.scoreViews = [];
        let e = Se.fromBuffer(t),
          r = B.readInt32BE(e);
        for (let i = 0; i < r; i++) {
          let n = new So();
          this.scoreViews.push(n), (n.isMultiRest = pe.gpReadBool(e));
          let s = B.readInt32BE(e);
          for (let a = 0; a < s; a++) {
            let o = e.readByte();
            o === 0 && (o = 1);
            let l = new pu();
            (l.showStandardNotation = (o & 1) !== 0),
              (l.showTablature = (o & 2) !== 0),
              (l.showSlash = (o & 4) !== 0),
              (l.showNumbered = (o & 8) !== 0),
              n.trackViewGroups.push(l);
          }
        }
      }
      apply(t) {
        if (this.scoreViews.length > 0) {
          let e = 0;
          t.stylesheet.multiTrackMultiBarRest = this.scoreViews[0].isMultiRest;
          for (let r of this.scoreViews[0].trackViewGroups) {
            if (e < t.tracks.length) {
              let i = t.tracks[e];
              for (let n of i.staves)
                n.isPercussion || (n.showTablature = r.showTablature),
                  (n.showStandardNotation = r.showStandardNotation),
                  (n.showSlash = r.showSlash),
                  (n.showNumbered = r.showNumbered);
            }
            e++;
          }
          for (let r = 1; r < this.scoreViews.length; r++)
            this.scoreViews[r].isMultiRest &&
              (t.stylesheet.perTrackMultiBarRest ||
                (t.stylesheet.perTrackMultiBarRest = new Set()),
              (e = r - 1),
              t.stylesheet.perTrackMultiBarRest.add(e));
        }
      }
      static writeForScore(t) {
        let e = Se.withCapacity(128),
          r = [new So()];
        r[0].isMultiRest = t.stylesheet.multiTrackMultiBarRest;
        for (let i of t.tracks) {
          let n = new pu();
          (n.showStandardNotation = i.staves[0].showStandardNotation),
            (n.showTablature = i.staves[0].showTablature),
            (n.showSlash = i.staves[0].showSlash),
            (n.showNumbered = i.staves[0].showNumbered),
            r[0].trackViewGroups.push(n);
          let s = new So();
          (s.isMultiRest =
            t.stylesheet.perTrackMultiBarRest?.has(i.index) === !0),
            s.trackViewGroups.push(n),
            r.push(s);
        }
        B.writeInt32BE(e, r.length);
        for (let i of r) {
          e.writeByte(i.isMultiRest ? 1 : 0),
            B.writeInt32BE(e, i.trackViewGroups.length);
          for (let n of i.trackViewGroups) {
            let s = 0;
            n.showStandardNotation && (s = s | 1),
              n.showTablature && (s = s | 2),
              n.showSlash && (s = s | 4),
              n.showNumbered && (s = s | 8),
              e.writeByte(s);
          }
        }
        return B.writeInt32BE(e, 1), e.toArray();
      }
    };
  var Ap = class {
      constructor() {
        this.trackViewGroups = [];
      }
    },
    Cp = class {
      constructor() {
        this.isVisible = !1;
      }
    };
  var xn = class {
    constructor(t, e) {
      this.zoomLevel = 4;
      this.view = 0;
      this.muiltiVoiceCursor = !1;
      this.scoreViews = [];
      let r = Se.fromBuffer(e);
      (this.zoomLevel = B.readInt32BE(r)),
        (this.view = r.readByte()),
        (this.muiltiVoiceCursor = r.readByte() !== 0);
      let i = t.scoreViews.length;
      for (let n = 0; n < i; n++) {
        let s = new Ap();
        this.scoreViews.push(s);
        let a = t.scoreViews[n];
        for (let o = 0; o < a.trackViewGroups.length; o++) {
          let l = new Cp();
          (l.isVisible = r.readByte() !== 0), s.trackViewGroups.push(l);
        }
      }
    }
    apply(t) {
      if (this.scoreViews.length > 0) {
        let e = 0;
        for (let r of this.scoreViews[0].trackViewGroups) {
          if (e < t.tracks.length) {
            let i = t.tracks[e];
            i.isVisibleOnMultiTrack = r.isVisible;
          }
          e++;
        }
      }
    }
    static writeForScore(t) {
      let e = Se.withCapacity(128);
      B.writeInt32BE(e, 4), e.writeByte(0);
      let r = t.tracks.length > 0 && t.tracks[0].staves[0].bars[0].isMultiVoice;
      e.writeByte(r ? 255 : 0);
      for (let i of t.tracks) e.writeByte(i.isVisibleOnMultiTrack ? 255 : 0);
      for (let i of t.tracks) e.writeByte(255);
      return e.toArray();
    }
  };
  var hu = class extends Kt {
    get name() {
      return "Guitar Pro 7-8";
    }
    readScore() {
      w.debug(this.name, "Loading ZIP entries");
      let t = new Tn(this.data),
        e;
      try {
        e = t.read();
      } catch (c) {
        throw new ke("No Zip archive", c);
      }
      w.debug(this.name, "Zip entries loaded");
      let r = null,
        i = null,
        n = null,
        s = null,
        a = new Map();
      for (let c of e)
        switch ((a.set(c.fullName, c), c.fileName)) {
          case "score.gpif":
            r = B.toString(c.data, this.settings.importer.encoding);
            break;
          case "BinaryStylesheet":
            i = c.data;
            break;
          case "PartConfiguration":
            n = c.data;
            break;
          case "LayoutConfiguration":
            s = c.data;
            break;
        }
      if (!r) throw new ke("No score.gpif found in zip archive");
      w.debug(this.name, "Start Parsing score.gpif");
      let o = new js();
      (o.loadAsset = (c) => {
        if (a.has(c)) return a.get(c).data;
      }),
        o.parseXml(r, this.settings),
        w.debug(this.name, "score.gpif parsed");
      let l = o.score;
      i &&
        (w.debug(this.name, "Start Parsing BinaryStylesheet"),
        new kn(i).apply(l),
        w.debug(this.name, "BinaryStylesheet parsed"));
      let u = null;
      return (
        n &&
          (w.debug(this.name, "Start Parsing Part Configuration"),
          (u = new _n(n)),
          u.apply(l),
          w.debug(this.name, "Part Configuration parsed")),
        s &&
          u != null &&
          (w.debug(this.name, "Start Parsing Layout Configuration"),
          new xn(u, s).apply(l),
          w.debug(this.name, "Layout Configuration parsed")),
        l
      );
    }
  };
  var hs = class extends te {
    constructor() {
      super(1, "Unexpected end of data within reader");
    }
  };
  var Bo = class Bo {
    constructor(t) {
      this._currentByte = 0;
      this._position = Bo._byteSize;
      this._source = t;
    }
    readByte() {
      return this.readBits(8);
    }
    readBytes(t) {
      let e = new Uint8Array(t);
      for (let r = 0; r < t; r++) e[r] = this.readByte() & 255;
      return e;
    }
    readBits(t) {
      let e = 0,
        r = t - 1;
      for (; r >= 0; ) (e = e | (this.readBit() << r)), r--;
      return e;
    }
    readBitsReversed(t) {
      let e = 0;
      for (let r = 0; r < t; r++) e = e | (this.readBit() << r);
      return e;
    }
    readBit() {
      if (this._position >= 8) {
        if (
          ((this._currentByte = this._source.readByte()),
          this._currentByte === -1)
        )
          throw new hs();
        this._position = 0;
      }
      let t = (this._currentByte >> (Bo._byteSize - this._position - 1)) & 1;
      return this._position++, t;
    }
    readAll() {
      let t = Se.empty();
      try {
        for (;;) t.writeByte(this.readByte() & 255);
      } catch (e) {
        if (!(e instanceof hs)) throw e;
      }
      return t.toArray();
    }
  };
  Bo._byteSize = 8;
  var mu = Bo;
  var Mp = class {
      constructor() {
        this.fileName = "";
        this.fileSize = 0;
        this.data = null;
      }
    },
    ea = class {
      constructor() {
        this.files = [];
        (this.files = []), (this.fileFilter = (t) => !0);
      }
      load(t) {
        let e = new mu(t);
        this._readBlock(e);
      }
      readHeader(t) {
        return this._getString(t.readBytes(4), 0, 4);
      }
      decompress(t, e = !1) {
        let r = Se.empty(),
          i,
          n = this._getInteger(t.readBytes(4), 0);
        try {
          for (; r.length < n; )
            if (t.readBits(1) === 1) {
              let c = t.readBits(4),
                d = t.readBitsReversed(c),
                h = t.readBitsReversed(c),
                f = r.length - d,
                b = Math.min(d, h);
              (i = r.getBuffer()), r.write(i, f, b);
            } else {
              let c = t.readBitsReversed(2);
              for (let d = 0; d < c; d++) r.writeByte(t.readByte());
            }
        } catch (u) {
          if (!(u instanceof hs)) throw u;
        }
        i = r.getBuffer();
        let s = e ? 4 : 0,
          a = r.length - s,
          o = new Uint8Array(a),
          l = a;
        return o.set(i.subarray(s, s + l), 0), o;
      }
      _readBlock(t) {
        let e = this.readHeader(t);
        if (e === "BCFZ") this._readUncompressedBlock(this.decompress(t, !0));
        else if (e === "BCFS") this._readUncompressedBlock(t.readAll());
        else throw new ke("Unsupported format");
      }
      _readUncompressedBlock(t) {
        let r = 4096;
        for (; r + 3 < t.length; ) {
          if (this._getInteger(t, r) === 2) {
            let n = new Mp();
            (n.fileName = this._getString(t, r + 4, 127)),
              (n.fileSize = this._getInteger(t, r + 140));
            let s = !this.fileFilter || this.fileFilter(n.fileName);
            s && this.files.push(n);
            let a = r + 148,
              o = 0,
              l = 0,
              u = s ? Se.withCapacity(n.fileSize) : null;
            for (; (o = this._getInteger(t, a + 4 * l++)), o !== 0; )
              (r = o * 4096), s && u.write(t, r, 4096);
            if (s) {
              n.data = new Uint8Array(Math.min(n.fileSize, u.length));
              let c = u.toArray();
              n.data.set(c.subarray(0, 0 + n.data.length), 0);
            }
          }
          r += 4096;
        }
      }
      _getString(t, e, r) {
        let i = "";
        for (let n = 0; n < r; n++) {
          let s = t[e + n] & 255;
          if (s === 0) break;
          i += String.fromCharCode(s);
        }
        return i;
      }
      _getInteger(t, e) {
        return (t[e + 3] << 24) | (t[e + 2] << 16) | (t[e + 1] << 8) | t[e];
      }
    };
  (ea.HeaderBcFs = "BCFS"), (ea.HeaderBcFz = "BCFZ");
  var fu = class extends Kt {
    get name() {
      return "Guitar Pro 6";
    }
    readScore() {
      w.debug(this.name, "Loading GPX filesystem");
      let t = new ea();
      (t.fileFilter = (l) =>
        l.endsWith("score.gpif") ||
        l.endsWith("BinaryStylesheet") ||
        l.endsWith("PartConfiguration") ||
        l.endsWith("LayoutConfiguration")),
        t.load(this.data),
        w.debug(this.name, "GPX filesystem loaded");
      let e = null,
        r = null,
        i = null,
        n = null;
      for (let l of t.files)
        switch (l.fileName) {
          case "score.gpif":
            e = B.toString(l.data, this.settings.importer.encoding);
            break;
          case "BinaryStylesheet":
            r = l.data;
            break;
          case "PartConfiguration":
            i = l.data;
            break;
          case "LayoutConfiguration":
            n = l.data;
            break;
        }
      if (!e) throw new ke("No score.gpif found in GPX");
      w.debug(this.name, "Start Parsing score.gpif");
      let s = new js();
      s.parseXml(e, this.settings), w.debug(this.name, "score.gpif parsed");
      let a = s.score;
      r &&
        (w.debug(this.name, "Start Parsing BinaryStylesheet"),
        new kn(r).apply(a),
        w.debug(this.name, "BinaryStylesheet parsed"));
      let o = null;
      return (
        i &&
          (w.debug(this.name, "Start Parsing Part Configuration"),
          (o = new _n(i)),
          o.apply(a),
          w.debug(this.name, "Part Configuration parsed")),
        n &&
          o != null &&
          (w.debug(this.name, "Start Parsing Layout Configuration"),
          new xn(o, n).apply(a),
          w.debug(this.name, "Layout Configuration parsed")),
        a
      );
    }
  };
  var Ip = class {
      constructor() {
        this.maxLine = -1e3;
        this.maxLineNote = null;
        this.minLine = -1e3;
        this.minLineNote = null;
      }
    },
    Zt = class Zt {
      constructor(t) {
        this._registeredAccidentals = new Map();
        this._appliedScoreLines = new Map();
        this._appliedScoreLinesByValue = new Map();
        this._notesByValue = new Map();
        this._beatLines = new Map();
        this.maxLineBeat = null;
        this.minLineBeat = null;
        this.maxLine = -1e3;
        this.minLine = -1e3;
        (this._barRenderer = t), (this._bar = t.bar);
      }
      static getPercussionLine(t, e) {
        return e < t.staff.track.percussionArticulations.length
          ? t.staff.track.percussionArticulations[e].staffLine
          : He.getArticulationByInputMidiNumber(e)?.staffLine ?? 0;
      }
      static getNoteValue(t) {
        if (t.isPercussion) return t.percussionArticulation;
        let e = t.displayValue;
        switch (t.accidentalMode) {
          case 6:
            e += 2;
            break;
          case 4:
            e -= 2;
            break;
          case 5:
            e += 1;
            break;
          case 3:
            e -= 1;
            break;
        }
        return e;
      }
      applyAccidental(t) {
        let e = Zt.getNoteValue(t),
          r = t.hasQuarterToneOffset;
        return this._getAccidental(e, r, t.beat, !1, t);
      }
      applyAccidentalForValue(t, e, r, i) {
        return this._getAccidental(e, r, t, i, null);
      }
      static computeLineWithoutAccidentals(t, e) {
        let r = 0,
          i = Zt.getNoteValue(e);
        return (
          e.isPercussion
            ? (r = Zt.getPercussionLine(t, i))
            : (r = Zt.calculateNoteSteps(t.keySignature, t.clef, i)),
          r
        );
      }
      _getAccidental(t, e, r, i, n = null) {
        let s = 0,
          a = 0;
        if (n != null ? n.isPercussion : this._bar.staff.isPercussion)
          s = Zt.getPercussionLine(this._bar, t);
        else {
          let l = n ? n.accidentalMode : 0;
          s = Zt.calculateNoteSteps(this._bar.keySignature, this._bar.clef, t);
          let u = this._registeredAccidentals.has(s)
            ? this._registeredAccidentals.get(s)
            : null;
          a = A.computeAccidental(this._bar.keySignature, l, t, e, u);
          let c = !1;
          switch (a) {
            case 4:
            case 5:
            case 6:
              break;
            default:
              if (n && n.isTieDestination && n.beat.index === 0) {
                let d =
                  this._barRenderer.scoreRenderer.layout?.getRendererForBar(
                    this._barRenderer.staff.staffId,
                    n.tieOrigin.beat.voice.bar
                  );
                d &&
                  d.staff === this._barRenderer.staff &&
                  d.accidentalHelper.getNoteLine(n.tieOrigin) === s &&
                  (c = !0);
              }
              c ? (a = 0) : a !== 0 && this._registeredAccidentals.set(s, a);
              break;
          }
        }
        return (
          n
            ? (this._appliedScoreLines.set(n.id, s),
              this._notesByValue.set(t, n))
            : this._appliedScoreLinesByValue.set(t, s),
          (this.minLine === -1e3 || this.minLine < s) &&
            ((this.minLine = s), (this.minLineBeat = r)),
          (this.maxLine === -1e3 || this.maxLine > s) &&
            ((this.maxLine = s), (this.maxLineBeat = r)),
          i || this._registerLine(r, s, n),
          a
        );
      }
      _registerLine(t, e, r) {
        let i;
        this._beatLines.has(t.id)
          ? (i = this._beatLines.get(t.id))
          : ((i = new Ip()), this._beatLines.set(t.id, i)),
          (i.minLine === -1e3 || e < i.minLine) &&
            ((i.minLine = e), (i.minLineNote = r)),
          (i.minLine === -1e3 || e > i.maxLine) &&
            ((i.maxLine = e), (i.maxLineNote = r));
      }
      getMaxLine(t) {
        return this._beatLines.has(t.id)
          ? this._beatLines.get(t.id).maxLine
          : 0;
      }
      getMaxLineNote(t) {
        return this._beatLines.has(t.id)
          ? this._beatLines.get(t.id).maxLineNote
          : null;
      }
      getMinLine(t) {
        return this._beatLines.has(t.id)
          ? this._beatLines.get(t.id).minLine
          : 0;
      }
      getMinLineNote(t) {
        return this._beatLines.has(t.id)
          ? this._beatLines.get(t.id).minLineNote
          : null;
      }
      static calculateNoteSteps(t, e, r) {
        let i = r,
          n = t,
          s = e,
          a = i % 12,
          o = ((i / 12) | 0) - 1,
          l = Zt._octaveSteps[s];
        l -= o * Zt._stepsPerOctave;
        let u =
          A.keySignatureIsSharp(n) || A.keySignatureIsNatural(n)
            ? Zt.sharpNoteSteps
            : Zt.flatNoteSteps;
        return (l -= u[a]), l;
      }
      getNoteLine(t) {
        return this._appliedScoreLines.get(t.id);
      }
      getNoteLineForValue(t, e = !1) {
        return this._appliedScoreLinesByValue.has(t)
          ? this._appliedScoreLinesByValue.get(t)
          : e && this._notesByValue.has(t)
          ? this.getNoteLine(this._notesByValue.get(t))
          : 0;
      }
    };
  (Zt._stepsPerOctave = 7),
    (Zt._octaveSteps = [38, 32, 30, 26, 38]),
    (Zt.sharpNoteSteps = [0, 0, 1, 1, 2, 3, 3, 4, 4, 5, 5, 6]),
    (Zt.flatNoteSteps = [0, 1, 1, 2, 2, 3, 4, 4, 5, 5, 6, 6]);
  var pr = Zt;
  var Lp = class {
      constructor() {
        this.currentDynamics = 5;
        this.slideOrigins = new Map();
        this.transpose = 0;
        this.isExplicitlyBeamed = !1;
        (this.tieStarts = new Set()),
          (this.tieStartIds = new Map()),
          (this.slideOrigins = new Map()),
          (this.slurStarts = new Map());
      }
    },
    Dp = class extends W {
      constructor() {
        super(...arguments);
        this.outputMidiChannel = -1;
        this.outputMidiProgram = -1;
        this.outputMidiBank = -1;
        this.outputVolume = -1;
        this.outputBalance = -1;
      }
    },
    gu = class gu {
      constructor(t) {
        this.instruments = new Map();
        this._instrumentIdToArticulationIndex = new Map();
        this._lyricsLine = 0;
        this._lyricsLines = new Map();
        this.track = t;
      }
      getLyricLine(t) {
        if (this._lyricsLines.has(t)) return this._lyricsLines.get(t);
        let e = this._lyricsLine;
        return this._lyricsLines.set(t, e), this._lyricsLine++, e;
      }
      getOrCreateArticulation(t, e) {
        let r = e.octave * 12 + e.tone,
          i = `${t}_${r}`;
        if (this._instrumentIdToArticulationIndex.has(i))
          return this._instrumentIdToArticulationIndex.get(i);
        let n;
        this.instruments.has(t)
          ? (n = this.instruments.get(t))
          : (n = gu._defaultNoteArticulation);
        let s = this.track.percussionArticulations.length,
          a = e.beat.voice.bar,
          o;
        r === 0
          ? (o = 4)
          : (o = pr.calculateNoteSteps(a.keySignature, a.clef, r));
        let c = 9 - (e.beat.voice.bar.staff.standardNotationLineCount * 2 - 1),
          d = o - c,
          h = new W(
            n.elementType,
            d,
            n.outputMidiNumber,
            n.noteHeadDefault,
            n.noteHeadHalf,
            n.noteHeadWhole,
            n.techniqueSymbol,
            n.techniqueSymbolPlacement
          );
        return (
          this._instrumentIdToArticulationIndex.set(i, s),
          this.track.percussionArticulations.push(h),
          s
        );
      }
    };
  gu._defaultNoteArticulation = new W("Default", 0, 0, 57508, 57507, 57506);
  var Fp = gu,
    Te = class Te extends Kt {
      constructor() {
        super(...arguments);
        this._idToTrackInfo = new Map();
        this._indexToTrackInfo = new Map();
        this._staffToContext = new Map();
        this._divisionsPerQuarterNote = 1;
        this._currentDynamics = 5;
        this._musicalPosition = 0;
        this._lastBeat = null;
        this._nextMasterBarRepeatEnding = 0;
        this._nextBeatAutomations = null;
        this._nextBeatChord = null;
        this._nextBeatCrescendo = null;
        this._nextBeatLetRing = !1;
        this._nextBeatPalmMute = !1;
        this._nextBeatOttavia = null;
        this._nextBeatText = null;
        this._simileMarkAllStaves = null;
        this._simileMarkPerStaff = null;
        this._isBeatSlash = !1;
        this._keyAllStaves = null;
        this._currentTrillStep = -1;
      }
      get name() {
        return "MusicXML";
      }
      readScore() {
        let e = this._extractMusicXml(),
          r = new pi();
        try {
          r.parse(e);
        } catch (i) {
          throw new ke("Unsupported format", i);
        }
        return (
          (this._score = new tt()),
          (this._score.stylesheet.hideDynamics = !0),
          this._parseDom(r),
          A.consolidate(this._score),
          this._score.finish(this.settings),
          this._score.rebuildRepeatGroups(),
          this._score
        );
      }
      _extractMusicXml() {
        let e = new Tn(this.data),
          r;
        try {
          r = e.read();
        } catch {
          r = [];
        }
        if (r.length === 0)
          return (
            this.data.reset(),
            B.toString(this.data.readAll(), this.settings.importer.encoding)
          );
        let i = r.find((u) => u.fullName === "META-INF/container.xml");
        if (!i) throw new ke("No compressed MusicXML");
        let n = new pi();
        try {
          n.parse(B.toString(i.data, this.settings.importer.encoding));
        } catch (u) {
          throw new ke("Malformed container.xml, could not parse as XML", u);
        }
        let s = n.firstElement;
        if (!s || s.localName !== "container")
          throw new ke("Malformed container.xml, root element not 'container'");
        let a = s.findChildElement("rootfiles");
        if (!a)
          throw new ke(
            "Malformed container.xml, 'container/rootfiles' not found"
          );
        let o = "";
        for (let u of a.childElements())
          if (u.localName === "rootfile") {
            o = u.getAttribute("full-path");
            break;
          }
        if (!o)
          throw new ke("Unsupported compressed MusicXML, missing rootfile");
        let l = r.find((u) => u.fullName === o);
        if (!l)
          throw new ke(`Malformed container.xml, '${o}' not contained in zip`);
        return B.toString(l.data, this.settings.importer.encoding);
      }
      _parseDom(e) {
        let r = e.firstElement;
        if (!r) throw new ke("Unsupported format");
        switch (r.localName) {
          case "score-partwise":
            this._parsePartwise(r);
            break;
          case "score-timewise":
            this._parseTimewise(r);
            break;
          default:
            throw new ke("Unsupported format");
        }
      }
      _parsePartwise(e) {
        for (let r of e.childElements())
          switch (r.localName) {
            case "credit":
              this._parseCredit(r);
              break;
            case "identification":
              this._parseIdentification(r);
              break;
            case "movement-title":
              this._parseMovementTitle(r);
              break;
            case "part":
              this._parsePartwisePart(r);
              break;
            case "part-list":
              this._parsePartList(r);
              break;
            case "work":
              this._parseWork(r);
              break;
          }
      }
      _parseTimewise(e) {
        let r = 0;
        for (let i of e.childElements())
          switch (i.localName) {
            case "credit":
              this._parseCredit(i);
              break;
            case "identification":
              this._parseIdentification(i);
              break;
            case "movement-title":
              this._parseMovementTitle(i);
              break;
            case "part-list":
              this._parsePartList(i);
              break;
            case "work":
              this._parseWork(i);
              break;
            case "measure":
              this._parseTimewiseMeasure(i, r), r++;
              break;
          }
      }
      _parseCredit(e) {
        if (e.getAttribute("page", "1") !== "1") return;
        let r = [],
          i = null,
          n = "";
        for (let s of e.childElements())
          switch (s.localName) {
            case "credit-type":
              r.push(s.innerText);
              break;
            case "credit-words":
              i === null && (i = s), (n += s.innerText);
              break;
          }
        if (r.length > 0)
          for (let s of r)
            switch (s) {
              case "title":
                this._score.title = Te._sanitizeDisplay(n);
                break;
              case "subtitle":
                this._score.subTitle = Te._sanitizeDisplay(n);
                break;
              case "composer":
                this._score.artist = Te._sanitizeDisplay(n);
                break;
              case "arranger":
                this._score.artist = Te._sanitizeDisplay(n);
                break;
              case "lyricist":
                this._score.words = Te._sanitizeDisplay(n);
                break;
              case "rights":
                this._score.copyright = Te._sanitizeDisplay(n);
                break;
              case "part name":
                break;
            }
        else if (i) {
          let s = i.getAttribute("font-size", "0"),
            a = i.getAttribute("font-size", "top"),
            o = i.getAttribute("halign", "left");
          if (a === "top") {
            if (
              n.includes("copyright") ||
              n.includes("Copyright") ||
              n.includes("\xA9") ||
              n.includes("(c)") ||
              n.includes("(C)")
            ) {
              this._score.copyright = Te._sanitizeDisplay(n);
              return;
            }
            if (o === "center" || s === "center") {
              if (this._score.title.length === 0) {
                this._score.title = Te._sanitizeDisplay(n);
                return;
              }
              if (this._score.subTitle.length === 0) {
                this._score.subTitle = Te._sanitizeDisplay(n);
                return;
              }
              if (this._score.album.length === 0) {
                this._score.album = Te._sanitizeDisplay(n);
                return;
              }
            } else if (
              (o === "right" || s === "right") &&
              this._score.music.length === 0
            ) {
              this._score.music = Te._sanitizeDisplay(n);
              return;
            }
            if (this._score.artist.length === 0) {
              this._score.artist = Te._sanitizeDisplay(n);
              return;
            }
            if (this._score.words.length === 0) {
              this._score.words = Te._sanitizeDisplay(n);
              return;
            }
          }
        }
      }
      static _sanitizeDisplay(e) {
        return e
          .replaceAll("\r", "")
          .replaceAll(
            `
`,
            " "
          )
          .replaceAll("	", "\xA0\xA0")
          .replaceAll(" ", "\xA0");
      }
      _parseIdentification(e) {
        for (let r of e.childElements())
          switch (r.localName) {
            case "creator":
              if (r.attributes.has("type"))
                switch (r.attributes.get("type")) {
                  case "composer":
                    this._score.artist = Te._sanitizeDisplay(r.innerText);
                    break;
                  case "lyricist":
                    this._score.words = Te._sanitizeDisplay(r.innerText);
                    break;
                  case "arranger":
                    this._score.music = Te._sanitizeDisplay(r.innerText);
                    break;
                }
              else this._score.artist = Te._sanitizeDisplay(r.innerText);
              break;
            case "rights":
              this._score.copyright.length > 0 &&
                (this._score.copyright += ", "),
                (this._score.copyright += r.innerText),
                r.attributes.has("type") &&
                  (this._score.copyright += ` (${r.attributes.get("type")})`);
              break;
            case "encoding":
              this._parseEncoding(r);
              break;
          }
      }
      _parseEncoding(e) {
        for (let r of e.childElements())
          switch (r.localName) {
            case "encoder":
              this._score.tab.length > 0 && (this._score.tab += ", "),
                (this._score.tab += r.innerText),
                r.attributes.has("type") &&
                  (this._score.tab += ` (${r.attributes.get("type")})`);
              break;
            case "encoding-description":
              this._score.notices += Te._sanitizeDisplay(r.innerText);
              break;
          }
      }
      _parseMovementTitle(e) {
        this._score.title.length === 0
          ? (this._score.title = Te._sanitizeDisplay(e.innerText))
          : (this._score.subTitle = Te._sanitizeDisplay(e.innerText));
      }
      _parsePartList(e) {
        for (let r of e.childElements())
          r.localName === "score-part" && this._parseScorePart(r);
      }
      _parseScorePart(e) {
        let r = new Tt();
        r.ensureStaveCount(1), this._score.addTrack(r);
        let i = e.attributes.get("id"),
          n = new Fp(r);
        this._idToTrackInfo.set(i, n), this._indexToTrackInfo.set(r.index, n);
        for (let s of e.childElements())
          switch (s.localName) {
            case "part-name":
              r.name = Te._sanitizeDisplay(s.innerText);
              break;
            case "part-name-display":
              r.name = this._parsePartDisplayAsText(s);
              break;
            case "part-abbreviation":
              r.shortName = Te._sanitizeDisplay(s.innerText);
              break;
            case "part-abbreviation-display":
              r.shortName = this._parsePartDisplayAsText(s);
              break;
            case "score-instrument":
              this._parseScoreInstrument(s, n);
              break;
            case "midi-device":
              s.attributes.has("port") &&
                (r.playbackInfo.port = Number.parseInt(
                  s.attributes.get("port"),
                  10
                ));
              break;
            case "midi-instrument":
              this._parseScorePartMidiInstrument(s, n);
              break;
          }
        n.firstArticulation &&
          (n.firstArticulation.outputMidiProgram >= 0 &&
            (r.playbackInfo.program = n.firstArticulation.outputMidiProgram),
          n.firstArticulation.outputMidiBank >= 0 &&
            (r.playbackInfo.bank = n.firstArticulation.outputMidiBank),
          n.firstArticulation.outputBalance >= 0 &&
            (r.playbackInfo.balance = n.firstArticulation.outputBalance),
          n.firstArticulation.outputVolume >= 0 &&
            (r.playbackInfo.volume = n.firstArticulation.outputVolume),
          n.firstArticulation.outputMidiChannel >= 0 &&
            ((r.playbackInfo.primaryChannel =
              n.firstArticulation.outputMidiChannel),
            (r.playbackInfo.secondaryChannel =
              n.firstArticulation.outputMidiChannel)));
      }
      _parseScoreInstrument(e, r) {
        let i = new Dp();
        r.firstArticulation || (r.firstArticulation = i),
          r.instruments.set(e.getAttribute("id", ""), i);
      }
      _parseScorePartMidiInstrument(e, r) {
        let i = e.getAttribute("id", "");
        if (!r.instruments.has(i)) return;
        let n = r.instruments.get(i);
        for (let s of e.childElements())
          switch (s.localName) {
            case "midi-channel":
              n.outputMidiChannel = Number.parseInt(s.innerText, 10) - 1;
              break;
            case "midi-bank":
              n.outputMidiBank = Number.parseInt(s.innerText, 10) - 1;
              break;
            case "midi-program":
              n.outputMidiProgram = Number.parseInt(s.innerText, 10) - 1;
              break;
            case "midi-unpitched":
              n.outputMidiNumber = Number.parseInt(s.innerText, 10) - 1;
              break;
            case "volume":
              n.outputVolume = Te._interpolatePercent(
                Number.parseFloat(s.innerText)
              );
              break;
            case "pan":
              n.outputBalance = Te._interpolatePan(
                Number.parseFloat(s.innerText)
              );
              break;
          }
      }
      static _interpolatePercent(e) {
        return Te._interpolate(0, 100, 0, 16, e) | 0;
      }
      static _interpolatePan(e) {
        return Te._interpolate(-90, 90, 0, 16, e) | 0;
      }
      static _interpolate(e, r, i, n, s) {
        let a = (s - e) / (r - e);
        return i + (n - i) * a;
      }
      _parsePartDisplayAsText(e) {
        let r = "";
        for (let i of e.childElements())
          switch (i.localName) {
            case "display-text":
              r += i.innerText;
              break;
            case "accidental-text":
              switch (i.innerText) {
                case "sharp":
                  r += "\u266F";
                  break;
                case "natural":
                  r += "\u266E";
                  break;
                case "flat":
                  r += "\u266D";
                  break;
                case "double-sharp":
                  r += "\u{1D12A}";
                  break;
                case "sharp-sharp":
                  r += "\u266F\u266F";
                  break;
                case "flat-flat":
                  r += "\u{1D12B}";
                  break;
                case "natural-sharp":
                  r += "\u266E\u266F";
                  break;
                case "natural-flat":
                  r += "\u266E\u266D";
                  break;
                case "sharp-down":
                  r += "\u{1D131}";
                  break;
                case "sharp-up":
                  r += "\u{1D130}";
                  break;
                case "natural-down":
                  r += "\u{1D12F}";
                  break;
                case "natural-up":
                  r += "\u{1D12E}";
                  break;
                case "flat-down":
                  r += "\u{1D12D}";
                  break;
                case "flat-up":
                  r += "\u{1D12C}";
                  break;
                case "arrow-down":
                  r += "\u2193";
                  break;
                case "arrow-up":
                  r += "\u2191";
                  break;
                case "triple-sharp":
                  r += "\u266F\u{1D12A}";
                  break;
                case "triple-flat":
                  r += "\u{1D12C}\u{1D12C}\u{1D12C}";
                  break;
                case "sharp-1":
                  r += "\u266F\xB9";
                  break;
                case "sharp-2":
                  r += "\u266F\xB2";
                  break;
                case "sharp-3":
                  r += "\u266F\xB3";
                  break;
                case "sharp-4":
                  r += "\u266F\u2074";
                  break;
                case "sharp-5":
                  r += "\u266F\u2075";
                  break;
                case "flat-1":
                  r += "\u266D\xB9";
                  break;
                case "flat-2":
                  r += "\u266D\xB2";
                  break;
                case "flat-3":
                  r += "\u266D\xB3";
                  break;
                case "flat-4":
                  r += "\u266D\u2074";
                  break;
                case "flat-5":
                  r += "\u266D\u2075";
                  break;
              }
              break;
          }
        return Te._sanitizeDisplay(r);
      }
      _parseWork(e) {
        for (let r of e.childElements())
          r.localName === "work-title" &&
            (this._score.title = Te._sanitizeDisplay(r.innerText));
      }
      _parsePartwisePart(e) {
        let r = e.attributes.get("id");
        if (!r || !this._idToTrackInfo.has(r)) return;
        let i = this._idToTrackInfo.get(r).track,
          n = 0;
        for (let s of e.childElements())
          s.localName === "measure" &&
            (this._parsePartwiseMeasure(s, i, n), n++);
      }
      _parsePartwiseMeasure(e, r, i) {
        let n = this._getOrCreateMasterBar(e, i);
        this._parsePartMeasure(e, n, r);
      }
      _parseTimewiseMeasure(e, r) {
        let i = this._getOrCreateMasterBar(e, r);
        for (let n of e.childElements())
          n.localName === "part" && this._parseTimewisePart(n, i);
      }
      _getOrCreateMasterBar(e, r) {
        let i = e.attributes.get("implicit") === "yes";
        for (; this._score.masterBars.length <= r; ) {
          let s = new ot();
          i && (s.isAnacrusis = !0),
            this._score.addMasterBar(s),
            s.index > 0 &&
              ((s.timeSignatureDenominator =
                s.previousMasterBar.timeSignatureDenominator),
              (s.timeSignatureNumerator =
                s.previousMasterBar.timeSignatureNumerator),
              (s.tripletFeel = s.previousMasterBar.tripletFeel));
        }
        return this._score.masterBars[r];
      }
      _parseTimewisePart(e, r) {
        let i = e.attributes.get("id");
        if (!i || !this._idToTrackInfo.has(i)) return;
        let n = this._idToTrackInfo.get(i).track;
        this._parsePartMeasure(e, r, n);
      }
      _parsePartMeasure(e, r, i) {
        (this._musicalPosition = 0),
          (this._lastBeat = null),
          (r.alternateEndings = this._nextMasterBarRepeatEnding);
        let n = [];
        for (let a of e.childElements())
          switch (a.localName) {
            case "note":
              this._parseNote(a, r, i);
              break;
            case "backup":
              this._parseBackup(a);
              break;
            case "forward":
              this._parseForward(a);
              break;
            case "direction":
              this._parseDirection(a, r, i);
              break;
            case "attributes":
              this._parseAttributes(a, r, i);
              break;
            case "harmony":
              this._parseHarmony(a, i);
              break;
            case "print":
              this._parsePrint(a, r, i);
              break;
            case "sound":
              this._parseSound(a, r, i);
              break;
            case "barline":
              n.push(a);
              break;
          }
        for (let a of n) this._parseBarLine(a, r, i);
        this._applySimileMarks(r, i);
        let s = this._getOrCreateStaff(i, 0);
        this._getOrCreateBar(s, r), (this._keyAllStaves = null);
      }
      _parsePrint(e, r, i) {
        (e.getAttribute("new-system", "no") === "yes" ||
          e.getAttribute("new-page", "no") === "yes") &&
          i.addLineBreaks(r.index);
      }
      _applySimileMarks(e, r) {
        if (this._simileMarkAllStaves !== null) {
          for (let i of r.staves) {
            let n = this._getOrCreateBar(i, e);
            (n.simileMark = this._simileMarkAllStaves),
              n.simileMark !== 0 && this._clearBar(n);
          }
          this._simileMarkAllStaves === 2
            ? (this._simileMarkAllStaves = 3)
            : (this._simileMarkAllStaves = null);
        }
        if (this._simileMarkPerStaff !== null) {
          let i = Array.from(this._simileMarkPerStaff.keys());
          for (let n of i) {
            let s = this._getOrCreateStaff(r, n),
              a = this._getOrCreateBar(s, e);
            (a.simileMark = this._simileMarkPerStaff.get(n)),
              a.simileMark !== 0 && this._clearBar(a),
              a.simileMark === 2
                ? this._simileMarkPerStaff.set(n, 3)
                : this._simileMarkPerStaff.delete(n);
          }
          this._simileMarkPerStaff.size === 0 &&
            (this._simileMarkPerStaff = null);
        }
      }
      _clearBar(e) {
        for (let r of e.voices) {
          let i = new Me();
          (i.isEmpty = !0), r.addBeat(i);
        }
      }
      _parseBarLine(e, r, i) {
        for (let n of e.childElements())
          switch (n.localName) {
            case "bar-style":
              this._parseBarStyle(n, r, i, e.getAttribute("location", "right"));
              break;
            case "ending":
              this._parseEnding(n, r);
              break;
            case "repeat":
              this._parseRepeat(n, r);
              break;
          }
      }
      _parseRepeat(e, r) {
        let i = e.getAttribute("direction"),
          n = Number.parseInt(e.getAttribute("times"), 10);
        (n < 0 || Number.isNaN(n)) && (n = 2),
          i === "backward"
            ? (r.repeatCount = n)
            : i === "forward" && (r.isRepeatStart = !0);
      }
      _parseEnding(e, r) {
        let i = e
            .getAttribute("number")
            .split(",")
            .map((s) => Number.parseInt(s, 10)),
          n = 0;
        for (let s of i) n = n | ((1 << (s - 1)) & 255);
        switch (((r.alternateEndings = n), e.getAttribute("type", ""))) {
          case "start":
            this._nextMasterBarRepeatEnding =
              this._nextMasterBarRepeatEnding | n;
            break;
          case "stop":
          case "discontinue":
            this._nextMasterBarRepeatEnding =
              this._nextMasterBarRepeatEnding & ~n;
            break;
          case "continue":
            break;
        }
      }
      _parseBarStyle(e, r, i, n) {
        let s = 0;
        switch (e.innerText) {
          case "dashed":
            s = 1;
            break;
          case "dotted":
            s = 2;
            break;
          case "heavy":
            s = 3;
            break;
          case "heavy-heavy":
            s = 4;
            break;
          case "heavy-light":
            s = 5;
            break;
          case "light-heavy":
            s = 6;
            break;
          case "light-light":
            s = 7;
            break;
          case "none":
            s = 8;
            break;
          case "regular":
            s = 9;
            break;
          case "short":
            s = 10;
            break;
          case "tick":
            s = 11;
            break;
        }
        for (let a of i.staves) {
          let o = this._getOrCreateBar(a, r);
          switch (n) {
            case "left":
              o.barLineLeft = s;
              break;
            case "right":
              o.barLineRight = s;
              break;
          }
        }
      }
      _parseSound(e, r, i) {
        for (let n of e.childElements())
          switch (n.localName) {
            case "midi-instrument":
              this._parseSoundMidiInstrument(n, r);
              break;
            case "swing":
              this._parseSwing(n, r);
              break;
            case "offset":
              break;
          }
        if (
          (e.attributes.has("coda") && r.addDirection(3),
          e.attributes.has("tocoda") && r.addDirection(17),
          e.attributes.has("dacapo") && r.addDirection(5),
          e.attributes.has("dalsegno") && r.addDirection(9),
          e.attributes.has("fine") && r.addDirection(0),
          e.attributes.has("segno") && r.addDirection(1),
          e.attributes.has("pan"))
        ) {
          this._nextBeatAutomations || (this._nextBeatAutomations = []);
          let n = new he();
          (n.type = 3),
            (n.value = Te._interpolatePan(
              Number.parseFloat(e.attributes.get("pan"))
            )),
            this._nextBeatAutomations.push(n);
        }
        if (e.attributes.has("tempo")) {
          this._nextBeatAutomations || (this._nextBeatAutomations = []);
          let n = new he();
          (n.type = 0),
            (n.value = Te._interpolatePercent(
              Number.parseFloat(e.attributes.get("tempo"))
            )),
            this._nextBeatAutomations.push(n);
        }
      }
      _parseSwing(e, r) {
        let i = 0,
          n = 0,
          s = null;
        for (let a of e.childElements())
          switch (a.localName) {
            case "straight":
              r.tripletFeel = 0;
              return;
            case "first":
              i = Number.parseInt(a.innerText, 10);
              break;
            case "second":
              n = Number.parseInt(a.innerText, 10);
              break;
            case "swing-type":
              s = this._parseBeatDuration(a);
              break;
          }
        s || (s = 8),
          s === 8
            ? i === 2 && n === 1
              ? (r.tripletFeel = 2)
              : i === 3 && n === 1
              ? (r.tripletFeel = 4)
              : i === 1 && n === 3 && (r.tripletFeel = 6)
            : s === 16 &&
              (i === 2 && n === 1
                ? (r.tripletFeel = 1)
                : i === 3 && n === 1
                ? (r.tripletFeel = 3)
                : i === 1 && n === 3 && (r.tripletFeel = 5));
      }
      _parseSoundMidiInstrument(e, r) {
        let i;
        for (let n of e.childElements())
          switch (n.localName) {
            case "midi-bank":
              this._nextBeatAutomations || (this._nextBeatAutomations = []),
                (i = new he()),
                (i.type = 4),
                (i.value = Number.parseInt(n.innerText, 10) - 1),
                this._nextBeatAutomations.push(i);
              break;
            case "midi-program":
              this._nextBeatAutomations || (this._nextBeatAutomations = []),
                (i = new he()),
                (i.type = 2),
                (i.value = Number.parseInt(n.innerText, 10) - 1),
                this._nextBeatAutomations.push(i);
              break;
            case "volume":
              this._nextBeatAutomations || (this._nextBeatAutomations = []),
                (i = new he()),
                (i.type = 1),
                (i.value = Te._interpolatePercent(
                  Number.parseFloat(n.innerText)
                )),
                this._nextBeatAutomations.push(i);
              break;
            case "pan":
              this._nextBeatAutomations || (this._nextBeatAutomations = []),
                (i = new he()),
                (i.type = 3),
                (i.value = Te._interpolatePan(Number.parseFloat(n.innerText))),
                this._nextBeatAutomations.push(i);
              break;
          }
      }
      _parseHarmony(e, r) {
        let i = new Bt(),
          n = !1,
          s = "";
        for (let a of e.childElements())
          switch (a.localName) {
            case "root":
              i.name = this._parseHarmonyRoot(a);
              break;
            case "kind":
              (i.name = i.name + this._parseHarmonyKind(a)),
                a.getAttribute("parentheses-degrees", "no") === "yes" &&
                  (n = !0);
              break;
            case "frame":
              this._parseHarmonyFrame(a, i);
              break;
            case "degree":
              s += this._parseDegree(a);
              break;
          }
        s && (i.name += n ? `(${s})` : s),
          this._nextBeatChord === null && (this._nextBeatChord = i);
      }
      _parseDegree(e) {
        let r = "",
          i = "",
          n = "";
        for (let s of e.childElements())
          switch (s.localName) {
            case "degree-value":
              r = s.innerText;
              break;
            case "degree-alter":
              switch (s.innerText) {
                case "-1":
                  i = "\u266D";
                  break;
                case "1":
                  i = "\u266F";
                  break;
              }
              break;
            case "degree-type":
              n += s.getAttribute("text", "");
              break;
          }
        return `${n}${i}${r}`;
      }
      _parseHarmonyRoot(e) {
        let r = "",
          i = "";
        for (let n of e.childElements())
          switch (n.localName) {
            case "root-step":
              r = n.innerText;
              break;
            case "root-alter":
              switch (Number.parseFloat(n.innerText)) {
                case -2:
                  i = "bb";
                  break;
                case -1:
                  i = "b";
                  break;
                case 0:
                  i = "";
                  break;
                case 1:
                  i = "#";
                  break;
                case 2:
                  i = "##";
                  break;
              }
              break;
          }
        return r + i;
      }
      _parseHarmonyKind(e) {
        let r = e.getAttribute("text"),
          i = "";
        if (r) i = r;
        else {
          let n = e.innerText;
          switch (n) {
            case "major":
              i = "";
              break;
            case "minor":
              i = "m";
              break;
            case "augmented":
              i = "+";
              break;
            case "diminished":
              i = "\u25CB";
              break;
            case "dominant":
              i = "7";
              break;
            case "major-seventh":
              i = "7M";
              break;
            case "minor-seventh":
              i = "m7";
              break;
            case "diminished-seventh":
              i = "\u25CB7";
              break;
            case "augmented-seventh":
              i = "+7";
              break;
            case "half-diminished":
              i = "\u2349";
              break;
            case "major-minor":
              i = "mMaj";
              break;
            case "major-sixth":
              i = "maj6";
              break;
            case "minor-sixth":
              i = "m6";
              break;
            case "dominant-ninth":
              i = "9";
              break;
            case "major-ninth":
              i = "maj9";
              break;
            case "minor-ninth":
              i = "m9";
              break;
            case "dominant-11th":
              i = "11";
              break;
            case "major-11th":
              i = "maj11";
              break;
            case "minor-11th":
              i = "m11";
              break;
            case "dominant-13th":
              i = "13";
              break;
            case "major-13th":
              i = "maj13";
              break;
            case "minor-13th":
              i = "m13";
              break;
            case "suspended-second":
              i = "sus2";
              break;
            case "suspended-fourth":
              i = "sus4";
              break;
            case "Neapolitan":
              i = "\u266DII";
              break;
            case "Italian":
              i = "It\u207A\u2076";
              break;
            case "French":
              i = "Fr\u207A\u2076";
              break;
            case "German":
              i = "Fr\u207A\u2076";
              break;
            default:
              i = n;
              break;
          }
        }
        return i;
      }
      _parseHarmonyFrame(e, r) {
        for (let i of e.childElements())
          switch (i.localName) {
            case "frame-strings":
              let n = Number.parseInt(i.innerText, 10);
              r.strings = new Array(n);
              for (let o = 0; o < n; o++) r.strings[o] = -1;
              break;
            case "first-fret":
              r.firstFret = Number.parseInt(i.innerText, 10);
              break;
            case "frame-note":
              let s = null,
                a = null;
              for (let o of i.childElements())
                switch (o.localName) {
                  case "string":
                    s = Number.parseInt(o.innerText, 10);
                    break;
                  case "fret":
                    (a = Number.parseInt(o.innerText, 10)),
                      s && a >= 0 && (r.strings[s - 1] = a);
                    break;
                  case "barre":
                    s &&
                      a &&
                      o.getAttribute("type") === "start" &&
                      r.barreFrets.push(a);
                    break;
                }
              break;
          }
      }
      _parseAttributes(e, r, i) {
        let n, s, a;
        if (this._lastBeat == null)
          for (let o of e.childElements())
            switch (o.localName) {
              case "divisions":
                this._divisionsPerQuarterNote = Number.parseFloat(o.innerText);
                break;
              case "key":
                this._parseKey(o, r, i);
                break;
              case "time":
                this._parseTime(o, r);
                break;
              case "staves":
                i.ensureStaveCount(Number.parseInt(o.innerText, 10));
                break;
              case "clef":
                (n = Number.parseInt(o.getAttribute("number", "1"), 10) - 1),
                  (s = this._getOrCreateStaff(i, n)),
                  (a = this._getOrCreateBar(s, r)),
                  this._parseClef(o, a);
                break;
              case "staff-details":
                (n = Number.parseInt(o.getAttribute("number", "1"), 10) - 1),
                  (s = this._getOrCreateStaff(i, n)),
                  this._parseStaffDetails(o, s);
                break;
              case "transpose":
                this._parseTranspose(o, i);
                break;
              case "measure-style":
                this._parseMeasureStyle(o, i, !1);
                break;
            }
        else
          for (let o of e.childElements())
            switch (o.localName) {
              case "divisions":
                this._divisionsPerQuarterNote = Number.parseFloat(o.innerText);
                break;
              case "measure-style":
                this._parseMeasureStyle(o, i, !0);
                break;
            }
      }
      _parseMeasureStyle(e, r, i) {
        for (let n of e.childElements())
          switch (n.localName) {
            case "measure-repeat":
              if (!i) {
                let s = null;
                switch (n.getAttribute("type")) {
                  case "start":
                    switch (
                      Number.parseInt(n.getAttribute("slashes", "1"), 10)
                    ) {
                      case 1:
                        s = 1;
                        break;
                      case 2:
                        s = 2;
                        break;
                      default:
                        break;
                    }
                    break;
                  case "stop":
                    s = null;
                    break;
                }
                if (e.attributes.has("number")) {
                  this._simileMarkPerStaff =
                    this._simileMarkPerStaff ?? new Map();
                  let a = Number.parseInt(e.attributes.get("number"), 10) - 1;
                  s == null
                    ? this._simileMarkPerStaff.delete(a)
                    : this._simileMarkPerStaff.set(a, s);
                } else this._simileMarkAllStaves = s;
              }
              break;
            case "slash":
              switch (n.getAttribute("type")) {
                case "start":
                  this._isBeatSlash = !0;
                  break;
                case "stop":
                  this._isBeatSlash = !1;
                  break;
              }
              break;
          }
      }
      _parseTranspose(e, r) {
        let i = 0;
        for (let n of e.childElements())
          switch (n.localName) {
            case "chromatic":
              i += Number.parseFloat(n.innerText);
              break;
            case "octave-change":
              i += Number.parseFloat(n.innerText) * 12;
              break;
          }
        if (e.attributes.has("number")) {
          let n = this._getOrCreateStaff(
            r,
            Number.parseInt(e.attributes.get("number"), 10) - 1
          );
          (this._getStaffContext(n).transpose = i),
            (n.displayTranspositionPitch = i);
        } else
          for (let n of r.staves)
            (this._getStaffContext(n).transpose = i),
              (n.displayTranspositionPitch = i);
      }
      _parseStaffDetails(e, r) {
        for (let i of e.childElements())
          switch (i.localName) {
            case "staff-lines":
              r.standardNotationLineCount = Number.parseInt(i.innerText, 10);
              break;
            case "staff-tuning":
              this._parseStaffTuning(i, r);
              break;
            case "capo":
              r.capo = Number.parseInt(i.innerText, 10);
              break;
          }
      }
      _parseStaffTuning(e, r) {
        r.stringTuning.tunings.length === 0 &&
          ((r.showTablature = !0),
          (r.showStandardNotation = !1),
          (r.stringTuning.tunings = new Array(r.standardNotationLineCount).fill(
            0
          )));
        let i = Number.parseInt(e.getAttribute("line"), 10),
          n = "C",
          s = "",
          a = 0;
        for (let l of e.childElements())
          switch (l.localName) {
            case "tuning-step":
              n = l.innerText;
              break;
            case "tuning-alter":
              a = Number.parseFloat(l.innerText);
              break;
            case "tuning-octave":
              s = l.innerText;
              break;
          }
        let o = A.getTuningForText(n + s) + a;
        r.tuning[r.tuning.length - i] = o;
      }
      _parseClef(e, r) {
        let i = "s",
          n = 0;
        for (let s of e.childElements())
          switch (s.localName) {
            case "sign":
              i = s.innerText.toLowerCase();
              break;
            case "line":
              n = Number.parseInt(s.innerText, 10);
              break;
            case "clef-octave-change":
              switch (Number.parseInt(s.innerText, 10)) {
                case -2:
                  r.clefOttava = 4;
                  break;
                case -1:
                  r.clefOttava = 3;
                  break;
                case 1:
                  r.clefOttava = 1;
                  break;
                case 2:
                  r.clefOttava = 4;
                  break;
              }
              break;
          }
        switch (i) {
          case "g":
            r.clef = 4;
            break;
          case "f":
            r.clef = 3;
            break;
          case "c":
            n === 3 ? (r.clef = 1) : (r.clef = 2);
            break;
          case "percussion":
            (r.clef = 0), (r.staff.isPercussion = !0);
            break;
          case "tab":
            (r.clef = 4), (r.staff.showTablature = !0);
            break;
          default:
            r.clef = 4;
            break;
        }
      }
      _parseTime(e, r) {
        let i = !1,
          n = !1;
        for (let s of e.childElements()) {
          let a = s.innerText;
          switch (s.localName) {
            case "beats":
              i ||
                (a.indexOf("+") === -1
                  ? (r.timeSignatureNumerator = Number.parseInt(a, 10))
                  : (r.timeSignatureNumerator = a
                      .split("+")
                      .map((o) => Number.parseInt(o, 10))
                      .reduce((o, l) => l + o, 0)),
                (i = !0));
              break;
            case "beat-type":
              n ||
                (a.indexOf("+") === -1
                  ? (r.timeSignatureDenominator = Number.parseInt(a, 10))
                  : (r.timeSignatureDenominator = a
                      .split("+")
                      .map((o) => Number.parseInt(o, 10))
                      .reduce((o, l) => l + o, 0)),
                (n = !0));
              break;
          }
        }
        switch (e.getAttribute("symbol", "")) {
          case "common":
          case "cut":
            r.timeSignatureCommon = !0;
            break;
        }
      }
      _parseKey(e, r, i) {
        let n = -0,
          s = "";
        for (let l of e.childElements())
          switch (l.localName) {
            case "fifths":
              n = Number.parseInt(l.innerText, 10);
              break;
            case "mode":
              s = l.innerText;
              break;
          }
        let a;
        -7 <= n && n <= 7 ? (a = n) : (a = 0);
        let o;
        if ((s === "minor" ? (o = 1) : (o = 0), e.attributes.has("number"))) {
          let l = this._getOrCreateStaff(
              i,
              Number.parseInt(e.attributes.get("number"), 10) - 1
            ),
            u = this._getOrCreateBar(l, r);
          (u.keySignature = a), (u.keySignatureType = o);
        } else {
          this._keyAllStaves = [a, o];
          for (let l of i.staves)
            l.bars.length > r.index &&
              ((l.bars[r.index].keySignature = a),
              (l.bars[r.index].keySignatureType = o));
        }
      }
      _parseDirection(e, r, i) {
        let n = [],
          s = null,
          a = -1,
          o = -1;
        for (let h of e.childElements())
          switch (h.localName) {
            case "direction-type":
              let f = h.firstElement;
              f && n.push(f);
              break;
            case "offset":
              s = Number.parseFloat(h.innerText);
              break;
            case "voice":
              break;
            case "staff":
              a = Number.parseInt(h.innerText, 10) - 1;
              break;
            case "sound":
              h.attributes.has("tempo") &&
                (o = Number.parseFloat(h.attributes.get("tempo")));
              break;
          }
        let l = null;
        a >= 0
          ? (l = this._getOrCreateStaff(i, a))
          : this._lastBeat !== null
          ? (l = this._lastBeat.voice.bar.staff)
          : (l = this._getOrCreateStaff(i, 0));
        let u = l ? this._getOrCreateBar(l, r) : null,
          c = () => {
            let h = this._musicalPosition;
            s !== null && (h += s);
            let f = r.calculateDuration(!1);
            return h / f;
          };
        if (o > 0) {
          let h = new he();
          (h.type = 0),
            (h.value = o),
            (h.ratioPosition = c()),
            this._hasSameTempo(r, h) || r.tempoAutomations.push(h);
        }
        let d = "";
        for (let h of n)
          switch (h.localName) {
            case "rehearsal":
              (r.section = new vr()), (r.section.marker = h.innerText);
              break;
            case "segno":
              r.addDirection(1);
              break;
            case "coda":
              r.addDirection(3);
              break;
            case "words":
              d = h.innerText;
              break;
            case "wedge":
              switch (h.getAttribute("type")) {
                case "crescendo":
                  this._nextBeatCrescendo = 1;
                  break;
                case "diminuendo":
                  this._nextBeatCrescendo = 2;
                  break;
                case "stop":
                  this._nextBeatCrescendo = null;
                  break;
              }
              break;
            case "dynamics":
              let f = this._parseDynamics(h);
              f !== null &&
                ((this._currentDynamics = f),
                (this._score.stylesheet.hideDynamics = !1));
              break;
            case "dashes":
              let b = h.getAttribute("type", "start");
              switch (d) {
                case "LetRing":
                  this._nextBeatLetRing = b === "start" || b === "continue";
                  break;
                case "P.M.":
                  this._nextBeatPalmMute = b === "start" || b === "continue";
                  break;
              }
              d = "";
              break;
            case "pedal":
              let y = this._parsePedal(h);
              if (y && u) {
                y.ratioPosition = c();
                let S =
                  u.sustainPedals.length > 0 &&
                  u.sustainPedals[u.sustainPedals.length - 1].pedalType !== 2;
                (y.pedalType !== 2 || S) && u.sustainPedals.push(y);
              }
              break;
            case "metronome":
              this._parseMetronome(h, r, c());
              break;
            case "octave-shift":
              this._nextBeatOttavia = this._parseOctaveShift(h);
              break;
          }
        d && (this._nextBeatText = d);
      }
      _parseOctaveShift(e) {
        let r = e.getAttribute("type");
        switch (Number.parseInt(e.getAttribute("size", "8"), 10)) {
          case 15:
            switch (r) {
              case "up":
                return 4;
              case "down":
                return 0;
              case "stop":
                return 2;
              case "continue":
                return this._nextBeatOttavia;
            }
            break;
          case 8:
            switch (r) {
              case "up":
                return 3;
              case "down":
                return 1;
              case "stop":
                return 2;
              case "continue":
                return this._nextBeatOttavia;
            }
            break;
        }
        return null;
      }
      _parseMetronome(e, r, i) {
        let n = null,
          s = -1;
        for (let a of e.childElements())
          switch (a.localName) {
            case "beat-unit":
              n = this._parseBeatDuration(a);
              break;
            case "per-minute":
              s = Number.parseFloat(a.innerText);
              break;
          }
        if (n !== null && s > 0) {
          let a = new he();
          (a.type = 0),
            (a.value = (s * (n / 4)) | 0),
            (a.ratioPosition = i),
            this._hasSameTempo(r, a) || r.tempoAutomations.push(a);
        }
      }
      _hasSameTempo(e, r) {
        for (let i of e.tempoAutomations)
          if (r.ratioPosition === i.ratioPosition && r.value === i.value)
            return !0;
        return !1;
      }
      _parsePedal(e) {
        let r = new Xt();
        switch (e.getAttribute("type")) {
          case "start":
            r.pedalType = 0;
            break;
          case "stop":
            r.pedalType = 2;
            break;
          case "continue":
            r.pedalType = 1;
            break;
          default:
            return null;
        }
        return r;
      }
      _parseDynamics(e) {
        for (let r of e.childElements()) {
          let i = r.localName.toUpperCase();
          switch (i) {
            case "PPP":
            case "PP":
            case "P":
            case "MP":
            case "MF":
            case "F":
            case "FF":
            case "FFF":
            case "PPPP":
            case "PPPPP":
            case "PPPPPP":
            case "FFFF":
            case "FFFFF":
            case "FFFFFF":
            case "SF":
            case "SFP":
            case "SFPP":
            case "FP":
            case "RF":
            case "RFZ":
            case "SFZ":
            case "SFFZ":
            case "FZ":
            case "N":
            case "PF":
            case "SFZP":
              return st[i];
          }
        }
        return null;
      }
      _parseForward(e) {
        for (let r of e.childElements())
          r.localName === "duration" &&
            (this._musicalPosition += this._musicXmlDivisionsToAlphaTabTicks(
              Number.parseFloat(r.innerText)
            ));
      }
      _parseBackup(e) {
        for (let r of e.childElements())
          switch (r.localName) {
            case "duration":
              if (this._lastBeat) {
                let n = this._musicalPosition;
                (n -= this._musicXmlDivisionsToAlphaTabTicks(
                  Number.parseFloat(r.innerText)
                )),
                  n < 0 && (n = 0),
                  (this._musicalPosition = n);
              }
              break;
          }
      }
      _getOrCreateStaff(e, r) {
        for (; e.staves.length <= r; ) {
          let i = new _r();
          e.addStaff(i),
            this._score.masterBars.length > 0 &&
              this._getOrCreateBar(
                i,
                this._score.masterBars[this._score.masterBars.length - 1]
              );
        }
        return e.staves[r];
      }
      _getOrCreateBar(e, r) {
        let i = e.bars.length === 0 ? 1 : e.bars[0].voices.length;
        for (; e.bars.length <= r.index; ) {
          let n = new at();
          e.addBar(n),
            n.previousBar &&
              ((n.clef = n.previousBar.clef),
              (n.clefOttava = n.previousBar.clefOttava),
              (n.keySignature = n.previousBar.keySignature),
              (n.keySignatureType = n.previousBar.keySignatureType)),
            this._keyAllStaves != null &&
              ((n.keySignature = this._keyAllStaves[0]),
              (n.keySignatureType = this._keyAllStaves[1]));
          for (let s = 0; s < i; s++) {
            let a = new ze();
            n.addVoice(a);
          }
        }
        return e.bars[r.index];
      }
      _getOrCreateVoice(e, r) {
        let i = !1;
        for (; e.voices.length <= r; ) e.addVoice(new ze()), (i = !0);
        if (i)
          for (let n of e.staff.bars)
            for (; n.voices.length <= r; ) n.addVoice(new ze());
        return e.voices[r];
      }
      _parseNote(e, r, i) {
        let n = null,
          s = 0,
          a = 0,
          o = null,
          l = !1,
          u = 0,
          c = 0,
          d = -1,
          h = null,
          f = 0,
          b = -1,
          y = -1,
          S = null,
          k = null,
          T = !1,
          O = null,
          N = e.getAttribute("print-object", "yes") !== "no",
          R = () => {
            if (n !== null) return;
            l &&
              !this._lastBeat &&
              (w.warning(
                "MusicXML",
                "Malformed MusicXML, <chord /> cannot be set on the first note of a measure"
              ),
              (l = !1)),
              l &&
                !k &&
                (w.warning("MusicXML", "Cannot mix <chord /> and <rest />"),
                (l = !1));
            let g = this._getOrCreateStaff(i, u);
            if (l) {
              (n = this._lastBeat), n.addNote(k);
              return;
            }
            let x = this._getOrCreateBar(g, r),
              M = this._getOrCreateVoice(x, c),
              P =
                M.beats.length === 0
                  ? 0
                  : M.beats[M.beats.length - 1].displayEnd,
              H = this._musicalPosition - P;
            if (H > 0) {
              if (
                this._lastBeat &&
                this._lastBeat.beamingMode === 2 &&
                this._lastBeat.voice.bar.staff.index !== u &&
                M.beats.length > 0 &&
                M.beats[M.beats.length - 1].beamingMode === 2
              ) {
                let U = M.beats[M.beats.length - 1].duration;
                for (; H > 0; ) {
                  let sr = this._createRestForGap(H, U);
                  if (sr !== null)
                    this._insertBeatToVoice(sr, M), (H -= sr.playbackDuration);
                  else break;
                }
              }
              if (H > 0) {
                let U = new Me();
                (U.dynamics = this._currentDynamics),
                  (U.isEmpty = !0),
                  (U.duration = 256),
                  (U.overrideDisplayDuration = H),
                  U.updateDurations(),
                  this._insertBeatToVoice(U, M);
              }
            } else
              H < 0 &&
                w.error(
                  "MusicXML",
                  "Unsupported forward/backup detected. Cannot fill new beats into already filled area of voice"
                );
            d < 0 &&
              h !== null &&
              ((d = E.toTicks(h)), f > 0 && (d = E.applyDot(d, f === 2)));
            let X = new Me();
            (n = X),
              o === null
                ? (X.beamingMode = this._getStaffContext(g).isExplicitlyBeamed
                    ? 1
                    : 0)
                : ((X.beamingMode = o),
                  (this._getStaffContext(g).isExplicitlyBeamed = !0)),
              (X.isEmpty = !1),
              (X.dynamics = this._currentDynamics),
              this._isBeatSlash && (X.slashed = !0);
            let fe = this._nextBeatAutomations;
            if (((this._nextBeatAutomations = null), fe !== null))
              for (let U of fe) X.automations.push(U);
            let Ee = this._nextBeatChord;
            (this._nextBeatChord = null),
              Ee !== null &&
                ((X.chordId = Ee.uniqueId),
                M.bar.staff.hasChord(Ee.uniqueId) ||
                  M.bar.staff.addChord(X.chordId, Ee));
            let be = this._nextBeatCrescendo;
            be !== null && (X.crescendo = be);
            let Ae = this._nextBeatOttavia;
            if (
              (Ae !== null && (X.ottava = Ae),
              (X.isLetRing = this._nextBeatLetRing),
              (X.isPalmMute = this._nextBeatPalmMute),
              this._nextBeatText &&
                ((X.text = this._nextBeatText), (this._nextBeatText = null)),
              k !== null && X.addNote(k),
              this._insertBeatToVoice(X, M),
              k !== null)
            ) {
              k.isVisible = N;
              let U = this._indexToTrackInfo.get(i.index);
              O !== null
                ? (k.percussionArticulation = U.getOrCreateArticulation(O, k))
                : T ||
                  (k.percussionArticulation = U.getOrCreateArticulation("", k));
            }
            s !== 0
              ? ((X.graceType = s),
                this._applyBeatDurationFromTicks(X, a, null, !1))
              : ((X.tupletNumerator = b),
                (X.tupletDenominator = y),
                (X.dots = f),
                (X.preferredBeamDirection = S),
                this._applyBeatDurationFromTicks(X, d, h, !0)),
              (this._musicalPosition = X.displayEnd),
              (this._lastBeat = X);
          };
        for (let g of e.childElements())
          switch (g.localName) {
            case "grace":
              let x = Number.parseFloat(g.getAttribute("make-time", "-1"));
              x >= 0
                ? ((a = this._musicXmlDivisionsToAlphaTabTicks(x)), (s = 2))
                : (s = 1),
                g.getAttribute("slash") === "yes" && (s = 2);
              break;
            case "chord":
              l = !0;
              break;
            case "cue":
              return;
            case "pitch":
              (k = this._parsePitch(g)), (T = !0);
              break;
            case "unpitched":
              k = this._parseUnpitched(g, i);
              break;
            case "rest":
              (k = null), h === null && (h = 1);
              break;
            case "duration":
              d = this._parseDuration(g);
              break;
            case "instrument":
              O = g.getAttribute("id", "");
              break;
            case "voice":
              (c = Number.parseInt(g.innerText, 10)),
                Number.isNaN(c)
                  ? (w.warning(
                      "MusicXML",
                      "Voices need to be specified as numbers"
                    ),
                    (c = 0))
                  : (c = c - 1);
              break;
            case "type":
              h = this._parseBeatDuration(g);
              break;
            case "dot":
              f++;
              break;
            case "accidental":
              k === null
                ? w.warning(
                    "MusicXML",
                    "Malformed MusicXML, missing pitch or unpitched for note"
                  )
                : this._parseAccidental(g, k);
              break;
            case "time-modification":
              for (let M of g.childElements())
                switch (M.localName) {
                  case "actual-notes":
                    b = Number.parseInt(M.innerText, 10);
                    break;
                  case "normal-notes":
                    y = Number.parseInt(M.innerText, 10);
                    break;
                }
              break;
            case "stem":
              S = this._parseStem(g);
              break;
            case "notehead":
              k === null
                ? w.warning(
                    "MusicXML",
                    "Malformed MusicXML, missing pitch or unpitched for note"
                  )
                : this._parseNoteHead(
                    g,
                    k,
                    h ?? 4,
                    S ?? this._estimateBeamDirection(k)
                  );
              break;
            case "staff":
              u = Number.parseInt(g.innerText, 10) - 1;
              break;
            case "beam":
              if (g.getAttribute("number", "1") === "1")
                switch (g.innerText) {
                  case "begin":
                    o = 2;
                    break;
                  case "continue":
                    o = 2;
                    break;
                  case "end":
                    o = 1;
                    break;
                }
              break;
            case "notations":
              R(), this._parseNotations(g, k, n);
              break;
            case "lyric":
              R(), this._parseLyric(g, n, i);
              break;
            case "play":
              this._parsePlay(g, k);
              break;
          }
        if (T) {
          let g = this._getOrCreateStaff(i, u),
            x = this._getStaffContext(g).transpose;
          if (x !== 0) {
            let M = k.octave * 12 + k.tone + x;
            (k.octave = (M / 12) | 0), (k.tone = M - k.octave * 12);
          }
        }
        R();
      }
      _parsePlay(e, r) {
        for (let i of e.childElements())
          switch (i.localName) {
            case "mute":
              r && i.innerText === "palm" && (r.isPalmMute = !0);
              break;
            case "semi-pitched":
              break;
          }
      }
      _estimateBeamDirection(e) {
        return e.calculateRealValue(!1, !1) < Te._b4Value ? 1 : 0;
      }
      _parseNoteHead(e, r, i, n) {
        e.getAttribute("parentheses", "no") === "yes" && (r.isGhost = !0);
        let s = e.getAttribute("filled", ""),
          a;
        switch (
          (s === "yes" ? (a = !0) : s === "no" && (a = !1),
          (r.style = new cn()),
          e.innerText)
        ) {
          case "arrow down":
            (r.style.noteHeadCenterOnStem = !0),
              this._applyNoteHead(r, i, a, 57548, 57540, 57541, 57543);
            break;
          case "arrow up":
            (r.style.noteHeadCenterOnStem = !0),
              this._applyNoteHead(r, i, a, 57530, 57531, 57532, 57534);
            break;
          case "back slashed":
            this._applyNoteHead(r, i, a, 57558, 57556, 57554, 57552);
            break;
          case "circle dot":
            r.style.noteHead = 57621;
            break;
          case "circle-x":
            this._applyNoteHead(r, i, a, 57520, 57521, 57522, 57523);
            break;
          case "circled":
            this._applyNoteHead(r, i, a, 57575, 57574, 57573, 57572);
            break;
          case "cluster":
            this._applyNoteHead(r, i, a, 57640, 57641, 57642, 57643);
            break;
          case "cross":
            this._applyNoteHead(r, i, a, 57516, 57517, 57518, 57519);
            break;
          case "diamond":
            this._applyNoteHead(r, i, a, 57559, 57560, 57561, 57563);
            break;
          case "do":
            this._applyNoteHead(r, i, a, 57786, 57786, 57786, 57787);
            break;
          case "fa":
            n === 0
              ? this._applyNoteHead(r, i, a, 57780, 57780, 57780, 57781)
              : this._applyNoteHead(r, i, a, 57782, 57782, 57782, 57783);
            break;
          case "fa up":
            this._applyNoteHead(r, i, a, 57782, 57782, 57782, 57783);
            break;
          case "inverted triangle":
            this._applyNoteHead(r, i, a, 57548, 57540, 57541, 57543);
            break;
          case "la":
            this._applyNoteHead(r, i, a, 57778, 57778, 57778, 57779);
            break;
          case "left triangle":
            this._applyNoteHead(r, i, a, 57537, 57537, 57537, 57538);
            break;
          case "mi":
            this._applyNoteHead(r, i, a, 57784, 57784, 57784, 57785);
            break;
          case "none":
            r.style.noteHead = 57509;
            break;
          case "normal":
            this._applyNoteHead(r, i, a, 57504, 57506, 57507, 57508);
            break;
          case "re":
            this._applyNoteHead(r, i, a, 57788, 57788, 57788, 57789);
            break;
          case "rectangle":
            this._applyNoteHead(r, i, a, 57528, 57528, 57528, 57529);
            break;
          case "slash":
            this._applyNoteHead(r, i, a, 57602, 57602, 57603, 57601);
            break;
          case "slashed":
            this._applyNoteHead(r, i, a, 57557, 57555, 57553, 57551);
            break;
          case "so":
            this._applyNoteHead(r, i, a, 57776, 57776, 57776, 57777);
            break;
          case "square":
            this._applyNoteHead(r, i, a, 57778, 57778, 57778, 57779);
            break;
          case "ti":
            this._applyNoteHead(r, i, a, 57790, 57790, 57790, 57791);
            break;
          case "triangle":
            this._applyNoteHead(r, i, a, 57530, 57531, 57532, 57534);
            break;
          case "x":
            this._applyNoteHead(r, i, a, 57510, 57511, 57512, 57513);
            break;
        }
      }
      _createRestForGap(e, r) {
        let i = E.toTicks(r);
        for (; i > e; ) {
          if (r === 256) return null;
          (r = r * 2), (i = E.toTicks(r));
        }
        let n = new Me();
        return (
          (n.dynamics = this._currentDynamics),
          (n.isEmpty = !1),
          (n.duration = r),
          (n.overrideDisplayDuration = i),
          n.updateDurations(),
          n
        );
      }
      _insertBeatToVoice(e, r) {
        if (r.beats.length > 0) {
          let i = r.beats[r.beats.length - 1];
          (i.nextBeat = e), (e.previousBeat = i);
          let n = i;
          for (; n !== null && n.graceType !== 0; )
            n.index > 0 ? (n = n.previousBeat) : (n = null);
          n !== null && (e.displayStart = n.displayEnd);
        }
        r.addBeat(e);
      }
      _musicXmlDivisionsToAlphaTabTicks(e) {
        return (e * E.QuarterTime) / this._divisionsPerQuarterNote;
      }
      _parseBeatDuration(e) {
        switch (e.innerText) {
          case "1024th":
            return 256;
          case "512th":
            return 256;
          case "256th":
            return 256;
          case "128th":
            return 128;
          case "64th":
            return 64;
          case "32nd":
            return 32;
          case "16th":
            return 16;
          case "eighth":
            return 8;
          case "quarter":
            return 4;
          case "half":
            return 2;
          case "whole":
            return 1;
          case "breve":
            return -2;
          case "long":
            return -4;
        }
        return null;
      }
      _applyBeatDurationFromTicks(e, r, i, n) {
        if (!i)
          for (let s = 0; s < Te._allDurations.length; s++) {
            let a = Te._allDurationTicks[s];
            if (r >= a) i = Te._allDurations[s];
            else break;
          }
        (e.duration = i ?? 16),
          n && (e.overrideDisplayDuration = r),
          e.updateDurations();
      }
      _parseLyric(e, r, i) {
        let s = this._indexToTrackInfo
          .get(i.index)
          .getLyricLine(e.getAttribute("number", ""));
        for (r.lyrics === null && (r.lyrics = []); r.lyrics.length <= s; )
          r.lyrics.push("");
        for (let a of e.childElements())
          switch (a.localName) {
            case "text":
              r.lyrics[s]
                ? (r.lyrics[s] += ` ${a.innerText}`)
                : (r.lyrics[s] = a.innerText);
              break;
            case "elision":
              r.lyrics[s] += a.innerText;
              break;
          }
      }
      _parseNotations(e, r, i) {
        for (let n of e.childElements())
          switch (n.localName) {
            case "tied":
              r && this._parseTied(n, r, i.voice.bar.staff);
              break;
            case "slur":
              r && this._parseSlur(n, r);
              break;
            case "glissando":
              r && this._parseGlissando(n, r);
              break;
            case "slide":
              r && this._parseSlide(n, r);
              break;
            case "ornaments":
              r && this._parseOrnaments(n, r);
              break;
            case "technical":
              this._parseTechnical(n, r, i);
              break;
            case "articulations":
              r && this._parseArticulations(n, r);
              break;
            case "dynamics":
              let s = this._parseDynamics(n);
              s !== null && ((i.dynamics = s), (this._currentDynamics = s));
              break;
            case "fermata":
              this._parseFermata(n, i);
              break;
            case "arpeggiate":
              this._parseArpeggiate(n, i);
              break;
          }
      }
      _getStaffContext(e) {
        if (!this._staffToContext.has(e)) {
          let r = new Lp();
          return this._staffToContext.set(e, r), r;
        }
        return this._staffToContext.get(e);
      }
      _parseGlissando(e, r) {
        let i = e.getAttribute("type"),
          n = e.getAttribute("number", "1"),
          s = this._getStaffContext(r.beat.voice.bar.staff);
        switch (i) {
          case "start":
            s.slideOrigins.set(n, r);
            break;
          case "stop":
            if (s.slideOrigins.has(n)) {
              let a = s.slideOrigins.get(n);
              (a.slideTarget = r), (r.slideOrigin = a), (a.slideOutType = 1);
            }
            break;
        }
      }
      _parseSlur(e, r) {
        let i = e.getAttribute("number", "1"),
          n = this._getStaffContext(r.beat.voice.bar.staff);
        switch (e.getAttribute("type")) {
          case "start":
            n.slurStarts.set(i, r);
            break;
          case "stop":
            if (n.slurStarts.has(i)) {
              r.isSlurDestination = !0;
              let s = n.slurStarts.get(i);
              (s.slurDestination = r),
                (r.slurOrigin = s),
                n.slurStarts.delete(i);
            }
            break;
        }
      }
      _parseArpeggiate(e, r) {
        switch (e.getAttribute("direction", "down")) {
          case "down":
            r.brushType = 4;
            break;
          case "up":
            r.brushType = 3;
            break;
        }
      }
      _parseFermata(e, r) {
        let i;
        switch (e.innerText) {
          case "normal":
            i = 1;
            break;
          case "angled":
            i = 0;
            break;
          case "square":
            i = 2;
            break;
          default:
            i = 1;
            break;
        }
        (r.fermata = new kr()), (r.fermata.type = i);
      }
      _parseArticulations(e, r) {
        for (let i of e.childElements())
          switch (i.localName) {
            case "accent":
              r.accentuated = 1;
              break;
            case "strong-accent":
              r.accentuated = 2;
              break;
            case "staccato":
              r.isStaccato = !0;
              break;
            case "tenuto":
              r.accentuated = 3;
              break;
          }
      }
      _parseTechnical(e, r, i) {
        let n = [];
        for (let s of e.childElements())
          switch (s.localName) {
            case "up-bow":
              i.pickStroke = 1;
              break;
            case "down-bow":
              i.pickStroke = 2;
              break;
            case "harmonic":
              break;
            case "fingering":
              r && (r.leftHandFinger = this._parseFingering(s));
              break;
            case "pluck":
              r && (r.rightHandFinger = this._parseFingering(s));
              break;
            case "fret":
              r && (r.fret = Number.parseInt(s.innerText, 10));
              break;
            case "string":
              r &&
                (r.string =
                  i.voice.bar.staff.tuning.length -
                  Number.parseInt(s.innerText, 10) +
                  1);
              break;
            case "hammer-on":
            case "pull-off":
              r && (r.isHammerPullOrigin = !0);
              break;
            case "bend":
              n.push(s);
              break;
            case "tap":
              i.tap = !0;
              break;
            case "smear":
              r && (r.vibrato = 1);
              break;
            case "golpe":
              switch (s.getAttribute("placement", "above")) {
                case "above":
                  i.golpe = 2;
                  break;
                case "below":
                  i.golpe = 1;
                  break;
              }
              break;
          }
        r && n.length > 0 && this._parseBends(n, r);
      }
      _parseBends(e, r) {
        let i = I.MaxPosition / e.length,
          n = 0,
          s = 0,
          a = !0;
        for (let o of e) {
          let l = o.findChildElement("bend-alter");
          if (l) {
            let u = Math.round(Math.abs(Number.parseFloat(l.innerText)) * 2);
            o.findChildElement("pre-bend")
              ? a
                ? ((n += u),
                  r.addBendPoint(new I(s, n)),
                  (s += i),
                  r.addBendPoint(new I(s, n)),
                  (a = !1))
                : (s += i)
              : o.findChildElement("release")
              ? (a && (n += u),
                r.addBendPoint(new I(s, n)),
                (s += i),
                (n -= u),
                r.addBendPoint(new I(s, n)),
                (a = !1))
              : (r.addBendPoint(new I(s, n)),
                (n += u),
                (s += i),
                r.addBendPoint(new I(s, n)),
                (a = !1));
          }
        }
      }
      _parseFingering(e) {
        switch (e.innerText) {
          case "0":
            return -1;
          case "1":
          case "p":
          case "t":
            return 0;
          case "2":
          case "i":
            return 1;
          case "3":
          case "m":
            return 2;
          case "4":
          case "a":
            return 3;
          case "5":
          case "c":
            return 4;
        }
        return -2;
      }
      _parseOrnaments(e, r) {
        let i = -1;
        for (let n of e.childElements())
          switch (n.localName) {
            case "trill-mark":
              (i = Number.parseInt(n.getAttribute("trill-step", "2"), 10)),
                r.isStringed
                  ? (r.trillValue = r.stringTuning + i)
                  : r.isPercussion ||
                    (r.trillValue = r.calculateRealValue(!1, !1) + i);
              break;
            case "turn":
              r.ornament = 2;
              break;
            case "inverted-turn":
              r.ornament = 1;
              break;
            case "wavy-line":
              i > 0
                ? n.getAttribute("type") === "start" &&
                  (this._currentTrillStep = i)
                : this._currentTrillStep > 0
                ? n.getAttribute("type") === "stop"
                  ? (this._currentTrillStep = -1)
                  : r.isStringed
                  ? (r.trillValue = r.stringTuning + this._currentTrillStep)
                  : r.isPercussion ||
                    (r.trillValue =
                      r.calculateRealValue(!1, !1) + this._currentTrillStep)
                : (r.vibrato = 1);
              break;
            case "mordent":
              r.ornament = 4;
              break;
            case "inverted-mordent":
              r.ornament = 3;
              break;
            case "tremolo":
              switch (n.innerText) {
                case "1":
                  r.beat.tremoloSpeed = 8;
                  break;
                case "2":
                  r.beat.tremoloSpeed = 16;
                  break;
                case "3":
                  r.beat.tremoloSpeed = 32;
                  break;
              }
              break;
          }
      }
      _parseSlide(e, r) {
        let i = e.getAttribute("type"),
          n = e.getAttribute("number", "1"),
          s = this._getStaffContext(r.beat.voice.bar.staff);
        switch (i) {
          case "start":
            s.slideOrigins.set(n, r);
            break;
          case "stop":
            if (s.slideOrigins.has(n)) {
              let a = s.slideOrigins.get(n);
              (a.slideTarget = r), (r.slideOrigin = a), (a.slideOutType = 1);
            }
            break;
        }
      }
      _parseTied(e, r, i) {
        let n = e.getAttribute("type"),
          s = e.getAttribute("number", ""),
          a = this._getStaffContext(i);
        if (n === "start") {
          if (s) {
            if (a.tieStartIds.has(s)) {
              let o = a.tieStartIds.get(s);
              a.tieStarts.delete(o);
            }
            a.tieStartIds.set(s, r);
          }
          a.tieStarts.add(r);
        } else if (n === "stop" && !r.isTieDestination) {
          let o = null;
          if (s) {
            if (!a.tieStartIds.has(s)) return;
            (o = a.tieStartIds.get(s)),
              a.tieStartIds.delete(s),
              a.tieStarts.delete(r);
          } else {
            let l = this._calculatePitchedNoteValue(r);
            for (let u of a.tieStarts)
              if (this._calculatePitchedNoteValue(u) === l) {
                (o = u), a.tieStarts.delete(o);
                break;
              }
          }
          if (!o) return;
          (r.isTieDestination = !0), (r.tieOrigin = o);
        }
      }
      _parseStem(e) {
        switch (e.innerText) {
          case "down":
            return 1;
          case "up":
            return 0;
          default:
            return null;
        }
      }
      _parseAccidental(e, r) {
        switch (e.innerText) {
          case "sharp":
            r.accidentalMode = 3;
            break;
          case "natural":
            r.accidentalMode = 2;
            break;
          case "flat":
            r.accidentalMode = 5;
            break;
          case "double-sharp":
            r.accidentalMode = 4;
            break;
          case "flat-flat":
            r.accidentalMode = 6;
            break;
        }
      }
      _calculatePitchedNoteValue(e) {
        return e.octave * 12 + e.tone;
      }
      _parseDuration(e) {
        return this._musicXmlDivisionsToAlphaTabTicks(
          Number.parseFloat(e.innerText)
        );
      }
      _parseUnpitched(e, r) {
        let i = "",
          n = 0;
        for (let a of e.childElements())
          switch (a.localName) {
            case "display-step":
              i = a.innerText;
              break;
            case "display-octave":
              n = Number.parseInt(a.innerText, 10) + 1;
              break;
          }
        let s = new Xe();
        if (i === "") (s.octave = 0), (s.tone = 0);
        else {
          let a = n * 12 + (A.getToneForText(i)?.noteValue ?? 0);
          (s.octave = (a / 12) | 0), (s.tone = a - s.octave * 12);
        }
        return s;
      }
      _parsePitch(e) {
        let r = "",
          i = 0,
          n = 0;
        for (let o of e.childElements())
          switch (o.localName) {
            case "step":
              r = o.innerText;
              break;
            case "alter":
              (i = Number.parseFloat(o.innerText)), Number.isNaN(i) && (i = 0);
              break;
            case "octave":
              n = Number.parseInt(o.innerText, 10) + 1;
              break;
          }
        i = i | 0;
        let s = n * 12 + (A.getToneForText(r)?.noteValue ?? 0) + i,
          a = new Xe();
        return (a.octave = (s / 12) | 0), (a.tone = s - a.octave * 12), a;
      }
      _applyNoteHead(e, r, i, n, s, a, o) {
        if (i === void 0)
          switch (r) {
            case -4:
            case -2:
              e.style.noteHead = n;
              break;
            case 1:
              e.style.noteHead = s;
              break;
            case 2:
              e.style.noteHead = a;
              break;
            default:
              e.style.noteHead = o;
              break;
          }
        else if (i === !0) e.style.noteHead = o;
        else
          switch (r) {
            case -4:
            case -2:
              e.style.noteHead = n;
              break;
            case 1:
              e.style.noteHead = s;
              break;
            case 2:
              e.style.noteHead = a;
              break;
            default:
              e.style.noteHead = a;
              break;
          }
      }
    };
  (Te._b4Value = 71),
    (Te._allDurations = [256, 128, 64, 32, 16, 8, 4, 2, 1, -2, -4]),
    (Te._allDurationTicks = Te._allDurations.map((e) => E.toTicks(e)));
  var bu = Te;
  var wn = class {
    constructor(t) {
      this._writePosition = 0;
      this._readPosition = 0;
      this.count = 0;
      this._buffer = new Float32Array(t);
    }
    clear() {
      (this._readPosition = 0),
        (this._writePosition = 0),
        (this.count = 0),
        (this._buffer = new Float32Array(this._buffer.length));
    }
    write(t, e, r) {
      let i = 0;
      r > this._buffer.length - this.count &&
        (r = this._buffer.length - this.count);
      let n = Math.min(this._buffer.length - this._writePosition, r);
      return (
        this._buffer.set(t.subarray(e, e + n), this._writePosition),
        (this._writePosition += n),
        (this._writePosition %= this._buffer.length),
        (i += n),
        i < r &&
          (this._buffer.set(
            t.subarray(e + i, e + i + r - i),
            this._writePosition
          ),
          (this._writePosition += r - i),
          (i = r)),
        (this.count += i),
        i
      );
    }
    read(t, e, r) {
      r > this.count && (r = this.count);
      let i = 0,
        n = Math.min(this._buffer.length - this._readPosition, r);
      return (
        t.set(
          this._buffer.subarray(this._readPosition, this._readPosition + n),
          e
        ),
        (i += n),
        (this._readPosition += n),
        (this._readPosition %= this._buffer.length),
        i < r &&
          (t.set(
            this._buffer.subarray(
              this._readPosition,
              this._readPosition + r - i
            ),
            e + i
          ),
          (this._readPosition += r - i),
          (i = r)),
        (this.count -= i),
        i
      );
    }
  };
  var ut = class ut {
    constructor() {
      this.ready = new Be();
      this.samplesPlayed = new Z();
      this.sampleRequest = new Be();
    }
    get sampleRate() {
      return ut.preferredSampleRate;
    }
    open() {
      w.debug("AlphaSynth", "Initializing synth worker"),
        (this._worker = J.globalThis),
        this._worker.addEventListener(
          "message",
          this._handleMessage.bind(this)
        ),
        this.ready.trigger();
    }
    destroy() {
      this._worker.postMessage({ cmd: "alphaSynth.output.destroy" });
    }
    _handleMessage(t) {
      let e = t.data;
      switch (e.cmd) {
        case ut.CmdOutputSampleRequest:
          this.sampleRequest.trigger();
          break;
        case ut.CmdOutputSamplesPlayed:
          this.samplesPlayed.trigger(e.samples);
          break;
      }
    }
    addSamples(t) {
      this._worker.postMessage({
        cmd: "alphaSynth.output.addSamples",
        samples: J.prepareForPostMessage(t),
      });
    }
    play() {
      this._worker.postMessage({ cmd: "alphaSynth.output.play" });
    }
    pause() {
      this._worker.postMessage({ cmd: "alphaSynth.output.pause" });
    }
    resetSamples() {
      this._worker.postMessage({ cmd: "alphaSynth.output.resetSamples" });
    }
    activate() {}
    async enumerateOutputDevices() {
      return [];
    }
    async setOutputDevice(t) {}
    async getOutputDevice() {
      return null;
    }
  };
  (ut.CmdOutputPrefix = "alphaSynth.output."),
    (ut.CmdOutputAddSamples = `${ut.CmdOutputPrefix}addSamples`),
    (ut.CmdOutputPlay = `${ut.CmdOutputPrefix}play`),
    (ut.CmdOutputPause = `${ut.CmdOutputPrefix}pause`),
    (ut.CmdOutputResetSamples = `${ut.CmdOutputPrefix}resetSamples`),
    (ut.CmdOutputStop = `${ut.CmdOutputPrefix}stop`),
    (ut.CmdOutputSampleRequest = `${ut.CmdOutputPrefix}sampleRequest`),
    (ut.CmdOutputSamplesPlayed = `${ut.CmdOutputPrefix}samplesPlayed`),
    (ut.preferredSampleRate = 0);
  var jt = ut;
  var Rp = class {
      constructor(t) {
        this.isDefault = !1;
        this.device = t;
      }
      get deviceId() {
        return this.device.deviceId;
      }
      get label() {
        return this.device.label;
      }
    },
    ms = class ms {
      static findKnownDevice(t) {
        return ms._knownDevices.find((e) => e.deviceId === t);
      }
      static createAudioContext() {
        if ("AudioContext" in J.globalThis) return new AudioContext();
        if ("webkitAudioContext" in J.globalThis)
          return new webkitAudioContext();
        throw new te(0, "AudioContext not found");
      }
      static async checkSinkIdSupport() {
        return "setSinkId" in ms.createAudioContext()
          ? !0
          : (w.warning(
              "WebAudio",
              "Browser does not support changing the output device"
            ),
            !1);
      }
      static async enumerateOutputDevices() {
        try {
          if (!(await ms.checkSinkIdSupport())) return [];
          try {
            await navigator.mediaDevices.getUserMedia({ audio: !0 });
          } catch (a) {
            w.warning("WebAudio", "Output device permission rejected", a);
          }
          let t = await navigator.mediaDevices.enumerateDevices(),
            e = "",
            r = "",
            i = new Map();
          for (let a of t)
            a.kind === "audiooutput" &&
              (i.set(a.groupId, new Rp(a)),
              (a.deviceId === "default" || a.deviceId === "") &&
                ((e = a.groupId), (r = a.deviceId)));
          let n = Array.from(i.values()),
            s = n.find((a) => a.deviceId === r);
          return (
            s || (s = n.find((a) => a.device.groupId === e)),
            !s && n.length > 0 && (s = n[0]),
            s && (s.isDefault = !0),
            (ms._knownDevices = n),
            n
          );
        } catch (t) {
          return (
            w.error("WebAudio", "Failed to enumerate output devices", t), []
          );
        }
      }
    };
  ms._knownDevices = [];
  var Nr = ms,
    fs = class fs {
      constructor() {
        this.context = null;
        this.buffer = null;
        this.source = null;
        this.ready = new Be();
        this.samplesPlayed = new Z();
        this.sampleRequest = new Be();
      }
      get sampleRate() {
        return this.context ? this.context.sampleRate : fs.PreferredSampleRate;
      }
      activate(t) {
        this.context || (this.context = Nr.createAudioContext()),
          (this.context.state === "suspended" ||
            this.context.state === "interrupted") &&
            (w.debug("WebAudio", "Audio Context is suspended, trying resume"),
            this.context.resume().then(
              () => {
                w.debug(
                  "WebAudio",
                  `Audio Context resume success: state=${this.context?.state}, sampleRate:${this.context?.sampleRate}`
                ),
                  t && t();
              },
              (e) => {
                w.warning(
                  "WebAudio",
                  `Audio Context resume failed: state=${this.context?.state}, sampleRate:${this.context?.sampleRate}, reason=${e}`
                );
              }
            ));
      }
      _patchIosSampleRate() {
        let t = navigator.userAgent;
        if (t.indexOf("iPhone") !== -1 || t.indexOf("iPad") !== -1) {
          let e = Nr.createAudioContext(),
            r = e.createBuffer(1, 1, fs.PreferredSampleRate),
            i = e.createBufferSource();
          (i.buffer = r),
            i.connect(e.destination),
            i.start(0),
            i.disconnect(0),
            e.close();
        }
      }
      open(t) {
        this._patchIosSampleRate(),
          (this.context = Nr.createAudioContext()),
          this.context.state === "suspended" && this._registerResumeHandler();
      }
      _registerResumeHandler() {
        (this._resumeHandler = (() => {
          this.activate(() => {
            this._unregisterResumeHandler();
          });
        }).bind(this)),
          document.body.addEventListener("touchend", this._resumeHandler, !1),
          document.body.addEventListener("click", this._resumeHandler, !1);
      }
      _unregisterResumeHandler() {
        let t = this._resumeHandler;
        t &&
          (document.body.removeEventListener("touchend", t, !1),
          document.body.removeEventListener("click", t, !1));
      }
      play() {
        let t = this.context;
        this.activate(),
          (this.buffer = t.createBuffer(2, fs.BufferSize, t.sampleRate)),
          (this.source = t.createBufferSource()),
          (this.source.buffer = this.buffer),
          (this.source.loop = !0);
      }
      pause() {
        this.source && (this.source.stop(0), this.source.disconnect()),
          (this.source = null);
      }
      destroy() {
        this.pause(),
          this.context?.close(),
          (this.context = null),
          this._unregisterResumeHandler();
      }
      onSamplesPlayed(t) {
        this.samplesPlayed.trigger(t);
      }
      onSampleRequest() {
        this.sampleRequest.trigger();
      }
      onReady() {
        this.ready.trigger();
      }
      enumerateOutputDevices() {
        return Nr.enumerateOutputDevices();
      }
      async setOutputDevice(t) {
        (await Nr.checkSinkIdSupport()) &&
          (t
            ? await this.context.setSinkId(t.deviceId)
            : await this.context.setSinkId(""));
      }
      async getOutputDevice() {
        if (!(await Nr.checkSinkIdSupport())) return null;
        let t = this.context.sinkId;
        if (typeof t != "string" || t === "" || t === "default") return null;
        let e = Nr.findKnownDevice(t);
        if (e) return e;
        let r = await this.enumerateOutputDevices();
        return (
          (e = r.find((i) => i.deviceId === t)),
          e ||
            (w.warning(
              "WebAudio",
              "Could not find output device in device list",
              t,
              r
            ),
            null)
        );
      }
    };
  (fs.BufferSize = 4096), (fs.PreferredSampleRate = 44100);
  var Zr = fs;
  var To = class To {
    static init() {
      var t;
      To._isRegistered ||
        ((To._isRegistered = !0),
        registerProcessor(
          "alphatab",
          ((t = class extends AudioWorkletProcessor {
            constructor(i) {
              super(i);
              this._outputBuffer = new Float32Array(0);
              this._bufferCount = 0;
              this._requestedBufferCount = 0;
              this._isStopped = !1;
              w.debug("WebAudio", "creating processor"),
                (this._bufferCount = Math.floor(
                  (i.processorOptions.bufferTimeInMilliseconds * sampleRate) /
                    1e3 /
                    t.BufferSize
                )),
                (this._circularBuffer = new wn(
                  t.BufferSize * this._bufferCount
                )),
                (this.port.onmessage = this._handleMessage.bind(this));
            }
            _handleMessage(i) {
              let n = i.data;
              switch (n.cmd) {
                case jt.CmdOutputAddSamples:
                  let a = n.samples;
                  this._circularBuffer.write(a, 0, a.length),
                    this._requestedBufferCount--;
                  break;
                case jt.CmdOutputResetSamples:
                  this._circularBuffer.clear();
                  break;
                case jt.CmdOutputStop:
                  this._isStopped = !0;
                  break;
              }
            }
            process(i, n, s) {
              if (n.length !== 1 && n[0].length !== 2) return !1;
              let a = n[0][0],
                o = n[0][1];
              if (!a || !o) return !0;
              let l = a.length + o.length,
                u = this._outputBuffer;
              u.length !== l &&
                ((u = new Float32Array(l)), (this._outputBuffer = u));
              let c = this._circularBuffer.read(
                  u,
                  0,
                  Math.min(u.length, this._circularBuffer.count)
                ),
                d = 0,
                h = Math.min(a.length, c);
              for (let f = 0; f < h; f++) (a[f] = u[d++]), (o[f] = u[d++]);
              if (c < a.length)
                for (let f = c; f < a.length; f++) (a[f] = 0), (o[f] = 0);
              return (
                this.port.postMessage({
                  cmd: jt.CmdOutputSamplesPlayed,
                  samples: c / Q.AudioChannels,
                }),
                this._requestBuffers(),
                this._circularBuffer.count > 0 || !this._isStopped
              );
            }
            _requestBuffers() {
              let i = (this._bufferCount / 2) | 0,
                n = i * t.BufferSize;
              if (
                this._circularBuffer.count +
                  this._requestedBufferCount * t.BufferSize <
                n
              ) {
                for (let a = 0; a < i; a++)
                  this.port.postMessage({ cmd: jt.CmdOutputSampleRequest });
                this._requestedBufferCount += i;
              }
            }
          }),
          (t.BufferSize = 4096),
          t)
        ));
    }
  };
  To._isRegistered = !1;
  var yu = To,
    ta = class extends Zr {
      constructor(e) {
        super();
        this._worklet = null;
        this._bufferTimeInMilliseconds = 0;
        this._settings = e;
      }
      open(e) {
        super.open(e), (this._bufferTimeInMilliseconds = e), this.onReady();
      }
      play() {
        super.play();
        let e = this.context;
        J.createAudioWorklet(e, this._settings).then(
          () => {
            (this._worklet = new AudioWorkletNode(e, "alphatab", {
              numberOfOutputs: 1,
              outputChannelCount: [2],
              processorOptions: {
                bufferTimeInMilliseconds: this._bufferTimeInMilliseconds,
              },
            })),
              (this._worklet.port.onmessage = this._handleMessage.bind(this)),
              this.source.connect(this._worklet),
              this.source.start(0),
              this._worklet.connect(e.destination);
          },
          (r) => {
            w.error("WebAudio", `Audio Worklet creation failed: reason=${r}`);
          }
        );
      }
      _handleMessage(e) {
        let r = e.data;
        switch (r.cmd) {
          case jt.CmdOutputSamplesPlayed:
            this.onSamplesPlayed(r.samples);
            break;
          case jt.CmdOutputSampleRequest:
            this.onSampleRequest();
            break;
        }
      }
      pause() {
        super.pause(),
          this._worklet &&
            (this._worklet.port.postMessage({ cmd: jt.CmdOutputStop }),
            (this._worklet.port.onmessage = null),
            this._worklet.disconnect()),
          (this._worklet = null);
      }
      addSamples(e) {
        this._worklet?.port.postMessage({
          cmd: jt.CmdOutputAddSamples,
          samples: J.prepareForPostMessage(e),
        });
      }
      resetSamples() {
        this._worklet?.port.postMessage({ cmd: jt.CmdOutputResetSamples });
      }
    };
  var ko = ((e) => (
      (e[(e.SingleTrackMultiChannel = 0)] = "SingleTrackMultiChannel"),
      (e[(e.MultiTrack = 1)] = "MultiTrack"),
      e
    ))(ko || {}),
    bs = class {
      constructor() {
        this.events = [];
      }
      addEvent(t) {
        if (
          this.events.length === 0 ||
          t.tick >= this.events[this.events.length - 1].tick
        )
          this.events.push(t);
        else {
          let e = this.events.length;
          for (; e > 0 && this.events[e - 1].tick > t.tick; ) e--;
          this.events.splice(e, 0, t);
        }
      }
      writeTo(t) {
        let e = Se.empty(),
          r = 0;
        for (let s of this.events) {
          let a = s.tick - r;
          Ft.writeVariableInt(e, a), s.writeTo(e), (r = s.tick);
        }
        let i = new Uint8Array([77, 84, 114, 107]);
        t.write(i, 0, i.length);
        let n = e.toArray();
        B.writeInt32BE(t, n.length), t.write(n, 0, n.length);
      }
    },
    Ft = class {
      constructor() {
        this.format = 0;
        this.division = E.QuarterTime;
        this.tracks = [];
      }
      get events() {
        if (this.tracks.length === 1) return this.tracks[0].events;
        let t = [];
        for (let e of this.tracks) this.events.push(...e.events);
        return t.sort((e, r) => e.tick - r.tick), t;
      }
      _ensureTracks(t) {
        for (; this.tracks.length < t; ) this.tracks.push(new bs());
      }
      addEvent(t) {
        this.format === 0
          ? (this._ensureTracks(1), this.tracks[0].addEvent(t))
          : (this._ensureTracks(t.track + 1), this.tracks[t.track].addEvent(t));
      }
      toBinary() {
        let t = Se.empty();
        return this.writeTo(t), t.toArray();
      }
      writeTo(t) {
        let e = new Uint8Array([77, 84, 104, 100]);
        t.write(e, 0, e.length),
          B.writeInt32BE(t, 6),
          B.writeInt16BE(t, this.format),
          B.writeInt16BE(t, this.tracks.length),
          B.writeInt16BE(t, this.division);
        for (let r of this.tracks) r.writeTo(t);
      }
      static writeVariableInt(t, e) {
        let r = new Uint8Array(4),
          i = 0;
        do (r[i++] = e & 127), (e >>= 7);
        while (e > 0);
        for (; i > 0; )
          i--, i > 0 ? t.writeByte(r[i] | 128) : t.writeByte(r[i]);
      }
    };
  var Gn = ((f) => (
      (f[(f.TimeSignature = 88)] = "TimeSignature"),
      (f[(f.NoteOn = 128)] = "NoteOn"),
      (f[(f.NoteOff = 144)] = "NoteOff"),
      (f[(f.ControlChange = 176)] = "ControlChange"),
      (f[(f.ProgramChange = 192)] = "ProgramChange"),
      (f[(f.TempoChange = 81)] = "TempoChange"),
      (f[(f.PitchBend = 224)] = "PitchBend"),
      (f[(f.PerNotePitchBend = 96)] = "PerNotePitchBend"),
      (f[(f.EndOfTrack = 47)] = "EndOfTrack"),
      (f[(f.AlphaTabRest = 241)] = "AlphaTabRest"),
      (f[(f.AlphaTabMetronome = 242)] = "AlphaTabMetronome"),
      (f[(f.SystemExclusive = 240)] = "SystemExclusive"),
      (f[(f.SystemExclusive2 = 247)] = "SystemExclusive2"),
      (f[(f.Meta = 255)] = "Meta"),
      f
    ))(Gn || {}),
    hr = class {
      constructor(t, e, r) {
        (this.track = t), (this.tick = e), (this.type = r);
      }
      get command() {
        return this.type;
      }
      get message() {
        return 0;
      }
      get data1() {
        return 0;
      }
      get data2() {
        return 0;
      }
    },
    Nn = class extends hr {
      constructor(t, e, r, i, n, s) {
        super(t, e, 88),
          (this.track = t),
          (this.tick = e),
          (this.numerator = r),
          (this.denominatorIndex = i),
          (this.midiClocksPerMetronomeClick = n),
          (this.thirtySecondNodesInQuarter = s);
      }
      writeTo(t) {
        t.writeByte(255),
          t.writeByte(88),
          Ft.writeVariableInt(t, 4),
          t.writeByte(this.numerator & 255),
          t.writeByte(this.denominatorIndex & 255),
          t.writeByte(this.midiClocksPerMetronomeClick & 255),
          t.writeByte(this.thirtySecondNodesInQuarter & 255);
      }
    },
    ra = class ra extends hr {
      writeTo(t) {
        t.writeByte(240);
        let e = Se.withCapacity(16);
        e.writeByte(ra.AlphaTabManufacturerId),
          this.writeEventData(e),
          e.writeByte(247),
          Ft.writeVariableInt(t, e.length),
          e.copyTo(t);
      }
    };
  (ra.AlphaTabManufacturerId = 125),
    (ra.MetronomeEventId = 0),
    (ra.RestEventId = 1);
  var En = ra,
    Pn = class extends En {
      constructor(e, r, i, n, s) {
        super(e, r, 242);
        this.isMetronome = !0;
        (this.metronomeNumerator = i),
          (this.metronomeDurationInMilliseconds = s),
          (this.metronomeDurationInTicks = n);
      }
      writeEventData(e) {
        e.writeByte(En.MetronomeEventId),
          e.writeByte(this.metronomeNumerator),
          B.writeInt32LE(e, this.metronomeDurationInTicks),
          B.writeInt32LE(e, this.metronomeDurationInMilliseconds);
      }
    },
    An = class extends En {
      constructor(t, e, r) {
        super(t, e, 241), (this.channel = r);
      }
      writeEventData(t) {
        t.writeByte(En.RestEventId), t.writeByte(this.channel);
      }
    },
    ia = class extends hr {
      constructor(t, e, r, i, n, s) {
        super(t, e, r),
          (this.channel = i),
          (this.noteKey = n),
          (this.noteVelocity = s);
      }
      get data1() {
        return this.noteKey;
      }
      get data2() {
        return this.noteVelocity;
      }
    },
    Cn = class extends ia {
      constructor(t, e, r, i, n) {
        super(t, e, 128, r, i, n);
      }
      writeTo(t) {
        t.writeByte((this.channel & 15) | 144),
          t.writeByte(this.noteKey & 255),
          t.writeByte(this.noteVelocity & 255);
      }
    },
    Mn = class extends ia {
      constructor(t, e, r, i, n) {
        super(t, e, 144, r, i, n);
      }
      writeTo(t) {
        t.writeByte((this.channel & 15) | 128),
          t.writeByte(this.noteKey & 255),
          t.writeByte(this.noteVelocity & 255);
      }
    },
    In = class extends hr {
      constructor(t, e, r, i, n) {
        super(t, e, 176),
          (this.channel = r),
          (this.controller = i),
          (this.value = n);
      }
      writeTo(t) {
        t.writeByte((this.channel & 15) | 176),
          t.writeByte(this.controller & 255),
          t.writeByte(this.value & 255);
      }
      get data1() {
        return this.controller;
      }
      get data2() {
        return this.value;
      }
    },
    Ln = class extends hr {
      constructor(t, e, r, i) {
        super(t, e, 192), (this.channel = r), (this.program = i);
      }
      writeTo(t) {
        t.writeByte((this.channel & 15) | 192), t.writeByte(this.program & 255);
      }
      get data1() {
        return this.program;
      }
    },
    Dn = class extends hr {
      constructor(e, r) {
        super(0, e, 81);
        this.beatsPerMinute = 0;
        this.microSecondsPerQuarterNote = r;
      }
      get microSecondsPerQuarterNote() {
        return 6e7 / this.beatsPerMinute;
      }
      set microSecondsPerQuarterNote(e) {
        this.beatsPerMinute = 6e7 / e;
      }
      writeTo(e) {
        e.writeByte(255),
          e.writeByte(81),
          e.writeByte(3),
          e.writeByte((this.microSecondsPerQuarterNote >> 16) & 255),
          e.writeByte((this.microSecondsPerQuarterNote >> 8) & 255),
          e.writeByte(this.microSecondsPerQuarterNote & 255);
      }
    },
    Fn = class extends hr {
      constructor(t, e, r, i) {
        super(t, e, 224), (this.channel = r), (this.value = i);
      }
      writeTo(t) {
        t.writeByte((this.channel & 15) | 224),
          t.writeByte(this.value & 127),
          t.writeByte((this.value >> 7) & 127);
      }
      get data1() {
        return this.value & 127;
      }
      get data2() {
        return (this.value >> 7) & 127;
      }
    },
    Rn = class extends hr {
      constructor(t, e, r, i, n) {
        super(t, e, 96),
          (this.channel = r),
          (this.noteKey = i),
          (this.value = n);
      }
      writeTo(t) {
        throw new te(
          0,
          "Note Bend (Midi2.0) events cannot be exported to SMF1.0"
        );
      }
    },
    On = class extends hr {
      constructor(t, e) {
        super(t, e, 47);
      }
      writeTo(t) {
        t.writeByte(255), t.writeByte(47), t.writeByte(0);
      }
    };
  var na = class p {
    constructor(t, e) {
      this.time = 0;
      (this.eventIndex = t),
        (this.event = e),
        (this.isMetronome = this.event.type === 242);
    }
    static newMetronomeEvent(t, e, r, i, n) {
      let s = new Pn(0, e, r, i, n);
      return new p(t, s);
    }
  };
  var mi = class {
    constructor() {
      this.masterBarIndex = 0;
      this.masterBarOccurence = 0;
      this.synthBpm = 0;
      this.synthTime = 0;
      this.synthTick = 0;
      this.syncTime = 0;
      this.syncBpm = 0;
    }
    updateSyncBpm(t, e) {
      let r = t - this.synthTime,
        i = e - this.syncTime,
        n = (r / i) * this.synthBpm;
      this.syncBpm = n;
    }
  };
  var Su = class {
      constructor(t, e, r) {
        (this.bpm = t), (this.ticks = e), (this.time = r);
      }
    },
    vo = class {
      constructor() {
        this.tempoChanges = [];
        this.tempoChangeIndex = 0;
        this.syncPoints = [];
        this.firstProgramEventPerChannel = new Map();
        this.firstTimeSignatureNumerator = 0;
        this.firstTimeSignatureDenominator = 0;
        this.synthData = [];
        this.division = E.QuarterTime;
        this.eventIndex = 0;
        this.currentTime = 0;
        this.syncPointIndex = 0;
        this.playbackRange = null;
        this.playbackRangeStartTime = 0;
        this.playbackRangeEndTime = 0;
        this.endTick = 0;
        this.endTime = 0;
        this.currentTempo = 0;
        this.syncPointTempo = 0;
      }
    },
    _o = class {
      constructor(t) {
        this._oneTimeState = null;
        this._countInState = null;
        this.isLooping = !1;
        this.playbackSpeed = 1;
        this.instrumentPrograms = new Set();
        this.percussionKeys = new Set();
        (this._synthesizer = t),
          (this._mainState = new vo()),
          (this._currentState = this._mainState);
      }
      get isPlayingMain() {
        return this._currentState === this._mainState;
      }
      get isPlayingOneTimeMidi() {
        return this._currentState === this._oneTimeState;
      }
      get isPlayingCountIn() {
        return this._currentState === this._countInState;
      }
      get mainPlaybackRange() {
        return this._mainState.playbackRange;
      }
      set mainPlaybackRange(t) {
        (this._mainState.playbackRange = t),
          t &&
            ((this._mainState.playbackRangeStartTime =
              this._tickPositionToTimePositionWithSpeed(
                this._mainState,
                t.startTick,
                1
              )),
            (this._mainState.playbackRangeEndTime =
              this._tickPositionToTimePositionWithSpeed(
                this._mainState,
                t.endTick,
                1
              )));
      }
      get currentTime() {
        return this._currentState.currentTime / this.playbackSpeed;
      }
      get currentEndTick() {
        return this._currentState.endTick;
      }
      get currentEndTime() {
        return this._currentState.endTime / this.playbackSpeed;
      }
      get currentTempo() {
        return this._currentState.currentTempo;
      }
      get modifiedTempo() {
        return this._currentState.syncPointTempo * this.playbackSpeed;
      }
      get syncPointTempo() {
        return this._currentState.syncPointTempo;
      }
      get currentSyncPoints() {
        return this._currentState.syncPoints;
      }
      mainSeek(t) {
        if (
          ((t *= this.playbackSpeed),
          this.mainPlaybackRange &&
            (t < this._mainState.playbackRangeStartTime
              ? (t = this._mainState.playbackRangeStartTime)
              : t > this._mainState.playbackRangeEndTime &&
                (t = this._mainState.playbackRangeEndTime)),
          t > this._mainState.currentTime)
        )
          this._mainSilentProcess(t - this._mainState.currentTime);
        else if (t < this._mainState.currentTime) {
          if (
            ((this._mainState.currentTime = 0),
            (this._mainState.eventIndex = 0),
            (this._mainState.syncPointIndex = 0),
            (this._mainState.tempoChangeIndex = 0),
            (this._mainState.currentTempo =
              this._mainState.tempoChanges[0].bpm),
            (this._mainState.syncPointTempo =
              this._mainState.syncPoints.length > 0
                ? this._mainState.syncPoints[0].syncBpm
                : this._mainState.currentTempo),
            this.isPlayingMain)
          ) {
            let e = this._synthesizer.metronomeVolume;
            this._synthesizer.noteOffAll(!0),
              this._synthesizer.resetSoft(),
              this._synthesizer.setupMetronomeChannel(e);
          }
          this._mainSilentProcess(t);
        }
      }
      _mainSilentProcess(t) {
        if (t <= 0) return;
        let e = Date.now(),
          r = this._mainState.currentTime + t;
        if (this.isPlayingMain)
          for (; this._mainState.currentTime < r; )
            this._fillMidiEventQueueLimited(r - this._mainState.currentTime) &&
              this._synthesizer.synthesizeSilent(Q.MicroBufferSize);
        this._mainState.currentTime = r;
        let i = Date.now() - e;
        w.debug("Sequencer", `Silent seek finished in ${i}ms (main)`);
      }
      loadOneTimeMidi(t) {
        (this._oneTimeState = this.createStateFromFile(t)),
          (this._currentState = this._oneTimeState);
      }
      loadMidi(t) {
        this.instrumentPrograms.clear(),
          this.percussionKeys.clear(),
          (this._mainState = this.createStateFromFile(t)),
          (this._currentState = this._mainState);
      }
      createStateFromFile(t) {
        let e = new vo();
        this.percussionKeys.add(Q.MetronomeKey),
          (e.tempoChanges = []),
          (e.division = t.division),
          (e.eventIndex = 0),
          (e.currentTime = 0),
          (e.synthData = []);
        let r = 120,
          i = 0,
          n = 0,
          s = 0,
          a = 0,
          o = 0,
          l = 0,
          u = 0,
          c = 0;
        for (let d of t.events) {
          let h = new na(e.synthData.length, d);
          e.synthData.push(h);
          let f = d.tick - c;
          if (
            ((i += f),
            (n += f * (6e4 / (r * t.division))),
            (h.time = n),
            (c = d.tick),
            a > 0)
          )
            for (; l < i; ) {
              let b = na.newMetronomeEvent(
                e.synthData.length,
                l,
                Math.floor(l / a) % s,
                a,
                o
              );
              e.synthData.push(b), (b.time = u), (l += a), (u += o);
            }
          if (d.type === 81)
            (r = d.beatsPerMinute),
              e.tempoChanges.push(new Su(r, i, n)),
              (o = a * (6e4 / (r * t.division)));
          else if (d.type === 88) {
            let b = d,
              y = Math.pow(2, b.denominatorIndex);
            (s = b.numerator),
              (a = (e.division * (4 / y)) | 0),
              (o = a * (6e4 / (r * t.division))),
              e.firstTimeSignatureDenominator === 0 &&
                ((e.firstTimeSignatureNumerator = b.numerator),
                (e.firstTimeSignatureDenominator = y));
          } else if (d.type === 192) {
            let b = d,
              y = b.channel;
            e.firstProgramEventPerChannel.has(y) ||
              e.firstProgramEventPerChannel.set(y, h),
              y === Q.PercussionChannel ||
                this.instrumentPrograms.add(b.program);
          } else if (d.type === 128) {
            let b = d;
            b.channel === Q.PercussionChannel &&
              this.percussionKeys.add(b.noteKey);
          }
        }
        return (
          (e.currentTempo =
            e.tempoChanges.length > 0 ? e.tempoChanges[0].bpm : r),
          (e.syncPointTempo = e.currentTempo),
          e.synthData.sort((d, h) =>
            d.time > h.time
              ? 1
              : d.time < h.time
              ? -1
              : d.eventIndex - h.eventIndex
          ),
          (e.endTime = n),
          (e.endTick = i),
          e
        );
      }
      fillMidiEventQueue() {
        return this._fillMidiEventQueueLimited(-1);
      }
      fillMidiEventQueueToEndTime(t) {
        for (; this._mainState.currentTime < t; )
          this._fillMidiEventQueueLimited(t - this._mainState.currentTime) &&
            this._synthesizer.synthesizeSilent(Q.MicroBufferSize);
        let e = !1;
        for (
          this._currentState.currentTime = t;
          this._currentState.eventIndex < this._currentState.synthData.length &&
          this._currentState.synthData[this._currentState.eventIndex].time <
            this._currentState.currentTime;

        ) {
          let r = this._currentState.synthData[this._currentState.eventIndex];
          this._synthesizer.dispatchEvent(r),
            this._currentState.eventIndex++,
            (e = !0);
        }
        return e;
      }
      _fillMidiEventQueueLimited(t) {
        let e =
            (Q.MicroBufferSize / this._synthesizer.outSampleRate) *
            1e3 *
            this.playbackSpeed,
          r = this._internalEndTime;
        t > 0 &&
          (t < e && (e = t),
          (r = Math.min(
            this._internalEndTime,
            this._currentState.currentTime + t
          )));
        let i = !1;
        for (
          this._currentState.currentTime += e;
          this._currentState.eventIndex < this._currentState.synthData.length &&
          this._currentState.synthData[this._currentState.eventIndex].time <
            this._currentState.currentTime &&
          this._currentState.currentTime < r;

        )
          this._synthesizer.dispatchEvent(
            this._currentState.synthData[this._currentState.eventIndex]
          ),
            this._currentState.eventIndex++,
            (i = !0);
        return i;
      }
      mainTickPositionToTimePosition(t) {
        return this._tickPositionToTimePositionWithSpeed(
          this._mainState,
          t,
          this.playbackSpeed
        );
      }
      mainUpdateSyncPoints(t) {
        let e = this._mainState;
        if (
          (t.sort((r, i) => r.synthTick - i.synthTick),
          (e.syncPoints = []),
          t.length >= 0)
        ) {
          let r = 120,
            i = 0,
            n = 0,
            s = 0;
          for (let a = 0; a < t.length; a++) {
            let o = t[a],
              l = 0,
              u,
              c,
              d;
            if (a === 0) (u = r), (c = 0), (d = 0);
            else {
              let h = t[a - 1];
              (u = h.syncBpm), (c = h.syncTime), (d = h.synthTick);
            }
            for (
              ;
              s < e.tempoChanges.length &&
              e.tempoChanges[s].ticks <= o.synthTick;

            ) {
              if (((l = e.tempoChanges[s].ticks - i), l > 0)) {
                (i += l), (n += l * (6e4 / (r * e.division)));
                let h = (o.syncTime - c) / (o.synthTick - d),
                  f = (i - d) * h + c,
                  b = new mi();
                (b.synthTick = i),
                  (b.synthBpm = r),
                  (b.synthTime = n),
                  (b.syncTime = f),
                  (b.syncBpm = u);
              }
              (r = e.tempoChanges[s].bpm), s++;
            }
            (l = o.synthTick - i),
              (i += l),
              (n += l * (6e4 / (r * e.division))),
              e.syncPoints.push(o);
          }
        }
        (e.syncPointIndex = 0),
          (e.syncPointTempo =
            e.syncPoints.length > 0 ? e.syncPoints[0].syncBpm : e.currentTempo);
      }
      currentTimePositionToTickPosition(t) {
        let e = this._currentState;
        if (e.tempoChanges.length === 0) return 0;
        (t *= this.playbackSpeed), this._updateCurrentTempo(e, t);
        let r = e.tempoChanges[e.tempoChangeIndex],
          n = ((t - r.time) / (6e4 / (r.bpm * e.division))) | 0;
        return r.ticks + n + 1;
      }
      currentUpdateCurrentTempo(t) {
        this._updateCurrentTempo(this._mainState, t * this.playbackSpeed);
      }
      _updateCurrentTempo(t, e) {
        let r = t.tempoChangeIndex;
        for (
          e < t.tempoChanges[r].time && (r = 0);
          r + 1 < t.tempoChanges.length && t.tempoChanges[r + 1].time <= e;

        )
          r++;
        r !== t.tempoChangeIndex &&
          ((t.tempoChangeIndex = r),
          (t.currentTempo = t.tempoChanges[t.tempoChangeIndex].bpm),
          t.syncPoints.length === 0 && (t.syncPointTempo = t.currentTempo));
      }
      currentUpdateSyncPoints(t) {
        this._updateSyncPoints(this._mainState, t);
      }
      _updateSyncPoints(t, e) {
        let r = t.syncPoints;
        if (r.length > 0) {
          let i = Math.min(t.syncPointIndex, r.length - 1);
          for (
            e < r[i].syncTime && (i = 0);
            i + 1 < r.length && r[i + 1].syncTime <= e;

          )
            i++;
          i !== t.syncPointIndex &&
            ((t.syncPointIndex = i), (t.syncPointTempo = r[i].syncBpm));
        } else t.syncPointTempo = t.currentTempo;
      }
      mainTimePositionFromBackingTrack(t, e) {
        let r = this._mainState,
          i = r.syncPoints;
        if (t < 0 || i.length === 0) return t;
        this._updateSyncPoints(this._mainState, t);
        let n = Math.min(r.syncPointIndex, i.length - 1),
          s = i[n],
          a = t - s.syncTime,
          o;
        if (n + 1 < i.length) {
          let l = i[n + 1],
            u = a / (l.syncTime - s.syncTime);
          o = (l.synthTime - s.synthTime) * u;
        } else {
          let l = a / (e - s.syncTime);
          o = (r.endTime - s.synthTime) * l;
        }
        return (s.synthTime + o) / this.playbackSpeed;
      }
      mainTimePositionToBackingTrack(t, e) {
        let r = this._mainState,
          i = r.syncPoints;
        if (t < 0 || i.length === 0) return t;
        t *= this.playbackSpeed;
        let n = Math.min(r.syncPointIndex, i.length - 1);
        for (
          t < i[n].synthTime && (n = 0);
          n + 1 < i.length && i[n + 1].synthTime <= t;

        )
          n++;
        let s = i[n],
          a = t - s.synthTime,
          o;
        if (n + 1 < i.length) {
          let l = i[n + 1],
            u = a / (l.synthTime - s.synthTime),
            c = l.syncTime - s.syncTime;
          o = s.syncTime + c * u;
        } else {
          let l = a / (r.endTime - s.synthTime),
            u = e - s.syncTime;
          o = s.syncTime + u * l;
        }
        return o;
      }
      _tickPositionToTimePositionWithSpeed(t, e, r) {
        let i = 0,
          n = 120,
          s = 0;
        for (let a of t.tempoChanges) {
          if (e < a.ticks) break;
          (i = a.time), (n = a.bpm), (s = a.ticks);
        }
        return (e -= s), (i += e * (6e4 / (n * t.division))), i / r;
      }
      get _internalEndTime() {
        return this.isPlayingMain
          ? this.mainPlaybackRange
            ? this._currentState.playbackRangeEndTime
            : this._currentState.endTime
          : this._currentState.endTime;
      }
      get isFinished() {
        return this._currentState.currentTime >= this._internalEndTime;
      }
      stop() {
        this.isPlayingMain && this.mainPlaybackRange
          ? (this._currentState.currentTime = this.mainPlaybackRange.startTick)
          : (this._currentState.currentTime = 0),
          (this._currentState.eventIndex = 0);
      }
      resetOneTimeMidi() {
        (this._oneTimeState = null), (this._currentState = this._mainState);
      }
      resetCountIn() {
        (this._countInState = null), (this._currentState = this._mainState);
      }
      startCountIn() {
        this.generateCountInMidi(),
          (this._currentState = this._countInState),
          this.stop(),
          this._synthesizer.noteOffAll(!0);
      }
      generateCountInMidi() {
        let t = new vo();
        t.division = this._mainState.division;
        let e = 120,
          r = 4,
          i = 4;
        this._mainState.eventIndex === 0
          ? ((e = this._mainState.tempoChanges[0].bpm),
            (r = this._mainState.firstTimeSignatureNumerator),
            (i = this._mainState.firstTimeSignatureDenominator))
          : ((e = this._synthesizer.currentTempo),
            (r = this._synthesizer.timeSignatureNumerator),
            (i = this._synthesizer.timeSignatureDenominator)),
          t.tempoChanges.push(new Su(e, 0, 0));
        let n = (t.division * (4 / i)) | 0,
          s = n * (6e4 / (e * this._mainState.division)),
          a = 0,
          o = 0;
        for (let l = 0; l < r; l++) {
          let u = na.newMetronomeEvent(t.synthData.length, a, l, n, s);
          t.synthData.push(u), (u.time = o), (a += n), (o += s);
        }
        t.synthData.sort((l, u) =>
          l.time > u.time
            ? 1
            : l.time < u.time
            ? -1
            : l.eventIndex - u.eventIndex
        ),
          (t.endTime = o),
          (t.endTick = a),
          (t.currentTempo = e),
          (t.syncPointTempo = e),
          (this._countInState = t);
      }
    };
  var gs = ((e) => (
    (e[(e.Paused = 0)] = "Paused"), (e[(e.Playing = 1)] = "Playing"), e
  ))(gs || {});
  var Or = class {
    constructor(t, e) {
      (this.state = t), (this.stopped = e);
    }
  };
  var er = class {
    constructor(t, e, r, i, n, s, a) {
      this.originalTempo = 0;
      this.modifiedTempo = 0;
      (this.currentTime = t),
        (this.endTime = e),
        (this.currentTick = r),
        (this.endTick = i),
        (this.isSeek = n),
        (this.originalTempo = s),
        (this.modifiedTempo = a);
    }
  };
  var ys = class ys {
    constructor() {
      this.id = "";
      this.size = 0;
    }
    static load(t, e, r) {
      if (
        (t && ys.HeaderSize > t.size) ||
        r.position + ys.HeaderSize >= r.length ||
        ((e.id = B.read8BitStringLength(r, 4)),
        e.id.charCodeAt(0) <= 32 || e.id.charCodeAt(0) >= 122) ||
        ((e.size = B.readUInt32LE(r)), t && ys.HeaderSize + e.size > t.size)
      )
        return !1;
      t && (t.size -= ys.HeaderSize + e.size);
      let i = e.id === "RIFF",
        n = e.id === "LIST";
      return i && t
        ? !1
        : !i && !n
        ? !0
        : ((e.id = B.read8BitStringLength(r, 4)),
          e.id.charCodeAt(0) <= 32 || e.id.charCodeAt(0) >= 122
            ? !1
            : ((e.size -= 4), !0));
    }
  };
  ys.HeaderSize = 8;
  var Ai = ys;
  var Op = class {
    constructor(t, e, r, i) {
      (this.packetData = t),
        (this.isBeginningOfStream = e),
        (this.isEndOfStream = r),
        (this.granulePosition = r ? i : null);
    }
    addData(t) {
      let e = this.packetData,
        r = new Uint8Array(e.length + t.length);
      r.set(e, 0), r.set(t, e.length);
    }
  };
  var Bu = class {
    constructor(t) {
      this._readable = t;
    }
    read() {
      let t = [];
      for (; this._findAndReadPage(t); );
      return t;
    }
    _findAndReadPage(t) {
      return this._seekPageHeader() ? this._readPage(t) : !1;
    }
    _seekPageHeader() {
      for (let t = 0; t < 65536; t++) {
        if (B.readInt32LE(this._readable) === 1399285583) return !0;
        this._readable.position -= 3;
      }
      return !1;
    }
    _readPage(t) {
      let e = this._readable.readByte();
      if (e === -1 || e !== 0) return !1;
      let r = this._readable.readByte(),
        i = B.readInt64LE(this._readable);
      this._readable.skip(4), this._readable.skip(4), this._readable.skip(4);
      let n = this._readable.readByte();
      if (n === -1) return !1;
      let s = [],
        a = 0;
      for (let o = 0; o < n; o++) {
        let l = this._readable.readByte();
        a === s.length && s.push(0), (s[a] += l), l < 255 && a++;
      }
      for (let o = 0; o < s.length; o++) {
        let l = new Uint8Array(s[o]);
        if (this._readable.read(l, 0, l.length) !== l.length) return !1;
        if ((r & 1) !== 0) {
          if (t.length === 0)
            throw new te(
              1,
              "OGG: Continuation page without any previous packets"
            );
          t[t.length - 1].addData(l);
        } else {
          let c = new Op(
            l,
            (r & 2) !== 0 && o === 0,
            (r & 4) !== 0 && o === s.length - 1,
            i
          );
          t.push(c);
        }
      }
      return !0;
    }
  };
  var Tu = class {
    constructor() {
      this.audioChannels = 0;
      this.audioSampleRate = 0;
      this.samples = new Float32Array(0);
      this.bitrateMaximum = 0;
      this.bitrateNominal = 0;
      this.bitrateMinimum = 0;
      this.blocksize0 = 0;
      this.blocksize1 = 0;
    }
  };
  var ku = class {
      constructor() {
        this.value = 0;
        this.bitsRead = 0;
      }
    },
    vu = class vu {
      constructor(t) {
        this._bitBucket = 0n;
        this._bitCount = 0n;
        this._overflowBits = 0n;
        this._source = t;
      }
      readByte() {
        return this.readBits(vu._byteSize);
      }
      readBit() {
        return this.readBits(1) === 1;
      }
      readBytes(t) {
        let e = new Uint8Array(t);
        for (let r = 0; r < t; r++) e[r] = this.readByte() & 255;
        return e;
      }
      readBits(t) {
        if (t === 0) return 0;
        let e = this.tryPeekBits(t);
        return this.skipBits(t), e.value;
      }
      tryPeekBits(t) {
        if (t < 0 || t > 32)
          throw new te(0, "IO: Cannot read more than 32 bits in one go");
        if (t === 0) return new ku();
        let e = new ku();
        for (; this._bitCount < t; ) {
          let i = BigInt(this._source.readByte());
          if (i === -1n)
            return (
              (e.bitsRead = Number(this._bitCount)),
              (e.value = Number(this._bitBucket)),
              (this._bitBucket = 0n),
              (this._bitCount = 0n),
              e
            );
          (this._bitBucket = ((i & 0xffn) << this._bitCount) | this._bitBucket),
            (this._bitCount += 8n),
            this._bitCount > 32 &&
              (this._overflowBits = (i >> (40n - this._bitCount)) & 0xffn);
        }
        let r = this._bitBucket;
        return (
          t < 64 && (r = r & ((1n << BigInt(t)) - 1n)),
          (e.value = Number(r)),
          (e.bitsRead = t),
          e
        );
      }
      skipBits(t) {
        let e = BigInt(t);
        if (t !== 0)
          if (this._bitCount > e) {
            if (
              (t > 31
                ? (this._bitBucket = 0n)
                : (this._bitBucket = this._bitBucket >> e),
              this._bitCount > 32)
            ) {
              let r = this._bitCount - 32n;
              (this._bitBucket =
                this._bitBucket |
                (this._overflowBits << (this._bitCount - e - r))),
                r > t &&
                  (this._overflowBits = (this._overflowBits >> e) & 0xffn);
            }
            this._bitCount -= e;
          } else if (this._bitCount === e)
            (this._bitBucket = 0n), (this._bitCount = 0n);
          else {
            for (
              e -= this._bitCount, this._bitCount = 0n, this._bitBucket = 0n;
              e > 8;

            ) {
              if (this._source.readByte() === -1) {
                e = 0n;
                break;
              }
              e -= 8n;
            }
            if (e > 0) {
              let r = BigInt(this._source.readByte());
              r === -1n ||
                ((this._bitBucket = r >> e), (this._bitCount = 8n - e));
            }
          }
      }
    };
  vu._byteSize = 8;
  var sa = vu;
  var _u = class {
      constructor() {
        this.codebooks = [];
        this.timeDomainTransforms = [];
        this.floors = [];
        this.residues = [];
        this.mappings = [];
        this.modes = [];
      }
    },
    jr = class {
      static ilog(t) {
        let e = 0;
        for (; t > 0; ) ++e, (t >>= 1);
        return e;
      }
      static bitReverse(t, e = 32) {
        let r = BigInt(t);
        return (
          (r =
            ((r & BigInt(2863311530)) >> 1n) |
            ((r & BigInt(1431655765)) << 1n)),
          (r =
            ((r & BigInt(3435973836)) >> 2n) | ((r & BigInt(858993459)) << 2n)),
          (r =
            ((r & BigInt(4042322160)) >> 4n) | ((r & BigInt(252645135)) << 4n)),
          (r =
            ((r & BigInt(4278255360)) >> 8n) | ((r & BigInt(16711935)) << 8n)),
          (r = ((r >> 16n) | (r << 16n)) >> (32n - BigInt(e))),
          Number(BigInt.asUintN(32, r))
        );
      }
      static convertFromVorbisFloat32(t) {
        let e = BigInt(t),
          r = e & BigInt(2097151),
          i = e & BigInt(2147483648),
          n = (e & BigInt(2145386496)) >> 21n;
        return i !== 0n && (r = -r), Number(r) * Math.pow(2, Number(n) - 788);
      }
    },
    Gp = class {
      constructor(t) {
        this._data = t;
      }
      get(t) {
        return this._data[t];
      }
    },
    Du = class Du {
      get(t) {
        return t;
      }
    };
  Du.instance = new Du();
  var Vp = Du,
    xu = class {
      constructor(t, e) {
        this._maxBits = 0;
        this._overflowList = null;
        this._prefixList = null;
        this._prefixBitLength = 0;
        this.dimensions = 0;
        this.entries = 0;
        this.mapType = 0;
        if (t.readBits(24) !== 5653314)
          throw new te(1, "Vorbis: Book header had invalid signature!");
        (this.dimensions = t.readBits(16)),
          (this.entries = t.readBits(24)),
          (this._lengths = new Int32Array(this.entries)),
          this._initTree(t, e),
          this._initLookupTable(t);
      }
      get(t, e) {
        return this._lookupTable[t * this.dimensions + e];
      }
      decodeScalar(t) {
        let e = t.tryPeekBits(this._prefixBitLength);
        if (e.bitsRead === 0) return -1;
        let r = this._prefixList[e.value];
        if (r != null) return t.skipBits(r.length), r.value;
        if (((e = t.tryPeekBits(this._maxBits)), this._overflowList !== null))
          for (let i = 0; i < this._overflowList.length; i++) {
            r = this._overflowList[i];
            let n = e.value & r.mask;
            if (r.bits === n) return t.skipBits(r.length), r.value;
          }
        return -1;
      }
      _initTree(t, e) {
        let r,
          i = 0,
          n;
        if (t.readBit()) {
          let s = t.readBits(5) + 1;
          for (let a = 0; a < this.entries; ) {
            let o = t.readBits(jr.ilog(this.entries - a));
            for (; --o >= 0; ) this._lengths[a++] = s;
            ++s;
          }
          (i = 0), (r = !1), (n = s);
        } else {
          (n = -1), (r = t.readBit());
          for (let s = 0; s < this.entries; s++)
            !r || t.readBit()
              ? ((this._lengths[s] = t.readBits(5) + 1), ++i)
              : (this._lengths[s] = -1),
              this._lengths[s] > n && (n = this._lengths[s]);
        }
        if (((this._maxBits = n), n > -1)) {
          let s = null;
          r &&
            i >= this.entries >> 2 &&
            ((s = new Int32Array(this.entries)),
            s.set(this._lengths.subarray(0, this.entries), 0),
            (r = !1));
          let a;
          r ? (a = i) : (a = 0);
          let o = null,
            l = null;
          if (
            (r
              ? a !== 0 &&
                ((s = new Int32Array(a)),
                (l = new Int32Array(a)),
                (o = new Int32Array(a)))
              : (l = new Int32Array(this.entries)),
            !this._computeCodewords(r, l, s, this._lengths, this.entries, o))
          )
            throw new te(1, "Vorbis: Failed to compute codewords");
          let u = o == null ? Vp.instance : new Gp(o);
          e.generateTable(u, s ?? this._lengths, l),
            (this._prefixList = e.prefixTree),
            (this._prefixBitLength = e.tableBits),
            (this._overflowList = e.overflowList);
        }
      }
      _computeCodewords(t, e, r, i, n, s) {
        let a = new Uint32Array(32),
          o = 0,
          l = 0;
        for (o = 0; o < n && !(i[o] > 0); ++o);
        if (o === n) return !0;
        this._addEntry(t, e, r, 0, o, l++, i[o], s);
        for (let u = 1; u <= i[o]; ++u) a[u] = 1 << (32 - u);
        for (let u = o + 1; u < n; ++u) {
          let c = i[u];
          if (c <= 0) continue;
          for (; c > 0 && a[c] === 0; ) --c;
          if (c === 0) return !1;
          let d = a[c];
          if (
            ((a[c] = 0),
            this._addEntry(t, e, r, jr.bitReverse(d), u, l++, i[u], s),
            c !== i[u])
          )
            for (let h = i[u]; h > c; --h) a[h] = d + (1 << (32 - h));
        }
        return !0;
      }
      _addEntry(t, e, r, i, n, s, a, o) {
        t ? ((e[s] = i), (r[s] = a), (o[s] = n)) : (e[n] = i);
      }
      _initLookupTable(t) {
        if (((this.mapType = t.readBits(4)), this.mapType === 0)) return;
        let e = jr.convertFromVorbisFloat32(t.readBits(32)),
          r = jr.convertFromVorbisFloat32(t.readBits(32)),
          i = t.readBits(4) + 1,
          n = t.readBit(),
          s = this.entries * this.dimensions,
          a = new Float32Array(s);
        this.mapType === 1 && (s = this._lookup1Values());
        let o = new Uint32Array(s);
        for (let l = 0; l < s; l++) o[l] = t.readBits(i);
        if (this.mapType === 1)
          for (let l = 0; l < this.entries; l++) {
            let u = 0,
              c = 1;
            for (let d = 0; d < this.dimensions; d++) {
              let h = (l / c) % s | 0,
                f = o[h] * r + e + u;
              (a[l * this.dimensions + d] = f), n && (u = f), (c *= s);
            }
          }
        else
          for (let l = 0; l < this.entries; l++) {
            let u = 0,
              c = l * this.dimensions;
            for (let d = 0; d < this.dimensions; d++) {
              let h = o[c] * r + e + u;
              (a[l * this.dimensions + d] = h), n && (u = h), ++c;
            }
          }
        this._lookupTable = a;
      }
      _lookup1Values() {
        let t = Math.floor(Math.exp(Math.log(this.entries) / this.dimensions));
        return (
          Math.floor(Math.pow(t + 1, this.dimensions)) <= this.entries && ++t, t
        );
      }
    },
    Wp = class {
      constructor() {
        this.value = 0;
        this.length = 0;
        this.bits = 0;
        this.mask = 0;
      }
    },
    xo = class xo {
      constructor() {
        this.tableBits = 0;
        this.prefixTree = [];
        this.overflowList = null;
      }
      generateTable(t, e, r) {
        let i = new Array(e.length),
          n = 0;
        for (let l = 0; l < i.length; l++) {
          let u = new Wp();
          (u.value = t.get(l)),
            (u.length = e[l] <= 0 ? 99999 : e[l]),
            (u.bits = r[l]),
            (u.mask = (1 << e[l]) - 1),
            (i[l] = u),
            e[l] > 0 && n < e[l] && (n = e[l]);
        }
        i.sort((l, u) => {
          let c = l.length - u.length;
          return c === 0 ? l.bits - u.bits : c;
        });
        let s = n > xo.maxTableBits ? xo.maxTableBits : n,
          a = [],
          o = null;
        for (let l = 0; l < i.length && i[l].length < 99999; l++) {
          let u = i[l].length;
          if (u > s)
            for (o = []; l < i.length && i[l].length < 99999; l++) o.push(i[l]);
          else {
            let c = 1 << (s - u),
              d = i[l];
            for (let h = 0; h < c; h++) {
              let f = (h << u) | d.bits;
              for (; a.length <= f; ) a.push(null);
              a[f] = d;
            }
          }
        }
        for (; a.length < 1 << s; ) a.push(null);
        (this.tableBits = s), (this.prefixTree = a), (this.overflowList = o);
      }
    };
  xo.maxTableBits = 10;
  var wu = xo,
    Nu = class {
      constructor(t) {
        t.readBits(16);
      }
    },
    Hp = class {
      constructor(t) {
        this.amp = 0;
        this.forceEnergy = !1;
        this.forceNoEnergy = !1;
        this.coeff = t;
      }
      get executeChannel() {
        return (this.forceEnergy || this.amp > 0) && !this.forceNoEnergy;
      }
    },
    Up = class p {
      constructor(t, e, r, i) {
        if (
          ((this._order = t.readBits(8)),
          (this._rate = t.readBits(16)),
          (this._barkMapSize = t.readBits(16)),
          (this._ampBits = t.readBits(6)),
          (this._ampOfs = t.readBits(8)),
          (this._books = new Array(t.readBits(4) + 1)),
          this._order < 1 ||
            this._rate < 1 ||
            this._barkMapSize < 1 ||
            this._books.length === 0)
        )
          throw new te(1, "Vorbis: Invalid Floor0 Data");
        this._ampDiv = (1 << this._ampBits) - 1;
        for (let n = 0; n < this._books.length; n++) {
          let s = t.readBits(8);
          if (s < 0 || s >= i.length)
            throw new te(1, "Vorbis: Invalid Floor0 Data");
          let a = i[s];
          if (a.mapType === 0 || a.dimensions < 1)
            throw new te(1, "Vorbis: Invalid Floor0 Data");
          this._books[n] = a;
        }
        (this._bookBits = jr.ilog(this._books.length)),
          (this._barkMaps = new Map([
            [e, this._synthesizeBarkCurve(e / 2)],
            [r, this._synthesizeBarkCurve(r / 2)],
          ])),
          (this._wMap = new Map([
            [e, this._synthesizeWDelMap(e / 2)],
            [r, this._synthesizeWDelMap(r / 2)],
          ]));
      }
      _synthesizeBarkCurve(t) {
        let e = this._barkMapSize / p._toBARK(this._rate / 2),
          r = new Int32Array(t + 1);
        for (let i = 0; i < t - 1; i++)
          r[i] = Math.min(
            this._barkMapSize - 1,
            Math.floor(p._toBARK((this._rate / 2 / t) * i) * e)
          );
        return (r[t] = -1), r;
      }
      static _toBARK(t) {
        return (
          13.1 * Math.atan(74e-5 * t) +
          2.24 * Math.atan(185e-10 * t * t) +
          1e-4 * t
        );
      }
      _synthesizeWDelMap(t) {
        let e = Math.PI / this._barkMapSize,
          r = new Float32Array(t);
        for (let i = 0; i < t; i++) r[i] = 2 * Math.cos(e * i);
        return r;
      }
      unpack(t, e, r) {
        let i = new Hp(new Float32Array(this._order + 1));
        if (((i.amp = t.readBits(this._ampBits)), i.amp > 0)) {
          i.amp = (i.amp / this._ampDiv) * this._ampOfs;
          let n = t.readBits(this._bookBits);
          if (n >= this._books.length) return (i.amp = 0), i;
          let s = this._books[n];
          for (let o = 0; o < this._order; ) {
            let l = s.decodeScalar(t);
            if (l === -1) return (i.amp = 0), i;
            for (let u = 0; o < this._order && u < s.dimensions; u++, o++)
              i.coeff[o] = s.get(l, u);
          }
          let a = 0;
          for (let o = 0; o < this._order; ) {
            for (let l = 0; o < this._order && l < s.dimensions; o++, l++)
              i.coeff[o] += a;
            a = i.coeff[o - 1];
          }
        }
        return i;
      }
      apply(t, e, r) {
        let i = t,
          n = e / 2;
        if (i.amp > 0) {
          let s = this._barkMaps.get(e),
            a = this._wMap.get(e),
            o = 0;
          for (o = 0; o < this._order; o++)
            i.coeff[o] = 2 * Math.cos(i.coeff[o]);
          for (o = 0; o < n; ) {
            let l = 0,
              u = s[o],
              c = 0.5,
              d = 0.5,
              h = a[u];
            for (l = 1; l < this._order; l += 2)
              (d *= h - i.coeff[l - 1]), (c *= h - i.coeff[l]);
            for (
              l === this._order
                ? ((d *= h - i.coeff[l - 1]), (c *= c * (4 - h * h)), (d *= d))
                : ((c *= c * (2 - h)), (d *= d * (2 + h))),
                d = i.amp / Math.sqrt(c + d) - this._ampOfs,
                d = Math.exp(d * 0.11512925),
                r[o] *= d;
              s[++o] === u;

            )
              r[o] *= d;
          }
        } else r.fill(0, 0, n);
      }
    },
    zp = class {
      constructor() {
        this.posts = new Int32Array(64);
        this.postCount = 0;
        this.forceEnergy = !1;
        this.forceNoEnergy = !1;
      }
      get executeChannel() {
        return (this.forceEnergy || this.postCount > 0) && !this.forceNoEnergy;
      }
    },
    Xi = class Xi {
      constructor(t, e) {
        let r = -1;
        this._partitionClass = new Int32Array(t.readBits(5));
        for (let s = 0; s < this._partitionClass.length; s++)
          (this._partitionClass[s] = t.readBits(4)),
            this._partitionClass[s] > r && (r = this._partitionClass[s]);
        ++r,
          (this._classDimensions = new Int32Array(r)),
          (this._classSubclasses = new Int32Array(r)),
          (this._classMasterbooks = new Array(r)),
          (this._classMasterBookIndex = new Int32Array(r)),
          (this._subclassBooks = new Array(r)),
          (this._subclassBookIndex = new Array(r));
        for (let s = 0; s < r; s++) {
          (this._classDimensions[s] = t.readBits(3) + 1),
            (this._classSubclasses[s] = t.readBits(2)),
            this._classSubclasses[s] > 0 &&
              ((this._classMasterBookIndex[s] = t.readBits(8)),
              (this._classMasterbooks[s] = e[this._classMasterBookIndex[s]])),
            (this._subclassBooks[s] = new Array(1 << this._classSubclasses[s])),
            (this._subclassBookIndex[s] = new Int32Array(
              this._subclassBooks[s].length
            ));
          for (let a = 0; a < this._subclassBooks[s].length; a++) {
            let o = t.readBits(8) - 1;
            o >= 0 && (this._subclassBooks[s][a] = e[o]),
              (this._subclassBookIndex[s][a] = o);
          }
        }
        (this._multiplier = t.readBits(2)),
          (this._range = Xi._rangeLookup[this._multiplier]),
          (this._yBits = Xi._yBitsLookup[this._multiplier]),
          ++this._multiplier;
        let i = t.readBits(4),
          n = [];
        n.push(0), n.push(1 << i);
        for (let s = 0; s < this._partitionClass.length; s++) {
          let a = this._partitionClass[s];
          for (let o = 0; o < this._classDimensions[a]; o++)
            n.push(t.readBits(i));
        }
        (this._xList = new Int32Array(n)),
          (this._lNeigh = new Int32Array(n.length)),
          (this._hNeigh = new Int32Array(n.length)),
          (this._sortIdx = new Int32Array(n.length)),
          (this._sortIdx[0] = 0),
          (this._sortIdx[1] = 1);
        for (let s = 2; s < this._lNeigh.length; s++) {
          (this._lNeigh[s] = 0), (this._hNeigh[s] = 1), (this._sortIdx[s] = s);
          for (let a = 2; a < s; a++) {
            let o = this._xList[a];
            o < this._xList[s]
              ? o > this._xList[this._lNeigh[s]] && (this._lNeigh[s] = a)
              : o < this._xList[this._hNeigh[s]] && (this._hNeigh[s] = a);
          }
        }
        for (let s = 0; s < this._sortIdx.length - 1; s++)
          for (let a = s + 1; a < this._sortIdx.length; a++) {
            if (this._xList[s] === this._xList[a])
              throw new te(1, "Vorbis: Invalid Floor1 Data");
            if (this._xList[this._sortIdx[s]] > this._xList[this._sortIdx[a]]) {
              let o = this._sortIdx[s];
              (this._sortIdx[s] = this._sortIdx[a]), (this._sortIdx[a] = o);
            }
          }
      }
      unpack(t, e, r) {
        let i = new zp();
        if (t.readBit()) {
          let n = 2;
          (i.posts[0] = t.readBits(this._yBits)),
            (i.posts[1] = t.readBits(this._yBits));
          for (let s = 0; s < this._partitionClass.length; s++) {
            let a = this._partitionClass[s],
              o = this._classDimensions[a],
              l = this._classSubclasses[a],
              u = (1 << l) - 1,
              c = 0;
            if (
              l > 0 &&
              ((c = this._classMasterbooks[a].decodeScalar(t)), c === -1)
            ) {
              n = 0;
              break;
            }
            for (let d = 0; d < o; d++) {
              let h = this._subclassBooks[a][c & u];
              if (
                ((c = c >> l),
                h != null &&
                  ((i.posts[n] = h.decodeScalar(t)), i.posts[n] === -1))
              ) {
                (n = 0), (s = this._partitionClass.length);
                break;
              }
              ++n;
            }
          }
          i.postCount = n;
        }
        return i;
      }
      apply(t, e, r) {
        let i = t,
          n = e / 2;
        if (i.postCount > 0) {
          let s = this._unwrapPosts(i),
            a = 0,
            o = i.posts[0] * this._multiplier;
          for (let l = 1; l < i.postCount; l++) {
            let u = this._sortIdx[l];
            if (s[u]) {
              let c = this._xList[u],
                d = i.posts[u] * this._multiplier;
              a < n && this._renderLineMulti(a, o, Math.min(c, n), d, r),
                (a = c),
                (o = d);
            }
            if (a >= n) break;
          }
          a < n && this._renderLineMulti(a, o, n, o, r);
        } else r.fill(0, 0, n);
      }
      _unwrapPosts(t) {
        let e = new Array(64);
        e.fill(!1), (e[0] = !0), (e[1] = !0);
        let r = new Int32Array(64);
        (r[0] = t.posts[0]), (r[1] = t.posts[1]);
        for (let i = 2; i < t.postCount; i++) {
          let n = this._lNeigh[i],
            s = this._hNeigh[i],
            a = this._renderPoint(
              this._xList[n],
              r[n],
              this._xList[s],
              r[s],
              this._xList[i]
            ),
            o = t.posts[i],
            l = this._range - a,
            u = a,
            c;
          l < u ? (c = l * 2) : (c = u * 2),
            o !== 0
              ? ((e[n] = !0),
                (e[s] = !0),
                (e[i] = !0),
                o >= c
                  ? l > u
                    ? (r[i] = o - u + a)
                    : (r[i] = a - o + l - 1)
                  : o % 2 === 1
                  ? (r[i] = a - (o + 1) / 2)
                  : (r[i] = a + o / 2))
              : ((e[i] = !1), (r[i] = a));
        }
        for (let i = 0; i < t.postCount; i++) t.posts[i] = r[i];
        return e;
      }
      _renderPoint(t, e, r, i, n) {
        let s = i - e,
          a = r - t,
          u = ((Math.abs(s) * (n - t)) / a) | 0;
        return s < 0 ? e - u : e + u;
      }
      _renderLineMulti(t, e, r, i, n) {
        let s = i - e,
          a = r - t,
          o = Math.abs(s),
          l = 1 - ((s >> 31) & 1) * 2,
          u = (s / a) | 0,
          c = t,
          d = e,
          h = -a;
        for (n[t] *= Xi._inverseDbTable[e], o -= Math.abs(u) * a; ++c < r; )
          (d += u),
            (h += o),
            h >= 0 && ((h -= a), (d += l)),
            (n[c] *= Xi._inverseDbTable[d]);
      }
    };
  (Xi._rangeLookup = [256, 128, 86, 64]),
    (Xi._yBitsLookup = [8, 7, 7, 6]),
    (Xi._inverseDbTable = new Float32Array([
      10649863e-14, 11341951e-14, 12079015e-14, 12863978e-14, 13699951e-14,
      14590251e-14, 15538408e-14, 16548181e-14, 17623575e-14, 18768855e-14,
      19988561e-14, 2128753e-13, 22670913e-14, 24144197e-14, 25713223e-14,
      27384213e-14, 29163793e-14, 31059021e-14, 33077411e-14, 35226968e-14,
      37516214e-14, 39954229e-14, 4255068e-13, 45315863e-14, 48260743e-14,
      51396998e-14, 54737065e-14, 58294187e-14, 62082472e-14, 66116941e-14,
      70413592e-14, 74989464e-14, 79862701e-14, 8505263e-13, 90579828e-14,
      96466216e-14, 10273513e-13, 10941144e-13, 11652161e-13, 12409384e-13,
      13215816e-13, 14074654e-13, 14989305e-13, 15963394e-13, 17000785e-13,
      18105592e-13, 19282195e-13, 20535261e-13, 21869758e-13, 23290978e-13,
      24804557e-13, 26416497e-13, 2813319e-12, 29961443e-13, 31908506e-13,
      33982101e-13, 36190449e-13, 38542308e-13, 41047004e-13, 4371447e-12,
      46555282e-13, 49580707e-13, 5280274e-12, 5623416e-12, 59888572e-13,
      63780469e-13, 67925283e-13, 72339451e-13, 77040476e-13, 82047e-10,
      87378876e-13, 93057248e-13, 99104632e-13, 10554501e-12, 11240392e-12,
      11970856e-12, 12748789e-12, 13577278e-12, 14459606e-12, 15399272e-12,
      16400004e-12, 17465768e-12, 18600792e-12, 19809576e-12, 21096914e-12,
      22467911e-12, 23928002e-12, 25482978e-12, 27139006e-12, 28902651e-12,
      30780908e-12, 32781225e-12, 34911534e-12, 37180282e-12, 39596466e-12,
      42169667e-12, 4491009e-11, 47828601e-12, 50936773e-12, 54246931e-12,
      57772202e-12, 61526565e-12, 65524908e-12, 69783085e-12, 74317983e-12,
      79147585e-12, 8429104e-11, 89768747e-12, 95602426e-12, 0.00010181521,
      0.00010843174, 0.00011547824, 0.00012298267, 0.00013097477, 0.00013948625,
      0.00014855085, 0.00015820453, 0.00016848555, 0.00017943469, 0.00019109536,
      0.00020351382, 0.00021673929, 0.00023082423, 0.00024582449, 0.00026179955,
      0.00027881276, 0.00029693158, 0.00031622787, 0.00033677814, 0.00035866388,
      0.00038197188, 0.00040679456, 0.00043323036, 0.00046138411, 0.00049136745,
      0.00052329927, 0.00055730621, 0.00059352311, 0.00063209358, 0.00067317058,
      716917e-9, 0.0007635063, 0.00081312324, 0.00086596457, 0.00092223983,
      0.00098217216, 0.0010459992, 0.0011139742, 0.0011863665, 0.0012634633,
      0.0013455702, 0.0014330129, 0.0015261382, 0.0016253153, 0.0017309374,
      0.0018434235, 0.0019632195, 0.0020908006, 0.0022266726, 0.0023713743,
      0.0025254795, 0.0026895994, 0.0028643847, 0.0030505286, 0.0032487691,
      0.0034598925, 0.0036847358, 0.0039241906, 0.0041792066, 0.004450795,
      0.0047400328, 0.0050480668, 0.0053761186, 0.0057254891, 0.0060975636,
      0.0064938176, 0.0069158225, 0.0073652516, 0.0078438871, 0.0083536271,
      0.0088964928, 0.009474637, 0.010090352, 0.01074608, 0.011444421,
      0.012188144, 0.012980198, 0.013823725, 0.014722068, 0.015678791,
      0.016697687, 0.017782797, 0.018938423, 0.020169149, 0.021479854,
      0.022875735, 0.02436233, 0.025945531, 0.027631618, 0.029427276,
      0.031339626, 0.033376252, 0.035545228, 0.037855157, 0.040315199,
      0.042935108, 0.045725273, 0.048696758, 0.051861348, 0.055231591,
      0.05882085, 0.062643361, 0.066714279, 0.071049749, 0.075666962,
      0.080584227, 0.085821044, 0.091398179, 0.097337747, 0.1036633, 0.11039993,
      0.11757434, 0.12521498, 0.13335215, 0.14201813, 0.15124727, 0.16107617,
      0.1715438, 0.18269168, 0.19456402, 0.20720788, 0.22067342, 0.23501402,
      0.25028656, 0.26655159, 0.28387361, 0.30232132, 0.32196786, 0.34289114,
      0.36517414, 0.38890521, 0.41417847, 0.44109412, 0.4697589, 0.50028648,
      0.53279791, 0.56742212, 0.6042964, 0.64356699, 0.68538959, 0.72993007,
      0.77736504, 0.8278826, 0.88168307, 0.9389798, 1,
    ]));
  var Xp = Xi,
    Eu = class {
      constructor(t, e, r, i) {
        let n = t.readBits(16);
        switch (n) {
          case 0:
            this.floor = new Up(t, e, r, i);
            break;
          case 1:
            this.floor = new Xp(t, i);
            break;
          default:
            throw new te(1, `Vorbis: Invalid Floor type: ${n}`);
        }
      }
      apply(t, e, r) {
        this.floor.apply(t, e, r);
      }
      unpack(t, e, r) {
        return this.floor.unpack(t, e, r);
      }
    },
    wo = class p {
      constructor(t, e, r) {
        (this._begin = t.readBits(24)),
          (this._end = t.readBits(24)),
          (this._partitionSize = t.readBits(24) + 1),
          (this._classifications = t.readBits(6) + 1),
          (this._classBook = r[t.readBits(8)]),
          (this._cascade = new Int32Array(this._classifications));
        let i = 0;
        for (let c = 0; c < this._classifications; c++) {
          let d = t.readBits(3);
          t.readBit()
            ? (this._cascade[c] = (t.readBits(5) << 3) | d)
            : (this._cascade[c] = d),
            (i += p._icount(this._cascade[c]));
        }
        let n = new Int32Array(i);
        for (let c = 0; c < i; c++)
          if (((n[c] = t.readBits(8)), r[n[c]].mapType === 0))
            throw new te(1, "Vorbis: Invalid Residue 0");
        let s = this._classBook.entries,
          a = this._classBook.dimensions,
          o = 1;
        for (; a > 0; ) {
          if (((o *= this._classifications), o > s))
            throw new te(1, "Vorbis: Invalid Residue 0");
          --a;
        }
        (this._books = new Array(this._classifications)), (i = 0);
        let l = 0,
          u;
        for (let c = 0; c < this._classifications; c++)
          if (
            ((u = jr.ilog(this._cascade[c])),
            (this._books[c] = new Array(u)),
            u > 0)
          ) {
            l = Math.max(l, u);
            for (let d = 0; d < u; d++)
              (this._cascade[c] & (1 << d)) > 0 &&
                (this._books[c][d] = r[n[i++]]);
          }
        (this._maxStages = l), (this._decodeMap = new Array(o));
        for (let c = 0; c < o; c++) {
          let d = c,
            h = (o / this._classifications) | 0;
          this._decodeMap[c] = new Int32Array(this._classBook.dimensions);
          for (let f = 0; f < this._classBook.dimensions; f++) {
            let b = (d / h) | 0;
            (d -= b * h),
              (h = (h / this._classifications) | 0),
              (this._decodeMap[c][f] = b);
          }
        }
        this._channels = e;
      }
      static _icount(t) {
        let e = 0;
        for (; t !== 0; ) (e += t & 1), (t >>= 1);
        return e;
      }
      decode(t, e, r, i) {
        let s = (this._end < r / 2 ? this._end : r / 2) - this._begin;
        if (s > 0 && e.indexOf(!1) !== -1) {
          let a = s / this._partitionSize,
            o =
              ((a + this._classBook.dimensions - 1) /
                this._classBook.dimensions) |
              0,
            l = [];
          for (let u = 0; u < this._channels; u++) l.push(new Array(o));
          for (let u = 0; u < this._maxStages; u++)
            for (let c = 0, d = 0; c < a; d++) {
              if (u === 0)
                for (let h = 0; h < this._channels; h++) {
                  let f = this._classBook.decodeScalar(t);
                  if (f >= 0 && f < this._decodeMap.length)
                    l[h][d] = this._decodeMap[f];
                  else {
                    (c = a), (u = this._maxStages);
                    break;
                  }
                }
              for (
                let h = 0;
                c < a && h < this._classBook.dimensions;
                h++, c++
              ) {
                let f = this._begin + c * this._partitionSize;
                for (let b = 0; b < this._channels; b++) {
                  let y = l[b][d][h];
                  if ((this._cascade[y] & (1 << u)) !== 0) {
                    let S = this._books[y][u];
                    if (
                      S &&
                      this.writeVectors(S, t, i, b, f, this._partitionSize)
                    ) {
                      (c = a), (u = this._maxStages);
                      break;
                    }
                  }
                }
              }
            }
        }
      }
      writeVectors(t, e, r, i, n, s) {
        let a = r[i],
          o = s / t.dimensions,
          l = new Int32Array(o);
        for (let u = 0; u < o; u++)
          if (((l[u] = t.decodeScalar(e)), l[u] === -1)) return !0;
        for (let u = 0; u < t.dimensions; u++)
          for (let c = 0; c < o; c++, n++) a[n] += t.get(l[c], u);
        return !1;
      }
    },
    Yp = class extends wo {
      writeVectors(t, e, r, i, n, s) {
        let a = r[i];
        for (let o = 0; o < s; ) {
          let l = t.decodeScalar(e);
          if (l === -1) return !0;
          for (let u = 0; u < t.dimensions; o++, u++) a[n + o] += t.get(l, u);
        }
        return !1;
      }
    },
    Jp = class extends wo {
      constructor(t, e, r) {
        super(t, 1, r), (this._realChannels = e);
      }
      decode(t, e, r, i) {
        super.decode(t, e, r * this._realChannels, i);
      }
      writeVectors(t, e, r, i, n, s) {
        let a = 0;
        n /= this._realChannels;
        for (let o = 0; o < s; ) {
          let l = t.decodeScalar(e);
          if (l === -1) return !0;
          for (let u = 0; u < t.dimensions; u++, o++)
            (r[a][n] += t.get(l, u)),
              ++a === this._realChannels && ((a = 0), n++);
        }
        return !1;
      }
    },
    Pu = class {
      constructor(t, e, r) {
        let i = t.readBits(16);
        switch (i) {
          case 0:
            this.residue = new wo(t, e, r);
            break;
          case 1:
            this.residue = new Yp(t, e, r);
            break;
          case 2:
            this.residue = new Jp(t, e, r);
            break;
          default:
            throw new te(1, `Vorbis: Invalid Residue type: ${i}`);
        }
      }
      decode(t, e, r, i) {
        this.residue.decode(t, e, r, i);
      }
    },
    Au = class {
      constructor(t, e, r, i, n) {
        if (t.readBits(16) !== 0)
          throw new te(1, "Vorbis: Invalid mapping type!");
        let a = 1;
        t.readBit() && (a += t.readBits(4));
        let o = 0;
        t.readBit() && (o = t.readBits(8) + 1);
        let l = jr.ilog(e - 1);
        (this._couplingAngle = new Int32Array(o)),
          (this._couplingMangitude = new Int32Array(o));
        for (let c = 0; c < o; c++) {
          let d = t.readBits(l),
            h = t.readBits(l);
          if (d === h || d > e - 1 || h > e - 1)
            throw new te(
              1,
              "Vorbis: Invalid magnitude or angle in mapping header!"
            );
          (this._couplingAngle[c] = h), (this._couplingMangitude[c] = d);
        }
        if (t.readBits(2) !== 0)
          throw new te(1, "Vorbis: Reserved bits not 0 in mapping header.");
        let u = new Int32Array(e);
        if (a > 1) {
          for (let c = 0; c < e; c++)
            if (((u[c] = t.readBits(4)), u[c] > a))
              throw new te(
                1,
                "Vorbis: Invalid channel mux submap index in mapping header!"
              );
        }
        (this._submapFloor = new Array(a)),
          (this._submapResidue = new Array(a));
        for (let c = 0; c < a; c++) {
          t.skipBits(8);
          let d = t.readBits(8);
          if (d >= r.length)
            throw new te(1, "Vorbis: Invalid floor number in mapping header!");
          let h = t.readBits(8);
          if (h >= i.length)
            throw new te(
              1,
              "Vorbis: Invalid residue number in mapping header!"
            );
          (this._submapFloor[c] = r[d]), (this._submapResidue[c] = i[h]);
        }
        (this._channelFloor = new Array(e)),
          (this._channelResidue = new Array(e));
        for (let c = 0; c < e; c++)
          (this._channelFloor[c] = this._submapFloor[u[c]]),
            (this._channelResidue[c] = this._submapResidue[u[c]]);
        this._mdct = n;
      }
      decodePacket(t, e, r) {
        let i = e >> 1,
          n = new Array(this._channelFloor.length),
          s = new Array(this._channelFloor.length);
        s.fill(!1);
        for (let a = 0; a < this._channelFloor.length; a++)
          (n[a] = this._channelFloor[a].unpack(t, e, a)),
            (s[a] = !n[a].executeChannel),
            r[a].fill(0, 0, i);
        for (let a = 0; a < this._couplingAngle.length; a++)
          (n[this._couplingAngle[a]].executeChannel ||
            n[this._couplingMangitude[a]].executeChannel) &&
            ((n[this._couplingAngle[a]].forceEnergy = !0),
            (n[this._couplingMangitude[a]].forceEnergy = !0));
        for (let a = 0; a < this._submapFloor.length; a++) {
          for (let o = 0; o < this._channelFloor.length; o++)
            (this._submapFloor[a] !== this._channelFloor[o] ||
              this._submapResidue[a] !== this._channelResidue[o]) &&
              (n[o].forceNoEnergy = !0);
          this._submapResidue[a].decode(t, s, e, r);
        }
        for (let a = this._couplingAngle.length - 1; a >= 0; a--)
          if (
            n[this._couplingAngle[a]].executeChannel ||
            n[this._couplingMangitude[a]].executeChannel
          ) {
            let o = r[this._couplingMangitude[a]],
              l = r[this._couplingAngle[a]];
            for (let u = 0; u < i; u++) {
              let c,
                d,
                h = o[u],
                f = l[u];
              h > 0
                ? f > 0
                  ? ((c = h), (d = h - f))
                  : ((d = h), (c = h + f))
                : f > 0
                ? ((c = h), (d = h + f))
                : ((d = h), (c = h - f)),
                (o[u] = c),
                (l[u] = d);
            }
          }
        for (let a = 0; a < this._channelFloor.length; a++)
          n[a].executeChannel
            ? (this._channelFloor[a].apply(n[a], e, r[a]),
              this._mdct.reverse(r[a], e))
            : r[a].fill(0, i, i * 2);
      }
    },
    Cu = class {
      constructor() {
        this.packetStartIndex = 0;
        this.packetTotalLength = 0;
        this.packetValidLength = 0;
      }
    },
    qp = class {
      constructor() {
        this.overlapInfo = new Cu();
        this.windowIndex = 0;
      }
    },
    $p = class {
      constructor(t = null) {
        this.samplePosition = null;
        this.samplePosition = t;
      }
    },
    tr = class tr {
      constructor(t, e, r, i, n) {
        this._overlapInfo = null;
        if (
          ((this._channels = e),
          (this._blockFlag = t.readBit()),
          t.readBits(32) !== 0)
        )
          throw new te(
            1,
            "Vorbis: Mode header had invalid window or transform type!"
          );
        let s = t.readBits(8);
        if (s >= n.length)
          throw new te(1, "Vorbis: Mode header had invalid mapping index!");
        (this._mapping = n[s]),
          this._blockFlag
            ? ((this._blockSize = i),
              (this._windows = [
                tr._calcWindow(r, i, r),
                tr._calcWindow(i, i, r),
                tr._calcWindow(r, i, i),
                tr._calcWindow(i, i, i),
              ]),
              (this._overlapInfo = [
                tr._calcOverlap(r, i, r),
                tr._calcOverlap(i, i, r),
                tr._calcOverlap(r, i, i),
                tr._calcOverlap(i, i, i),
              ]))
            : ((this._blockSize = r),
              (this._windows = [tr._calcWindow(r, r, r)]));
      }
      decode(t, e) {
        let r = this._getPacketInfo(t);
        this._mapping.decodePacket(t, this._blockSize, e);
        let i = this._windows[r.windowIndex];
        for (let n = 0; n < this._blockSize; n++)
          for (let s = 0; s < this._channels; s++) e[s][n] *= i[n];
        return r.overlapInfo;
      }
      _getPacketInfo(t) {
        let e = new qp();
        if (this._blockFlag) {
          let r = t.readBit(),
            i = t.readBit();
          e.windowIndex = (r ? 1 : 0) + (i ? 2 : 0);
          let n = this._overlapInfo[e.windowIndex];
          (e.overlapInfo.packetStartIndex = n.packetStartIndex),
            (e.overlapInfo.packetValidLength = n.packetValidLength),
            (e.overlapInfo.packetTotalLength = n.packetTotalLength);
        } else
          (e.windowIndex = 0),
            (e.overlapInfo.packetStartIndex = 0),
            (e.overlapInfo.packetValidLength = this._blockSize / 2),
            (e.overlapInfo.packetTotalLength = this._blockSize);
        return e;
      }
      static _calcWindow(t, e, r) {
        let i = new Float32Array(e),
          n = t / 2,
          s = e,
          a = r / 2,
          o = s / 4 - n / 2,
          l = s - s / 4 - a / 2;
        for (let u = 0; u < n; u++) {
          let c = Math.sin(((u + 0.5) / n) * tr._piHalf);
          (c *= c), (i[o + u] = Math.sin(c * tr._piHalf));
        }
        for (let u = o + n; u < l; u++) i[u] = 1;
        for (let u = 0; u < a; u++) {
          let c = Math.sin(((a - u - 0.5) / a) * tr._piHalf);
          (c *= c), (i[l + u] = Math.sin(c * tr._piHalf));
        }
        return i;
      }
      static _calcOverlap(t, e, r) {
        let i = t / 4,
          n = r / 4,
          s = e / 4 - i,
          a = (e / 4) * 3 + n,
          o = a - n * 2,
          l = new Cu();
        return (
          (l.packetStartIndex = s),
          (l.packetValidLength = o),
          (l.packetTotalLength = a),
          l
        );
      }
    };
  tr._piHalf = 3.1415926539 / 2;
  var Mu = tr,
    Yi = class Yi {
      constructor(t) {
        (this._n = t),
          (this._n2 = t >> 1),
          (this._n4 = this._n2 >> 1),
          (this._n8 = this._n4 >> 1),
          (this._ld = jr.ilog(t) - 1),
          (this._a = new Float32Array(this._n2)),
          (this._b = new Float32Array(this._n2)),
          (this._c = new Float32Array(this._n4));
        let e = 0,
          r = 0;
        for (; e < this._n4; ++e, r += 2)
          (this._a[r] = Math.cos((4 * e * Yi._pi) / t)),
            (this._a[r + 1] = -Math.sin((4 * e * Yi._pi) / t)),
            (this._b[r] = Math.cos(((r + 1) * Yi._pi) / t / 2) * 0.5),
            (this._b[r + 1] = Math.sin(((r + 1) * Yi._pi) / t / 2) * 0.5);
        for (e = 0, r = 0; e < this._n8; ++e, r += 2)
          (this._c[r] = Math.cos((2 * (r + 1) * Yi._pi) / t)),
            (this._c[r + 1] = -Math.sin((2 * (r + 1) * Yi._pi) / t));
        this._bitrev = new Uint16Array(this._n8);
        for (let i = 0; i < this._n8; ++i)
          this._bitrev[i] = ye.int32ToUint16(
            jr.bitReverse(i, this._ld - 3) << 2
          );
      }
      calcReverse(t) {
        let e,
          r,
          i = new Float32Array(this._n2);
        {
          let s = this._n2 - 2,
            a = 0,
            o = 0,
            l = this._n2;
          for (; o !== l; )
            (i[s + 1] = t[o] * this._a[a] - t[o + 2] * this._a[a + 1]),
              (i[s] = t[o] * this._a[a + 1] + t[o + 2] * this._a[a]),
              (s -= 2),
              (a += 2),
              (o += 4);
          for (o = this._n2 - 3; s >= 0; )
            (i[s + 1] = -t[o + 2] * this._a[a] - -t[o] * this._a[a + 1]),
              (i[s] = -t[o + 2] * this._a[a + 1] + -t[o] * this._a[a]),
              (s -= 2),
              (a += 2),
              (o -= 4);
        }
        (e = t), (r = i);
        {
          let s = this._n2 - 8,
            a = this._n4,
            o = 0,
            l = this._n4,
            u = 0;
          for (; s >= 0; ) {
            let c, d;
            (d = r[a + 1] - r[o + 1]),
              (c = r[a] - r[o]),
              (e[l + 1] = r[a + 1] + r[o + 1]),
              (e[l] = r[a] + r[o]),
              (e[u + 1] = d * this._a[s + 4] - c * this._a[s + 5]),
              (e[u] = c * this._a[s + 4] + d * this._a[s + 5]),
              (d = r[a + 3] - r[o + 3]),
              (c = r[a + 2] - r[o + 2]),
              (e[l + 3] = r[a + 3] + r[o + 3]),
              (e[l + 2] = r[a + 2] + r[o + 2]),
              (e[u + 3] = d * this._a[s] - c * this._a[s + 1]),
              (e[u + 2] = c * this._a[s] + d * this._a[s + 1]),
              (s -= 8),
              (l += 4),
              (u += 4),
              (a += 4),
              (o += 4);
          }
        }
        this._step3Iter0Loop(
          this._n >> 4,
          e,
          this._n2 - 1 - this._n4 * 0,
          -this._n8
        ),
          this._step3Iter0Loop(
            this._n >> 4,
            e,
            this._n2 - 1 - this._n4 * 1,
            -this._n8
          ),
          this._step3InnerRLoop(
            this._n >> 5,
            e,
            this._n2 - 1 - this._n8 * 0,
            -(this._n >> 4),
            16
          ),
          this._step3InnerRLoop(
            this._n >> 5,
            e,
            this._n2 - 1 - this._n8 * 1,
            -(this._n >> 4),
            16
          ),
          this._step3InnerRLoop(
            this._n >> 5,
            e,
            this._n2 - 1 - this._n8 * 2,
            -(this._n >> 4),
            16
          ),
          this._step3InnerRLoop(
            this._n >> 5,
            e,
            this._n2 - 1 - this._n8 * 3,
            -(this._n >> 4),
            16
          );
        let n = 2;
        for (; n < (this._ld - 3) >> 1; ++n) {
          let s = this._n >> (n + 2),
            a = s >> 1,
            o = 1 << (n + 1);
          for (let l = 0; l < o; ++l)
            this._step3InnerRLoop(
              this._n >> (n + 4),
              e,
              this._n2 - 1 - s * l,
              -a,
              1 << (n + 3)
            );
        }
        for (; n < this._ld - 6; ++n) {
          let s = this._n >> (n + 2),
            a = 1 << (n + 3),
            o = s >> 1,
            l = this._n >> (n + 6),
            u = 1 << (n + 1),
            c = this._n2 - 1,
            d = 0;
          for (let h = l; h > 0; --h)
            this._step3InnerSLoop(u, e, c, -o, d, a, s), (d += a * 4), (c -= 8);
        }
        this._step3InnerSLoopLd654(this._n >> 5, e, this._n2 - 1, this._n);
        {
          let s = 0,
            a = this._n4 - 4,
            o = this._n2 - 4;
          for (; a >= 0; ) {
            let l;
            (l = this._bitrev[s]),
              (r[o + 3] = e[l]),
              (r[o + 2] = e[l + 1]),
              (r[a + 3] = e[l + 2]),
              (r[a + 2] = e[l + 3]),
              (l = this._bitrev[s + 1]),
              (r[o + 1] = e[l]),
              (r[o] = e[l + 1]),
              (r[a + 1] = e[l + 2]),
              (r[a] = e[l + 3]),
              (a -= 4),
              (o -= 4),
              (s += 2);
          }
        }
        {
          let s = 0,
            a = 0,
            o = this._n2 - 4;
          for (; a < o; ) {
            let l, u, c, d, h, f;
            (l = r[a] - r[o + 2]),
              (u = r[a + 1] + r[o + 3]),
              (c = this._c[s + 1] * l + this._c[s] * u),
              (d = this._c[s + 1] * u - this._c[s] * l),
              (h = r[a] + r[o + 2]),
              (f = r[a + 1] - r[o + 3]),
              (r[a] = h + c),
              (r[a + 1] = f + d),
              (r[o + 2] = h - c),
              (r[o + 3] = d - f),
              (l = r[a + 2] - r[o]),
              (u = r[a + 3] + r[o + 1]),
              (c = this._c[s + 3] * l + this._c[s + 2] * u),
              (d = this._c[s + 3] * u - this._c[s + 2] * l),
              (h = r[a + 2] + r[o]),
              (f = r[a + 3] - r[o + 1]),
              (r[a + 2] = h + c),
              (r[a + 3] = f + d),
              (r[o] = h - c),
              (r[o + 1] = d - f),
              (s += 4),
              (a += 4),
              (o -= 4);
          }
        }
        {
          let s = this._n2 - 8,
            a = this._n2 - 8,
            o = 0,
            l = this._n2 - 4,
            u = this._n2,
            c = this._n - 4;
          for (; a >= 0; ) {
            let d, h, f, b;
            (b = i[a + 6] * this._b[s + 7] - i[a + 7] * this._b[s + 6]),
              (f = -i[a + 6] * this._b[s + 6] - i[a + 7] * this._b[s + 7]),
              (t[o] = b),
              (t[l + 3] = -b),
              (t[u] = f),
              (t[c + 3] = f),
              (h = i[a + 4] * this._b[s + 5] - i[a + 5] * this._b[s + 4]),
              (d = -i[a + 4] * this._b[s + 4] - i[a + 5] * this._b[s + 5]),
              (t[o + 1] = h),
              (t[l + 2] = -h),
              (t[u + 1] = d),
              (t[c + 2] = d),
              (b = i[a + 2] * this._b[s + 3] - i[a + 3] * this._b[s + 2]),
              (f = -i[a + 2] * this._b[s + 2] - i[a + 3] * this._b[s + 3]),
              (t[o + 2] = b),
              (t[l + 1] = -b),
              (t[u + 2] = f),
              (t[c + 1] = f),
              (h = i[a] * this._b[s + 1] - i[a + 1] * this._b[s]),
              (d = -i[a] * this._b[s] - i[a + 1] * this._b[s + 1]),
              (t[o + 3] = h),
              (t[l] = -h),
              (t[u + 3] = d),
              (t[c] = d),
              (s -= 8),
              (a -= 8),
              (o += 4),
              (u += 4),
              (l -= 4),
              (c -= 4);
          }
        }
      }
      _step3InnerRLoop(t, e, r, i, n) {
        let s,
          a,
          o = r,
          l = o + i,
          u = 0;
        for (let c = t >> 2; c > 0; --c)
          (s = e[o] - e[l]),
            (a = e[o - 1] - e[l - 1]),
            (e[o] += e[l]),
            (e[o - 1] += e[l - 1]),
            (e[l] = s * this._a[u] - a * this._a[u + 1]),
            (e[l - 1] = a * this._a[u] + s * this._a[u + 1]),
            (u += n),
            (s = e[o - 2] - e[l - 2]),
            (a = e[o - 3] - e[l - 3]),
            (e[o - 2] += e[l - 2]),
            (e[o - 3] += e[l - 3]),
            (e[l - 2] = s * this._a[u] - a * this._a[u + 1]),
            (e[l - 3] = a * this._a[u] + s * this._a[u + 1]),
            (u += n),
            (s = e[o - 4] - e[l - 4]),
            (a = e[o - 5] - e[l - 5]),
            (e[o - 4] += e[l - 4]),
            (e[o - 5] += e[l - 5]),
            (e[l - 4] = s * this._a[u] - a * this._a[u + 1]),
            (e[l - 5] = a * this._a[u] + s * this._a[u + 1]),
            (u += n),
            (s = e[o - 6] - e[l - 6]),
            (a = e[o - 7] - e[l - 7]),
            (e[o - 6] += e[l - 6]),
            (e[o - 7] += e[l - 7]),
            (e[l - 6] = s * this._a[u] - a * this._a[u + 1]),
            (e[l - 7] = a * this._a[u] + s * this._a[u + 1]),
            (u += n),
            (o -= 8),
            (l -= 8);
      }
      _step3Iter0Loop(t, e, r, i) {
        let n = r,
          s = n + i,
          a = 0;
        for (let o = t >> 2; o > 0; --o) {
          let l, u;
          (l = e[n] - e[s]),
            (u = e[n - 1] - e[s - 1]),
            (e[n] += e[s]),
            (e[n - 1] += e[s - 1]),
            (e[s] = l * this._a[a] - u * this._a[a + 1]),
            (e[s - 1] = u * this._a[a] + l * this._a[a + 1]),
            (a += 8),
            (l = e[n - 2] - e[s - 2]),
            (u = e[n - 3] - e[s - 3]),
            (e[n - 2] += e[s - 2]),
            (e[n - 3] += e[s - 3]),
            (e[s - 2] = l * this._a[a] - u * this._a[a + 1]),
            (e[s - 3] = u * this._a[a] + l * this._a[a + 1]),
            (a += 8),
            (l = e[n - 4] - e[s - 4]),
            (u = e[n - 5] - e[s - 5]),
            (e[n - 4] += e[s - 4]),
            (e[n - 5] += e[s - 5]),
            (e[s - 4] = l * this._a[a] - u * this._a[a + 1]),
            (e[s - 5] = u * this._a[a] + l * this._a[a + 1]),
            (a += 8),
            (l = e[n - 6] - e[s - 6]),
            (u = e[n - 7] - e[s - 7]),
            (e[n - 6] += e[s - 6]),
            (e[n - 7] += e[s - 7]),
            (e[s - 6] = l * this._a[a] - u * this._a[a + 1]),
            (e[s - 7] = u * this._a[a] + l * this._a[a + 1]),
            (a += 8),
            (n -= 8),
            (s -= 8);
        }
      }
      _step3InnerSLoop(t, e, r, i, n, s, a) {
        let o = this._a[n],
          l = this._a[n + 1],
          u = this._a[n + s],
          c = this._a[n + s + 1],
          d = this._a[n + s * 2],
          h = this._a[n + s * 2 + 1],
          f = this._a[n + s * 3],
          b = this._a[n + s * 3 + 1],
          y,
          S,
          k = r,
          T = k + i;
        for (let O = t; O > 0; --O)
          (y = e[k] - e[T]),
            (S = e[k - 1] - e[T - 1]),
            (e[k] += e[T]),
            (e[k - 1] += e[T - 1]),
            (e[T] = y * o - S * l),
            (e[T - 1] = S * o + y * l),
            (y = e[k - 2] - e[T - 2]),
            (S = e[k - 3] - e[T - 3]),
            (e[k - 2] += e[T - 2]),
            (e[k - 3] += e[T - 3]),
            (e[T - 2] = y * u - S * c),
            (e[T - 3] = S * u + y * c),
            (y = e[k - 4] - e[T - 4]),
            (S = e[k - 5] - e[T - 5]),
            (e[k - 4] += e[T - 4]),
            (e[k - 5] += e[T - 5]),
            (e[T - 4] = y * d - S * h),
            (e[T - 5] = S * d + y * h),
            (y = e[k - 6] - e[T - 6]),
            (S = e[k - 7] - e[T - 7]),
            (e[k - 6] += e[T - 6]),
            (e[k - 7] += e[T - 7]),
            (e[T - 6] = y * f - S * b),
            (e[T - 7] = S * f + y * b),
            (k -= a),
            (T -= a);
      }
      _step3InnerSLoopLd654(t, e, r, i) {
        let n = i >> 3,
          s = this._a[n],
          a = r,
          o = a - 16 * t;
        for (; a > o; ) {
          let l, u;
          (l = e[a] - e[a - 8]),
            (u = e[a - 1] - e[a - 9]),
            (e[a] += e[a - 8]),
            (e[a - 1] += e[a - 9]),
            (e[a - 8] = l),
            (e[a - 9] = u),
            (l = e[a - 2] - e[a - 10]),
            (u = e[a - 3] - e[a - 11]),
            (e[a - 2] += e[a - 10]),
            (e[a - 3] += e[a - 11]),
            (e[a - 10] = (l + u) * s),
            (e[a - 11] = (u - l) * s),
            (l = e[a - 12] - e[a - 4]),
            (u = e[a - 5] - e[a - 13]),
            (e[a - 4] += e[a - 12]),
            (e[a - 5] += e[a - 13]),
            (e[a - 12] = u),
            (e[a - 13] = l),
            (l = e[a - 14] - e[a - 6]),
            (u = e[a - 7] - e[a - 15]),
            (e[a - 6] += e[a - 14]),
            (e[a - 7] += e[a - 15]),
            (e[a - 14] = (l + u) * s),
            (e[a - 15] = (l - u) * s),
            this._iter54(e, a),
            this._iter54(e, a - 8),
            (a -= 16);
        }
      }
      _iter54(t, e) {
        let r = t[e] - t[e - 4],
          i = t[e] + t[e - 4],
          n = t[e - 2] + t[e - 6],
          s = t[e - 2] - t[e - 6];
        (t[e] = i + n), (t[e - 2] = i - n);
        let a = t[e - 3] - t[e - 7];
        (t[e - 4] = r + a), (t[e - 6] = r - a);
        let o = t[e - 1] - t[e - 5],
          l = t[e - 1] + t[e - 5],
          u = t[e - 3] + t[e - 7];
        (t[e - 1] = l + u),
          (t[e - 3] = l - u),
          (t[e - 5] = o - s),
          (t[e - 7] = o + s);
      }
    };
  Yi._pi = 3.141592653589793;
  var Kp = Yi,
    Iu = class {
      constructor() {
        this._setupCache = new Map();
      }
      reverse(t, e) {
        let r;
        this._setupCache.has(e)
          ? (r = this._setupCache.get(e))
          : ((r = new Kp(e)), this._setupCache.set(e, r)),
          r.calcReverse(t);
      }
    },
    Lu = class p {
      constructor(t, e, r) {
        this._packetIndex = 0;
        (this._stream = t),
          (this._setup = e),
          (this._packets = r),
          (this._currentPosition = 0),
          (this._prevPacketBuf = null),
          (this._prevPacketStart = 0),
          (this._prevPacketEnd = 0),
          (this._prevPacketStop = 0),
          (this._nextPacketBuf = null),
          (this._eosFound = !1),
          (this._hasPosition = !1),
          (this._modeFieldBits = jr.ilog(e.modes.length - 1));
      }
      decode() {
        let t = new Float32Array(
            this._packets[this._packets.length - 1].granulePosition *
              this._stream.audioChannels
          ),
          e = new Float32Array(
            0.2 * this._stream.audioSampleRate * this._stream.audioChannels
          ),
          r = 0,
          i = 0;
        for (; (r = this.read(e, 0, e.length)), r !== 0; ) {
          if (i + r >= t.length) {
            let n = new Float32Array(t.length + e.length);
            n.set(t, 0), (t = n);
          }
          t.set(e.subarray(0, r), i), (i += r);
        }
        return t.subarray(0, i);
      }
      read(t, e, r) {
        if (r === 0) return 0;
        let i = e,
          n = e + r;
        for (; i < n; ) {
          if (this._prevPacketStart === this._prevPacketEnd) {
            if (this._eosFound) {
              (this._nextPacketBuf = null), (this._prevPacketBuf = null);
              break;
            }
            let a = this._readNextPacket((i - e) / this._stream.audioChannels);
            a === null && (this._prevPacketEnd = this._prevPacketStop),
              a !== null &&
                a.samplePosition !== null &&
                !this._hasPosition &&
                ((this._hasPosition = !0),
                (this._currentPosition =
                  a.samplePosition -
                  (this._prevPacketEnd - this._prevPacketStart) -
                  (i - e) / this._stream.audioChannels));
          }
          let s = Math.min(
            (n - i) / this._stream.audioChannels,
            this._prevPacketEnd - this._prevPacketStart
          );
          s > 0 && (i += this._copyBuffer(t, i, s));
        }
        return (
          (r = i - e),
          (this._currentPosition += r / this._stream.audioChannels),
          r
        );
      }
      _copyBuffer(t, e, r) {
        let i = e;
        for (; r > 0; this._prevPacketStart++, r--)
          for (let n = 0; n < this._stream.audioChannels; n++)
            t[i++] = this._prevPacketBuf[n][this._prevPacketStart];
        return i - e;
      }
      _readNextPacket(t) {
        let e = this._decodeNextPacket();
        if (
          ((this._eosFound = this._eosFound || e.isEndOfStream),
          e.curPacket == null)
        )
          return null;
        if (e.samplePosition !== null && e.isEndOfStream) {
          let r = this._currentPosition + t + e.validLen - e.startIndex,
            i = e.samplePosition - r;
          i < 0 && ((e.validLen += i), e.validLen < 0 && (e.validLen = 0));
        }
        return (
          this._prevPacketEnd > 0
            ? (p._overlapBuffers(
                this._prevPacketBuf,
                e.curPacket,
                this._prevPacketStart,
                this._prevPacketStop,
                e.startIndex,
                this._stream.audioChannels
              ),
              (this._prevPacketStart = e.startIndex))
            : this._prevPacketBuf == null &&
              (this._prevPacketStart = e.validLen),
          (this._nextPacketBuf = this._prevPacketBuf),
          (this._prevPacketEnd = e.validLen),
          (this._prevPacketStop = e.totalLen),
          (this._prevPacketBuf = e.curPacket),
          new $p(e.samplePosition)
        );
      }
      static _overlapBuffers(t, e, r, i, n, s) {
        for (; r < i; r++, n++) for (let a = 0; a < s; a++) e[a][n] += t[a][r];
      }
      _decodeNextPacket() {
        let t = new Qp(),
          e = null;
        if (this._packetIndex >= this._packets.length) t.isEndOfStream = !0;
        else {
          e = this._packets[this._packetIndex++];
          let r = new sa(Se.fromBuffer(e.packetData));
          if (((t.isEndOfStream = e.isEndOfStream), !r.readBit())) {
            let i = this._setup.modes[r.readBits(this._modeFieldBits)];
            if (this._nextPacketBuf == null) {
              this._nextPacketBuf = new Array(this._stream.audioChannels);
              for (let s = 0; s < this._stream.audioChannels; s++)
                this._nextPacketBuf[s] = new Float32Array(
                  this._stream.blocksize1
                );
            }
            let n = i.decode(r, this._nextPacketBuf);
            return (
              (t.startIndex = n.packetStartIndex),
              (t.validLen = n.packetValidLength),
              (t.totalLen = n.packetTotalLength),
              (t.samplePosition = e.granulePosition),
              (t.curPacket = this._nextPacketBuf),
              t
            );
          }
        }
        return t;
      }
    },
    Qp = class {
      constructor() {
        this.curPacket = null;
        this.startIndex = 0;
        this.validLen = 0;
        this.totalLen = 0;
        this.isEndOfStream = !1;
        this.samplePosition = null;
      }
    };
  var Ji = class Ji {
    constructor(t) {
      (this._packetIndex = -1), (this._packets = t);
    }
    read() {
      let t;
      for (;;) {
        if (((t = this._nextPacket()), t == null)) return null;
        if (t.isBeginningOfStream) {
          let e = this._readStream(t);
          if (e != null) return e;
        }
      }
    }
    _nextPacket() {
      return (
        this._packetIndex++,
        this._packetIndex < this._packets.length
          ? this._packets[this._packetIndex]
          : null
      );
    }
    _readStream(t) {
      let e = new Tu();
      if (
        !this._readIdentificationHeader(e, t) ||
        !this._readComments(this._nextPacket())
      )
        return null;
      let r = new _u();
      if (!this._readSetupHeader(e, r, this._nextPacket())) return null;
      let i = [],
        n;
      for (
        ;
        (n = this._nextPacket()), !(n == null || (i.push(n), n.isEndOfStream));

      );
      let s = new Lu(e, r, i);
      return (e.samples = s.decode()), e;
    }
    _commonHeaderDecode(t, e) {
      let r = new Uint8Array(7);
      if ((e.read(r, 0, r.length), r[0] !== t)) return !1;
      for (let i = 0; i < Ji.vorbisHeaderMarker.length; i++)
        if (r[1 + i] !== Ji.vorbisHeaderMarker[i]) return !1;
      return !0;
    }
    _commonHeaderDecodeBit(t, e) {
      let r = e.readBytes(7);
      if (r[0] !== t) return !1;
      for (let i = 0; i < Ji.vorbisHeaderMarker.length; i++)
        if (r[1 + i] !== Ji.vorbisHeaderMarker[i]) return !1;
      return !0;
    }
    _readIdentificationHeader(t, e) {
      let r = Se.fromBuffer(e.packetData);
      if (
        !this._commonHeaderDecode(1, r) ||
        B.readUInt32LE(r) !== 0 ||
        ((t.audioChannels = r.readByte()),
        (t.audioSampleRate = B.readUInt32LE(r)),
        t.audioChannels <= 0 || t.audioSampleRate <= 0)
      )
        return !1;
      (t.bitrateMaximum = B.readInt32LE(r)),
        (t.bitrateNominal = B.readInt32LE(r)),
        (t.bitrateMinimum = B.readInt32LE(r));
      let n = r.readByte();
      return (
        (t.blocksize0 = 1 << (n & 15)),
        (t.blocksize1 = 1 << (n >> 4)),
        !(
          t.blocksize0 > t.blocksize1 ||
          !Ji._isAllowedBlockSize(t.blocksize0) ||
          !Ji._isAllowedBlockSize(t.blocksize0) ||
          r.readByte() === 0
        )
      );
    }
    static _isAllowedBlockSize(t) {
      switch (t) {
        case 64:
        case 128:
        case 256:
        case 512:
        case 1024:
        case 2048:
        case 4096:
        case 8192:
          return !0;
        default:
          return !1;
      }
    }
    _readComments(t) {
      if (t == null) return !1;
      let e = Se.fromBuffer(t.packetData);
      if (!this._commonHeaderDecode(3, e)) return !1;
      let r = B.readUInt32LE(e);
      e.skip(r);
      let i = B.readUInt32LE(e);
      for (let s = 0; s < i; s++) {
        let a = B.readUInt32LE(e);
        e.skip(a);
      }
      return e.readByte() !== 0;
    }
    _readSetupHeader(t, e, r) {
      if (r == null) return !1;
      let i = new sa(Se.fromBuffer(r.packetData)),
        n = new Iu(),
        s = new wu();
      if (!this._commonHeaderDecodeBit(5, i)) return !1;
      let a = i.readByte() + 1;
      for (let o = 0; o < a; o++) e.codebooks.push(new xu(i, s));
      a = i.readBits(6) + 1;
      for (let o = 0; o < a; o++) e.timeDomainTransforms.push(new Nu(i));
      a = i.readBits(6) + 1;
      for (let o = 0; o < a; o++)
        e.floors.push(new Eu(i, t.blocksize0, t.blocksize1, e.codebooks));
      a = i.readBits(6) + 1;
      for (let o = 0; o < a; o++)
        e.residues.push(new Pu(i, t.audioChannels, e.codebooks));
      a = i.readBits(6) + 1;
      for (let o = 0; o < a; o++)
        e.mappings.push(new Au(i, t.audioChannels, e.floors, e.residues, n));
      a = i.readBits(6) + 1;
      for (let o = 0; o < a; o++)
        e.modes.push(
          new Mu(i, t.audioChannels, t.blocksize0, t.blocksize1, e.mappings)
        );
      return !!i.readBit();
    }
  };
  Ji.vorbisHeaderMarker = new Uint8Array([118, 111, 114, 98, 105, 115]);
  var Fu = Ji;
  var Ru = class {
    constructor(t) {
      this.streams = [];
      let r = new Bu(t).read(),
        i = new Fu(r);
      for (;;) {
        let n = i.read();
        if (n == null) break;
        this.streams.push(n);
      }
    }
  };
  var Do = class {
      constructor() {
        this.phdrs = [];
        this.pbags = [];
        this.pmods = [];
        this.pgens = [];
        this.insts = [];
        this.ibags = [];
        this.imods = [];
        this.igens = [];
        this.sHdrs = [];
        this.sampleData = new Uint8Array(0);
        this._sampleCache = new Map();
      }
      decodeSamples(t, e, r) {
        let i = `${t}_${e}_${r}`;
        if (!this._sampleCache.has(i)) {
          let n,
            s = this.sampleData.slice(t, e);
          if (r) n = new Ru(Se.fromBuffer(s)).streams[0].samples;
          else {
            let a = new DataView(s.buffer, s.byteOffset, s.length);
            n = new Float32Array(s.length / 2);
            for (let o = 0; o < n.length; o++)
              n[o] = a.getInt16(o * 2, !0) / 32767;
          }
          return this._sampleCache.set(i, n), n;
        }
        return this._sampleCache.get(i);
      }
      load(t) {
        let e = new Ai(),
          r = new Ai();
        if (!Ai.load(null, e, t) || e.id !== "sfbk")
          throw new Oe("Soundfont is not a valid Soundfont2 file");
        for (; Ai.load(e, r, t); ) {
          let i = new Ai();
          if (r.id === "pdta")
            for (; Ai.load(r, i, t); )
              switch (i.id) {
                case "phdr":
                  for (let n = 0, s = (i.size / Mo.SizeInFile) | 0; n < s; n++)
                    this.phdrs.push(new Mo(t));
                  break;
                case "pbag":
                  for (let n = 0, s = (i.size / Co.SizeInFile) | 0; n < s; n++)
                    this.pbags.push(new Co(t));
                  break;
                case "pmod":
                  for (let n = 0, s = (i.size / Io.SizeInFile) | 0; n < s; n++)
                    this.pmods.push(new Io(t));
                  break;
                case "pgen":
                  for (let n = 0, s = (i.size / Rt.SizeInFile) | 0; n < s; n++)
                    this.pgens.push(new Rt(t));
                  break;
                case "inst":
                  for (let n = 0, s = (i.size / Ao.SizeInFile) | 0; n < s; n++)
                    this.insts.push(new Ao(t));
                  break;
                case "ibag":
                  for (let n = 0, s = (i.size / No.SizeInFile) | 0; n < s; n++)
                    this.ibags.push(new No(t));
                  break;
                case "imod":
                  for (let n = 0, s = (i.size / Eo.SizeInFile) | 0; n < s; n++)
                    this.imods.push(new Eo(t));
                  break;
                case "igen":
                  for (let n = 0, s = (i.size / Po.SizeInFile) | 0; n < s; n++)
                    this.igens.push(new Po(t));
                  break;
                case "shdr":
                  for (let n = 0, s = (i.size / Lo.SizeInFile) | 0; n < s; n++)
                    this.sHdrs.push(new Lo(t));
                  break;
                default:
                  t.position += i.size;
                  break;
              }
          else if (r.id === "sdta")
            for (; Ai.load(r, i, t); )
              i.id === "smpl"
                ? ((this.sampleData = new Uint8Array(i.size)),
                  t.read(this.sampleData, 0, i.size))
                : (t.position += i.size);
          else t.position += r.size;
        }
      }
    },
    No = class {
      constructor(t) {
        (this.instGenNdx = B.readUInt16LE(t)),
          (this.instModNdx = B.readUInt16LE(t));
      }
    };
  No.SizeInFile = 4;
  var Eo = class {
    constructor(t) {
      (this.modSrcOper = B.readUInt16LE(t)),
        (this.modDestOper = B.readUInt16LE(t)),
        (this.modAmount = B.readInt16LE(t)),
        (this.modAmtSrcOper = B.readUInt16LE(t)),
        (this.modTransOper = B.readUInt16LE(t));
    }
  };
  Eo.SizeInFile = 10;
  var Po = class {
    constructor(t) {
      (this.genOper = B.readUInt16LE(t)), (this.genAmount = new Ou(t));
    }
  };
  Po.SizeInFile = 4;
  var Ao = class {
    constructor(t) {
      (this.instName = B.read8BitStringLength(t, 20)),
        (this.instBagNdx = B.readUInt16LE(t));
    }
  };
  Ao.SizeInFile = 22;
  var Co = class {
    constructor(t) {
      (this.genNdx = B.readUInt16LE(t)), (this.modNdx = B.readUInt16LE(t));
    }
  };
  Co.SizeInFile = 4;
  var Rt = class {
    constructor(t) {
      (this.genOper = B.readUInt16LE(t)), (this.genAmount = new Ou(t));
    }
  };
  (Rt.SizeInFile = 4),
    (Rt.GenInstrument = 41),
    (Rt.GenKeyRange = 43),
    (Rt.GenVelRange = 44),
    (Rt.GenSampleId = 53);
  var Mo = class {
    constructor(t) {
      (this.presetName = B.read8BitStringLength(t, 20)),
        (this.preset = B.readUInt16LE(t)),
        (this.bank = B.readUInt16LE(t)),
        (this.presetBagNdx = B.readUInt16LE(t)),
        (this.library = B.readUInt32LE(t)),
        (this.genre = B.readUInt32LE(t)),
        (this.morphology = B.readUInt32LE(t));
    }
  };
  Mo.SizeInFile = 38;
  var Io = class {
    constructor(t) {
      (this.modSrcOper = B.readUInt16LE(t)),
        (this.modDestOper = B.readUInt16LE(t)),
        (this.modAmount = B.readUInt16LE(t)),
        (this.modAmtSrcOper = B.readUInt16LE(t)),
        (this.modTransOper = B.readUInt16LE(t));
    }
  };
  Io.SizeInFile = 10;
  var Lo = class {
    constructor(t) {
      (this.sampleName = B.read8BitStringLength(t, 20)),
        (this.start = B.readUInt32LE(t)),
        (this.end = B.readUInt32LE(t)),
        (this.startLoop = B.readUInt32LE(t)),
        (this.endLoop = B.readUInt32LE(t)),
        (this.sampleRate = B.readUInt32LE(t)),
        (this.originalPitch = t.readByte()),
        (this.pitchCorrection = B.readSInt8(t)),
        (this.sampleLink = B.readUInt16LE(t)),
        (this.sampleType = B.readUInt16LE(t));
    }
  };
  Lo.SizeInFile = 46;
  var Ou = class {
    get shortAmount() {
      return ye.uint16ToInt16(this.wordAmount);
    }
    get lowByteAmount() {
      return this.wordAmount & 255;
    }
    get highByteAmount() {
      return ((this.wordAmount & 65280) >> 8) & 255;
    }
    constructor(t) {
      this.wordAmount = B.readUInt16LE(t);
    }
  };
  var Gu = class {
    constructor() {
      this.presetIndex = 0;
      this.bank = 0;
      this.pitchWheel = 0;
      this.perNotePitchWheel = new Map();
      this.midiPan = 0;
      this.midiVolume = 0;
      this.midiExpression = 0;
      this.midiRpn = 0;
      this.midiData = 0;
      this.panOffset = 0;
      this.gainDb = 0;
      this.pitchRange = 0;
      this.tuning = 0;
      this.mixVolume = 0;
      this.mute = !1;
      this.solo = !1;
    }
  };
  var Vu = class {
    constructor() {
      this.activeChannel = 0;
      this.channelList = [];
    }
    setupVoice(t, e) {
      let r = this.channelList[this.activeChannel],
        i = e.region.pan + r.panOffset;
      (e.playingChannel = this.activeChannel),
        (e.mixVolume = r.mixVolume),
        (e.noteGainDb += r.gainDb),
        e.updatePitchRatio(r, t.outSampleRate),
        i <= -0.5
          ? ((e.panFactorLeft = 1), (e.panFactorRight = 0))
          : i >= 0.5
          ? ((e.panFactorLeft = 0), (e.panFactorRight = 1))
          : ((e.panFactorLeft = Math.sqrt(0.5 - i)),
            (e.panFactorRight = Math.sqrt(0.5 + i)));
    }
  };
  var Wu = class {
    constructor() {
      this.name = "";
      this.presetNumber = 0;
      this.bank = 0;
      this.regions = null;
    }
  };
  var Fe = class {
    static timecents2Secs(t) {
      return Math.pow(2, t / 1200);
    }
    static decibelsToGain(t) {
      return t > -100 ? Math.pow(10, t * 0.05) : 0;
    }
    static gainToDecibels(t) {
      return t <= 1e-5 ? -100 : 20 * Math.log10(t);
    }
    static cents2Hertz(t) {
      return 8.176 * Math.pow(2, t / 1200);
    }
  };
  var qi = class {
    constructor(t) {
      this.delay = 0;
      this.attack = 0;
      this.hold = 0;
      this.decay = 0;
      this.sustain = 0;
      this.release = 0;
      this.keynumToHold = 0;
      this.keynumToDecay = 0;
      t &&
        ((this.delay = t.delay),
        (this.attack = t.attack),
        (this.hold = t.hold),
        (this.decay = t.decay),
        (this.sustain = t.sustain),
        (this.release = t.release),
        (this.keynumToHold = t.keynumToHold),
        (this.keynumToDecay = t.keynumToDecay));
    }
    clear() {
      (this.delay = 0),
        (this.attack = 0),
        (this.hold = 0),
        (this.decay = 0),
        (this.sustain = 0),
        (this.release = 0),
        (this.keynumToHold = 0),
        (this.keynumToDecay = 0);
    }
    envToSecs(t) {
      (this.delay = this.delay < -11950 ? 0 : Fe.timecents2Secs(this.delay)),
        (this.attack =
          this.attack < -11950 ? 0 : Fe.timecents2Secs(this.attack)),
        (this.release =
          this.release < -11950 ? 0 : Fe.timecents2Secs(this.release)),
        this.keynumToHold === 0 &&
          (this.hold = this.hold < -11950 ? 0 : Fe.timecents2Secs(this.hold)),
        this.keynumToDecay === 0 &&
          (this.decay =
            this.decay < -11950 ? 0 : Fe.timecents2Secs(this.decay)),
        this.sustain < 0
          ? (this.sustain = 0)
          : t
          ? (this.sustain = Fe.decibelsToGain(-this.sustain / 10))
          : (this.sustain = 1 - this.sustain / 1e3);
    }
  };
  var Fo = class Fo {
    constructor(t) {
      this.loopMode = 0;
      this.samples = Fo._noSamples;
      this.sampleRate = 0;
      this.loKey = 0;
      this.hiKey = 0;
      this.loVel = 0;
      this.hiVel = 0;
      this.group = 0;
      this.offset = 0;
      this.end = 0;
      this.loopStart = 0;
      this.loopEnd = 0;
      this.transpose = 0;
      this.tune = 0;
      this.pitchKeyCenter = 0;
      this.pitchKeyTrack = 0;
      this.attenuation = 0;
      this.pan = 0;
      this.ampEnv = new qi();
      this.modEnv = new qi();
      this.initialFilterQ = 0;
      this.initialFilterFc = 0;
      this.modEnvToPitch = 0;
      this.modEnvToFilterFc = 0;
      this.modLfoToFilterFc = 0;
      this.modLfoToVolume = 0;
      this.delayModLFO = 0;
      this.freqModLFO = 0;
      this.modLfoToPitch = 0;
      this.delayVibLFO = 0;
      this.freqVibLFO = 0;
      this.vibLfoToPitch = 0;
      t &&
        ((this.loopMode = t.loopMode),
        (this.samples = t.samples),
        (this.sampleRate = t.sampleRate),
        (this.loKey = t.loKey),
        (this.hiKey = t.hiKey),
        (this.loVel = t.loVel),
        (this.hiVel = t.hiVel),
        (this.group = t.group),
        (this.offset = t.offset),
        (this.end = t.end),
        (this.loopStart = t.loopStart),
        (this.loopEnd = t.loopEnd),
        (this.transpose = t.transpose),
        (this.tune = t.tune),
        (this.pitchKeyCenter = t.pitchKeyCenter),
        (this.pitchKeyTrack = t.pitchKeyTrack),
        (this.attenuation = t.attenuation),
        (this.pan = t.pan),
        (this.ampEnv = new qi(t.ampEnv)),
        (this.modEnv = new qi(t.modEnv)),
        (this.initialFilterQ = t.initialFilterQ),
        (this.initialFilterFc = t.initialFilterFc),
        (this.modEnvToPitch = t.modEnvToPitch),
        (this.modEnvToFilterFc = t.modEnvToFilterFc),
        (this.modLfoToFilterFc = t.modLfoToFilterFc),
        (this.modLfoToVolume = t.modLfoToVolume),
        (this.delayModLFO = t.delayModLFO),
        (this.freqModLFO = t.freqModLFO),
        (this.modLfoToPitch = t.modLfoToPitch),
        (this.delayVibLFO = t.delayVibLFO),
        (this.freqVibLFO = t.freqVibLFO),
        (this.vibLfoToPitch = t.vibLfoToPitch));
    }
    clear(t) {
      (this.loopMode = 0),
        (this.samples = Fo._noSamples),
        (this.sampleRate = 0),
        (this.loKey = 0),
        (this.hiKey = 0),
        (this.loVel = 0),
        (this.hiVel = 0),
        (this.group = 0),
        (this.offset = 0),
        (this.end = 0),
        (this.loopStart = 0),
        (this.loopEnd = 0),
        (this.transpose = 0),
        (this.tune = 0),
        (this.pitchKeyCenter = 0),
        (this.pitchKeyTrack = 0),
        (this.attenuation = 0),
        (this.pan = 0),
        this.ampEnv.clear(),
        this.modEnv.clear(),
        (this.initialFilterQ = 0),
        (this.initialFilterFc = 0),
        (this.modEnvToPitch = 0),
        (this.modEnvToFilterFc = 0),
        (this.modLfoToFilterFc = 0),
        (this.modLfoToVolume = 0),
        (this.delayModLFO = 0),
        (this.freqModLFO = 0),
        (this.modLfoToPitch = 0),
        (this.delayVibLFO = 0),
        (this.freqVibLFO = 0),
        (this.vibLfoToPitch = 0),
        (this.hiKey = 127),
        (this.hiVel = 127),
        (this.pitchKeyCenter = 60),
        !t &&
          ((this.pitchKeyTrack = 100),
          (this.pitchKeyCenter = -1),
          (this.ampEnv.delay = -12e3),
          (this.ampEnv.attack = -12e3),
          (this.ampEnv.hold = -12e3),
          (this.ampEnv.decay = -12e3),
          (this.ampEnv.release = -12e3),
          (this.modEnv.delay = -12e3),
          (this.modEnv.attack = -12e3),
          (this.modEnv.hold = -12e3),
          (this.modEnv.decay = -12e3),
          (this.modEnv.release = -12e3),
          (this.initialFilterFc = 13500),
          (this.delayModLFO = -12e3),
          (this.delayVibLFO = -12e3));
    }
    operator(t, e) {
      switch (t) {
        case 0:
          this.offset += ye.int16ToUint32(e.shortAmount);
          break;
        case 1:
          this.end += ye.int16ToUint32(e.shortAmount);
          break;
        case 2:
          this.loopStart += ye.int16ToUint32(e.shortAmount);
          break;
        case 3:
          this.loopEnd += ye.int16ToUint32(e.shortAmount);
          break;
        case 4:
          this.offset += ye.int16ToUint32(e.shortAmount) * 32768;
          break;
        case 5:
          this.modLfoToPitch = e.shortAmount;
          break;
        case 6:
          this.vibLfoToPitch = e.shortAmount;
          break;
        case 7:
          this.modEnvToPitch = e.shortAmount;
          break;
        case 8:
          this.initialFilterFc = e.shortAmount;
          break;
        case 9:
          this.initialFilterQ = e.shortAmount;
          break;
        case 10:
          this.modLfoToFilterFc = e.shortAmount;
          break;
        case 11:
          this.modEnvToFilterFc = e.shortAmount;
          break;
        case 12:
          this.end += ye.int16ToUint32(e.shortAmount) * 32768;
          break;
        case 13:
          this.modLfoToVolume = e.shortAmount;
          break;
        case 17:
          this.pan = e.shortAmount / 1e3;
          break;
        case 21:
          this.delayModLFO = e.shortAmount;
          break;
        case 22:
          this.freqModLFO = e.shortAmount;
          break;
        case 23:
          this.delayVibLFO = e.shortAmount;
          break;
        case 24:
          this.freqVibLFO = e.shortAmount;
          break;
        case 25:
          this.modEnv.delay = e.shortAmount;
          break;
        case 26:
          this.modEnv.attack = e.shortAmount;
          break;
        case 27:
          this.modEnv.hold = e.shortAmount;
          break;
        case 28:
          this.modEnv.decay = e.shortAmount;
          break;
        case 29:
          this.modEnv.sustain = e.shortAmount;
          break;
        case 30:
          this.modEnv.release = e.shortAmount;
          break;
        case 31:
          this.modEnv.keynumToHold = e.shortAmount;
          break;
        case 32:
          this.modEnv.keynumToDecay = e.shortAmount;
          break;
        case 33:
          this.ampEnv.delay = e.shortAmount;
          break;
        case 34:
          this.ampEnv.attack = e.shortAmount;
          break;
        case 35:
          this.ampEnv.hold = e.shortAmount;
          break;
        case 36:
          this.ampEnv.decay = e.shortAmount;
          break;
        case 37:
          this.ampEnv.sustain = e.shortAmount;
          break;
        case 38:
          this.ampEnv.release = e.shortAmount;
          break;
        case 39:
          this.ampEnv.keynumToHold = e.shortAmount;
          break;
        case 40:
          this.ampEnv.keynumToDecay = e.shortAmount;
          break;
        case 43:
          (this.loKey = e.lowByteAmount), (this.hiKey = e.highByteAmount);
          break;
        case 44:
          (this.loVel = e.lowByteAmount), (this.hiVel = e.highByteAmount);
          break;
        case 45:
          this.loopStart += ye.int16ToUint32(e.shortAmount) * 32768;
          break;
        case 48:
          this.attenuation += e.shortAmount * 0.1;
          break;
        case 50:
          this.loopEnd += ye.int16ToUint32(e.shortAmount) * 32768;
          break;
        case 51:
          this.transpose += e.shortAmount;
          break;
        case 52:
          this.tune += e.shortAmount;
          break;
        case 54:
          this.loopMode =
            (e.wordAmount & 3) === 3 ? 2 : (e.wordAmount & 3) === 1 ? 1 : 0;
          break;
        case 56:
          this.pitchKeyTrack = e.shortAmount;
          break;
        case 57:
          this.group = e.wordAmount;
          break;
        case 58:
          this.pitchKeyCenter = e.shortAmount;
          break;
      }
    }
  };
  Fo._noSamples = new Float32Array(0);
  var $i = Fo;
  var Hu = class Hu {
    constructor() {
      this.level = 0;
      this.slope = 0;
      this.samplesUntilNextSegment = 0;
      this.segment = 0;
      this.midiVelocity = 0;
      this.parameters = null;
      this.segmentIsExponential = !1;
      this.isAmpEnv = !1;
    }
    nextSegment(t, e) {
      if (this.parameters)
        for (;;)
          switch (t) {
            case 0:
              if (
                ((this.samplesUntilNextSegment =
                  (this.parameters.delay * e) | 0),
                this.samplesUntilNextSegment > 0)
              ) {
                (this.segment = 1),
                  (this.segmentIsExponential = !1),
                  (this.level = 0),
                  (this.slope = 0);
                return;
              }
              t = 1;
              break;
            case 1:
              if (
                ((this.samplesUntilNextSegment =
                  (this.parameters.attack * e) | 0),
                this.samplesUntilNextSegment > 0)
              ) {
                this.isAmpEnv ||
                  (this.samplesUntilNextSegment =
                    (this.parameters.attack *
                      ((145 - this.midiVelocity) / 144) *
                      e) |
                    0),
                  (this.segment = 2),
                  (this.segmentIsExponential = !1),
                  (this.level = 0),
                  (this.slope = 1 / this.samplesUntilNextSegment);
                return;
              }
              t = 2;
              break;
            case 2:
              if (
                ((this.samplesUntilNextSegment =
                  (this.parameters.hold * e) | 0),
                this.samplesUntilNextSegment > 0)
              ) {
                (this.segment = 3),
                  (this.segmentIsExponential = !1),
                  (this.level = 1),
                  (this.slope = 0);
                return;
              }
              t = 3;
              break;
            case 3:
              if (
                ((this.samplesUntilNextSegment =
                  (this.parameters.decay * e) | 0),
                this.samplesUntilNextSegment > 0)
              ) {
                if (((this.segment = 4), (this.level = 1), this.isAmpEnv)) {
                  let r = -9.226 / this.samplesUntilNextSegment;
                  (this.slope = Math.exp(r)),
                    (this.segmentIsExponential = !0),
                    this.parameters.sustain > 0 &&
                      (this.samplesUntilNextSegment =
                        (Math.log(this.parameters.sustain) / r) | 0);
                } else
                  (this.slope = -1 / this.samplesUntilNextSegment),
                    (this.samplesUntilNextSegment =
                      (this.parameters.decay *
                        (1 - this.parameters.sustain) *
                        e) |
                      0),
                    (this.segmentIsExponential = !1);
                return;
              }
              t = 4;
              break;
            case 4:
              (this.segment = 5),
                (this.level = this.parameters.sustain),
                (this.slope = 0),
                (this.samplesUntilNextSegment = 2147483647),
                (this.segmentIsExponential = !1);
              return;
            case 5:
              if (
                ((this.segment = 6),
                (this.samplesUntilNextSegment =
                  ((this.parameters.release <= 0
                    ? Hu._fastReleaseTime
                    : this.parameters.release) *
                    e) |
                  0),
                this.isAmpEnv)
              ) {
                let r = -9.226 / this.samplesUntilNextSegment;
                (this.slope = Math.exp(r)), (this.segmentIsExponential = !0);
              } else
                (this.slope = -this.level / this.samplesUntilNextSegment),
                  (this.segmentIsExponential = !1);
              return;
            default:
              (this.segment = 7),
                (this.segmentIsExponential = !1),
                (this.level = 0),
                (this.slope = 0),
                (this.samplesUntilNextSegment = 134217727);
              return;
          }
    }
    setup(t, e, r, i, n) {
      (this.parameters = new qi(t)),
        this.parameters.keynumToHold > 0 &&
          ((this.parameters.hold += this.parameters.keynumToHold * (60 - e)),
          (this.parameters.hold =
            this.parameters.hold < -1e4
              ? 0
              : Fe.timecents2Secs(this.parameters.hold))),
        this.parameters.keynumToDecay > 0 &&
          ((this.parameters.decay += this.parameters.keynumToDecay * (60 - e)),
          (this.parameters.decay =
            this.parameters.decay < -1e4
              ? 0
              : Fe.timecents2Secs(this.parameters.decay))),
        (this.midiVelocity = r | 0),
        (this.isAmpEnv = i),
        this.nextSegment(0, n);
    }
    process(t, e) {
      this.slope > 0 &&
        (this.segmentIsExponential
          ? (this.level *= Math.pow(this.slope, t))
          : (this.level += this.slope * t)),
        (this.samplesUntilNextSegment -= t),
        this.samplesUntilNextSegment <= 0 && this.nextSegment(this.segment, e);
    }
  };
  Hu._fastReleaseTime = 0.01;
  var Ro = Hu;
  var Oo = class {
    constructor() {
      this.samplesUntil = 0;
      this.level = 0;
      this.delta = 0;
    }
    setup(t, e, r) {
      (this.samplesUntil = (t * r) | 0),
        (this.delta = (4 * Fe.cents2Hertz(e)) / r),
        (this.level = 0);
    }
    process(t) {
      if (this.samplesUntil > t) {
        this.samplesUntil -= t;
        return;
      }
      (this.level += this.delta * t),
        this.level > 1
          ? ((this.delta = -this.delta), (this.level = 2 - this.level))
          : this.level < -1 &&
            ((this.delta = -this.delta), (this.level = -2 - this.level));
    }
  };
  var Go = class {
    constructor(t) {
      this.qInv = 0;
      this.a0 = 0;
      this.a1 = 0;
      this.b1 = 0;
      this.b2 = 0;
      this.z1 = 0;
      this.z2 = 0;
      this.active = !1;
      t &&
        ((this.qInv = t.qInv),
        (this.a0 = t.a0),
        (this.a1 = t.a1),
        (this.b1 = t.b1),
        (this.b2 = t.b2),
        (this.z1 = t.z1),
        (this.z2 = t.z2),
        (this.active = t.active));
    }
    setup(t) {
      let e = Math.tan(Math.PI * t),
        r = e * e,
        i = 1 / (1 + e * this.qInv + r);
      (this.a0 = r * i),
        (this.a1 = 2 * this.a0),
        (this.b1 = 2 * (r - 1) * i),
        (this.b2 = (1 - e * this.qInv + r) * i);
    }
    process(t) {
      let e = t * this.a0 + this.z1;
      return (
        (this.z1 = t * this.a1 + this.z2 - this.b1 * e),
        (this.z2 = t * this.a0 - this.b2 * e),
        e
      );
    }
  };
  var Vo = class Vo {
    constructor() {
      this.playingPreset = 0;
      this.playingKey = 0;
      this.playingChannel = 0;
      this.region = null;
      this.pitchInputTimecents = 0;
      this.pitchOutputFactor = 0;
      this.sourceSamplePosition = 0;
      this.noteGainDb = 0;
      this.panFactorLeft = 0;
      this.panFactorRight = 0;
      this.playIndex = 0;
      this.loopStart = 0;
      this.loopEnd = 0;
      this.ampEnv = new Ro();
      this.modEnv = new Ro();
      this.lowPass = new Go();
      this.modLfo = new Oo();
      this.vibLfo = new Oo();
      this.mixVolume = 0;
      this.mute = !1;
    }
    updatePitchRatio(t, e) {
      let r = t.pitchWheel;
      t.perNotePitchWheel.has(this.playingKey) &&
        (r += t.perNotePitchWheel.get(this.playingKey) - 8192);
      let i =
        r === 8192
          ? t.tuning
          : (r / 16383) * t.pitchRange * 2 - t.pitchRange + t.tuning;
      this.calcPitchRatio(i, e);
    }
    calcPitchRatio(t, e) {
      if (!this.region) return;
      let r = this.playingKey + this.region.transpose + this.region.tune / 100,
        i =
          this.region.pitchKeyCenter +
          (r - this.region.pitchKeyCenter) * (this.region.pitchKeyTrack / 100);
      t !== 0 && (i += t),
        (this.pitchInputTimecents = i * 100),
        (this.pitchOutputFactor =
          this.region.sampleRate /
          (Fe.timecents2Secs(this.region.pitchKeyCenter * 100) * e));
    }
    end(t) {
      this.region &&
        (this.ampEnv.nextSegment(5, t),
        this.modEnv.nextSegment(5, t),
        this.region.loopMode === 2 && (this.loopEnd = this.loopStart));
    }
    endQuick(t) {
      (this.ampEnv.parameters.release = 0),
        this.ampEnv.nextSegment(5, t),
        (this.modEnv.parameters.release = 0),
        this.modEnv.nextSegment(5, t);
    }
    render(t, e, r, i, n) {
      if (!this.region) return;
      let s = this.region,
        a = s.samples,
        o = 0,
        l = t.outputMode === 1 ? i : -1,
        u = s.modEnvToPitch !== 0 || s.modEnvToFilterFc !== 0,
        c =
          this.modLfo.delta > 0 &&
          (s.modLfoToPitch !== 0 ||
            s.modLfoToFilterFc !== 0 ||
            s.modLfoToVolume !== 0),
        d = this.vibLfo.delta > 0 && s.vibLfoToPitch !== 0,
        h = this.loopStart < this.loopEnd,
        f = this.loopStart,
        b = this.loopEnd,
        y = s.end,
        S = b + 1,
        k = this.sourceSamplePosition,
        T = new Go(this.lowPass),
        O = s.modLfoToFilterFc !== 0 || s.modEnvToFilterFc !== 0,
        N = 0,
        R = 0,
        g = 0,
        x = 0,
        M =
          s.modLfoToPitch !== 0 ||
          s.modEnvToPitch !== 0 ||
          s.vibLfoToPitch !== 0,
        P = 0,
        H = 0,
        X = 0,
        fe = 0,
        Ee = s.modLfoToVolume !== 0,
        be = 0,
        Ae = 0;
      for (
        O
          ? ((N = t.outSampleRate),
            (R = s.initialFilterFc),
            (g = s.modLfoToFilterFc),
            (x = s.modEnvToFilterFc))
          : ((N = 0), (R = 0), (g = 0), (x = 0)),
          M
            ? ((P = 0),
              (H = s.modLfoToPitch),
              (X = s.vibLfoToPitch),
              (fe = s.modEnvToPitch))
            : ((P =
                Fe.timecents2Secs(this.pitchInputTimecents) *
                this.pitchOutputFactor),
              (H = 0),
              (X = 0),
              (fe = 0)),
          Ee
            ? (Ae = s.modLfoToVolume * 0.1)
            : ((be = Fe.decibelsToGain(this.noteGainDb)), (Ae = 0));
        i > 0;

      ) {
        let U,
          sr,
          wt = 0,
          Nt = i > Vo.renderEffectSampleBlock ? Vo.renderEffectSampleBlock : i;
        if (((i -= Nt), O)) {
          let Re = R + this.modLfo.level * g + this.modEnv.level * x;
          (T.active = Re <= 13500), T.active && T.setup(Fe.cents2Hertz(Re) / N);
        }
        switch (
          (M &&
            (P =
              Fe.timecents2Secs(
                this.pitchInputTimecents +
                  (this.modLfo.level * H +
                    this.vibLfo.level * X +
                    this.modEnv.level * fe)
              ) * this.pitchOutputFactor),
          Ee &&
            (be = Fe.decibelsToGain(this.noteGainDb + this.modLfo.level * Ae)),
          (U = be * this.ampEnv.level),
          n ? (U = 0) : (U *= this.mixVolume),
          this.ampEnv.process(Nt, t.outSampleRate),
          u && this.modEnv.process(Nt, t.outSampleRate),
          c && this.modLfo.process(Nt),
          d && this.vibLfo.process(Nt),
          t.outputMode)
        ) {
          case 0:
            for (
              sr = U * this.panFactorLeft, wt = U * this.panFactorRight;
              Nt-- > 0 && k < y;

            ) {
              let Re = k | 0,
                Pr = Re >= b && h ? f : Re + 1,
                Et = k - Re,
                nt = a[Re] * (1 - Et) + a[Pr] * Et;
              T.active && (nt = T.process(nt)),
                (e[r + o] += nt * sr),
                o++,
                (e[r + o] += nt * wt),
                o++,
                (k += P),
                k >= S && h && (k -= b - f + 1);
            }
            break;
          case 1:
            for (
              sr = U * this.panFactorLeft, wt = U * this.panFactorRight;
              Nt-- > 0 && k < y;

            ) {
              let Re = k | 0,
                Pr = Re >= b && h ? f : Re + 1,
                Et = k - Re,
                nt = a[Re] * (1 - Et) + a[Pr] * Et;
              T.active && (nt = T.process(nt)),
                (e[r + o] += nt * sr),
                o++,
                (e[r + l] += nt * wt),
                l++,
                (k += P),
                k >= S && h && (k -= b - f + 1);
            }
            break;
          case 2:
            for (; Nt-- > 0 && k < y; ) {
              let Re = k | 0,
                Pr = Re >= b && h ? f : Re + 1,
                Et = k - Re,
                nt = a[Re] * (1 - Et) + a[Pr] * Et;
              T.active && (nt = T.process(nt)),
                (e[r + o] = nt * U),
                o++,
                (k += P),
                k >= S && h && (k -= b - f + 1);
            }
            break;
        }
        if (k >= y || this.ampEnv.segment === 7) {
          this.kill();
          return;
        }
      }
      (this.sourceSamplePosition = k), (T.active || O) && (this.lowPass = T);
    }
    kill() {
      this.playingPreset = -1;
    }
  };
  Vo.renderEffectSampleBlock = Q.MicroBufferSize;
  var Uu = Vo;
  var zu = class {
      constructor(t) {
        this.value = t;
      }
    },
    Vn = class {
      get isEmpty() {
        return this._head === void 0;
      }
      clear() {
        (this._head = void 0), (this._tail = void 0);
      }
      enqueue(t) {
        let e = new zu(t);
        this._tail
          ? ((this._tail.next = e), (this._tail = e))
          : ((this._head = e), (this._tail = e));
      }
      enqueueFront(t) {
        let e = new zu(t);
        (e.next = this._head),
          this._head ? (this._head = e) : ((this._head = e), (this._tail = e));
      }
      peek() {
        let t = this._head;
        if (t) return t.value;
      }
      dequeue() {
        let t = this._head;
        if (!t) return;
        let e = t.next;
        return (this._head = e), e || (this._tail = void 0), t.value;
      }
    };
  var Wo = ((N) => (
    (N[(N.BankSelectCoarse = 0)] = "BankSelectCoarse"),
    (N[(N.ModulationCoarse = 1)] = "ModulationCoarse"),
    (N[(N.DataEntryCoarse = 6)] = "DataEntryCoarse"),
    (N[(N.VolumeCoarse = 7)] = "VolumeCoarse"),
    (N[(N.PanCoarse = 10)] = "PanCoarse"),
    (N[(N.ExpressionControllerCoarse = 11)] = "ExpressionControllerCoarse"),
    (N[(N.BankSelectFine = 32)] = "BankSelectFine"),
    (N[(N.ModulationFine = 33)] = "ModulationFine"),
    (N[(N.DataEntryFine = 38)] = "DataEntryFine"),
    (N[(N.VolumeFine = 39)] = "VolumeFine"),
    (N[(N.PanFine = 42)] = "PanFine"),
    (N[(N.ExpressionControllerFine = 43)] = "ExpressionControllerFine"),
    (N[(N.HoldPedal = 64)] = "HoldPedal"),
    (N[(N.LegatoPedal = 68)] = "LegatoPedal"),
    (N[(N.NonRegisteredParameterFine = 98)] = "NonRegisteredParameterFine"),
    (N[(N.NonRegisteredParameterCourse = 99)] = "NonRegisteredParameterCourse"),
    (N[(N.RegisteredParameterFine = 100)] = "RegisteredParameterFine"),
    (N[(N.RegisteredParameterCourse = 101)] = "RegisteredParameterCourse"),
    (N[(N.AllSoundOff = 120)] = "AllSoundOff"),
    (N[(N.ResetControllers = 121)] = "ResetControllers"),
    (N[(N.AllNotesOff = 123)] = "AllNotesOff"),
    N
  ))(Wo || {});
  var Ho = class p {
    constructor(t) {
      this._midiEventQueue = new Vn();
      this._mutedChannels = new Map();
      this._soloChannels = new Map();
      this._isAnySolo = !1;
      this._transpositionPitches = new Map();
      this._liveTranspositionPitches = new Map();
      this.currentTempo = 0;
      this.timeSignatureNumerator = 0;
      this.timeSignatureDenominator = 0;
      this.presets = null;
      this._voices = [];
      this._channels = null;
      this._voicePlayIndex = 0;
      this.outputMode = 0;
      this.outSampleRate = 0;
      this.globalGainDb = 0;
      this.outSampleRate = t;
    }
    synthesize(t, e, r) {
      return this._fillWorkingBuffer(t, e, r);
    }
    synthesizeSilent(t) {
      this._fillWorkingBuffer(null, 0, t);
    }
    channelGetMixVolume(t) {
      return this._channels && t < this._channels.channelList.length
        ? this._channels.channelList[t].mixVolume
        : 1;
    }
    channelSetMixVolume(t, e) {
      let r = this._channelInit(t);
      for (let i of this._voices)
        i.playingChannel === t && i.playingPreset !== -1 && (i.mixVolume = e);
      r.mixVolume = e;
    }
    channelSetMute(t, e) {
      e ? this._mutedChannels.set(t, !0) : this._mutedChannels.delete(t);
    }
    channelSetSolo(t, e) {
      e ? this._soloChannels.set(t, !0) : this._soloChannels.delete(t),
        (this._isAnySolo = this._soloChannels.size > 0);
    }
    resetChannelStates() {
      (this._mutedChannels = new Map()),
        (this._soloChannels = new Map()),
        (this._liveTranspositionPitches = new Map()),
        this.applyTranspositionPitches(new Map()),
        (this._isAnySolo = !1);
    }
    setChannelTranspositionPitch(t, e) {
      let r = 0;
      this._liveTranspositionPitches.has(t) &&
        (r = this._liveTranspositionPitches.get(t)),
        e === 0
          ? this._liveTranspositionPitches.delete(t)
          : this._liveTranspositionPitches.set(t, e);
      for (let i of this._voices)
        if (i.playingChannel === t && i.playingChannel !== 9) {
          let n = 0;
          (n -= r),
            (n += e),
            (i.playingKey += n),
            this._channels &&
              i.updatePitchRatio(
                this._channels.channelList[i.playingChannel],
                this.outSampleRate
              );
        }
    }
    applyTranspositionPitches(t) {
      let e = this._transpositionPitches;
      for (let r of this._voices)
        if (r.playingChannel >= 0 && r.playingChannel !== 9) {
          let i = 0;
          e.has(r.playingChannel) && (i -= e.get(r.playingChannel)),
            t.has(r.playingChannel) && (i += t.get(r.playingChannel)),
            (r.playingKey += i),
            this._channels &&
              r.updatePitchRatio(
                this._channels.channelList[r.playingChannel],
                this.outSampleRate
              );
        }
      this._transpositionPitches = t;
    }
    dispatchEvent(t) {
      this._midiEventQueue.enqueue(t);
    }
    _fillWorkingBuffer(t, e, r) {
      let i = this._isAnySolo,
        n = [];
      for (; !this._midiEventQueue.isEmpty; ) {
        let s = this._midiEventQueue.dequeue();
        s.isMetronome && this.metronomeVolume > 0
          ? (this.channelNoteOff(Q.MetronomeChannel, Q.MetronomeKey),
            this.channelNoteOn(Q.MetronomeChannel, Q.MetronomeKey, 95 / 127))
          : s.event && this.processMidiMessage(s.event),
          n.push(s);
      }
      for (let s of this._voices)
        if (s.playingPreset !== -1) {
          let a = s.playingChannel,
            o =
              this._mutedChannels.has(a) ||
              (i && a !== Q.MetronomeChannel && !this._soloChannels.has(a));
          t ? s.render(this, t, e, r, o) : s.kill();
        }
      return n;
    }
    processMidiMessage(t) {
      switch (t.type) {
        case 88:
          let r = t;
          (this.timeSignatureNumerator = r.numerator),
            (this.timeSignatureDenominator = Math.pow(2, r.denominatorIndex));
          break;
        case 128:
          let i = t;
          this.channelNoteOn(i.channel, i.noteKey, i.noteVelocity / 127);
          break;
        case 144:
          let n = t;
          this.channelNoteOff(n.channel, n.noteKey);
          break;
        case 176:
          let s = t;
          this.channelMidiControl(s.channel, s.controller, s.value);
          break;
        case 192:
          let a = t;
          this.channelSetPresetNumber(a.channel, a.program, a.channel === 9);
          break;
        case 81:
          let o = t;
          this.currentTempo = o.beatsPerMinute;
          break;
        case 224:
          let l = t;
          this.channelSetPitchWheel(l.channel, l.value);
          break;
        case 96:
          let u = t,
            c = u.value;
          (c = (c * Q.MaxPitchWheel) / Q.MaxPitchWheel20),
            this.channelSetPerNotePitchWheel(u.channel, u.noteKey, c);
          break;
      }
    }
    get metronomeVolume() {
      return this.channelGetMixVolume(Q.MetronomeChannel);
    }
    set metronomeVolume(t) {
      this.setupMetronomeChannel(t);
    }
    setupMetronomeChannel(t) {
      this.channelSetMixVolume(Q.MetronomeChannel, t),
        t > 0 &&
          (this.channelSetVolume(Q.MetronomeChannel, 1),
          this.channelSetPresetNumber(Q.MetronomeChannel, 0, !0));
    }
    get masterVolume() {
      return Fe.decibelsToGain(this.globalGainDb);
    }
    set masterVolume(t) {
      let e = Fe.gainToDecibels(t),
        r = e - this.globalGainDb;
      if (r !== 0) {
        for (let i of this._voices)
          i.playingPreset !== -1 && (i.noteGainDb += r);
        this.globalGainDb = e;
      }
    }
    resetSoft() {
      for (let t of this._voices)
        t.playingPreset !== -1 &&
          (t.ampEnv.segment < 6 || t.ampEnv.parameters.release !== 0) &&
          t.endQuick(this.outSampleRate);
      if (this._channels)
        for (let t of this._channels.channelList)
          (t.presetIndex = 0),
            (t.bank = 0),
            (t.pitchWheel = 8192),
            (t.midiPan = 8192),
            t.perNotePitchWheel.clear(),
            (t.midiVolume = 16383),
            (t.midiExpression = 16383),
            (t.midiRpn = 65535),
            (t.midiData = 0),
            (t.panOffset = 0),
            (t.gainDb = 0),
            (t.pitchRange = 2),
            (t.tuning = 0);
    }
    get presetCount() {
      return this.presets?.length ?? 0;
    }
    reset() {
      for (let t of this._voices)
        t.playingPreset !== -1 &&
          (t.ampEnv.segment < 6 || t.ampEnv.parameters.release !== 0) &&
          t.endQuick(this.outSampleRate);
      this._channels = null;
    }
    setOutput(t, e, r) {
      (this.outputMode = t),
        (this.outSampleRate = e >= 1 ? e : 44100),
        (this.globalGainDb = r);
    }
    noteOn(t, e, r) {
      if (!this.presets) return;
      let i = (r * 127) | 0;
      if (t < 0 || t >= this.presets.length) return;
      if (r <= 0) {
        this.noteOff(t, e);
        return;
      }
      let n = this._voicePlayIndex++;
      for (let s of this.presets[t].regions) {
        if (e < s.loKey || e > s.hiKey || i < s.loVel || i > s.hiVel) continue;
        let a = null;
        if (s.group !== 0)
          for (let u of this._voices)
            u.playingPreset === t && u.region.group === s.group
              ? u.endQuick(this.outSampleRate)
              : u.playingPreset === -1 && !a && (a = u);
        else for (let u of this._voices) u.playingPreset === -1 && (a = u);
        if (!a) {
          for (let u = 0; u < 4; u++) {
            let c = new Uu();
            (c.playingPreset = -1), this._voices.push(c);
          }
          a = this._voices[this._voices.length - 4];
        }
        (a.region = s),
          (a.playingPreset = t),
          (a.playingKey = e),
          (a.playIndex = n),
          (a.noteGainDb =
            this.globalGainDb - s.attenuation - Fe.gainToDecibels(1 / r)),
          this._channels
            ? this._channels.setupVoice(this, a)
            : (a.calcPitchRatio(0, this.outSampleRate),
              (a.panFactorLeft = Math.sqrt(0.5 - s.pan)),
              (a.panFactorRight = Math.sqrt(0.5 + s.pan))),
          (a.sourceSamplePosition = s.offset);
        let o = s.loopMode !== 0 && s.loopStart < s.loopEnd;
        (a.loopStart = o ? s.loopStart : 0),
          (a.loopEnd = o ? s.loopEnd : 0),
          a.ampEnv.setup(s.ampEnv, e, i, !0, this.outSampleRate),
          a.modEnv.setup(s.modEnv, e, i, !1, this.outSampleRate);
        let l = s.initialFilterQ / 10;
        (a.lowPass.qInv = 1 / Math.pow(10, l / 20)),
          (a.lowPass.z1 = 0),
          (a.lowPass.z2 = 0),
          (a.lowPass.active = s.initialFilterFc <= 13500),
          a.lowPass.active &&
            a.lowPass.setup(
              Fe.cents2Hertz(s.initialFilterFc) / this.outSampleRate
            ),
          a.modLfo.setup(s.delayModLFO, s.freqModLFO, this.outSampleRate),
          a.vibLfo.setup(s.delayVibLFO, s.freqVibLFO, this.outSampleRate);
      }
    }
    bankNoteOn(t, e, r, i) {
      let n = this._getPresetIndex(t, e);
      return n === -1 ? !1 : (this.noteOn(n, r, i), !0);
    }
    noteOff(t, e) {
      let r = null,
        i = null,
        n = [];
      for (let s of this._voices)
        s.playingPreset !== t ||
          s.playingKey !== e ||
          s.ampEnv.segment >= 6 ||
          (!r || s.playIndex < r.playIndex
            ? ((r = s), (i = s), n.push(s))
            : s.playIndex === r.playIndex && ((i = s), n.push(s)));
      if (r)
        for (let s of n)
          (s !== r &&
            s !== i &&
            (s.playIndex !== r.playIndex ||
              s.playingPreset !== t ||
              s.playingKey !== e ||
              s.ampEnv.segment >= 6)) ||
            s.end(this.outSampleRate);
    }
    bankNoteOff(t, e, r) {
      let i = this._getPresetIndex(t, e);
      return i === -1 ? !1 : (this.noteOff(i, r), !0);
    }
    noteOffAll(t) {
      for (let e of this._voices)
        e.playingPreset !== -1 &&
          (t
            ? e.endQuick(this.outSampleRate)
            : e.ampEnv.segment < 6 && e.end(this.outSampleRate));
    }
    get activeVoiceCount() {
      let t = 0;
      for (let e of this._voices) e.playingPreset !== -1 && t++;
      return t;
    }
    _channelInit(t) {
      if (this._channels && t < this._channels.channelList.length)
        return this._channels.channelList[t];
      this._channels || (this._channels = new Vu());
      for (let e = this._channels.channelList.length; e <= t; e++) {
        let r = new Gu();
        (r.presetIndex = 0),
          (r.bank = 0),
          (r.pitchWheel = 8192),
          (r.midiPan = 8192),
          (r.midiVolume = 16383),
          (r.midiExpression = 16383),
          (r.midiRpn = 65535),
          (r.midiData = 0),
          (r.panOffset = 0),
          (r.gainDb = 0),
          (r.pitchRange = 2),
          (r.tuning = 0),
          (r.mixVolume = 1),
          this._channels.channelList.push(r);
      }
      return this._channels.channelList[t];
    }
    _getPresetIndex(t, e) {
      if (!this.presets) return -1;
      for (let r = this.presets.length - 1; r >= 0; r--) {
        let i = this.presets[r];
        if (i.presetNumber === e && i.bank === t) return r;
      }
      return -1;
    }
    getPresetName(t) {
      return this.presets
        ? t < 0 || t >= this.presets.length
          ? null
          : this.presets[t].name
        : null;
    }
    bankGetPresetName(t, e) {
      return this.getPresetName(this._getPresetIndex(t, e));
    }
    channelNoteOn(t, e, r) {
      !this._channels ||
        t > this._channels.channelList.length ||
        (this._transpositionPitches.has(t) &&
          (e += this._transpositionPitches.get(t)),
        this._liveTranspositionPitches.has(t) &&
          (e += this._liveTranspositionPitches.get(t)),
        (this._channels.activeChannel = t),
        this.noteOn(this._channels.channelList[t].presetIndex, e, r));
    }
    channelNoteOff(t, e) {
      this._transpositionPitches.has(t) &&
        (e += this._transpositionPitches.get(t)),
        this._liveTranspositionPitches.has(t) &&
          (e += this._liveTranspositionPitches.get(t));
      let r = [],
        i = null,
        n = null;
      for (let a of this._voices)
        a.playingPreset === -1 ||
          a.playingChannel !== t ||
          a.playingKey !== e ||
          a.ampEnv.segment >= 6 ||
          (!i || a.playIndex < i.playIndex
            ? ((i = a), (n = a), r.push(a))
            : a.playIndex === i.playIndex && ((n = a), r.push(a)));
      if ((this._channelInit(t).perNotePitchWheel.delete(e), !!i))
        for (let a of r)
          (a !== i &&
            a !== n &&
            (a.playIndex !== i.playIndex ||
              a.playingPreset === -1 ||
              a.playingChannel !== t ||
              a.playingKey !== e ||
              a.ampEnv.segment >= 6)) ||
            a.end(this.outSampleRate);
    }
    channelNoteOffAll(t) {
      this._channelInit(t).perNotePitchWheel.clear();
      for (let r of this._voices)
        r.playingPreset !== -1 &&
          r.playingChannel === t &&
          r.ampEnv.segment < 6 &&
          r.end(this.outSampleRate);
    }
    channelSoundsOffAll(t) {
      this._channelInit(t).perNotePitchWheel.clear();
      for (let r of this._voices)
        r.playingPreset !== -1 &&
          r.playingChannel === t &&
          (r.ampEnv.segment < 6 || r.ampEnv.parameters.release === 0) &&
          r.endQuick(this.outSampleRate);
    }
    channelSetPresetIndex(t, e) {
      this._channelInit(t).presetIndex = ye.int32ToUint16(e);
    }
    channelSetPresetNumber(t, e, r = !1) {
      let i = this._channelInit(t),
        n = 0;
      return (
        r
          ? ((n = this._getPresetIndex(128 | (i.bank & 32767), e)),
            n === -1 && (n = this._getPresetIndex(128, e)),
            n === -1 && (n = this._getPresetIndex(128, 0)),
            n === -1 && (n = this._getPresetIndex(i.bank & 2047, e)))
          : (n = this._getPresetIndex(i.bank & 2047, e)),
        (i.presetIndex = n),
        n !== -1
      );
    }
    channelSetBank(t, e) {
      this._channelInit(t).bank = ye.int32ToUint16(e);
    }
    channelSetBankPreset(t, e, r) {
      let i = this._channelInit(t),
        n = this._getPresetIndex(e, r);
      return n === -1
        ? !1
        : ((i.presetIndex = ye.int32ToUint16(n)),
          (i.bank = ye.int32ToUint16(e)),
          !0);
    }
    channelSetPan(t, e) {
      for (let r of this._voices)
        if (r.playingChannel === t && r.playingPreset !== -1) {
          let i = r.region.pan + e - 0.5;
          i <= -0.5
            ? ((r.panFactorLeft = 1), (r.panFactorRight = 0))
            : i >= 0.5
            ? ((r.panFactorLeft = 0), (r.panFactorRight = 1))
            : ((r.panFactorLeft = Math.sqrt(0.5 - i)),
              (r.panFactorRight = Math.sqrt(0.5 + i)));
        }
      this._channelInit(t).panOffset = e - 0.5;
    }
    channelSetVolume(t, e) {
      let r = this._channelInit(t),
        i = Fe.gainToDecibels(e),
        n = i - r.gainDb;
      if (n !== 0) {
        for (let s of this._voices)
          s.playingChannel === t &&
            s.playingPreset !== -1 &&
            (s.noteGainDb += n);
        r.gainDb = i;
      }
    }
    channelSetPitchWheel(t, e) {
      let r = this._channelInit(t);
      r.pitchWheel !== e &&
        ((r.pitchWheel = ye.int32ToUint16(e)), this._channelApplyPitch(t, r));
    }
    channelSetPerNotePitchWheel(t, e, r) {
      this._transpositionPitches.has(t) &&
        (e += this._transpositionPitches.get(t)),
        this._liveTranspositionPitches.has(t) &&
          (e += this._liveTranspositionPitches.get(t));
      let i = this._channelInit(t);
      (i.perNotePitchWheel.has(e) && i.perNotePitchWheel.get(e) === r) ||
        (i.perNotePitchWheel.set(e, r), this._channelApplyPitch(t, i, e));
    }
    _channelApplyPitch(t, e, r = -1) {
      for (let i of this._voices)
        i.playingChannel === t &&
          i.playingPreset !== -1 &&
          (r === -1 || i.playingKey === r) &&
          i.updatePitchRatio(e, this.outSampleRate);
    }
    channelSetPitchRange(t, e) {
      let r = this._channelInit(t);
      r.pitchRange !== e &&
        ((r.pitchRange = e),
        r.pitchWheel !== 8192 && this._channelApplyPitch(t, r));
    }
    channelSetTuning(t, e) {
      let r = this._channelInit(t);
      r.tuning !== e && ((r.tuning = e), this._channelApplyPitch(t, r));
    }
    channelMidiControl(t, e, r) {
      let i = this._channelInit(t);
      switch (e) {
        case 38:
          (i.midiData = ye.int32ToUint16((i.midiData & 16256) | r)),
            i.midiRpn === 0
              ? this.channelSetPitchRange(
                  t,
                  (i.midiData >> 7) + 0.01 * (i.midiData & 127)
                )
              : i.midiRpn === 1
              ? this.channelSetTuning(
                  t,
                  (i.tuning | 0) + (i.midiData - 8192) / 8192
                )
              : i.midiRpn === 2 &&
                this.channelSetTuning(t, r - 64 + (i.tuning - (i.tuning | 0)));
          return;
        case 7:
          (i.midiVolume = ye.int32ToUint16((i.midiVolume & 127) | (r << 7))),
            this.channelSetVolume(
              t,
              Math.pow((i.midiVolume / 16383) * (i.midiExpression / 16383), 3)
            );
          return;
        case 39:
          (i.midiVolume = ye.int32ToUint16((i.midiVolume & 16256) | r)),
            this.channelSetVolume(
              t,
              Math.pow((i.midiVolume / 16383) * (i.midiExpression / 16383), 3)
            );
          return;
        case 11:
          (i.midiExpression = ye.int32ToUint16(
            (i.midiExpression & 127) | (r << 7)
          )),
            this.channelSetVolume(
              t,
              Math.pow((i.midiVolume / 16383) * (i.midiExpression / 16383), 3)
            );
          return;
        case 43:
          (i.midiExpression = ye.int32ToUint16((i.midiExpression & 16256) | r)),
            this.channelSetVolume(
              t,
              Math.pow((i.midiVolume / 16383) * (i.midiExpression / 16383), 3)
            );
          return;
        case 10:
          (i.midiPan = ye.int32ToUint16((i.midiPan & 127) | (r << 7))),
            this.channelSetPan(t, i.midiPan / 16383);
          return;
        case 42:
          (i.midiPan = ye.int32ToUint16((i.midiPan & 16256) | r)),
            this.channelSetPan(t, i.midiPan / 16383);
          return;
        case 6:
          (i.midiData = ye.int32ToUint16((i.midiData & 127) | (r << 7))),
            i.midiRpn === 0
              ? this.channelSetPitchRange(
                  t,
                  (i.midiData >> 7) + 0.01 * (i.midiData & 127)
                )
              : i.midiRpn === 1
              ? this.channelSetTuning(
                  t,
                  (i.tuning | 0) + (i.midiData - 8192) / 8192
                )
              : i.midiRpn === 2 &&
                e === 6 &&
                this.channelSetTuning(t, r - 64 + (i.tuning - (i.tuning | 0)));
          return;
        case 0:
          i.bank = ye.int32ToUint16(32768 | r);
          return;
        case 32:
          i.bank = ye.int32ToUint16(
            ((i.bank & 32768) !== 0 ? (i.bank & 127) << 7 : 0) | r
          );
          return;
        case 101:
          i.midiRpn = ye.int32ToUint16(
            ((i.midiRpn === 65535 ? 0 : i.midiRpn) & 127) | (r << 7)
          );
          return;
        case 100:
          i.midiRpn = ye.int32ToUint16(
            ((i.midiRpn === 65535 ? 0 : i.midiRpn) & 16256) | r
          );
          return;
        case 98:
          i.midiRpn = 65535;
          return;
        case 99:
          i.midiRpn = 65535;
          return;
        case 120:
          this.channelSoundsOffAll(t);
          return;
        case 123:
          this.channelNoteOffAll(t);
          return;
        case 121:
          (i.midiVolume = 16383),
            (i.midiExpression = 16383),
            (i.midiPan = 8192),
            (i.bank = 0),
            this.channelSetVolume(t, 1),
            this.channelSetPan(t, 0.5),
            this.channelSetPitchRange(t, 2);
          return;
      }
    }
    channelGetPresetIndex(t) {
      return this._channels && t < this._channels.channelList.length
        ? this._channels.channelList[t].presetIndex
        : 0;
    }
    channelGetPresetBank(t) {
      return this._channels && t < this._channels.channelList.length
        ? this._channels.channelList[t].bank & 32767
        : 0;
    }
    channelGetPan(t) {
      return this._channels && t < this._channels.channelList.length
        ? this._channels.channelList[t].panOffset - 0.5
        : 0.5;
    }
    channelGetVolume(t) {
      return this._channels && t < this._channels.channelList.length
        ? Fe.decibelsToGain(this._channels.channelList[t].gainDb)
        : 1;
    }
    channelGetPitchWheel(t) {
      return this._channels && t < this._channels.channelList.length
        ? this._channels.channelList[t].pitchWheel
        : 8192;
    }
    channelGetPitchRange(t) {
      return this._channels && t < this._channels.channelList.length
        ? this._channels.channelList[t].pitchRange
        : 2;
    }
    channelGetTuning(t) {
      return this._channels && t < this._channels.channelList.length
        ? this._channels.channelList[t].tuning
        : 0;
    }
    resetPresets() {
      this.presets = [];
    }
    loadPresets(t, e, r, i) {
      let n = [];
      for (let s = 0; s < t.phdrs.length - 1; s++) {
        let a = t.phdrs[s],
          o = 0,
          l = new Wu();
        n.push(l),
          (l.name = a.presetName),
          (l.bank = a.bank),
          (l.presetNumber = a.preset);
        let u = 0;
        for (let d = a.presetBagNdx; d < t.phdrs[s + 1].presetBagNdx; d++) {
          let h = t.pbags[d],
            f = 0,
            b = 127,
            y = 0,
            S = 127;
          for (let k = h.genNdx; k < t.pbags[d + 1].genNdx; k++) {
            let T = t.pgens[k];
            if (T.genOper === Rt.GenKeyRange) {
              (f = T.genAmount.lowByteAmount), (b = T.genAmount.highByteAmount);
              continue;
            }
            if (T.genOper === Rt.GenVelRange) {
              (y = T.genAmount.lowByteAmount), (S = T.genAmount.highByteAmount);
              continue;
            }
            if (
              T.genOper !== Rt.GenInstrument ||
              T.genAmount.wordAmount >= t.insts.length
            )
              continue;
            let O = t.insts[T.genAmount.wordAmount];
            for (
              let N = O.instBagNdx;
              N < t.insts[T.genAmount.wordAmount + 1].instBagNdx;
              N++
            ) {
              let R = t.ibags[N],
                g = 0,
                x = 127,
                M = 0,
                P = 127;
              for (let H = R.instGenNdx; H < t.ibags[N + 1].instGenNdx; H++) {
                let X = t.igens[H];
                if (X.genOper === Rt.GenKeyRange) {
                  (g = X.genAmount.lowByteAmount),
                    (x = X.genAmount.highByteAmount);
                  continue;
                }
                if (X.genOper === Rt.GenVelRange) {
                  (M = X.genAmount.lowByteAmount),
                    (P = X.genAmount.highByteAmount);
                  continue;
                }
                X.genOper === 53 && x >= f && g <= b && P >= y && M <= S && u++;
              }
            }
          }
        }
        l.regions = new Array(u);
        let c = new $i();
        c.clear(!0);
        for (let d = a.presetBagNdx; d < t.phdrs[s + 1].presetBagNdx; d++) {
          let h = t.pbags[d],
            f = new $i(c),
            b = !1;
          for (let y = h.genNdx; y < t.pbags[d + 1].genNdx; y++) {
            let S = t.pgens[y];
            if (S.genOper === Rt.GenInstrument) {
              let k = S.genAmount.wordAmount;
              if (k >= t.insts.length) continue;
              let T = new $i();
              T.clear(!1);
              let O = t.insts[k];
              for (let N = O.instBagNdx; N < t.insts[k + 1].instBagNdx; N++) {
                let R = t.ibags[N],
                  g = new $i(T),
                  x = !1;
                for (let M = R.instGenNdx; M < t.ibags[N + 1].instGenNdx; M++) {
                  let P = t.igens[M];
                  if (P.genOper === Rt.GenSampleId) {
                    if (
                      g.hiKey < f.loKey ||
                      g.loKey > f.hiKey ||
                      g.hiVel < f.loVel ||
                      g.loVel > f.hiVel
                    )
                      continue;
                    f.loKey > g.loKey && (g.loKey = f.loKey),
                      f.hiKey < g.hiKey && (g.hiKey = f.hiKey),
                      f.loVel > g.loVel && (g.loVel = f.loVel),
                      f.hiVel < g.hiVel && (g.hiVel = f.hiVel),
                      (g.offset += f.offset),
                      (g.end += f.end),
                      (g.loopStart += f.loopStart),
                      (g.loopEnd += f.loopEnd),
                      (g.transpose += f.transpose),
                      (g.tune += f.tune),
                      (g.pitchKeyTrack += f.pitchKeyTrack),
                      (g.attenuation += f.attenuation),
                      (g.pan += f.pan),
                      (g.ampEnv.delay += f.ampEnv.delay),
                      (g.ampEnv.attack += f.ampEnv.attack),
                      (g.ampEnv.hold += f.ampEnv.hold),
                      (g.ampEnv.decay += f.ampEnv.decay),
                      (g.ampEnv.sustain += f.ampEnv.sustain),
                      (g.ampEnv.release += f.ampEnv.release),
                      (g.modEnv.delay += f.modEnv.delay),
                      (g.modEnv.attack += f.modEnv.attack),
                      (g.modEnv.hold += f.modEnv.hold),
                      (g.modEnv.decay += f.modEnv.decay),
                      (g.modEnv.sustain += f.modEnv.sustain),
                      (g.modEnv.release += f.modEnv.release),
                      (g.initialFilterQ += f.initialFilterQ),
                      (g.initialFilterFc += f.initialFilterFc),
                      (g.modEnvToPitch += f.modEnvToPitch),
                      (g.modEnvToFilterFc += f.modEnvToFilterFc),
                      (g.delayModLFO += f.delayModLFO),
                      (g.freqModLFO += f.freqModLFO),
                      (g.modLfoToPitch += f.modLfoToPitch),
                      (g.modLfoToFilterFc += f.modLfoToFilterFc),
                      (g.modLfoToVolume += f.modLfoToVolume),
                      (g.delayVibLFO += f.delayVibLFO),
                      (g.freqVibLFO += f.freqVibLFO),
                      (g.vibLfoToPitch += f.vibLfoToPitch),
                      g.ampEnv.envToSecs(!0),
                      g.modEnv.envToSecs(!1),
                      (g.delayModLFO =
                        g.delayModLFO < -11950
                          ? 0
                          : Fe.timecents2Secs(g.delayModLFO)),
                      (g.delayVibLFO =
                        g.delayVibLFO < -11950
                          ? 0
                          : Fe.timecents2Secs(g.delayVibLFO)),
                      g.pan < -0.5
                        ? (g.pan = -0.5)
                        : g.pan > 0.5 && (g.pan = 0.5),
                      (g.initialFilterQ < 1500 || g.initialFilterQ > 13500) &&
                        (g.initialFilterQ = 0);
                    let H = t.sHdrs[P.genAmount.wordAmount];
                    (g.offset += H.start),
                      (g.end += H.end),
                      (g.loopStart += H.startLoop),
                      (g.loopEnd += H.endLoop),
                      H.endLoop > 0 && (g.loopEnd -= 1),
                      g.pitchKeyCenter === -1 &&
                        (g.pitchKeyCenter = H.originalPitch),
                      (g.tune += H.pitchCorrection),
                      (g.sampleRate = H.sampleRate);
                    let X = a.bank === Q.PercussionBank;
                    (X && p._setContainsRange(r, g.loKey, g.hiKey)) ||
                    (!X && e.has(a.preset))
                      ? (H.sampleType & 1) !== 0
                        ? (w.debug(
                            "AlphaSynth",
                            `Loading of used sample ${H.sampleName} for preset ${a.presetName} (bank ${l.bank} program ${l.presetNumber})`
                          ),
                          (H.sampleType & 16) !== 0
                            ? (g.samples = t.decodeSamples(H.start, H.end, !0))
                            : ((g.samples = t.decodeSamples(
                                g.offset * 2,
                                g.end * 2,
                                !1
                              )),
                              g.loopStart > 0 && (g.loopStart -= g.offset),
                              g.loopEnd > 0 && (g.loopEnd -= g.offset)),
                          (g.offset = 0),
                          (g.end = g.samples.length - 1))
                        : (H.sampleType & 32783) !== 0
                        ? (w.debug(
                            "AlphaSynth",
                            `Loading sample ${H.sampleName} for preset ${a.presetName} as mono fallback (type ${H.sampleType})`
                          ),
                          (g.samples = t.decodeSamples(
                            g.offset * 2,
                            g.end * 2,
                            !1
                          )),
                          g.loopStart > 0 && (g.loopStart -= g.offset),
                          g.loopEnd > 0 && (g.loopEnd -= g.offset),
                          (g.offset = 0),
                          (g.end = g.samples.length - 1))
                        : (w.warning(
                            "AlphaSynth",
                            `Skipping load of unsupported sample ${H.sampleName} for preset ${a.presetName}, sample type ${H.sampleType} is not supported (bank ${l.bank} program ${l.presetNumber})`
                          ),
                          (g.samples = new Float32Array(0)))
                      : (w.debug(
                          "AlphaSynth",
                          `Skipping load of unused sample ${H.sampleName} for preset ${a.presetName} (bank ${l.bank} program ${l.presetNumber})`
                        ),
                        (g.samples = new Float32Array(0))),
                      (l.regions[o] = new $i(g)),
                      o++,
                      (x = !0);
                  } else g.operator(P.genOper, P.genAmount);
                }
                R === t.ibags[O.instBagNdx] && !x && (T = new $i(g));
              }
              b = !0;
            } else f.operator(S.genOper, S.genAmount);
          }
          h === t.pbags[a.presetBagNdx] && !b && (c = f);
        }
      }
      if (!i || !this.presets) this.presets = n;
      else for (let s of n) this.presets.push(s);
    }
    static _setContainsRange(t, e, r) {
      for (let i = e; i <= r; i++) if (t.has(i)) return !0;
      return !1;
    }
    hasSamplesForProgram(t) {
      let e = this.presets;
      if (!e) return !1;
      for (let r of e)
        if (r.presetNumber === t) {
          for (let i of r.regions) if (i.samples.length > 0) return !0;
        }
      return !1;
    }
    hasSamplesForPercussion(t) {
      let e = this.presets;
      if (!e) return !1;
      for (let r of e)
        if (r.bank === Q.PercussionBank) {
          for (let i of r.regions)
            if (i.loKey >= t && i.hiKey <= t && i.samples.length > 0) return !0;
        }
      return !1;
    }
  };
  var Wn = class {
    constructor(t) {
      this.events = t;
    }
  };
  var fi = class {
    constructor(t) {
      this.playbackRange = t;
    }
  };
  var aa = class {
      constructor() {
        this.sampleRate = 44100;
        this.useSyncPoints = !1;
        this.masterVolume = 1;
        this.metronomeVolume = 0;
        this.trackVolume = new Map();
        this.trackTranspositionPitches = new Map();
      }
    },
    oa = class {
      constructor() {
        this.currentTime = 0;
        this.endTime = 0;
        this.currentTick = 0;
        this.endTick = 0;
      }
    };
  var Ss = class {
      constructor(t, e, r) {
        this.isSoundFontLoaded = !1;
        this._isMidiLoaded = !1;
        this._tickPosition = 0;
        this._timePosition = 0;
        this._metronomeVolume = 0;
        this._countInVolume = 0;
        this.playedEventsQueue = new Vn();
        this.midiEventsPlayedFilterSet = new Set();
        this._notPlayedSamples = 0;
        this._synthStopping = !1;
        this._currentPosition = new er(0, 0, 0, 0, !1, 120, 120);
        this.isReady = !1;
        this.state = 0;
        this._loadedSoundFonts = [];
        this.readyForPlayback = new Be();
        this.finished = new Be();
        this.soundFontLoaded = new Be();
        this.soundFontLoadFailed = new Z();
        this.midiLoadFailed = new Z();
        this.midiEventsPlayed = new Z();
        w.debug("AlphaSynth", "Initializing player"),
          (this.state = 0),
          (this.ready = new Be(() => this.isReady)),
          (this.readyForPlayback = new Be(() => this.isReadyForPlayback)),
          (this.midiLoaded = new Z(() =>
            this._loadedMidiInfo ? this._loadedMidiInfo : null
          )),
          (this.stateChanged = new Z(() => new Or(this.state, !1))),
          (this.positionChanged = new Z(() => this._currentPosition)),
          (this.playbackRangeChanged = new Z(() =>
            this.playbackRange ? new fi(this.playbackRange) : null
          )),
          w.debug("AlphaSynth", "Creating output"),
          (this._output = t),
          w.debug("AlphaSynth", "Creating synthesizer"),
          (this.synthesizer = e),
          (this.sequencer = new _o(this.synthesizer)),
          w.debug("AlphaSynth", "Opening output"),
          this.output.ready.on(() => {
            (this.isReady = !0),
              this.ready.trigger(),
              this._checkReadyForPlayback();
          }),
          this.output.sampleRequest.on(() => {
            this.onSampleRequest();
          }),
          this.output.samplesPlayed.on(this._onSamplesPlayed.bind(this)),
          this.output.open(r);
      }
      get output() {
        return this._output;
      }
      get isReadyForPlayback() {
        return this.isReady && this.isSoundFontLoaded && this._isMidiLoaded;
      }
      get logLevel() {
        return w.logLevel;
      }
      set logLevel(t) {
        w.logLevel = t;
      }
      get masterVolume() {
        return this.synthesizer.masterVolume;
      }
      set masterVolume(t) {
        (t = Math.max(t, Q.MinVolume)), this.updateMasterVolume(t);
      }
      updateMasterVolume(t) {
        this.synthesizer.masterVolume = t;
      }
      get metronomeVolume() {
        return this._metronomeVolume;
      }
      set metronomeVolume(t) {
        (t = Math.max(t, Q.MinVolume)),
          (this._metronomeVolume = t),
          (this.synthesizer.metronomeVolume = t);
      }
      get countInVolume() {
        return this._countInVolume;
      }
      set countInVolume(t) {
        (t = Math.max(t, Q.MinVolume)), (this._countInVolume = t);
      }
      get midiEventsPlayedFilter() {
        return Array.from(this.midiEventsPlayedFilterSet);
      }
      set midiEventsPlayedFilter(t) {
        this.midiEventsPlayedFilterSet = new Set(t);
      }
      get playbackSpeed() {
        return this.sequencer.playbackSpeed;
      }
      set playbackSpeed(t) {
        (t = A.clamp(t, Q.MinPlaybackSpeed, Q.MaxPlaybackSpeed)),
          this.updatePlaybackSpeed(t);
      }
      updatePlaybackSpeed(t) {
        let e = this.sequencer.playbackSpeed;
        (this.sequencer.playbackSpeed = t),
          (this.timePosition = this.timePosition * (e / t));
      }
      get loadedMidiInfo() {
        return this._loadedMidiInfo;
      }
      get currentPosition() {
        return this._currentPosition;
      }
      get tickPosition() {
        return this._tickPosition;
      }
      set tickPosition(t) {
        this.timePosition = this.sequencer.mainTickPositionToTimePosition(t);
      }
      get timePosition() {
        return this._timePosition;
      }
      set timePosition(t) {
        w.debug("AlphaSynth", `Seeking to position ${t}ms (main)`),
          this.sequencer.mainSeek(t),
          this.updateTimePosition(t, !0),
          this.sequencer.isPlayingMain &&
            ((this._notPlayedSamples = 0), this.output.resetSamples());
      }
      get playbackRange() {
        return this.sequencer.mainPlaybackRange;
      }
      set playbackRange(t) {
        (this.sequencer.mainPlaybackRange = t),
          t && (this.tickPosition = t.startTick),
          this.playbackRangeChanged.trigger(new fi(t));
      }
      get isLooping() {
        return this.sequencer.isLooping;
      }
      set isLooping(t) {
        this.sequencer.isLooping = t;
      }
      destroy() {
        w.debug("AlphaSynth", "Destroying player"),
          this.stop(),
          this.output.destroy();
      }
      onSampleRequest() {
        if (
          this.state === 1 &&
          (!this.sequencer.isFinished || this.synthesizer.activeVoiceCount > 0)
        ) {
          let t = new Float32Array(
              Q.MicroBufferSize * Q.MicroBufferCount * Q.AudioChannels
            ),
            e = 0;
          for (let r = 0; r < Q.MicroBufferCount; r++) {
            this.sequencer.fillMidiEventQueue();
            let i = this.synthesizer.synthesize(t, e, Q.MicroBufferSize);
            e += Q.MicroBufferSize * Q.AudioChannels;
            for (let n of i)
              this.midiEventsPlayedFilterSet.has(n.event.type) &&
                this.playedEventsQueue.enqueue(n);
            if (this.sequencer.isFinished) break;
          }
          e < t.length && (t = t.subarray(0, e)),
            (this._notPlayedSamples += t.length),
            this.output.addSamples(t);
        } else {
          let t = new Float32Array(0);
          this.output.addSamples(t);
        }
      }
      play() {
        return this.state !== 0 || !this._isMidiLoaded
          ? !1
          : (this.output.activate(),
            this._playInternal(),
            this._countInVolume > 0 &&
              (w.debug("AlphaSynth", "Starting countin"),
              this.sequencer.startCountIn(),
              this.synthesizer.setupMetronomeChannel(this._countInVolume),
              this.updateTimePosition(0, !0)),
            this.output.play(),
            !0);
      }
      _playInternal() {
        this.sequencer.isPlayingOneTimeMidi &&
          (w.debug("AlphaSynth", "Cancelling one time midi"),
          this._stopOneTimeMidi()),
          w.debug("AlphaSynth", "Starting playback"),
          this.synthesizer.setupMetronomeChannel(this.metronomeVolume),
          (this._synthStopping = !1),
          (this.state = 1),
          this.stateChanged.trigger(new Or(this.state, !1));
      }
      pause() {
        this.state === 0 ||
          !this._isMidiLoaded ||
          (w.debug("AlphaSynth", "Pausing playback"),
          (this.state = 0),
          this.stateChanged.trigger(new Or(this.state, !1)),
          this.output.pause(),
          this.synthesizer.noteOffAll(!1));
      }
      playPause() {
        this.state !== 0 || !this._isMidiLoaded ? this.pause() : this.play();
      }
      stop() {
        this._isMidiLoaded &&
          (w.debug("AlphaSynth", "Stopping playback"),
          (this.state = 0),
          this.output.pause(),
          (this._notPlayedSamples = 0),
          this.sequencer.stop(),
          this.synthesizer.noteOffAll(!0),
          (this.tickPosition = this.sequencer.mainPlaybackRange
            ? this.sequencer.mainPlaybackRange.startTick
            : 0),
          this.stateChanged.trigger(new Or(this.state, !0)));
      }
      playOneTimeMidiFile(t) {
        this.sequencer.isPlayingOneTimeMidi
          ? this._stopOneTimeMidi()
          : this.pause(),
          this.sequencer.loadOneTimeMidi(t),
          this.synthesizer.noteOffAll(!0),
          this.updateTimePosition(0, !0),
          (this._notPlayedSamples = 0),
          this.output.resetSamples(),
          this.output.play();
      }
      resetSoundFonts() {
        this.stop(),
          this.synthesizer.resetPresets(),
          (this._loadedSoundFonts = []),
          (this.isSoundFontLoaded = !1),
          this.soundFontLoaded.trigger();
      }
      loadSoundFont(t, e) {
        this.pause();
        let r = Se.fromBuffer(t);
        try {
          w.debug("AlphaSynth", "Loading soundfont from bytes");
          let i = new Do();
          i.load(r),
            e || (this._loadedSoundFonts = []),
            this._loadedSoundFonts.push(i),
            (this.isSoundFontLoaded = !0),
            this.soundFontLoaded.trigger(),
            w.debug("AlphaSynth", "soundFont successfully loaded"),
            this._checkReadyForPlayback();
        } catch (i) {
          w.error("AlphaSynth", `Could not load soundfont from bytes ${i}`),
            this.soundFontLoadFailed.trigger(i);
        }
      }
      _checkReadyForPlayback() {
        if (this.isReadyForPlayback) {
          this.synthesizer.setupMetronomeChannel(this.metronomeVolume);
          let t = this.sequencer.instrumentPrograms,
            e = this.sequencer.percussionKeys,
            r = !1;
          for (let i of this._loadedSoundFonts)
            this.synthesizer.loadPresets(i, t, e, r), (r = !0);
          this.readyForPlayback.trigger();
        }
      }
      loadMidiFile(t) {
        this.stop();
        try {
          w.debug("AlphaSynth", "Loading midi from model"),
            this.sequencer.loadMidi(t),
            (this._isMidiLoaded = !0),
            (this._loadedMidiInfo = new er(
              0,
              this.sequencer.currentEndTime,
              0,
              this.sequencer.currentEndTick,
              !1,
              this.sequencer.currentTempo,
              this.sequencer.modifiedTempo
            )),
            this.midiLoaded.trigger(this._loadedMidiInfo),
            w.debug("AlphaSynth", "Midi successfully loaded"),
            this._checkReadyForPlayback(),
            (this.tickPosition = 0);
        } catch (e) {
          w.error("AlphaSynth", `Could not load midi from model ${e}`),
            this.midiLoadFailed.trigger(e);
        }
      }
      applyTranspositionPitches(t) {
        this.synthesizer.applyTranspositionPitches(t);
      }
      setChannelTranspositionPitch(t, e) {
        this.synthesizer.setChannelTranspositionPitch(t, e);
      }
      setChannelMute(t, e) {
        this.synthesizer.channelSetMute(t, e);
      }
      resetChannelStates() {
        this.synthesizer.resetChannelStates();
      }
      setChannelSolo(t, e) {
        this.synthesizer.channelSetSolo(t, e);
      }
      setChannelVolume(t, e) {
        (e = Math.max(e, Q.MinVolume)),
          this.synthesizer.channelSetMixVolume(t, e);
      }
      _onSamplesPlayed(t) {
        if (t === 0) return;
        let e = (t / this.synthesizer.outSampleRate) * 1e3;
        (this._notPlayedSamples -= t * Q.AudioChannels),
          this.updateTimePosition(this._timePosition + e, !1),
          this.checkForFinish();
      }
      checkForFinish() {
        let t = 0,
          e = 0;
        this.playbackRange && this.sequencer.isPlayingMain
          ? ((t = this.playbackRange.startTick),
            (e = this.playbackRange.endTick))
          : (e = this.sequencer.currentEndTick),
          this._tickPosition >= e &&
            (this._notPlayedSamples <= 0
              ? ((this._notPlayedSamples = 0),
                this.sequencer.isPlayingCountIn
                  ? (w.debug("AlphaSynth", "Finished playback (count-in)"),
                    this.sequencer.resetCountIn(),
                    (this.timePosition = this.sequencer.currentTime),
                    this._playInternal(),
                    this.output.resetSamples())
                  : this.sequencer.isPlayingOneTimeMidi
                  ? (w.debug("AlphaSynth", "Finished playback (one time)"),
                    this.output.resetSamples(),
                    (this.state = 0),
                    this._stopOneTimeMidi())
                  : this.isLooping
                  ? (w.debug("AlphaSynth", "Finished playback (main looping)"),
                    this.finished.trigger(),
                    (this.tickPosition = t),
                    (this._synthStopping = !1))
                  : this.synthesizer.activeVoiceCount > 0
                  ? this._synthStopping ||
                    (w.debug(
                      "AlphaSynth",
                      "Signaling synth to stop all voices (all samples played)"
                    ),
                    this.synthesizer.noteOffAll(!0),
                    (this._synthStopping = !0))
                  : ((this._synthStopping = !1),
                    w.debug("AlphaSynth", "Finished playback (main)"),
                    this.finished.trigger(),
                    this.stop()))
              : this._synthStopping ||
                (w.debug(
                  "AlphaSynth",
                  "Signaling synth to stop all voices (not all samples played)"
                ),
                this.synthesizer.noteOffAll(!0),
                (this._synthStopping = !0)));
      }
      _stopOneTimeMidi() {
        this.output.pause(),
          this.synthesizer.noteOffAll(!0),
          this.sequencer.resetOneTimeMidi(),
          (this.timePosition = this.sequencer.currentTime);
      }
      _createPositionChangedEventArgs(t) {
        let e = this._timePosition,
          r = this.sequencer.currentTimePositionToTickPosition(e),
          i = this.sequencer.currentEndTime,
          n = this.sequencer.currentEndTick;
        return (
          e > i && ((e = i), (r = n)),
          new er(
            e,
            i,
            r,
            n,
            t,
            this.sequencer.currentTempo,
            this.sequencer.modifiedTempo
          )
        );
      }
      updateTimePosition(t, e) {
        this._timePosition = t;
        let r = this._createPositionChangedEventArgs(e);
        this._tickPosition = r.currentTick;
        let i = this.sequencer.isPlayingMain
          ? "main"
          : this.sequencer.isPlayingCountIn
          ? "count-in"
          : "one-time";
        if (
          (w.debug(
            "AlphaSynth",
            `Position changed: (time: ${r.currentTime}/${r.endTime}, tick: ${r.currentTick}/${r.endTick}, Active Voices: ${this.synthesizer.activeVoiceCount} (${i}), Tempo original: ${this.sequencer.currentTempo}, Tempo modified: ${this.sequencer.modifiedTempo})`
          ),
          this.sequencer.isPlayingMain &&
            ((this._currentPosition = r), this.positionChanged.trigger(r)),
          e)
        )
          this.playedEventsQueue.clear();
        else {
          let n = [];
          for (
            ;
            !this.playedEventsQueue.isEmpty &&
            this.playedEventsQueue.peek().time < r.currentTime;

          ) {
            let s = this.playedEventsQueue.dequeue();
            n.push(s.event);
          }
          n.length > 0 &&
            (n.reverse(), this.midiEventsPlayed.trigger(new Wn(n)));
        }
      }
      hasSamplesForProgram(t) {
        return this.synthesizer.hasSamplesForProgram(t);
      }
      hasSamplesForPercussion(t) {
        return this.synthesizer.hasSamplesForPercussion(t);
      }
      loadBackingTrack(t) {}
      updateSyncPoints(t) {}
    },
    la = class extends Ss {
      constructor(t, e) {
        super(t, new Ho(t.sampleRate), e);
      }
      exportAudio(t, e, r, i) {
        let n = new Zp(t);
        n.loadMidiFile(e),
          t.useSyncPoints && n.updateSyncPoints(r),
          n.applyTranspositionPitches(i);
        for (let [s, a] of t.trackTranspositionPitches)
          n.setChannelTranspositionPitch(s, a);
        for (let [s, a] of t.trackVolume) n.channelSetMixVolume(s, a);
        if (t.soundFonts) for (let s of t.soundFonts) n.loadSoundFont(s);
        else n.loadPresets(this.synthesizer.presets);
        return t.playbackRange && n.limitExport(t.playbackRange), n.setup(), n;
      }
    },
    Zp = class {
      constructor(t) {
        this._generatedAudioCurrentTime = 0;
        this._generatedAudioEndTime = 0;
        (this._synth = new Ho(t.sampleRate)),
          (this._sequencer = new _o(this._synth)),
          (this._synth.masterVolume = Math.max(t.masterVolume, Q.MinVolume)),
          (this._synth.metronomeVolume = Math.max(
            t.metronomeVolume,
            Q.MinVolume
          ));
      }
      loadSoundFont(t) {
        let e = Se.fromBuffer(t),
          r = new Do();
        r.load(e);
        let i = this._sequencer.instrumentPrograms,
          n = this._sequencer.percussionKeys;
        this._synth.loadPresets(r, i, n, !0);
      }
      loadPresets(t) {
        this._synth.presets = t;
      }
      limitExport(t) {
        (this._sequencer.mainPlaybackRange = t),
          this._sequencer.mainSeek(
            this._sequencer.mainTickPositionToTimePosition(t.startTick)
          );
      }
      setChannelTranspositionPitch(t, e) {
        this._synth.setChannelTranspositionPitch(t, e);
      }
      applyTranspositionPitches(t) {
        this._synth.applyTranspositionPitches(t);
      }
      loadMidiFile(t) {
        this._sequencer.loadMidi(t);
      }
      updateSyncPoints(t) {
        this._sequencer.mainUpdateSyncPoints(t);
      }
      channelSetMixVolume(t, e) {
        (e = Math.max(e, Q.MinVolume)), this._synth.channelSetMixVolume(t, e);
      }
      setup() {
        this._synth.setupMetronomeChannel(this._synth.metronomeVolume);
        let t = this._sequencer.currentSyncPoints,
          e = this._sequencer.currentEndTime;
        if (t.length === 0) this._generatedAudioEndTime = e;
        else {
          let r = t[t.length - 1],
            i = r.syncTime,
            n = this._sequencer.currentEndTick - r.synthTick;
          n > 0 && (i += E.ticksToMillis(n, r.syncBpm)),
            (this._generatedAudioEndTime = i);
        }
      }
      render(t) {
        if (this._sequencer.isFinished) return;
        let e = (Q.MicroBufferSize * 1e3) / this._synth.outSampleRate,
          r = Math.ceil(t / e),
          i = new Float32Array(Q.MicroBufferSize * r * Q.AudioChannels),
          n = this._sequencer.currentSyncPoints,
          s = 0,
          a = this._generatedAudioCurrentTime;
        for (let l = 0; l < r; l++) {
          if (n.length > 0) {
            this._sequencer.currentUpdateSyncPoints(a),
              this._sequencer.currentUpdateCurrentTempo(
                this._sequencer.currentTime
              );
            let u =
              this._sequencer.syncPointTempo / this._sequencer.currentTempo;
            this._sequencer.playbackSpeed !== u &&
              (this._sequencer.playbackSpeed = u);
          }
          if (
            (this._sequencer.fillMidiEventQueue(),
            this._synth.synthesize(i, s, Q.MicroBufferSize),
            (s += Q.MicroBufferSize * Q.AudioChannels),
            (a += e),
            this._sequencer.isFinished)
          )
            break;
        }
        s < i.length && (i = i.subarray(0, s));
        let o = new oa();
        return (
          (o.currentTime = this._generatedAudioCurrentTime),
          (o.endTime = this._generatedAudioEndTime),
          (o.currentTick = this._sequencer.currentTimePositionToTickPosition(
            this._sequencer.currentTime
          )),
          (o.endTick = this._sequencer.currentEndTick),
          (this._generatedAudioCurrentTime += t),
          (o.samples = i),
          this._sequencer.isFinished && this._synth.noteOffAll(!0),
          o
        );
      }
    };
  var _ = class {
    static parseEnum(t, e) {
      switch (typeof t) {
        case "string":
          let r = Number.parseInt(t, 10);
          return Number.isNaN(r)
            ? e[Object.keys(e).find((i) => i.toLowerCase() === t.toLowerCase())]
            : r;
        case "number":
          return t;
        case "undefined":
        case "object":
          return;
      }
      throw new te(1, `Could not parse enum value '${t}'`);
    }
    static parseEnumExact(t, e) {
      if (t in e) return e[t];
    }
    static forEach(t, e) {
      if (t instanceof Map) t.forEach(e);
      else if (typeof t == "object") for (let r in t) e(t[r], r);
    }
    static getValue(t, e) {
      return t instanceof Map ? t.get(e) : typeof t == "object" ? t[e] : null;
    }
  };
  var jp = class {
      constructor(t, e, r) {
        (this.text = t), (this.startPos = e), (this.endPos = r);
      }
    },
    ua = class p {
      constructor(t) {
        this.style = "normal";
        this.variant = "normal";
        this.weight = "normal";
        this.stretch = "normal";
        this.lineHeight = "normal";
        this.size = "1rem";
        this.families = [];
        this.parseOnlyFamilies = !1;
        this._currentTokenIndex = -1;
        this._input = "";
        this._currentToken = null;
        (this._input = t), (this._tokens = this._splitToTokens(t));
      }
      _splitToTokens(t) {
        let e = [],
          r = 0;
        for (; r < t.length; ) {
          let i = r;
          for (; i < t.length && t.charAt(i) !== " "; ) i++;
          i > r && e.push(new jp(t.substring(r, i), r, i)), (r = i + 1);
        }
        return e;
      }
      parse() {
        if ((this._reset(), this._tokens.length === 1))
          switch (this._currentToken?.text) {
            case "caption":
            case "icon":
            case "menu":
            case "message-box":
            case "small-caption":
            case "status-bar":
            case "inherit":
              return;
          }
        this.parseOnlyFamilies ||
          (this._fontStyleVariantWeight(), this._fontSizeLineHeight()),
          this._fontFamily();
      }
      static parseFamilies(t) {
        let e = new p(t);
        return (e.parseOnlyFamilies = !0), e.parse(), e.families;
      }
      _fontFamily() {
        if (!this._currentToken) {
          if (this.parseOnlyFamilies) return;
          throw new Error("Missing font list");
        }
        let t = this._input.substr(this._currentToken.startPos).trim(),
          e = 0;
        for (; e < t.length; ) {
          let r = t.charAt(e);
          if (r === " " || r === ",") e++;
          else if (r === '"' || r === "'") {
            let i = this._findEndOfQuote(t, e + 1, r);
            this.families.push(
              t
                .substring(e + 1, i)
                .split(`\\${r}`)
                .join(r)
            ),
              (e = i + 1);
          } else {
            let i = this._findEndOfQuote(t, e + 1, ",");
            this.families.push(t.substring(e, i).trim()), (e = i + 1);
          }
        }
      }
      _findEndOfQuote(t, e, r) {
        let i = !1;
        for (; e < t.length; ) {
          let n = t.charAt(e);
          if (!i && n === r) return e;
          !i && n === "\\" ? (i = !0) : (i = !1), (e += 1);
        }
        return t.length;
      }
      _fontSizeLineHeight() {
        if (!this._currentToken) throw new Error("Missing font size");
        let t = this._currentToken.text.split("/");
        if (t.length >= 3)
          throw new Error(
            `Invalid font size '${this._currentToken}' specified`
          );
        if ((this._nextToken(), t.length >= 2))
          if (t[1] === "/") {
            if (!this._currentToken)
              throw new Error("Missing line-height after font size");
            (this.lineHeight = this._currentToken.text), this._nextToken();
          } else (this.size = t[0]), (this.lineHeight = t[1]);
        else if (t.length >= 1) {
          if (
            ((this.size = t[0]),
            this._currentToken && this._currentToken.text.indexOf("/") === 0)
          )
            if (this._currentToken.text === "/") {
              if ((this._nextToken(), !this._currentToken))
                throw new Error("Missing line-height after font size");
              (this.lineHeight = this._currentToken.text), this._nextToken();
            } else
              (this.lineHeight = this._currentToken.text.substr(1)),
                this._nextToken();
        } else throw new Error("Missing font size");
      }
      _nextToken() {
        this._currentTokenIndex++,
          this._currentTokenIndex < this._tokens.length
            ? (this._currentToken = this._tokens[this._currentTokenIndex])
            : (this._currentToken = null);
      }
      _fontStyleVariantWeight() {
        let t = !1,
          e = !1,
          r = !1,
          i = 3,
          n = [];
        for (;;) {
          if (!this._currentToken) return;
          let s = this._currentToken.text;
          switch (s) {
            case "normal":
            case "inherit":
              n.push(s), i--, this._nextToken();
              break;
            case "italic":
            case "oblique":
              (this.style = s), (t = !0), i--, this._nextToken();
              break;
            case "small-caps":
              (this.variant = s), (e = !0), i--, this._nextToken();
              break;
            case "bold":
            case "bolder":
            case "lighter":
            case "100":
            case "200":
            case "300":
            case "400":
            case "500":
            case "600":
            case "700":
            case "800":
            case "900":
              (this.weight = s), (r = !0), i--, this._nextToken();
              break;
            default:
              return;
          }
          if (i === 0) break;
        }
        for (; n.length > 0; ) {
          let s = n.pop();
          r
            ? e
              ? t || (this.style = s)
              : (this.variant = s)
            : (this.weight = s);
        }
      }
      _reset() {
        (this._currentTokenIndex = -1), this._nextToken();
      }
      static quoteFont(t) {
        return t.indexOf(" ") === -1 ? t : `"${t.replaceAll('"', '\\"')}"`;
      }
    },
    Ci = ((e) => (
      (e[(e.Plain = 0)] = "Plain"), (e[(e.Italic = 1)] = "Italic"), e
    ))(Ci || {}),
    Mi = ((e) => (
      (e[(e.Regular = 0)] = "Regular"), (e[(e.Bold = 1)] = "Bold"), e
    ))(Mi || {}),
    ne = class p {
      constructor(t, e, r = 0, i = 0) {
        this._cssScale = 0;
        (this._families = ua.parseFamilies(t)),
          (this._size = e),
          (this._style = r),
          (this._weight = i),
          (this._css = this.toCssString());
      }
      _reset() {
        (this._cssScale = 0), (this._css = this.toCssString());
      }
      get family() {
        return this._families[0];
      }
      set family(t) {
        this.families = ua.parseFamilies(t);
      }
      get families() {
        return this._families;
      }
      set families(t) {
        (this._families = t), this._reset();
      }
      get size() {
        return this._size;
      }
      set size(t) {
        (this._size = t), this._reset();
      }
      get style() {
        return this._style;
      }
      set style(t) {
        (this._style = t), this._reset();
      }
      get weight() {
        return this._weight;
      }
      set weight(t) {
        (this._weight = t), this._reset();
      }
      get isBold() {
        return this.weight === 1;
      }
      get isItalic() {
        return this.style === 1;
      }
      withSize(t) {
        return p.withFamilyList(this._families, t, this._style, this._weight);
      }
      static withFamilyList(t, e, r = 0, i = 0) {
        let n = new p("", e, r, i);
        return (n.families = t), n;
      }
      toCssString(t = 1) {
        if (!this._css || !(Math.abs(t - this._cssScale) < 0.01)) {
          let e = "";
          this.isBold && (e += "bold "),
            this.isItalic && (e += "italic "),
            (e += this.size * t),
            (e += "px "),
            (e += this.families.map((r) => ua.quoteFont(r)).join(", ")),
            (this._css = e),
            (this._cssScale = t);
        }
        return this._css;
      }
      static fromJson(t) {
        if (t instanceof p) return t;
        switch (typeof t) {
          case "undefined":
            return;
          case "object": {
            let e = t,
              r = e.get("families"),
              i = e.get("size"),
              n = _.parseEnum(e.get("style"), Ci),
              s = _.parseEnum(e.get("weight"), Mi);
            return p.withFamilyList(r, i, n, s);
          }
          case "string": {
            let e = new ua(t);
            e.parse();
            let r = e.families,
              i = e.size.toLowerCase(),
              n = 0;
            switch (i) {
              case "xx-small":
                n = 7;
                break;
              case "x-small":
                n = 10;
                break;
              case "small":
              case "smaller":
                n = 13;
                break;
              case "medium":
                n = 16;
                break;
              case "large":
              case "larger":
                n = 18;
                break;
              case "x-large":
                n = 24;
                break;
              case "xx-large":
                n = 32;
                break;
              default:
                try {
                  i.endsWith("em")
                    ? (n = Number.parseFloat(i.substr(0, i.length - 2)) * 16)
                    : i.endsWith("pt")
                    ? (n =
                        (Number.parseFloat(i.substr(0, i.length - 2)) * 16) /
                        12)
                    : i.endsWith("px")
                    ? (n = Number.parseFloat(i.substr(0, i.length - 2)))
                    : (n = 12);
                } catch {
                  n = 12;
                }
                break;
            }
            let s = 0;
            e.style === "italic" && (s = 1);
            let a = 0;
            switch (e.weight.toLowerCase()) {
              case "normal":
              case "lighter":
                break;
              default:
                a = 1;
                break;
            }
            return p.withFamilyList(r, n, s, a);
          }
          default:
            return;
        }
      }
      static toJson(t) {
        if (!t) return;
        let e = new Map();
        return (
          e.set("families", t.families),
          e.set("size", t.size),
          e.set("style", t.style),
          e.set("weight", t.weight),
          e
        );
      }
    };
  var Xu = class {
    static clone(t) {
      let e = new Hn();
      return (
        (e.musicFontSize = t.musicFontSize),
        (e.oneStaffSpace = t.oneStaffSpace),
        (e.tabLineSpacing = t.tabLineSpacing),
        (e.arrowShaftThickness = t.arrowShaftThickness),
        (e.barlineSeparation = t.barlineSeparation),
        (e.beamSpacing = t.beamSpacing),
        (e.beamThickness = t.beamThickness),
        (e.bracketThickness = t.bracketThickness),
        (e.dashedBarlineDashLength = t.dashedBarlineDashLength),
        (e.dashedBarlineGapLength = t.dashedBarlineGapLength),
        (e.dashedBarlineThickness = t.dashedBarlineThickness),
        (e.hairpinThickness = t.hairpinThickness),
        (e.legerLineThickness = t.legerLineThickness),
        (e.legerLineExtension = t.legerLineExtension),
        (e.octaveLineThickness = t.octaveLineThickness),
        (e.pedalLineThickness = t.pedalLineThickness),
        (e.repeatBarlineDotSeparation = t.repeatBarlineDotSeparation),
        (e.repeatEndingLineThickness = t.repeatEndingLineThickness),
        (e.slurMidpointThickness = t.slurMidpointThickness),
        (e.staffLineThickness = t.staffLineThickness),
        (e.stemThickness = t.stemThickness),
        (e.thickBarlineThickness = t.thickBarlineThickness),
        (e.thinBarlineThickness = t.thinBarlineThickness),
        (e.thinThickBarlineSeparation = t.thinThickBarlineSeparation),
        (e.tieMidpointThickness = t.tieMidpointThickness),
        (e.tupletBracketThickness = t.tupletBracketThickness),
        (e.stemUp = new Map(t.stemUp)),
        (e.stemDown = new Map(t.stemDown)),
        (e.repeatOffsetX = new Map(t.repeatOffsetX)),
        (e.standardStemLength = t.standardStemLength),
        (e.stemFlagOffsets = new Map(t.stemFlagOffsets)),
        (e.glyphTop = new Map(t.glyphTop)),
        (e.glyphBottom = new Map(t.glyphBottom)),
        (e.glyphWidths = new Map(t.glyphWidths)),
        (e.glyphHeights = new Map(t.glyphHeights)),
        (e.numberedBarRendererBarSize = t.numberedBarRendererBarSize),
        (e.numberedBarRendererBarSpacing = t.numberedBarRendererBarSpacing),
        (e.numberedDashGlyphPadding = t.numberedDashGlyphPadding),
        (e.numberedDashGlyphWidth = t.numberedDashGlyphWidth),
        (e.lineRangedGlyphDashGap = t.lineRangedGlyphDashGap),
        (e.lineRangedGlyphDashSize = t.lineRangedGlyphDashSize),
        (e.preNoteEffectPadding = t.preNoteEffectPadding),
        (e.postNoteEffectPadding = t.postNoteEffectPadding),
        (e.onNoteEffectPadding = t.onNoteEffectPadding),
        (e.stringNumberCirclePadding = t.stringNumberCirclePadding),
        (e.rowContainerPadding = t.rowContainerPadding),
        (e.rowContainerGap = t.rowContainerGap),
        (e.alternateEndingsPadding = t.alternateEndingsPadding),
        (e.sustainPedalLinePadding = t.sustainPedalLinePadding),
        (e.tieHeight = t.tieHeight),
        (e.beatTimerPadding = t.beatTimerPadding),
        (e.bendNoteHeadElementPadding = t.bendNoteHeadElementPadding),
        (e.ghostParenthesisWidth = t.ghostParenthesisWidth),
        (e.ghostParenthesisPadding = t.ghostParenthesisPadding),
        (e.brokenBeamWidth = t.brokenBeamWidth),
        (e.tabWhammyTextPadding = t.tabWhammyTextPadding),
        (e.tabWhammyPerHalfHeight = t.tabWhammyPerHalfHeight),
        (e.tabWhammyDashSize = t.tabWhammyDashSize),
        (e.songBookWhammyDipHeight = t.songBookWhammyDipHeight),
        (e.deadSlappedLineWidth = t.deadSlappedLineWidth),
        (e.leftHandTabTieWidth = t.leftHandTabTieWidth),
        (e.tabBendDashSize = t.tabBendDashSize),
        (e.tabBendPerValueHeight = t.tabBendPerValueHeight),
        (e.tabBendLabelPadding = t.tabBendLabelPadding),
        (e.simpleSlideWidth = t.simpleSlideWidth),
        (e.simpleSlideHeight = t.simpleSlideHeight),
        (e.chordDiagramPaddingX = t.chordDiagramPaddingX),
        (e.chordDiagramPaddingY = t.chordDiagramPaddingY),
        (e.chordDiagramStringSpacing = t.chordDiagramStringSpacing),
        (e.chordDiagramFretSpacing = t.chordDiagramFretSpacing),
        (e.chordDiagramNutHeight = t.chordDiagramNutHeight),
        (e.chordDiagramFretHeight = t.chordDiagramFretHeight),
        (e.chordDiagramLineWidth = t.chordDiagramLineWidth),
        (e.tripletFeelBracketPadding = t.tripletFeelBracketPadding),
        (e.accidentalPadding = t.accidentalPadding),
        (e.preBeatGlyphSpacing = t.preBeatGlyphSpacing),
        (e.tempoNoteScale = t.tempoNoteScale),
        (e.tuningGlyphCircleNumberScale = t.tuningGlyphCircleNumberScale),
        (e.tuningGlyphStringColumnScale = t.tuningGlyphStringColumnScale),
        (e.tuningGlyphStringRowPadding = t.tuningGlyphStringRowPadding),
        (e.directionsScale = t.directionsScale),
        e
      );
    }
  };
  var Ki = class {
      constructor() {
        this.topY = 0;
        this.bottomY = 0;
        this.x = 0;
      }
    },
    ei = class ei {
      constructor() {
        this.musicFontSize = 0;
        this.oneStaffSpace = 0;
        this.tabLineSpacing = 0;
        this.arrowShaftThickness = 0;
        this.barlineSeparation = 0;
        this.beamSpacing = 0;
        this.beamThickness = 0;
        this.bracketThickness = 0;
        this.dashedBarlineDashLength = 0;
        this.dashedBarlineGapLength = 0;
        this.dashedBarlineThickness = 0;
        this.hairpinThickness = 0;
        this.legerLineThickness = 0;
        this.legerLineExtension = 0;
        this.octaveLineThickness = 0;
        this.pedalLineThickness = 0;
        this.repeatBarlineDotSeparation = 0;
        this.repeatEndingLineThickness = 0;
        this.slurMidpointThickness = 0;
        this.staffLineThickness = 0;
        this.stemThickness = 0;
        this.thickBarlineThickness = 0;
        this.thinBarlineThickness = 0;
        this.thinThickBarlineSeparation = 0;
        this.tieMidpointThickness = 0;
        this.tupletBracketThickness = 0;
        this.stemUp = new Map();
        this.stemDown = new Map();
        this.repeatOffsetX = new Map();
        this.standardStemLength = 0;
        this.stemFlagOffsets = new Map();
        this.glyphTop = new Map();
        this.glyphBottom = new Map();
        this.glyphWidths = new Map();
        this.glyphHeights = new Map();
        this.numberedBarRendererBarSize = 0;
        this.numberedBarRendererBarSpacing = 0;
        this.numberedDashGlyphPadding = 0;
        this.numberedDashGlyphWidth = 0;
        this.lineRangedGlyphDashGap = 0;
        this.lineRangedGlyphDashSize = 0;
        this.preNoteEffectPadding = 0;
        this.postNoteEffectPadding = 0;
        this.onNoteEffectPadding = 0;
        this.stringNumberCirclePadding = 0;
        this.rowContainerPadding = 0;
        this.rowContainerGap = 0;
        this.alternateEndingsPadding = 0;
        this.sustainPedalLinePadding = 0;
        this.tieHeight = 0;
        this.beatTimerPadding = 0;
        this.bendNoteHeadElementPadding = 0;
        this.ghostParenthesisWidth = 0;
        this.ghostParenthesisPadding = 0;
        this.brokenBeamWidth = 0;
        this.tabWhammyTextPadding = 0;
        this.tabWhammyPerHalfHeight = 0;
        this.tabWhammyDashSize = 0;
        this.songBookWhammyDipHeight = 0;
        this.deadSlappedLineWidth = 0;
        this.leftHandTabTieWidth = 0;
        this.tabBendDashSize = 0;
        this.tabBendPerValueHeight = 0;
        this.tabBendLabelPadding = 0;
        this.simpleSlideWidth = 0;
        this.simpleSlideHeight = 0;
        this.chordDiagramPaddingX = 0;
        this.chordDiagramPaddingY = 0;
        this.chordDiagramStringSpacing = 0;
        this.chordDiagramFretSpacing = 0;
        this.chordDiagramNutHeight = 0;
        this.chordDiagramFretHeight = 0;
        this.chordDiagramLineWidth = 0;
        this.tripletFeelBracketPadding = 0;
        this.accidentalPadding = 0;
        this.preBeatGlyphSpacing = 0;
        this.tempoNoteScale = 0.7;
        this.tuningGlyphCircleNumberScale = 0.7;
        this.tuningGlyphStringColumnScale = 1.5;
        this.tuningGlyphStringRowPadding = 0;
        this.directionsScale = 0.6;
      }
      static get bravuraDefaults() {
        let t = ei._bravuraDefaults;
        return (
          t ||
            ((t = new ei()),
            t.fillFromSmufl(ei.bravuraMetadata),
            (ei._bravuraDefaults = t)),
          Xu.clone(t)
        );
      }
      hasSymbol(t) {
        return this.glyphWidths.get(t) > 0 && this.glyphHeights.get(t) > 0;
      }
      fillFromSmufl(t, e = 36) {
        (this.musicFontSize = e),
          (this.oneStaffSpace = e / 4),
          (this.tabLineSpacing = Math.floor(this.oneStaffSpace * 1.5)),
          (this.arrowShaftThickness =
            t.engravingDefaults.arrowShaftThickness * this.oneStaffSpace),
          (this.barlineSeparation =
            t.engravingDefaults.barlineSeparation * this.oneStaffSpace),
          (this.beamSpacing =
            t.engravingDefaults.beamSpacing * this.oneStaffSpace),
          (this.beamThickness =
            t.engravingDefaults.beamThickness * this.oneStaffSpace),
          (this.bracketThickness =
            t.engravingDefaults.bracketThickness * this.oneStaffSpace),
          (this.dashedBarlineDashLength =
            t.engravingDefaults.dashedBarlineDashLength * this.oneStaffSpace),
          (this.dashedBarlineGapLength =
            t.engravingDefaults.dashedBarlineGapLength * this.oneStaffSpace),
          (this.dashedBarlineThickness =
            t.engravingDefaults.dashedBarlineThickness * this.oneStaffSpace),
          (this.hairpinThickness =
            t.engravingDefaults.hairpinThickness * this.oneStaffSpace),
          (this.legerLineExtension =
            t.engravingDefaults.legerLineExtension * this.oneStaffSpace),
          (this.legerLineThickness =
            t.engravingDefaults.legerLineThickness * this.oneStaffSpace),
          (this.octaveLineThickness =
            t.engravingDefaults.octaveLineThickness * this.oneStaffSpace),
          (this.pedalLineThickness =
            t.engravingDefaults.pedalLineThickness * this.oneStaffSpace),
          (this.repeatBarlineDotSeparation =
            t.engravingDefaults.repeatBarlineDotSeparation *
            this.oneStaffSpace),
          (this.repeatEndingLineThickness =
            t.engravingDefaults.repeatEndingLineThickness * this.oneStaffSpace),
          (this.slurMidpointThickness =
            t.engravingDefaults.slurMidpointThickness * this.oneStaffSpace),
          (this.staffLineThickness =
            t.engravingDefaults.staffLineThickness * this.oneStaffSpace),
          (this.stemThickness =
            t.engravingDefaults.stemThickness * this.oneStaffSpace),
          (this.thickBarlineThickness =
            t.engravingDefaults.thickBarlineThickness * this.oneStaffSpace),
          (this.thinBarlineThickness =
            t.engravingDefaults.thinBarlineThickness * this.oneStaffSpace),
          typeof t.engravingDefaults.thinThickBarlineSeparation == "number"
            ? (this.thinThickBarlineSeparation =
                t.engravingDefaults.thinThickBarlineSeparation *
                this.oneStaffSpace)
            : (this.thinThickBarlineSeparation =
                t.engravingDefaults.barlineSeparation * this.oneStaffSpace),
          (this.tieMidpointThickness =
            t.engravingDefaults.tieMidpointThickness * this.oneStaffSpace),
          (this.tupletBracketThickness =
            t.engravingDefaults.tupletBracketThickness * this.oneStaffSpace);
        let r = 3 * this.oneStaffSpace;
        (this.standardStemLength = r),
          this.stemFlagOffsets.set(-4, 0),
          this.stemFlagOffsets.set(-2, 0),
          this.stemFlagOffsets.set(1, 0),
          this.stemFlagOffsets.set(2, 0),
          this.stemFlagOffsets.set(4, 0),
          this.stemFlagOffsets.set(8, 0),
          this.stemFlagOffsets.set(16, 0),
          this.stemFlagOffsets.set(32, 0),
          this.stemFlagOffsets.set(64, 0),
          this.stemFlagOffsets.set(128, 0),
          this.stemFlagOffsets.set(256, 0);
        for (let [a, o] of Object.entries(t.glyphsWithAnchors)) {
          let l = ei._smuflNameToMusicFontSymbol(a);
          if (l) {
            if (o.stemDownNW) {
              let u = new Ki();
              (u.x = o.stemDownNW[0] * this.oneStaffSpace),
                (u.topY = o.stemDownNW[1] * this.oneStaffSpace),
                o.stemDownSW
                  ? (u.bottomY = o.stemDownSW[1] * this.oneStaffSpace)
                  : (u.bottomY = 0),
                this.stemDown.set(l, u);
            }
            if (o.stemUpSE) {
              let u = new Ki(),
                c = o.stemUpSE[0] * this.oneStaffSpace;
              (u.bottomY = o.stemUpSE[1] * this.oneStaffSpace),
                o.stemUpNW
                  ? ((u.x = o.stemUpNW[0] * this.oneStaffSpace),
                    (u.topY = o.stemUpNW[1] * this.oneStaffSpace))
                  : ((u.x = c - this.stemThickness), (u.topY = 0)),
                this.stemUp.set(l, u);
            }
            if (
              (o.repeatOffset &&
                this.repeatOffsetX.set(
                  l,
                  o.repeatOffset[0] * this.oneStaffSpace
                ),
              o.stemUpNW)
            ) {
              let u = o.stemUpNW[1] * this.oneStaffSpace;
              switch (l) {
                case 57920:
                  this.stemFlagOffsets.set(8, u);
                  break;
                case 57922:
                  this.stemFlagOffsets.set(16, u);
                  break;
                case 57924:
                  this.stemFlagOffsets.set(32, u);
                  break;
                case 57926:
                  this.stemFlagOffsets.set(64, u);
                  break;
                case 57928:
                  this.stemFlagOffsets.set(128, u);
                  break;
                case 57930:
                  this.stemFlagOffsets.set(256, u);
                  break;
              }
            }
          }
        }
        let i = new Set(),
          n = t.glyphBBoxes;
        if (n)
          for (let [a, o] of Object.entries(n)) {
            let l = ei._smuflNameToMusicFontSymbol(a);
            l &&
              (i.add(l),
              this.glyphTop.set(l, o.bBoxNE[1] * this.oneStaffSpace),
              this.glyphBottom.set(l, o.bBoxSW[1] * this.oneStaffSpace),
              this.glyphWidths.set(
                l,
                (o.bBoxNE[0] - o.bBoxSW[0]) * this.oneStaffSpace
              ),
              this.glyphHeights.set(
                l,
                (o.bBoxNE[1] - o.bBoxSW[1]) * this.oneStaffSpace
              ));
          }
        let s = new Set([-1, 32, 57509]);
        for (let a of A.getAllMusicFontSymbols())
          i.has(a) ||
            (s.has(a) ||
              w.warning(
                "SmuFL",
                `The provided SmuFL font is missing the glyph ${K[a]} needed by alphaTab, the music notation might not show all details`
              ),
            this.glyphTop.set(a, 0),
            this.glyphBottom.set(a, 0),
            this.glyphWidths.set(a, 0),
            this.glyphHeights.set(a, 0));
        (this.numberedBarRendererBarSize = this.staffLineThickness * 1),
          (this.numberedBarRendererBarSpacing =
            this.beamSpacing + this.numberedBarRendererBarSize),
          (this.preNoteEffectPadding = 0.4 * this.oneStaffSpace),
          (this.postNoteEffectPadding = 0.2 * this.oneStaffSpace),
          (this.lineRangedGlyphDashGap = 0.5 * this.oneStaffSpace),
          (this.lineRangedGlyphDashSize = 1 * this.oneStaffSpace),
          (this.numberedDashGlyphPadding = 0.3 * this.oneStaffSpace),
          (this.numberedDashGlyphPadding = 0.3 * this.oneStaffSpace),
          (this.stringNumberCirclePadding = 0.3 * this.oneStaffSpace),
          (this.rowContainerPadding = Math.ceil(0.3 * this.oneStaffSpace)),
          (this.rowContainerGap = Math.ceil(1 * this.oneStaffSpace)),
          (this.onNoteEffectPadding = 0.2 * this.oneStaffSpace),
          (this.alternateEndingsPadding = 0.3 * this.oneStaffSpace),
          (this.sustainPedalLinePadding = 0.5 * this.oneStaffSpace),
          (this.tieHeight = 1.2 * this.oneStaffSpace),
          (this.beatTimerPadding = 0.22 * this.oneStaffSpace),
          (this.bendNoteHeadElementPadding = 0.22 * this.oneStaffSpace),
          (this.ghostParenthesisWidth = 0.6 * this.oneStaffSpace),
          (this.ghostParenthesisPadding = 0.3 * this.oneStaffSpace),
          (this.brokenBeamWidth = 1 * this.oneStaffSpace),
          (this.tabWhammyTextPadding = 0.4 * this.oneStaffSpace),
          (this.tabWhammyDashSize = 0.4 * this.oneStaffSpace),
          (this.tabBendDashSize = 0.4 * this.oneStaffSpace),
          (this.songBookWhammyDipHeight = 0.6 * this.oneStaffSpace),
          (this.tabWhammyPerHalfHeight = 0.6 * this.oneStaffSpace),
          (this.tabBendPerValueHeight = 0.6 * this.oneStaffSpace),
          (this.tabBendLabelPadding = 0.3 * this.oneStaffSpace),
          (this.leftHandTabTieWidth = 2.2 * this.oneStaffSpace),
          (this.numberedDashGlyphWidth = 1.5 * this.oneStaffSpace),
          (this.deadSlappedLineWidth = 0.25 * this.oneStaffSpace),
          (this.simpleSlideWidth = 1.3 * this.oneStaffSpace),
          (this.simpleSlideHeight = 0.3 * this.oneStaffSpace),
          (this.chordDiagramPaddingX = Math.ceil(0.5 * this.oneStaffSpace)),
          (this.chordDiagramPaddingY = Math.ceil(0.2 * this.oneStaffSpace)),
          (this.chordDiagramStringSpacing = Math.ceil(
            1.1 * this.oneStaffSpace
          )),
          (this.chordDiagramFretSpacing = Math.ceil(1.3 * this.oneStaffSpace)),
          (this.chordDiagramNutHeight = Math.ceil(0.33 * this.oneStaffSpace)),
          (this.chordDiagramFretHeight = Math.ceil(0.1 * this.oneStaffSpace)),
          (this.chordDiagramLineWidth = Math.ceil(0.11 * this.oneStaffSpace)),
          (this.tripletFeelBracketPadding = 0.2 * this.oneStaffSpace),
          (this.accidentalPadding = 0.1 * this.oneStaffSpace),
          (this.preBeatGlyphSpacing = 0.5 * this.oneStaffSpace),
          (this.tuningGlyphStringRowPadding = 0.2 * this.oneStaffSpace);
      }
      static _smuflNameToMusicFontSymbol(t) {
        let e = ei.smuflNameToGlyphNameMapping.has(t)
          ? ei.smuflNameToGlyphNameMapping.get(t)
          : t.substring(0, 1).toUpperCase() + t.substring(1);
        return _.parseEnumExact(e, K);
      }
    };
  (ei.smuflNameToGlyphNameMapping = new Map([
    ["4stringTabClef", "FourStringTabClef"],
    ["6stringTabClef", "SixStringTabClef"],
  ])),
    (ei.bravuraMetadata = {
      engravingDefaults: {
        arrowShaftThickness: 0.16,
        barlineSeparation: 0.4,
        beamSpacing: 0.25,
        beamThickness: 0.5,
        bracketThickness: 0.5,
        dashedBarlineDashLength: 0.5,
        dashedBarlineGapLength: 0.25,
        dashedBarlineThickness: 0.16,
        hairpinThickness: 0.16,
        legerLineExtension: 0.4,
        legerLineThickness: 0.16,
        lyricLineThickness: 0.16,
        octaveLineThickness: 0.16,
        pedalLineThickness: 0.16,
        repeatBarlineDotSeparation: 0.16,
        repeatEndingLineThickness: 0.16,
        slurEndpointThickness: 0.1,
        slurMidpointThickness: 0.22,
        staffLineThickness: 0.13,
        stemThickness: 0.12,
        subBracketThickness: 0.16,
        textEnclosureThickness: 0.16,
        thickBarlineThickness: 0.5,
        thinBarlineThickness: 0.16,
        tieEndpointThickness: 0.1,
        tieMidpointThickness: 0.22,
        thinThickBarlineSeparation: 0.4,
        tupletBracketThickness: 0.16,
      },
      glyphBBoxes: {
        FourStringTabClef: { bBoxNE: [1.088, 2.016], bBoxSW: [-0.012, -2.032] },
        SixStringTabClef: { bBoxNE: [1.632, 3.056], bBoxSW: [-0.012, -2.992] },
        accidentalDoubleFlat: { bBoxNE: [1.644, 1.748], bBoxSW: [0, -0.7] },
        accidentalDoubleSharp: { bBoxNE: [0.988, 0.508], bBoxSW: [0, -0.5] },
        accidentalFlat: { bBoxNE: [0.904, 1.756], bBoxSW: [0, -0.7] },
        accidentalNatural: { bBoxNE: [0.672, 1.364], bBoxSW: [0, -1.34] },
        accidentalQuarterToneFlatArrowUp: {
          bBoxNE: [0.992, 2.316],
          bBoxSW: [-0.168, -0.708],
        },
        accidentalQuarterToneSharpNaturalArrowUp: {
          bBoxNE: [0.848, 2.188],
          bBoxSW: [-0.104, -1.36],
        },
        accidentalSharp: { bBoxNE: [0.996, 1.4], bBoxSW: [0, -1.392] },
        accidentalThreeQuarterTonesSharpArrowUp: {
          bBoxNE: [1.1, 2.12],
          bBoxSW: [0, -1.388],
        },
        arrowheadBlackDown: { bBoxNE: [0.912, 1.196], bBoxSW: [0, 0] },
        arrowheadBlackUp: { bBoxNE: [0.912, 1.196], bBoxSW: [0, 0] },
        articAccentAbove: { bBoxNE: [1.356, 0.98], bBoxSW: [0, 0.004] },
        articAccentBelow: { bBoxNE: [1.356, 0], bBoxSW: [0, -0.976] },
        articMarcatoAbove: { bBoxNE: [0.94, 1.012], bBoxSW: [-0.004, -0.004] },
        articMarcatoBelow: { bBoxNE: [0.94, 0], bBoxSW: [-0.004, -1.016] },
        articStaccatoAbove: { bBoxNE: [0.336, 0.336], bBoxSW: [0, 0] },
        articStaccatoBelow: { bBoxNE: [0.336, 0], bBoxSW: [0, -0.336] },
        articTenutoAbove: { bBoxNE: [1.352, 0.192], bBoxSW: [-0.004, 0] },
        articTenutoBelow: { bBoxNE: [1.352, 0], bBoxSW: [-0.004, -0.192] },
        augmentationDot: { bBoxNE: [0.4, 0.2], bBoxSW: [0, -0.2] },
        brace: { bBoxNE: [0.328, 3.988], bBoxSW: [0.008, 0] },
        bracketBottom: { bBoxNE: [1.876, 0], bBoxSW: [0, -1.18] },
        bracketTop: { bBoxNE: [1.876, 1.18], bBoxSW: [0, 0] },
        cClef: { bBoxNE: [2.796, 2.024], bBoxSW: [0, -2.024] },
        cClef8vb: { bBoxNE: [2.796, 2.024], bBoxSW: [0, -2.964] },
        clef15: { bBoxNE: [1.436, 1.02], bBoxSW: [0, -0.012] },
        clef8: { bBoxNE: [0.82, 0.988], bBoxSW: [0, 0] },
        coda: { bBoxNE: [3.82, 3.592], bBoxSW: [-0.016, -0.632] },
        dynamicCrescendoHairpin: {
          bBoxNE: [2.944, 1.424],
          bBoxSW: [0.016, 0.372],
        },
        dynamicFF: { bBoxNE: [2.44, 1.776], bBoxSW: [-0.54, -0.608] },
        dynamicFFF: { bBoxNE: [3.32, 1.776], bBoxSW: [-0.62, -0.608] },
        dynamicFFFF: { bBoxNE: [4.28, 1.776], bBoxSW: [-0.62, -0.608] },
        dynamicFFFFF: { bBoxNE: [5.24, 1.776], bBoxSW: [-0.62, -0.608] },
        dynamicFFFFFF: { bBoxNE: [6.2, 1.776], bBoxSW: [-0.62, -0.608] },
        dynamicForte: { bBoxNE: [1.456, 1.776], bBoxSW: [-0.564, -0.608] },
        dynamicFortePiano: { bBoxNE: [2.476, 1.776], bBoxSW: [-0.564, -0.608] },
        dynamicForzando: { bBoxNE: [1.988, 1.776], bBoxSW: [-0.564, -0.608] },
        dynamicMF: { bBoxNE: [3.272, 1.724], bBoxSW: [-0.08, -0.66] },
        dynamicMP: { bBoxNE: [3.3, 1.096], bBoxSW: [-0.08, -0.568] },
        dynamicNiente: { bBoxNE: [1.232, 1.096], bBoxSW: [-0.092, -0.04] },
        dynamicPF: { bBoxNE: [3.08, 1.776], bBoxSW: [-0.288, -0.608] },
        dynamicPP: { bBoxNE: [2.912, 1.096], bBoxSW: [-0.328, -0.568] },
        dynamicPPP: { bBoxNE: [4.292, 1.096], bBoxSW: [-0.368, -0.568] },
        dynamicPPPP: { bBoxNE: [5.672, 1.096], bBoxSW: [-0.408, -0.568] },
        dynamicPPPPP: { bBoxNE: [7.092, 1.096], bBoxSW: [-0.408, -0.568] },
        dynamicPPPPPP: { bBoxNE: [8.512, 1.096], bBoxSW: [-0.408, -0.568] },
        dynamicPiano: { bBoxNE: [1.464, 1.096], bBoxSW: [-0.356, -0.568] },
        dynamicRinforzando1: { bBoxNE: [2.5, 1.776], bBoxSW: [-0.08, -0.608] },
        dynamicRinforzando2: {
          bBoxNE: [2.976, 1.776],
          bBoxSW: [-0.08, -0.608],
        },
        dynamicSforzando1: { bBoxNE: [2.416, 1.776], bBoxSW: [0, -0.608] },
        dynamicSforzandoPianissimo: {
          bBoxNE: [4.796, 1.776],
          bBoxSW: [0, -0.608],
        },
        dynamicSforzandoPiano: { bBoxNE: [3.38, 1.776], bBoxSW: [0, -0.608] },
        dynamicSforzato: { bBoxNE: [2.932, 1.776], bBoxSW: [0, -0.608] },
        dynamicSforzatoFF: { bBoxNE: [3.856, 1.776], bBoxSW: [0, -0.608] },
        dynamicSforzatoPiano: { bBoxNE: [4.304, 1.776], bBoxSW: [0, -0.608] },
        fClef: { bBoxNE: [2.736, 1.048], bBoxSW: [-0.02, -2.54] },
        fClef15ma: { bBoxNE: [2.736, 1.984], bBoxSW: [-0.02, -2.54] },
        fClef15mb: { bBoxNE: [2.736, 1.048], bBoxSW: [-0.02, -2.968] },
        fClef8va: { bBoxNE: [2.736, 1.98], bBoxSW: [-0.02, -2.54] },
        fClef8vb: { bBoxNE: [2.736, 1.048], bBoxSW: [-0.02, -2.976] },
        fermataAbove: { bBoxNE: [2.42, 1.316], bBoxSW: [0.012, -0.012] },
        fermataLongAbove: { bBoxNE: [2.412, 1.332], bBoxSW: [0, -0.004] },
        fermataShortAbove: { bBoxNE: [2.416, 1.364], bBoxSW: [0, 0] },
        fingering0: { bBoxNE: [0.94, 1.004], bBoxSW: [0.08, -0.004] },
        fingering1: { bBoxNE: [0.548, 1.016], bBoxSW: [0.08, 0] },
        fingering2: { bBoxNE: [0.888, 1.012], bBoxSW: [0.08, -0.012] },
        fingering3: { bBoxNE: [0.82, 1.008], bBoxSW: [0.08, 0] },
        fingering4: { bBoxNE: [0.864, 1.012], bBoxSW: [0.08, 0.004] },
        fingering5: { bBoxNE: [0.82, 1.032], bBoxSW: [0.08, 0] },
        fingeringALower: { bBoxNE: [1.068, 1.032], bBoxSW: [0, -0.02] },
        fingeringCLower: { bBoxNE: [0.888, 1.044], bBoxSW: [0, -0.028] },
        fingeringILower: { bBoxNE: [0.656, 1.54], bBoxSW: [-0.052, -0.028] },
        fingeringMLower: { bBoxNE: [1.66, 1.028], bBoxSW: [-0.032, -0.016] },
        fingeringPLower: { bBoxNE: [1.088, 1.028], bBoxSW: [-0.216, -0.612] },
        fingeringTLower: { bBoxNE: [0.604, 1.484], bBoxSW: [0, -0.028] },
        flag128thDown: { bBoxNE: [1.092, 3.248], bBoxSW: [0, -2.32] },
        flag128thUp: { bBoxNE: [1.044, 2.132], bBoxSW: [0, -3.248] },
        flag16thDown: {
          bBoxNE: [1.1635806326044895, 3.2480256],
          bBoxSW: [0, -0.036],
        },
        flag16thUp: { bBoxNE: [1.116, 0.008], bBoxSW: [0, -3.252] },
        flag256thDown: { bBoxNE: [1.196, 3.252], bBoxSW: [0, -3.004] },
        flag256thUp: { bBoxNE: [1.056, 2.816], bBoxSW: [0, -3.248] },
        flag32ndDown: { bBoxNE: [1.092, 3.248], bBoxSW: [0, -0.688] },
        flag32ndUp: { bBoxNE: [1.044, 0.596], bBoxSW: [0, -3.248] },
        flag64thDown: { bBoxNE: [1.092, 3.248], bBoxSW: [0, -1.504] },
        flag64thUp: { bBoxNE: [1.044, 1.388], bBoxSW: [0, -3.248] },
        flag8thDown: {
          bBoxNE: [1.224, 3.232896633157715],
          bBoxSW: [0, -0.056],
        },
        flag8thUp: { bBoxNE: [1.056, 0.036], bBoxSW: [0, -3.240768470618394] },
        fretboardFilledCircle: { bBoxNE: [0.564, 0.564], bBoxSW: [0, 0] },
        fretboardO: { bBoxNE: [0.564, 0.564], bBoxSW: [0, 0] },
        fretboardX: { bBoxNE: [0.596, 0.596], bBoxSW: [0, 0] },
        gClef: { bBoxNE: [2.684, 4.392], bBoxSW: [0, -2.632] },
        gClef15ma: { bBoxNE: [2.684, 5.276], bBoxSW: [0, -2.632] },
        gClef15mb: { bBoxNE: [2.684, 4.392], bBoxSW: [0, -3.524] },
        gClef8va: { bBoxNE: [2.684, 5.28], bBoxSW: [0, -2.632] },
        gClef8vb: { bBoxNE: [2.684, 4.392], bBoxSW: [0, -3.512] },
        graceNoteSlashStemDown: { bBoxNE: [2.02, 0], bBoxSW: [0, -1.604] },
        graceNoteSlashStemUp: { bBoxNE: [2.02, 1.604], bBoxSW: [0, 0] },
        guitarClosePedal: { bBoxNE: [1.144, 1.14], bBoxSW: [0, -0.004] },
        guitarFadeIn: { bBoxNE: [1.448, 1.46], bBoxSW: [0, 0] },
        guitarFadeOut: { bBoxNE: [1.448, 1.46], bBoxSW: [0, 0] },
        guitarGolpe: { bBoxNE: [1.08, 1.128], bBoxSW: [0.004, 0] },
        guitarLeftHandTapping: { bBoxNE: [1.588, 1.364], bBoxSW: [0, -0.224] },
        guitarOpenPedal: { bBoxNE: [1.144, 1.144], bBoxSW: [0, 0] },
        guitarString0: { bBoxNE: [2.164, 2.156], bBoxSW: [0.004, 0] },
        guitarString1: { bBoxNE: [2.16, 2.156], bBoxSW: [0, 0] },
        guitarString2: { bBoxNE: [2.16, 2.156], bBoxSW: [0, 0] },
        guitarString3: { bBoxNE: [2.16, 2.156], bBoxSW: [0, 0] },
        guitarString4: { bBoxNE: [2.164, 2.156], bBoxSW: [0.004, 0] },
        guitarString5: { bBoxNE: [2.16, 2.156], bBoxSW: [0, 0] },
        guitarString6: { bBoxNE: [2.16, 2.156], bBoxSW: [0, 0] },
        guitarString7: { bBoxNE: [2.16, 2.156], bBoxSW: [0, 0] },
        guitarString8: { bBoxNE: [2.16, 2.156], bBoxSW: [0, 0] },
        guitarString9: { bBoxNE: [2.16, 2.156], bBoxSW: [0, 0] },
        guitarVibratoStroke: { bBoxNE: [0.668, 0.476], bBoxSW: [-0.056, 0] },
        guitarVolumeSwell: { bBoxNE: [2.896, 1.46], bBoxSW: [0, 0] },
        guitarWideVibratoStroke: {
          bBoxNE: [0.908, 0.896],
          bBoxSW: [-0.096, 0],
        },
        keyboardPedalPed: { bBoxNE: [4.076, 2.22], bBoxSW: [0, -0.032] },
        keyboardPedalUp: { bBoxNE: [1.8, 1.8], bBoxSW: [0, 0] },
        metAugmentationDot: { bBoxNE: [0.4, 0.2], bBoxSW: [0, -0.2] },
        metNote8thUp: { bBoxNE: [2.132, 2.784], bBoxSW: [0, -0.564] },
        metNoteQuarterUp: { bBoxNE: [1.328, 2.752], bBoxSW: [0, -0.564] },
        note8thUp: { bBoxNE: [2.264, 3.492], bBoxSW: [0, -0.552] },
        noteQuarterUp: { bBoxNE: [1.328, 3.5], bBoxSW: [0, -0.564] },
        noteShapeDiamondBlack: { bBoxNE: [1.444, 0.548], bBoxSW: [0, -0.552] },
        noteShapeDiamondWhite: { bBoxNE: [1.444, 0.544], bBoxSW: [0, -0.556] },
        noteShapeMoonBlack: { bBoxNE: [1.444, 0.5], bBoxSW: [0, -0.5] },
        noteShapeMoonWhite: { bBoxNE: [1.444, 0.5], bBoxSW: [0, -0.5] },
        noteShapeRoundBlack: { bBoxNE: [1.456, 0.552], bBoxSW: [0, -0.552] },
        noteShapeRoundWhite: { bBoxNE: [1.464, 0.548], bBoxSW: [0, -0.548] },
        noteShapeSquareBlack: { bBoxNE: [1.44, 0.46], bBoxSW: [0, -0.46] },
        noteShapeSquareWhite: { bBoxNE: [1.44, 0.46], bBoxSW: [0, -0.46] },
        noteShapeTriangleLeftBlack: { bBoxNE: [1.44, 0.5], bBoxSW: [0, -0.5] },
        noteShapeTriangleLeftWhite: { bBoxNE: [1.44, 0.5], bBoxSW: [0, -0.5] },
        noteShapeTriangleRightBlack: { bBoxNE: [1.44, 0.5], bBoxSW: [0, -0.5] },
        noteShapeTriangleRightWhite: { bBoxNE: [1.44, 0.5], bBoxSW: [0, -0.5] },
        noteShapeTriangleRoundBlack: {
          bBoxNE: [1.424, 0.5],
          bBoxSW: [0, -0.5],
        },
        noteShapeTriangleRoundWhite: {
          bBoxNE: [1.424, 0.5],
          bBoxSW: [0, -0.5],
        },
        noteShapeTriangleUpBlack: { bBoxNE: [1.424, 0.5], bBoxSW: [0, -0.5] },
        noteShapeTriangleUpWhite: { bBoxNE: [1.424, 0.5], bBoxSW: [0, -0.5] },
        noteheadBlack: { bBoxNE: [1.18, 0.5], bBoxSW: [0, -0.5] },
        noteheadCircleSlash: { bBoxNE: [1, 0.5], bBoxSW: [0, -0.5] },
        noteheadCircleX: { bBoxNE: [0.996, 0.5], bBoxSW: [0, -0.5] },
        noteheadCircleXDoubleWhole: {
          bBoxNE: [1.688, 0.62],
          bBoxSW: [0, -0.62],
        },
        noteheadCircleXHalf: { bBoxNE: [1, 0.5], bBoxSW: [0, -0.5] },
        noteheadCircleXWhole: { bBoxNE: [0.996, 0.5], bBoxSW: [0, -0.5] },
        noteheadCircledBlack: {
          bBoxNE: [1.284, 0.668],
          bBoxSW: [-0.084, -0.684],
        },
        noteheadCircledDoubleWhole: {
          bBoxNE: [2.412, 0.852],
          bBoxSW: [0, -0.872],
        },
        noteheadCircledHalf: {
          bBoxNE: [1.244, 0.668],
          bBoxSW: [-0.072, -0.648],
        },
        noteheadCircledWhole: { bBoxNE: [1.748, 0.844], bBoxSW: [0, -0.9] },
        noteheadClusterDoubleWhole3rd: {
          bBoxNE: [2.428, 1.62],
          bBoxSW: [0, -0.62],
        },
        noteheadClusterHalf3rd: { bBoxNE: [1.264, 1.5], bBoxSW: [0, -0.5] },
        noteheadClusterQuarter3rd: { bBoxNE: [1.44, 1.5], bBoxSW: [0, -0.5] },
        noteheadClusterWhole3rd: { bBoxNE: [1.7, 1.5], bBoxSW: [0, -0.5] },
        noteheadDiamondBlack: { bBoxNE: [1, 0.5], bBoxSW: [0, -0.5] },
        noteheadDiamondBlackWide: { bBoxNE: [1.4, 0.5], bBoxSW: [0, -0.5] },
        noteheadDiamondDoubleWhole: {
          bBoxNE: [1.728, 0.62],
          bBoxSW: [0, -0.62],
        },
        noteheadDiamondHalf: { bBoxNE: [1.004, 0.5], bBoxSW: [0, -0.5] },
        noteheadDiamondWhite: { bBoxNE: [1, 0.5], bBoxSW: [0, -0.5] },
        noteheadDiamondWhiteWide: { bBoxNE: [1.4, 0.5], bBoxSW: [0, -0.5] },
        noteheadDiamondWhole: { bBoxNE: [1.08, 0.5], bBoxSW: [0, -0.5] },
        noteheadDoubleWhole: { bBoxNE: [2.396, 0.62], bBoxSW: [0, -0.62] },
        noteheadDoubleWholeSquare: {
          bBoxNE: [1.664, 0.792],
          bBoxSW: [0, -0.76],
        },
        noteheadHalf: { bBoxNE: [1.18, 0.5], bBoxSW: [0, -0.5] },
        noteheadHeavyX: { bBoxNE: [1.54, 0.5], bBoxSW: [0, -0.5] },
        noteheadHeavyXHat: { bBoxNE: [1.828, 1.04], bBoxSW: [-0.292, -0.5] },
        noteheadParenthesis: {
          bBoxNE: [1.472, 0.728],
          bBoxSW: [-0.292, -0.72],
        },
        noteheadPlusBlack: { bBoxNE: [0.996, 0.5], bBoxSW: [-0.004, -0.5] },
        noteheadPlusDoubleWhole: { bBoxNE: [1.892, 0.62], bBoxSW: [0, -0.62] },
        noteheadPlusHalf: { bBoxNE: [1.044, 0.5], bBoxSW: [0, -0.5] },
        noteheadPlusWhole: { bBoxNE: [1.14, 0.5], bBoxSW: [0, -0.5] },
        noteheadRoundWhiteWithDot: { bBoxNE: [1.004, 0.5], bBoxSW: [0, -0.5] },
        noteheadSlashHorizontalEnds: { bBoxNE: [2.12, 1], bBoxSW: [0, -1] },
        noteheadSlashWhiteHalf: { bBoxNE: [3.12, 1], bBoxSW: [0, -1] },
        noteheadSlashWhiteWhole: { bBoxNE: [3.92, 1], bBoxSW: [0, -1] },
        noteheadSlashedBlack1: { bBoxNE: [1.5, 0.668], bBoxSW: [-0.32, -0.66] },
        noteheadSlashedBlack2: {
          bBoxNE: [1.504, 0.672],
          bBoxSW: [-0.316, -0.656],
        },
        noteheadSlashedDoubleWhole1: {
          bBoxNE: [2.384, 0.672],
          bBoxSW: [0, -0.716],
        },
        noteheadSlashedDoubleWhole2: {
          bBoxNE: [2.384, 0.676],
          bBoxSW: [0, -0.712],
        },
        noteheadSlashedHalf1: {
          bBoxNE: [1.544, 0.64],
          bBoxSW: [-0.268, -0.568],
        },
        noteheadSlashedHalf2: {
          bBoxNE: [1.52, 0.672],
          bBoxSW: [-0.292, -0.536],
        },
        noteheadSlashedWhole1: {
          bBoxNE: [1.732, 0.592],
          bBoxSW: [-0.088, -0.628],
        },
        noteheadSlashedWhole2: {
          bBoxNE: [1.744, 0.604],
          bBoxSW: [-0.072, -0.616],
        },
        noteheadSquareBlack: { bBoxNE: [1.252, 0.5], bBoxSW: [0, -0.5] },
        noteheadSquareBlackLarge: { bBoxNE: [2, 1], bBoxSW: [0, -1] },
        noteheadSquareBlackWhite: { bBoxNE: [2, 1], bBoxSW: [0, -1] },
        noteheadSquareWhite: { bBoxNE: [1.252, 0.5], bBoxSW: [0, -0.5] },
        noteheadTriangleDownBlack: { bBoxNE: [1.168, 0.5], bBoxSW: [0, -0.5] },
        noteheadTriangleDownDoubleWhole: {
          bBoxNE: [1.932, 0.62],
          bBoxSW: [0, -0.62],
        },
        noteheadTriangleDownHalf: { bBoxNE: [1.14, 0.5], bBoxSW: [0, -0.5] },
        noteheadTriangleDownWhole: { bBoxNE: [1.276, 0.5], bBoxSW: [0, -0.5] },
        noteheadTriangleRightBlack: { bBoxNE: [1.356, 0.5], bBoxSW: [0, -0.5] },
        noteheadTriangleRightWhite: { bBoxNE: [1.356, 0.5], bBoxSW: [0, -0.5] },
        noteheadTriangleUpBlack: { bBoxNE: [1.172, 0.5], bBoxSW: [0, -0.5] },
        noteheadTriangleUpDoubleWhole: {
          bBoxNE: [1.932, 0.62],
          bBoxSW: [0, -0.62],
        },
        noteheadTriangleUpHalf: { bBoxNE: [1.14, 0.5], bBoxSW: [0, -0.5] },
        noteheadTriangleUpWhole: { bBoxNE: [1.276, 0.5], bBoxSW: [0, -0.5] },
        noteheadWhole: { bBoxNE: [1.688, 0.5], bBoxSW: [0, -0.5] },
        noteheadXBlack: { bBoxNE: [1.16, 0.5], bBoxSW: [0, -0.5] },
        noteheadXDoubleWhole: { bBoxNE: [2.184, 0.62], bBoxSW: [0, -0.62] },
        noteheadXHalf: { bBoxNE: [1.336, 0.5], bBoxSW: [0, -0.5] },
        noteheadXOrnate: { bBoxNE: [0.988, 0.504], bBoxSW: [0, -0.504] },
        noteheadXWhole: { bBoxNE: [1.508, 0.5], bBoxSW: [0, -0.5] },
        octaveBaselineB: { bBoxNE: [0.796, 1.352], bBoxSW: [0, -0.04] },
        octaveBaselineM: { bBoxNE: [1.524, 0.928], bBoxSW: [0, -0.02] },
        ornamentMordent: { bBoxNE: [2.916, 1.276], bBoxSW: [0.004, -0.292] },
        ornamentShortTrill: { bBoxNE: [2.9, 0.98], bBoxSW: [0, 0] },
        ornamentTrill: { bBoxNE: [2.084, 1.56], bBoxSW: [0, -0.04] },
        ornamentTurn: { bBoxNE: [1.84, 0.872], bBoxSW: [0, 0] },
        ornamentTurnInverted: { bBoxNE: [1.828, 0.872], bBoxSW: [-0.012, 0] },
        ottava: { bBoxNE: [1.544, 1.852], bBoxSW: [0, -0.04] },
        ottavaAlta: { bBoxNE: [3.54, 1.852], bBoxSW: [0, -0.04] },
        ottavaBassaVb: { bBoxNE: [3.184, 1.852], bBoxSW: [0, -0.04] },
        pictEdgeOfCymbal: { bBoxNE: [4.828, 2.14], bBoxSW: [0.004, 0] },
        quindicesima: { bBoxNE: [2.668, 1.844], bBoxSW: [0, -0.04] },
        quindicesimaAlta: { bBoxNE: [5.26, 1.844], bBoxSW: [0, -0.04] },
        repeat1Bar: { bBoxNE: [2.128, 1.116], bBoxSW: [0, -1] },
        repeat2Bars: { bBoxNE: [3.048, 1.116], bBoxSW: [0, -1] },
        repeatDot: { bBoxNE: [0.4, 0.2], bBoxSW: [0, -0.2] },
        rest128th: { bBoxNE: [1.94, 2.756], bBoxSW: [0, -3] },
        rest16th: { bBoxNE: [1.28, 0.716], bBoxSW: [0, -2] },
        rest256th: { bBoxNE: [2.164, 2.784], bBoxSW: [0, -4] },
        rest32nd: { bBoxNE: [1.452, 1.704], bBoxSW: [0, -2] },
        rest64th: { bBoxNE: [1.692, 1.72], bBoxSW: [0, -3.012] },
        rest8th: { bBoxNE: [0.988, 0.696], bBoxSW: [0, -1.004] },
        restDoubleWhole: { bBoxNE: [0.5, 1], bBoxSW: [0, 0] },
        restHBarLeft: { bBoxNE: [1.5, 1.048], bBoxSW: [0, -1.08] },
        restHBarMiddle: { bBoxNE: [1.42, 0.384], bBoxSW: [-0.108, -0.416] },
        restHBarRight: { bBoxNE: [1.5, 1.048], bBoxSW: [0, -1.08] },
        restHalf: { bBoxNE: [1.128, 0.568], bBoxSW: [0, -0.008] },
        restLonga: { bBoxNE: [0.5, 1], bBoxSW: [0, -0.996] },
        restQuarter: { bBoxNE: [1.08, 1.492], bBoxSW: [0.004, -1.5] },
        restWhole: { bBoxNE: [1.128, 0.036], bBoxSW: [0, -0.54] },
        segno: { bBoxNE: [2.2, 3.036], bBoxSW: [0.016, -0.108] },
        stringsDownBow: { bBoxNE: [1.248, 1.272], bBoxSW: [0, 0] },
        stringsUpBow: { bBoxNE: [0.996, 1.98], bBoxSW: [0.004, 0.004] },
        systemDivider: { bBoxNE: [4.232, 4.24], bBoxSW: [0, -0.272] },
        textAugmentationDot: { bBoxNE: [0.4, 0.256], bBoxSW: [0, -0.144] },
        textBlackNoteFrac16thLongStem: {
          bBoxNE: [1.368, 3.512],
          bBoxSW: [0, -0.56],
        },
        textBlackNoteFrac32ndLongStem: {
          bBoxNE: [1.368, 3.512],
          bBoxSW: [0, -0.56],
        },
        textBlackNoteFrac8thLongStem: {
          bBoxNE: [1.368, 3.512],
          bBoxSW: [0, -0.56],
        },
        textBlackNoteLongStem: { bBoxNE: [1.328, 3.512], bBoxSW: [0, -0.564] },
        textCont16thBeamLongStem: {
          bBoxNE: [1.368, 3.512],
          bBoxSW: [0, 2.264],
        },
        textCont32ndBeamLongStem: {
          bBoxNE: [1.368, 3.512],
          bBoxSW: [0, 1.504],
        },
        textCont8thBeamLongStem: { bBoxNE: [1.368, 3.512], bBoxSW: [0, 3.012] },
        textTuplet3LongStem: { bBoxNE: [0.94, 5.3], bBoxSW: [0, 4.2] },
        textTupletBracketEndLongStem: {
          bBoxNE: [1.272, 4.764],
          bBoxSW: [0, 3.94],
        },
        textTupletBracketStartLongStem: {
          bBoxNE: [1.272, 4.764],
          bBoxSW: [0, 3.94],
        },
        timeSig0: { bBoxNE: [1.8, 1.004], bBoxSW: [0.08, -1] },
        timeSig1: { bBoxNE: [1.256, 1.004], bBoxSW: [0.08, -1] },
        timeSig2: { bBoxNE: [1.704, 1.016], bBoxSW: [0.08, -1.028] },
        timeSig3: { bBoxNE: [1.604, 0.996], bBoxSW: [0.08, -1.004] },
        timeSig4: { bBoxNE: [1.8, 1.004], bBoxSW: [0.08, -1] },
        timeSig5: { bBoxNE: [1.532, 0.984], bBoxSW: [0.08, -1.004] },
        timeSig6: { bBoxNE: [1.656, 1.004], bBoxSW: [0.08, -0.996] },
        timeSig7: { bBoxNE: [1.684, 0.996], bBoxSW: [0.08, -1] },
        timeSig8: { bBoxNE: [1.664, 1.036], bBoxSW: [0.08, -1.036] },
        timeSig9: { bBoxNE: [1.656, 1.004], bBoxSW: [0.08, -0.996] },
        timeSigCommon: { bBoxNE: [1.696, 1.004], bBoxSW: [0.02, -0.996] },
        timeSigCutCommon: { bBoxNE: [1.672, 1.444], bBoxSW: [0, -1.436] },
        tremolo1: { bBoxNE: [0.6, 0.376], bBoxSW: [-0.6, -0.372] },
        tremolo2: { bBoxNE: [0.596, 0.748], bBoxSW: [-0.604, -0.748] },
        tremolo3: { bBoxNE: [0.6, 1.112], bBoxSW: [-0.6, -1.12] },
        tuplet0: {
          bBoxNE: [1.2731041262817027, 1.5],
          bBoxSW: [-0.001204330173715796, -0.032],
        },
        tuplet1: { bBoxNE: [1.024, 1.488], bBoxSW: [0.04, 0] },
        tuplet2: { bBoxNE: [1.316, 1.5], bBoxSW: [0.04, -0.024] },
        tuplet3: { bBoxNE: [1.224, 1.5], bBoxSW: [0.04, -0.032] },
        tuplet4: { bBoxNE: [1.252, 1.488], bBoxSW: [0.04, 0] },
        tuplet5: { bBoxNE: [1.308, 1.492], bBoxSW: [0.04, -0.032] },
        tuplet6: {
          bBoxNE: [1.256, 1.5],
          bBoxSW: [0.04105974105482295, -0.032],
        },
        tuplet7: { bBoxNE: [1.332, 1.488], bBoxSW: [0.12, -0.016] },
        tuplet8: { bBoxNE: [1.292, 1.5], bBoxSW: [0.04, -0.032] },
        tuplet9: { bBoxNE: [1.254940258945177, 1.5], bBoxSW: [0.04, -0.032] },
        tupletColon: { bBoxNE: [0.484, 1.072], bBoxSW: [0.04, 0.232] },
        unpitchedPercussionClef1: { bBoxNE: [1.528, 1], bBoxSW: [0, -1] },
        wiggleSawtooth: { bBoxNE: [3.06, 1.06], bBoxSW: [-0.068, -1.068] },
        wiggleSawtoothNarrow: {
          bBoxNE: [2.06, 1.064],
          bBoxSW: [-0.072, -1.064],
        },
        wiggleTrill: { bBoxNE: [1.08, 0.836], bBoxSW: [-0.144, 0.392] },
        wiggleVibratoMediumFast: {
          bBoxNE: [1.292, 0.8],
          bBoxSW: [-0.104, -0.164],
        },
      },
      glyphsWithAnchors: {
        accidentalDoubleFlat: {
          cutOutNE: [0.988, 0.644],
          cutOutSE: [1.336, -0.396],
        },
        accidentalFlat: { cutOutNE: [0.252, 0.656], cutOutSE: [0.504, -0.476] },
        accidentalNatural: {
          cutOutNE: [0.192, 0.776],
          cutOutSW: [0.476, -0.828],
        },
        accidentalQuarterToneFlatArrowUp: {
          cutOutNE: [0.604, 0.664],
          cutOutSE: [0.62, -0.452],
        },
        accidentalQuarterToneSharpNaturalArrowUp: { cutOutSW: [0.616, -0.868] },
        accidentalSharp: {
          cutOutNE: [0.84, 0.896],
          cutOutNW: [0.144, 0.568],
          cutOutSE: [0.84, -0.596],
          cutOutSW: [0.144, -0.896],
        },
        accidentalThreeQuarterTonesSharpArrowUp: {
          cutOutNW: [0.272, 1.304],
          cutOutSE: [0.86, -0.584],
          cutOutSW: [0.132, -0.888],
        },
        dynamicFF: { opticalCenter: [1.852, 0] },
        dynamicFFF: { opticalCenter: [2.472, 0] },
        dynamicFFFF: { opticalCenter: [2.824, 0] },
        dynamicFFFFF: { opticalCenter: [2.976, 0] },
        dynamicFFFFFF: { opticalCenter: [3.504, 0] },
        dynamicForte: { opticalCenter: [1.256, 0] },
        dynamicFortePiano: { opticalCenter: [1.5, 0] },
        dynamicForzando: { opticalCenter: [1.352, 0] },
        dynamicMF: { opticalCenter: [1.796, 0] },
        dynamicMP: { opticalCenter: [1.848, 0] },
        dynamicNiente: { opticalCenter: [0.616, 0] },
        dynamicPF: { opticalCenter: [1.68, 0] },
        dynamicPP: { opticalCenter: [1.708, 0] },
        dynamicPPP: { opticalCenter: [2.368, 0] },
        dynamicPPPP: { opticalCenter: [3.004, 0] },
        dynamicPPPPP: { opticalCenter: [3.552, 0] },
        dynamicPPPPPP: { opticalCenter: [4.248, 0] },
        dynamicPiano: { opticalCenter: [1.22, 0] },
        dynamicRinforzando1: { opticalCenter: [1.564, 0] },
        dynamicRinforzando2: { opticalCenter: [2.084, 0] },
        dynamicSforzando1: { opticalCenter: [1.3, 0] },
        dynamicSforzandoPianissimo: { opticalCenter: [1.972, 0] },
        dynamicSforzandoPiano: { opticalCenter: [1.904, 0] },
        dynamicSforzato: { opticalCenter: [1.76, 0] },
        dynamicSforzatoFF: { opticalCenter: [2.276, 0] },
        dynamicSforzatoPiano: { opticalCenter: [1.848, 0] },
        flag128thDown: { stemDownSW: [0, -2.076] },
        flag128thUp: { stemUpNW: [0, 1.9] },
        flag16thDown: { stemDownSW: [0, 0.128] },
        flag16thUp: { stemUpNW: [0, -0.088] },
        flag256thDown: { stemDownSW: [0, -2.812] },
        flag256thUp: { stemUpNW: [0, 2.592] },
        flag32ndDown: { stemDownSW: [0, -0.448] },
        flag32ndUp: { stemUpNW: [0, 0.376] },
        flag64thDown: { stemDownSW: [0, -1.244] },
        flag64thUp: { stemUpNW: [0, 1.172] },
        flag8thDown: {
          graceNoteSlashNW: [-0.596, 2.168],
          graceNoteSlashSE: [1.328, 0.628],
          stemDownSW: [0, 0.132],
        },
        flag8thUp: {
          graceNoteSlashNE: [1.284, -0.796],
          graceNoteSlashSW: [-0.644, -2.456],
          stemUpNW: [0, -0.04],
        },
        guitarVibratoStroke: { repeatOffset: [0.608, 0] },
        guitarWideVibratoStroke: { repeatOffset: [0.82, 0] },
        noteShapeDiamondBlack: { stemDownNW: [0, 0], stemUpSE: [1.444, 0] },
        noteShapeDiamondWhite: { stemDownNW: [0, 0], stemUpSE: [1.436, 0] },
        noteShapeMoonBlack: { stemDownNW: [0, 0.068], stemUpSE: [1.44, 0.068] },
        noteShapeMoonWhite: {
          stemDownNW: [0, 0.072],
          stemUpSE: [1.444, 0.068],
        },
        noteShapeRoundBlack: {
          stemDownNW: [0, -0.168],
          stemUpSE: [1.444, 0.184],
        },
        noteShapeRoundWhite: {
          stemDownNW: [0, -0.168],
          stemUpSE: [1.456, 0.192],
        },
        noteShapeSquareBlack: {
          stemDownNW: [0, 0.46],
          stemUpSE: [1.44, -0.46],
        },
        noteShapeSquareWhite: {
          stemDownNW: [0, 0.46],
          stemUpSE: [1.44, -0.46],
        },
        noteShapeTriangleLeftBlack: {
          stemDownNW: [0, 0.5],
          stemUpSE: [1.436, -0.5],
        },
        noteShapeTriangleLeftWhite: {
          stemDownNW: [0, 0.5],
          stemUpSE: [1.436, -0.5],
        },
        noteShapeTriangleRightBlack: {
          stemDownNW: [0, 0.476],
          stemUpSE: [1.44, -0.5],
        },
        noteShapeTriangleRightWhite: {
          stemDownNW: [0, 0.476],
          stemUpSE: [1.44, -0.5],
        },
        noteShapeTriangleRoundBlack: {
          stemDownNW: [0, 0.172],
          stemUpSE: [1.424, 0.172],
        },
        noteShapeTriangleRoundWhite: {
          stemDownNW: [0, 0.172],
          stemUpSE: [1.424, 0.172],
        },
        noteShapeTriangleUpBlack: {
          stemDownNW: [0, -0.5],
          stemUpSE: [1.424, -0.5],
        },
        noteShapeTriangleUpWhite: {
          stemDownNW: [0, -0.5],
          stemUpSE: [1.424, -0.5],
        },
        noteheadBlack: {
          cutOutNW: [0.208, 0.3],
          cutOutSE: [0.94, -0.296],
          splitStemDownNE: [0.968, -0.248],
          splitStemDownNW: [0.12, -0.416],
          splitStemUpSE: [1.092, 0.392],
          splitStemUpSW: [0.312, 0.356],
          stemDownNW: [0, -0.168],
          stemUpSE: [1.18, 0.168],
        },
        noteheadCircleSlash: { stemDownNW: [0.004, 0], stemUpSE: [1, 0] },
        noteheadCircleX: { stemDownNW: [0, 0], stemUpSE: [0.996, 0] },
        noteheadCircleXDoubleWhole: { noteheadOrigin: [0.352, 0] },
        noteheadCircleXHalf: { stemDownNW: [0, 0], stemUpSE: [1, 0] },
        noteheadCircledBlack: {
          stemDownNW: [0, -0.164],
          stemUpSE: [1.18, 0.168],
        },
        noteheadCircledDoubleWhole: { noteheadOrigin: [0.356, 0] },
        noteheadCircledHalf: {
          stemDownNW: [0, -0.144],
          stemUpSE: [1.172, 0.156],
        },
        noteheadClusterDoubleWhole3rd: { noteheadOrigin: [0.364, 0] },
        noteheadClusterHalf3rd: {
          stemDownNW: [0, -0.164],
          stemUpSE: [1.264, 1.144],
        },
        noteheadClusterQuarter3rd: {
          stemDownNW: [0, 0.26],
          stemUpSE: [1.44, 0.744],
        },
        noteheadDiamondBlack: { stemDownNW: [0, 0], stemUpSE: [1, 0] },
        noteheadDiamondBlackWide: { stemDownNW: [0, 0], stemUpSE: [1.4, 0] },
        noteheadDiamondDoubleWhole: { noteheadOrigin: [0.324, 0] },
        noteheadDiamondHalf: { stemDownNW: [0, 0], stemUpSE: [1.004, 0] },
        noteheadDiamondWhite: { stemDownNW: [0, 0], stemUpSE: [1, 0] },
        noteheadDiamondWhiteWide: {
          stemDownNW: [0, 0.004],
          stemUpSE: [1.4, 0],
        },
        noteheadDoubleWhole: { noteheadOrigin: [0.36, 0] },
        noteheadHalf: {
          cutOutNW: [0.204, 0.296],
          cutOutSE: [0.98, -0.3],
          splitStemDownNE: [0.956, -0.3],
          splitStemDownNW: [0.128, -0.428],
          splitStemUpSE: [1.108, 0.372],
          splitStemUpSW: [0.328, 0.38],
          stemDownNW: [0, -0.168],
          stemUpSE: [1.18, 0.168],
        },
        noteheadHeavyX: { stemDownNW: [0, -0.436], stemUpSE: [1.54, 0.44] },
        noteheadHeavyXHat: { stemDownNW: [0, -0.436], stemUpSE: [1.54, 0.456] },
        noteheadPlusBlack: { stemDownNW: [-0.004, 0], stemUpSE: [0.996, 0] },
        noteheadPlusDoubleWhole: { noteheadOrigin: [0.372, 0] },
        noteheadPlusHalf: { stemDownNW: [0, -0.112], stemUpSE: [1.044, 0.088] },
        noteheadRoundWhiteWithDot: { stemDownNW: [0, 0], stemUpSE: [1.004, 0] },
        noteheadSlashHorizontalEnds: {
          stemDownNW: [0, -1],
          stemUpSE: [2.12, 1],
        },
        noteheadSlashWhiteHalf: { stemDownNW: [0, -1], stemUpSE: [3.12, 1] },
        noteheadSlashedBlack1: {
          stemDownNW: [0, -0.172],
          stemUpSE: [1.18, 0.164],
        },
        noteheadSlashedBlack2: {
          stemDownNW: [0, -0.172],
          stemUpSE: [1.18, 0.164],
        },
        noteheadSlashedDoubleWhole1: { noteheadOrigin: [0.356, 0] },
        noteheadSlashedDoubleWhole2: { noteheadOrigin: [0.356, 0] },
        noteheadSlashedHalf1: {
          stemDownNW: [0, -0.168],
          stemUpSE: [1.168, 0.164],
        },
        noteheadSlashedHalf2: {
          stemDownNW: [0, -0.164],
          stemUpSE: [1.172, 0.168],
        },
        noteheadSquareBlack: { stemDownNW: [0, -0.5], stemUpSE: [1.252, 0.5] },
        noteheadSquareBlackLarge: { stemDownNW: [0, 0], stemUpSE: [2, 0] },
        noteheadSquareBlackWhite: { stemDownNW: [0, -1], stemUpSE: [2, 1] },
        noteheadSquareWhite: { stemDownNW: [0, -0.5], stemUpSE: [1.252, 0.5] },
        noteheadTriangleDownBlack: {
          stemDownNW: [0, 0.5],
          stemUpSE: [1.168, 0.5],
        },
        noteheadTriangleDownDoubleWhole: { noteheadOrigin: [0.384, 0] },
        noteheadTriangleDownHalf: {
          stemDownNW: [0, 0.464],
          stemUpSE: [1.14, 0.464],
        },
        noteheadTriangleRightBlack: {
          stemDownNW: [0, -0.5],
          stemUpSE: [1.356, 0.5],
        },
        noteheadTriangleRightWhite: {
          stemDownNW: [0, -0.5],
          stemUpSE: [1.356, 0.5],
        },
        noteheadTriangleUpBlack: {
          stemDownNW: [0, -0.5],
          stemUpSE: [1.172, -0.5],
        },
        noteheadTriangleUpDoubleWhole: { noteheadOrigin: [0.34, 0] },
        noteheadTriangleUpHalf: {
          stemDownNW: [0, -0.46],
          stemUpSE: [1.14, -0.46],
        },
        noteheadWhole: { cutOutNW: [0.172, 0.332], cutOutSE: [1.532, -0.364] },
        noteheadXBlack: { stemDownNW: [0, -0.44], stemUpSE: [1.16, 0.444] },
        noteheadXDoubleWhole: { noteheadOrigin: [0.348, 0] },
        noteheadXHalf: { stemDownNW: [0, -0.412], stemUpSE: [1.336, 0.412] },
        noteheadXOrnate: { stemDownNW: [0, -0.312], stemUpSE: [0.988, 0.316] },
        wiggleSawtooth: { repeatOffset: [2.992, 0] },
        wiggleSawtoothNarrow: { repeatOffset: [1.996, 0] },
        wiggleTrill: { repeatOffset: [0.948, 0] },
        wiggleVibratoMediumFast: { repeatOffset: [1.18, 0] },
      },
    });
  var Hn = ei;
  var mt = class mt {
    constructor() {
      this.engravingSettings = Hn.bravuraDefaults;
      this.copyrightFont = new ne(mt._sansFont, 12, 0, 1);
      this.titleFont = new ne(mt._serifFont, 32, 0);
      this.subTitleFont = new ne(mt._serifFont, 20, 0);
      this.wordsFont = new ne(mt._serifFont, 15, 0);
      this.effectFont = new ne(mt._serifFont, 12, 1);
      this.timerFont = new ne(mt._serifFont, 12, 0);
      this.directionsFont = new ne(mt._serifFont, 14, 0);
      this.fretboardNumberFont = new ne(mt._sansFont, 11, 0);
      this.numberedNotationFont = new ne(mt._sansFont, 16, 0);
      this.numberedNotationGraceFont = new ne(mt._sansFont, 14, 0);
      this.tablatureFont = new ne(mt._sansFont, 14, 0);
      this.graceFont = new ne(mt._sansFont, 12, 0);
      this.staffLineColor = new ae(165, 165, 165, 255);
      this.barSeparatorColor = new ae(34, 34, 17, 255);
      this.barNumberFont = new ne(mt._sansFont, 11, 0);
      this.barNumberColor = new ae(200, 0, 0, 255);
      this.fingeringFont = new ne(mt._serifFont, 14, 0);
      this.inlineFingeringFont = new ne(mt._serifFont, 12, 0);
      this.markerFont = new ne(mt._serifFont, 14, 0, 1);
      this.mainGlyphColor = new ae(0, 0, 0, 255);
      this.secondaryGlyphColor = new ae(0, 0, 0, 100);
      this.scoreInfoColor = new ae(0, 0, 0, 255);
    }
    getFontForElement(t) {
      switch (t) {
        case 0:
          return this.titleFont;
        case 1:
        case 2:
        case 3:
          return this.subTitleFont;
        case 4:
        case 5:
        case 6:
        case 7:
          return this.wordsFont;
        case 8:
        case 9:
          return this.copyrightFont;
      }
      return this.wordsFont;
    }
  };
  (mt._sansFont = "Arial, sans-serif"), (mt._serifFont = "Georgia, serif");
  var ca = mt;
  var Bs = ((n) => (
    (n[(n.Default = 0)] = "Default"),
    (n[(n.ScoreTab = 1)] = "ScoreTab"),
    (n[(n.Score = 2)] = "Score"),
    (n[(n.Tab = 3)] = "Tab"),
    (n[(n.TabMixed = 4)] = "TabMixed"),
    n
  ))(Bs || {});
  var Ts = ((e) => (
      (e[(e.Automatic = 0)] = "Automatic"),
      (e[(e.UseModelLayout = 1)] = "UseModelLayout"),
      e
    ))(Ts || {}),
    da = class {
      constructor() {
        this.scale = 1;
        this.stretchForce = 1;
        this.layoutMode = 0;
        this.staveProfile = 0;
        this.barsPerRow = -1;
        this.startBar = 1;
        this.barCount = -1;
        this.barCountPerPartial = 10;
        this.justifyLastSystem = !1;
        this.resources = new ca();
        this.padding = [35, 35];
        this.firstSystemPaddingTop = 5;
        this.systemPaddingTop = 10;
        this.systemPaddingBottom = 10;
        this.lastSystemPaddingBottom = 0;
        this.systemLabelPaddingLeft = 0;
        this.systemLabelPaddingRight = 3;
        this.accoladeBarPaddingRight = 3;
        this.notationStaffPaddingTop = 5;
        this.notationStaffPaddingBottom = 5;
        this.effectStaffPaddingTop = 0;
        this.effectStaffPaddingBottom = 0;
        this.firstStaffPaddingLeft = 6;
        this.staffPaddingLeft = 2;
        this.effectBandPaddingBottom = 2;
        this.systemsLayoutMode = 0;
      }
    };
  var pa = class {
    constructor() {
      this.encoding = "utf-8";
      this.mergePartGroupsInMusicXml = !1;
      this.beatTextAsLyrics = !1;
    }
  };
  var ma = ((r) => (
      (r[(r.Off = 0)] = "Off"),
      (r[(r.Continuous = 1)] = "Continuous"),
      (r[(r.OffScreen = 2)] = "OffScreen"),
      r
    ))(ma || {}),
    Uo = class {
      constructor() {
        this.noteWideLength = 240;
        this.noteWideAmplitude = 1;
        this.noteSlightLength = 360;
        this.noteSlightAmplitude = 0.5;
        this.beatWideLength = 480;
        this.beatWideAmplitude = 2;
        this.beatSlightLength = 480;
        this.beatSlightAmplitude = 2;
      }
    },
    zo = class {
      constructor() {
        this.simpleSlidePitchOffset = 6;
        this.simpleSlideDurationRatio = 0.25;
        this.shiftSlideDurationRatio = 0.5;
      }
    },
    fa = ((e) => (
      (e[(e.WebAudioAudioWorklets = 0)] = "WebAudioAudioWorklets"),
      (e[(e.WebAudioScriptProcessor = 1)] = "WebAudioScriptProcessor"),
      e
    ))(fa || {}),
    Un = ((n) => (
      (n[(n.Disabled = 0)] = "Disabled"),
      (n[(n.EnabledAutomatic = 1)] = "EnabledAutomatic"),
      (n[(n.EnabledSynthesizer = 2)] = "EnabledSynthesizer"),
      (n[(n.EnabledBackingTrack = 3)] = "EnabledBackingTrack"),
      (n[(n.EnabledExternalMedia = 4)] = "EnabledExternalMedia"),
      n
    ))(Un || {}),
    ha = class {
      constructor() {
        this.soundFont = null;
        this.scrollElement = "html,body";
        this.outputMode = 0;
        this.enablePlayer = !1;
        this.playerMode = 0;
        this.enableCursor = !0;
        this.enableAnimatedBeatCursor = !0;
        this.enableElementHighlighting = !0;
        this.enableUserInteraction = !0;
        this.scrollOffsetX = 0;
        this.scrollOffsetY = 0;
        this.scrollMode = 1;
        this.scrollSpeed = 300;
        this.nativeBrowserSmoothScroll = !0;
        this.songBookBendDuration = 75;
        this.songBookDipDuration = 150;
        this.vibrato = new Uo();
        this.slide = new zo();
        this.playTripletFeel = !0;
        this.bufferTimeInMilliseconds = 500;
      }
    };
  var ba = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i.toLowerCase(), r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      if (
        (e.set("scriptfile", t.scriptFile),
        e.set("fontdirectory", t.fontDirectory),
        t.smuflFontSources !== null)
      ) {
        let r = new Map();
        e.set("smuflfontsources", r);
        for (let [i, n] of t.smuflFontSources) r.set(i.toString(), n);
      }
      return (
        e.set("file", t.file),
        e.set("tex", t.tex),
        e.set("tracks", t.tracks),
        e.set("enablelazyloading", t.enableLazyLoading),
        e.set("engine", t.engine),
        e.set("loglevel", t.logLevel),
        e.set("useworkers", t.useWorkers),
        e.set("includenotebounds", t.includeNoteBounds),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "scriptfile":
          return (t.scriptFile = r), !0;
        case "fontdirectory":
          return (t.fontDirectory = r), !0;
        case "smuflfontsources":
          return (
            (t.smuflFontSources = new Map()),
            _.forEach(r, (i, n) => {
              t.smuflFontSources.set(_.parseEnum(n, ga), i);
            }),
            !0
          );
        case "file":
          return (t.file = r), !0;
        case "tex":
          return (t.tex = r), !0;
        case "tracks":
          return (t.tracks = r), !0;
        case "enablelazyloading":
          return (t.enableLazyLoading = r), !0;
        case "engine":
          return (t.engine = r), !0;
        case "loglevel":
          return (t.logLevel = _.parseEnum(r, ns)), !0;
        case "useworkers":
          return (t.useWorkers = r), !0;
        case "includenotebounds":
          return (t.includeNoteBounds = r), !0;
      }
      return !1;
    }
  };
  var ks = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i.toLowerCase(), r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("topy", t.topY), e.set("bottomy", t.bottomY), e.set("x", t.x), e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "topy":
          return (t.topY = r), !0;
        case "bottomy":
          return (t.bottomY = r), !0;
        case "x":
          return (t.x = r), !0;
      }
      return !1;
    }
  };
  var Xo = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i.toLowerCase(), r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      e.set("musicfontsize", t.musicFontSize),
        e.set("onestaffspace", t.oneStaffSpace),
        e.set("tablinespacing", t.tabLineSpacing),
        e.set("arrowshaftthickness", t.arrowShaftThickness),
        e.set("barlineseparation", t.barlineSeparation),
        e.set("beamspacing", t.beamSpacing),
        e.set("beamthickness", t.beamThickness),
        e.set("bracketthickness", t.bracketThickness),
        e.set("dashedbarlinedashlength", t.dashedBarlineDashLength),
        e.set("dashedbarlinegaplength", t.dashedBarlineGapLength),
        e.set("dashedbarlinethickness", t.dashedBarlineThickness),
        e.set("hairpinthickness", t.hairpinThickness),
        e.set("legerlinethickness", t.legerLineThickness),
        e.set("legerlineextension", t.legerLineExtension),
        e.set("octavelinethickness", t.octaveLineThickness),
        e.set("pedallinethickness", t.pedalLineThickness),
        e.set("repeatbarlinedotseparation", t.repeatBarlineDotSeparation),
        e.set("repeatendinglinethickness", t.repeatEndingLineThickness),
        e.set("slurmidpointthickness", t.slurMidpointThickness),
        e.set("stafflinethickness", t.staffLineThickness),
        e.set("stemthickness", t.stemThickness),
        e.set("thickbarlinethickness", t.thickBarlineThickness),
        e.set("thinbarlinethickness", t.thinBarlineThickness),
        e.set("thinthickbarlineseparation", t.thinThickBarlineSeparation),
        e.set("tiemidpointthickness", t.tieMidpointThickness),
        e.set("tupletbracketthickness", t.tupletBracketThickness);
      {
        let r = new Map();
        e.set("stemup", r);
        for (let [i, n] of t.stemUp) r.set(i.toString(), ks.toJson(n));
      }
      {
        let r = new Map();
        e.set("stemdown", r);
        for (let [i, n] of t.stemDown) r.set(i.toString(), ks.toJson(n));
      }
      {
        let r = new Map();
        e.set("repeatoffsetx", r);
        for (let [i, n] of t.repeatOffsetX) r.set(i.toString(), n);
      }
      e.set("standardstemlength", t.standardStemLength);
      {
        let r = new Map();
        e.set("stemflagoffsets", r);
        for (let [i, n] of t.stemFlagOffsets) r.set(i.toString(), n);
      }
      {
        let r = new Map();
        e.set("glyphtop", r);
        for (let [i, n] of t.glyphTop) r.set(i.toString(), n);
      }
      {
        let r = new Map();
        e.set("glyphbottom", r);
        for (let [i, n] of t.glyphBottom) r.set(i.toString(), n);
      }
      {
        let r = new Map();
        e.set("glyphwidths", r);
        for (let [i, n] of t.glyphWidths) r.set(i.toString(), n);
      }
      {
        let r = new Map();
        e.set("glyphheights", r);
        for (let [i, n] of t.glyphHeights) r.set(i.toString(), n);
      }
      return (
        e.set("numberedbarrendererbarsize", t.numberedBarRendererBarSize),
        e.set("numberedbarrendererbarspacing", t.numberedBarRendererBarSpacing),
        e.set("numbereddashglyphpadding", t.numberedDashGlyphPadding),
        e.set("numbereddashglyphwidth", t.numberedDashGlyphWidth),
        e.set("linerangedglyphdashgap", t.lineRangedGlyphDashGap),
        e.set("linerangedglyphdashsize", t.lineRangedGlyphDashSize),
        e.set("prenoteeffectpadding", t.preNoteEffectPadding),
        e.set("postnoteeffectpadding", t.postNoteEffectPadding),
        e.set("onnoteeffectpadding", t.onNoteEffectPadding),
        e.set("stringnumbercirclepadding", t.stringNumberCirclePadding),
        e.set("rowcontainerpadding", t.rowContainerPadding),
        e.set("rowcontainergap", t.rowContainerGap),
        e.set("alternateendingspadding", t.alternateEndingsPadding),
        e.set("sustainpedallinepadding", t.sustainPedalLinePadding),
        e.set("tieheight", t.tieHeight),
        e.set("beattimerpadding", t.beatTimerPadding),
        e.set("bendnoteheadelementpadding", t.bendNoteHeadElementPadding),
        e.set("ghostparenthesiswidth", t.ghostParenthesisWidth),
        e.set("ghostparenthesispadding", t.ghostParenthesisPadding),
        e.set("brokenbeamwidth", t.brokenBeamWidth),
        e.set("tabwhammytextpadding", t.tabWhammyTextPadding),
        e.set("tabwhammyperhalfheight", t.tabWhammyPerHalfHeight),
        e.set("tabwhammydashsize", t.tabWhammyDashSize),
        e.set("songbookwhammydipheight", t.songBookWhammyDipHeight),
        e.set("deadslappedlinewidth", t.deadSlappedLineWidth),
        e.set("lefthandtabtiewidth", t.leftHandTabTieWidth),
        e.set("tabbenddashsize", t.tabBendDashSize),
        e.set("tabbendpervalueheight", t.tabBendPerValueHeight),
        e.set("tabbendlabelpadding", t.tabBendLabelPadding),
        e.set("simpleslidewidth", t.simpleSlideWidth),
        e.set("simpleslideheight", t.simpleSlideHeight),
        e.set("chorddiagrampaddingx", t.chordDiagramPaddingX),
        e.set("chorddiagrampaddingy", t.chordDiagramPaddingY),
        e.set("chorddiagramstringspacing", t.chordDiagramStringSpacing),
        e.set("chorddiagramfretspacing", t.chordDiagramFretSpacing),
        e.set("chorddiagramnutheight", t.chordDiagramNutHeight),
        e.set("chorddiagramfretheight", t.chordDiagramFretHeight),
        e.set("chorddiagramlinewidth", t.chordDiagramLineWidth),
        e.set("tripletfeelbracketpadding", t.tripletFeelBracketPadding),
        e.set("accidentalpadding", t.accidentalPadding),
        e.set("prebeatglyphspacing", t.preBeatGlyphSpacing),
        e.set("temponotescale", t.tempoNoteScale),
        e.set("tuningglyphcirclenumberscale", t.tuningGlyphCircleNumberScale),
        e.set("tuningglyphstringcolumnscale", t.tuningGlyphStringColumnScale),
        e.set("tuningglyphstringrowpadding", t.tuningGlyphStringRowPadding),
        e.set("directionsscale", t.directionsScale),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "musicfontsize":
          return (t.musicFontSize = r), !0;
        case "onestaffspace":
          return (t.oneStaffSpace = r), !0;
        case "tablinespacing":
          return (t.tabLineSpacing = r), !0;
        case "arrowshaftthickness":
          return (t.arrowShaftThickness = r), !0;
        case "barlineseparation":
          return (t.barlineSeparation = r), !0;
        case "beamspacing":
          return (t.beamSpacing = r), !0;
        case "beamthickness":
          return (t.beamThickness = r), !0;
        case "bracketthickness":
          return (t.bracketThickness = r), !0;
        case "dashedbarlinedashlength":
          return (t.dashedBarlineDashLength = r), !0;
        case "dashedbarlinegaplength":
          return (t.dashedBarlineGapLength = r), !0;
        case "dashedbarlinethickness":
          return (t.dashedBarlineThickness = r), !0;
        case "hairpinthickness":
          return (t.hairpinThickness = r), !0;
        case "legerlinethickness":
          return (t.legerLineThickness = r), !0;
        case "legerlineextension":
          return (t.legerLineExtension = r), !0;
        case "octavelinethickness":
          return (t.octaveLineThickness = r), !0;
        case "pedallinethickness":
          return (t.pedalLineThickness = r), !0;
        case "repeatbarlinedotseparation":
          return (t.repeatBarlineDotSeparation = r), !0;
        case "repeatendinglinethickness":
          return (t.repeatEndingLineThickness = r), !0;
        case "slurmidpointthickness":
          return (t.slurMidpointThickness = r), !0;
        case "stafflinethickness":
          return (t.staffLineThickness = r), !0;
        case "stemthickness":
          return (t.stemThickness = r), !0;
        case "thickbarlinethickness":
          return (t.thickBarlineThickness = r), !0;
        case "thinbarlinethickness":
          return (t.thinBarlineThickness = r), !0;
        case "thinthickbarlineseparation":
          return (t.thinThickBarlineSeparation = r), !0;
        case "tiemidpointthickness":
          return (t.tieMidpointThickness = r), !0;
        case "tupletbracketthickness":
          return (t.tupletBracketThickness = r), !0;
        case "stemup":
          return (
            (t.stemUp = new Map()),
            _.forEach(r, (i, n) => {
              let s = new Ki();
              ks.fromJson(s, i), t.stemUp.set(_.parseEnum(n, K), s);
            }),
            !0
          );
        case "stemdown":
          return (
            (t.stemDown = new Map()),
            _.forEach(r, (i, n) => {
              let s = new Ki();
              ks.fromJson(s, i), t.stemDown.set(_.parseEnum(n, K), s);
            }),
            !0
          );
        case "repeatoffsetx":
          return (
            (t.repeatOffsetX = new Map()),
            _.forEach(r, (i, n) => {
              t.repeatOffsetX.set(_.parseEnum(n, K), i);
            }),
            !0
          );
        case "standardstemlength":
          return (t.standardStemLength = r), !0;
        case "stemflagoffsets":
          return (
            (t.stemFlagOffsets = new Map()),
            _.forEach(r, (i, n) => {
              t.stemFlagOffsets.set(_.parseEnum(n, _e), i);
            }),
            !0
          );
        case "glyphtop":
          return (
            (t.glyphTop = new Map()),
            _.forEach(r, (i, n) => {
              t.glyphTop.set(_.parseEnum(n, K), i);
            }),
            !0
          );
        case "glyphbottom":
          return (
            (t.glyphBottom = new Map()),
            _.forEach(r, (i, n) => {
              t.glyphBottom.set(_.parseEnum(n, K), i);
            }),
            !0
          );
        case "glyphwidths":
          return (
            (t.glyphWidths = new Map()),
            _.forEach(r, (i, n) => {
              t.glyphWidths.set(_.parseEnum(n, K), i);
            }),
            !0
          );
        case "glyphheights":
          return (
            (t.glyphHeights = new Map()),
            _.forEach(r, (i, n) => {
              t.glyphHeights.set(_.parseEnum(n, K), i);
            }),
            !0
          );
        case "numberedbarrendererbarsize":
          return (t.numberedBarRendererBarSize = r), !0;
        case "numberedbarrendererbarspacing":
          return (t.numberedBarRendererBarSpacing = r), !0;
        case "numbereddashglyphpadding":
          return (t.numberedDashGlyphPadding = r), !0;
        case "numbereddashglyphwidth":
          return (t.numberedDashGlyphWidth = r), !0;
        case "linerangedglyphdashgap":
          return (t.lineRangedGlyphDashGap = r), !0;
        case "linerangedglyphdashsize":
          return (t.lineRangedGlyphDashSize = r), !0;
        case "prenoteeffectpadding":
          return (t.preNoteEffectPadding = r), !0;
        case "postnoteeffectpadding":
          return (t.postNoteEffectPadding = r), !0;
        case "onnoteeffectpadding":
          return (t.onNoteEffectPadding = r), !0;
        case "stringnumbercirclepadding":
          return (t.stringNumberCirclePadding = r), !0;
        case "rowcontainerpadding":
          return (t.rowContainerPadding = r), !0;
        case "rowcontainergap":
          return (t.rowContainerGap = r), !0;
        case "alternateendingspadding":
          return (t.alternateEndingsPadding = r), !0;
        case "sustainpedallinepadding":
          return (t.sustainPedalLinePadding = r), !0;
        case "tieheight":
          return (t.tieHeight = r), !0;
        case "beattimerpadding":
          return (t.beatTimerPadding = r), !0;
        case "bendnoteheadelementpadding":
          return (t.bendNoteHeadElementPadding = r), !0;
        case "ghostparenthesiswidth":
          return (t.ghostParenthesisWidth = r), !0;
        case "ghostparenthesispadding":
          return (t.ghostParenthesisPadding = r), !0;
        case "brokenbeamwidth":
          return (t.brokenBeamWidth = r), !0;
        case "tabwhammytextpadding":
          return (t.tabWhammyTextPadding = r), !0;
        case "tabwhammyperhalfheight":
          return (t.tabWhammyPerHalfHeight = r), !0;
        case "tabwhammydashsize":
          return (t.tabWhammyDashSize = r), !0;
        case "songbookwhammydipheight":
          return (t.songBookWhammyDipHeight = r), !0;
        case "deadslappedlinewidth":
          return (t.deadSlappedLineWidth = r), !0;
        case "lefthandtabtiewidth":
          return (t.leftHandTabTieWidth = r), !0;
        case "tabbenddashsize":
          return (t.tabBendDashSize = r), !0;
        case "tabbendpervalueheight":
          return (t.tabBendPerValueHeight = r), !0;
        case "tabbendlabelpadding":
          return (t.tabBendLabelPadding = r), !0;
        case "simpleslidewidth":
          return (t.simpleSlideWidth = r), !0;
        case "simpleslideheight":
          return (t.simpleSlideHeight = r), !0;
        case "chorddiagrampaddingx":
          return (t.chordDiagramPaddingX = r), !0;
        case "chorddiagrampaddingy":
          return (t.chordDiagramPaddingY = r), !0;
        case "chorddiagramstringspacing":
          return (t.chordDiagramStringSpacing = r), !0;
        case "chorddiagramfretspacing":
          return (t.chordDiagramFretSpacing = r), !0;
        case "chorddiagramnutheight":
          return (t.chordDiagramNutHeight = r), !0;
        case "chorddiagramfretheight":
          return (t.chordDiagramFretHeight = r), !0;
        case "chorddiagramlinewidth":
          return (t.chordDiagramLineWidth = r), !0;
        case "tripletfeelbracketpadding":
          return (t.tripletFeelBracketPadding = r), !0;
        case "accidentalpadding":
          return (t.accidentalPadding = r), !0;
        case "prebeatglyphspacing":
          return (t.preBeatGlyphSpacing = r), !0;
        case "temponotescale":
          return (t.tempoNoteScale = r), !0;
        case "tuningglyphcirclenumberscale":
          return (t.tuningGlyphCircleNumberScale = r), !0;
        case "tuningglyphstringcolumnscale":
          return (t.tuningGlyphStringColumnScale = r), !0;
        case "tuningglyphstringrowpadding":
          return (t.tuningGlyphStringRowPadding = r), !0;
        case "directionsscale":
          return (t.directionsScale = r), !0;
      }
      return !1;
    }
  };
  var ya = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i.toLowerCase(), r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("smuflfontfamilyname", t.smuflFontFamilyName),
        e.set("engravingsettings", Xo.toJson(t.engravingSettings)),
        e.set("copyrightfont", ne.toJson(t.copyrightFont)),
        e.set("titlefont", ne.toJson(t.titleFont)),
        e.set("subtitlefont", ne.toJson(t.subTitleFont)),
        e.set("wordsfont", ne.toJson(t.wordsFont)),
        e.set("effectfont", ne.toJson(t.effectFont)),
        e.set("timerfont", ne.toJson(t.timerFont)),
        e.set("directionsfont", ne.toJson(t.directionsFont)),
        e.set("fretboardnumberfont", ne.toJson(t.fretboardNumberFont)),
        e.set("numberednotationfont", ne.toJson(t.numberedNotationFont)),
        e.set(
          "numberednotationgracefont",
          ne.toJson(t.numberedNotationGraceFont)
        ),
        e.set("tablaturefont", ne.toJson(t.tablatureFont)),
        e.set("gracefont", ne.toJson(t.graceFont)),
        e.set("stafflinecolor", ae.toJson(t.staffLineColor)),
        e.set("barseparatorcolor", ae.toJson(t.barSeparatorColor)),
        e.set("barnumberfont", ne.toJson(t.barNumberFont)),
        e.set("barnumbercolor", ae.toJson(t.barNumberColor)),
        e.set("fingeringfont", ne.toJson(t.fingeringFont)),
        e.set("inlinefingeringfont", ne.toJson(t.inlineFingeringFont)),
        e.set("markerfont", ne.toJson(t.markerFont)),
        e.set("mainglyphcolor", ae.toJson(t.mainGlyphColor)),
        e.set("secondaryglyphcolor", ae.toJson(t.secondaryGlyphColor)),
        e.set("scoreinfocolor", ae.toJson(t.scoreInfoColor)),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "smuflfontfamilyname":
          return (t.smuflFontFamilyName = r), !0;
        case "copyrightfont":
          return (t.copyrightFont = ne.fromJson(r)), !0;
        case "titlefont":
          return (t.titleFont = ne.fromJson(r)), !0;
        case "subtitlefont":
          return (t.subTitleFont = ne.fromJson(r)), !0;
        case "wordsfont":
          return (t.wordsFont = ne.fromJson(r)), !0;
        case "effectfont":
          return (t.effectFont = ne.fromJson(r)), !0;
        case "timerfont":
          return (t.timerFont = ne.fromJson(r)), !0;
        case "directionsfont":
          return (t.directionsFont = ne.fromJson(r)), !0;
        case "fretboardnumberfont":
          return (t.fretboardNumberFont = ne.fromJson(r)), !0;
        case "numberednotationfont":
          return (t.numberedNotationFont = ne.fromJson(r)), !0;
        case "numberednotationgracefont":
          return (t.numberedNotationGraceFont = ne.fromJson(r)), !0;
        case "tablaturefont":
          return (t.tablatureFont = ne.fromJson(r)), !0;
        case "gracefont":
          return (t.graceFont = ne.fromJson(r)), !0;
        case "stafflinecolor":
          return (t.staffLineColor = ae.fromJson(r)), !0;
        case "barseparatorcolor":
          return (t.barSeparatorColor = ae.fromJson(r)), !0;
        case "barnumberfont":
          return (t.barNumberFont = ne.fromJson(r)), !0;
        case "barnumbercolor":
          return (t.barNumberColor = ae.fromJson(r)), !0;
        case "fingeringfont":
          return (t.fingeringFont = ne.fromJson(r)), !0;
        case "inlinefingeringfont":
          return (t.inlineFingeringFont = ne.fromJson(r)), !0;
        case "markerfont":
          return (t.markerFont = ne.fromJson(r)), !0;
        case "mainglyphcolor":
          return (t.mainGlyphColor = ae.fromJson(r)), !0;
        case "secondaryglyphcolor":
          return (t.secondaryGlyphColor = ae.fromJson(r)), !0;
        case "scoreinfocolor":
          return (t.scoreInfoColor = ae.fromJson(r)), !0;
      }
      return ["engravingsettings"].indexOf(e) >= 0
        ? (Xo.fromJson(t.engravingSettings, r), !0)
        : !1;
    }
  };
  var Sa = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i.toLowerCase(), r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("scale", t.scale),
        e.set("stretchforce", t.stretchForce),
        e.set("layoutmode", t.layoutMode),
        e.set("staveprofile", t.staveProfile),
        e.set("barsperrow", t.barsPerRow),
        e.set("startbar", t.startBar),
        e.set("barcount", t.barCount),
        e.set("barcountperpartial", t.barCountPerPartial),
        e.set("justifylastsystem", t.justifyLastSystem),
        e.set("resources", ya.toJson(t.resources)),
        e.set("padding", t.padding),
        e.set("firstsystempaddingtop", t.firstSystemPaddingTop),
        e.set("systempaddingtop", t.systemPaddingTop),
        e.set("systempaddingbottom", t.systemPaddingBottom),
        e.set("lastsystempaddingbottom", t.lastSystemPaddingBottom),
        e.set("systemlabelpaddingleft", t.systemLabelPaddingLeft),
        e.set("systemlabelpaddingright", t.systemLabelPaddingRight),
        e.set("accoladebarpaddingright", t.accoladeBarPaddingRight),
        e.set("notationstaffpaddingtop", t.notationStaffPaddingTop),
        e.set("notationstaffpaddingbottom", t.notationStaffPaddingBottom),
        e.set("effectstaffpaddingtop", t.effectStaffPaddingTop),
        e.set("effectstaffpaddingbottom", t.effectStaffPaddingBottom),
        e.set("firststaffpaddingleft", t.firstStaffPaddingLeft),
        e.set("staffpaddingleft", t.staffPaddingLeft),
        e.set("effectbandpaddingbottom", t.effectBandPaddingBottom),
        e.set("systemslayoutmode", t.systemsLayoutMode),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "scale":
          return (t.scale = r), !0;
        case "stretchforce":
          return (t.stretchForce = r), !0;
        case "layoutmode":
          return (t.layoutMode = _.parseEnum(r, Ui)), !0;
        case "staveprofile":
          return (t.staveProfile = _.parseEnum(r, Bs)), !0;
        case "barsperrow":
          return (t.barsPerRow = r), !0;
        case "startbar":
          return (t.startBar = r), !0;
        case "barcount":
          return (t.barCount = r), !0;
        case "barcountperpartial":
          return (t.barCountPerPartial = r), !0;
        case "justifylastsystem":
          return (t.justifyLastSystem = r), !0;
        case "padding":
          return (t.padding = r), !0;
        case "firstsystempaddingtop":
          return (t.firstSystemPaddingTop = r), !0;
        case "systempaddingtop":
          return (t.systemPaddingTop = r), !0;
        case "systempaddingbottom":
          return (t.systemPaddingBottom = r), !0;
        case "lastsystempaddingbottom":
          return (t.lastSystemPaddingBottom = r), !0;
        case "systemlabelpaddingleft":
          return (t.systemLabelPaddingLeft = r), !0;
        case "systemlabelpaddingright":
          return (t.systemLabelPaddingRight = r), !0;
        case "accoladebarpaddingright":
          return (t.accoladeBarPaddingRight = r), !0;
        case "notationstaffpaddingtop":
          return (t.notationStaffPaddingTop = r), !0;
        case "notationstaffpaddingbottom":
          return (t.notationStaffPaddingBottom = r), !0;
        case "effectstaffpaddingtop":
          return (t.effectStaffPaddingTop = r), !0;
        case "effectstaffpaddingbottom":
          return (t.effectStaffPaddingBottom = r), !0;
        case "firststaffpaddingleft":
          return (t.firstStaffPaddingLeft = r), !0;
        case "staffpaddingleft":
          return (t.staffPaddingLeft = r), !0;
        case "effectbandpaddingbottom":
          return (t.effectBandPaddingBottom = r), !0;
        case "systemslayoutmode":
          return (t.systemsLayoutMode = _.parseEnum(r, Ts)), !0;
      }
      if (["resources"].indexOf(e) >= 0) return ya.fromJson(t.resources, r), !0;
      for (let i of ["resources"])
        if (
          e.indexOf(i) === 0 &&
          ya.setProperty(t.resources, e.substring(i.length), r)
        )
          return !0;
      return !1;
    }
  };
  var Ba = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i.toLowerCase(), r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      e.set("notationmode", t.notationMode),
        e.set("fingeringmode", t.fingeringMode);
      {
        let r = new Map();
        e.set("elements", r);
        for (let [i, n] of t.elements) r.set(i.toString(), n);
      }
      return (
        e.set("rhythmmode", t.rhythmMode),
        e.set("rhythmheight", t.rhythmHeight),
        e.set("transpositionpitches", t.transpositionPitches),
        e.set("displaytranspositionpitches", t.displayTranspositionPitches),
        e.set("smallgracetabnotes", t.smallGraceTabNotes),
        e.set("extendbendarrowsontiednotes", t.extendBendArrowsOnTiedNotes),
        e.set("extendlineeffectstobeatend", t.extendLineEffectsToBeatEnd),
        e.set("slurheight", t.slurHeight),
        e.set("showchorddiagramsonbeats", t.showChordDiagramsOnBeats),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "notationmode":
          return (t.notationMode = _.parseEnum(r, gr)), !0;
        case "fingeringmode":
          return (t.fingeringMode = _.parseEnum(r, on)), !0;
        case "elements":
          return (
            (t.elements = new Map()),
            _.forEach(r, (i, n) => {
              t.elements.set(_.parseEnum(n, me), i);
            }),
            !0
          );
        case "rhythmmode":
          return (t.rhythmMode = _.parseEnum(r, is)), !0;
        case "rhythmheight":
          return (t.rhythmHeight = r), !0;
        case "transpositionpitches":
          return (t.transpositionPitches = r), !0;
        case "displaytranspositionpitches":
          return (t.displayTranspositionPitches = r), !0;
        case "smallgracetabnotes":
          return (t.smallGraceTabNotes = r), !0;
        case "extendbendarrowsontiednotes":
          return (t.extendBendArrowsOnTiedNotes = r), !0;
        case "extendlineeffectstobeatend":
          return (t.extendLineEffectsToBeatEnd = r), !0;
        case "slurheight":
          return (t.slurHeight = r), !0;
        case "showchorddiagramsonbeats":
          return (t.showChordDiagramsOnBeats = r), !0;
      }
      return !1;
    }
  };
  var Ta = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i.toLowerCase(), r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("encoding", t.encoding),
        e.set("mergepartgroupsinmusicxml", t.mergePartGroupsInMusicXml),
        e.set("beattextaslyrics", t.beatTextAsLyrics),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "encoding":
          return (t.encoding = r), !0;
        case "mergepartgroupsinmusicxml":
          return (t.mergePartGroupsInMusicXml = r), !0;
        case "beattextaslyrics":
          return (t.beatTextAsLyrics = r), !0;
      }
      return !1;
    }
  };
  var ka = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i.toLowerCase(), r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("notewidelength", t.noteWideLength),
        e.set("notewideamplitude", t.noteWideAmplitude),
        e.set("noteslightlength", t.noteSlightLength),
        e.set("noteslightamplitude", t.noteSlightAmplitude),
        e.set("beatwidelength", t.beatWideLength),
        e.set("beatwideamplitude", t.beatWideAmplitude),
        e.set("beatslightlength", t.beatSlightLength),
        e.set("beatslightamplitude", t.beatSlightAmplitude),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "notewidelength":
          return (t.noteWideLength = r), !0;
        case "notewideamplitude":
          return (t.noteWideAmplitude = r), !0;
        case "noteslightlength":
          return (t.noteSlightLength = r), !0;
        case "noteslightamplitude":
          return (t.noteSlightAmplitude = r), !0;
        case "beatwidelength":
          return (t.beatWideLength = r), !0;
        case "beatwideamplitude":
          return (t.beatWideAmplitude = r), !0;
        case "beatslightlength":
          return (t.beatSlightLength = r), !0;
        case "beatslightamplitude":
          return (t.beatSlightAmplitude = r), !0;
      }
      return !1;
    }
  };
  var va = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i.toLowerCase(), r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("simpleslidepitchoffset", t.simpleSlidePitchOffset),
        e.set("simpleslidedurationratio", t.simpleSlideDurationRatio),
        e.set("shiftslidedurationratio", t.shiftSlideDurationRatio),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "simpleslidepitchoffset":
          return (t.simpleSlidePitchOffset = r), !0;
        case "simpleslidedurationratio":
          return (t.simpleSlideDurationRatio = r), !0;
        case "shiftslidedurationratio":
          return (t.shiftSlideDurationRatio = r), !0;
      }
      return !1;
    }
  };
  var _a = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i.toLowerCase(), r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("soundfont", t.soundFont),
        e.set("outputmode", t.outputMode),
        e.set("enableplayer", t.enablePlayer),
        e.set("playermode", t.playerMode),
        e.set("enablecursor", t.enableCursor),
        e.set("enableanimatedbeatcursor", t.enableAnimatedBeatCursor),
        e.set("enableelementhighlighting", t.enableElementHighlighting),
        e.set("enableuserinteraction", t.enableUserInteraction),
        e.set("scrolloffsetx", t.scrollOffsetX),
        e.set("scrolloffsety", t.scrollOffsetY),
        e.set("scrollmode", t.scrollMode),
        e.set("scrollspeed", t.scrollSpeed),
        e.set("nativebrowsersmoothscroll", t.nativeBrowserSmoothScroll),
        e.set("songbookbendduration", t.songBookBendDuration),
        e.set("songbookdipduration", t.songBookDipDuration),
        e.set("vibrato", ka.toJson(t.vibrato)),
        e.set("slide", va.toJson(t.slide)),
        e.set("playtripletfeel", t.playTripletFeel),
        e.set("buffertimeinmilliseconds", t.bufferTimeInMilliseconds),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "soundfont":
          return (t.soundFont = r), !0;
        case "scrollelement":
          return (t.scrollElement = r), !0;
        case "outputmode":
          return (t.outputMode = _.parseEnum(r, fa)), !0;
        case "enableplayer":
          return (t.enablePlayer = r), !0;
        case "playermode":
          return (t.playerMode = _.parseEnum(r, Un)), !0;
        case "enablecursor":
          return (t.enableCursor = r), !0;
        case "enableanimatedbeatcursor":
          return (t.enableAnimatedBeatCursor = r), !0;
        case "enableelementhighlighting":
          return (t.enableElementHighlighting = r), !0;
        case "enableuserinteraction":
          return (t.enableUserInteraction = r), !0;
        case "scrolloffsetx":
          return (t.scrollOffsetX = r), !0;
        case "scrolloffsety":
          return (t.scrollOffsetY = r), !0;
        case "scrollmode":
          return (t.scrollMode = _.parseEnum(r, ma)), !0;
        case "scrollspeed":
          return (t.scrollSpeed = r), !0;
        case "nativebrowsersmoothscroll":
          return (t.nativeBrowserSmoothScroll = r), !0;
        case "songbookbendduration":
          return (t.songBookBendDuration = r), !0;
        case "songbookdipduration":
          return (t.songBookDipDuration = r), !0;
        case "playtripletfeel":
          return (t.playTripletFeel = r), !0;
        case "buffertimeinmilliseconds":
          return (t.bufferTimeInMilliseconds = r), !0;
      }
      if (["vibrato"].indexOf(e) >= 0) return ka.fromJson(t.vibrato, r), !0;
      for (let i of ["vibrato"])
        if (
          e.indexOf(i) === 0 &&
          ka.setProperty(t.vibrato, e.substring(i.length), r)
        )
          return !0;
      if (["slide"].indexOf(e) >= 0) return va.fromJson(t.slide, r), !0;
      for (let i of ["slide"])
        if (
          e.indexOf(i) === 0 &&
          va.setProperty(t.slide, e.substring(i.length), r)
        )
          return !0;
      return !1;
    }
  };
  var xa = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i.toLowerCase(), r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return e.set("indent", t.indent), e.set("comments", t.comments), e;
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "indent":
          return (t.indent = r), !0;
        case "comments":
          return (t.comments = r), !0;
      }
      return !1;
    }
  };
  var Gr = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i.toLowerCase(), r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("core", ba.toJson(t.core)),
        e.set("display", Sa.toJson(t.display)),
        e.set("notation", Ba.toJson(t.notation)),
        e.set("importer", Ta.toJson(t.importer)),
        e.set("player", _a.toJson(t.player)),
        e.set("exporter", xa.toJson(t.exporter)),
        e
      );
    }
    static setProperty(t, e, r) {
      if (["core", ""].indexOf(e) >= 0) return ba.fromJson(t.core, r), !0;
      for (let i of ["core", ""])
        if (
          e.indexOf(i) === 0 &&
          ba.setProperty(t.core, e.substring(i.length), r)
        )
          return !0;
      if (["display", ""].indexOf(e) >= 0) return Sa.fromJson(t.display, r), !0;
      for (let i of ["display", ""])
        if (
          e.indexOf(i) === 0 &&
          Sa.setProperty(t.display, e.substring(i.length), r)
        )
          return !0;
      if (["notation"].indexOf(e) >= 0) return Ba.fromJson(t.notation, r), !0;
      for (let i of ["notation"])
        if (
          e.indexOf(i) === 0 &&
          Ba.setProperty(t.notation, e.substring(i.length), r)
        )
          return !0;
      if (["importer"].indexOf(e) >= 0) return Ta.fromJson(t.importer, r), !0;
      for (let i of ["importer"])
        if (
          e.indexOf(i) === 0 &&
          Ta.setProperty(t.importer, e.substring(i.length), r)
        )
          return !0;
      if (["player"].indexOf(e) >= 0) return _a.fromJson(t.player, r), !0;
      for (let i of ["player"])
        if (
          e.indexOf(i) === 0 &&
          _a.setProperty(t.player, e.substring(i.length), r)
        )
          return !0;
      if (["exporter"].indexOf(e) >= 0) return xa.fromJson(t.exporter, r), !0;
      for (let i of ["exporter"])
        if (
          e.indexOf(i) === 0 &&
          xa.setProperty(t.exporter, e.substring(i.length), r)
        )
          return !0;
      return !1;
    }
  };
  var wa = class {
    constructor() {
      this.indent = 2;
      this.comments = !1;
    }
  };
  var kt = class p {
    constructor() {
      this.core = new zn();
      this.display = new da();
      this.notation = new Vs();
      this.importer = new pa();
      this.player = new ha();
      this.exporter = new wa();
    }
    setSongBookModeSettings() {
      (this.notation.notationMode = 1),
        (this.notation.smallGraceTabNotes = !1),
        (this.notation.fingeringMode = 2),
        (this.notation.extendBendArrowsOnTiedNotes = !1),
        this.notation.elements.set(11, !1),
        this.notation.elements.set(12, !1),
        this.notation.elements.set(13, !0);
    }
    static get songBook() {
      let t = new p();
      return t.setSongBookModeSettings(), t;
    }
    fillFromJson(t) {
      Gr.fromJson(this, t);
    }
    handleBackwardsCompatibility() {
      this.player.playerMode === 0 &&
        this.player.enablePlayer &&
        (this.player.playerMode = 1);
    }
  };
  var Yo = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return e.set("marker", t.marker), e.set("text", t.text), e;
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "marker":
          return (t.marker = r), !0;
        case "text":
          return (t.text = r), !0;
      }
      return !1;
    }
  };
  var Jo = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("baroccurence", t.barOccurence),
        e.set("millisecondoffset", t.millisecondOffset),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "baroccurence":
          return (t.barOccurence = r), !0;
        case "millisecondoffset":
          return (t.millisecondOffset = r), !0;
      }
      return !1;
    }
  };
  var Ii = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("islinear", t.isLinear),
        e.set("type", t.type),
        e.set("value", t.value),
        t.syncPointValue &&
          e.set("syncpointvalue", Jo.toJson(t.syncPointValue)),
        e.set("ratioposition", t.ratioPosition),
        e.set("text", t.text),
        e.set("isvisible", t.isVisible),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "islinear":
          return (t.isLinear = r), !0;
        case "type":
          return (t.type = _.parseEnum(r, ar)), !0;
        case "value":
          return (t.value = r), !0;
        case "syncpointvalue":
          return (
            r
              ? ((t.syncPointValue = new Ur()),
                Jo.fromJson(t.syncPointValue, r))
              : (t.syncPointValue = void 0),
            !0
          );
        case "ratioposition":
          return (t.ratioPosition = r), !0;
        case "text":
          return (t.text = r), !0;
        case "isvisible":
          return (t.isVisible = r), !0;
      }
      return !1;
    }
  };
  var qo = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return e.set("type", t.type), e.set("length", t.length), e;
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "type":
          return (t.type = _.parseEnum(r, Fr)), !0;
        case "length":
          return (t.length = r), !0;
      }
      return !1;
    }
  };
  var $o = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      if (
        (e.set("alternateendings", t.alternateEndings),
        e.set("isdoublebar", t.isDoubleBar),
        e.set("isrepeatstart", t.isRepeatStart),
        e.set("repeatcount", t.repeatCount),
        e.set("timesignaturenumerator", t.timeSignatureNumerator),
        e.set("timesignaturedenominator", t.timeSignatureDenominator),
        e.set("timesignaturecommon", t.timeSignatureCommon),
        e.set("isfreetime", t.isFreeTime),
        e.set("tripletfeel", t.tripletFeel),
        t.section && e.set("section", Yo.toJson(t.section)),
        e.set(
          "tempoautomations",
          t.tempoAutomations.map((r) => Ii.toJson(r))
        ),
        t.syncPoints !== void 0 &&
          e.set(
            "syncpoints",
            t.syncPoints?.map((r) => Ii.toJson(r))
          ),
        t.fermata !== null)
      ) {
        let r = new Map();
        e.set("fermata", r);
        for (let [i, n] of t.fermata) r.set(i.toString(), qo.toJson(n));
      }
      if (
        (e.set("start", t.start),
        e.set("isanacrusis", t.isAnacrusis),
        e.set("displayscale", t.displayScale),
        e.set("displaywidth", t.displayWidth),
        t.directions !== null)
      ) {
        let r = [];
        e.set("directions", r);
        for (let i of t.directions) r.push(i);
      }
      return e;
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "alternateendings":
          return (t.alternateEndings = r), !0;
        case "isdoublebar":
          return (t.isDoubleBar = r), !0;
        case "isrepeatstart":
          return (t.isRepeatStart = r), !0;
        case "repeatcount":
          return (t.repeatCount = r), !0;
        case "timesignaturenumerator":
          return (t.timeSignatureNumerator = r), !0;
        case "timesignaturedenominator":
          return (t.timeSignatureDenominator = r), !0;
        case "timesignaturecommon":
          return (t.timeSignatureCommon = r), !0;
        case "isfreetime":
          return (t.isFreeTime = r), !0;
        case "tripletfeel":
          return (t.tripletFeel = _.parseEnum(r, Ct)), !0;
        case "section":
          return (
            r
              ? ((t.section = new vr()), Yo.fromJson(t.section, r))
              : (t.section = null),
            !0
          );
        case "tempoautomations":
          t.tempoAutomations = [];
          for (let i of r) {
            let n = new he();
            Ii.fromJson(n, i), t.tempoAutomations.push(n);
          }
          return !0;
        case "syncpoints":
          if (r) {
            t.syncPoints = [];
            for (let i of r) {
              let n = new he();
              Ii.fromJson(n, i), t.addSyncPoint(n);
            }
          }
          return !0;
        case "fermata":
          return (
            (t.fermata = new Map()),
            _.forEach(r, (i, n) => {
              let s = new kr();
              qo.fromJson(s, i), t.addFermata(Number.parseInt(n), s);
            }),
            !0
          );
        case "start":
          return (t.start = r), !0;
        case "isanacrusis":
          return (t.isAnacrusis = r), !0;
        case "displayscale":
          return (t.displayScale = r), !0;
        case "displaywidth":
          return (t.displayWidth = r), !0;
        case "directions":
          for (let i of r) t.addDirection(_.parseEnum(i, Kr));
          return !0;
      }
      return !1;
    }
  };
  var Xn = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return e.set("offset", t.offset), e.set("value", t.value), e;
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "offset":
          return (t.offset = r), !0;
        case "value":
          return (t.value = r), !0;
      }
      return !1;
    }
  };
  var Ko = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      e.set("notehead", t.noteHead),
        e.set("noteheadcenteronstem", t.noteHeadCenterOnStem);
      {
        let r = new Map();
        e.set("colors", r);
        for (let [i, n] of t.colors) r.set(i.toString(), ae.toJson(n));
      }
      return e;
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "notehead":
          return (t.noteHead = _.parseEnum(r, K)), !0;
        case "noteheadcenteronstem":
          return (t.noteHeadCenterOnStem = r), !0;
        case "colors":
          return (
            (t.colors = new Map()),
            _.forEach(r, (i, n) => {
              t.colors.set(_.parseEnum(n, qt), ae.fromJson(i));
            }),
            !0
          );
      }
      return !1;
    }
  };
  var Qo = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("id", t.id),
        e.set("accentuated", t.accentuated),
        e.set("bendtype", t.bendType),
        e.set("bendstyle", t.bendStyle),
        e.set("iscontinuedbend", t.isContinuedBend),
        t.bendPoints !== null &&
          e.set(
            "bendpoints",
            t.bendPoints?.map((r) => Xn.toJson(r))
          ),
        e.set("fret", t.fret),
        e.set("string", t.string),
        e.set("showstringnumber", t.showStringNumber),
        e.set("octave", t.octave),
        e.set("tone", t.tone),
        e.set("percussionarticulation", t.percussionArticulation),
        e.set("isvisible", t.isVisible),
        e.set("islefthandtapped", t.isLeftHandTapped),
        e.set("ishammerpullorigin", t.isHammerPullOrigin),
        e.set("isslurdestination", t.isSlurDestination),
        e.set("harmonictype", t.harmonicType),
        e.set("harmonicvalue", t.harmonicValue),
        e.set("isghost", t.isGhost),
        e.set("isletring", t.isLetRing),
        e.set("ispalmmute", t.isPalmMute),
        e.set("isdead", t.isDead),
        e.set("isdeadvisual", t.isDeadVisual),
        e.set("isstaccato", t.isStaccato),
        e.set("slideintype", t.slideInType),
        e.set("slideouttype", t.slideOutType),
        e.set("vibrato", t.vibrato),
        e.set("istiedestination", t.isTieDestination),
        e.set("lefthandfinger", t.leftHandFinger),
        e.set("righthandfinger", t.rightHandFinger),
        e.set("trillvalue", t.trillValue),
        e.set("trillspeed", t.trillSpeed),
        e.set("durationpercent", t.durationPercent),
        e.set("accidentalmode", t.accidentalMode),
        e.set("dynamics", t.dynamics),
        e.set("ornament", t.ornament),
        t.style && e.set("style", Ko.toJson(t.style)),
        t.toJson(e),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "id":
          return (t.id = r), !0;
        case "accentuated":
          return (t.accentuated = _.parseEnum(r, or)), !0;
        case "bendtype":
          return (t.bendType = _.parseEnum(r, fr)), !0;
        case "bendstyle":
          return (t.bendStyle = _.parseEnum(r, Pt)), !0;
        case "iscontinuedbend":
          return (t.isContinuedBend = r), !0;
        case "bendpoints":
          if (r) {
            t.bendPoints = [];
            for (let i of r) {
              let n = new I();
              Xn.fromJson(n, i), t.addBendPoint(n);
            }
          }
          return !0;
        case "fret":
          return (t.fret = r), !0;
        case "string":
          return (t.string = r), !0;
        case "showstringnumber":
          return (t.showStringNumber = r), !0;
        case "octave":
          return (t.octave = r), !0;
        case "tone":
          return (t.tone = r), !0;
        case "percussionarticulation":
          return (t.percussionArticulation = r), !0;
        case "isvisible":
          return (t.isVisible = r), !0;
        case "islefthandtapped":
          return (t.isLeftHandTapped = r), !0;
        case "ishammerpullorigin":
          return (t.isHammerPullOrigin = r), !0;
        case "isslurdestination":
          return (t.isSlurDestination = r), !0;
        case "harmonictype":
          return (t.harmonicType = _.parseEnum(r, Ht)), !0;
        case "harmonicvalue":
          return (t.harmonicValue = r), !0;
        case "isghost":
          return (t.isGhost = r), !0;
        case "isletring":
          return (t.isLetRing = r), !0;
        case "ispalmmute":
          return (t.isPalmMute = r), !0;
        case "isdead":
          return (t.isDead = r), !0;
        case "isdeadvisual":
          return (t.isDeadVisual = r), !0;
        case "isstaccato":
          return (t.isStaccato = r), !0;
        case "slideintype":
          return (t.slideInType = _.parseEnum(r, Ut)), !0;
        case "slideouttype":
          return (t.slideOutType = _.parseEnum(r, At)), !0;
        case "vibrato":
          return (t.vibrato = _.parseEnum(r, Ue)), !0;
        case "istiedestination":
          return (t.isTieDestination = r), !0;
        case "lefthandfinger":
          return (t.leftHandFinger = _.parseEnum(r, Ar)), !0;
        case "righthandfinger":
          return (t.rightHandFinger = _.parseEnum(r, Ar)), !0;
        case "trillvalue":
          return (t.trillValue = r), !0;
        case "trillspeed":
          return (t.trillSpeed = _.parseEnum(r, _e)), !0;
        case "durationpercent":
          return (t.durationPercent = r), !0;
        case "accidentalmode":
          return (t.accidentalMode = _.parseEnum(r, lr)), !0;
        case "dynamics":
          return (t.dynamics = _.parseEnum(r, st)), !0;
        case "ornament":
          return (t.ornament = _.parseEnum(r, Br)), !0;
        case "style":
          return (
            r
              ? ((t.style = new cn()), Ko.fromJson(t.style, r))
              : (t.style = void 0),
            !0
          );
      }
      return t.setProperty(e, r);
    }
  };
  var Zo = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      {
        let r = new Map();
        e.set("colors", r);
        for (let [i, n] of t.colors) r.set(i.toString(), ae.toJson(n));
      }
      return e;
    }
    static setProperty(t, e, r) {
      return e === "colors"
        ? ((t.colors = new Map()),
          _.forEach(r, (i, n) => {
            t.colors.set(_.parseEnum(n, Je), ae.fromJson(i));
          }),
          !0)
        : !1;
    }
  };
  var jo = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("id", t.id),
        e.set(
          "notes",
          t.notes.map((r) => Qo.toJson(r))
        ),
        e.set("isempty", t.isEmpty),
        e.set("whammystyle", t.whammyStyle),
        e.set("ottava", t.ottava),
        e.set("islegatoorigin", t.isLegatoOrigin),
        e.set("duration", t.duration),
        e.set(
          "automations",
          t.automations.map((r) => Ii.toJson(r))
        ),
        e.set("dots", t.dots),
        e.set("fade", t.fade),
        e.set("lyrics", t.lyrics),
        e.set("pop", t.pop),
        e.set("slap", t.slap),
        e.set("tap", t.tap),
        e.set("text", t.text),
        e.set("slashed", t.slashed),
        e.set("deadslapped", t.deadSlapped),
        e.set("brushtype", t.brushType),
        e.set("brushduration", t.brushDuration),
        e.set("tupletdenominator", t.tupletDenominator),
        e.set("tupletnumerator", t.tupletNumerator),
        e.set("iscontinuedwhammy", t.isContinuedWhammy),
        e.set("whammybartype", t.whammyBarType),
        t.whammyBarPoints !== null &&
          e.set(
            "whammybarpoints",
            t.whammyBarPoints?.map((r) => Xn.toJson(r))
          ),
        e.set("vibrato", t.vibrato),
        e.set("chordid", t.chordId),
        e.set("gracetype", t.graceType),
        e.set("pickstroke", t.pickStroke),
        e.set("tremolospeed", t.tremoloSpeed),
        e.set("crescendo", t.crescendo),
        e.set("displaystart", t.displayStart),
        e.set("playbackstart", t.playbackStart),
        e.set("displayduration", t.displayDuration),
        e.set("playbackduration", t.playbackDuration),
        e.set("overridedisplayduration", t.overrideDisplayDuration),
        e.set("golpe", t.golpe),
        e.set("dynamics", t.dynamics),
        e.set("invertbeamdirection", t.invertBeamDirection),
        e.set("preferredbeamdirection", t.preferredBeamDirection),
        e.set("beamingmode", t.beamingMode),
        e.set("wahpedal", t.wahPedal),
        e.set("barrefret", t.barreFret),
        e.set("barreshape", t.barreShape),
        e.set("rasgueado", t.rasgueado),
        e.set("showtimer", t.showTimer),
        e.set("timer", t.timer),
        t.style && e.set("style", Zo.toJson(t.style)),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "id":
          return (t.id = r), !0;
        case "notes":
          t.notes = [];
          for (let i of r) {
            let n = new Xe();
            Qo.fromJson(n, i), t.addNote(n);
          }
          return !0;
        case "isempty":
          return (t.isEmpty = r), !0;
        case "whammystyle":
          return (t.whammyStyle = _.parseEnum(r, Pt)), !0;
        case "ottava":
          return (t.ottava = _.parseEnum(r, Ze)), !0;
        case "islegatoorigin":
          return (t.isLegatoOrigin = r), !0;
        case "duration":
          return (t.duration = _.parseEnum(r, _e)), !0;
        case "automations":
          t.automations = [];
          for (let i of r) {
            let n = new he();
            Ii.fromJson(n, i), t.automations.push(n);
          }
          return !0;
        case "dots":
          return (t.dots = r), !0;
        case "fade":
          return (t.fade = _.parseEnum(r, Tr)), !0;
        case "lyrics":
          return (t.lyrics = r), !0;
        case "pop":
          return (t.pop = r), !0;
        case "slap":
          return (t.slap = r), !0;
        case "tap":
          return (t.tap = r), !0;
        case "text":
          return (t.text = r), !0;
        case "slashed":
          return (t.slashed = r), !0;
        case "deadslapped":
          return (t.deadSlapped = r), !0;
        case "brushtype":
          return (t.brushType = _.parseEnum(r, Wt)), !0;
        case "brushduration":
          return (t.brushDuration = r), !0;
        case "tupletdenominator":
          return (t.tupletDenominator = r), !0;
        case "tupletnumerator":
          return (t.tupletNumerator = r), !0;
        case "iscontinuedwhammy":
          return (t.isContinuedWhammy = r), !0;
        case "whammybartype":
          return (t.whammyBarType = _.parseEnum(r, Yr)), !0;
        case "whammybarpoints":
          if (r) {
            t.whammyBarPoints = [];
            for (let i of r) {
              let n = new I();
              Xn.fromJson(n, i), t.addWhammyBarPoint(n);
            }
          }
          return !0;
        case "vibrato":
          return (t.vibrato = _.parseEnum(r, Ue)), !0;
        case "chordid":
          return (t.chordId = r), !0;
        case "gracetype":
          return (t.graceType = _.parseEnum(r, Ce)), !0;
        case "pickstroke":
          return (t.pickStroke = _.parseEnum(r, dr)), !0;
        case "tremolospeed":
          return (t.tremoloSpeed = _.parseEnum(r, _e) ?? null), !0;
        case "crescendo":
          return (t.crescendo = _.parseEnum(r, br)), !0;
        case "displaystart":
          return (t.displayStart = r), !0;
        case "playbackstart":
          return (t.playbackStart = r), !0;
        case "displayduration":
          return (t.displayDuration = r), !0;
        case "playbackduration":
          return (t.playbackDuration = r), !0;
        case "overridedisplayduration":
          return (t.overrideDisplayDuration = r), !0;
        case "golpe":
          return (t.golpe = _.parseEnum(r, Jr)), !0;
        case "dynamics":
          return (t.dynamics = _.parseEnum(r, st)), !0;
        case "invertbeamdirection":
          return (t.invertBeamDirection = r), !0;
        case "preferredbeamdirection":
          return (t.preferredBeamDirection = _.parseEnum(r, Ne) ?? null), !0;
        case "beamingmode":
          return (t.beamingMode = _.parseEnum(r, Dr)), !0;
        case "wahpedal":
          return (t.wahPedal = _.parseEnum(r, Lr)), !0;
        case "barrefret":
          return (t.barreFret = r), !0;
        case "barreshape":
          return (t.barreShape = _.parseEnum(r, qr)), !0;
        case "rasgueado":
          return (t.rasgueado = _.parseEnum(r, $r)), !0;
        case "showtimer":
          return (t.showTimer = r), !0;
        case "timer":
          return (t.timer = r), !0;
        case "style":
          return (
            r
              ? ((t.style = new Ys()), Zo.fromJson(t.style, r))
              : (t.style = void 0),
            !0
          );
      }
      return !1;
    }
  };
  var el = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      {
        let r = new Map();
        e.set("colors", r);
        for (let [i, n] of t.colors) r.set(i.toString(), ae.toJson(n));
      }
      return e;
    }
    static setProperty(t, e, r) {
      return e === "colors"
        ? ((t.colors = new Map()),
          _.forEach(r, (i, n) => {
            t.colors.set(_.parseEnum(n, os), ae.fromJson(i));
          }),
          !0)
        : !1;
    }
  };
  var tl = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("id", t.id),
        e.set(
          "beats",
          t.beats.map((r) => jo.toJson(r))
        ),
        t.style && e.set("style", el.toJson(t.style)),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "id":
          return (t.id = r), !0;
        case "beats":
          t.beats = [];
          for (let i of r) {
            let n = new Me();
            jo.fromJson(n, i), t.addBeat(n);
          }
          return !0;
        case "style":
          return (
            r
              ? ((t.style = new Us()), el.fromJson(t.style, r))
              : (t.style = void 0),
            !0
          );
      }
      return !1;
    }
  };
  var rl = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("ratioposition", t.ratioPosition),
        e.set("pedaltype", t.pedalType),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "ratioposition":
          return (t.ratioPosition = r), !0;
        case "pedaltype":
          return (t.pedalType = _.parseEnum(r, _i)), !0;
      }
      return !1;
    }
  };
  var il = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      {
        let r = new Map();
        e.set("colors", r);
        for (let [i, n] of t.colors) r.set(i.toString(), ae.toJson(n));
      }
      return e;
    }
    static setProperty(t, e, r) {
      return e === "colors"
        ? ((t.colors = new Map()),
          _.forEach(r, (i, n) => {
            t.colors.set(_.parseEnum(n, Yt), ae.fromJson(i));
          }),
          !0)
        : !1;
    }
  };
  var nl = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("id", t.id),
        e.set("clef", t.clef),
        e.set("clefottava", t.clefOttava),
        e.set(
          "voices",
          t.voices.map((r) => tl.toJson(r))
        ),
        e.set("similemark", t.simileMark),
        e.set("displayscale", t.displayScale),
        e.set("displaywidth", t.displayWidth),
        e.set(
          "sustainpedals",
          t.sustainPedals.map((r) => rl.toJson(r))
        ),
        e.set("barlineleft", t.barLineLeft),
        e.set("barlineright", t.barLineRight),
        e.set("keysignature", t.keySignature),
        e.set("keysignaturetype", t.keySignatureType),
        t.style && e.set("style", il.toJson(t.style)),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "id":
          return (t.id = r), !0;
        case "clef":
          return (t.clef = _.parseEnum(r, yt)), !0;
        case "clefottava":
          return (t.clefOttava = _.parseEnum(r, Ze)), !0;
        case "voices":
          t.voices = [];
          for (let i of r) {
            let n = new ze();
            tl.fromJson(n, i), t.addVoice(n);
          }
          return !0;
        case "similemark":
          return (t.simileMark = _.parseEnum(r, ur)), !0;
        case "displayscale":
          return (t.displayScale = r), !0;
        case "displaywidth":
          return (t.displayWidth = r), !0;
        case "sustainpedals":
          t.sustainPedals = [];
          for (let i of r) {
            let n = new Xt();
            rl.fromJson(n, i), t.sustainPedals.push(n);
          }
          return !0;
        case "barlineleft":
          return (t.barLineLeft = _.parseEnum(r, cr)), !0;
        case "barlineright":
          return (t.barLineRight = _.parseEnum(r, cr)), !0;
        case "keysignature":
          return (t.keySignature = _.parseEnum(r, zr)), !0;
        case "keysignaturetype":
          return (t.keySignatureType = _.parseEnum(r, Sr)), !0;
        case "style":
          return (
            r
              ? ((t.style = new Hs()), il.fromJson(t.style, r))
              : (t.style = void 0),
            !0
          );
      }
      return !1;
    }
  };
  var sl = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("name", t.name),
        e.set("firstfret", t.firstFret),
        e.set("strings", t.strings),
        e.set("barrefrets", t.barreFrets),
        e.set("showname", t.showName),
        e.set("showdiagram", t.showDiagram),
        e.set("showfingering", t.showFingering),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "name":
          return (t.name = r), !0;
        case "firstfret":
          return (t.firstFret = r), !0;
        case "strings":
          return (t.strings = r), !0;
        case "barrefrets":
          return (t.barreFrets = r), !0;
        case "showname":
          return (t.showName = r), !0;
        case "showdiagram":
          return (t.showDiagram = r), !0;
        case "showfingering":
          return (t.showFingering = r), !0;
      }
      return !1;
    }
  };
  var al = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("isstandard", t.isStandard),
        e.set("name", t.name),
        e.set("tunings", t.tunings),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "isstandard":
          return (t.isStandard = r), !0;
        case "name":
          return (t.name = r), !0;
        case "tunings":
          return (t.tunings = r), !0;
      }
      return !1;
    }
  };
  var ol = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      if (
        (e.set(
          "bars",
          t.bars.map((r) => nl.toJson(r))
        ),
        t.chords !== null)
      ) {
        let r = new Map();
        e.set("chords", r);
        for (let [i, n] of t.chords) r.set(i.toString(), sl.toJson(n));
      }
      return (
        e.set("capo", t.capo),
        e.set("transpositionpitch", t.transpositionPitch),
        e.set("displaytranspositionpitch", t.displayTranspositionPitch),
        e.set("stringtuning", al.toJson(t.stringTuning)),
        e.set("showslash", t.showSlash),
        e.set("shownumbered", t.showNumbered),
        e.set("showtablature", t.showTablature),
        e.set("showstandardnotation", t.showStandardNotation),
        e.set("ispercussion", t.isPercussion),
        e.set("standardnotationlinecount", t.standardNotationLineCount),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "bars":
          t.bars = [];
          for (let i of r) {
            let n = new at();
            nl.fromJson(n, i), t.addBar(n);
          }
          return !0;
        case "chords":
          return (
            (t.chords = new Map()),
            _.forEach(r, (i, n) => {
              let s = new Bt();
              sl.fromJson(s, i), t.addChord(n, s);
            }),
            !0
          );
        case "capo":
          return (t.capo = r), !0;
        case "transpositionpitch":
          return (t.transpositionPitch = r), !0;
        case "displaytranspositionpitch":
          return (t.displayTranspositionPitch = r), !0;
        case "stringtuning":
          return al.fromJson(t.stringTuning, r), !0;
        case "showslash":
          return (t.showSlash = r), !0;
        case "shownumbered":
          return (t.showNumbered = r), !0;
        case "showtablature":
          return (t.showTablature = r), !0;
        case "showstandardnotation":
          return (t.showStandardNotation = r), !0;
        case "ispercussion":
          return (t.isPercussion = r), !0;
        case "standardnotationlinecount":
          return (t.standardNotationLineCount = r), !0;
      }
      return !1;
    }
  };
  var ll = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("volume", t.volume),
        e.set("balance", t.balance),
        e.set("port", t.port),
        e.set("program", t.program),
        e.set("bank", t.bank),
        e.set("primarychannel", t.primaryChannel),
        e.set("secondarychannel", t.secondaryChannel),
        e.set("ismute", t.isMute),
        e.set("issolo", t.isSolo),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "volume":
          return (t.volume = r), !0;
        case "balance":
          return (t.balance = r), !0;
        case "port":
          return (t.port = r), !0;
        case "program":
          return (t.program = r), !0;
        case "bank":
          return (t.bank = r), !0;
        case "primarychannel":
          return (t.primaryChannel = r), !0;
        case "secondarychannel":
          return (t.secondaryChannel = r), !0;
        case "ismute":
          return (t.isMute = r), !0;
        case "issolo":
          return (t.isSolo = r), !0;
      }
      return !1;
    }
  };
  var ul = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("elementtype", t.elementType),
        e.set("staffline", t.staffLine),
        e.set("noteheaddefault", t.noteHeadDefault),
        e.set("noteheadhalf", t.noteHeadHalf),
        e.set("noteheadwhole", t.noteHeadWhole),
        e.set("techniquesymbol", t.techniqueSymbol),
        e.set("techniquesymbolplacement", t.techniqueSymbolPlacement),
        e.set("outputmidinumber", t.outputMidiNumber),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "elementtype":
          return (t.elementType = r), !0;
        case "staffline":
          return (t.staffLine = r), !0;
        case "noteheaddefault":
          return (t.noteHeadDefault = _.parseEnum(r, K)), !0;
        case "noteheadhalf":
          return (t.noteHeadHalf = _.parseEnum(r, K)), !0;
        case "noteheadwhole":
          return (t.noteHeadWhole = _.parseEnum(r, K)), !0;
        case "techniquesymbol":
          return (t.techniqueSymbol = _.parseEnum(r, K)), !0;
        case "techniquesymbolplacement":
          return (t.techniqueSymbolPlacement = _.parseEnum(r, xi)), !0;
        case "outputmidinumber":
          return (t.outputMidiNumber = r), !0;
      }
      return !1;
    }
  };
  var cl = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      {
        let r = new Map();
        e.set("colors", r);
        for (let [i, n] of t.colors) r.set(i.toString(), ae.toJson(n));
      }
      return e;
    }
    static setProperty(t, e, r) {
      return e === "colors"
        ? ((t.colors = new Map()),
          _.forEach(r, (i, n) => {
            t.colors.set(_.parseEnum(n, fn), ae.fromJson(i));
          }),
          !0)
        : !1;
    }
  };
  var dl = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      if (
        (e.set(
          "staves",
          t.staves.map((r) => ol.toJson(r))
        ),
        e.set("playbackinfo", ll.toJson(t.playbackInfo)),
        e.set("color", ae.toJson(t.color)),
        e.set("name", t.name),
        e.set("isvisibleonmultitrack", t.isVisibleOnMultiTrack),
        e.set("shortname", t.shortName),
        e.set("defaultsystemslayout", t.defaultSystemsLayout),
        e.set("systemslayout", t.systemsLayout),
        t.lineBreaks !== void 0)
      ) {
        let r = [];
        e.set("linebreaks", r);
        for (let i of t.lineBreaks) r.push(i);
      }
      return (
        e.set(
          "percussionarticulations",
          t.percussionArticulations.map((r) => ul.toJson(r))
        ),
        t.style && e.set("style", cl.toJson(t.style)),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "staves":
          t.staves = [];
          for (let i of r) {
            let n = new _r();
            ol.fromJson(n, i), t.addStaff(n);
          }
          return !0;
        case "playbackinfo":
          return ll.fromJson(t.playbackInfo, r), !0;
        case "color":
          return (t.color = ae.fromJson(r)), !0;
        case "name":
          return (t.name = r), !0;
        case "isvisibleonmultitrack":
          return (t.isVisibleOnMultiTrack = r), !0;
        case "shortname":
          return (t.shortName = r), !0;
        case "defaultsystemslayout":
          return (t.defaultSystemsLayout = r), !0;
        case "systemslayout":
          return (t.systemsLayout = r), !0;
        case "linebreaks":
          for (let i of r) t.addLineBreaks(i);
          return !0;
        case "percussionarticulations":
          t.percussionArticulations = [];
          for (let i of r) {
            let n = new W();
            ul.fromJson(n, i), t.percussionArticulations.push(n);
          }
          return !0;
        case "style":
          return (
            r
              ? ((t.style = new Ks()), cl.fromJson(t.style, r))
              : (t.style = void 0),
            !0
          );
      }
      return !1;
    }
  };
  var pl = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      if (
        (e.set("hidedynamics", t.hideDynamics),
        e.set("bracketextendmode", t.bracketExtendMode),
        e.set("usesystemsignseparator", t.useSystemSignSeparator),
        e.set("globaldisplaytuning", t.globalDisplayTuning),
        t.perTrackDisplayTuning !== null)
      ) {
        let r = new Map();
        e.set("pertrackdisplaytuning", r);
        for (let [i, n] of t.perTrackDisplayTuning) r.set(i.toString(), n);
      }
      if (
        (e.set(
          "globaldisplaychorddiagramsontop",
          t.globalDisplayChordDiagramsOnTop
        ),
        t.perTrackChordDiagramsOnTop !== null)
      ) {
        let r = new Map();
        e.set("pertrackchorddiagramsontop", r);
        for (let [i, n] of t.perTrackChordDiagramsOnTop) r.set(i.toString(), n);
      }
      if (
        (e.set("singletracktracknamepolicy", t.singleTrackTrackNamePolicy),
        e.set("multitracktracknamepolicy", t.multiTrackTrackNamePolicy),
        e.set("firstsystemtracknamemode", t.firstSystemTrackNameMode),
        e.set("othersystemstracknamemode", t.otherSystemsTrackNameMode),
        e.set(
          "firstsystemtracknameorientation",
          t.firstSystemTrackNameOrientation
        ),
        e.set(
          "othersystemstracknameorientation",
          t.otherSystemsTrackNameOrientation
        ),
        e.set("multitrackmultibarrest", t.multiTrackMultiBarRest),
        t.perTrackMultiBarRest !== null)
      ) {
        let r = [];
        e.set("pertrackmultibarrest", r);
        for (let i of t.perTrackMultiBarRest) r.push(i);
      }
      return e;
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "hidedynamics":
          return (t.hideDynamics = r), !0;
        case "bracketextendmode":
          return (t.bracketExtendMode = _.parseEnum(r, ln)), !0;
        case "usesystemsignseparator":
          return (t.useSystemSignSeparator = r), !0;
        case "globaldisplaytuning":
          return (t.globalDisplayTuning = r), !0;
        case "pertrackdisplaytuning":
          return (
            (t.perTrackDisplayTuning = new Map()),
            _.forEach(r, (i, n) => {
              t.perTrackDisplayTuning.set(Number.parseInt(n), i);
            }),
            !0
          );
        case "globaldisplaychorddiagramsontop":
          return (t.globalDisplayChordDiagramsOnTop = r), !0;
        case "pertrackchorddiagramsontop":
          return (
            (t.perTrackChordDiagramsOnTop = new Map()),
            _.forEach(r, (i, n) => {
              t.perTrackChordDiagramsOnTop.set(Number.parseInt(n), i);
            }),
            !0
          );
        case "singletracktracknamepolicy":
          return (t.singleTrackTrackNamePolicy = _.parseEnum(r, Ti)), !0;
        case "multitracktracknamepolicy":
          return (t.multiTrackTrackNamePolicy = _.parseEnum(r, Ti)), !0;
        case "firstsystemtracknamemode":
          return (t.firstSystemTrackNameMode = _.parseEnum(r, ki)), !0;
        case "othersystemstracknamemode":
          return (t.otherSystemsTrackNameMode = _.parseEnum(r, ki)), !0;
        case "firstsystemtracknameorientation":
          return (t.firstSystemTrackNameOrientation = _.parseEnum(r, vi)), !0;
        case "othersystemstracknameorientation":
          return (t.otherSystemsTrackNameOrientation = _.parseEnum(r, vi)), !0;
        case "multitrackmultibarrest":
          return (t.multiTrackMultiBarRest = r), !0;
        case "pertrackmultibarrest":
          return (t.perTrackMultiBarRest = new Set(r)), !0;
      }
      return !1;
    }
  };
  var hl = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      return t ? new Map() : null;
    }
    static setProperty(t, e, r) {
      return !1;
    }
  };
  var ml = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("template", t.template),
        e.set("isvisible", t.isVisible),
        e.set("textalign", t.textAlign),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "template":
          return (t.template = r), !0;
        case "isvisible":
          return (t.isVisible = r), !0;
        case "textalign":
          return (t.textAlign = _.parseEnum(r, xe)), !0;
      }
      return !1;
    }
  };
  var fl = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      {
        let r = new Map();
        e.set("headerandfooter", r);
        for (let [i, n] of t.headerAndFooter) r.set(i.toString(), ml.toJson(n));
      }
      {
        let r = new Map();
        e.set("colors", r);
        for (let [i, n] of t.colors) r.set(i.toString(), ae.toJson(n));
      }
      return e;
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "headerandfooter":
          return (
            (t.headerAndFooter = new Map()),
            _.forEach(r, (i, n) => {
              let s = new ct();
              ml.fromJson(s, i), t.headerAndFooter.set(_.parseEnum(n, Mr), s);
            }),
            !0
          );
        case "colors":
          return (
            (t.colors = new Map()),
            _.forEach(r, (i, n) => {
              t.colors.set(_.parseEnum(n, Mr), ae.fromJson(i));
            }),
            !0
          );
      }
      return !1;
    }
  };
  var bl = class p {
    static fromJson(t, e) {
      e && _.forEach(e, (r, i) => p.setProperty(t, i, r));
    }
    static toJson(t) {
      if (!t) return null;
      let e = new Map();
      return (
        e.set("album", t.album),
        e.set("artist", t.artist),
        e.set("copyright", t.copyright),
        e.set("instructions", t.instructions),
        e.set("music", t.music),
        e.set("notices", t.notices),
        e.set("subtitle", t.subTitle),
        e.set("title", t.title),
        e.set("words", t.words),
        e.set("tab", t.tab),
        e.set(
          "masterbars",
          t.masterBars.map((r) => $o.toJson(r))
        ),
        e.set(
          "tracks",
          t.tracks.map((r) => dl.toJson(r))
        ),
        e.set("defaultsystemslayout", t.defaultSystemsLayout),
        e.set("systemslayout", t.systemsLayout),
        e.set("stylesheet", pl.toJson(t.stylesheet)),
        t.backingTrack && e.set("backingtrack", hl.toJson(t.backingTrack)),
        t.style && e.set("style", fl.toJson(t.style)),
        e
      );
    }
    static setProperty(t, e, r) {
      switch (e) {
        case "album":
          return (t.album = r), !0;
        case "artist":
          return (t.artist = r), !0;
        case "copyright":
          return (t.copyright = r), !0;
        case "instructions":
          return (t.instructions = r), !0;
        case "music":
          return (t.music = r), !0;
        case "notices":
          return (t.notices = r), !0;
        case "subtitle":
          return (t.subTitle = r), !0;
        case "title":
          return (t.title = r), !0;
        case "words":
          return (t.words = r), !0;
        case "tab":
          return (t.tab = r), !0;
        case "masterbars":
          t.masterBars = [];
          for (let i of r) {
            let n = new ot();
            $o.fromJson(n, i), t.addMasterBar(n);
          }
          return !0;
        case "tracks":
          t.tracks = [];
          for (let i of r) {
            let n = new Tt();
            dl.fromJson(n, i), t.addTrack(n);
          }
          return !0;
        case "defaultsystemslayout":
          return (t.defaultSystemsLayout = r), !0;
        case "systemslayout":
          return (t.systemsLayout = r), !0;
        case "stylesheet":
          return pl.fromJson(t.stylesheet, r), !0;
        case "backingtrack":
          return (
            r
              ? ((t.backingTrack = new vn()), hl.fromJson(t.backingTrack, r))
              : (t.backingTrack = void 0),
            !0
          );
        case "style":
          return (
            r
              ? ((t.style = new Jt()), fl.fromJson(t.style, r))
              : (t.style = void 0),
            !0
          );
      }
      return !1;
    }
  };
  var $e = class p {
    static _jsonReplacer(t, e) {
      if (e instanceof Map) {
        if ("fromEntries" in Object) return Object.fromEntries(e);
        let r = {};
        for (let [i, n] of e) r[i] = n;
        return r;
      }
      return ArrayBuffer.isView(e) ? Array.apply([], [e]) : e;
    }
    static scoreToJson(t) {
      let e = p.scoreToJsObject(t);
      return JSON.stringify(e, p._jsonReplacer);
    }
    static jsonToScore(t, e) {
      return p.jsObjectToScore(JSON.parse(t), e);
    }
    static scoreToJsObject(t) {
      return bl.toJson(t);
    }
    static jsObjectToScore(t, e) {
      let r = new tt();
      return bl.fromJson(r, t), r.finish(e ?? new kt()), r;
    }
    static settingsToJson(t) {
      let e = p.settingsToJsObject(t);
      return JSON.stringify(e, p._jsonReplacer);
    }
    static jsonToSettings(t) {
      return p.jsObjectToSettings(JSON.parse(t));
    }
    static settingsToJsObject(t) {
      return Gr.toJson(t);
    }
    static jsObjectToSettings(t) {
      let e = new kt();
      return Gr.fromJson(e, t), e;
    }
    static jsObjectToMidiFile(t) {
      let e = new Ft();
      return (
        _.forEach(t, (r, i) => {
          switch (i) {
            case "division":
              e.division = r;
              break;
            case "tracks":
              for (let n of r) {
                let s = p._jsObjectToMidiTrack(n);
                e.tracks.push(s);
              }
              break;
          }
        }),
        e
      );
    }
    static _jsObjectToMidiTrack(t) {
      let e = new bs();
      return (
        _.forEach(t, (r, i) => {
          switch (i) {
            case "events":
              for (let n of r) {
                let s = p.jsObjectToMidiEvent(n);
                e.events.push(s);
              }
              break;
          }
        }),
        e
      );
    }
    static jsObjectToMidiEvent(t) {
      let e = _.getValue(t, "track"),
        r = _.getValue(t, "tick"),
        i = _.getValue(t, "type");
      switch (i) {
        case 88:
          return new Nn(
            e,
            r,
            _.getValue(t, "numerator"),
            _.getValue(t, "denominatorIndex"),
            _.getValue(t, "midiClocksPerMetronomeClick"),
            _.getValue(t, "thirdySecondNodesInQuarter")
          );
        case 241:
          return new An(e, r, _.getValue(t, "channel"));
        case 242:
          return new Pn(
            e,
            r,
            _.getValue(t, "metronomeNumerator"),
            _.getValue(t, "metronomeDurationInTicks"),
            _.getValue(t, "metronomeDurationInMilliseconds")
          );
        case 128:
          return new Cn(
            e,
            r,
            _.getValue(t, "channel"),
            _.getValue(t, "noteKey"),
            _.getValue(t, "noteVelocity")
          );
        case 144:
          return new Mn(
            e,
            r,
            _.getValue(t, "channel"),
            _.getValue(t, "noteKey"),
            _.getValue(t, "noteVelocity")
          );
        case 176:
          return new In(
            e,
            r,
            _.getValue(t, "channel"),
            _.getValue(t, "controller"),
            _.getValue(t, "value")
          );
        case 192:
          return new Ln(
            e,
            r,
            _.getValue(t, "channel"),
            _.getValue(t, "program")
          );
        case 81:
          let n = new Dn(r, 0);
          return (n.beatsPerMinute = _.getValue(t, "beatsPerMinute")), n;
        case 224:
          return new Fn(e, r, _.getValue(t, "channel"), _.getValue(t, "value"));
        case 96:
          return new Rn(
            e,
            r,
            _.getValue(t, "channel"),
            _.getValue(t, "noteKey"),
            _.getValue(t, "value")
          );
        case 47:
          return new On(e, r);
      }
      throw new te(1, `Unknown Midi Event type: ${i}`);
    }
    static midiFileToJsObject(t) {
      let e = new Map();
      e.set("division", t.division);
      let r = [];
      for (let i of t.tracks) r.push(p._midiTrackToJsObject(i));
      return e.set("tracks", r), e;
    }
    static _midiTrackToJsObject(t) {
      let e = new Map(),
        r = [];
      for (let i of t.events) r.push(p.midiEventToJsObject(i));
      return e.set("events", r), e;
    }
    static midiEventToJsObject(t) {
      let e = new Map();
      switch (
        (e.set("track", t.track),
        e.set("tick", t.tick),
        e.set("type", t.type),
        t.type)
      ) {
        case 88:
          e.set("numerator", t.numerator),
            e.set("denominatorIndex", t.denominatorIndex),
            e.set("midiClocksPerMetronomeClick", t.midiClocksPerMetronomeClick),
            e.set("thirdySecondNodesInQuarter", t.thirtySecondNodesInQuarter);
          break;
        case 241:
          e.set("channel", t.channel);
          break;
        case 242:
          e.set("metronomeNumerator", t.metronomeNumerator),
            e.set(
              "metronomeDurationInMilliseconds",
              t.metronomeDurationInMilliseconds
            ),
            e.set("metronomeDurationInTicks", t.metronomeDurationInTicks);
          break;
        case 128:
        case 144:
          e.set("channel", t.channel),
            e.set("noteKey", t.noteKey),
            e.set("noteVelocity", t.noteVelocity);
          break;
        case 176:
          e.set("channel", t.channel),
            e.set("controller", t.controller),
            e.set("value", t.value);
          break;
        case 192:
          e.set("channel", t.channel), e.set("program", t.program);
          break;
        case 81:
          e.set("beatsPerMinute", t.beatsPerMinute);
          break;
        case 224:
          e.set("channel", t.channel), e.set("value", t.value);
          break;
        case 96:
          e.set("channel", t.channel),
            e.set("noteKey", t.noteKey),
            e.set("value", t.value);
          break;
        case 47:
          break;
      }
      return e;
    }
  };
  var Yu = class p {
    constructor(t, e) {
      this._exporter = new Map();
      (this._main = t),
        this._main.addEventListener("message", this.handleMessage.bind(this)),
        (this._player = new la(new jt(), e)),
        this._player.positionChanged.on(this.onPositionChanged.bind(this)),
        this._player.stateChanged.on(this.onPlayerStateChanged.bind(this)),
        this._player.finished.on(this.onFinished.bind(this)),
        this._player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),
        this._player.soundFontLoadFailed.on(
          this.onSoundFontLoadFailed.bind(this)
        ),
        this._player.soundFontLoadFailed.on(
          this.onSoundFontLoadFailed.bind(this)
        ),
        this._player.midiLoaded.on(this.onMidiLoaded.bind(this)),
        this._player.midiLoadFailed.on(this.onMidiLoadFailed.bind(this)),
        this._player.readyForPlayback.on(this.onReadyForPlayback.bind(this)),
        this._player.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),
        this._player.playbackRangeChanged.on(
          this.onPlaybackRangeChanged.bind(this)
        ),
        this._main.postMessage({ cmd: "alphaSynth.ready" });
    }
    static init() {
      let t = J.globalThis;
      t.addEventListener("message", (e) => {
        let r = e.data;
        r.cmd === "alphaSynth.initialize" &&
          ((jt.preferredSampleRate = r.sampleRate),
          (w.logLevel = r.logLevel),
          (J.globalThis.alphaSynthWebWorker = new p(
            t,
            r.bufferTimeInMilliseconds
          )));
      });
    }
    handleMessage(t) {
      let e = t.data,
        r = e.cmd;
      switch (r) {
        case "alphaSynth.setLogLevel":
          w.logLevel = e.value;
          break;
        case "alphaSynth.setMasterVolume":
          this._player.masterVolume = e.value;
          break;
        case "alphaSynth.setMetronomeVolume":
          this._player.metronomeVolume = e.value;
          break;
        case "alphaSynth.setPlaybackSpeed":
          this._player.playbackSpeed = e.value;
          break;
        case "alphaSynth.setTickPosition":
          this._player.tickPosition = e.value;
          break;
        case "alphaSynth.setTimePosition":
          this._player.timePosition = e.value;
          break;
        case "alphaSynth.setPlaybackRange":
          this._player.playbackRange = e.value;
          break;
        case "alphaSynth.setIsLooping":
          this._player.isLooping = e.value;
          break;
        case "alphaSynth.setCountInVolume":
          this._player.countInVolume = e.value;
          break;
        case "alphaSynth.setMidiEventsPlayedFilter":
          this._player.midiEventsPlayedFilter = e.value;
          break;
        case "alphaSynth.play":
          this._player.play();
          break;
        case "alphaSynth.pause":
          this._player.pause();
          break;
        case "alphaSynth.playPause":
          this._player.playPause();
          break;
        case "alphaSynth.stop":
          this._player.stop();
          break;
        case "alphaSynth.playOneTimeMidiFile":
          this._player.playOneTimeMidiFile($e.jsObjectToMidiFile(e.midi));
          break;
        case "alphaSynth.loadSoundFontBytes":
          this._player.loadSoundFont(e.data, e.append);
          break;
        case "alphaSynth.resetSoundFonts":
          this._player.resetSoundFonts();
          break;
        case "alphaSynth.loadMidi":
          this._player.loadMidiFile($e.jsObjectToMidiFile(e.midi));
          break;
        case "alphaSynth.setChannelMute":
          this._player.setChannelMute(e.channel, e.mute);
          break;
        case "alphaSynth.setChannelTranspositionPitch":
          this._player.setChannelTranspositionPitch(e.channel, e.semitones);
          break;
        case "alphaSynth.setChannelSolo":
          this._player.setChannelSolo(e.channel, e.solo);
          break;
        case "alphaSynth.setChannelVolume":
          this._player.setChannelVolume(e.channel, e.volume);
          break;
        case "alphaSynth.resetChannelStates":
          this._player.resetChannelStates();
          break;
        case "alphaSynth.destroy":
          this._player.destroy(),
            this._main.postMessage({ cmd: "alphaSynth.destroyed" });
          break;
        case "alphaSynth.applyTranspositionPitches":
          this._player.applyTranspositionPitches(
            new Map(JSON.parse(e.transpositionPitches))
          );
          break;
      }
      r.startsWith("alphaSynth.exporter") && this._handleExporterMessage(t);
    }
    _handleExporterMessage(t) {
      let e = t.data,
        r = e.cmd;
      try {
        switch (r) {
          case "alphaSynth.exporter.initialize":
            let i = this._player.exportAudio(
              e.options,
              $e.jsObjectToMidiFile(e.midi),
              e.syncPoints,
              e.transpositionPitches
            );
            this._exporter.set(e.exporterId, i),
              this._main.postMessage({
                cmd: "alphaSynth.exporter.initialized",
                exporterId: e.exporterId,
              });
            break;
          case "alphaSynth.exporter.render":
            if (this._exporter.has(e.exporterId)) {
              let s = this._exporter.get(e.exporterId).render(e.milliseconds);
              this._main.postMessage({
                cmd: "alphaSynth.exporter.rendered",
                exporterId: e.exporterId,
                chunk: s,
              });
            } else
              this._main.postMessage({
                cmd: "alphaSynth.exporter.error",
                exporterId: e.exporterId,
                error: new Error("Unknown exporter ID"),
              });
            break;
          case "alphaSynth.exporter.destroy":
            this._exporter.delete(e.exporterId);
            break;
        }
      } catch (i) {
        this._main.postMessage({
          cmd: "alphaSynth.exporter.error",
          exporterId: e.exporterId,
          error: i,
        });
      }
    }
    onPositionChanged(t) {
      this._main.postMessage({
        cmd: "alphaSynth.positionChanged",
        currentTime: t.currentTime,
        endTime: t.endTime,
        currentTick: t.currentTick,
        endTick: t.endTick,
        isSeek: t.isSeek,
        originalTempo: t.originalTempo,
        modifiedTempo: t.modifiedTempo,
      });
    }
    onPlayerStateChanged(t) {
      this._main.postMessage({
        cmd: "alphaSynth.playerStateChanged",
        state: t.state,
        stopped: t.stopped,
      });
    }
    onFinished() {
      this._main.postMessage({ cmd: "alphaSynth.finished" });
    }
    onSoundFontLoaded() {
      this._main.postMessage({ cmd: "alphaSynth.soundFontLoaded" });
    }
    onSoundFontLoadFailed(t) {
      this._main.postMessage({
        cmd: "alphaSynth.soundFontLoadFailed",
        error: this._serializeException(J.prepareForPostMessage(t)),
      });
    }
    _serializeException(t) {
      let e = JSON.parse(JSON.stringify(t));
      return (
        t.message && (e.message = t.message),
        t.stack && (e.stack = t.stack),
        t.constructor && t.constructor.name && (e.type = t.constructor.name),
        e
      );
    }
    onMidiLoaded(t) {
      this._main.postMessage({
        cmd: "alphaSynth.midiLoaded",
        currentTime: t.currentTime,
        endTime: t.endTime,
        currentTick: t.currentTick,
        endTick: t.endTick,
        isSeek: t.isSeek,
        originalTempo: t.originalTempo,
        modifiedTempo: t.modifiedTempo,
      });
    }
    onMidiLoadFailed(t) {
      this._main.postMessage({
        cmd: "alphaSynth.midiLoaded",
        error: this._serializeException(J.prepareForPostMessage(t)),
      });
    }
    onReadyForPlayback() {
      this._main.postMessage({ cmd: "alphaSynth.readyForPlayback" });
    }
    onMidiEventsPlayed(t) {
      this._main.postMessage({
        cmd: "alphaSynth.midiEventsPlayed",
        events: t.events.map($e.midiEventToJsObject),
      });
    }
    onPlaybackRangeChanged(t) {
      this._main.postMessage({
        cmd: "alphaSynth.playbackRangeChanged",
        playbackRange: t.playbackRange,
      });
    }
  };
  var Yn = ((r) => (
    (r[(r.Browser = 0)] = "Browser"),
    (r[(r.NodeJs = 1)] = "NodeJs"),
    (r[(r.BrowserModule = 2)] = "BrowserModule"),
    r
  ))(Yn || {});
  var Na = class {
      constructor(t, e) {
        (this.characterWidths = t), (this.characterHeights = e);
      }
    },
    Vr = class Vr {
      static generateFontLookup(t) {
        if (!Vr.fontSizeLookupTables.has(t))
          if (!J.isRunningInWorker && J.webPlatform !== 1) {
            let r = document.createElement("canvas").getContext("2d"),
              i = 11;
            r.font = `${i}px ${t}`;
            let n = [],
              s = [];
            for (let o = Vr.ControlChars; o < 255; o++) {
              let l = String.fromCharCode(o),
                u = r.measureText(l);
              n.push(u.width);
              let c = u.actualBoundingBoxDescent + u.actualBoundingBoxAscent;
              s.push(c);
            }
            let a = new Na(new Uint8Array(n), new Uint8Array(s));
            Vr.fontSizeLookupTables.set(t, a);
          } else {
            let e = new Na(new Uint8Array([8]), new Uint8Array([10]));
            Vr.fontSizeLookupTables.set(t, e);
          }
      }
      static measureString(t, e, r, i, n) {
        let s,
          o = e[0];
        for (let d = 0; d < e.length; d++)
          if (Vr.fontSizeLookupTables.has(e[d])) {
            o = e[d];
            break;
          }
        Vr.fontSizeLookupTables.has(o) || Vr.generateFontLookup(o),
          (s = Vr.fontSizeLookupTables.get(o));
        let l = 1;
        i === 1 && (l *= 1.1), n === 1 && (l *= 1.1);
        let u = 0,
          c = 0;
        for (let d = 0; d < t.length; d++) {
          let h = Math.min(
            s.characterWidths.length - 1,
            t.charCodeAt(d) - Vr.ControlChars
          );
          h >= 0 &&
            ((u += (s.characterWidths[h] * r) / 11),
            (c = Math.max(c, (s.characterHeights[h] * r) / 11)));
        }
        return (l *= 1.07), new Xr(u * l, c);
      }
    };
  (Vr.fontSizeLookupTables = new Map()), (Vr.ControlChars = 32);
  var ti = Vr;
  var Ju = class p {
    constructor(t) {
      (this._main = t),
        this._main.addEventListener(
          "message",
          this._handleMessage.bind(this),
          !1
        );
    }
    static init() {
      J.globalThis.alphaTabWebWorker = new p(J.globalThis);
    }
    _handleMessage(t) {
      let e = t.data;
      switch (e ? e.cmd : "") {
        case "alphaTab.initialize":
          let i = $e.jsObjectToSettings(e.settings);
          (w.logLevel = i.core.logLevel),
            (this._renderer = new ui(i)),
            this._renderer.partialRenderFinished.on((s) => {
              this._main.postMessage({
                cmd: "alphaTab.partialRenderFinished",
                result: s,
              });
            }),
            this._renderer.partialLayoutFinished.on((s) => {
              this._main.postMessage({
                cmd: "alphaTab.partialLayoutFinished",
                result: s,
              });
            }),
            this._renderer.renderFinished.on((s) => {
              this._main.postMessage({
                cmd: "alphaTab.renderFinished",
                result: s,
              });
            }),
            this._renderer.postRenderFinished.on(() => {
              this._main.postMessage({
                cmd: "alphaTab.postRenderFinished",
                boundsLookup: this._renderer.boundsLookup?.toJson() ?? null,
              });
            }),
            this._renderer.preRender.on((s) => {
              this._main.postMessage({ cmd: "alphaTab.preRender", resize: s });
            }),
            this._renderer.error.on(this._error.bind(this));
          break;
        case "alphaTab.invalidate":
          this._renderer.render();
          break;
        case "alphaTab.resizeRender":
          this._renderer.resizeRender();
          break;
        case "alphaTab.renderResult":
          this._renderer.renderResult(e.resultId);
          break;
        case "alphaTab.setWidth":
          this._renderer.width = e.width;
          break;
        case "alphaTab.renderScore":
          this._updateFontSizes(e.fontSizes);
          let n =
            e.score == null
              ? null
              : $e.jsObjectToScore(e.score, this._renderer.settings);
          this._renderMultiple(n, e.trackIndexes);
          break;
        case "alphaTab.updateSettings":
          this._updateSettings(e.settings);
          break;
      }
    }
    _updateFontSizes(t) {
      if (!(t instanceof Map)) {
        let e = t;
        t = new Map();
        for (let r in e) t.set(r, e[r]);
      }
      if (t) for (let [e, r] of t) ti.fontSizeLookupTables.set(e, r);
    }
    _updateSettings(t) {
      Gr.fromJson(this._renderer.settings, t);
    }
    _renderMultiple(t, e) {
      try {
        this._renderer.renderScore(t, e);
      } catch (r) {
        this._error(r);
      }
    }
    _error(t) {
      w.error("Worker", "An unexpected error occurred in worker", t),
        this._main.postMessage({ cmd: "alphaTab.error", error: t });
    }
  };
  var qu = class {
    constructor() {
      this._canvas = null;
      this._color = new ae(0, 0, 0, 255);
      this._font = new ne("Arial", 10, 0);
      this._lineWidth = 0;
      (this._measureCanvas = document.createElement("canvas")),
        (this._measureCanvas.width = 10),
        (this._measureCanvas.height = 10),
        (this._measureCanvas.style.width = "10px"),
        (this._measureCanvas.style.height = "10px"),
        (this._measureContext = this._measureCanvas.getContext("2d")),
        (this._measureContext.textBaseline = "hanging");
    }
    destroy() {}
    onRenderFinished() {
      return null;
    }
    beginRender(t, e) {
      this._musicFont = new ne(
        this.settings.display.resources.smuflFontFamilyName,
        this.settings.display.resources.engravingSettings.musicFontSize,
        0,
        0
      );
      let r = this.settings.display.scale;
      (this._canvas = document.createElement("canvas")),
        (this._canvas.width = (t * J.highDpiFactor) | 0),
        (this._canvas.height = (e * J.highDpiFactor) | 0),
        (this._canvas.style.width = `${t}px`),
        (this._canvas.style.height = `${e}px`),
        (this._context = this._canvas.getContext("2d")),
        (this._context.textBaseline = "hanging"),
        this._context.scale(J.highDpiFactor * r, J.highDpiFactor * r),
        (this._context.lineWidth = this._lineWidth);
    }
    endRender() {
      let t = this._canvas;
      return (this._canvas = null), t;
    }
    get color() {
      return this._color;
    }
    set color(t) {
      this._color.rgba !== t.rgba &&
        ((this._color = t),
        (this._context.strokeStyle = t.rgba),
        (this._context.fillStyle = t.rgba));
    }
    get lineWidth() {
      return this._lineWidth;
    }
    set lineWidth(t) {
      (this._lineWidth = t), this._context && (this._context.lineWidth = t);
    }
    fillRect(t, e, r, i) {
      r > 0 && this._context.fillRect(t, e, r, i);
    }
    strokeRect(t, e, r, i) {
      let n = this.lineWidth % 2 === 0 ? 0 : 0.5;
      this._context.strokeRect(t + n, e + n, r, i);
    }
    beginPath() {
      this._context.beginPath();
    }
    closePath() {
      this._context.closePath();
    }
    moveTo(t, e) {
      this._context.moveTo(t, e);
    }
    lineTo(t, e) {
      this._context.lineTo(t, e);
    }
    quadraticCurveTo(t, e, r, i) {
      this._context.quadraticCurveTo(t, e, r, i);
    }
    bezierCurveTo(t, e, r, i, n, s) {
      this._context.bezierCurveTo(t, e, r, i, n, s);
    }
    fillCircle(t, e, r) {
      this._context.beginPath(),
        this._context.arc(t, e, r, 0, Math.PI * 2, !0),
        this.fill();
    }
    strokeCircle(t, e, r) {
      this._context.beginPath(),
        this._context.arc(t, e, r, 0, Math.PI * 2, !0),
        this.stroke();
    }
    fill() {
      this._context.fill(), this._context.beginPath();
    }
    stroke() {
      this._context.stroke(), this._context.beginPath();
    }
    get font() {
      return this._font;
    }
    set font(t) {
      (this._font = t),
        this._context && (this._context.font = t.toCssString(1)),
        (this._measureContext.font = t.toCssString(1));
    }
    get textAlign() {
      switch (this._context.textAlign) {
        case "left":
          return 0;
        case "center":
          return 1;
        case "right":
          return 2;
        default:
          return 0;
      }
    }
    set textAlign(t) {
      switch (t) {
        case 0:
          this._context.textAlign = "left";
          break;
        case 1:
          this._context.textAlign = "center";
          break;
        case 2:
          this._context.textAlign = "right";
          break;
      }
    }
    get textBaseline() {
      switch (this._context.textBaseline) {
        case "hanging":
          return 0;
        case "middle":
          return 1;
        case "bottom":
          return 2;
        case "alphabetic":
          return 3;
        default:
          return 0;
      }
    }
    set textBaseline(t) {
      switch (t) {
        case 0:
          this._context.textBaseline = "hanging";
          break;
        case 1:
          this._context.textBaseline = "middle";
          break;
        case 2:
          this._context.textBaseline = "bottom";
          break;
        case 3:
          this._context.textBaseline = "alphabetic";
          break;
      }
    }
    beginGroup(t) {}
    endGroup() {}
    fillText(t, e, r) {
      this._context.fillText(t, e, r);
    }
    measureText(t) {
      let e = this._measureContext.measureText(t);
      return new Xr(
        e.width,
        e.actualBoundingBoxDescent + e.actualBoundingBoxAscent
      );
    }
    fillMusicFontSymbol(t, e, r, i, n = !1) {
      i !== -1 &&
        this._fillMusicFontSymbolText(t, e, r, String.fromCharCode(i), n);
    }
    fillMusicFontSymbols(t, e, r, i, n = !1) {
      let s = "";
      for (let a of i) a !== -1 && (s += String.fromCharCode(a));
      this._fillMusicFontSymbolText(t, e, r, s, n);
    }
    _fillMusicFontSymbolText(t, e, r, i, n) {
      let s = this._context.textAlign,
        a = this._context.textBaseline,
        o = this._context.font;
      (this._context.font = this._musicFont.toCssString(r)),
        (this._context.textBaseline = "alphabetic"),
        n
          ? (this._context.textAlign = "center")
          : (this._context.textAlign = "left"),
        this._context.fillText(i, t, e),
        (this._context.textBaseline = a),
        (this._context.font = o),
        (this._context.textAlign = s);
    }
    beginRotate(t, e, r) {
      this._context.save(),
        this._context.translate(t, e),
        this._context.rotate((r * Math.PI) / 180);
    }
    endRotate() {
      this._context.restore();
    }
  };
  var bi = class p {
    constructor(t, e = !1) {
      (this._midiFile = t), (this._smf1Mode = e);
    }
    addTimeSignature(t, e, r) {
      let i = 0,
        n = r;
      for (; (n = n >> 1), n > 0; ) i++;
      this._midiFile.addEvent(new Nn(0, t, e, i, 48, 8));
    }
    addRest(t, e, r) {
      this._smf1Mode || this._midiFile.addEvent(new An(t, e, r));
    }
    addNote(t, e, r, i, n, s) {
      this._midiFile.addEvent(new Cn(t, e, s, p._fixValue(i), p._fixValue(n))),
        this._midiFile.addEvent(
          new Mn(t, e + r, s, p._fixValue(i), p._fixValue(n))
        );
    }
    static _fixValue(t) {
      return t > 127 ? 127 : t < 0 ? 0 : t;
    }
    addControlChange(t, e, r, i, n) {
      this._midiFile.addEvent(new In(t, e, r, i, p._fixValue(n)));
    }
    addProgramChange(t, e, r, i) {
      this._midiFile.addEvent(new Ln(t, e, r, i));
    }
    addTempo(t, e) {
      let r = new Dn(t, 0);
      (r.beatsPerMinute = e), this._midiFile.addEvent(r);
    }
    addBend(t, e, r, i) {
      i >= Q.MaxPitchWheel ? (i = Q.MaxPitchWheel) : (i = Math.floor(i)),
        this._midiFile.addEvent(new Fn(t, e, r, i));
    }
    addNoteBend(t, e, r, i, n) {
      this._smf1Mode
        ? this.addBend(t, e, r, n)
        : ((n = (n * Q.MaxPitchWheel20) / Q.MaxPitchWheel),
          this._midiFile.addEvent(new Rn(t, e, r, i, n)));
    }
    finishTrack(t, e) {
      (this._midiFile.format === 1 || t === 0) &&
        this._midiFile.addEvent(new On(t, e));
    }
  };
  var eh = class {
    constructor(t, e) {
      this.closingIndex = 0;
      (this.group = t),
        (this.opening = e),
        (t.closings = t.closings.sort((r, i) => r.index - i.index)),
        (this.iterations = t.closings.map((r) => 0));
    }
  };
  var $u = class {
    constructor(t) {
      this._repeatStack = [];
      this._groupsOnStack = new Set();
      this._previousAlternateEndings = 0;
      this._state = 0;
      this.shouldPlay = !0;
      this.index = 0;
      this.currentTick = 0;
      this._score = t;
    }
    get finished() {
      return this.index >= this._score.masterBars.length;
    }
    processCurrent() {
      let t = this._score.masterBars[this.index];
      if (this._state === 0) {
        let e = t.alternateEndings;
        if (
          (e === 0 && (e = this._previousAlternateEndings),
          t === t.repeatGroup.opening &&
            t.repeatGroup.isClosed &&
            !this._groupsOnStack.has(t.repeatGroup))
        ) {
          let r = new eh(t.repeatGroup, t);
          this._repeatStack.push(r),
            this._groupsOnStack.add(t.repeatGroup),
            (this._previousAlternateEndings = 0),
            (e = t.alternateEndings);
        }
        if (this._repeatStack.length === 0 || e === 0) this.shouldPlay = !0;
        else {
          let r = this._repeatStack[this._repeatStack.length - 1],
            i = r.iterations[r.closingIndex];
          (this._previousAlternateEndings = e),
            (e & (1 << i)) === 0
              ? (this.shouldPlay = !1)
              : (this.shouldPlay = !0);
        }
      } else this.shouldPlay = !0;
      this.shouldPlay && (this.currentTick += t.calculateDuration());
    }
    moveNext() {
      this._moveNextWithDirections() || this._moveNextWithNormalRepeats();
    }
    _resetRepeats() {
      this._groupsOnStack.clear(),
        (this._previousAlternateEndings = 0),
        (this._repeatStack = []);
    }
    _handleDaCapo(t, e, r) {
      return t.has(e)
        ? ((this.index = 0), (this._state = r), this._resetRepeats(), !0)
        : !1;
    }
    _handleDalSegno(t, e, r, i) {
      if (t.has(e)) {
        let n = this._findJumpTarget(i, this.index, !0);
        return n === -1
          ? !1
          : ((this.index = n), (this._state = r), this._resetRepeats(), !0);
      }
      return !1;
    }
    _handleDaCoda(t, e, r) {
      if (t.has(e)) {
        let i = this._findJumpTarget(r, this.index, !1);
        return i === -1
          ? (this.index++, !0)
          : ((this.index = i), (this._state = 0), !0);
      }
      return !1;
    }
    _moveNextWithDirections() {
      let t = this._score.masterBars[this.index],
        e = t.directions !== null && t.directions.size > 0;
      if (this._state === 0 && !e) return !1;
      if (!e) return this.index++, !0;
      switch (this._state) {
        case 0:
          return !!(
            this._handleDaCapo(t.directions, 5, 1) ||
            this._handleDaCapo(t.directions, 6, 2) ||
            this._handleDaCapo(t.directions, 7, 3) ||
            this._handleDaCapo(t.directions, 8, 4) ||
            this._handleDalSegno(t.directions, 9, 1, 1) ||
            this._handleDalSegno(t.directions, 10, 2, 1) ||
            this._handleDalSegno(t.directions, 11, 3, 1) ||
            this._handleDalSegno(t.directions, 12, 4, 1) ||
            this._handleDalSegno(t.directions, 13, 1, 2) ||
            this._handleDalSegno(t.directions, 14, 2, 2) ||
            this._handleDalSegno(t.directions, 15, 3, 2) ||
            this._handleDalSegno(t.directions, 16, 4, 2)
          );
        case 1:
          return this.index++, !0;
        case 2:
          return this._handleDaCoda(t.directions, 17, 3) || this.index++, !0;
        case 3:
          return this._handleDaCoda(t.directions, 18, 4) || this.index++, !0;
        case 4:
          return t.directions.has(0)
            ? ((this.index = this._score.masterBars.length), !0)
            : (this.index++, !0);
      }
      return !0;
    }
    _findJumpTarget(t, e, r) {
      let i;
      return r
        ? ((i = this._findJumpTargetBackwards(t, e)),
          i === -1 && (i = this._findJumpTargetForwards(t, e)),
          i)
        : ((i = this._findJumpTargetForwards(t, e)),
          i === -1 && (i = this._findJumpTargetBackwards(t, e)),
          i);
    }
    _findJumpTargetForwards(t, e) {
      let r = e;
      for (; r < this._score.masterBars.length; ) {
        let i = this._score.masterBars[r].directions;
        if (i && i.has(t)) return r;
        r++;
      }
      return -1;
    }
    _findJumpTargetBackwards(t, e) {
      let r = e;
      for (; r >= 0; ) {
        let i = this._score.masterBars[r].directions;
        if (i && i.has(t)) return r;
        r--;
      }
      return -1;
    }
    _moveNextWithNormalRepeats() {
      let e = this._score.masterBars[this.index].repeatCount - 1;
      if (this._repeatStack.length > 0 && e > 0) {
        let r = this._repeatStack[this._repeatStack.length - 1];
        if (r.iterations[r.closingIndex] < e) {
          (this.index = r.opening.index), r.iterations[r.closingIndex]++;
          for (let n = 0; n < r.closingIndex; n++) r.iterations[n] = 0;
          (r.closingIndex = 0), (this._previousAlternateEndings = 0);
        } else
          r.closingIndex < r.group.closings.length - 1
            ? (r.closingIndex++, this.index++)
            : (this._repeatStack.pop(),
              this._groupsOnStack.delete(r.group),
              this.index++);
      } else this.index++;
    }
  };
  var gl = class {
      constructor(t, e) {
        (this.beat = t), (this.playbackStart = e);
      }
    },
    Ot = class {
      constructor(t, e) {
        this._highlightedBeats = new Map();
        this.highlightedBeats = [];
        this.nextBeat = null;
        this.previousBeat = null;
        (this.start = t), (this.end = e);
      }
      get duration() {
        return this.end - this.start;
      }
      highlightBeat(t, e) {
        (t.isEmpty && !t.voice.isEmpty) ||
          this._highlightedBeats.has(t.id) ||
          (this._highlightedBeats.set(t.id, !0),
          this.highlightedBeats.push(new gl(t, e)));
      }
      getVisibleBeatAtStart(t) {
        for (let e of this.highlightedBeats)
          if (
            e.playbackStart === this.start &&
            t.has(e.beat.voice.bar.staff.track.index)
          )
            return e.beat;
        return null;
      }
    };
  var Qi = class {
      constructor(t, e) {
        (this.tick = t), (this.tempo = e);
      }
    },
    Jn = class {
      constructor() {
        this.start = 0;
        this.end = 0;
        this.tempoChanges = [];
        this.firstBeat = null;
        this.lastBeat = null;
        this.nextMasterBar = null;
        this.previousMasterBar = null;
      }
      get tempo() {
        return this.tempoChanges[0].tempo;
      }
      _insertAfter(t, e) {
        this.firstBeat == null || t == null || this.lastBeat == null
          ? ((this.firstBeat = e), (this.lastBeat = e))
          : ((e.nextBeat = t.nextBeat),
            (e.previousBeat = t),
            t.nextBeat && (t.nextBeat.previousBeat = e),
            (t.nextBeat = e),
            t === this.lastBeat && (this.lastBeat = e));
      }
      _insertBefore(t, e) {
        this.firstBeat == null || t == null || this.lastBeat == null
          ? ((this.firstBeat = e), (this.lastBeat = e))
          : ((e.previousBeat = t.previousBeat),
            (e.nextBeat = t),
            t.previousBeat && (t.previousBeat.nextBeat = e),
            (t.previousBeat = e),
            t === this.firstBeat && (this.firstBeat = e));
      }
      addBeat(t, e, r, i) {
        let n = r + i;
        if (this.firstBeat == null) {
          let s = new Ot(r, n);
          s.highlightBeat(t, e), this._insertAfter(this.firstBeat, s);
        } else if (r >= this.lastBeat.end) {
          let s = new Ot(this.lastBeat.end, n);
          s.highlightBeat(t, e), this._insertAfter(this.lastBeat, s);
        } else {
          let s = null;
          if (r < this.firstBeat.start) s = this.firstBeat;
          else {
            let a = this.firstBeat;
            for (; a != null; ) {
              if (r >= a.start && r < a.end) {
                s = a;
                break;
              }
              a = a.nextBeat;
            }
            if (s === null)
              throw new te(0, "Error on building lookup, unknown variant");
          }
          if (r < s.start)
            if (n === s.start) {
              let a = new Ot(r, s.start);
              a.highlightBeat(t, e), this._insertBefore(this.firstBeat, a);
            } else if (n < s.end) {
              let a = new Ot(r, s.start);
              a.highlightBeat(t, e), this._insertBefore(s, a);
              let o = new Ot(s.start, n);
              for (let l of s.highlightedBeats)
                o.highlightBeat(l.beat, l.playbackStart);
              o.highlightBeat(t, e), this._insertBefore(s, o), (s.start = n);
            } else if (n === s.end) {
              let a = new Ot(r, s.start);
              a.highlightBeat(t, e),
                s.highlightBeat(t, e),
                this._insertBefore(s, a);
            } else {
              let a = new Ot(r, s.start);
              a.highlightBeat(t, e),
                s.highlightBeat(t, e),
                this._insertBefore(s, a),
                this.addBeat(t, e, s.end, n - s.end);
            }
          else if (r > s.start)
            if (n === s.end) {
              let a = new Ot(s.start, r);
              for (let o of s.highlightedBeats)
                a.highlightBeat(o.beat, o.playbackStart);
              (s.start = r), s.highlightBeat(t, e), this._insertBefore(s, a);
            } else if (n < s.end) {
              let a = new Ot(s.start, r);
              this._insertBefore(s, a);
              let o = new Ot(r, n);
              this._insertBefore(s, o);
              for (let l of s.highlightedBeats)
                a.highlightBeat(l.beat, l.playbackStart),
                  o.highlightBeat(l.beat, l.playbackStart);
              o.highlightBeat(t, e), (s.start = n);
            } else {
              let a = new Ot(s.start, r);
              for (let o of s.highlightedBeats)
                a.highlightBeat(o.beat, o.playbackStart);
              (s.start = r),
                s.highlightBeat(t, e),
                this._insertBefore(s, a),
                this.addBeat(t, e, s.end, n - s.end);
            }
          else if (n === s.end) s.highlightBeat(t, e);
          else if (n < s.end) {
            let a = new Ot(s.start, n);
            for (let o of s.highlightedBeats)
              a.highlightBeat(o.beat, o.playbackStart);
            a.highlightBeat(t, e), (s.start = n), this._insertBefore(s, a);
          } else s.highlightBeat(t, e), this.addBeat(t, e, s.end, n - s.end);
        }
      }
    };
  var Ku = ((r) => (
      (r[(r.Unknown = 0)] = "Unknown"),
      (r[(r.ToNextBext = 1)] = "ToNextBext"),
      (r[(r.ToEndOfBar = 2)] = "ToEndOfBar"),
      r
    ))(Ku || {}),
    yl = class {
      constructor(t) {
        this.nextBeat = null;
        this.tickDuration = 0;
        this.duration = 0;
        this.cursorMode = 0;
        this.masterBar = t;
      }
      get start() {
        return this.masterBar.start + this.beatLookup.start;
      }
      get end() {
        return this.start + this.tickDuration;
      }
      calculateDuration() {
        if (this.masterBar.tempoChanges.length === 1)
          this.duration = E.ticksToMillis(
            this.tickDuration,
            this.masterBar.tempoChanges[0].tempo
          );
        else {
          let t = 0,
            e = this.start,
            r = this.masterBar.tempoChanges[0].tempo,
            i = this.end;
          for (let n of this.masterBar.tempoChanges)
            if (n.tick < e) r = n.tempo;
            else {
              if (n.tick > i) break;
              (t += E.ticksToMillis(n.tick - e, r)),
                (r = n.tempo),
                (e = n.tick);
            }
          i > e && (t += E.ticksToMillis(i - e, r)), (this.duration = t);
        }
      }
    },
    Ea = class {
      constructor() {
        this._currentMasterBar = null;
        this.masterBarLookup = new Map();
        this.masterBars = [];
        this.multiBarRestInfo = null;
      }
      findBeat(t, e, r = null) {
        let i = null;
        return (
          r && (i = this._findBeatFast(t, r, e)),
          i || (i = this._findBeatSlow(t, r, e, !1)),
          i
        );
      }
      _findBeatFast(t, e, r) {
        if (r >= e.start && r < e.end) return e;
        if (e.nextBeat && r >= e.nextBeat.start && r < e.nextBeat.end) {
          let i = e.nextBeat;
          return this._fillNextBeat(i, t), i;
        }
        return null;
      }
      _fillNextBeatMultiBarRest(t, e) {
        let r = this.multiBarRestInfo.get(t.masterBar.masterBar.index),
          i = t.masterBar;
        for (let n = 0; n < r.length && i; n++) i = i.nextMasterBar;
        i
          ? i.nextMasterBar
            ? ((t.nextBeat = this._firstBeatInMasterBar(
                e,
                i.nextMasterBar,
                i.nextMasterBar.start,
                !0
              )),
              t.nextBeat
                ? ((t.tickDuration = t.nextBeat.start - t.start),
                  (t.cursorMode = 1),
                  t.nextBeat.masterBar.masterBar.index !==
                    i.masterBar.index + 1 &&
                    (t.nextBeat.masterBar.masterBar.index !==
                      i.masterBar.index ||
                      t.nextBeat.beat.playbackStart <= t.beat.playbackStart) &&
                    (t.cursorMode = 2))
                : ((t.tickDuration = i.nextMasterBar.end - t.start),
                  (t.cursorMode = 2)))
            : ((t.tickDuration = i.end - t.start), (t.cursorMode = 2))
          : (w.warning(
              "Synth",
              "MultiBar Rest Info and the nextMasterBar are out of sync, this is an unexpected error. Please report it as bug.  (broken chain fill-next)"
            ),
            (t.tickDuration =
              (t.masterBar.end - t.masterBar.start) * (r.length + 1)),
            (t.cursorMode = 2)),
          t.calculateDuration();
      }
      _fillNextBeat(t, e) {
        this._isMultiBarRestResult(t)
          ? this._fillNextBeatMultiBarRest(t, e)
          : this._fillNextBeatDefault(t, e);
      }
      _fillNextBeatDefault(t, e) {
        (t.nextBeat = this._findBeatInMasterBar(
          t.masterBar,
          t.beatLookup.nextBeat,
          t.end,
          e,
          !0
        )),
          t.nextBeat == null &&
            (t.nextBeat = this._findBeatSlow(e, t, t.end, !0)),
          t.nextBeat
            ? ((t.tickDuration = t.nextBeat.start - t.start),
              (t.cursorMode = 1),
              t.calculateDuration())
            : ((t.tickDuration = t.masterBar.end - t.start),
              (t.cursorMode = 2),
              t.calculateDuration()),
          t.nextBeat &&
            t.nextBeat.masterBar.masterBar.index !==
              t.masterBar.masterBar.index + 1 &&
            (t.nextBeat.masterBar.masterBar.index !==
              t.masterBar.masterBar.index ||
              t.nextBeat.beat.playbackStart <= t.beat.playbackStart) &&
            (t.cursorMode = 2);
      }
      _isMultiBarRestResult(t) {
        return this._internalIsMultiBarRestResult(
          t.masterBar.masterBar.index,
          t.beat
        );
      }
      _internalIsMultiBarRestResult(t, e) {
        return (
          this.multiBarRestInfo &&
          this.multiBarRestInfo.has(t) &&
          e.isRest &&
          e.voice.bar.isRestOnly
        );
      }
      _findBeatSlow(t, e, r, i) {
        let n = null;
        return (
          e != null &&
            (e.masterBar.start <= r && e.masterBar.end > r
              ? (n = e.masterBar)
              : e.masterBar.nextMasterBar &&
                e.masterBar.nextMasterBar.start <= r &&
                e.masterBar.nextMasterBar.end > r &&
                (n = e.masterBar.nextMasterBar)),
          n || (n = this._findMasterBar(r)),
          n ? this._firstBeatInMasterBar(t, n, r, i) : null
        );
      }
      _firstBeatInMasterBar(t, e, r, i) {
        let n = e;
        for (; n; ) {
          if (n.firstBeat) {
            let s = this._findBeatInMasterBar(n, n.firstBeat, r, t, i);
            if (s) return s;
          }
          n = n.nextMasterBar;
        }
        return null;
      }
      _findBeatInMasterBar(t, e, r, i, n) {
        if (!e) return null;
        let s = null,
          a = null,
          o = r - t.start;
        for (; e != null && a == null; ) {
          if ((e.start <= o || (n && o < 0)) && o < e.end) {
            if (((s = e), (a = e.getVisibleBeatAtStart(i)), !a))
              if (n) {
                let u = t;
                for (; u != null && a == null; ) {
                  for (; e != null; ) {
                    if (((a = e.getVisibleBeatAtStart(i)), a)) {
                      (s = e), (t = u);
                      break;
                    }
                    e = e.nextBeat;
                  }
                  (!a || !s) &&
                    ((u = u.nextMasterBar), (e = u?.firstBeat ?? null));
                }
              } else {
                let u = t;
                for (; u != null && a == null; ) {
                  for (; e != null; ) {
                    if (((a = e.getVisibleBeatAtStart(i)), a)) {
                      (s = e), (t = u);
                      break;
                    }
                    e = e.previousBeat;
                  }
                  (!a || !s) &&
                    ((u = u.previousMasterBar), (e = u?.firstBeat ?? null));
                }
              }
          } else if (e.end > o) break;
          e = e?.nextBeat ?? null;
        }
        return a == null ? null : this._createResult(t, s, a, n, i);
      }
      _createResult(t, e, r, i, n) {
        let s = new yl(t);
        if (
          ((s.beat = r),
          (s.beatLookup = e),
          (s.tickDuration = e.end - e.start),
          !i)
        )
          this._fillNextBeat(s, n);
        else if (this._isMultiBarRestResult(s)) {
          let a = this.multiBarRestInfo.get(t.masterBar.index),
            o = t;
          for (let l = 0; l < a.length && o; l++) o = o.nextMasterBar;
          o
            ? o.nextMasterBar
              ? (s.tickDuration = o.nextMasterBar.start - e.start)
              : (s.tickDuration = o.end - e.start)
            : w.warning(
                "Synth",
                "MultiBar Rest Info and the nextMasterBar are out of sync, this is an unexpected error. Please report it as bug.  (broken chain stretch-result)"
              );
        }
        return s.calculateDuration(), s;
      }
      _findMasterBar(t) {
        let e = this.masterBars,
          r = 0,
          i = e.length - 1;
        for (; r <= i; ) {
          let n = ((i + r) / 2) | 0,
            s = e[n];
          if (t >= s.start && t < s.end) return s;
          t < s.start ? (i = n - 1) : (r = n + 1);
        }
        return null;
      }
      getMasterBar(t) {
        if (!this.masterBarLookup.has(t.index)) {
          let e = new Jn();
          return (e.masterBar = t), e;
        }
        return this.masterBarLookup.get(t.index);
      }
      getMasterBarStart(t) {
        return this.masterBarLookup.has(t.index)
          ? this.masterBarLookup.get(t.index).start
          : 0;
      }
      getBeatStart(t) {
        return this.masterBarLookup.has(t.voice.bar.index)
          ? this.masterBarLookup.get(t.voice.bar.index).start + t.playbackStart
          : 0;
      }
      addMasterBar(t) {
        this.masterBars.push(t),
          this._currentMasterBar &&
            ((t.previousMasterBar = this._currentMasterBar),
            (this._currentMasterBar.nextMasterBar = t)),
          (this._currentMasterBar = t),
          this.masterBarLookup.has(t.masterBar.index) ||
            this.masterBarLookup.set(t.masterBar.index, t);
      }
      addBeat(t, e, r) {
        let i = this._currentMasterBar;
        if (i)
          if (e < 0 && i.previousMasterBar) {
            let n = i.previousMasterBar.end - i.previousMasterBar.start,
              s = n + e,
              a = s + r;
            if ((i.previousMasterBar.addBeat(t, s, s, r), a > n)) {
              let o = r + e;
              i.addBeat(t, e, 0, o);
            }
          } else i.addBeat(t, e, e, r);
      }
    };
  var th = class {
      constructor() {
        this.noteOnly = 0;
        this.untilTieOrSlideEnd = 0;
        this.letRingEnd = 0;
      }
    },
    rh = class {
      constructor() {
        this.firstBeatDuration = 0;
        this.secondBeatStartOffset = 0;
        this.secondBeatDuration = 0;
      }
    },
    ih = class {
      constructor() {
        this.durations = [];
        this.brushInfos = [];
      }
    },
    nh = class {
      constructor() {
        this.synthTick = 0;
        this.synthTime = 0;
        this.currentTempo = 0;
        this.automationToSyncPoint = new Map();
        this.createNewSyncPoints = !1;
      }
    },
    le = class le {
      constructor(t, e, r) {
        this._programsPerChannel = new Map();
        this._currentTime = 0;
        this._calculatedBeatTimers = new Set();
        this.tickLookup = new Ea();
        this.applyTranspositionPitches = !0;
        this.syncPoints = [];
        this.transpositionPitches = new Map();
        this._currentTripletFeel = null;
        this.vibratoResolution = 16;
        (this._score = t),
          (this._settings = e || new kt()),
          (this._handler = r);
      }
      generate() {
        this.transpositionPitches.clear(),
          this._calculatedBeatTimers.clear(),
          (this._currentTime = 0);
        for (let t of this._score.tracks) this._generateTrack(t);
        w.debug("Midi", "Begin midi generation"),
          (this.syncPoints = []),
          le._playThroughSong(
            this._score,
            this.syncPoints,
            !1,
            (t, e, r, i, n) => {
              this._generateMasterBar(t, e, r, i, n);
            },
            (t, e, r) => {
              for (let i of this._score.tracks)
                for (let n of i.staves)
                  t < n.bars.length && this._generateBar(n.bars[t], e, r);
            },
            (t) => {
              for (let e of this._score.tracks)
                this._handler.finishTrack(e.index, t);
            }
          ),
          w.debug("Midi", "Midi generation done");
      }
      _generateTrack(t) {
        this._generateChannel(t, t.playbackInfo.primaryChannel, t.playbackInfo),
          t.playbackInfo.primaryChannel !== t.playbackInfo.secondaryChannel &&
            this._generateChannel(
              t,
              t.playbackInfo.secondaryChannel,
              t.playbackInfo
            );
      }
      _addProgramChange(t, e, r, i) {
        (!this._programsPerChannel.has(r) ||
          this._programsPerChannel.get(r) !== i) &&
          (this._handler.addProgramChange(t.index, e, r, i),
          this._programsPerChannel.set(r, i));
      }
      _addBankChange(t, e, r, i) {
        let n = Lt.bankToLsbMsb(i);
        this._handler.addControlChange(t.index, e, r, 0, n[1]),
          this._handler.addControlChange(t.index, e, r, 32, n[0]);
      }
      static buildTranspositionPitches(t, e) {
        let r = new Map();
        for (let i of t.tracks) {
          let n =
            i.index < e.notation.transpositionPitches.length
              ? e.notation.transpositionPitches[i.index]
              : -i.staves[0].transpositionPitch;
          r.set(i.playbackInfo.primaryChannel, n),
            r.set(i.playbackInfo.secondaryChannel, n);
        }
        return r;
      }
      _generateChannel(t, e, r) {
        let i =
          t.index < this._settings.notation.transpositionPitches.length
            ? this._settings.notation.transpositionPitches[t.index]
            : -t.staves[0].transpositionPitch;
        this.transpositionPitches.set(e, i);
        let n = le._toChannelShort(r.volume),
          s = le._toChannelShort(r.balance);
        this._handler.addControlChange(t.index, 0, e, 7, n),
          this._handler.addControlChange(t.index, 0, e, 10, s),
          this._handler.addControlChange(t.index, 0, e, 11, 127),
          this._handler.addControlChange(t.index, 0, e, 100, 0),
          this._handler.addControlChange(t.index, 0, e, 101, 0),
          this._handler.addControlChange(t.index, 0, e, 38, 0),
          this._handler.addControlChange(
            t.index,
            0,
            e,
            6,
            le._pitchBendRangeInSemitones
          ),
          this._addBankChange(t, 0, e, r.bank),
          this._addProgramChange(t, 0, e, r.program);
      }
      static generateSyncPoints(t, e = !1) {
        let r = [];
        return (
          le._playThroughSong(
            t,
            r,
            e,
            (i, n, s, a, o) => {},
            (i, n, s) => {},
            (i) => {}
          ),
          r
        );
      }
      static buildModifiedTempoLookup(t) {
        let e = [];
        return le._playThroughSong(
          t,
          e,
          !1,
          (i, n, s, a, o) => {},
          (i, n, s) => {},
          (i) => {}
        ).automationToSyncPoint;
      }
      static _playThroughSong(t, e, r, i, n, s) {
        let a = new $u(t),
          o = new nh();
        (o.currentTempo = t.tempo),
          (o.syncPoints = e),
          (o.createNewSyncPoints = r);
        let l = null,
          u = new Map();
        for (; !a.finished; ) {
          let c = a.index,
            d = t.masterBars[c],
            h = a.currentTick;
          if ((a.processCurrent(), a.shouldPlay)) {
            let f = u.has(c) ? u.get(c) : -1;
            f++, u.set(c, f), i(d, l, h, o.currentTempo, f);
            let b =
              d.tempoAutomations.length > 0
                ? d.tempoAutomations[0].value
                : o.currentTempo;
            n(c, h, b), (o.synthTick = h), le._processBarTime(d, f, o);
          }
          a.moveNext(), (l = d);
        }
        if (e.length > 0) {
          let c = e[e.length - 1],
            d = a.currentTick - c.synthTick;
          if (d > 0) {
            let h = new mi();
            (h.masterBarIndex = l.index),
              (h.masterBarOccurence = u.get(l.index) - 1),
              (h.synthTick = a.currentTick),
              (h.synthBpm = o.currentTempo),
              o.createNewSyncPoints
                ? ((h.syncBpm = c.synthBpm), (h.synthBpm = c.synthBpm))
                : e.length === 1
                ? (h.syncBpm = c.synthBpm)
                : (h.syncBpm = e[e.length - 2].syncBpm),
              (h.synthTime = c.synthTime + E.ticksToMillis(d, c.synthBpm)),
              (h.syncTime = c.syncTime + E.ticksToMillis(d, h.syncBpm)),
              o.createNewSyncPoints || c.updateSyncBpm(h.synthTime, h.syncTime),
              e.push(h);
          }
        }
        return s(a.currentTick), o;
      }
      static _processBarTime(t, e, r) {
        let i = t.calculateDuration(),
          n = t.syncPoints,
          s = r.synthTick;
        r.createNewSyncPoints
          ? le._processBarTimeWithNewSyncPoints(t, e, r)
          : n
          ? le._processBarTimeWithSyncPoints(t, e, r)
          : le._processBarTimeNoSyncPoints(t, r);
        let a = s + i,
          o = a - r.synthTick;
        o > 0 &&
          ((r.synthTime += E.ticksToMillis(o, r.currentTempo)),
          (r.synthTick = a));
      }
      static _processBarTimeWithNewSyncPoints(t, e, r) {
        let i = r.synthTick;
        if (t.index === 0 && e === 0) {
          r.currentTempo = t.score.tempo;
          let s = new mi();
          (s.masterBarIndex = t.index),
            (s.masterBarOccurence = e),
            (s.synthTick = i),
            (s.synthBpm = r.currentTempo),
            (s.synthTime = r.synthTime),
            (s.syncBpm = r.currentTempo),
            (s.syncTime = r.synthTime),
            r.syncPoints.push(s);
        }
        let n = t.calculateDuration();
        for (let s of t.tempoAutomations) {
          let a = i + s.ratioPosition * n,
            o = a - r.synthTick;
          if (
            (o > 0 &&
              ((r.synthTick = a),
              (r.synthTime += E.ticksToMillis(o, r.currentTempo))),
            s.value !== r.currentTempo)
          ) {
            r.currentTempo = s.value;
            let l = new mi();
            (l.masterBarIndex = t.index),
              (l.masterBarOccurence = e),
              (l.synthTick = a),
              (l.synthBpm = r.currentTempo),
              (l.synthTime = r.synthTime),
              (l.syncBpm = r.currentTempo),
              (l.syncTime = r.synthTime),
              r.syncPoints.push(l);
          }
        }
      }
      static _processBarTimeWithSyncPoints(t, e, r) {
        let i = r.synthTick,
          n = t.calculateDuration(),
          s = 0,
          a;
        for (let o of t.syncPoints) {
          if (o.syncPointValue.barOccurence !== e) continue;
          let l = i + o.ratioPosition * n;
          for (
            ;
            s < t.tempoAutomations.length &&
            t.tempoAutomations[s].ratioPosition <= o.ratioPosition;

          ) {
            let c = t.tempoAutomations[s],
              d = i + c.ratioPosition * n;
            (a = d - r.synthTick),
              a > 0 &&
                ((r.synthTick = d),
                (r.synthTime += E.ticksToMillis(a, r.currentTempo))),
              (r.currentTempo = c.value),
              s++;
          }
          (a = l - r.synthTick),
            a > 0 &&
              ((r.synthTick = l),
              (r.synthTime += E.ticksToMillis(a, r.currentTempo))),
            r.syncPoints.length > 0 &&
              r.syncPoints[r.syncPoints.length - 1].updateSyncBpm(
                r.synthTime,
                o.syncPointValue.millisecondOffset
              );
          let u = new mi();
          (u.masterBarIndex = t.index),
            (u.masterBarOccurence = e),
            (u.synthTick = l),
            (u.synthBpm = r.currentTempo),
            (u.synthTime = r.synthTime),
            (u.syncTime = o.syncPointValue.millisecondOffset),
            (u.syncBpm = 0),
            r.syncPoints.push(u),
            r.automationToSyncPoint.set(o, u);
        }
        for (; s < t.tempoAutomations.length; ) {
          let o = t.tempoAutomations[s],
            l = i + o.ratioPosition * n;
          (a = l - r.synthTick),
            a > 0 &&
              ((r.synthTick = l),
              (r.synthTime += E.ticksToMillis(a, r.currentTempo))),
            (r.currentTempo = o.value),
            s++;
        }
      }
      static _processBarTimeNoSyncPoints(t, e) {
        let r = e.synthTick,
          i = t.calculateDuration();
        for (let n of t.tempoAutomations) {
          let s = r + n.ratioPosition * i,
            a = s - e.synthTick;
          a > 0 &&
            ((e.synthTick = s),
            (e.synthTime += E.ticksToMillis(a, e.currentTempo))),
            (e.currentTempo = n.value);
        }
      }
      static _toChannelShort(t) {
        let e = Math.max(-32768, Math.min(32767, t * 8 - 1));
        return Math.max(e, -1) + 1;
      }
      _generateMasterBar(t, e, r, i, n) {
        (!e ||
          e.timeSignatureDenominator !== t.timeSignatureDenominator ||
          e.timeSignatureNumerator !== t.timeSignatureNumerator) &&
          this._handler.addTimeSignature(
            r,
            t.timeSignatureNumerator,
            t.timeSignatureDenominator
          );
        let s = t.calculateDuration(),
          a = new Jn();
        if (t.tempoAutomations.length > 0) {
          t.tempoAutomations[0].ratioPosition > 0 &&
            a.tempoChanges.push(new Qi(r, i));
          for (let o of t.tempoAutomations) {
            let l = r + s * o.ratioPosition;
            this._handler.addTempo(l, o.value),
              a.tempoChanges.push(new Qi(l, o.value));
          }
        } else
          e
            ? a.tempoChanges.push(new Qi(r, i))
            : (this._handler.addTempo(r, t.score.tempo),
              a.tempoChanges.push(new Qi(r, t.score.tempo)));
        (a.masterBar = t),
          (a.start = r),
          (a.end = a.start + s),
          this.tickLookup.addMasterBar(a);
      }
      _generateBar(t, e, r) {
        let i = this._getPlaybackBar(t),
          n = this._currentTime;
        for (let l of i.voices)
          (this._currentTime = n), this._generateVoice(l, e, t, r);
        let s = i.masterBar,
          a = s.calculateDuration(),
          o = s.tempoAutomations.slice();
        if (o.length === 0) this._currentTime = n + E.ticksToMillis(a, r);
        else {
          this._currentTime = n;
          let l = e,
            u = r,
            c = e + a;
          for (let h of o) {
            let b = a * h.ratioPosition - l;
            b > 0 && (this._currentTime += E.ticksToMillis(b, u)),
              (u = h.value),
              (l += b);
          }
          let d = c - l;
          d > 0 && (this._currentTime += E.ticksToMillis(d, u));
        }
        i.id !== t.id && this.tickLookup.addBeat(t.voices[0].beats[0], 0, a);
      }
      _getPlaybackBar(t) {
        switch (t.simileMark) {
          case 1:
            t.previousBar && (t = this._getPlaybackBar(t.previousBar));
            break;
          case 2:
            t.previousBar &&
              t.previousBar.previousBar &&
              (t = this._getPlaybackBar(t.previousBar.previousBar));
            break;
          case 3:
            t.previousBar &&
              t.previousBar.previousBar &&
              (t = this._getPlaybackBar(t.previousBar.previousBar));
            break;
        }
        return t;
      }
      _generateVoice(t, e, r, i) {
        if (t.isEmpty && (!t.bar.isEmpty || t.index !== 0)) return;
        let n = r.masterBar.tempoAutomations.slice(),
          s = i,
          a = r.masterBar.calculateDuration();
        for (let o of t.beats) {
          let l = o.playbackStart / a;
          for (; n.length > 0 && n[0].ratioPosition <= l; ) s = n.shift().value;
          this._generateBeat(o, e, r, s);
        }
      }
      _generateBeat(t, e, r, i) {
        let n = t.playbackStart,
          s = t.playbackDuration,
          a = t.voice.bar.masterBar.calculateDuration();
        t.voice.bar.isEmpty
          ? (s = a)
          : t.voice.bar.masterBar.tripletFeel !== 0 &&
            this._settings.player.playTripletFeel &&
            (this._currentTripletFeel
              ? ((n -= this._currentTripletFeel.secondBeatStartOffset),
                (s = this._currentTripletFeel.secondBeatDuration),
                (this._currentTripletFeel = null))
              : ((this._currentTripletFeel = le._calculateTripletFeelInfo(
                  n,
                  s,
                  t
                )),
                this._currentTripletFeel &&
                  (s = this._currentTripletFeel.firstBeatDuration))),
          t.showTimer &&
            !this._calculatedBeatTimers.has(t.id) &&
            ((t.timer = this._currentTime),
            this._calculatedBeatTimers.add(t.id)),
          (this._currentTime += E.ticksToMillis(s, i)),
          r === t.voice.bar && this.tickLookup.addBeat(t, n, s);
        let o = t.voice.bar.staff.track;
        for (let l of t.automations) this._generateNonTempoAutomation(t, l, e);
        if (t.isRest)
          this._handler.addRest(o.index, e + n, o.playbackInfo.primaryChannel);
        else if (t.deadSlapped) this._generateDeadSlap(t, e + n);
        else {
          let l = this._getBrushInfo(t),
            u = this._getRasgueadoInfo(t, s);
          for (let c of t.notes) this._generateNote(c, e + n, s, i, l, u);
        }
        if (
          (t.fade !== 0 && this._generateFade(t, e + n, s), t.vibrato !== 0)
        ) {
          let l = 240,
            u = 3;
          switch (t.vibrato) {
            case 1:
              (l = this._settings.player.vibrato.beatSlightLength),
                (u = this._settings.player.vibrato.beatSlightAmplitude);
              break;
            case 2:
              (l = this._settings.player.vibrato.beatWideLength),
                (u = this._settings.player.vibrato.beatWideAmplitude);
              break;
          }
          this._generateVibratorWithParams(
            e + n,
            t.playbackDuration,
            l,
            0,
            u,
            (c, d) => {
              this._handler.addBend(
                t.voice.bar.staff.track.index,
                c,
                o.playbackInfo.secondaryChannel,
                d
              );
            }
          );
        }
      }
      static _calculateTripletFeelInfo(t, e, r) {
        let i;
        switch (r.voice.bar.masterBar.tripletFeel) {
          case 2:
          case 4:
          case 6:
            i = 8;
            break;
          case 1:
          case 3:
          case 5:
            i = 16;
            break;
          default:
            return null;
        }
        let n = E.toTicks(i);
        if (
          e !== n ||
          t % n !== 0 ||
          !r.nextBeat ||
          r.nextBeat.voice !== r.voice ||
          r.playbackDuration !== n
        )
          return null;
        let s = new rh();
        switch (r.voice.bar.masterBar.tripletFeel) {
          case 2:
            (s.firstBeatDuration = E.applyTuplet(E.toTicks(4), 3, 2)),
              (s.secondBeatDuration = E.applyTuplet(E.toTicks(8), 3, 2));
            break;
          case 4:
            (s.firstBeatDuration = E.applyDot(E.toTicks(8), !1)),
              (s.secondBeatDuration = E.toTicks(16));
            break;
          case 6:
            (s.firstBeatDuration = E.toTicks(16)),
              (s.secondBeatDuration = E.applyDot(E.toTicks(8), !1));
            break;
          case 1:
            (s.firstBeatDuration = E.applyTuplet(E.toTicks(8), 3, 2)),
              (s.secondBeatDuration = E.applyTuplet(E.toTicks(16), 3, 2));
            break;
          case 3:
            (s.firstBeatDuration = E.applyDot(E.toTicks(16), !1)),
              (s.secondBeatDuration = E.toTicks(32));
            break;
          case 5:
            (s.firstBeatDuration = E.toTicks(32)),
              (s.secondBeatDuration = E.applyDot(E.toTicks(16), !1));
            break;
        }
        return (s.secondBeatStartOffset = e - s.firstBeatDuration), s;
      }
      _generateDeadSlap(t, e) {
        let r = E.toTicks(64),
          i = t.voice.bar.staff;
        if (i.tuning.length > 0)
          for (let n of i.tuning)
            this._handler.addNote(
              i.track.index,
              e,
              r,
              n,
              E.dynamicToVelocity(5),
              i.track.playbackInfo.primaryChannel
            );
      }
      _needsSecondaryChannel(t) {
        return t.hasBend || t.beat.hasWhammyBar || t.beat.vibrato !== 0;
      }
      _determineChannel(t, e) {
        if (this._needsSecondaryChannel(e))
          return t.playbackInfo.secondaryChannel;
        let r = e;
        for (; r.isTieDestination; )
          if (((r = r.tieOrigin), this._needsSecondaryChannel(r)))
            return t.playbackInfo.secondaryChannel;
        for (r = e; r.isTieOrigin; )
          if (((r = r.tieDestination), this._needsSecondaryChannel(r)))
            return t.playbackInfo.secondaryChannel;
        return t.playbackInfo.primaryChannel;
      }
      _generateNote(t, e, r, i, n, s) {
        let a = t.beat.voice.bar.staff.track,
          o = t.beat.voice.bar.staff,
          l = t.calculateRealValue(this.applyTranspositionPitches, !0);
        if (t.isPercussion) {
          let S = He.getArticulation(t);
          S && (l = S.outputMidiNumber);
        }
        if (t.isDead) {
          //  MIDI 127  C4=60
          l = 127;
        }
        let u =
            s == null && t.isStringed && t.string <= n.length
              ? n[t.string - 1]
              : 0,
          c = e + u,
          d = this._getNoteDuration(t, r, i);
        (d.untilTieOrSlideEnd -= u), (d.noteOnly -= u), (d.letRingEnd -= u);
        let h = le._getNoteVelocity(t),
          f = this._determineChannel(a, t),
          b = 0,
          y = Math.max(d.untilTieOrSlideEnd, d.letRingEnd);
        if (
          (t.hasBend
            ? (b = le.getPitchWheel(t.bendPoints[0].value))
            : t.beat.hasWhammyBar
            ? (b = le.getPitchWheel(t.beat.whammyBarPoints[0].value))
            : t.isTieDestination ||
              (t.slideOrigin && t.slideOrigin.slideOutType === 2)
            ? (b = -1)
            : (b = le.getPitchWheel(0)),
          b >= 0 && this._handler.addNoteBend(a.index, c, f, l, b),
          t.beat.hasRasgueado)
        ) {
          this._generateRasgueado(a, t, c, l, h, f, s);
          return;
        }
        if (t.ornament !== 0) {
          this._generateOrnament(a, t, c, y, l, h, f);
          return;
        }
        if (t.isTrill && !o.isPercussion) {
          this._generateTrill(t, c, d, l, h, f);
          return;
        }
        if (t.beat.isTremolo) {
          this._generateTremoloPicking(t, c, d, l, h, f);
          return;
        }
        t.hasBend
          ? this._generateBend(t, c, d, l, f, i)
          : t.beat.hasWhammyBar && t.index === 0
          ? this._generateWhammy(t.beat, c, d, f, i)
          : t.slideInType !== 0 || t.slideOutType !== 0
          ? this._generateSlide(t, c, d, l, f, i)
          : (t.vibrato !== 0 ||
              (t.isTieDestination && t.tieOrigin.vibrato !== 0)) &&
            this._generateVibrato(t, c, d, l, f),
          !t.isTieDestination &&
            (!t.slideOrigin || t.slideOrigin.slideOutType !== 2) &&
            this._handler.addNote(a.index, c, y, l, h, f);
      }
      _generateOrnament(t, e, r, i, n, s, a) {
        let o,
          l,
          u = n % 12,
          c = 1 / 3;
        switch (e.ornament) {
          case 2:
            (o = [n + le._ornamentKeysUp[u], n, n + le.ornamentKeysDown[u]]),
              (l = [E.toTicks(16) * c, E.toTicks(16) * c, E.toTicks(16) * c]);
            break;
          case 1:
            (o = [n + le.ornamentKeysDown[u], n, n + le._ornamentKeysUp[u]]),
              (l = [E.toTicks(16) * c, E.toTicks(16) * c, E.toTicks(16) * c]);
            break;
          case 3:
            (o = [n, n + le._ornamentKeysUp[u]]),
              (l = [E.toTicks(32), E.toTicks(32)]);
            break;
          case 4:
            (o = [n, n + le.ornamentKeysDown[u]]),
              (l = [E.toTicks(32), E.toTicks(32)]);
            break;
          default:
            return;
        }
        let d = 1;
        i < E.QuarterTime && (d = i / E.QuarterTime),
          (s -= E.VelocityIncrement);
        let h = 0;
        for (let b = 0; b < o.length; b++) {
          let y = l[b] * d;
          this._handler.addNote(t.index, r, y, o[b], s, a), (r += y), (h += y);
        }
        let f = i - h;
        this._handler.addNote(t.index, r, f, n, s, a);
      }
      _getNoteDuration(t, e, r) {
        let i = new th();
        if (
          ((i.noteOnly = e),
          (i.untilTieOrSlideEnd = e),
          (i.letRingEnd = e),
          t.isDead)
        )
          return (
            (i.noteOnly = this._applyStaticDuration(
              le._defaultDurationDead,
              e,
              r
            )),
            (i.untilTieOrSlideEnd = i.noteOnly),
            (i.letRingEnd = i.noteOnly),
            i
          );
        if (t.isPalmMute)
          return (
            (i.noteOnly = this._applyStaticDuration(
              le._defaultDurationPalmMute,
              e,
              r
            )),
            (i.untilTieOrSlideEnd = i.noteOnly),
            (i.letRingEnd = i.noteOnly),
            i
          );
        if (t.isStaccato)
          return (
            (i.noteOnly = (e / 2) | 0),
            (i.untilTieOrSlideEnd = i.noteOnly),
            (i.letRingEnd = i.noteOnly),
            i
          );
        if (t.isTieOrigin) {
          let n = t.tieDestination;
          if (n)
            if (t.isTieDestination) {
              let s = this._getNoteDuration(n, n.beat.playbackDuration, r);
              i.untilTieOrSlideEnd = e + s.untilTieOrSlideEnd;
            } else {
              let s = t.beat.absolutePlaybackStart,
                a = this._getNoteDuration(n, n.beat.playbackDuration, r),
                o = n.beat.absolutePlaybackStart + a.untilTieOrSlideEnd;
              i.untilTieOrSlideEnd = o - s;
            }
        } else if (t.slideOutType === 2) {
          let n = t.slideTarget;
          if (n) {
            let s = t.beat.absolutePlaybackStart,
              a = this._getNoteDuration(n, n.beat.playbackDuration, r),
              o = n.beat.absolutePlaybackStart + a.untilTieOrSlideEnd;
            i.untilTieOrSlideEnd = o - s;
          }
        }
        if (t.isLetRing && this._settings.notation.notationMode === 0) {
          let n = t.beat,
            s = 0,
            a = t.beat.voice.bar.masterBar.calculateDuration();
          for (; n.nextBeat; ) {
            let o = n.nextBeat;
            if (o.isRest || (t.isStringed && o.hasNoteOnString(t.string)))
              break;
            if (
              ((n = n.nextBeat),
              (s =
                n.absolutePlaybackStart -
                t.beat.absolutePlaybackStart +
                n.playbackDuration),
              s > a)
            ) {
              s = a;
              break;
            }
          }
          n === t.beat ? (i.letRingEnd = e) : (i.letRingEnd = s);
        } else i.letRingEnd = i.untilTieOrSlideEnd;
        return i;
      }
      _applyStaticDuration(t, e, r) {
        let i = ((r * t) / I.MaxPosition) | 0;
        return Math.min(i, e);
      }
      static _getNoteVelocity(t) {
        let e = 0;
        switch (
          (!t.beat.voice.bar.staff.isPercussion && t.hammerPullOrigin && e--,
          t.isGhost && e--,
          t.accentuated)
        ) {
          case 1:
            e++;
            break;
          case 2:
            e += 2;
            break;
        }
        return E.dynamicToVelocity(t.dynamics, e);
      }
      _generateFade(t, e, r) {
        let i = t.voice.bar.staff.track;
        switch (t.fade) {
          case 1:
            this._generateFadeSteps(
              i,
              e,
              r,
              0,
              le._toChannelShort(i.playbackInfo.volume)
            );
            break;
          case 2:
            this._generateFadeSteps(
              i,
              e,
              r,
              le._toChannelShort(i.playbackInfo.volume),
              0
            );
            break;
          case 3:
            let n = (r / 2) | 0;
            this._generateFadeSteps(
              i,
              e,
              n,
              0,
              le._toChannelShort(i.playbackInfo.volume)
            ),
              this._generateFadeSteps(
                i,
                e + n,
                n,
                le._toChannelShort(i.playbackInfo.volume),
                0
              );
            break;
        }
      }
      _generateFadeSteps(t, e, r, i, n) {
        r = (r * 0.8) | 0;
        let a = (n - i) / r,
          o = (r / 120 + 1) | 0,
          l = e + r;
        for (let u = 0; u < o; u++) {
          let c = u === o - 1,
            d = c ? l : e + u * 120,
            h = c ? n : Math.round(i + (d - e) * a);
          this._handler.addControlChange(
            t.index,
            d,
            t.playbackInfo.primaryChannel,
            7,
            h
          ),
            this._handler.addControlChange(
              t.index,
              d,
              t.playbackInfo.secondaryChannel,
              7,
              h
            );
        }
      }
      _generateVibrato(t, e, r, i, n) {
        let s = 0,
          a = 0;
        switch (
          t.vibrato !== 0
            ? t.vibrato
            : t.isTieDestination
            ? t.tieOrigin.vibrato
            : 1
        ) {
          case 1:
            (s = this._settings.player.vibrato.noteSlightLength),
              (a = this._settings.player.vibrato.noteSlightAmplitude);
            break;
          case 2:
            (s = this._settings.player.vibrato.noteWideLength),
              (a = this._settings.player.vibrato.noteWideAmplitude);
            break;
          default:
            return;
        }
        let l = t.beat.voice.bar.staff.track,
          u = 0;
        if (t.isTieDestination && t.tieOrigin.hasBend) {
          let c = t.tieOrigin.bendPoints;
          u = c[c.length - 1].value;
        }
        this._generateVibratorWithParams(e, r.noteOnly, s, u, a, (c, d) => {
          this._handler.addNoteBend(l.index, c, n, i, d);
        });
      }
      _generateVibratorWithParams(t, e, r, i, n, s) {
        let a = this.vibratoResolution,
          o = (r / 2) | 0,
          l = t + e;
        for (; t < l; ) {
          let u = 0,
            c = t + r < l ? r : l - t;
          for (; u < c; ) {
            let d = i + n * Math.sin((u * Math.PI) / o);
            s((t + u) | 0, le.getPitchWheel(d)), (u += a);
          }
          t += r;
        }
        s(l | 0, le.getPitchWheel(i));
      }
      static getPitchWheel(t) {
        return Q.DefaultPitchWheel + (t / 2) * le._pitchValuePerSemitone;
      }
      _generateSlide(t, e, r, i, n, s) {
        let a = t.slideOutType === 2 ? r.noteOnly : r.untilTieOrSlideEnd,
          o = [],
          l = t.beat.voice.bar.staff.track,
          u = this._settings.player.slide.simpleSlidePitchOffset,
          c = Math.floor(
            I.MaxPosition * this._settings.player.slide.simpleSlideDurationRatio
          ),
          d = Math.floor(
            I.MaxPosition * this._settings.player.slide.shiftSlideDurationRatio
          );
        switch (t.slideInType) {
          case 2:
            o.push(new I(0, u)), o.push(new I(c, 0));
            break;
          case 1:
            o.push(new I(0, -u)), o.push(new I(c, 0));
            break;
        }
        switch (t.slideOutType) {
          case 2:
          case 1:
            o.push(new I(d, 0));
            let h =
              (t.slideTarget.calculateRealValue(
                this.applyTranspositionPitches,
                !0
              ) -
                t.calculateRealValue(this.applyTranspositionPitches, !0)) *
              2;
            o.push(new I(I.MaxPosition, h));
            break;
          case 4:
            o.push(new I(I.MaxPosition - c, 0)),
              o.push(new I(I.MaxPosition, -u));
            break;
          case 3:
            o.push(new I(I.MaxPosition - c, 0)),
              o.push(new I(I.MaxPosition, u));
            break;
        }
        this._generateWhammyOrBend(e, a, o, s, (h, f) => {
          this._handler.addNoteBend(l.index, h, n, i, f);
        });
      }
      _generateBend(t, e, r, i, n, s) {
        let a = t.bendPoints,
          o = t.beat.voice.bar.staff.track,
          l = (f, b) => {
            this._handler.addNoteBend(o.index, f, n, i, b);
          },
          u = null,
          c;
        if (
          t.isTieOrigin &&
          this._settings.notation.extendBendArrowsOnTiedNotes
        ) {
          let f = t;
          for (
            ;
            f.isTieOrigin &&
            !f.tieDestination.hasBend &&
            f.tieDestination.vibrato === 0;

          )
            f = f.tieDestination;
          c =
            f.beat.absolutePlaybackStart -
            t.beat.absolutePlaybackStart +
            this._getNoteDuration(f, f.beat.playbackDuration, s).noteOnly;
        } else if (t.isTieOrigin && t.beat.graceType !== 0) {
          switch (t.tieDestination.bendType) {
            case 2:
            case 4:
            case 7:
              u = t.tieDestination.bendPoints[1].value;
              break;
            case 6:
            case 8:
              u = t.tieDestination.bendPoints[0].value;
              break;
          }
          c = Math.max(
            r.noteOnly,
            E.millisToTicks(this._settings.player.songBookBendDuration, s)
          );
        } else c = r.noteOnly;
        a[0].value > 0 && !t.isContinuedBend && e > 0 && e--;
        let d = Math.min(
            c,
            E.millisToTicks(this._settings.player.songBookBendDuration, s)
          ),
          h = [];
        switch (t.bendType) {
          case 1:
            h = a;
            break;
          case 2:
          case 3:
            switch (t.bendStyle) {
              case 0:
                h = a;
                break;
              case 1:
                h.push(new I(0, t.bendPoints[0].value)),
                  (!u || u < t.bendPoints[1].value) &&
                    (u = t.bendPoints[1].value),
                  h.push(new I(I.MaxPosition, u));
                break;
              case 2:
                (!u || u < t.bendPoints[1].value) &&
                  (u = t.bendPoints[1].value),
                  t.beat.graceType === 3
                    ? this._generateSongBookWhammyOrBend(
                        e,
                        c,
                        !0,
                        [t.bendPoints[0].value, u],
                        d,
                        s,
                        l
                      )
                    : this._generateSongBookWhammyOrBend(
                        e,
                        c,
                        !1,
                        [t.bendPoints[0].value, u],
                        d,
                        s,
                        l
                      );
                return;
            }
            break;
          case 4:
            switch (t.bendStyle) {
              case 0:
                h = a;
                break;
              case 1:
                h.push(new I(0, t.bendPoints[0].value)),
                  h.push(new I((I.MaxPosition / 2) | 0, t.bendPoints[1].value)),
                  h.push(new I(I.MaxPosition, t.bendPoints[2].value));
                break;
              case 2:
                this._generateSongBookWhammyOrBend(
                  e,
                  c,
                  !1,
                  [
                    t.bendPoints[0].value,
                    t.bendPoints[1].value,
                    t.bendPoints[2].value,
                  ],
                  d,
                  s,
                  l
                );
                return;
            }
            break;
          case 5:
            h = a;
            break;
          case 6:
            h = a;
            break;
          case 7:
            switch (t.bendStyle) {
              case 0:
                h = a;
                break;
              case 1:
                h.push(new I(0, t.bendPoints[0].value)),
                  h.push(new I(I.MaxPosition, t.bendPoints[1].value));
                break;
              case 2:
                let f = le.getPitchWheel(t.bendPoints[0].value);
                l(e, f | 0),
                  (!u || u < t.bendPoints[1].value) &&
                    (u = t.bendPoints[1].value),
                  this._generateSongBookWhammyOrBend(
                    e,
                    c,
                    !1,
                    [t.bendPoints[0].value, u],
                    d,
                    s,
                    l
                  );
                return;
            }
            break;
          case 8:
            switch (t.bendStyle) {
              case 0:
                h = a;
                break;
              case 1:
                h.push(new I(0, t.bendPoints[0].value)),
                  h.push(new I(I.MaxPosition, t.bendPoints[1].value));
                break;
              case 2:
                let f = le.getPitchWheel(t.bendPoints[0].value);
                l(e, f | 0),
                  this._generateSongBookWhammyOrBend(
                    e,
                    c,
                    !1,
                    [t.bendPoints[0].value, t.bendPoints[1].value],
                    d,
                    s,
                    l
                  );
                return;
            }
            break;
        }
        this._generateWhammyOrBend(e, c, h, s, l);
      }
      _generateSongBookWhammyOrBend(t, e, r, i, n, s, a) {
        let o = r ? t : t + e - n,
          l = n / (i.length - 1);
        for (let u = 0; u < i.length - 1; u++) {
          let c = le.getPitchWheel(i[u]),
            d = le.getPitchWheel(i[u + 1]),
            h = o + l * u;
          this._generateBendValues(h, l, c, d, s, a);
        }
      }
      _generateWhammy(t, e, r, i, n) {
        let s = t.whammyBarPoints,
          a = t.voice.bar.staff.track,
          o = r.noteOnly;
        s[0].value > 0 && !t.isContinuedWhammy && e--;
        let l = (c, d) => {
            this._handler.addBend(a.index, c, i, d);
          },
          u = [];
        switch (t.whammyBarType) {
          case 1:
            u = s;
            break;
          case 2:
            switch (t.whammyStyle) {
              case 0:
                u = s;
                break;
              case 1:
                u.push(new I(0, s[0].value)),
                  u.push(new I(I.MaxPosition, s[1].value));
                break;
              case 2:
                let c = Math.min(
                  o,
                  E.millisToTicks(this._settings.player.songBookBendDuration, n)
                );
                this._generateSongBookWhammyOrBend(
                  e,
                  o,
                  !1,
                  [s[0].value, s[1].value],
                  c,
                  n,
                  l
                );
                return;
            }
            break;
          case 3:
            switch (t.whammyStyle) {
              case 0:
                u = s;
                break;
              case 1:
                u.push(new I(0, s[0].value)),
                  u.push(new I((I.MaxPosition / 2) | 0, s[1].value)),
                  u.push(new I(I.MaxPosition, s[2].value));
                break;
              case 2:
                let c = Math.min(
                  o,
                  E.millisToTicks(this._settings.player.songBookDipDuration, n)
                );
                this._generateSongBookWhammyOrBend(
                  e,
                  o,
                  !0,
                  [s[0].value, s[1].value, s[2].value],
                  c,
                  n,
                  l
                );
                return;
            }
            break;
          case 4:
            u = s;
            break;
          case 5:
            u = s;
            break;
          case 6:
            switch (t.whammyStyle) {
              case 0:
                u = s;
                break;
              case 1:
                u.push(new I(0, s[0].value)),
                  u.push(new I((I.MaxPosition / 2) | 0, s[0].value)),
                  u.push(new I(I.MaxPosition, s[1].value));
                break;
              case 2:
                let c = le.getPitchWheel(s[0].value);
                this._handler.addBend(a.index, e, i, c | 0);
                let d = Math.min(
                  o,
                  E.millisToTicks(this._settings.player.songBookBendDuration, n)
                );
                this._generateSongBookWhammyOrBend(
                  e,
                  o,
                  !1,
                  [s[0].value, s[1].value],
                  d,
                  n,
                  l
                );
                return;
            }
            break;
        }
        this._generateWhammyOrBend(e, o, u, n, l);
      }
      _generateWhammyOrBend(t, e, r, i, n) {
        let s = e / I.MaxPosition;
        for (let a = 0; a < r.length - 1; a++) {
          let o = r[a],
            l = r[a + 1],
            u = le.getPitchWheel(o.value),
            c = le.getPitchWheel(l.value),
            d = s * (l.offset - o.offset),
            h = t + s * o.offset;
          this._generateBendValues(h, d, u, c, i, n);
        }
      }
      _generateBendValues(t, e, r, i, n, s) {
        let a = E.ticksToMillis(e, n),
          o = Math.abs(i - r) / le._pitchValuePerSemitone,
          l = Math.max(
            le._minBreakpointsPerSemitone * o,
            a / le._millisecondsPerBreakpoint
          ),
          u = e / l,
          c = (i - r) / l,
          d = t + e;
        for (let h = 0; h < l; h++) s(t | 0, Math.round(r)), (r += c), (t += u);
        s(d | 0, i);
      }
      _generateRasgueado(t, e, r, i, n, s, a) {
        let o = r;
        for (let l = 0; l < a.durations.length; l++) {
          let u = a.brushInfos[l],
            c = e.isStringed && e.string <= u.length ? u[e.string - 1] : 0,
            d = a.durations[l];
          this._handler.addNote(t.index, o + c, d - c, i, n, s), (o += d);
        }
      }
      _generateTrill(t, e, r, i, n, s) {
        let a = t.beat.voice.bar.staff.track,
          o = t.stringTuning + t.trillFret,
          l = E.toTicks(t.trillSpeed),
          u = !0,
          c = e,
          d = e + r.untilTieOrSlideEnd;
        for (; c + 10 < d; )
          c + l >= d && (l = d - c),
            this._handler.addNote(a.index, c, l, u ? o : i, n, s),
            (u = !u),
            (c += l);
      }
      _generateTremoloPicking(t, e, r, i, n, s) {
        let a = t.beat.voice.bar.staff.track,
          o = E.toTicks(t.beat.tremoloSpeed),
          l = e,
          u = e + r.untilTieOrSlideEnd;
        for (; l + 10 < u; )
          l + o >= u && (o = u - l),
            this._handler.addNote(a.index, l, o, i, n, s),
            (l += o);
      }
      _getRasgueadoInfo(t, e) {
        if (!t.hasRasgueado) return null;
        let r = new ih(),
          n = le._rasgueadoDurations
            .get(t.rasgueado)
            .reduce((u, c) => u + c, 0);
        (r.durations = le._rasgueadoDurations
          .get(t.rasgueado)
          .map((u) => (e * u) / n)),
          (r.brushInfos = new Array(r.durations.length));
        let s = E.toTicks(16),
          a = 0,
          o = 0;
        for (let u of t.notes)
          u.isTieDestination || ((a |= 1 << (u.string - 1)), o++);
        let l = le._rasgueadoDirections.get(t.rasgueado);
        for (let u = 0; u < r.durations.length; u++) {
          let c = (r.durations[u] * s) / E.QuarterTime,
            d = new Int32Array(t.voice.bar.staff.tuning.length);
          r.brushInfos[u] = d;
          let h = l[u];
          h !== 0 && this._fillBrushInfo(t, d, h === 4 || h === 2, a, o, c);
        }
        return r;
      }
      _getBrushInfo(t) {
        let e = new Int32Array(t.voice.bar.staff.tuning.length);
        if (t.brushType) {
          let r = 0,
            i = 0;
          for (let n of t.notes)
            n.isTieDestination || ((r |= 1 << (n.string - 1)), i++);
          this._fillBrushInfo(
            t,
            e,
            t.brushType === 4 || t.brushType === 2,
            r,
            i,
            t.brushDuration
          );
        }
        return e;
      }
      _fillBrushInfo(t, e, r, i, n, s) {
        if (t.notes.length > 0) {
          let a = 0,
            o = (s / (n - 1)) | 0;
          for (let l = 0; l < t.voice.bar.staff.tuning.length; l++) {
            let u = r ? l : e.length - 1 - l;
            (i & (1 << u)) !== 0 && ((e[u] = a), (a += o));
          }
        }
        return e;
      }
      _generateNonTempoAutomation(t, e, r) {
        switch (e.type) {
          case 2:
            this._addProgramChange(
              t.voice.bar.staff.track,
              t.playbackStart + r,
              t.voice.bar.staff.track.playbackInfo.primaryChannel,
              (e.value | 0) & 255
            ),
              this._addProgramChange(
                t.voice.bar.staff.track,
                t.playbackStart + r,
                t.voice.bar.staff.track.playbackInfo.secondaryChannel,
                (e.value | 0) & 255
              );
            break;
          case 4:
            this._addBankChange(
              t.voice.bar.staff.track,
              t.playbackStart + r,
              t.voice.bar.staff.track.playbackInfo.primaryChannel,
              e.value
            ),
              this._addBankChange(
                t.voice.bar.staff.track,
                t.playbackStart + r,
                t.voice.bar.staff.track.playbackInfo.secondaryChannel,
                e.value
              );
            break;
          case 3:
            let i = le._toChannelShort(e.value);
            this._handler.addControlChange(
              t.voice.bar.staff.track.index,
              t.playbackStart + r,
              t.voice.bar.staff.track.playbackInfo.primaryChannel,
              10,
              i
            ),
              this._handler.addControlChange(
                t.voice.bar.staff.track.index,
                t.playbackStart + r,
                t.voice.bar.staff.track.playbackInfo.secondaryChannel,
                10,
                i
              );
            break;
          case 1:
            let n = le._toChannelShort(e.value);
            this._handler.addControlChange(
              t.voice.bar.staff.track.index,
              t.playbackStart + r,
              t.voice.bar.staff.track.playbackInfo.primaryChannel,
              7,
              n
            ),
              this._handler.addControlChange(
                t.voice.bar.staff.track.index,
                t.playbackStart + r,
                t.voice.bar.staff.track.playbackInfo.secondaryChannel,
                7,
                n
              );
            break;
        }
      }
      prepareSingleBeat(t) {
        let e = -1,
          r = -1,
          i = t;
        for (; i && (e === -1 || r === -1); ) {
          for (let u of t.automations)
            switch (u.type) {
              case 2:
                r = u.value;
                break;
              case 0:
                e = u.value;
                break;
            }
          i = i.previousBeat;
        }
        let n = t.voice.bar.staff.track,
          s = t.voice.bar.masterBar;
        e === -1 && (e = s.score.tempo);
        let a = t.playbackStart / s.calculateDuration();
        for (let u of s.tempoAutomations)
          if (u.ratioPosition <= a) e = u.value;
          else break;
        r === -1 && (r = n.playbackInfo.program);
        let o = n.playbackInfo.volume;
        this._generateTrack(n),
          this._handler.addTimeSignature(
            0,
            s.timeSignatureNumerator,
            s.timeSignatureDenominator
          ),
          this._handler.addTempo(0, e);
        let l = le._toChannelShort(o);
        return (
          this._handler.addControlChange(
            0,
            0,
            n.playbackInfo.primaryChannel,
            7,
            l
          ),
          this._handler.addControlChange(
            0,
            0,
            n.playbackInfo.secondaryChannel,
            7,
            l
          ),
          e
        );
      }
      generateSingleBeat(t) {
        let e = this.prepareSingleBeat(t);
        this._generateBeat(t, -t.playbackStart, t.voice.bar, e);
      }
      generateSingleNote(t) {
        let e = this.prepareSingleBeat(t.beat);
        this._generateNote(
          t,
          0,
          t.beat.playbackDuration,
          e,
          new Int32Array(t.beat.voice.bar.staff.tuning.length),
          null
        );
      }
    };
  (le._defaultDurationDead = 30),
    (le._defaultDurationPalmMute = 80),
    (le._ornamentKeysUp = [2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 1, 1]),
    (le.ornamentKeysDown = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1]),
    (le._pitchBendRangeInSemitones = 16),
    (le._pitchValuePerSemitone =
      Q.DefaultPitchWheel / le._pitchBendRangeInSemitones),
    (le._minBreakpointsPerSemitone = 6),
    (le._millisecondsPerBreakpoint = 150),
    (le._rasgueadoDirections = new Map([
      [1, [2, 1]],
      [2, [2, 2]],
      [3, [2, 2, 1]],
      [4, [2, 2, 1]],
      [5, [1, 2, 2]],
      [6, [1, 2, 2]],
      [7, [1, 2, 2]],
      [8, [1, 2, 2]],
      [9, [1, 2, 2]],
      [10, [1, 2, 2]],
      [11, [2, 2, 2]],
      [12, [2, 2, 2]],
      [13, [0, 2, 1]],
      [14, [2, 2, 2, 1]],
      [15, [2, 2, 2, 1]],
      [16, [2, 2, 2, 2]],
      [17, [2, 2, 2, 2, 1]],
      [18, [2, 2, 2, 2, 1]],
    ])),
    (le._rasgueadoDurations = new Map([
      [1, [E.toTicks(8), E.toTicks(8)]],
      [2, [E.toTicks(8), E.toTicks(8)]],
      [3, [E.toTicks(8) / 3, E.toTicks(8) / 3, E.toTicks(8) / 3]],
      [4, [E.toTicks(16), E.toTicks(16), E.toTicks(8)]],
      [5, [E.toTicks(8) / 3, E.toTicks(8) / 3, E.toTicks(8) / 3]],
      [6, [E.toTicks(16) / 3, E.toTicks(16) / 3, E.toTicks(8) / 3]],
      [7, [E.toTicks(8) / 3, E.toTicks(8) / 3, E.toTicks(8) / 3]],
      [8, [E.toTicks(16), E.toTicks(16), E.toTicks(8)]],
      [9, [E.toTicks(8) / 3, E.toTicks(8) / 3, E.toTicks(8) / 3]],
      [10, [E.toTicks(16), E.toTicks(16), E.toTicks(8)]],
      [11, [E.toTicks(8) / 3, E.toTicks(8) / 3, E.toTicks(8) / 3]],
      [12, [E.toTicks(16) / 3, E.toTicks(16) / 3, E.toTicks(8) / 3]],
      [13, [E.toTicks(16) / 3, E.toTicks(16) / 3, E.toTicks(8) / 3]],
      [
        14,
        [E.toTicks(16) / 3, E.toTicks(16) / 3, E.toTicks(16) / 3, E.toTicks(8)],
      ],
      [
        15,
        [E.toTicks(16) / 3, E.toTicks(16) / 3, E.toTicks(16) / 3, E.toTicks(8)],
      ],
      [16, [E.toTicks(16), E.toTicks(16), E.toTicks(16), E.toTicks(16)]],
      [
        17,
        [
          E.toTicks(16) / 5,
          E.toTicks(16) / 5,
          E.toTicks(16) / 5,
          E.toTicks(16) / 5,
          E.toTicks(16) / 5,
        ],
      ],
      [
        18,
        [
          E.toTicks(16) / 5,
          E.toTicks(16) / 5,
          E.toTicks(16) / 5,
          E.toTicks(16) / 5,
          E.toTicks(16) / 5,
        ],
      ],
    ]));
  var Er = le;
  var vs = class {
    constructor() {
      this.oldWidth = 0;
      this.newWidth = 0;
      this.settings = null;
    }
  };
  var ue = class {
    constructor(t, e) {
      this.width = 0;
      this.height = 0;
      (this.x = t), (this.y = e);
    }
    getBoundingBoxTop() {
      return this.y;
    }
    doLayout() {}
    paint(t, e, r) {}
  };
  var Ve = class extends ue {
    constructor(e = 0, r = 0) {
      super(e, r);
      this.beat = null;
      this.nextGlyph = null;
      this.previousGlyph = null;
    }
  };
  var ce = class extends Ve {
      constructor(e, r, i, n) {
        super(e, r);
        this.glyphScale = 0;
        this.center = !1;
        this.offsetX = 0;
        this.offsetY = 0;
        (this.glyphScale = i), (this.symbol = n);
      }
      getBoundingBoxTop() {
        let e = this.renderer.smuflMetrics.glyphTop.get(this.symbol);
        return this.y - this.offsetY - e;
      }
      doLayout() {
        (this.width =
          this.renderer.smuflMetrics.glyphWidths.get(this.symbol) *
          this.glyphScale),
          (this.height =
            this.renderer.smuflMetrics.glyphHeights.get(this.symbol) *
            this.glyphScale);
      }
      paint(e, r, i) {
        if (this.width === 0 && this.height === 0) return;
        let n = i.color;
        this.colorOverride && (i.color = this.colorOverride),
          i.fillMusicFontSymbol(
            e + this.x + this.offsetX,
            r + this.y + this.offsetY,
            this.glyphScale,
            this.symbol,
            this.center
          ),
          (i.color = n);
      }
    },
    Qu = class extends Ve {
      constructor(e, r, i, n) {
        super(e, r);
        this.glyphScale = 0;
        this.center = !1;
        this.offsetX = 0;
        this.offsetY = 0;
        (this.glyphScale = i), (this.symbols = n);
      }
      getBoundingBoxTop() {
        let e = 0;
        for (let r = 0; r < this.symbols.length; r++) {
          let i = this.renderer.smuflMetrics.glyphTop.get(this.symbols[r]);
          (r === 0 || i < e) && (e = i);
        }
        return this.y - this.offsetY - e;
      }
      doLayout() {
        (this.width = 0), (this.height = 0);
        for (let e = 0; e < this.symbols.length; e++) {
          let r =
              this.renderer.smuflMetrics.glyphWidths.get(this.symbols[e]) *
              this.glyphScale,
            i =
              this.renderer.smuflMetrics.glyphHeights.get(this.symbols[e]) *
              this.glyphScale;
          (e === 0 || r > this.width) && (this.width = r),
            (e === 0 || i > this.height) && (this.height = i);
        }
      }
      paint(e, r, i) {
        if (this.width === 0 && this.height === 0) return;
        let n = i.color;
        this.colorOverride && (i.color = this.colorOverride),
          i.fillMusicFontSymbols(
            e + this.x + this.offsetX,
            r + this.y + this.offsetY,
            this.glyphScale,
            this.symbols,
            this.center
          ),
          (i.color = n);
      }
    };
  var Sl = class Sl extends ce {
    constructor(e, r, i, n) {
      super(e, r, n ? Sl.GraceScale : 1, Sl.getSymbol(i));
      this.centerOnStem = !1;
    }
    paint(e, r, i) {
      this.centerOnStem && (this.center = !0), super.paint(e, r, i);
    }
    static getSymbol(e) {
      switch (e) {
        case -4:
          return 57505;
        case -2:
          return 57504;
        case 1:
          return 57506;
        case 2:
          return 57507;
        default:
          return 57508;
      }
    }
  };
  Sl.GraceScale = 0.75;
  var ie = Sl;
  var Pa = class p extends ce {
    constructor(t, e, r, i, n) {
      super(t, e, n ? ie.GraceScale : 1, p.getSymbol(r, i, n));
    }
    static getSymbol(t, e, r) {
      if ((r && (t = 8), e === 0))
        switch (t) {
          case 8:
            return 57920;
          case 16:
            return 57922;
          case 32:
            return 57924;
          case 64:
            return 57926;
          case 128:
            return 57928;
          case 256:
            return 57930;
          default:
            return 57920;
        }
      switch (t) {
        case 8:
          return 57921;
        case 16:
          return 57923;
        case 32:
          return 57925;
        case 64:
          return 57927;
        case 128:
          return 57929;
        case 256:
          return 57929;
        default:
          return 57921;
      }
    }
  };
  var ft = class p extends ue {
    constructor(e, r) {
      super(0, 0);
      this.ties = [];
      this.minWidth = 0;
      (this.beat = e), (this.ties = []), (this.voiceContainer = r);
    }
    get onTimeX() {
      return this.onNotes.x + this.onNotes.centerX;
    }
    addTie(e) {
      (e.renderer = this.renderer), this.ties.push(e);
    }
    drawBeamHelperAsFlags(e) {
      return e.hasFlag(!1, void 0);
    }
    registerLayoutingInfo(e) {
      let r = this.preNotes.computedWidth + this.onNotes.centerX,
        i = this.onNotes.computedWidth - this.onNotes.centerX,
        n = this.renderer.helpers.getBeamingHelperForBeat(this.beat);
      this.beat.graceType !== 0
        ? (i +=
            this.renderer.smuflMetrics.glyphWidths.get(57920) * ie.GraceScale)
        : n &&
          this.drawBeamHelperAsFlags(n) &&
          (i +=
            this.renderer.smuflMetrics.glyphWidths.get(57920) * ie.GraceScale);
      for (let s of this.ties) i += s.width;
      e.addBeatSpring(this.beat, r, i);
    }
    applyLayoutingInfo(e) {
      this.onNotes.updateBeamingHelper(), this.updateWidth();
    }
    doLayout() {
      (this.preNotes.x = 0),
        (this.preNotes.renderer = this.renderer),
        (this.preNotes.container = this),
        this.preNotes.doLayout(),
        (this.onNotes.x = this.preNotes.x + this.preNotes.width),
        (this.onNotes.renderer = this.renderer),
        (this.onNotes.container = this),
        this.onNotes.doLayout(),
        this.onNotes.updateBeamingHelper();
      let e = this.beat.notes.length - 1;
      for (; e >= 0; ) this.createTies(this.beat.notes[e--]);
      this.renderer.registerTies(this.ties), this.updateWidth();
    }
    updateWidth() {
      if (
        ((this.minWidth = this.preNotes.width + this.onNotes.width),
        !this.beat.isRest &&
          this.onNotes.beamingHelper.beats.length === 1 &&
          this.beat.duration >= 8)
      ) {
        let r = Pa.getSymbol(
          this.beat.duration,
          this.onNotes.beamingHelper.direction,
          this.beat.graceType !== 0
        );
        this.minWidth += this.renderer.smuflMetrics.glyphWidths.get(r);
      }
      let e = 0;
      for (let r of this.ties) r.width > e && (e = r.width);
      (this.minWidth += e), (this.width = this.minWidth);
    }
    scaleToWidth(e) {
      this.onNotes.updateBeamingHelper(), (this.width = e);
    }
    createTies(e) {}
    static getGroupId(e) {
      return `b${e.id}`;
    }
    paint(e, r, i) {
      if (
        this.preNotes.isEmpty &&
        this.onNotes.isEmpty &&
        this.ties.length === 0
      )
        return;
      i.beginGroup(p.getGroupId(this.beat)),
        this.preNotes.paint(e + this.x, r + this.y, i),
        this.onNotes.paint(e + this.x, r + this.y, i);
      let s = e - this.voiceContainer.x - this.renderer.x,
        a = r - this.voiceContainer.y - this.renderer.y;
      for (let o = 0, l = this.ties.length; o < l; o++) {
        let u = this.ties[o];
        (u.renderer = this.renderer), u.paint(s, a, i);
      }
      i.endGroup();
    }
    buildBoundingsLookup(e, r, i, n) {
      let s = new gn();
      if (((s.beat = this.beat), this.beat.isEmpty))
        (s.visualBounds = new we()),
          (s.visualBounds.x = r + this.x),
          (s.visualBounds.y = e.visualBounds.y),
          (s.visualBounds.w = this.width),
          (s.visualBounds.h = e.visualBounds.h),
          (s.realBounds = new we()),
          (s.realBounds.x = r + this.x),
          (s.realBounds.y = e.realBounds.y),
          (s.realBounds.w = this.width),
          (s.realBounds.h = e.realBounds.h),
          (s.onNotesX = r + this.x + this.onNotes.centerX);
      else {
        (s.visualBounds = new we()),
          (s.visualBounds.x = r + this.x),
          this.preNotes.isEmpty
            ? this.onNotes.isEmpty
              ? (s.visualBounds.x = r + this.x)
              : (s.visualBounds.x = r + this.x + this.onNotes.x)
            : (s.visualBounds.x = r + this.x + this.preNotes.x);
        let a = 0;
        this.onNotes.isEmpty
          ? this.preNotes.isEmpty
            ? (a = r + this.x + this.width)
            : (a = r + this.x + this.preNotes.x + this.preNotes.width)
          : (a = r + this.x + this.onNotes.x + this.onNotes.width),
          (s.visualBounds.w = a - s.visualBounds.x);
        let o = this.renderer.helpers.getBeamingHelperForBeat(this.beat);
        ((o && this.drawBeamHelperAsFlags(o)) || this.beat.graceType !== 0) &&
          (s.visualBounds.w +=
            this.renderer.smuflMetrics.glyphWidths.get(57920) *
            (this.beat.graceType !== 0 ? ie.GraceScale : 1)),
          (s.visualBounds.y = e.visualBounds.y),
          (s.visualBounds.h = e.visualBounds.h),
          (s.realBounds = new we()),
          (s.realBounds.x = r + this.x),
          (s.realBounds.y = e.realBounds.y),
          (s.realBounds.w = this.width),
          (s.realBounds.h = e.realBounds.h),
          (s.onNotesX = r + this.x + this.onNotes.x + this.onNotes.centerX);
      }
      e.addBeat(s),
        this.renderer.settings.core.includeNoteBounds &&
          this.onNotes.buildBoundingsLookup(s, r + this.x, i + this.y);
    }
  };
  var Zu = class {
    constructor() {
      this._width = 0;
      this._score = null;
      this._trackIndexes = null;
      this.preRender = new Z();
      this.renderFinished = new Z();
      this.partialRenderFinished = new Z();
      this.partialLayoutFinished = new Z();
      this.postRenderFinished = new Be();
      this.error = new Z();
    }
    get instance() {
      return this._instance;
    }
    set instance(t) {
      this._instance = t;
      let e = this._instanceEventUnregister;
      if (e) for (let r of e) r();
      if (t) {
        let r = [];
        r.push(t.preRender.on((i) => this.preRender.trigger(i))),
          r.push(t.renderFinished.on((i) => this.renderFinished.trigger(i))),
          r.push(
            t.partialRenderFinished.on((i) =>
              this.partialRenderFinished.trigger(i)
            )
          ),
          r.push(
            t.partialLayoutFinished.on((i) =>
              this.partialLayoutFinished.trigger(i)
            )
          ),
          r.push(
            t.postRenderFinished.on(() => this.postRenderFinished.trigger())
          ),
          r.push(t.error.on((i) => this.error.trigger(i))),
          (this._instanceEventUnregister = r),
          this._settings && t.updateSettings(this._settings),
          (t.width = this._width),
          this._score !== null &&
            t.renderScore(this._score, this._trackIndexes);
      } else this._instanceEventUnregister = void 0;
    }
    get boundsLookup() {
      return this._instance ? this._instance.boundsLookup : null;
    }
    get width() {
      return this._instance ? this._instance.width : 0;
    }
    set width(t) {
      (this._width = t), this._instance && (this._instance.width = t);
    }
    render() {
      this._instance?.render();
    }
    resizeRender() {
      this._instance?.resizeRender();
    }
    renderScore(t, e) {
      (this._score = t),
        (this._trackIndexes = e),
        this._instance?.renderScore(t, e);
    }
    renderResult(t) {
      this._instance?.renderResult(t);
    }
    updateSettings(t) {
      (this._settings = t), this._instance?.updateSettings(t);
    }
    destroy() {
      this._instance?.destroy(), (this._instance = void 0);
    }
  };
  var _s = class {
    constructor(t) {
      this.activeBeats = t;
    }
  };
  var ju = class {
    constructor() {
      this._masterVolume = 1;
      this._metronomeVolume = 0;
      this._countInVolume = 0;
      this._playbackSpeed = 1;
      this._isLooping = !1;
      this._midiEventsPlayedFilter = [];
      this.finished = new Be();
      this.soundFontLoaded = new Be();
      this.soundFontLoadFailed = new Z();
      this.midiLoadFailed = new Z();
      this.midiEventsPlayed = new Z();
      (this.ready = new Be(() => this.isReady)),
        (this.readyForPlayback = new Be(() => this.isReadyForPlayback)),
        (this.midiLoaded = new Z(() => this._instance?.loadedMidiInfo ?? null)),
        (this.stateChanged = new Z(() => new Or(this.state, !1))),
        (this.positionChanged = new Z(() => this.currentPosition)),
        (this.playbackRangeChanged = new Z(() => {
          let t = this.playbackRange;
          return t ? new fi(t) : null;
        }));
    }
    get instance() {
      return this._instance;
    }
    set instance(t) {
      this._instance = t;
      let e = this._instanceEventUnregister;
      if (e) for (let r of e) r();
      if (t) {
        let r = [];
        r.push(t.ready.on(() => this.ready.trigger())),
          r.push(t.readyForPlayback.on(() => this.readyForPlayback.trigger())),
          r.push(t.finished.on(() => this.finished.trigger())),
          r.push(t.soundFontLoaded.on(() => this.soundFontLoaded.trigger())),
          r.push(
            t.soundFontLoadFailed.on((i) => this.soundFontLoadFailed.trigger(i))
          ),
          r.push(
            t.midiLoaded.on((i) => {
              this.midiLoaded.trigger(i);
            })
          ),
          r.push(t.midiLoadFailed.on((i) => this.midiLoadFailed.trigger(i))),
          r.push(t.stateChanged.on((i) => this.stateChanged.trigger(i))),
          r.push(
            t.positionChanged.on((i) => {
              this.positionChanged.trigger(i);
            })
          ),
          r.push(
            t.midiEventsPlayed.on((i) => this.midiEventsPlayed.trigger(i))
          ),
          r.push(
            t.playbackRangeChanged.on((i) =>
              this.playbackRangeChanged.trigger(i)
            )
          ),
          (this._instanceEventUnregister = r),
          this.isReady
            ? ((t.masterVolume = this._masterVolume),
              (t.metronomeVolume = this._metronomeVolume),
              (t.countInVolume = this._countInVolume),
              (t.playbackSpeed = this._playbackSpeed),
              (t.isLooping = this._isLooping),
              (t.midiEventsPlayedFilter = this._midiEventsPlayedFilter),
              this.ready.trigger())
            : r.push(
                t.ready.on(() => {
                  (t.masterVolume = this._masterVolume),
                    (t.metronomeVolume = this._metronomeVolume),
                    (t.countInVolume = this._countInVolume),
                    (t.playbackSpeed = this._playbackSpeed),
                    (t.isLooping = this._isLooping),
                    (t.midiEventsPlayedFilter = this._midiEventsPlayedFilter);
                })
              );
      } else this._instanceEventUnregister = void 0;
    }
    get output() {
      return this._instance.output;
    }
    get isReady() {
      return this._instance ? this._instance.isReady : !1;
    }
    get isReadyForPlayback() {
      return this._instance ? this._instance.isReadyForPlayback : !1;
    }
    get state() {
      return this._instance ? this._instance.state : 0;
    }
    get logLevel() {
      return w.logLevel;
    }
    set logLevel(t) {
      (w.logLevel = t), this._instance && (this._instance.logLevel = t);
    }
    get masterVolume() {
      return this._masterVolume;
    }
    set masterVolume(t) {
      (t = Math.max(t, Q.MinVolume)),
        (this._masterVolume = t),
        this._instance && (this._instance.masterVolume = t);
    }
    get metronomeVolume() {
      return this._metronomeVolume;
    }
    set metronomeVolume(t) {
      (t = Math.max(t, Q.MinVolume)),
        (this._metronomeVolume = t),
        this._instance && (this._instance.metronomeVolume = t);
    }
    get playbackSpeed() {
      return this._playbackSpeed;
    }
    set playbackSpeed(t) {
      (this._playbackSpeed = t),
        this._instance && (this._instance.playbackSpeed = t);
    }
    get loadedMidiInfo() {
      return this._instance ? this._instance.loadedMidiInfo : void 0;
    }
    get currentPosition() {
      return this._instance
        ? this._instance.currentPosition
        : new er(0, 0, 0, 0, !1, 120, 120);
    }
    get tickPosition() {
      return this._instance ? this._instance.tickPosition : 0;
    }
    set tickPosition(t) {
      this._instance && (this._instance.tickPosition = t);
    }
    get timePosition() {
      return this._instance ? this._instance.timePosition : 0;
    }
    set timePosition(t) {
      this._instance && (this._instance.timePosition = t);
    }
    get playbackRange() {
      return this._instance ? this._instance.playbackRange : null;
    }
    set playbackRange(t) {
      this._instance && (this._instance.playbackRange = t);
    }
    get isLooping() {
      return this._isLooping;
    }
    set isLooping(t) {
      (this._isLooping = t), this._instance && (this._instance.isLooping = t);
    }
    get countInVolume() {
      return this._countInVolume;
    }
    set countInVolume(t) {
      (this._countInVolume = t),
        this._instance && (this._instance.countInVolume = t);
    }
    get midiEventsPlayedFilter() {
      return this._midiEventsPlayedFilter;
    }
    set midiEventsPlayedFilter(t) {
      (this._midiEventsPlayedFilter = t),
        this._instance && (this._instance.midiEventsPlayedFilter = t);
    }
    destroy() {
      this._instance && (this._instance.destroy(), (this._instance = void 0));
    }
    play() {
      return this._instance ? this._instance.play() : !1;
    }
    pause() {
      this._instance && this._instance.pause();
    }
    playPause() {
      this._instance && this._instance.playPause();
    }
    stop() {
      this._instance && this._instance.stop();
    }
    playOneTimeMidiFile(t) {
      this._instance && this._instance.playOneTimeMidiFile(t);
    }
    loadSoundFont(t, e) {
      this._instance && this._instance.loadSoundFont(t, e);
    }
    resetSoundFonts() {
      this._instance && this._instance.resetSoundFonts();
    }
    loadMidiFile(t) {
      this._instance && this._instance.loadMidiFile(t);
    }
    loadBackingTrack(t) {
      this._instance && this._instance.loadBackingTrack(t);
    }
    updateSyncPoints(t) {
      this._instance && this._instance.updateSyncPoints(t);
    }
    applyTranspositionPitches(t) {
      this._instance && this._instance.applyTranspositionPitches(t);
    }
    setChannelTranspositionPitch(t, e) {
      this._instance && this._instance.setChannelTranspositionPitch(t, e);
    }
    setChannelMute(t, e) {
      this._instance && this._instance.setChannelMute(t, e);
    }
    resetChannelStates() {
      this._instance && this._instance.resetChannelStates();
    }
    setChannelSolo(t, e) {
      this._instance && this._instance.setChannelSolo(t, e);
    }
    setChannelVolume(t, e) {
      this._instance && this._instance.setChannelVolume(t, e);
    }
  };
  var sh = class {
      constructor() {
        this._midiEventQueue = new Vn();
        this.masterVolume = 1;
        this.metronomeVolume = 0;
        this.outSampleRate = 44100;
        this.currentTempo = 120;
        this.timeSignatureNumerator = 4;
        this.timeSignatureDenominator = 4;
        this.activeVoiceCount = 0;
      }
      noteOffAll(t) {}
      resetSoft() {}
      resetPresets() {}
      loadPresets(t, e, r, i) {}
      setupMetronomeChannel(t) {}
      synthesizeSilent(t) {
        this.fakeSynthesize();
      }
      _processMidiMessage(t) {}
      dispatchEvent(t) {
        this._midiEventQueue.enqueue(t);
      }
      synthesize(t, e, r) {
        return this.fakeSynthesize();
      }
      fakeSynthesize() {
        let t = [];
        for (; !this._midiEventQueue.isEmpty; ) {
          let e = this._midiEventQueue.dequeue();
          (e.isMetronome && this.metronomeVolume > 0) ||
            (e.event && this._processMidiMessage(e.event)),
            t.push(e);
        }
        return t;
      }
      applyTranspositionPitches(t) {}
      setChannelTranspositionPitch(t, e) {}
      channelSetMute(t, e) {}
      channelSetSolo(t, e) {}
      resetChannelStates() {}
      channelSetMixVolume(t, e) {}
      hasSamplesForProgram(t) {
        return !0;
      }
      hasSamplesForPercussion(t) {
        return !0;
      }
    },
    Aa = class extends Ss {
      constructor(t, e) {
        super(t, new sh(), e),
          (this.synthesizer.output = t),
          (this._backingTrackOutput = t),
          t.timeUpdate.on((r) => {
            let i = this.sequencer.mainTimePositionFromBackingTrack(
              r,
              t.backingTrackDuration
            );
            this.sequencer.fillMidiEventQueueToEndTime(i),
              this.synthesizer.fakeSynthesize(),
              this.updateTimePosition(i, !1),
              this.checkForFinish();
          });
      }
      updateMasterVolume(t) {
        super.updateMasterVolume(t),
          (this._backingTrackOutput.masterVolume = t);
      }
      updatePlaybackSpeed(t) {
        super.updatePlaybackSpeed(t),
          (this._backingTrackOutput.playbackRate = t);
      }
      onSampleRequest() {}
      loadMidiFile(t) {
        this.isSoundFontLoaded ||
          ((this.isSoundFontLoaded = !0), this.soundFontLoaded.trigger()),
          super.loadMidiFile(t);
      }
      updateTimePosition(t, e) {
        super.updateTimePosition(t, e),
          e &&
            this._backingTrackOutput.seekTo(
              this.sequencer.mainTimePositionToBackingTrack(
                t,
                this._backingTrackOutput.backingTrackDuration
              )
            );
      }
      loadBackingTrack(t) {
        let e = t.backingTrack;
        e &&
          (this._backingTrackOutput.loadBackingTrack(e),
          (this.timePosition = 0));
      }
      updateSyncPoints(t) {
        this.sequencer.mainUpdateSyncPoints(t),
          (this.tickPosition = this.tickPosition);
      }
    };
  var ah = class {
      constructor() {
        this.sampleRate = 44100;
        this._seekPosition = 0;
        this.ready = new Be();
        this.samplesPlayed = new Z();
        this.timeUpdate = new Z();
        this.sampleRequest = new Be();
      }
      get handler() {
        return this._handler;
      }
      set handler(t) {
        t &&
          this._seekPosition !== 0 &&
          (t.seekTo(this._seekPosition), (this._seekPosition = 0)),
          (this._handler = t);
      }
      get backingTrackDuration() {
        return this.handler?.backingTrackDuration ?? 0;
      }
      get playbackRate() {
        return this.handler?.playbackRate ?? 1;
      }
      set playbackRate(t) {
        let e = this.handler;
        e && (e.playbackRate = t);
      }
      get masterVolume() {
        return this.handler?.masterVolume ?? 1;
      }
      set masterVolume(t) {
        let e = this.handler;
        e && (e.masterVolume = t);
      }
      seekTo(t) {
        let e = this.handler;
        e ? e.seekTo(t) : (this._seekPosition = t);
      }
      loadBackingTrack(t) {}
      open(t) {
        this.ready.trigger();
      }
      updatePosition(t) {
        this.timeUpdate.trigger(t);
      }
      play() {
        this.handler?.play();
      }
      destroy() {}
      pause() {
        this.handler?.pause();
      }
      addSamples(t) {}
      resetSamples() {}
      activate() {}
      async enumerateOutputDevices() {
        return [];
      }
      async setOutputDevice(t) {}
      async getOutputDevice() {
        return null;
      }
    },
    ec = class extends Aa {
      get handler() {
        return this.output.handler;
      }
      set handler(t) {
        this.output.handler = t;
      }
      constructor(t) {
        super(new ah(), t);
      }
    };
  var Ca = class {
    constructor() {
      this.startTick = 0;
      this.endTick = 0;
    }
  };
  var Ma = class {
      constructor(t) {
        this.bounds = null;
        this.beat = t;
      }
    },
    Ia = class {
      constructor(t, e) {
        this._startTime = 0;
        this._trackIndexes = null;
        this._trackIndexLookup = null;
        this._isDestroyed = !1;
        this._score = null;
        this._tracks = [];
        this._actualPlayerMode = 0;
        this._tickCache = null;
        this._cursorWrapper = null;
        this._barCursor = null;
        this._beatCursor = null;
        this._selectionWrapper = null;
        this._previousTick = 0;
        this._currentBeat = null;
        this._currentBeatBounds = null;
        this._isInitialBeatCursorUpdate = !0;
        this._previousStateForCursor = 0;
        this._previousCursorCache = null;
        this._lastScroll = 0;
        this._isBeatMouseDown = !1;
        this._isNoteMouseDown = !1;
        this._selectionStart = null;
        this._selectionEnd = null;
        this.beatMouseDown = new Z();
        this.beatMouseMove = new Z();
        this.beatMouseUp = new Z();
        this.noteMouseDown = new Z();
        this.noteMouseMove = new Z();
        this.noteMouseUp = new Z();
        this.resize = new Z();
        this.renderStarted = new Z();
        this.renderFinished = new Z();
        this.postRenderFinished = new Be();
        this.error = new Z();
        this.midiLoad = new Z();
        this.settingsUpdated = new Be();
        (this.uiFacade = t),
          (this.container = t.rootContainer),
          (this.activeBeatsChanged = new Z(() =>
            this._player.state === 1 && this._currentBeat
              ? new _s(
                  this._currentBeat.beatLookup.highlightedBeats.map(
                    (i) => i.beat
                  )
                )
              : null
          )),
          (this.playedBeatChanged = new Z(() =>
            this._player.state === 1 && this._currentBeat
              ? this._currentBeat.beat
              : null
          )),
          (this.scoreLoaded = new Z(() => (this._score ? this._score : null))),
          (this.midiLoaded = new Z(() => this._player.loadedMidiInfo ?? null)),
          t.initialize(this, e),
          (w.logLevel = this.settings.core.logLevel),
          this.settings.handleBackwardsCompatibility(),
          J.printEnvironmentInfo(!1),
          (this.canvasElement = t.createCanvasElement()),
          this.container.appendChild(this.canvasElement),
          (this._renderer = new Zu()),
          this.settings.core.useWorkers &&
          this.uiFacade.areWorkersSupported &&
          J.getRenderEngineFactory(this.settings.core.engine).supportsWorkers
            ? (this._renderer.instance = this.uiFacade.createWorkerRenderer())
            : (this._renderer.instance = new ui(this.settings)),
          this.container.resize.on(
            J.throttle(() => {
              this._isDestroyed ||
                (this.container.width !== this._renderer.width &&
                  this.triggerResize());
            }, t.resizeThrottle)
          );
        let r = new vs();
        (r.oldWidth = this._renderer.width),
          (r.newWidth = this.container.width | 0),
          (r.settings = this.settings),
          this._onResize(r),
          this._renderer.preRender.on(this._onRenderStarted.bind(this)),
          this._renderer.renderFinished.on((i) => {
            this._onRenderFinished(i);
          }),
          this._renderer.postRenderFinished.on(() => {
            let i = Date.now() - this._startTime;
            w.debug("rendering", `Rendering completed in ${i}ms`),
              this._onPostRenderFinished();
          }),
          this._renderer.preRender.on((i) => {
            this._startTime = Date.now();
          }),
          this._renderer.partialLayoutFinished.on((i) =>
            this._appendRenderResult(i, !1)
          ),
          this._renderer.partialRenderFinished.on(
            this._updateRenderResult.bind(this)
          ),
          this._renderer.renderFinished.on((i) => {
            this._appendRenderResult(i, !0);
          }),
          this._renderer.error.on(this.onError.bind(this)),
          this._setupPlayerWrapper(),
          this.settings.player.playerMode !== 0 && this._setupOrDestroyPlayer(),
          this._setupClickHandling(),
          this.uiFacade.beginInvoke(() => {
            this.uiFacade.initialRender();
          });
      }
      get actualPlayerMode() {
        return this._actualPlayerMode;
      }
      get renderer() {
        return this._renderer;
      }
      get score() {
        return this._score;
      }
      get tracks() {
        return this._tracks;
      }
      _setupPlayerWrapper() {
        let t = new ju();
        (this._player = t),
          t.ready.on(() => {
            this.loadMidiForScore();
          }),
          t.readyForPlayback.on(() => {
            if ((this._onPlayerReady(), this.tracks))
              for (let e of this.tracks) {
                let r = e.playbackInfo.volume / 16;
                t.setChannelVolume(e.playbackInfo.primaryChannel, r),
                  t.setChannelVolume(e.playbackInfo.secondaryChannel, r);
              }
          }),
          t.soundFontLoaded.on(this._onSoundFontLoaded.bind(this)),
          t.soundFontLoadFailed.on((e) => {
            this.onError(e);
          }),
          t.midiLoaded.on(this._onMidiLoaded.bind(this)),
          t.midiLoadFailed.on((e) => {
            this.onError(e);
          }),
          t.stateChanged.on(this._onPlayerStateChanged.bind(this)),
          t.positionChanged.on(this._onPlayerPositionChanged.bind(this)),
          t.midiEventsPlayed.on(this._onMidiEventsPlayed.bind(this)),
          t.playbackRangeChanged.on(this._onPlaybackRangeChanged.bind(this)),
          t.finished.on(this._onPlayerFinished.bind(this));
      }
      destroy() {
        (this._isDestroyed = !0),
          this._player.destroy(),
          this.uiFacade.destroy(),
          this._renderer.destroy();
      }
      updateSettings() {
        this.settings.handleBackwardsCompatibility();
        let t = this.score;
        t && A.applyPitchOffsets(this.settings, t),
          this._updateRenderer(),
          this._renderer.updateSettings(this.settings),
          this._setupOrDestroyPlayer(),
          this._onSettingsUpdated();
      }
      _updateRenderer() {
        let t = this._renderer;
        this.settings.core.useWorkers &&
        this.uiFacade.areWorkersSupported &&
        J.getRenderEngineFactory(this.settings.core.engine).supportsWorkers
          ? t.instance instanceof ui &&
            (t.destroy(), (t.instance = this.uiFacade.createWorkerRenderer()))
          : t.instance instanceof ui ||
            (t.destroy(), (t.instance = new ui(this.settings)));
      }
      load(t, e) {
        try {
          return this.uiFacade.load(
            t,
            (r) => {
              this.renderScore(r, e);
            },
            (r) => {
              this.onError(r);
            }
          );
        } catch (r) {
          return this.onError(r), !1;
        }
      }
      renderScore(t, e) {
        let r = [];
        if (!e) t.tracks.length > 0 && r.push(t.tracks[0]);
        else if (e.length === 0) t.tracks.length > 0 && r.push(t.tracks[0]);
        else if (e.length === 1 && e[0] === -1)
          for (let i of t.tracks) r.push(i);
        else
          for (let i of e)
            i >= 0 && i <= t.tracks.length && r.push(t.tracks[i]);
        this._internalRenderTracks(t, r);
      }
      renderTracks(t) {
        if (t.length > 0) {
          let e = t[0].score;
          for (let r of t)
            if (r.score !== e) {
              this.onError(
                new te(0, "All rendered tracks must belong to the same score.")
              );
              return;
            }
          this._internalRenderTracks(e, t);
        }
      }
      _internalRenderTracks(t, e) {
        if ((A.applyPitchOffsets(this.settings, t), t !== this.score)) {
          (this._score = t),
            (this._tracks = e),
            (this._tickCache = null),
            (this._trackIndexes = []);
          for (let r of e) this._trackIndexes.push(r.index);
          (this._trackIndexLookup = new Set(this._trackIndexes)),
            this._onScoreLoaded(t),
            this.loadMidiForScore(),
            this.render();
        } else {
          this._tracks = e;
          let r = A.computeFirstDisplayedBarIndex(t, this.settings),
            i = A.computeLastDisplayedBarIndex(t, this.settings, r);
          this._tickCache &&
            (this._tickCache.multiBarRestInfo = A.buildMultiBarRestInfo(
              this.tracks,
              r,
              i
            )),
            (this._trackIndexes = []);
          for (let n of e) this._trackIndexes.push(n.index);
          (this._trackIndexLookup = new Set(this._trackIndexes)), this.render();
        }
      }
      triggerResize() {
        if (!this.container.isVisible)
          w.warning(
            "Rendering",
            "AlphaTab container was invisible while autosizing, waiting for element to become visible",
            null
          ),
            this.uiFacade.rootContainerBecameVisible.on(() => {
              w.debug(
                "Rendering",
                "AlphaTab container became visible, doing autosizing",
                null
              ),
                this.triggerResize();
            });
        else {
          let t = new vs();
          (t.oldWidth = this._renderer.width),
            (t.newWidth = this.container.width),
            (t.settings = this.settings),
            this._onResize(t),
            this._renderer.updateSettings(this.settings),
            (this._renderer.width = this.container.width),
            this._renderer.resizeRender();
        }
      }
      _appendRenderResult(t, e) {
        e &&
          ((this.canvasElement.width = t.totalWidth),
          (this.canvasElement.height = t.totalHeight),
          this._cursorWrapper &&
            ((this._cursorWrapper.width = t.totalWidth),
            (this._cursorWrapper.height = t.totalHeight))),
          (t.width > 0 || t.height > 0) &&
            this.uiFacade.beginAppendRenderResults(t),
          e && this.uiFacade.beginAppendRenderResults(null);
      }
      _updateRenderResult(t) {
        t && t.renderResult && this.uiFacade.beginUpdateRenderResults(t);
      }
      tex(t, e) {
        try {
          let r = new Ei();
          (r.logErrors = !0), r.initFromString(t, this.settings);
          let i = r.readScore();
          this.renderScore(i, e);
        } catch (r) {
          this.onError(r);
        }
      }
      loadSoundFont(t, e = !1) {
        return this.uiFacade.loadSoundFont(t, e);
      }
      resetSoundFonts() {
        this._player.resetSoundFonts();
      }
      render() {
        this.uiFacade.canRender
          ? ((this._renderer.width = this.container.width),
            this._renderer.renderScore(this.score, this._trackIndexes))
          : this.uiFacade.canRenderChanged.on(() => this.render());
      }
      get tickCache() {
        return this._tickCache;
      }
      get boundsLookup() {
        return this._renderer.boundsLookup;
      }
      get player() {
        return this._player.instance ? this._player : null;
      }
      get isReadyForPlayback() {
        return this._player.isReadyForPlayback;
      }
      get playerState() {
        return this._player.state;
      }
      get masterVolume() {
        return this._player.masterVolume;
      }
      set masterVolume(t) {
        this._player.masterVolume = t;
      }
      get metronomeVolume() {
        return this._player.metronomeVolume;
      }
      set metronomeVolume(t) {
        this._player.metronomeVolume = t;
      }
      get countInVolume() {
        return this._player.countInVolume;
      }
      set countInVolume(t) {
        this._player.countInVolume = t;
      }
      get midiEventsPlayedFilter() {
        return this._player.midiEventsPlayedFilter;
      }
      set midiEventsPlayedFilter(t) {
        this._player.midiEventsPlayedFilter = t;
      }
      get tickPosition() {
        return this._player.tickPosition;
      }
      set tickPosition(t) {
        this._player.tickPosition = t;
      }
      get timePosition() {
        return this._player.timePosition;
      }
      set timePosition(t) {
        this._player.timePosition = t;
      }
      get endTick() {
        return this._player.currentPosition.endTick;
      }
      get endTime() {
        return this._player.currentPosition.endTime;
      }
      get playbackRange() {
        return this._player.playbackRange;
      }
      set playbackRange(t) {
        (this._player.playbackRange = t), this._updateSelectionCursor(t);
      }
      get playbackSpeed() {
        return this._player.playbackSpeed;
      }
      set playbackSpeed(t) {
        this._player.playbackSpeed = t;
      }
      get isLooping() {
        return this._player.isLooping;
      }
      set isLooping(t) {
        this._player.isLooping = t;
      }
      _destroyPlayer() {
        this._player.destroy(),
          (this._previousTick = 0),
          this._destroyCursors();
      }
      _setupOrDestroyPlayer() {
        let t = this.settings.player.playerMode;
        if (t === 1) {
          let r = this.score;
          if (!r) return !1;
          r?.backingTrack?.rawAudioFile ? (t = 3) : (t = 2);
        }
        let e = null;
        if (t !== this._actualPlayerMode)
          switch ((this._destroyPlayer(), this._updateCursors(), t)) {
            case 0:
              e = null;
              break;
            case 2:
              e = this.uiFacade.createWorkerPlayer();
              break;
            case 3:
              e = this.uiFacade.createBackingTrackPlayer();
              break;
            case 4:
              e = new ec(this.settings.player.bufferTimeInMilliseconds);
              break;
          }
        else return this._updateCursors(), !1;
        return (
          (this._actualPlayerMode = t), e && (this._player.instance = e), !1
        );
      }
      loadMidiForScore() {
        if (!this.score) return;
        let t = this.score;
        w.debug("AlphaTab", "Generating Midi");
        let e = new Ft(),
          r = new bi(e),
          i = new Er(t, this.settings, r),
          n = A.computeFirstDisplayedBarIndex(t, this.settings),
          s = A.computeLastDisplayedBarIndex(t, this.settings, n);
        (i.tickLookup.multiBarRestInfo = A.buildMultiBarRestInfo(
          this.tracks,
          n,
          s
        )),
          (i.applyTranspositionPitches = !1),
          i.generate(),
          (this._tickCache = i.tickLookup),
          this._onMidiLoad(e);
        let a = this._player;
        a.loadMidiFile(e),
          a.loadBackingTrack(t),
          a.updateSyncPoints(i.syncPoints),
          a.applyTranspositionPitches(i.transpositionPitches);
      }
      updateSyncPoints() {
        if (!this.score) return;
        let t = this.score;
        this._player.updateSyncPoints(Er.generateSyncPoints(t));
      }
      changeTrackVolume(t, e) {
        for (let r of t)
          this._player.setChannelVolume(r.playbackInfo.primaryChannel, e),
            this._player.setChannelVolume(r.playbackInfo.secondaryChannel, e);
      }
      changeTrackSolo(t, e) {
        for (let r of t)
          this._player.setChannelSolo(r.playbackInfo.primaryChannel, e),
            this._player.setChannelSolo(r.playbackInfo.secondaryChannel, e);
      }
      changeTrackMute(t, e) {
        for (let r of t)
          this._player.setChannelMute(r.playbackInfo.primaryChannel, e),
            this._player.setChannelMute(r.playbackInfo.secondaryChannel, e);
      }
      changeTrackTranspositionPitch(t, e) {
        for (let r of t)
          this._player.setChannelTranspositionPitch(
            r.playbackInfo.primaryChannel,
            e
          ),
            this._player.setChannelTranspositionPitch(
              r.playbackInfo.secondaryChannel,
              e
            );
      }
      play() {
        return this._player.play();
      }
      pause() {
        this._player.pause();
      }
      playPause() {
        this._player.playPause();
      }
      stop() {
        this._player.stop();
      }
      playBeat(t) {
        let e = new Ft(),
          r = new bi(e);
        new Er(
          t.voice.bar.staff.track.score,
          this.settings,
          r
        ).generateSingleBeat(t),
          this._player.playOneTimeMidiFile(e);
      }
      playNote(t) {
        let e = new Ft(),
          r = new bi(e);
        new Er(
          t.beat.voice.bar.staff.track.score,
          this.settings,
          r
        ).generateSingleNote(t),
          this._player.playOneTimeMidiFile(e);
      }
      _destroyCursors() {
        this._cursorWrapper &&
          (this.uiFacade.destroyCursors(),
          (this._cursorWrapper = null),
          (this._barCursor = null),
          (this._beatCursor = null),
          (this._selectionWrapper = null));
      }
      _updateCursors() {
        let t = this._hasCursor;
        if (t && !this._cursorWrapper) {
          let e = this.uiFacade.createCursors();
          e &&
            ((this._cursorWrapper = e.cursorWrapper),
            (this._barCursor = e.barCursor),
            (this._beatCursor = e.beatCursor),
            (this._selectionWrapper = e.selectionWrapper),
            (this._isInitialBeatCursorUpdate = !0)),
            this._currentBeat !== null &&
              this._cursorUpdateBeat(
                this._currentBeat,
                !1,
                this._previousTick > 10,
                1,
                !0
              );
        } else !t && this._cursorWrapper && this._destroyCursors();
      }
      _cursorUpdateTick(t, e, r, i = !1, n = !1) {
        this._previousTick = t;
        let s = this._tickCache;
        if (s) {
          let a = this._trackIndexLookup;
          if (a != null && a.size > 0) {
            let o = s.findBeat(a, t, this._currentBeat);
            o &&
              this._cursorUpdateBeat(o, e, i, r, n || this.playerState === 0);
          }
        }
      }
      _cursorUpdateBeat(t, e, r, i, n = !1) {
        let s = t.beat,
          a = t.nextBeat?.beat ?? null,
          o = t.duration,
          l = t.beatLookup.highlightedBeats;
        if (!s) return;
        let u = this._renderer.boundsLookup;
        if (!u) return;
        let c = this._currentBeat,
          d = this._previousCursorCache,
          h = this._previousStateForCursor;
        if (
          !n &&
          s === c?.beat &&
          u === d &&
          h === this._player.state &&
          c?.start === t.start
        )
          return;
        let f = u.findBeat(s);
        f &&
          ((this._currentBeat = t),
          (this._previousCursorCache = u),
          (this._previousStateForCursor = this._player.state),
          this.uiFacade.beginInvoke(() => {
            this._internalCursorUpdateBeat(
              s,
              a,
              o,
              e,
              l,
              u,
              f,
              r,
              t.cursorMode,
              i
            );
          }));
      }
      scrollToCursor() {
        let t = this._currentBeatBounds;
        t && this._internalScrollToCursor(t.barBounds.masterBarBounds);
      }
      _internalScrollToCursor(t) {
        let e = this.uiFacade.getScrollContainer(),
          r = J.getLayoutEngineFactory(
            this.settings.display.layoutMode
          ).vertical,
          i = this.settings.player.scrollMode;
        if (r) {
          let n = t.realBounds.y + this.settings.player.scrollOffsetY;
          if (n !== this._lastScroll)
            switch (((this._lastScroll = n), i)) {
              case 1:
                let s = this.uiFacade.getOffset(e, this.container),
                  a = this.uiFacade.getOffset(null, e).h,
                  o = t.realBounds.h / 2;
                this.uiFacade.scrollToY(
                  e,
                  s.y + n - a / 2 + o,
                  this.settings.player.scrollSpeed
                );
                break;
              case 2:
                let l = e.scrollTop + this.uiFacade.getOffset(null, e).h;
                if (
                  t.visualBounds.y + t.visualBounds.h >= l ||
                  t.visualBounds.y < e.scrollTop
                ) {
                  let u = t.realBounds.y + this.settings.player.scrollOffsetY;
                  this.uiFacade.scrollToY(
                    e,
                    u,
                    this.settings.player.scrollSpeed
                  );
                }
                break;
            }
        } else {
          let n = t.visualBounds.x;
          if (n !== this._lastScroll)
            switch (((this._lastScroll = n), i)) {
              case 1:
                let s = this.uiFacade.getOffset(null, e).w,
                  o =
                    (this._currentBeatBounds
                      ? this._currentBeatBounds.onNotesX
                      : t.realBounds.x) -
                    s / 2 +
                    this.settings.player.scrollOffsetX;
                (this._lastScroll = t.visualBounds.x),
                  this.uiFacade.scrollToX(
                    e,
                    o,
                    this.settings.player.scrollSpeed
                  );
                break;
              case 2:
                let l = e.scrollLeft + this.uiFacade.getOffset(null, e).w;
                if (
                  t.visualBounds.x + t.visualBounds.w >= l ||
                  t.visualBounds.x < e.scrollLeft
                ) {
                  let u = t.realBounds.x + this.settings.player.scrollOffsetX;
                  (this._lastScroll = t.visualBounds.x),
                    this.uiFacade.scrollToX(
                      e,
                      u,
                      this.settings.player.scrollSpeed
                    );
                }
                break;
            }
        }
      }
      _internalCursorUpdateBeat(t, e, r, i, n, s, a, o, l, u) {
        let c = this._barCursor,
          d = this._beatCursor,
          h = a.barBounds.masterBarBounds,
          f = h.visualBounds,
          b = this._currentBeatBounds;
        (this._currentBeatBounds = a), c && c.setBounds(f.x, f.y, f.w, f.h);
        let y = this._player.state === 1 && !i,
          S = h.visualBounds.x + h.visualBounds.w;
        if (e && l === 1) {
          let O = s.findBeat(e);
          O &&
            O.barBounds.masterBarBounds.staffSystemBounds ===
              h.staffSystemBounds &&
            (S = O.onNotesX);
        }
        let k = a.onNotesX;
        if (d) {
          if (this.settings.player.enableAnimatedBeatCursor) {
            let O = S - a.onNotesX,
              N = this._previousTick - this._currentBeat.start,
              R =
                this._currentBeat.tickDuration > 0
                  ? N / this._currentBeat.tickDuration
                  : 0;
            (k = a.onNotesX + O * R),
              (r -= r * R),
              y
                ? ((!b ||
                    this._isInitialBeatCursorUpdate ||
                    f.y !== b.barBounds.masterBarBounds.visualBounds.y ||
                    k < b.onNotesX ||
                    h.index > b.barBounds.masterBarBounds.index + 1) &&
                    (d.transitionToX(0, k), d.setBounds(k, f.y, 1, f.h)),
                  this.uiFacade.beginInvoke(() => {
                    let x = l === 1 ? 2 : 1,
                      M = k + (S - k) * x;
                    d.transitionToX((r / u) * x, M);
                  }))
                : (d.transitionToX(0, k), d.setBounds(k, f.y, 1, f.h));
          } else d.transitionToX(0, k), d.setBounds(k, f.y, 1, f.h);
          this._isInitialBeatCursorUpdate = !1;
        } else this._isInitialBeatCursorUpdate = !0;
        this.uiFacade.removeHighlights();
        let T = !1;
        if (y) {
          if (this.settings.player.enableElementHighlighting)
            for (let O of n) {
              let N = ft.getGroupId(O.beat);
              this.uiFacade.highlightElements(N, t.voice.bar.index);
            }
          (o = !i), (T = !0);
        }
        o &&
          !this._isBeatMouseDown &&
          this.settings.player.scrollMode !== 0 &&
          this._internalScrollToCursor(h),
          T &&
            (this._onPlayedBeatChanged(t),
            this._onActiveBeatsChanged(new _s(n.map((O) => O.beat))));
      }
      _onPlayedBeatChanged(t) {
        this._isDestroyed ||
          (this.playedBeatChanged.trigger(t),
          this.uiFacade.triggerEvent(this.container, "playedBeatChanged", t));
      }
      _onActiveBeatsChanged(t) {
        this._isDestroyed ||
          (this.activeBeatsChanged.trigger(t),
          this.uiFacade.triggerEvent(this.container, "activeBeatsChanged", t));
      }
      get _hasCursor() {
        return (
          this.settings.player.playerMode !== 0 &&
          this.settings.player.enableCursor
        );
      }
      _onBeatMouseDown(t, e) {
        this._isDestroyed ||
          (this._hasCursor &&
            this.settings.player.enableUserInteraction &&
            ((this._selectionStart = new Ma(e)), (this._selectionEnd = null)),
          (this._isBeatMouseDown = !0),
          this.beatMouseDown.trigger(e),
          this.uiFacade.triggerEvent(this.container, "beatMouseDown", e, t));
      }
      _onNoteMouseDown(t, e) {
        this._isDestroyed ||
          ((this._isNoteMouseDown = !0),
          this.noteMouseDown.trigger(e),
          this.uiFacade.triggerEvent(this.container, "noteMouseDown", e, t));
      }
      _onBeatMouseMove(t, e) {
        this._isDestroyed ||
          (this.settings.player.enableUserInteraction &&
            (!this._selectionEnd || this._selectionEnd.beat !== e) &&
            ((this._selectionEnd = new Ma(e)),
            this._cursorSelectRange(this._selectionStart, this._selectionEnd)),
          this.beatMouseMove.trigger(e),
          this.uiFacade.triggerEvent(this.container, "beatMouseMove", e, t));
      }
      _onNoteMouseMove(t, e) {
        this._isDestroyed ||
          (this.noteMouseMove.trigger(e),
          this.uiFacade.triggerEvent(this.container, "noteMouseMove", e, t));
      }
      _onBeatMouseUp(t, e) {
        if (!this._isDestroyed) {
          if (this._hasCursor && this.settings.player.enableUserInteraction) {
            if (this._selectionEnd) {
              let r =
                this._tickCache?.getBeatStart(this._selectionStart.beat) ??
                this._selectionStart.beat.absolutePlaybackStart;
              if (
                (this._tickCache?.getBeatStart(this._selectionEnd.beat) ??
                  this._selectionEnd.beat.absolutePlaybackStart) < r
              ) {
                let n = this._selectionStart;
                (this._selectionStart = this._selectionEnd),
                  (this._selectionEnd = n);
              }
            }
            if (this._selectionStart && this._tickCache) {
              let r = this._tickCache,
                i = r.getMasterBarStart(
                  this._selectionStart.beat.voice.bar.masterBar
                );
              if (
                ((this._currentBeat = null),
                this._player.state === 0 &&
                  this._cursorUpdateTick(
                    this._tickCache.getBeatStart(this._selectionStart.beat),
                    !1,
                    1
                  ),
                (this.tickPosition =
                  i + this._selectionStart.beat.playbackStart),
                this._selectionEnd &&
                  this._selectionStart.beat !== this._selectionEnd.beat)
              ) {
                let n = r.getMasterBarStart(
                    this._selectionEnd.beat.voice.bar.masterBar
                  ),
                  s = new Ca();
                (s.startTick = i + this._selectionStart.beat.playbackStart),
                  (s.endTick =
                    n +
                    this._selectionEnd.beat.playbackStart +
                    this._selectionEnd.beat.playbackDuration -
                    50),
                  (this.playbackRange = s);
              } else
                (this._selectionStart = null),
                  (this.playbackRange = null),
                  this._cursorSelectRange(
                    this._selectionStart,
                    this._selectionEnd
                  );
            }
          }
          this.beatMouseUp.trigger(e),
            this.uiFacade.triggerEvent(this.container, "beatMouseUp", e, t),
            (this._isBeatMouseDown = !1);
        }
      }
      _onNoteMouseUp(t, e) {
        this._isDestroyed ||
          (this.noteMouseUp.trigger(e),
          this.uiFacade.triggerEvent(this.container, "noteMouseUp", e, t),
          (this._isNoteMouseDown = !1));
      }
      _updateSelectionCursor(t) {
        if (this._tickCache)
          if (t) {
            let e = this._tickCache.findBeat(
                this._trackIndexLookup,
                t.startTick
              ),
              r = this._tickCache.findBeat(this._trackIndexLookup, t.endTick);
            if (e && r) {
              let i = new Ma(e.beat),
                n = new Ma(r.beat);
              this._cursorSelectRange(i, n);
            }
          } else this._cursorSelectRange(null, null);
      }
      _setupClickHandling() {
        this.canvasElement.mouseDown.on((t) => {
          if (!t.isLeftMouseButton) return;
          this.settings.player.enableUserInteraction && t.preventDefault();
          let e = t.getX(this.canvasElement),
            r = t.getY(this.canvasElement),
            i = this._renderer.boundsLookup?.getBeatAtPos(e, r) ?? null;
          if (
            i &&
            (this._onBeatMouseDown(t, i), this.settings.core.includeNoteBounds)
          ) {
            let n = this._renderer.boundsLookup?.getNoteAtPos(i, e, r);
            n && this._onNoteMouseDown(t, n);
          }
        }),
          this.canvasElement.mouseMove.on((t) => {
            if (!this._isBeatMouseDown) return;
            let e = t.getX(this.canvasElement),
              r = t.getY(this.canvasElement),
              i = this._renderer.boundsLookup?.getBeatAtPos(e, r) ?? null;
            if (i && (this._onBeatMouseMove(t, i), this._isNoteMouseDown)) {
              let n = this._renderer.boundsLookup?.getNoteAtPos(i, e, r);
              n && this._onNoteMouseMove(t, n);
            }
          }),
          this.canvasElement.mouseUp.on((t) => {
            if (!this._isBeatMouseDown) return;
            this.settings.player.enableUserInteraction && t.preventDefault();
            let e = t.getX(this.canvasElement),
              r = t.getY(this.canvasElement),
              i = this._renderer.boundsLookup?.getBeatAtPos(e, r) ?? null;
            if ((this._onBeatMouseUp(t, i), this._isNoteMouseDown))
              if (i) {
                let n =
                  this._renderer.boundsLookup?.getNoteAtPos(i, e, r) ?? null;
                this._onNoteMouseUp(t, n);
              } else this._onNoteMouseUp(t, null);
          }),
          this._renderer.postRenderFinished.on(() => {
            !this._selectionStart ||
              !this._hasCursor ||
              !this.settings.player.enableUserInteraction ||
              this._cursorSelectRange(this._selectionStart, this._selectionEnd);
          });
      }
      _cursorSelectRange(t, e) {
        let r = this._renderer.boundsLookup;
        if (!r) return;
        let i = this._selectionWrapper;
        if (!i || (i.clear(), !t || !e || t.beat === e.beat)) return;
        t.bounds || (t.bounds = r.findBeat(t.beat)),
          e.bounds || (e.bounds = r.findBeat(e.beat));
        let n =
          this._tickCache?.getBeatStart(t.beat) ?? t.beat.absolutePlaybackStart;
        if (
          (this._tickCache?.getBeatStart(e.beat) ??
            e.beat.absolutePlaybackStart) < n
        ) {
          let l = t;
          (t = e), (e = l);
        }
        let a = t.bounds.realBounds.x,
          o = e.bounds.realBounds.x + e.bounds.realBounds.w;
        if (
          (e.beat.index === e.beat.voice.beats.length - 1 &&
            (o =
              e.bounds.barBounds.masterBarBounds.realBounds.x +
              e.bounds.barBounds.masterBarBounds.realBounds.w),
          t.bounds.barBounds.masterBarBounds.staffSystemBounds !==
            e.bounds.barBounds.masterBarBounds.staffSystemBounds)
        ) {
          let l =
              t.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds
                .x,
            u =
              t.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds
                .x +
              t.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds
                .w,
            c = this.uiFacade.createSelectionElement();
          c.setBounds(
            a,
            t.bounds.barBounds.masterBarBounds.visualBounds.y,
            u - a,
            t.bounds.barBounds.masterBarBounds.visualBounds.h
          ),
            i.appendChild(c);
          let d =
              t.bounds.barBounds.masterBarBounds.staffSystemBounds.index + 1,
            h = e.bounds.barBounds.masterBarBounds.staffSystemBounds.index;
          for (let b = d; b < h; b++) {
            let y = r.staffSystems[b],
              S = this.uiFacade.createSelectionElement();
            S.setBounds(l, y.visualBounds.y, u - l, y.visualBounds.h),
              i.appendChild(S);
          }
          let f = this.uiFacade.createSelectionElement();
          f.setBounds(
            l,
            e.bounds.barBounds.masterBarBounds.visualBounds.y,
            o - l,
            e.bounds.barBounds.masterBarBounds.visualBounds.h
          ),
            i.appendChild(f);
        } else {
          let l = this.uiFacade.createSelectionElement();
          l.setBounds(
            a,
            t.bounds.barBounds.masterBarBounds.visualBounds.y,
            o - a,
            t.bounds.barBounds.masterBarBounds.visualBounds.h
          ),
            i.appendChild(l);
        }
      }
      _onScoreLoaded(t) {
        this._isDestroyed ||
          (this.scoreLoaded.trigger(t),
          this.uiFacade.triggerEvent(this.container, "scoreLoaded", t),
          this._setupOrDestroyPlayer() || this.loadMidiForScore());
      }
      _onResize(t) {
        this._isDestroyed ||
          (this.resize.trigger(t),
          this.uiFacade.triggerEvent(this.container, "resize", t));
      }
      _onRenderStarted(t) {
        this._isDestroyed ||
          (this.renderStarted.trigger(t),
          this.uiFacade.triggerEvent(this.container, "renderStarted", t));
      }
      _onRenderFinished(t) {
        this._isDestroyed ||
          (this.renderFinished.trigger(t),
          this.uiFacade.triggerEvent(this.container, "renderFinished", t));
      }
      _onPostRenderFinished() {
        this._isDestroyed ||
          ((this._currentBeat = null),
          this._cursorUpdateTick(this._previousTick, !1, 1, !0, !0),
          this.postRenderFinished.trigger(),
          this.uiFacade.triggerEvent(
            this.container,
            "postRenderFinished",
            null
          ));
      }
      onError(t) {
        this._isDestroyed ||
          (w.error("API", "An unexpected error occurred", t),
          this.error.trigger(t),
          this.uiFacade.triggerEvent(this.container, "error", t));
      }
      get playerReady() {
        return this._player.readyForPlayback;
      }
      _onPlayerReady() {
        this._isDestroyed ||
          this.uiFacade.triggerEvent(this.container, "playerReady", null);
      }
      get playerFinished() {
        return this._player.finished;
      }
      _onPlayerFinished() {
        this._isDestroyed ||
          this.uiFacade.triggerEvent(this.container, "playerFinished", null);
      }
      get soundFontLoaded() {
        return this._player.soundFontLoaded;
      }
      _onSoundFontLoaded() {
        this._isDestroyed ||
          this.uiFacade.triggerEvent(this.container, "soundFontLoaded", null);
      }
      _onMidiLoad(t) {
        this._isDestroyed ||
          (this.midiLoad.trigger(t),
          this.uiFacade.triggerEvent(this.container, "midiLoad", t));
      }
      _onMidiLoaded(t) {
        this._isDestroyed ||
          (this.midiLoaded.trigger(t),
          this.uiFacade.triggerEvent(this.container, "midiFileLoaded", t));
      }
      get playerStateChanged() {
        return this._player.stateChanged;
      }
      _onPlayerStateChanged(t) {
        if (!this._isDestroyed) {
          if (!t.stopped && t.state === 0) {
            let e = this._currentBeat,
              r = this._tickCache;
            e && r && (this._player.tickPosition = r.getBeatStart(e.beat));
          }
          this.uiFacade.triggerEvent(this.container, "playerStateChanged", t);
        }
      }
      get playerPositionChanged() {
        return this._player.positionChanged;
      }
      _onPlayerPositionChanged(t) {
        this._isDestroyed ||
          ((this._previousTick = t.currentTick),
          this.uiFacade.beginInvoke(() => {
            let e = t.modifiedTempo / t.originalTempo;
            this._cursorUpdateTick(t.currentTick, !1, e, !1, t.isSeek);
          }),
          this.uiFacade.triggerEvent(
            this.container,
            "playerPositionChanged",
            t
          ));
      }
      get midiEventsPlayed() {
        return this._player.midiEventsPlayed;
      }
      _onMidiEventsPlayed(t) {
        this._isDestroyed ||
          this.uiFacade.triggerEvent(this.container, "midiEventsPlayed", t);
      }
      get playbackRangeChanged() {
        return this._player.playbackRangeChanged;
      }
      _onPlaybackRangeChanged(t) {
        this._isDestroyed ||
          this.uiFacade.triggerEvent(this.container, "playbackRangeChanged", t);
      }
      _onSettingsUpdated() {
        this._isDestroyed ||
          (this.settingsUpdated.trigger(),
          this.uiFacade.triggerEvent(this.container, "settingsUpdated", null));
      }
      async enumerateOutputDevices() {
        return await this._player.output.enumerateOutputDevices();
      }
      async setOutputDevice(t) {
        await this._player.output.setOutputDevice(t);
      }
      async getOutputDevice() {
        return await this._player.output.getOutputDevice();
      }
      async exportAudio(t) {
        if (!this.score) throw new te(0, "No song loaded");
        let e;
        this._actualPlayerMode === 2
          ? (e = this.uiFacade.createWorkerAudioExporter(this._player.instance))
          : (e = this.uiFacade.createWorkerAudioExporter(null));
        let r = this.score,
          i = new Ft(),
          n = new bi(i),
          s = new Er(r, this.settings, n);
        (s.applyTranspositionPitches = !1), s.generate();
        let a = new aa();
        (a.soundFonts = t.soundFonts),
          (a.sampleRate = t.sampleRate),
          (a.useSyncPoints = t.useSyncPoints),
          (a.masterVolume = t.masterVolume),
          (a.metronomeVolume = t.metronomeVolume),
          (a.playbackRange = t.playbackRange);
        for (let [o, l] of t.trackVolume)
          if (o < this.score.tracks.length) {
            let u = this.score.tracks[o];
            a.trackVolume.set(u.playbackInfo.primaryChannel, l),
              a.trackVolume.set(u.playbackInfo.secondaryChannel, l);
          }
        for (let [o, l] of t.trackTranspositionPitches)
          if (o < this.score.tracks.length) {
            let u = this.score.tracks[o];
            a.trackTranspositionPitches.set(u.playbackInfo.primaryChannel, l),
              a.trackTranspositionPitches.set(
                u.playbackInfo.secondaryChannel,
                l
              );
          }
        return (
          await e.initialize(a, i, s.syncPoints, s.transpositionPitches), e
        );
      }
    };
  var Wr = class extends te {
    constructor(t, e) {
      super(0, t), (this.xhr = e);
    }
  };
  var Zi = class p {
    static loadAlphaTex(t, e) {
      let r = new Ei();
      return (
        (r.logErrors = !0), r.initFromString(t, e ?? new kt()), r.readScore()
      );
    }
    static loadScoreAsync(t, e, r, i) {
      let n = new XMLHttpRequest();
      n.open("GET", t, !0, null, null),
        (n.responseType = "arraybuffer"),
        (n.onreadystatechange = () => {
          if (n.readyState === XMLHttpRequest.DONE) {
            let s = n.response;
            if (n.status === 200 || (n.status === 0 && s))
              try {
                let a = n.response,
                  o = new Uint8Array(a),
                  l = p.loadScoreFromBytes(o, i);
                e(l);
              } catch (a) {
                r(a);
              }
            else
              n.status === 0
                ? r(
                    new Wr(
                      `You are offline!!
 Please Check Your Network.`,
                      n
                    )
                  )
                : n.status === 404
                ? r(new Wr("Requested URL not found.", n))
                : n.status === 500
                ? r(new Wr("Internel Server Error.", n))
                : n.statusText === "parsererror"
                ? r(
                    new Wr(
                      `Error.
Parsing JSON Request failed.`,
                      n
                    )
                  )
                : n.statusText === "timeout"
                ? r(new Wr("Request Time out.", n))
                : r(new Wr(`Unknow Error: ${n.responseText}`, n));
          }
        }),
        n.send();
    }
    static loadScoreFromBytes(t, e) {
      e || (e = new kt());
      let r = J.buildImporters();
      w.debug(
        "ScoreLoader",
        `Loading score from ${t.length} bytes using ${r.length} importers`
      );
      let i = null,
        n = Se.fromBuffer(t);
      for (let s of r) {
        n.reset();
        try {
          w.debug("ScoreLoader", `Importing using importer ${s.name}`),
            s.init(n, e),
            (i = s.readScore()),
            w.debug("ScoreLoader", `Score imported using ${s.name}`);
          break;
        } catch (a) {
          if (a instanceof ke)
            w.debug("ScoreLoader", `${s.name} does not support the file`);
          else
            throw (
              (w.error(
                "ScoreLoader",
                "Score import failed due to unexpected error: ",
                a
              ),
              a)
            );
        }
      }
      if (i) return i;
      throw new ke("No compatible importer found for file");
    }
  };
  var La = class {
    get isLeftMouseButton() {
      return this.mouseEvent.button === 0;
    }
    getX(t) {
      let e = t.element,
        i =
          e.getBoundingClientRect().left +
          e.ownerDocument.defaultView.pageXOffset;
      return this.mouseEvent.pageX - i;
    }
    getY(t) {
      let e = t.element,
        i =
          e.getBoundingClientRect().top +
          e.ownerDocument.defaultView.pageYOffset;
      return this.mouseEvent.pageY - i;
    }
    preventDefault() {
      this.mouseEvent.preventDefault();
    }
    constructor(t) {
      this.mouseEvent = t;
    }
  };
  var Bl = class Bl {
    constructor(t) {
      this._resizeListeners = 0;
      this.lastBounds = new we();
      (this.element = t),
        (this.mouseDown = {
          on: (r) => {
            let i = (n) => {
              r(new La(n));
            };
            return (
              this.element.addEventListener("mousedown", i, !0),
              () => {
                this.element.removeEventListener("mousedown", i, !0);
              }
            );
          },
          off: (r) => {},
        }),
        (this.mouseUp = {
          on: (r) => {
            let i = (n) => {
              r(new La(n));
            };
            return (
              this.element.addEventListener("mouseup", i, !0),
              () => {
                this.element.removeEventListener("mouseup", i, !0);
              }
            );
          },
          off: (r) => {},
        }),
        (this.mouseMove = {
          on: (r) => {
            let i = (n) => {
              r(new La(n));
            };
            return (
              this.element.addEventListener("mousemove", i, !0),
              () => {
                this.element.removeEventListener("mousemove", i, !0);
              }
            );
          },
          off: (r) => {},
        });
      let e = this;
      this.resize = {
        on: function (r) {
          return (
            e._resizeListeners === 0 &&
              Bl._resizeObserver.value.observe(e.element),
            e.element.addEventListener("resize", r, !0),
            e._resizeListeners++,
            () => this.off(r)
          );
        },
        off: (r) => {
          this.element.removeEventListener("resize", r, !0),
            this._resizeListeners--,
            this._resizeListeners <= 0 &&
              ((this._resizeListeners = 0),
              Bl._resizeObserver.value.unobserve(this.element));
        },
      };
    }
    get width() {
      return this.element.offsetWidth;
    }
    set width(t) {
      this.element.style.width = `${t}px`;
    }
    get scrollLeft() {
      return this.element.scrollLeft;
    }
    set scrollLeft(t) {
      this.element.scrollLeft = t;
    }
    get scrollTop() {
      return this.element.scrollTop;
    }
    set scrollTop(t) {
      this.element.scrollTop = t;
    }
    get height() {
      return this.element.offsetHeight;
    }
    set height(t) {
      t >= 0
        ? (this.element.style.height = `${t}px`)
        : (this.element.style.height = "100%");
    }
    get isVisible() {
      return (
        !!this.element.offsetWidth ||
        !!this.element.offsetHeight ||
        !!this.element.getClientRects().length
      );
    }
    stopAnimation() {
      this.element.style.transition = "none";
    }
    transitionToX(t, e) {
      (this.element.style.transition = `transform ${t}ms linear`),
        this.setBounds(e, Number.NaN, Number.NaN, Number.NaN);
    }
    setBounds(t, e, r, i) {
      Number.isNaN(t) && (t = this.lastBounds.x),
        Number.isNaN(e) && (e = this.lastBounds.y),
        Number.isNaN(r) && (r = this.lastBounds.w),
        Number.isNaN(i) && (i = this.lastBounds.h),
        (this.element.style.transform = `translate(${t}px, ${e}px) scale(${r}, ${i})`),
        (this.element.style.transformOrigin = "top left"),
        (this.lastBounds.x = t),
        (this.lastBounds.y = e),
        (this.lastBounds.w = r),
        (this.lastBounds.h = i);
    }
    appendChild(t) {
      this.element.appendChild(t.element);
    }
    clear() {
      this.element.innerHTML = "";
    }
  };
  Bl._resizeObserver = new Cr(
    () =>
      new ResizeObserver((t) => {
        for (let e of t) {
          let r = new CustomEvent("resize", { detail: e });
          e.target.dispatchEvent(r);
        }
      })
  );
  var Li = Bl;
  var Tl = class {
    constructor(t) {
      this._isStarted = !1;
      this.isFontLoaded = !1;
      this.fontLoaded = new Z();
      (this._originalFamilies = t), (this._families = t);
    }
    checkForFontAvailability() {
      if (J.isRunningInWorker) {
        this.isFontLoaded = !1;
        return;
      }
      if (this._isStarted) return;
      this._isStarted = !0;
      let t = 0,
        e = window.setInterval(() => {
          w.warning(
            "Rendering",
            `Could not load font '${this._families[0]}' within ${
              (t + 1) * 5
            } seconds`,
            null
          ),
            this._families.length > 1 ? (this._families.shift(), (t = 0)) : t++;
        }, 5e3);
      w.debug(
        "Font",
        `Start checking for font availablility: ${this._families.join(", ")}`
      );
      let r = (s) => {
          this._families.length > 1
            ? (w.debug(
                "Font",
                `[${this._families[0]}] Loading Failed, switching to ${this._families[1]}`,
                s
              ),
              this._families.shift(),
              window.setTimeout(() => {
                n();
              }, 0))
            : (w.error(
                "Font",
                `[${this._originalFamilies.join(
                  ","
                )}] Loading Failed, rendering cannot start`,
                s
              ),
              window.clearInterval(e));
        },
        i = (s) => {
          w.debug("Font", `[${s}] Font API signaled available`),
            (this.isFontLoaded = !0),
            window.clearInterval(e),
            this.fontLoaded.trigger(this._families[0]);
        },
        n = async () => {
          for (let s of this._families)
            if (await this._isFontAvailable(s, !1)) {
              i(s);
              return;
            }
          try {
            await document.fonts.load(`1em ${this._families[0]}`);
          } catch (s) {
            r(s);
          }
          return (
            w.debug("Font", `[${this._families[0]}] Font API signaled loaded`),
            (await this._isFontAvailable(this._families[0], !0))
              ? i(this._families[0])
              : r("Font not available"),
            !0
          );
        };
      document.fonts.ready.then(() => {
        n();
      });
    }
    _isFontAvailable(t, e) {
      return new Promise((r) => {
        let i = `1em ${t}`;
        if (document.fonts.check(i)) r(!0);
        else if (e) {
          w.debug(
            "Font",
            `Font ${t} not available, creating test element to trigger load`
          );
          let n = document.createElement("div");
          (n.style.font = i),
            (n.style.opacity = "0"),
            (n.style.position = "absolute"),
            (n.style.top = "0"),
            (n.style.left = "0"),
            (n.innerText = `Trigger ${t} load`),
            document.body.appendChild(n),
            setTimeout(() => {
              document.body.removeChild(n),
                document.fonts.check(i) ? r(!0) : r(!1);
            }, 200);
        } else r(!1);
      });
    }
  };
  var Da = class extends Zr {
    constructor() {
      super(...arguments);
      this._audioNode = null;
      this._bufferCount = 0;
      this._requestedBufferCount = 0;
      this._outputBuffer = new Float32Array(0);
    }
    open(e) {
      super.open(e),
        (this._bufferCount = Math.floor(
          (e * this.sampleRate) / 1e3 / Zr.BufferSize
        )),
        (this._circularBuffer = new wn(Zr.BufferSize * this._bufferCount)),
        this.onReady();
    }
    play() {
      super.play();
      let e = this.context;
      (this._audioNode = e.createScriptProcessor(4096, 0, 2)),
        (this._audioNode.onaudioprocess = this._generateSound.bind(this)),
        this._circularBuffer.clear(),
        this._requestBuffers(),
        (this.source = e.createBufferSource()),
        (this.source.buffer = this.buffer),
        (this.source.loop = !0),
        this.source.connect(this._audioNode, 0, 0),
        this.source.start(0),
        this._audioNode.connect(e.destination, 0, 0);
    }
    pause() {
      super.pause(),
        this._audioNode && this._audioNode.disconnect(0),
        (this._audioNode = null);
    }
    addSamples(e) {
      this._circularBuffer.write(e, 0, e.length), this._requestedBufferCount--;
    }
    resetSamples() {
      this._circularBuffer.clear();
    }
    _requestBuffers() {
      let e = (this._bufferCount / 2) | 0,
        r = e * Zr.BufferSize;
      if (
        this._circularBuffer.count +
          this._requestedBufferCount * Zr.BufferSize <
        r
      ) {
        for (let n = 0; n < e; n++) this.onSampleRequest();
        this._requestedBufferCount += e;
      }
    }
    _generateSound(e) {
      let r = e.outputBuffer.getChannelData(0),
        i = e.outputBuffer.getChannelData(1),
        n = r.length + i.length,
        s = this._outputBuffer;
      s.length !== n && ((s = new Float32Array(n)), (this._outputBuffer = s));
      let a = this._circularBuffer.read(
          s,
          0,
          Math.min(s.length, this._circularBuffer.count)
        ),
        o = 0,
        l = Math.min(r.length, a);
      for (let u = 0; u < l; u++) (r[u] = s[o++]), (i[u] = s[o++]);
      if (a < r.length)
        for (let u = a; u < r.length; u++) (r[u] = 0), (i[u] = 0);
      this.onSamplesPlayed(a / Q.AudioChannels), this._requestBuffers();
    }
  };
  var qn = class {
    constructor(t, e) {
      this._workerIsReadyForPlayback = !1;
      this._workerIsReady = !1;
      this._outputIsReady = !1;
      this._state = 0;
      this._masterVolume = 0;
      this._metronomeVolume = 0;
      this._countInVolume = 0;
      this._playbackSpeed = 0;
      this._isLooping = !1;
      this._playbackRange = null;
      this._midiEventsPlayedFilter = [];
      this._currentPosition = new er(0, 0, 0, 0, !1, 120, 120);
      this.ready = new Be();
      this.readyForPlayback = new Be();
      this.finished = new Be();
      this.soundFontLoaded = new Be();
      this.soundFontLoadFailed = new Z();
      this.midiLoaded = new Z();
      this.midiLoadFailed = new Z();
      this.stateChanged = new Z();
      this.positionChanged = new Z();
      this.midiEventsPlayed = new Z();
      this.playbackRangeChanged = new Z();
      (this._workerIsReadyForPlayback = !1),
        (this._workerIsReady = !1),
        (this._outputIsReady = !1),
        (this._state = 0),
        (this._masterVolume = 0),
        (this._metronomeVolume = 0),
        (this._playbackSpeed = 0),
        (this._isLooping = !1),
        (this._playbackRange = null),
        (this._output = t),
        this._output.ready.on(this._onOutputReady.bind(this)),
        this._output.samplesPlayed.on(this.onOutputSamplesPlayed.bind(this)),
        this._output.sampleRequest.on(this.onOutputSampleRequest.bind(this)),
        this._output.open(e.player.bufferTimeInMilliseconds);
      try {
        this._synth = J.createWebWorker(e);
      } catch (r) {
        w.error("AlphaSynth", `Failed to create WebWorker: ${r}`);
      }
      this._synth.addEventListener(
        "message",
        this.handleWorkerMessage.bind(this),
        !1
      ),
        this._synth.postMessage({
          cmd: "alphaSynth.initialize",
          sampleRate: this._output.sampleRate,
          logLevel: e.core.logLevel,
          bufferTimeInMilliseconds: e.player.bufferTimeInMilliseconds,
        }),
        (this.masterVolume = 1),
        (this.playbackSpeed = 1),
        (this.metronomeVolume = 0);
    }
    get output() {
      return this._output;
    }
    get isReady() {
      return this._workerIsReady && this._outputIsReady;
    }
    get isReadyForPlayback() {
      return this._workerIsReadyForPlayback;
    }
    get state() {
      return this._state;
    }
    get logLevel() {
      return w.logLevel;
    }
    get worker() {
      return this._synth;
    }
    set logLevel(t) {
      (w.logLevel = t),
        this._synth.postMessage({ cmd: "alphaSynth.setLogLevel", value: t });
    }
    get masterVolume() {
      return this._masterVolume;
    }
    set masterVolume(t) {
      (t = Math.max(t, Q.MinVolume)),
        (this._masterVolume = t),
        this._synth.postMessage({
          cmd: "alphaSynth.setMasterVolume",
          value: t,
        });
    }
    get metronomeVolume() {
      return this._metronomeVolume;
    }
    set metronomeVolume(t) {
      (t = Math.max(t, Q.MinVolume)),
        (this._metronomeVolume = t),
        this._synth.postMessage({
          cmd: "alphaSynth.setMetronomeVolume",
          value: t,
        });
    }
    get countInVolume() {
      return this._countInVolume;
    }
    set countInVolume(t) {
      (t = Math.max(t, Q.MinVolume)),
        (this._countInVolume = t),
        this._synth.postMessage({
          cmd: "alphaSynth.setCountInVolume",
          value: t,
        });
    }
    get midiEventsPlayedFilter() {
      return this._midiEventsPlayedFilter;
    }
    set midiEventsPlayedFilter(t) {
      (this._midiEventsPlayedFilter = t),
        this._synth.postMessage({
          cmd: "alphaSynth.setMidiEventsPlayedFilter",
          value: J.prepareForPostMessage(t),
        });
    }
    get playbackSpeed() {
      return this._playbackSpeed;
    }
    set playbackSpeed(t) {
      (t = A.clamp(t, Q.MinPlaybackSpeed, Q.MaxPlaybackSpeed)),
        (this._playbackSpeed = t),
        this._synth.postMessage({
          cmd: "alphaSynth.setPlaybackSpeed",
          value: t,
        });
    }
    get loadedMidiInfo() {
      return this.loadedMidiInfo;
    }
    get currentPosition() {
      return this._currentPosition;
    }
    get tickPosition() {
      return this._currentPosition.currentTick;
    }
    set tickPosition(t) {
      t < 0 && (t = 0),
        (this._currentPosition = new er(
          this._currentPosition.currentTime,
          this._currentPosition.endTime,
          t,
          this._currentPosition.endTick,
          !0,
          this._currentPosition.originalTempo,
          this._currentPosition.modifiedTempo
        )),
        this._synth.postMessage({
          cmd: "alphaSynth.setTickPosition",
          value: t,
        });
    }
    get timePosition() {
      return this._currentPosition.currentTime;
    }
    set timePosition(t) {
      t < 0 && (t = 0),
        (this._currentPosition = new er(
          t,
          this._currentPosition.endTime,
          this._currentPosition.currentTick,
          this._currentPosition.endTick,
          !0,
          this._currentPosition.originalTempo,
          this._currentPosition.modifiedTempo
        )),
        this._synth.postMessage({
          cmd: "alphaSynth.setTimePosition",
          value: t,
        });
    }
    get isLooping() {
      return this._isLooping;
    }
    set isLooping(t) {
      (this._isLooping = t),
        this._synth.postMessage({ cmd: "alphaSynth.setIsLooping", value: t });
    }
    get playbackRange() {
      return this._playbackRange;
    }
    set playbackRange(t) {
      t &&
        (t.startTick < 0 && (t.startTick = 0),
        t.endTick < 0 && (t.endTick = 0)),
        (this._playbackRange = t),
        this._synth.postMessage({
          cmd: "alphaSynth.setPlaybackRange",
          value: J.prepareForPostMessage(t),
        });
    }
    destroy() {
      this._synth.postMessage({ cmd: "alphaSynth.destroy" });
    }
    play() {
      return (
        this._output.activate(),
        this._synth.postMessage({ cmd: "alphaSynth.play" }),
        !0
      );
    }
    pause() {
      this._synth.postMessage({ cmd: "alphaSynth.pause" });
    }
    playPause() {
      this._output.activate(),
        this._synth.postMessage({ cmd: "alphaSynth.playPause" });
    }
    stop() {
      this._synth.postMessage({ cmd: "alphaSynth.stop" });
    }
    playOneTimeMidiFile(t) {
      this._synth.postMessage({
        cmd: "alphaSynth.playOneTimeMidiFile",
        midi: $e.midiFileToJsObject(J.prepareForPostMessage(t)),
      });
    }
    loadSoundFont(t, e) {
      this._synth.postMessage({
        cmd: "alphaSynth.loadSoundFontBytes",
        data: J.prepareForPostMessage(t),
        append: e,
      });
    }
    resetSoundFonts() {
      this._synth.postMessage({ cmd: "alphaSynth.resetSoundFonts" });
    }
    loadMidiFile(t) {
      this._synth.postMessage({
        cmd: "alphaSynth.loadMidi",
        midi: $e.midiFileToJsObject(J.prepareForPostMessage(t)),
      });
    }
    applyTranspositionPitches(t) {
      this._synth.postMessage({
        cmd: "alphaSynth.applyTranspositionPitches",
        transpositionPitches: JSON.stringify(
          Array.from(J.prepareForPostMessage(t).entries())
        ),
      });
    }
    setChannelTranspositionPitch(t, e) {
      this._synth.postMessage({
        cmd: "alphaSynth.setChannelTranspositionPitch",
        channel: t,
        semitones: e,
      });
    }
    setChannelMute(t, e) {
      this._synth.postMessage({
        cmd: "alphaSynth.setChannelMute",
        channel: t,
        mute: e,
      });
    }
    resetChannelStates() {
      this._synth.postMessage({ cmd: "alphaSynth.resetChannelStates" });
    }
    setChannelSolo(t, e) {
      this._synth.postMessage({
        cmd: "alphaSynth.setChannelSolo",
        channel: t,
        solo: e,
      });
    }
    setChannelVolume(t, e) {
      (e = Math.max(e, Q.MinVolume)),
        this._synth.postMessage({
          cmd: "alphaSynth.setChannelVolume",
          channel: t,
          volume: e,
        });
    }
    handleWorkerMessage(t) {
      let e = t.data;
      switch (e.cmd) {
        case "alphaSynth.ready":
          (this._workerIsReady = !0), this._checkReady();
          break;
        case "alphaSynth.destroyed":
          this._synth.terminate();
          break;
        case "alphaSynth.readyForPlayback":
          (this._workerIsReadyForPlayback = !0), this._checkReadyForPlayback();
          break;
        case "alphaSynth.positionChanged":
          (this._currentPosition = new er(
            e.currentTime,
            e.endTime,
            e.currentTick,
            e.endTick,
            e.isSeek,
            e.originalTempo,
            e.modifiedTempo
          )),
            this.positionChanged.trigger(this._currentPosition);
          break;
        case "alphaSynth.midiEventsPlayed":
          this.midiEventsPlayed.trigger(
            new Wn(e.events.map($e.jsObjectToMidiEvent))
          );
          break;
        case "alphaSynth.playerStateChanged":
          (this._state = e.state),
            this.stateChanged.trigger(new Or(e.state, e.stopped));
          break;
        case "alphaSynth.playbackRangeChanged":
          (this._playbackRange = e.playbackRange),
            this.playbackRangeChanged.trigger(new fi(this._playbackRange));
          break;
        case "alphaSynth.finished":
          this.finished.trigger();
          break;
        case "alphaSynth.soundFontLoaded":
          this.soundFontLoaded.trigger();
          break;
        case "alphaSynth.soundFontLoadFailed":
          this.soundFontLoadFailed.trigger(e.error);
          break;
        case "alphaSynth.midiLoaded":
          this._checkReadyForPlayback(),
            (this._loadedMidiInfo = new er(
              e.currentTime,
              e.endTime,
              e.currentTick,
              e.endTick,
              e.isSeek,
              e.originalTempo,
              e.modifiedTempo
            )),
            this.midiLoaded.trigger(this._loadedMidiInfo);
          break;
        case "alphaSynth.midiLoadFailed":
          this._checkReadyForPlayback(), this.midiLoadFailed.trigger(e.error);
          break;
        case "alphaSynth.output.addSamples":
          this._output.addSamples(e.samples);
          break;
        case "alphaSynth.output.play":
          this._output.play();
          break;
        case "alphaSynth.output.pause":
          this._output.pause();
          break;
        case "alphaSynth.output.destroy":
          this._output.destroy();
          break;
        case "alphaSynth.output.resetSamples":
          this._output.resetSamples();
          break;
      }
    }
    _checkReady() {
      this.isReady && this.ready.trigger();
    }
    _checkReadyForPlayback() {
      this.isReadyForPlayback && this.readyForPlayback.trigger();
    }
    onOutputSampleRequest() {
      this._synth.postMessage({ cmd: "alphaSynth.output.sampleRequest" });
    }
    onOutputSamplesPlayed(t) {
      this._synth.postMessage({
        cmd: "alphaSynth.output.samplesPlayed",
        samples: t,
      });
    }
    _onOutputReady() {
      (this._outputIsReady = !0), this._checkReady();
    }
    loadBackingTrack(t) {}
    updateSyncPoints(t) {}
  };
  var tc = class {
    constructor(t, e) {
      this._width = 0;
      this.boundsLookup = null;
      this.preRender = new Z();
      this.partialRenderFinished = new Z();
      this.partialLayoutFinished = new Z();
      this.renderFinished = new Z();
      this.postRenderFinished = new Be();
      this.error = new Z();
      this._api = t;
      try {
        this._worker = J.createWebWorker(e);
      } catch (r) {
        w.error("Rendering", `Failed to create WebWorker: ${r}`);
        return;
      }
      this._worker.postMessage({
        cmd: "alphaTab.initialize",
        settings: this._serializeSettingsForWorker(e),
      }),
        this._worker.addEventListener(
          "message",
          this._handleWorkerMessage.bind(this)
        );
    }
    destroy() {
      this._worker.terminate();
    }
    updateSettings(t) {
      this._worker.postMessage({
        cmd: "alphaTab.updateSettings",
        settings: this._serializeSettingsForWorker(t),
      });
    }
    _serializeSettingsForWorker(t) {
      let e = $e.settingsToJsObject(J.prepareForPostMessage(t));
      return e.delete("player"), e;
    }
    render() {
      this._worker.postMessage({ cmd: "alphaTab.render" });
    }
    resizeRender() {
      this._worker.postMessage({ cmd: "alphaTab.resizeRender" });
    }
    renderResult(t) {
      this._worker.postMessage({ cmd: "alphaTab.renderResult", resultId: t });
    }
    get width() {
      return this._width;
    }
    set width(t) {
      (this._width = t),
        this._worker.postMessage({ cmd: "alphaTab.setWidth", width: t });
    }
    _handleWorkerMessage(t) {
      let e = t.data;
      switch (e.cmd) {
        case "alphaTab.preRender":
          this.preRender.trigger(e.resize);
          break;
        case "alphaTab.partialRenderFinished":
          this.partialRenderFinished.trigger(e.result);
          break;
        case "alphaTab.partialLayoutFinished":
          this.partialLayoutFinished.trigger(e.result);
          break;
        case "alphaTab.renderFinished":
          this.renderFinished.trigger(e.result);
          break;
        case "alphaTab.postRenderFinished":
          (this.boundsLookup = zi.fromJson(e.boundsLookup, this._api.score)),
            this.boundsLookup.finish(),
            this.postRenderFinished.trigger();
          break;
        case "alphaTab.error":
          this.error.trigger(e.error);
          break;
      }
    }
    renderScore(t, e) {
      let r = t == null ? null : $e.scoreToJsObject(J.prepareForPostMessage(t));
      this._worker.postMessage({
        cmd: "alphaTab.renderScore",
        score: r,
        trackIndexes: J.prepareForPostMessage(e),
        fontSizes: ti.fontSizeLookupTables,
      });
    }
  };
  var Fa = class {
    constructor(t, e, r, i) {
      (this.cursorWrapper = t),
        (this.barCursor = e),
        (this.beatCursor = r),
        (this.selectionWrapper = i);
    }
  };
  var rc = class extends Li {
    constructor(t, e, r) {
      super(t), (this._xscale = e), (this._yscale = r);
    }
    get width() {
      return this.element.offsetWidth / this._xscale;
    }
    set width(t) {
      this.element.style.width = `${t * this._xscale}px`;
    }
    get height() {
      return this.element.offsetHeight / this._yscale;
    }
    set height(t) {
      t >= 0
        ? (this.element.style.height = `${t * this._yscale}px`)
        : (this.element.style.height = "100%");
    }
    setBounds(t, e, r, i) {
      Number.isNaN(t) && (t = this.lastBounds.x),
        Number.isNaN(e) && (e = this.lastBounds.y),
        Number.isNaN(r) ? (r = this.lastBounds.w) : (r = r / this._xscale),
        Number.isNaN(i) ? (i = this.lastBounds.h) : (i = i / this._yscale),
        (this.element.style.transform = `translate(${t}px, ${e}px) scale(${r}, ${i})`),
        (this.element.style.transformOrigin = "top left"),
        (this.lastBounds.x = t),
        (this.lastBounds.y = e),
        (this.lastBounds.w = r),
        (this.lastBounds.h = i);
    }
  };
  var ic = class {
    constructor() {
      this.sampleRate = 44100;
      this._updateInterval = 0;
      this.ready = new Be();
      this.samplesPlayed = new Z();
      this.timeUpdate = new Z();
      this.sampleRequest = new Be();
    }
    get backingTrackDuration() {
      let t = this.audioElement.duration ?? 0;
      return Number.isFinite(t) ? t * 1e3 : 0;
    }
    get playbackRate() {
      return this.audioElement.playbackRate;
    }
    set playbackRate(t) {
      this.audioElement.playbackRate = t;
    }
    get masterVolume() {
      return this.audioElement.volume;
    }
    set masterVolume(t) {
      this.audioElement.volume = t;
    }
    seekTo(t) {
      this.audioElement.currentTime = t / 1e3;
    }
    loadBackingTrack(t) {
      this.audioElement?.src && URL.revokeObjectURL(this.audioElement.src);
      let e = new Blob([t.rawAudioFile]),
        r = this.audioElement.playbackRate;
      (this.audioElement.src = URL.createObjectURL(e)),
        (this.audioElement.playbackRate = r);
    }
    open(t) {
      let e = document.createElement("audio");
      (e.style.display = "none"),
        document.body.appendChild(e),
        e.addEventListener("seeked", () => {
          this._updatePosition();
        }),
        e.addEventListener("timeupdate", () => {
          this._updatePosition();
        }),
        (this.audioElement = e),
        this.ready.trigger();
    }
    _updatePosition() {
      let t = this.audioElement.currentTime * 1e3;
      this.timeUpdate.trigger(t);
    }
    play() {
      this.audioElement.play(),
        (this._updateInterval = window.setInterval(() => {
          this._updatePosition();
        }, 50));
    }
    destroy() {
      let t = this.audioElement;
      t && document.body.removeChild(t);
    }
    pause() {
      this.audioElement.pause(), window.clearInterval(this._updateInterval);
    }
    addSamples(t) {}
    resetSamples() {}
    activate() {}
    async enumerateOutputDevices() {
      return Nr.enumerateOutputDevices();
    }
    async setOutputDevice(t) {
      (await Nr.checkSinkIdSupport()) &&
        (t
          ? await this.audioElement.setSinkId(t.deviceId)
          : await this.audioElement.setSinkId(""));
    }
    async getOutputDevice() {
      if (!(await Nr.checkSinkIdSupport())) return null;
      let t = this.audioElement.sinkId;
      if (typeof t != "string" || t === "" || t === "default") return null;
      let e = Nr.findKnownDevice(t);
      if (e) return e;
      let r = await this.enumerateOutputDevices();
      return (
        (e = r.find((i) => i.deviceId === t)),
        e ||
          (w.warning(
            "WebAudio",
            "Could not find output device in device list",
            t,
            r
          ),
          null)
      );
    }
  };
  var sc = class sc {
    constructor(t, e) {
      this._promise = null;
      (this._exporterId = sc._nextExporterId++),
        (this._worker = t),
        (this._ownsWorker = e);
    }
    async initialize(t, e, r, i) {
      let n = this.handleWorkerMessage.bind(this);
      this._worker.worker.addEventListener("message", n, !1),
        (this._unsubscribe = () => {
          this._worker.worker.removeEventListener("message", n, !1);
        }),
        (this._promise = Promise.withResolvers()),
        this._worker.worker.postMessage({
          cmd: "alphaSynth.exporter.initialize",
          exporterId: this._exporterId,
          options: J.prepareForPostMessage(t),
          midi: $e.midiFileToJsObject(J.prepareForPostMessage(e)),
          syncPoints: J.prepareForPostMessage(r),
          transpositionPitches: J.prepareForPostMessage(i),
        }),
        await this._promise.promise;
    }
    handleWorkerMessage(t) {
      let e = t.data;
      if (e.exporterId !== this._exporterId) return;
      switch (e.cmd) {
        case "alphaSynth.exporter.initialized":
          this._promise?.resolve(null), (this._promise = null);
          break;
        case "alphaSynth.exporter.error":
          this._promise?.reject(e.error), (this._promise = null);
          break;
        case "alphaSynth.exporter.rendered":
          this._promise?.resolve(e.chunk), (this._promise = null);
          break;
        case "alphaSynth.destroyed":
          this._promise?.reject(new te(0, "Worker was destroyed")),
            (this._promise = null);
          break;
      }
    }
    async render(t) {
      if (this._promise)
        throw new te(
          0,
          "There is already an ongoing operation, wait for initialize to complete before requesting render"
        );
      return (
        (this._promise = Promise.withResolvers()),
        this._worker.worker.postMessage({
          cmd: "alphaSynth.exporter.render",
          exporterId: this._exporterId,
          milliseconds: t,
        }),
        await this._promise.promise
      );
    }
    destroy() {
      this._worker.worker.postMessage({
        cmd: "alphaSynth.exporter.destroy",
        exporterId: this._exporterId,
      }),
        this._unsubscribe(),
        this._ownsWorker && this._worker.destroy();
    }
    [Symbol.dispose]() {
      this.destroy();
    }
  };
  sc._nextExporterId = 1;
  var nc = sc;
  var $n = class $n {
    constructor(t) {
      this._fontCheckers = new Map();
      this._contents = null;
      this._file = null;
      this._totalResultCount = 0;
      this._initialTrackIndexes = null;
      this._barToElementLookup = new Map();
      this._resultIdToElementLookup = new Map();
      this.rootContainerBecameVisible = new Be();
      this.canRenderChanged = new Be();
      this._highlightedElements = [];
      this._scrollContainer = null;
      if (J.webPlatform !== 0 && J.webPlatform !== 2)
        throw new te(
          0,
          "Usage of AlphaTabApi is only possible in browser environments. For usage in node use the Low Level APIs"
        );
      t.classList.add("alphaTab"),
        (this.rootContainer = new Li(t)),
        (this.areWorkersSupported = "Worker" in window),
        (this._intersectionObserver = new IntersectionObserver(
          this._onElementVisibilityChanged.bind(this),
          { threshold: [0, 0.01, 1] }
        )),
        this._intersectionObserver.observe(t);
    }
    get resizeThrottle() {
      return 10;
    }
    get canRender() {
      return this._areAllFontsLoaded();
    }
    _areAllFontsLoaded() {
      let t = !1;
      for (let e of this._fontCheckers.values()) e.isFontLoaded || (t = !0);
      return t
        ? !1
        : (w.debug("Font", `All fonts loaded: ${this._fontCheckers.size}`), !0);
    }
    _onFontLoaded(t) {
      ti.generateFontLookup(t),
        this._areAllFontsLoaded() && this.canRenderChanged.trigger();
    }
    _onElementVisibilityChanged(t) {
      for (let e of t) {
        let r = e.target;
        if (r === this.rootContainer.element)
          e.isIntersecting &&
            (this.rootContainerBecameVisible.trigger(),
            this._intersectionObserver.unobserve(this.rootContainer.element));
        else if (
          "layoutResultId" in r &&
          this._api.settings.core.enableLazyLoading
        ) {
          let i = r;
          e.isIntersecting
            ? i.renderedResultId !== i.layoutResultId
              ? this._resultIdToElementLookup.has(i.layoutResultId)
                ? i.resultState !== 1 &&
                  ((i.resultState = 1),
                  this._api.renderer.renderResult(i.layoutResultId))
                : r.replaceChildren()
              : i.resultState === 3 &&
                (r.replaceChildren(...i.renderedResult), (i.resultState = 2))
            : i.resultState === 2 && ((i.resultState = 3), i.replaceChildren());
        }
      }
    }
    createWorkerRenderer() {
      return new tc(this._api, this._api.settings);
    }
    initialize(t, e) {
      this._api = t;
      let r;
      e instanceof kt ? (r = e) : (r = $e.jsObjectToSettings(e));
      let i = this._getDataAttributes();
      Gr.fromJson(r, i),
        r.notation.notationMode === 1 && r.setSongBookModeSettings(),
        (t.settings = r),
        this._setupFontCheckers(r),
        (this._initialTrackIndexes = this.parseTracks(r.core.tracks)),
        (this._contents = "");
      let n = t.container;
      r.core.tex &&
        ((this._contents = n.element.innerHTML), (n.element.innerHTML = "")),
        this._createStyleElements(r),
        (this._file = r.core.file);
    }
    _setupFontCheckers(t) {
      this._registerFontChecker(t.display.resources.copyrightFont),
        this._registerFontChecker(t.display.resources.effectFont),
        this._registerFontChecker(t.display.resources.graceFont),
        this._registerFontChecker(t.display.resources.markerFont),
        this._registerFontChecker(t.display.resources.tablatureFont),
        this._registerFontChecker(t.display.resources.titleFont),
        this._registerFontChecker(t.display.resources.wordsFont),
        this._registerFontChecker(t.display.resources.barNumberFont),
        this._registerFontChecker(t.display.resources.fretboardNumberFont),
        this._registerFontChecker(t.display.resources.subTitleFont);
    }
    _registerFontChecker(t) {
      if (!this._fontCheckers.has(t.families.join(", "))) {
        let e = new Tl(t.families);
        this._fontCheckers.set(t.families.join(", "), e),
          e.fontLoaded.on(this._onFontLoaded.bind(this)),
          e.checkForFontAvailability();
      }
    }
    destroy() {
      this.rootContainer.element.innerHTML = "";
      let t = this._webFont,
        e = this.rootContainer.element.ownerDocument,
        r = t.elements.get(e);
      r &&
        (r.usages--,
          r.usages <= 0 &&
            (r.element.remove(), t.elements.delete(e))),
        t.elements.size === 0 &&
          $n._registeredWebFonts.delete(t.hash);
    }
    createCanvasElement() {
      let t = this.rootContainer.element.ownerDocument.createElement("div");
      return (
        t.classList.add("at-surface", `at${this._webFont.fontSuffix}`),
        (t.style.fontSize = "0"),
        (t.style.overflow = "hidden"),
        (t.style.lineHeight = "0"),
        (t.style.position = "relative"),
        new Li(t)
      );
    }
    triggerEvent(t, e, r = null, i) {
      let n = t.element;
      e = `alphaTab.${e}`;
      let s = n.ownerDocument.createEvent("CustomEvent"),
        a = i ? i.mouseEvent : null;
      if (
        (s.initCustomEvent(e, !1, !1, r),
        a && (s.originalEvent = a),
        n.dispatchEvent(s),
        window && "jQuery" in window)
      ) {
        let o = window.jQuery,
          l = [];
        l.push(r), a && l.push(a), o(n).trigger(e, l);
      }
    }
    load(t, e, r) {
      if (t instanceof tt) return e(t), !0;
      if (t instanceof ArrayBuffer) {
        let i = new Uint8Array(t);
        return e(Zi.loadScoreFromBytes(i, this._api.settings)), !0;
      }
      return t instanceof Uint8Array
        ? (e(Zi.loadScoreFromBytes(t, this._api.settings)), !0)
        : typeof t == "string"
        ? (Zi.loadScoreAsync(t, e, r, this._api.settings), !0)
        : !1;
    }
    loadSoundFont(t, e) {
      return this._api.player
        ? t instanceof ArrayBuffer
          ? (this._api.player.loadSoundFont(new Uint8Array(t), e), !0)
          : t instanceof Uint8Array
          ? (this._api.player.loadSoundFont(t, e), !0)
          : typeof t == "string"
          ? (this._api.loadSoundFontFromUrl(t, e), !0)
          : !1
        : !1;
    }
    initialRender() {
      this._api.renderer.preRender.on((e) => {
        (this._totalResultCount = 0),
          this._resultIdToElementLookup.clear(),
          this._barToElementLookup.clear();
      });
      let t = () => {
        (this._api.renderer.width = this.rootContainer.width | 0),
          this._api.renderer.updateSettings(this._api.settings),
          this._contents
            ? (this._api.tex(
                this._contents,
                this._initialTrackIndexes ?? void 0
              ),
              (this._initialTrackIndexes = null))
            : this._file &&
              Zi.loadScoreAsync(
                this._file,
                (e) => {
                  this._api.renderScore(e, this._initialTrackIndexes ?? void 0),
                    (this._initialTrackIndexes = null);
                },
                (e) => {
                  this._api.onError(e);
                },
                this._api.settings
              );
      };
      this.rootContainer.isVisible
        ? t()
        : this.rootContainerBecameVisible.on(t);
    }
    _createStyleElements(t) {
      let e = this._api.container.element.ownerDocument;
      $n.createSharedStyleElement(e);
      let r =
          t.core.smuflFontSources ??
          zn.buildDefaultSmuflFontSources(t.core.fontDirectory),
        i = $n._cyrb53(r.values()),
        n = $n._registeredWebFonts;
      if (n.has(i)) {
        let h = n.get(i);
        h.checker.fontLoaded.on(this._onFontLoaded.bind(this)),
          this._createStyleElement(h, e),
          (this._webFont = h);
        return;
      }
      let s = n.size === 0 ? "" : String(n.size),
        a = `alphaTab${s}`,
        o = Array.from(r.entries())
          .map(
            (h) =>
              `url(${JSON.stringify(h[1])}) format('${$n._cssFormat(h[0])}')`
          )
          .join(","),
        l = `
            @font-face {
                font-display: block;
                font-family: '${a}';
                src: ${o};
                font-weight: normal;
                font-style: normal;
            }
            .at-surface.at${s} .at {
                font-family: '${a}';
                speak: none;
                font-style: normal;
                font-weight: normal;
                font-variant: normal;
                text-transform: none;
                line-height: 1;
                line-height: 1;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                font-size: ${t.display.resources.engravingSettings.musicFontSize}px;
                overflow: visible !important;
            }`;
      let c = new Tl([a]);
      c.fontLoaded.on(this._onFontLoaded.bind(this)),
        this._fontCheckers.set(a, c),
        c.checkForFontAvailability(),
        (t.display.resources.smuflFontFamilyName = a);
      let d = { hash: i, elements: new Map(), fontSuffix: s, checker: c, cssSource: l };
      this._createStyleElement(d, e),
        n.set(i, d),
        (this._webFont = d);
    }
    _createStyleElement(t, e) {
      if (t.elements.has(e)) {
        t.elements.get(e).usages++;
        return;
      }
      let r = e.createElement("style");
      (r.id = `alphaTabStyle${t.fontSuffix}`),
        (r.innerHTML = t.cssSource),
        e.getElementsByTagName("head").item(0).appendChild(r),
        t.elements.set(e, { element: r, usages: 1 });
    }
    static _cssFormat(t) {
      switch (t) {
        case 0:
          return "embedded-opentype";
        case 1:
          return "woff";
        case 2:
          return "woff2";
        case 3:
          return "opentype";
        case 4:
          return "truetype";
        case 5:
          return "svg";
      }
    }
    static _cyrb53(t, e = 0) {
      let r = 3735928559 ^ e,
        i = 1103547991 ^ e;
      for (let n of t)
        for (let s = 0; s < n.length; s++) {
          let a = n.charCodeAt(s);
          (r = Math.imul(r ^ a, 2654435761)),
            (i = Math.imul(i ^ a, 1597334677));
        }
      return (
        (r = Math.imul(r ^ (r >>> 16), 2246822507)),
        (r ^= Math.imul(i ^ (i >>> 13), 3266489909)),
        (i = Math.imul(i ^ (i >>> 16), 2246822507)),
        (i ^= Math.imul(r ^ (r >>> 13), 3266489909)),
        4294967296 * (2097151 & i) + (r >>> 0)
      );
    }
    static createSharedStyleElement(t) {
      let e = t.getElementById("alphaTabStyle");
      if (!e) {
        (e = t.createElement("style")), (e.id = "alphaTabStyleShared");
        let r = `
                .at-surface * {
                    cursor: default;
                    vertical-align: top;
                    overflow: visible;
                }
                .at-surface-svg text {
                    dominant-baseline: alphabetic;
                    white-space:pre;
                }`;
        (e.innerHTML = r),
          t.getElementsByTagName("head").item(0).appendChild(e);
      }
    }
    parseTracks(t) {
      if (!t) return [];
      let e = [];
      if (typeof t == "string")
        try {
          if (t === "all") return [-1];
          t = JSON.parse(t);
        } catch {
          t = [0];
        }
      if (typeof t == "number") e.push(t);
      else if ("length" in t) {
        let r = t.length,
          i = t;
        for (let n = 0; n < r; n++) {
          let s = i[n],
            a = 0;
          typeof s == "number"
            ? (a = s)
            : "index" in s
            ? (a = s.index)
            : (a = Number.parseInt(s.toString(), 10)),
            (a >= 0 || a === -1) && e.push(a);
        }
      } else "index" in t && e.push(t.index);
      return e;
    }
    _getDataAttributes() {
      let t = new Map(),
        e = this._api.container.element;
      if (e.dataset)
        for (let r of Object.keys(e.dataset)) {
          let i = e.dataset[r];
          try {
            i = JSON.parse(i);
          } catch {
            i === "" && (i = null);
          }
          t.set(r, i);
        }
      else
        for (let r = 0; r < e.attributes.length; r++) {
          let i = e.attributes.item(r),
            n = i.nodeName;
          if (n.startsWith("data-")) {
            let s = n.substr(5).split("-"),
              a = s[0];
            for (let l = 1; l < s.length; l++)
              a += s[l].substr(0, 1).toUpperCase() + s[l].substr(1);
            let o = i.nodeValue;
            try {
              o = JSON.parse(o);
            } catch {
              o === "" && (o = null);
            }
            t.set(a, o);
          }
        }
      return t;
    }
    beginUpdateRenderResults(t) {
      if (!this._resultIdToElementLookup.has(t.id)) return;
      let e = this._resultIdToElementLookup.get(t.id),
        r = t.renderResult;
      typeof r == "string"
        ? (e.innerHTML = r)
        : "nodeType" in r && e.replaceChildren(r),
        (e.resultState = 2),
        (e.renderedResultId = t.id),
        (e.renderedResult = Array.from(e.children));
    }
    beginAppendRenderResults(t) {
      let e = this._api.canvasElement.element;
      if (t) {
        let r;
        this._totalResultCount < e.childElementCount
          ? (r = e.childNodes.item(this._totalResultCount))
          : ((r = document.createElement("div")), e.appendChild(r)),
          (r.style.zIndex = "1"),
          (r.style.position = "absolute"),
          (r.style.left = `${t.x}px`),
          (r.style.top = `${t.y}px`),
          (r.style.width = `${t.width}px`),
          (r.style.height = `${t.height}px`),
          (r.style.display = "inline-block"),
          (r.layoutResultId = t.id),
          (r.resultState = 0),
          (r.renderedResultId = void 0),
          (r.renderedResult = void 0),
          this._resultIdToElementLookup.set(t.id, r);
        for (let i = t.firstMasterBarIndex; i <= t.lastMasterBarIndex; i++)
          i >= 0 && this._barToElementLookup.set(i, r);
        this._api.settings.core.enableLazyLoading &&
          (this._intersectionObserver.unobserve(r),
          this._intersectionObserver.observe(r)),
          this._totalResultCount++;
      } else
        for (; e.childElementCount > this._totalResultCount; )
          this._api.settings.core.enableLazyLoading &&
            this._intersectionObserver.unobserve(e.lastChild),
            e.removeChild(e.lastElementChild);
    }
    createWorkerPlayer() {
      let t = null,
        e = "ScriptProcessorNode" in window;
      return (
        window.isSecureContext &&
        "AudioWorkletNode" in window &&
        this._api.settings.player.outputMode === 0
          ? (w.debug(
              "Player",
              "Will use webworkers for synthesizing and web audio api with worklets for playback"
            ),
            (t = new qn(new ta(this._api.settings), this._api.settings)))
          : e &&
            (w.debug(
              "Player",
              "Will use webworkers for synthesizing and web audio api with ScriptProcessor for playback"
            ),
            (t = new qn(new Da(), this._api.settings))),
        t
          ? t.ready.on(() => {
              this._api.settings.player.soundFont &&
                this._api.loadSoundFontFromUrl(
                  this._api.settings.player.soundFont,
                  !1
                );
            })
          : w.error(
              "Player",
              "Player requires webworkers and web audio api, browser unsupported",
              null
            ),
        t
      );
    }
    createWorkerAudioExporter(t) {
      let e = t === null || !(t instanceof qn);
      return e && (t = this.createWorkerPlayer()), new nc(t, e);
    }
    beginInvoke(t) {
      window.requestAnimationFrame(() => {
        t();
      });
    }
    highlightElements(t, e) {
      let r = this._barToElementLookup.get(e);
      if (r) {
        let i = r.getElementsByClassName(t);
        for (let n = 0; n < i.length; n++)
          i.item(n).classList.add("at-highlight"),
            this._highlightedElements.push(i.item(n));
      }
    }
    removeHighlights() {
      let t = this._highlightedElements;
      if (t) {
        for (let e of t) e.classList.remove("at-highlight");
        this._highlightedElements = [];
      }
    }
    destroyCursors() {
      let t = this._api.container.element,
        e = t.querySelector(".at-cursors");
      t.removeChild(e);
    }
    createCursors() {
      let t = this._api.container.element,
        e = document.createElement("div");
      e.classList.add("at-cursors");
      let r = document.createElement("div");
      r.classList.add("at-selection");
      let i = this.createScalingElement(),
        n = this.createScalingElement(),
        s = i.element;
      s.classList.add("at-cursor-bar");
      let a = n.element;
      return (
        a.classList.add("at-cursor-beat"),
        (t.style.position = "relative"),
        (t.style.textAlign = "left"),
        (e.style.position = "absolute"),
        (e.style.zIndex = "1000"),
        (e.style.display = "inline"),
        (e.style.pointerEvents = "none"),
        (r.style.position = "absolute"),
        (s.style.position = "absolute"),
        (s.style.left = "0"),
        (s.style.top = "0"),
        (s.style.willChange = "transform"),
        (i.width = 1),
        (i.height = 1),
        i.setBounds(0, 0, 1, 1),
        (a.style.position = "absolute"),
        (a.style.transition = "all 0s linear"),
        (a.style.left = "0"),
        (a.style.top = "0"),
        (a.style.willChange = "transform"),
        (n.width = 3),
        (n.height = 1),
        n.setBounds(0, 0, 1, 1),
        t.insertBefore(e, t.firstChild),
        e.appendChild(r),
        e.appendChild(s),
        e.appendChild(a),
        new Fa(new Li(e), i, n, new Li(r))
      );
    }
    getOffset(t, e) {
      let r = e.element,
        i = r.getBoundingClientRect(),
        n = i.top + r.ownerDocument.defaultView.pageYOffset,
        s = i.left + r.ownerDocument.defaultView.pageXOffset;
      if (t) {
        let o = t.element,
          l = o.nodeName.toLowerCase();
        if (l !== "html" && l !== "body") {
          let u = this.getOffset(null, t);
          (n = n + o.scrollTop - u.y), (s = s + o.scrollLeft - u.x);
        }
      }
      let a = new we();
      return (a.x = s), (a.y = n), (a.w = i.width), (a.h = i.height), a;
    }
    getScrollContainer() {
      if (this._scrollContainer) return this._scrollContainer;
      let t =
          typeof this._api.settings.player.scrollElement == "string"
            ? document.querySelector(this._api.settings.player.scrollElement)
            : this._api.settings.player.scrollElement,
        e = t.nodeName.toLowerCase();
      return (
        (e === "html" || e === "body") &&
          ("scrollingElement" in document
            ? (t = document.scrollingElement)
            : navigator.userAgent.indexOf("WebKit") !== -1
            ? (t = document.body)
            : (t = document.documentElement)),
        (this._scrollContainer = new Li(t)),
        this._scrollContainer
      );
    }
    createSelectionElement() {
      return this.createScalingElement();
    }
    createScalingElement() {
      let t = document.createElement("div");
      t.style.position = "absolute";
      let e = new rc(t, 100, 100);
      return (e.width = 1), (e.height = 1), e.setBounds(0, 0, 1, 1), e;
    }
    scrollToY(t, e, r) {
      this._internalScrollToY(t.element, e, r);
    }
    scrollToX(t, e, r) {
      this._internalScrollToX(t.element, e, r);
    }
    _internalScrollToY(t, e, r) {
      if (this._api.settings.player.nativeBrowserSmoothScroll)
        t.scrollTo({ top: e, behavior: "smooth" });
      else {
        let i = t.scrollTop,
          n = e - i,
          s = 0,
          a = (o) => {
            s === 0 && (s = o);
            let l = o - s,
              u = Math.min(l / r, 1);
            (t.scrollTop = (i + n * u) | 0),
              l < r && window.requestAnimationFrame(a);
          };
        window.requestAnimationFrame(a);
      }
    }
    _internalScrollToX(t, e, r) {
      if (this._api.settings.player.nativeBrowserSmoothScroll)
        t.scrollTo({ left: e, behavior: "smooth" });
      else {
        let i = t.scrollLeft,
          n = e - i,
          s = 0,
          a = (o) => {
            s === 0 && (s = o);
            let l = o - s,
              u = Math.min(l / r, 1);
            (t.scrollLeft = (i + n * u) | 0),
              l < r && window.requestAnimationFrame(a);
          };
        window.requestAnimationFrame(a);
      }
    }
    createBackingTrackPlayer() {
      return new Aa(
        new ic(),
        this._api.settings.player.bufferTimeInMilliseconds
      );
    }
  };
  $n._registeredWebFonts = new Map();
  var ac = $n;
  var Ra = class {
    constructor(t, e) {
      (this.loaded = t), (this.total = e);
    }
  };
  var Oa = class p extends Ia {
    constructor(e, r) {
      super(new ac(e), r);
      this.soundFontLoad = new Z();
    }
    tex(e, r) {
      let i = this.uiFacade;
      super.tex(e, i.parseTracks(r));
    }
    print(e, r = null) {
      let i = window.open("", "", "width=0,height=0"),
        n = i.document.createElement("div");
      e
        ? (n.style.width = e)
        : this.settings.display.layoutMode === 1
        ? (n.style.width = "297mm")
        : (n.style.width = "210mm"),
        i.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <style>
            .at-surface {
                width: auto !important;
                height: auto !important;
            }
            .at-surface > div {
                position: relative!important;
                left: auto !important;
                top: auto !important;
                break-inside: avoid;
            }
            </style>
          </head>
          <body></body>
        </html>
        `);
      let s = this.score;
      s &&
        (s.artist && s.title
          ? (i.document.title = `${s.title} - ${s.artist}`)
          : s.title && (i.document.title = `${s.title}`)),
        i.document.body.appendChild(n);
      let a = typeof window.screenLeft < "u" ? window.screenLeft : window.left,
        o = typeof window.screenTop < "u" ? window.screenTop : window.top,
        l =
          "innerWidth" in window
            ? window.innerWidth
            : "clientWidth" in document.documentElement
            ? document.documentElement.clientWidth
            : window.screen.width,
        u =
          "innerHeight" in window
            ? window.innerHeight
            : "clientHeight" in document.documentElement
            ? document.documentElement.clientHeight
            : window.screen.height,
        c = n.offsetWidth + 50,
        d = window.innerHeight,
        h = ((l / 2) | 0) - ((c / 2) | 0) + a,
        f = ((u / 2) | 0) - ((d / 2) | 0) + o;
      i.resizeTo(c, d), i.moveTo(h, f), i.focus();
      let b = $e.jsObjectToSettings($e.settingsToJsObject(this.settings));
      (b.core.enableLazyLoading = !1),
        (b.core.useWorkers = !0),
        (b.core.file = null),
        (b.core.tracks = null),
        (b.player.enableCursor = !1),
        (b.player.playerMode = 0),
        (b.player.enableElementHighlighting = !1),
        (b.player.enableUserInteraction = !1),
        (b.player.soundFont = null),
        (b.display.scale = 0.8),
        (b.display.stretchForce = 0.8),
        Gr.fromJson(b, r);
      let y = new p(n, b);
      (i.onunload = () => {
        y.destroy();
      }),
        y.renderer.postRenderFinished.on(() => {
          i.print();
        }),
        y.renderTracks(this.tracks);
    }
    downloadMidi(e = 0) {
      if (!this.score) return;
      let r = new Ft();
      r.format = e;
      let i = new bi(r, !0);
      new Er(this.score, this.settings, i).generate();
      let s = r.toBinary(),
        a = this.score.title ? `${this.score.title}.mid` : "File.mid",
        o = document.createElement("a");
      o.download = a;
      let l = new Blob([s], { type: "audio/midi" }),
        u = URL.createObjectURL(l);
      (o.href = u),
        (o.style.display = "none"),
        document.body.appendChild(o),
        o.click(),
        document.body.removeChild(o);
    }
    changeTrackMute(e, r) {
      let i = this._trackIndexesToTracks(this.uiFacade.parseTracks(e));
      super.changeTrackMute(i, r);
    }
    changeTrackSolo(e, r) {
      let i = this._trackIndexesToTracks(this.uiFacade.parseTracks(e));
      super.changeTrackSolo(i, r);
    }
    changeTrackVolume(e, r) {
      let i = this._trackIndexesToTracks(this.uiFacade.parseTracks(e));
      super.changeTrackVolume(i, r);
    }
    _trackIndexesToTracks(e) {
      if (!this.score) return [];
      let r = [];
      if (e.length === 1 && e[0] === -1)
        for (let i of this.score.tracks) r.push(i);
      else
        for (let i of e)
          i >= 0 &&
            i < this.score.tracks.length &&
            r.push(this.score.tracks[i]);
      return r;
    }
    loadSoundFontFromUrl(e, r) {
      let i = this.player;
      if (!i) return;
      w.debug("AlphaSynth", `Start loading Soundfont from url ${e}`);
      let n = new XMLHttpRequest();
      n.open("GET", e, !0, null, null),
        (n.responseType = "arraybuffer"),
        (n.onload = (s) => {
          let a = new Uint8Array(n.response);
          this.loadSoundFont(a, r);
        }),
        (n.onerror = (s) => {
          w.error("AlphaSynth", `Loading failed: ${s.message}`),
            i.soundFontLoadFailed.trigger(new Wr(s.message, n));
        }),
        (n.onprogress = (s) => {
          w.debug(
            "AlphaSynth",
            `Soundfont downloading: ${s.loaded}/${s.total} bytes`
          );
          let a = new Ra(s.loaded, s.total);
          this.soundFontLoad.trigger(a),
            this.uiFacade.triggerEvent(this.container, "soundFontLoad", a);
        }),
        n.send();
    }
  };
  var kl = class {
    constructor() {
      this._initListeners = [];
    }
    exec(t, e, r) {
      if (
        (typeof e != "string" && ((r = [e]), (e = "init")),
        e.charCodeAt(0) === 95 || e === "exec")
      )
        return null;
      let i = new jQuery(t),
        n = i.data("alphaTab");
      if (e === "destroy" && !n) return null;
      if (e !== "init" && !n) throw new Error("alphaTab not initialized");
      let s = this[e];
      if (s) {
        let a = [i, n].concat(r);
        return s.apply(this, a);
      }
      return (
        w.error("Api", `Method '${e}' does not exist on jQuery.alphaTab`), null
      );
    }
    init(t, e, r) {
      if (!e) {
        (e = new Oa(t[0], r)), t.data("alphaTab", e);
        for (let i of this._initListeners) i(t, e, r);
      }
    }
    destroy(t, e) {
      t.removeData("alphaTab"), e.destroy();
    }
    print(t, e, r, i) {
      e.print(r, i);
    }
    load(t, e, r, i) {
      return e.load(r, i);
    }
    render(t, e) {
      e.render();
    }
    renderScore(t, e, r, i) {
      e.renderScore(r, i);
    }
    renderTracks(t, e, r) {
      e.renderTracks(r);
    }
    invalidate(t, e) {
      e.render();
    }
    tex(t, e, r, i) {
      e.tex(r, i);
    }
    muteTrack(t, e, r, i) {
      e.changeTrackMute(r, i);
    }
    soloTrack(t, e, r, i) {
      e.changeTrackSolo(r, i);
    }
    trackVolume(t, e, r, i) {
      e.changeTrackVolume(r, i);
    }
    loadSoundFont(t, e, r, i) {
      e.loadSoundFont(r, i);
    }
    resetSoundFonts(t, e) {
      e.resetSoundFonts();
    }
    pause(t, e) {
      e.pause();
    }
    play(t, e) {
      return e.play();
    }
    playPause(t, e) {
      e.playPause();
    }
    stop(t, e) {
      e.stop();
    }
    api(t, e) {
      return e;
    }
    player(t, e) {
      return e.player;
    }
    isReadyForPlayback(t, e) {
      return e.isReadyForPlayback;
    }
    playerState(t, e) {
      return e.playerState;
    }
    masterVolume(t, e, r) {
      return typeof r == "number" && (e.masterVolume = r), e.masterVolume;
    }
    metronomeVolume(t, e, r) {
      return typeof r == "number" && (e.metronomeVolume = r), e.metronomeVolume;
    }
    countInVolume(t, e, r) {
      return typeof r == "number" && (e.countInVolume = r), e.countInVolume;
    }
    midiEventsPlayedFilter(t, e, r) {
      return (
        Array.isArray(r) && (e.midiEventsPlayedFilter = r),
        e.midiEventsPlayedFilter
      );
    }
    playbackSpeed(t, e, r) {
      return typeof r == "number" && (e.playbackSpeed = r), e.playbackSpeed;
    }
    tickPosition(t, e, r) {
      return typeof r == "number" && (e.tickPosition = r), e.tickPosition;
    }
    timePosition(t, e, r) {
      return typeof r == "number" && (e.timePosition = r), e.timePosition;
    }
    loop(t, e, r) {
      return typeof r == "boolean" && (e.isLooping = r), e.isLooping;
    }
    renderer(t, e) {
      return e.renderer;
    }
    score(t, e) {
      return e.score;
    }
    settings(t, e) {
      return e.settings;
    }
    tracks(t, e) {
      return e.tracks;
    }
    _oninit(t) {
      this._initListeners.push(t);
    }
    static restore(t) {
      new jQuery(t).empty().removeData("alphaTab");
    }
  };
  var De = class De {
    constructor() {
      this._color = new ae(0, 0, 0, 0);
      this._lineWidth = 0;
      this._textStyle = null;
      this._scale = 1;
      this._textStyles = new Map();
      this._font = new ne("Arial", 10, 0);
      this._musicTextStyle = null;
      this.textAlign = 0;
      this.textBaseline = 0;
      (this._canvas = new De._alphaSkia.AlphaSkiaCanvas()),
        (this.color = new ae(0, 0, 0, 255));
    }
    static enable(t, e) {
      (De._alphaSkia = e),
        De.initializeMusicFont(De._alphaSkia.AlphaSkiaTypeface.register(t));
    }
    static initializeMusicFont(t) {
      De._defaultMusicTextStyle = new De._alphaSkia.AlphaSkiaTextStyle(
        [t.familyName],
        t.weight,
        t.isItalic
      );
    }
    static registerFont(t, e) {
      let r = De._alphaSkia.AlphaSkiaTypeface.register(t.buffer);
      return (
        e ||
          (e = ne.withFamilyList(
            [r.familyName],
            12,
            r.isItalic ? 1 : 0,
            r.weight > 400 ? 1 : 0
          )),
        e
      );
    }
    get font() {
      return this._font;
    }
    set font(t) {
      if (this._font === t) return;
      this._font = t;
      let e = this._textStyleKey(t);
      if (this._textStyles.has(e)) this._textStyle = this._textStyles.get(e);
      else {
        let r = new De._alphaSkia.AlphaSkiaTextStyle(
          t.families,
          t.weight === 1 ? 700 : 400,
          t.isItalic
        );
        this._textStyles.set(e, r), (this._textStyle = r);
      }
    }
    _textStyleKey(t) {
      return [
        ...t.families,
        t.weight.toString(),
        t.isItalic ? "italic" : "upright",
      ].join("_");
    }
    destroy() {
      this._canvas[Symbol.dispose]();
      for (let t of this._textStyles.values()) t[Symbol.dispose]();
    }
    onRenderFinished() {
      return null;
    }
    beginRender(t, e) {
      (this._scale = this.settings.display.scale),
        this._canvas.beginRender(t, e, J.highDpiFactor);
      let r = this.settings.display.resources.smuflFontFamilyName;
      r && r !== De._defaultMusicTextStyle.familyNames[0]
        ? this._textStyles.has(r)
          ? (this._musicTextStyle = this._textStyles.get(r))
          : ((this._musicTextStyle = new De._alphaSkia.AlphaSkiaTextStyle(
              [r],
              De._defaultMusicTextStyle.weight,
              De._defaultMusicTextStyle.isItalic
            )),
            this._textStyles.set(r, this._musicTextStyle))
        : (this._musicTextStyle = De._defaultMusicTextStyle);
    }
    endRender() {
      return this._canvas.endRender();
    }
    get color() {
      return this._color;
    }
    set color(t) {
      this._color.rgba !== t.rgba &&
        ((this._color = t),
        (this._canvas.color = De._alphaSkia.AlphaSkiaCanvas.rgbaToColor(
          t.r,
          t.g,
          t.b,
          t.a
        )));
    }
    get lineWidth() {
      return this._lineWidth;
    }
    set lineWidth(t) {
      (this._lineWidth = t), (this._canvas.lineWidth = t);
    }
    fillRect(t, e, r, i) {
      r > 0 &&
        this._canvas.fillRect(
          t * this._scale,
          e * this._scale,
          r * this._scale,
          i * this._scale
        );
    }
    strokeRect(t, e, r, i) {
      let n = this.lineWidth % 2 === 0 ? 0 : 0.5;
      this._canvas.strokeRect(
        t * this._scale + n,
        e * this._scale + n,
        r * this._scale,
        i * this._scale
      );
    }
    beginPath() {
      this._canvas.beginPath();
    }
    closePath() {
      this._canvas.closePath();
    }
    moveTo(t, e) {
      this._canvas.moveTo(t * this._scale, e * this._scale);
    }
    lineTo(t, e) {
      this._canvas.lineTo(t * this._scale, e * this._scale);
    }
    quadraticCurveTo(t, e, r, i) {
      this._canvas.quadraticCurveTo(
        t * this._scale,
        e * this._scale,
        r * this._scale,
        i * this._scale
      );
    }
    bezierCurveTo(t, e, r, i, n, s) {
      this._canvas.bezierCurveTo(
        t * this._scale,
        e * this._scale,
        r * this._scale,
        i * this._scale,
        n * this._scale,
        s * this._scale
      );
    }
    fillCircle(t, e, r) {
      this._canvas.fillCircle(
        t * this._scale,
        e * this._scale,
        r * this._scale
      );
    }
    strokeCircle(t, e, r) {
      this._canvas.strokeCircle(
        t * this._scale,
        e * this._scale,
        r * this._scale
      );
    }
    fill() {
      this._canvas.fill();
    }
    stroke() {
      this._canvas.stroke();
    }
    beginGroup(t) {}
    endGroup() {}
    fillText(t, e, r) {
      if (t.length === 0) return;
      let i = De._alphaSkia.AlphaSkiaTextAlign.Left;
      switch (this.textAlign) {
        case 0:
          i = De._alphaSkia.AlphaSkiaTextAlign.Left;
          break;
        case 1:
          i = De._alphaSkia.AlphaSkiaTextAlign.Center;
          break;
        case 2:
          i = De._alphaSkia.AlphaSkiaTextAlign.Right;
          break;
      }
      let n = De._alphaSkia.AlphaSkiaTextBaseline.Top;
      switch (this.textBaseline) {
        case 0:
          n = De._alphaSkia.AlphaSkiaTextBaseline.Top;
          break;
        case 1:
          n = De._alphaSkia.AlphaSkiaTextBaseline.Middle;
          break;
        case 2:
          n = De._alphaSkia.AlphaSkiaTextBaseline.Bottom;
          break;
        case 3:
          n = De._alphaSkia.AlphaSkiaTextBaseline.Alphabetic;
          break;
      }
      this._canvas.fillText(
        t,
        this._textStyle,
        this._font.size * this._scale,
        e * this._scale,
        r * this._scale,
        i,
        n
      );
    }
    measureText(t) {
      var n = [];
      try {
        let e = j(
          n,
          this._canvas.measureText(
            t,
            this._textStyle,
            this._font.size,
            De._alphaSkia.AlphaSkiaTextAlign.Left,
            De._alphaSkia.AlphaSkiaTextBaseline.Alphabetic
          )
        );
        let [r, i] = this._getTextWidthAndHeight(e, t);
        return new Xr(r, i);
      } catch (s) {
        var a = s,
          o = !0;
      } finally {
        ee(n, a, o);
      }
    }
    _getTextWidthAndHeight(t, e) {
      let r = t.width;
      if (e.length > 0 && r < 1)
        for (let n = 0; n < 5 && ((r = t.width), !(r > 1)); n++);
      let i = t.actualBoundingBoxAscent + t.actualBoundingBoxDescent;
      return [r, i];
    }
    fillMusicFontSymbol(t, e, r, i, n) {
      i !== -1 &&
        this._fillMusicFontSymbolText(t, e, r, String.fromCharCode(i), n);
    }
    fillMusicFontSymbols(t, e, r, i, n) {
      let s = "";
      for (let a of i) a !== -1 && (s += String.fromCharCode(a));
      this._fillMusicFontSymbolText(t, e, r, s, n);
    }
    _fillMusicFontSymbolText(t, e, r, i, n) {
      this._canvas.fillText(
        i,
        this._musicTextStyle,
        this.settings.display.resources.engravingSettings.musicFontSize *
          this._scale *
          r,
        t * this._scale,
        e * this._scale,
        n
          ? De._alphaSkia.AlphaSkiaTextAlign.Center
          : De._alphaSkia.AlphaSkiaTextAlign.Left,
        De._alphaSkia.AlphaSkiaTextBaseline.Alphabetic
      );
    }
    beginRotate(t, e, r) {
      this._canvas.beginRotate(t * this._scale, e * this._scale, r);
    }
    endRotate() {
      this._canvas.endRotate();
    }
  };
  De._defaultMusicTextStyle = null;
  var Ga = De;
  var Va = class p {
    constructor() {
      this.buffer = "";
      this._currentPath = "";
      this._currentPathIsEmpty = !0;
      this.scale = 1;
      this.color = new ae(255, 255, 255, 255);
      this.lineWidth = 1;
      this.font = new ne("Arial", 10, 0);
      this.textAlign = 0;
      this.textBaseline = 0;
    }
    destroy() {}
    beginRender(t, e) {
      (this.scale = this.settings.display.scale),
        (this.buffer = `<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${
          t | 0
        }px" height="${e | 0}px" class="at-surface-svg">
`),
        (this._currentPath = ""),
        (this._currentPathIsEmpty = !0),
        (this.textBaseline = 0);
    }
    beginGroup(t) {
      this.buffer += `<g class="${t}">`;
    }
    endGroup() {
      this.buffer += "</g>";
    }
    endRender() {
      return (this.buffer += "</svg>"), this.buffer;
    }
    fillRect(t, e, r, i) {
      r > 0 &&
        (this.buffer += `<rect x="${t * this.scale}" y="${
          e * this.scale
        }" width="${r * this.scale}" height="${i * this.scale}" fill="${
          this.color.rgba
        }" />
`);
    }
    strokeRect(t, e, r, i) {
      let n = (this.lineWidth * this.scale) % 2 === 0 ? 0 : 0.5;
      (this.buffer += `<rect x="${t * this.scale + n}" y="${
        e * this.scale + n
      }" width="${r * this.scale}" height="${i * this.scale}" stroke="${
        this.color.rgba
      }"`),
        this.lineWidth !== 1 &&
          (this.buffer += ` stroke-width="${this.lineWidth * this.scale}"`),
        (this.buffer += ` fill="transparent" />
`);
    }
    beginPath() {}
    closePath() {
      this._currentPath += " z";
    }
    moveTo(t, e) {
      this._currentPath += ` M${t * this.scale},${e * this.scale}`;
    }
    lineTo(t, e) {
      (this._currentPathIsEmpty = !1),
        (this._currentPath += ` L${t * this.scale},${e * this.scale}`);
    }
    quadraticCurveTo(t, e, r, i) {
      (this._currentPathIsEmpty = !1),
        (this._currentPath += ` Q${t * this.scale},${e * this.scale},${
          r * this.scale
        },${i * this.scale}`);
    }
    bezierCurveTo(t, e, r, i, n, s) {
      (this._currentPathIsEmpty = !1),
        (this._currentPath += ` C${t * this.scale},${e * this.scale},${
          r * this.scale
        },${i * this.scale},${n * this.scale},${s * this.scale}`);
    }
    fillCircle(t, e, r) {
      (this._currentPathIsEmpty = !1),
        (t *= this.scale),
        (e *= this.scale),
        (r *= this.scale),
        (this._currentPath += ` M${t - r},${e} A1,1 0 0,0 ${
          t + r
        },${e} A1,1 0 0,0 ${t - r},${e} z`),
        this.fill();
    }
    strokeCircle(t, e, r) {
      (this._currentPathIsEmpty = !1),
        (t *= this.scale),
        (e *= this.scale),
        (r *= this.scale),
        (this._currentPath += ` M${t - r},${e} A1,1 0 0,0 ${
          t + r
        },${e} A1,1 0 0,0 ${t - r},${e} z`),
        this.stroke();
    }
    fill() {
      this._currentPathIsEmpty ||
        ((this.buffer += `<path d="${this._currentPath}"`),
        this.color.rgba !== "#000000" &&
          (this.buffer += ` fill="${this.color.rgba}"`),
        (this.buffer += ' style="stroke: none"/>')),
        (this._currentPath = ""),
        (this._currentPathIsEmpty = !0);
    }
    stroke() {
      if (!this._currentPathIsEmpty) {
        let t = `<path d="${this._currentPath}" stroke="${this.color.rgba}"`;
        (this.lineWidth !== 1 || this.scale !== 1) &&
          (t += ` stroke-width="${this.lineWidth * this.scale}"`),
          (t += ' style="fill: none" />'),
          (this.buffer += t);
      }
      (this._currentPath = ""), (this._currentPathIsEmpty = !0);
    }
    fillText(t, e, r) {
      if (t === "") return;
      let i = `<text x="${e * this.scale}" y="${
        r * this.scale
      }" style='stroke: none; font:${this.font.toCssString(
        this.settings.display.scale
      )}; ${this.getSvgBaseLine()}'`;
      this.color.rgba !== "#000000" && (i += ` fill="${this.color.rgba}"`),
        this.textAlign !== 0 &&
          (i += ` text-anchor="${this.getSvgTextAlignment(this.textAlign)}"`),
        (i += `>${p._escapeText(t)}</text>`),
        (this.buffer += i);
    }
    static _escapeText(t) {
      return t
        .replace(/&/g, "&amp;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }
    getSvgTextAlignment(t) {
      switch (t) {
        case 0:
          return "start";
        case 1:
          return "middle";
        case 2:
          return "end";
      }
      return "";
    }
    getSvgBaseLine() {
      switch (this.textBaseline) {
        case 0:
          return "dominant-baseline: hanging";
        case 2:
          return "dominant-baseline: ideographic";
        case 3:
          return "";
        case 1:
          return "dominant-baseline: middle";
        default:
          return "";
      }
    }
    measureText(t) {
      return t
        ? ti.measureString(
            t,
            this.font.families,
            this.font.size,
            this.font.style,
            this.font.weight
          )
        : new Xr(0, 0);
    }
    onRenderFinished() {
      return null;
    }
    beginRotate(t, e, r) {
      this.buffer += `<g transform="translate(${t * this.scale} ,${
        e * this.scale
      }) rotate( ${r})">`;
    }
    endRotate() {
      this.buffer += "</g>";
    }
  };
  var Wa = class extends Va {
    fillMusicFontSymbol(t, e, r, i, n) {
      i !== -1 && this._fillMusicFontSymbolText(t, e, r, `&#${i};`, n);
    }
    fillMusicFontSymbols(t, e, r, i, n) {
      let s = "";
      for (let a of i) a !== -1 && (s += `&#${a};`);
      this._fillMusicFontSymbolText(t, e, r, s, n);
    }
    _fillMusicFontSymbolText(t, e, r, i, n) {
      (t *= this.scale),
        (e *= this.scale),
        (this.buffer += `<g transform="translate(${t} ${e})" class="at" ><text`);
      let s = this.scale * r;
      s !== 1
        ? (this.buffer += ` style="font-size: ${s * 100}%; stroke:none"`)
        : (this.buffer += ' style="stroke:none"'),
        this.color.rgba !== "#000000" &&
          (this.buffer += ` fill="${this.color.rgba}"`),
        n && (this.buffer += ` text-anchor="${this.getSvgTextAlignment(1)}"`),
        (this.buffer += `>${i}</text></g>`);
    }
  };
  var ri = class {
    constructor() {
      this.isInsideBracket = !0;
      this.isRelevantForBoundsLookup = !0;
      this.hideOnMultiTrack = !1;
      this.hideOnPercussionTrack = !1;
    }
    canCreate(t, e) {
      return !this.hideOnPercussionTrack || !e.isPercussion;
    }
  };
  var rt = class extends ue {
    constructor() {
      super(...arguments);
      this.glyphs = null;
    }
    get isEmpty() {
      return !this.glyphs || this.glyphs.length === 0;
    }
    getBoundingBoxTop() {
      let e = 0,
        r = this.glyphs;
      if (r)
        for (let i of r) {
          let n = i.getBoundingBoxTop();
          n < e && (e = n);
        }
      return e;
    }
    doLayout() {
      if (!this.glyphs || this.glyphs.length === 0) {
        this.width = 0;
        return;
      }
      let e = 0,
        r = 0;
      for (let i = 0, n = this.glyphs.length; i < n; i++) {
        let s = this.glyphs[i];
        (s.renderer = this.renderer),
          s.doLayout(),
          (e = Math.max(e, s.width)),
          (r = Math.max(r, s.y + s.height));
      }
      (this.width = e), (this.height = r);
    }
    addGlyph(e) {
      this.glyphs || (this.glyphs = []),
        this.renderer && (e.renderer = this.renderer),
        this.glyphs.push(e);
    }
    paint(e, r, i) {
      let n = this.glyphs;
      if (!(!n || n.length === 0))
        for (let s of n) s.paint(e + this.x, r + this.y, i);
    }
  };
  var ii = class extends rt {
    constructor() {
      super(0, 0);
      this.gap = 0;
      this.glyphs = [];
    }
    doLayout() {}
    addGlyph(e) {
      (e.x = this.width),
        (e.renderer = this.renderer),
        e.doLayout(),
        (this.width = e.x + e.width + this.gap),
        super.addGlyph(e);
    }
  };
  var $ = class p {
      static score(t, e, r, i = !1) {
        if (!r.style && !i) return;
        let n = p._scoreDefaultColor(t.settings.display.resources, e);
        return new Kn(t, e, r.style, n);
      }
      static scoreColor(t, e, r) {
        let i = p._scoreDefaultColor(t, e);
        if (r.style && r.style.colors.has(e)) return r.style.colors.get(e) ?? i;
      }
      static _scoreDefaultColor(t, e) {
        return t.mainGlyphColor;
      }
      static bar(t, e, r, i = !1) {
        if (!r.style && !i) return;
        let n = t.settings.display.resources.mainGlyphColor;
        switch (e) {
          case 0:
          case 1:
          case 2:
          case 3:
          case 12:
          case 13:
          case 14:
          case 15:
          case 16:
          case 17:
          case 18:
          case 19:
            break;
          case 8:
          case 9:
          case 10:
          case 11:
            n = t.settings.display.resources.barSeparatorColor;
            break;
          case 4:
          case 6:
          case 7:
          case 5:
            n = t.settings.display.resources.barNumberColor;
            break;
          case 20:
          case 21:
          case 22:
          case 23:
            n = t.settings.display.resources.staffLineColor;
            break;
        }
        return new Kn(t, e, r.style, n);
      }
      static voice(t, e, r, i = !1) {
        if (!r.style && !i) return;
        let n =
          r.index === 0
            ? t.settings.display.resources.mainGlyphColor
            : t.settings.display.resources.secondaryGlyphColor;
        return new Kn(t, e, r.style, n);
      }
      static trackColor(t, e, r) {
        let i = p._trackDefaultColor(t, e);
        if (r.style && r.style.colors.has(e)) return r.style.colors.get(e) ?? i;
      }
      static _trackDefaultColor(t, e) {
        let r = t.mainGlyphColor;
        switch (e) {
          case 0:
          case 2:
          case 3:
            break;
          case 1:
            r = t.barSeparatorColor;
            break;
        }
        return r;
      }
      static track(t, e, r, i = !1) {
        if (!r.style && !i) return;
        let n = p._trackDefaultColor(t.settings.display.resources, e);
        return new Kn(t, e, r.style, n);
      }
      static beatColor(t, e, r) {
        let i = p._beatDefaultColor(t, e, r);
        if (r.style && r.style.colors.has(e)) return r.style.colors.get(e) ?? i;
      }
      static _beatDefaultColor(t, e, r) {
        return r.voice.index === 0 ? t.mainGlyphColor : t.secondaryGlyphColor;
      }
      static beat(t, e, r, i = !1) {
        if (!r.style && !i) return;
        let n = p._beatDefaultColor(t.settings.display.resources, e, r);
        return new Kn(t, e, r.style, n);
      }
      static noteColor(t, e, r) {
        let i = p._noteDefaultColor(t, e, r);
        if (r.style && r.style.colors.has(e)) return r.style.colors.get(e) ?? i;
      }
      static _noteDefaultColor(t, e, r) {
        return r.beat.voice.index === 0
          ? t.mainGlyphColor
          : t.secondaryGlyphColor;
      }
      static note(t, e, r, i = !1) {
        if (!r.style && !i) return;
        let n =
          r.beat.voice.index === 0
            ? t.settings.display.resources.mainGlyphColor
            : t.settings.display.resources.secondaryGlyphColor;
        return new Kn(t, e, r.style, n);
      }
    },
    Kn = class {
      constructor(t, e, r, i) {
        (this._canvas = t),
          r && r.colors.has(e)
            ? ((this._previousColor = t.color),
              (t.color = r.colors.get(e) ?? i))
            : r || ((this._previousColor = t.color), (t.color = i));
      }
      [Symbol.dispose]() {
        this._previousColor && (this._canvas.color = this._previousColor);
      }
    };
  var vl = class extends rt {
    constructor(t, e, r) {
      super(t, e),
        (this.voice = r),
        (this.beatGlyphs = []),
        (this.tupletGroups = []);
    }
    scaleToWidth(t) {
      let e = this.renderer.layoutingInfo.spaceToForce(t);
      this._scaleToForce(e);
    }
    _scaleToForce(t) {
      this.width = this.renderer.layoutingInfo.calculateVoiceWidth(t);
      let e = this.renderer.layoutingInfo.buildOnTimePositions(t),
        r = this.beatGlyphs;
      for (let i = 0, n = r.length; i < n; i++) {
        let s = r[i];
        switch (s.beat.graceType) {
          case 0:
            s.x = e.get(s.beat.absoluteDisplayStart) - s.onTimeX;
            break;
          default:
            let a = s.beat.graceGroup.beats[0].absoluteDisplayStart,
              o = s.beat.graceGroup.id;
            if (s.beat.graceGroup.isComplete && e.has(a)) {
              s.x = e.get(a) - s.onTimeX;
              let l = this.renderer.layoutingInfo.allGraceRods.get(o),
                u =
                  s.beat.graceGroup.beats[s.beat.graceGroup.beats.length - 1]
                    .nextBeat,
                c = u ? this.renderer.layoutingInfo.getPreBeatSize(u) : 0;
              (s.x -= c),
                (s.x -= l[s.beat.graceIndex].postSpringWidth),
                (s.x += l[s.beat.graceIndex].graceBeatWidth);
              let d = l[s.beat.graceGroup.beats.length - 1];
              s.x -= d.graceBeatWidth;
            } else {
              let l = this.renderer.layoutingInfo.incompleteGraceRods.get(o),
                u =
                  l[s.beat.graceIndex].postSpringWidth -
                  l[s.beat.graceIndex].preSpringWidth;
              i > 0
                ? s.beat.graceIndex === 0
                  ? (s.x = r[i - 1].x + r[i - 1].width)
                  : (s.x =
                      r[i - 1].x +
                      l[s.beat.graceIndex - 1].postSpringWidth -
                      l[s.beat.graceIndex - 1].preSpringWidth -
                      u)
                : (s.x = -u);
            }
            break;
        }
        if (i > 0) {
          let a = s.x - r[i - 1].x;
          r[i - 1].scaleToWidth(a);
        }
        if (i === n - 1) {
          let a = this.width - r[r.length - 1].x;
          s.scaleToWidth(a);
        }
      }
    }
    registerLayoutingInfo(t) {
      let e = this.beatGlyphs;
      for (let r of e) r.registerLayoutingInfo(t);
    }
    applyLayoutingInfo(t) {
      let e = this.beatGlyphs;
      for (let r of e) r.applyLayoutingInfo(t);
      this._scaleToForce(
        Math.max(this.renderer.settings.display.stretchForce, t.minStretchForce)
      );
    }
    addGlyph(t) {
      let e = t;
      (t.x =
        this.beatGlyphs.length === 0
          ? 0
          : this.beatGlyphs[this.beatGlyphs.length - 1].x +
            this.beatGlyphs[this.beatGlyphs.length - 1].width),
        (t.renderer = this.renderer),
        t.doLayout(),
        this.beatGlyphs.push(e),
        (this.width = t.x + t.width),
        e.beat.hasTuplet &&
          e.beat.tupletGroup.beats[0].id === e.beat.id &&
          this.tupletGroups.push(e.beat.tupletGroup);
    }
    doLayout() {}
    paint(t, e, r) {
      var n = [];
      try {
        let i = j(n, $.voice(r, 0, this.voice, !0));
        for (let l = 0, u = this.beatGlyphs.length; l < u; l++)
          this.beatGlyphs[l].paint(t + this.x, e + this.y, r);
      } catch (s) {
        var a = s,
          o = !0;
      } finally {
        ee(n, a, o);
      }
    }
  };
  vl.KeySizeBeat = "Beat";
  var oh = class {
      constructor() {
        this.staffId = "";
        this.up = 0;
        this.down = 0;
      }
    },
    oc = class {
      constructor() {
        this.startBeat = null;
        this.startX = 0;
        this.startY = 0;
        this.endBeat = null;
        this.endX = 0;
        this.endY = 0;
      }
      calcY(t) {
        return this.startX === this.endX
          ? this.startY
          : ((this.endY - this.startY) / (this.endX - this.startX)) *
              (t - this.startX) +
              this.startY;
      }
    },
    ni = class p {
      constructor(t, e) {
        this._beatLineXPositions = new Map();
        this._firstNonRestBeat = null;
        this._lastNonRestBeat = null;
        this.voice = null;
        this.beats = [];
        this.shortestDuration = -4;
        this.hasTuplet = !1;
        this.slashBeats = [];
        this.lowestNoteInHelper = null;
        this._lowestNoteCompareValueInHelper = -1;
        this.highestNoteInHelper = null;
        this._highestNoteCompareValueInHelper = -1;
        this.invertBeamDirection = !1;
        this.preferredBeamDirection = null;
        this.graceType = 0;
        this.minRestLine = null;
        this.beatOfMinRestLine = null;
        this.maxRestLine = null;
        this.beatOfMaxRestLine = null;
        this.direction = 0;
        this.drawingInfos = new Map();
        (this._staff = t), (this._renderer = e), (this.beats = []);
      }
      get isRestBeamHelper() {
        return this.beats.length === 1 && this.beats[0].isRest;
      }
      hasLine(t, e) {
        return (
          (t && this._beatHasLine(e)) ||
          (!t && this.beats.length === 1 && this._beatHasLine(e))
        );
      }
      _beatHasLine(t) {
        return Math.abs(t.duration) > 1;
      }
      hasFlag(t, e) {
        return (
          (t && this._beatHasFlag(e)) ||
          (!t && this.beats.length === 1 && this._beatHasFlag(this.beats[0]))
        );
      }
      _beatHasFlag(t) {
        return (
          !t.deadSlapped && !t.isRest && (t.duration > 4 || t.graceType !== 0)
        );
      }
      getBeatLineX(t, e) {
        return (
          (e = e ?? this.direction),
          this.hasBeatLineX(t)
            ? e === 0
              ? this._beatLineXPositions.get(t.index).up
              : this._beatLineXPositions.get(t.index).down
            : 0
        );
      }
      hasBeatLineX(t) {
        return this._beatLineXPositions.has(t.index);
      }
      registerBeatLineX(t, e, r, i) {
        let n = this._getOrCreateBeatPositions(e);
        (n.staffId = t), (n.up = r), (n.down = i);
        for (let s of this.drawingInfos.values())
          s.startBeat === e
            ? (s.startX = this.getBeatLineX(e))
            : s.endBeat === e && (s.endX = this.getBeatLineX(e));
      }
      _getOrCreateBeatPositions(t) {
        return (
          this._beatLineXPositions.has(t.index) ||
            this._beatLineXPositions.set(t.index, new oh()),
          this._beatLineXPositions.get(t.index)
        );
      }
      finish() {
        (this.direction = this._calculateDirection()),
          this._renderer.completeBeamingHelper(this);
      }
      _calculateDirection() {
        if (!this.voice) return 0;
        if (this.preferredBeamDirection !== null)
          return this.preferredBeamDirection;
        if (this.voice.index > 0) return this._invert(1);
        if (this.voice.bar.isMultiVoice) return this._invert(0);
        if (this.beats[0].graceType !== 0) return this._invert(0);
        if (this.highestNoteInHelper && this.lowestNoteInHelper) {
          let t = this._renderer.getNoteY(this.highestNoteInHelper, 2),
            e = this._renderer.getNoteY(this.lowestNoteInHelper, 2),
            r = (t + e) / 2;
          return this._invert(this._renderer.middleYPosition < r ? 0 : 1);
        }
        return this._invert(0);
      }
      static computeLineHeightsForRest(t) {
        switch (t) {
          case -4:
            return [2, 2];
          case -2:
            return [2, 2];
          case 1:
            return [0, 1];
          case 2:
            return [1, 0];
          case 4:
            return [3, 3];
          case 8:
            return [2, 2];
          case 16:
            return [2, 4];
          case 32:
            return [4, 4];
          case 64:
            return [4, 6];
          case 128:
            return [6, 6];
          case 256:
            return [6, 8];
        }
        return [0, 0];
      }
      applyRest(t, e) {
        if (
          (this._lastNonRestBeat && t.index >= this._lastNonRestBeat.index) ||
          (this._firstNonRestBeat && t.index <= this._firstNonRestBeat.index)
        )
          return;
        let r = e,
          i = e,
          n = p.computeLineHeightsForRest(t.duration);
        (r -= n[0]), (i += n[1]);
        let s = this.minRestLine,
          a = this.maxRestLine;
        (s === null || s > r) &&
          ((this.minRestLine = r), (this.beatOfMinRestLine = t)),
          (a === null || a < i) &&
            ((this.maxRestLine = i), (this.beatOfMaxRestLine = t));
      }
      _invert(t) {
        return this.invertBeamDirection ? (t === 1 ? 0 : 1) : t;
      }
      checkBeat(t) {
        t.invertBeamDirection && (this.invertBeamDirection = !0),
          this.voice || (this.voice = t.voice);
        let e = !1;
        if (this.beats.length === 0) e = !0;
        else
          switch (this.beats[this.beats.length - 1].beamingMode) {
            case 0:
            case 3:
              e = p._canJoin(this.beats[this.beats.length - 1], t);
              break;
            case 1:
              e = !1;
              break;
            case 2:
              e = !0;
              break;
          }
        return (
          e &&
            (this.preferredBeamDirection == null &&
              t.preferredBeamDirection !== null &&
              (this.preferredBeamDirection = t.preferredBeamDirection),
            t.hasTuplet && (this.hasTuplet = !0),
            t.isTremolo &&
              (!this.tremoloDuration ||
                this.tremoloDuration < t.tremoloSpeed) &&
              (this.tremoloDuration = t.tremoloSpeed),
            t.graceType !== 0 && (this.graceType = t.graceType),
            t.isRest
              ? this.beats.push(t)
              : (
                this.beats.push(t),
                this._checkNote(t.minNote),
                this._checkNote(t.maxNote),
                this.shortestDuration < t.duration &&
                  (this.shortestDuration = t.duration),
                this._firstNonRestBeat || (this._firstNonRestBeat = t),
                (this._lastNonRestBeat = t)),
            t.slashed && this.slashBeats.push(t)),
          e
        );
      }
      _checkNote(t) {
        if (!t) return;
        let e, r;
        this.voice && t.isPercussion
          ? ((e = -pr.getPercussionLine(this.voice.bar, pr.getNoteValue(t))),
            (r = e))
          : ((e = pr.getNoteValue(t)),
            (r = e),
            t.harmonicType !== 0 &&
              t.harmonicType !== 1 &&
              (r = t.realValue - this._staff.displayTranspositionPitch)),
          (!this.lowestNoteInHelper ||
            e < this._lowestNoteCompareValueInHelper) &&
            ((this.lowestNoteInHelper = t),
            (this._lowestNoteCompareValueInHelper = e)),
          (!this.highestNoteInHelper ||
            r > this._highestNoteCompareValueInHelper) &&
            ((this.highestNoteInHelper = t),
            (this._highestNoteCompareValueInHelper = r));
      }
      static _canJoin(t, e) {
        if (
          !t ||
          !e ||
          t.graceType !== e.graceType ||
          t.graceType === 3 ||
          e.graceType === 3 ||
          t.deadSlapped ||
          e.deadSlapped
        )
          return !1;
        if (t.graceType !== 0 && e.graceType !== 0) return !0;
        let r = t.voice.bar,
          i = e.voice.bar;
        if (r !== i) return !1;
        let n = t.playbackStart,
          s = e.playbackStart;
        if (!p._canJoinDuration(t.duration) || !p._canJoinDuration(e.duration))
          return n === s;
        if (t.tupletGroup !== e.tupletGroup) return !1;
        if (
          t.hasTuplet &&
          e.hasTuplet &&
          t.tupletGroup === e.tupletGroup &&
          t.tupletGroup.isFull
        )
          return !0;
        let a = E.QuarterTime;
        r.masterBar.timeSignatureDenominator === 8 &&
          r.masterBar.timeSignatureNumerator % 3 === 0 &&
          (a += (E.QuarterTime / 2) | 0);
        let o = ((a + n) / a) | 0 | 0,
          l = ((a + s) / a) | 0 | 0;
        return o === l;
      }
      static _canJoinDuration(t) {
        switch (t) {
          case 1:
          case 2:
          case 4:
            return !1;
          default:
            return !0;
        }
      }
      static isFullBarJoin(t, e, r) {
        return (
          A.getIndex(t.duration) - 2 - r > 0 &&
          A.getIndex(e.duration) - 2 - r > 0
        );
      }
      get beatOfLowestNote() {
        return this.lowestNoteInHelper.beat;
      }
      get beatOfHighestNote() {
        return this.highestNoteInHelper.beat;
      }
      isPositionFrom(t, e) {
        return this._beatLineXPositions.has(e.index)
          ? this._beatLineXPositions.get(e.index).staffId === t ||
              !this._beatLineXPositions.get(e.index).staffId
          : !0;
      }
    };
  var lh = class {
      constructor(t, e) {
        this.topY = 0;
        this.bottomY = 0;
        (this.topY = t), (this.bottomY = e);
      }
    },
    uh = class {
      constructor(t) {
        this.topY = -1e3;
        this.bottomY = -1e3;
        this.slots = [];
        this.beat = t;
      }
      addSlot(t, e) {
        if ((this.slots.push(new lh(t, e)), this.topY === -1e3))
          (this.topY = t), (this.bottomY = e);
        else {
          let r = Math.min(t, e),
            i = Math.max(t, e);
          r < this.topY && (this.topY = r),
            i > this.bottomY && (this.bottomY = i);
        }
      }
    },
    lc = class {
      constructor() {
        this.reservedLayoutAreasByDisplayTime = new Map();
        this.restDurationsByDisplayTime = new Map();
      }
      getBeatMinMaxY() {
        let t = -1e3,
          e = -1e3;
        for (let r of this.reservedLayoutAreasByDisplayTime.values())
          t === -1e3
            ? ((t = r.topY), (e = r.bottomY))
            : (t > r.topY && (t = r.topY), e < r.bottomY && (e = r.bottomY));
        return t === -1e3 ? [0, 0] : [t, e];
      }
      reserveBeatSlot(t, e, r) {
        e !== r &&
          (this.reservedLayoutAreasByDisplayTime.has(t.displayStart) ||
            this.reservedLayoutAreasByDisplayTime.set(
              t.displayStart,
              new uh(t)
            ),
          this.reservedLayoutAreasByDisplayTime
            .get(t.displayStart)
            .addSlot(e, r),
          t.isRest && this.registerRest(t));
      }
      registerRest(t) {
        this.restDurationsByDisplayTime.has(t.displayStart) ||
          this.restDurationsByDisplayTime.set(t.displayStart, new Map()),
          this.restDurationsByDisplayTime
            .get(t.displayStart)
            .has(t.playbackDuration) ||
            this.restDurationsByDisplayTime
              .get(t.displayStart)
              .set(t.playbackDuration, t.id);
      }
      applyRestCollisionOffset(t, e, r) {
        if (
          t.voice.index > 0 &&
          this.reservedLayoutAreasByDisplayTime.has(t.playbackStart)
        ) {
          let i = ni.computeLineHeightsForRest(t.duration).map((u) => u * r),
            n = e - i[0],
            s = e + i[1],
            a = n,
            o = this.reservedLayoutAreasByDisplayTime.get(t.playbackStart),
            l = !1;
          for (let u of o.slots)
            if (
              (n >= u.topY && n <= u.bottomY) ||
              (s >= u.topY && s <= u.bottomY)
            ) {
              l = !0;
              break;
            }
          if (l) {
            t.voice.index === 1 ? (a = o.topY - i[1] - i[0]) : (a = o.bottomY);
            let u = a + i[0] + i[1],
              c = r * 2,
              d = Math.ceil(Math.abs(a - n) / c);
            return o.addSlot(a, u), a < n ? d * -c : d * c;
          }
        }
        return 0;
      }
    };
  var uc = class {
    constructor(t) {
      this.beamHelpers = [];
      this.beamHelperLookup = [];
      this.preferredBeamDirection = null;
      (this._renderer = t), (this.collisionHelper = new lc());
    }
    initialize() {
      let t = this._renderer,
        e = this._renderer.bar,
        r = null,
        i = null;
      for (let n = 0, s = e.voices.length; n < s; n++) {
        let a = e.voices[n];
        this.beamHelpers.push([]), this.beamHelperLookup.push(new Map());
        for (let o = 0, l = a.beats.length; o < l; o++) {
          let u = a.beats[o],
            c;
          u.graceType !== 0 ? (c = i) : ((c = r), (i = null)),
            (!c || !c.checkBeat(u)) &&
              (c && c.finish(),
              (c = new ni(e.staff, t)),
              (c.preferredBeamDirection = this.preferredBeamDirection),
              c.checkBeat(u),
              u.graceType !== 0 ? (i = c) : (r = c),
              this.beamHelpers[a.index].push(c)),
            this.beamHelperLookup[a.index].set(u.index, c);
        }
        r && r.finish(), i && i.finish(), (r = null), (i = null);
      }
    }
    getBeamingHelperForBeat(t) {
      return this.beamHelperLookup[t.voice.index].get(t.index);
    }
  };
  var xs = class extends Ve {
    constructor(e, r, i) {
      super(e, r);
      this._textRow = 0;
      this._fretRow = 0;
      this._firstFretSpacing = 0;
      this._chord = i;
    }
    doLayout() {
      super.doLayout();
      let r = this.renderer.resources.effectFont.size * 2 * 0.4;
      (this._textRow = r * 0.72),
        (this._fretRow = r * 0.5),
        this._chord.firstFret > 1
          ? (this._firstFretSpacing = r * 0.8)
          : (this._firstFretSpacing = 0);
      let i = r * 0.8,
        n = r * 4;
      (this.height = this._textRow + r * 0.5 + n + r * 0.5),
        (this.width =
          this._firstFretSpacing + (this._chord.strings.length - 1) * i + r);
    }
    paint(e, r, i) {
      let n = i.color,
        s = i.font,
        a = i.textAlign,
        o = i.textBaseline,
        l = i.lineWidth,
        u = this.renderer.resources,
        c = u.effectFont.size * 2 * 0.4,
        d = c * 0.8,
        h = new ae(200, 119, 118),
        f = new ae(0, 0, 0, 255),
        b = c / 20,
        y = c * 0.62 - 0.95,
        S = c * 0.31,
        k = c * 0.2;
      (e += this.x), (r += this.y);
      let T = e,
        O = (this._chord.strings.length - 1) * d,
        N = T - O / 2,
        R = r + this._textRow + c * 0.5;
      this._chord.showName &&
        ((i.textAlign = 1),
        (i.textBaseline = 1),
        (i.font = ne.withFamilyList(
          ["Arial", "sans-serif"],
          ((c * 1.7) / 3) * 2.5,
          u.effectFont.style,
          1
        )),
        (i.color = h),
        i.fillText(this._chord.name, T, r + (c * 0.72) / 2)),
        this._chord.firstFret > 1 &&
          ((i.textAlign = 1),
          (i.textBaseline = 1),
          (i.font = ne.withFamilyList(
            u.effectFont.families,
            (((c * 0.8) / 3) * 2.5) + 5,
            u.effectFont.style,
            u.effectFont.weight
          )),
          (i.color = f),
          i.fillText(
            this._chord.firstFret.toString(),
            N - this._firstFretSpacing / 2 - 2.5,
            R + c * 0.6
          )),
        (i.color = f),
        (i.lineWidth = b);
      for (let M = 0; M < this._chord.strings.length; M++) {
        let P = N + M * d;
        i.beginPath(), i.moveTo(P, R), i.lineTo(P, R + c * 4), i.stroke();
      }
      for (let M = 0; M < 5; M++) {
        let P = R + M * c;
        i.beginPath(), i.moveTo(N, P), i.lineTo(N + O, P), i.stroke();
      }
      i.lineWidth = c * 0.1;
      for (let M = 0; M < this._chord.strings.length; M++) {
        let P = this._chord.strings.length - 1 - M,
          H = N + P * d;
        if (this._chord.strings[M] === -1) {
          let fe = R - c * 0.2;
          i.beginPath(),
            i.moveTo(H - k, fe - k),
            i.lineTo(H + k, fe + k),
            i.stroke(),
            i.beginPath(),
            i.moveTo(H - k, fe + k),
            i.lineTo(H + k, fe - k),
            i.stroke();
        }
      }
      let g = new Map();
      for (let M of this._chord.barreFrets) {
        let P = [-1, -1];
        g.set(M - this._chord.firstFret, P);
      }
      let x = [];
      for (let M = 0; M < this._chord.strings.length; M++) {
        let P = this._chord.strings[M];
        if (P > 0) {
          let H = P - (this._chord.firstFret - 1),
            X = R + (H - 1) * c + c * 0.5,
            fe = this._chord.strings.length - 1 - M,
            Ee = N + fe * d;
          x.push({ x: Ee, y: X });
          let be = P - this._chord.firstFret;
          if (g.has(be)) {
            let Ae = g.get(be);
            (Ae[0] === -1 || M < Ae[0]) && (Ae[0] = M),
              (Ae[1] === -1 || M > Ae[1]) && (Ae[1] = M);
          }
        }
      }
      (i.lineWidth = y), i.beginPath();
      for (let [M, P] of g) {
        let H = M + 1,
          X = R + (H - 1) * c + c * 0.5,
          fe = P[0],
          Ee = P[1];
        if (fe !== -1 && Ee !== -1) {
          let be = N + (this._chord.strings.length - 1 - fe) * d,
            Ae = N + (this._chord.strings.length - 1 - Ee) * d;
          i.beginPath(), i.moveTo(be, X), i.lineTo(Ae, X), i.stroke();
        }
      }
      i.color = f;
      for (let M of x) i.fillCircle(M.x, M.y, S);
      (i.color = n),
        (i.font = s),
        (i.textAlign = a),
        (i.textBaseline = o),
        (i.lineWidth = l);
    }
  };
  xs._frets = 5;
  var _l = class extends rt {
    constructor(e, r, i = 1) {
      super(e, r);
      this._glyphWidth = 0;
      (this.glyphs = []), (this._align = i);
    }
    doLayout() {
      let e = this.renderer.smuflMetrics.rowContainerGap,
        r = this._glyphWidth - e,
        i = 0;
      switch (this._align) {
        case 0:
          i = 0;
          break;
        case 1:
          i = (this.width - r) / 2;
          break;
        case 2:
          i = this.width - r;
          break;
      }
      for (let n of this.glyphs) (n.x = i), (i += n.width + e);
    }
    addGlyphToRow(e) {
      this.glyphs.push(e),
        (this._glyphWidth +=
          e.width + this.renderer.smuflMetrics.rowContainerGap),
        e.height > this.height && (this.height = e.height);
    }
  };
  var Ha = class extends rt {
    constructor(e, r, i = 1) {
      super(e, r);
      this._rows = [];
      (this.height = 0), (this.glyphs = []), (this._align = i);
    }
    doLayout() {
      let e = 0,
        r = 0,
        i = this.renderer.smuflMetrics.rowContainerGap;
      this._rows = [];
      let n = new _l(e, r, this._align);
      (n.renderer = this.renderer), (n.width = this.width);
      for (let s of this.glyphs) {
        let a = e + s.width + i;
        a < this.width
          ? (n.addGlyphToRow(s), (e = Math.ceil(a)))
          : (n.isEmpty ||
              (n.doLayout(), this._rows.push(n), (r += n.height + i)),
            (e = 0),
            (n = new _l(e, r, this._align)),
            (n.renderer = this.renderer),
            (n.width = this.width),
            n.addGlyphToRow(s),
            (e += Math.ceil(s.width + i)));
      }
      n.isEmpty ||
        (n.doLayout(),
        this._rows.push(n),
        (r += Math.ceil(
          n.height + this.renderer.smuflMetrics.rowContainerPadding
        ))),
        (this.height = r);
    }
    paint(e, r, i) {
      for (let n of this._rows) n.paint(e + this.x, r + this.y, i);
    }
  };
  var cc = class extends Ha {
    addChord(t) {
      if (t.strings.length > 0) {
        let e = new xs(0, 0, t);
        (e.renderer = this.renderer), e.doLayout(), this.glyphs.push(e);
      }
    }
    paint(t, e, r) {
      if (this.glyphs.length > 0) {
        var i = [];
        try {
          let o = j(i, $.score(r, 10, this.renderer.scoreRenderer.score));
          super.paint(t, e, r);
        } catch (n) {
          var s = n,
            a = !0;
        } finally {
          ee(i, s, a);
        }
      }
    }
  };
  var it = class extends Ve {
    constructor(e, r, i, n, s = 0, a = null, o) {
      super(e, r);
      this._lineHeights = null;
      (this._lines = i.split(`
`)),
        (this.font = n),
        (this.textAlign = s),
        (this.textBaseline = a),
        (this.colorOverride = o);
    }
    doLayout() {
      super.doLayout(), (this._lineHeights = []);
      let e = this.renderer.scoreRenderer.canvas;
      for (let r of this._lines) {
        e.font = this.font;
        let i = e.measureText(r),
          n = i.height;
        this._lineHeights.push(n),
          (this.height += n),
          (this.width = Math.max(this.width, i.width));
      }
    }
    paint(e, r, i) {
      let n = i.color;
      (i.color = this.colorOverride ?? n), (i.font = this.font);
      let s = i.textAlign,
        a = i.textBaseline;
      (i.textAlign = this.textAlign),
        this.textBaseline !== null && (i.textBaseline = this.textBaseline);
      let o = r + this.y;
      for (let l = 0; l < this._lines.length; l++)
        i.fillText(this._lines[l], e + this.x, o), (o += this._lineHeights[l]);
      (i.textAlign = s), (i.textBaseline = a), (i.color = n);
    }
  };
  var dc = class {
    constructor(t, e, r) {
      this._sharedLayoutData = new Map();
      this.barRenderers = [];
      this.x = 0;
      this.y = 0;
      this.height = 0;
      this.index = 0;
      this.staffIndex = 0;
      this.isFirstInSystem = !1;
      this.trackIndex = 0;
      this.staveTop = 0;
      this.topSpacing = 0;
      this.bottomSpacing = 0;
      this.staveBottom = 0;
      (this._factory = r), (this.trackIndex = t), (this.modelStaff = e);
    }
    get staffId() {
      return this._factory.staffId;
    }
    get contentTop() {
      return this.y + this.staveTop + this.topSpacing + this.topOverflow;
    }
    get contentBottom() {
      return this.y + this.topSpacing + this.topOverflow + this.staveBottom;
    }
    getSharedLayoutData(t, e) {
      return this._sharedLayoutData.has(t) ? this._sharedLayoutData.get(t) : e;
    }
    setSharedLayoutData(t, e) {
      this._sharedLayoutData.set(t, e);
    }
    get isInsideBracket() {
      return this._factory.isInsideBracket;
    }
    get isRelevantForBoundsLookup() {
      return this._factory.isRelevantForBoundsLookup;
    }
    registerStaffTop(t) {
      this.staveTop = t;
    }
    registerStaffBottom(t) {
      this.staveBottom = t;
    }
    addBarRenderer(t) {
      (t.staff = this),
        (t.index = this.barRenderers.length),
        t.reLayout(),
        this.barRenderers.push(t),
        this.system.layout.registerBarRenderer(this.staffId, t);
    }
    addBar(t, e, r) {
      let i = this._factory.create(this.system.layout.renderer, t);
      (i.additionalMultiRestBars = r),
        (i.staff = this),
        (i.index = this.barRenderers.length),
        (i.layoutingInfo = e),
        i.doLayout(),
        i.registerLayoutingInfo();
      let n = i.barDisplayWidth;
      n > 0 && this.system.layout.systemsLayoutMode === 2 && (i.width = n),
        this.barRenderers.push(i),
        t && this.system.layout.registerBarRenderer(this.staffId, i);
    }
    revertLastBar() {
      let t = this.barRenderers[this.barRenderers.length - 1];
      this.barRenderers.splice(this.barRenderers.length - 1, 1),
        this.system.layout.unregisterBarRenderer(this.staffId, t);
      for (let e of this.barRenderers) e.applyLayoutingInfo();
      return t;
    }
    scaleToWidth(t) {
      this._sharedLayoutData = new Map();
      let e = this.topOverflow,
        r = 0;
      switch (this.system.layout.systemsLayoutMode) {
        case 0:
          let n = (t - this.system.computedWidth) / this.barRenderers.length;
          for (let a of this.barRenderers) {
            (a.x = r), (a.y = this.topSpacing + e);
            let o = a.computedWidth + n;
            a.scaleToWidth(o), (r += a.width);
          }
          break;
        case 1:
          t -= this.system.accoladeWidth;
          let s = this.system.totalBarDisplayScale;
          for (let a of this.barRenderers) {
            (a.x = r), (a.y = this.topSpacing + e);
            let o = (a.barDisplayScale * t) / s;
            a.scaleToWidth(o), (r += a.width);
          }
          break;
        case 2:
          for (let a of this.barRenderers) {
            (a.x = r), (a.y = this.topSpacing + e);
            let o = a.barDisplayWidth;
            o > 0 ? a.scaleToWidth(o) : a.scaleToWidth(a.computedWidth),
              (r += a.width);
          }
          break;
      }
    }
    get topOverflow() {
      let t = 0;
      for (let e = 0, r = this.barRenderers.length; e < r; e++) {
        let i = this.barRenderers[e];
        i.topOverflow > t && (t = i.topOverflow);
      }
      return t;
    }
    get bottomOverflow() {
      let t = 0;
      for (let e = 0, r = this.barRenderers.length; e < r; e++) {
        let i = this.barRenderers[e];
        i.bottomOverflow > t && (t = i.bottomOverflow);
      }
      return t;
    }
    calculateHeightForAccolade() {
      (this.topSpacing = this._factory.getStaffPaddingTop(this)),
        (this.bottomSpacing = this._factory.getStaffPaddingBottom(this)),
        (this.height =
          this.barRenderers.length > 0 ? this.barRenderers[0].height : 0),
        this.height > 0 &&
          (this.height += Math.ceil(
            this.topSpacing +
              this.topOverflow +
              this.bottomOverflow +
              this.bottomSpacing
          ));
    }
    finalizeStaff() {
      (this.topSpacing = this._factory.getStaffPaddingTop(this)),
        (this.bottomSpacing = this._factory.getStaffPaddingBottom(this)),
        (this.height = 0);
      let t = !1,
        e = this.topOverflow;
      for (let r = 0; r < this.barRenderers.length; r++)
        (this.barRenderers[r].y = this.topSpacing + e),
          (this.height = Math.max(this.height, this.barRenderers[r].height)),
          this.barRenderers[r].finalizeRenderer() && (t = !0);
      if (t) {
        e = this.topOverflow;
        for (let r = 0; r < this.barRenderers.length; r++)
          this.barRenderers[r].y = this.topSpacing + e;
        for (let r = 0; r < this.barRenderers.length; r++)
          this.barRenderers[r].finalizeRenderer();
      }
      this.height > 0 &&
        (this.height +=
          this.topSpacing + e + this.bottomOverflow + this.bottomSpacing),
        (this.height = Math.ceil(this.height));
    }
    paint(t, e, r, i, n) {
      if (!(this.height === 0 || n === 0))
        for (
          let s = i, a = Math.min(i + n, this.barRenderers.length);
          s < a;
          s++
        )
          this.barRenderers[s].paint(t + this.x, e + this.y, r);
    }
  };
  var xl = class {
    constructor() {
      this.timePosition = 0;
      this.longestDuration = 0;
      this.smallestDuration = 0;
      this.force = 0;
      this.springConstant = 0;
      this.preBeatWidth = 0;
      this.graceBeatWidth = 0;
      this.postSpringWidth = 0;
      this.allDurations = new Set();
    }
    get springWidth() {
      return this.preSpringWidth + this.postSpringWidth;
    }
    get preSpringWidth() {
      return this.preBeatWidth + this.graceBeatWidth;
    }
  };
  var Ua = class Ua {
    constructor() {
      this._timeSortedSprings = [];
      this._minTime = -1;
      this._onTimePositionsForce = 0;
      this._onTimePositions = new Map();
      this._incompleteGraceRodsWidth = 0;
      this._minDuration = Ua._defaultMinDuration;
      this.version = 0;
      this.preBeatSize = 0;
      this.postBeatSize = 0;
      this.minStretchForce = 0;
      this.totalSpringConstant = 0;
      this.incompleteGraceRods = new Map();
      this.allGraceRods = new Map();
      this.springs = new Map();
      this.height = 0;
    }
    _updateMinStretchForce(t) {
      this.minStretchForce < t && (this.minStretchForce = t);
    }
    getPreBeatSize(t) {
      if (t.graceType !== 0) {
        let r = t.graceGroup.id;
        return this.allGraceRods.get(r)[t.graceIndex].preBeatWidth;
      }
      let e = t.absoluteDisplayStart;
      return this.springs.has(e) ? this.springs.get(e).preBeatWidth : 0;
    }
    getPostBeatSize(t) {
      if (t.graceType !== 0) {
        let r = t.graceGroup.id;
        return this.allGraceRods.get(r)[t.graceIndex].postSpringWidth;
      }
      let e = t.absoluteDisplayStart;
      return this.springs.has(e) ? this.springs.get(e).postSpringWidth : 0;
    }
    addSpring(t, e, r, i, n) {
      this.version++;
      let s;
      if (this.springs.has(t))
        (s = this.springs.get(t)),
          s.postSpringWidth < n && (s.postSpringWidth = n),
          s.graceBeatWidth < r && (s.graceBeatWidth = r),
          s.preBeatWidth < i && (s.preBeatWidth = i),
          e < s.smallestDuration && (s.smallestDuration = e),
          e > s.longestDuration && (s.longestDuration = e),
          s.allDurations.add(e);
      else {
        if (
          ((s = new xl()),
          (s.timePosition = t),
          s.allDurations.add(e),
          this._timeSortedSprings.length > 0)
        ) {
          let l = e,
            u = this._timeSortedSprings[this._timeSortedSprings.length - 1];
          for (let c of u.allDurations)
            u.timePosition + c >= t && c < l && (l = c);
          e < this._minDuration && (this._minDuration = e);
        }
        (s.longestDuration = e),
          (s.postSpringWidth = n),
          (s.graceBeatWidth = r),
          (s.preBeatWidth = i),
          this.springs.set(t, s);
        let a = this._timeSortedSprings,
          o = a.length - 1;
        for (; o > 0 && a[o].timePosition > t; ) o--;
        this._timeSortedSprings.splice(o + 1, 0, s);
      }
      return (
        (this._minTime === -1 || this._minTime > t) && (this._minTime = t), s
      );
    }
    addBeatSpring(t, e, r) {
      let i = t.absoluteDisplayStart;
      if (t.graceType !== 0) {
        let n = t.graceGroup.id;
        this.allGraceRods.has(n) ||
          this.allGraceRods.set(n, new Array(t.graceGroup.beats.length)),
          !t.graceGroup.isComplete &&
            !this.incompleteGraceRods.has(n) &&
            this.incompleteGraceRods.set(
              n,
              new Array(t.graceGroup.beats.length)
            );
        let s = this.allGraceRods.get(n)[t.graceIndex];
        if (s)
          s.postSpringWidth < r && (s.postSpringWidth = r),
            s.preBeatWidth < e && (s.preBeatWidth = e);
        else {
          let a = new xl();
          (a.timePosition = i),
            (a.postSpringWidth = r),
            (a.preBeatWidth = e),
            t.graceGroup.isComplete ||
              (this.incompleteGraceRods.get(n)[t.graceIndex] = a),
            (this.allGraceRods.get(n)[t.graceIndex] = a);
        }
      } else {
        let n = 0;
        if (t.graceGroup && this.allGraceRods.has(t.graceGroup.id))
          for (let s of this.allGraceRods.get(t.graceGroup.id))
            n += s.springWidth;
        this.addSpring(i, t.displayDuration, n, e, r);
      }
    }
    finish() {
      for (let [t, e] of this.allGraceRods) {
        let r = 0;
        for (let i of e)
          (r += i.preBeatWidth),
            (i.graceBeatWidth = r),
            (r += i.postSpringWidth);
      }
      this._incompleteGraceRodsWidth = 0;
      for (let t of this.incompleteGraceRods.values())
        for (let e of t)
          this._incompleteGraceRodsWidth += e.preBeatWidth + e.postSpringWidth;
      this._calculateSpringConstants(), this.version++;
    }
    _calculateSpringConstants() {
      let t = 0,
        e = this._timeSortedSprings;
      if (e.length === 0) {
        (this.totalSpringConstant = -1), (this.minStretchForce = -1);
        return;
      }
      for (let r = 0; r < e.length; r++) {
        let i = e[r],
          n = 0;
        if (r === e.length - 1) n = i.longestDuration;
        else {
          let s = e[r + 1];
          n = Math.abs(s.timePosition - i.timePosition);
        }
        (i.springConstant = this._calculateSpringConstant(i, n)),
          (t += 1 / i.springConstant);
      }
      (this.totalSpringConstant = 1 / t), (this.minStretchForce = 0);
      for (let r = 0; r < e.length; r++) {
        let i = e[r],
          n = 0;
        if (r === e.length - 1) n = i.postSpringWidth;
        else {
          let a = e[r + 1];
          n = i.postSpringWidth + a.preSpringWidth;
        }
        r === 0 && (n += i.preSpringWidth);
        let s = n * i.springConstant;
        this._updateMinStretchForce(s);
      }
    }
    paint(t, e, r) {}
    _calculateSpringConstant(t, e) {
      e <= 0 && (e = E.toTicks(256)),
        t.smallestDuration === 0 && (t.smallestDuration = e);
      let r = t.smallestDuration,
        i = this._minDuration,
        n = Ua._defaultMinDurationWidth,
        s = 1 + 0.85 * Math.log2(e / i);
      return (r / e) * (1 / (s * n));
    }
    spaceToForce(t) {
      return this.totalSpringConstant !== -1
        ? (this._timeSortedSprings.length > 0 &&
            (t -= this._timeSortedSprings[0].preSpringWidth),
          (t -= this._incompleteGraceRodsWidth),
          Math.max(t, 0) * this.totalSpringConstant)
        : -1;
    }
    calculateVoiceWidth(t) {
      let e = 0;
      return (
        this.totalSpringConstant !== -1 &&
          (e = this._calculateWidth(t, this.totalSpringConstant)),
        this._timeSortedSprings.length > 0 &&
          (e += this._timeSortedSprings[0].preSpringWidth),
        (e += this._incompleteGraceRodsWidth),
        e
      );
    }
    _calculateWidth(t, e) {
      return t / e;
    }
    buildOnTimePositions(t) {
      if (this.totalSpringConstant === -1) return new Map();
      if (
        A.isAlmostEqualTo(this._onTimePositionsForce, t) &&
        this._onTimePositions
      )
        return this._onTimePositions;
      this._onTimePositionsForce = t;
      let e = new Map();
      this._onTimePositions = e;
      let r = this._timeSortedSprings;
      if (r.length === 0) return e;
      let i = r[0].preSpringWidth;
      for (let n = 0; n < r.length; n++)
        e.set(r[n].timePosition, i),
          (i += this._calculateWidth(t, r[n].springConstant));
      return e;
    }
  };
  (Ua._defaultMinDuration = 30), (Ua._defaultMinDurationWidth = 7);
  var pc = Ua;
  var hc = class {
    constructor() {
      this.width = 0;
      this.isLinkedToPrevious = !1;
      this.canWrap = !0;
      this.additionalMultiBarRestIndexes = null;
      this.renderers = [];
    }
    get lastMasterBarIndex() {
      return this.additionalMultiBarRestIndexes
        ? this.additionalMultiBarRestIndexes[
            this.additionalMultiBarRestIndexes.length - 1
          ]
        : this.masterBar.index;
    }
  };
  var mc = class {
    constructor(t, e) {
      this.staves = [];
      this.stavesRelevantForBoundsLookup = [];
      this.firstStaffInBracket = null;
      this.lastStaffInBracket = null;
      this.bracket = null;
      (this.staffSystem = t), (this.track = e);
    }
    addStaff(t) {
      this.staves.push(t),
        t.isRelevantForBoundsLookup &&
          this.stavesRelevantForBoundsLookup.push(t);
    }
  };
  var dh = class {
      constructor() {
        this.firstStaffInBracket = null;
        this.lastStaffInBracket = null;
        this.drawAsBrace = !1;
        this.braceScale = 1;
        this.width = 0;
        this.index = 0;
      }
      finalizeBracket(t) {
        if (this.firstStaffInBracket === this.lastStaffInBracket) {
          this.width = 0;
          return;
        }
        let e = t.glyphHeights.get(57344),
          r = t.glyphWidths.get(57344);
        if (
          (this.drawAsBrace
            ? (this.width = r)
            : (this.width = t.bracketThickness),
          !this.drawAsBrace ||
            !this.firstStaffInBracket ||
            !this.lastStaffInBracket)
        )
          return;
        let i = this.firstStaffInBracket.contentTop,
          a = (this.lastStaffInBracket.contentBottom - i) / e;
        (this.braceScale = a), (this.width = r * this.braceScale);
      }
    },
    fc = class p extends dh {
      constructor(t) {
        super(), (this.track = t), (this.drawAsBrace = p.isTrackDrawAsBrace(t));
      }
      includesStaff(t) {
        return t.modelStaff.track === this.track;
      }
      static isTrackDrawAsBrace(t) {
        return t.staves.filter((e) => e.showStandardNotation).length > 1;
      }
    },
    ph = class extends fc {
      includesStaff(t) {
        return t.modelStaff.track === this.track
          ? !0
          : this.drawAsBrace
          ? !1
          : this.track.playbackInfo.program ===
            t.modelStaff.track.playbackInfo.program;
      }
    },
    bc = class {
      constructor(t) {
        this._allStaves = [];
        this._firstStaffInBrackets = null;
        this._lastStaffInBrackets = null;
        this._accoladeSpacingCalculated = !1;
        this._brackets = [];
        this._hasSystemSeparator = !1;
        this.x = 0;
        this.y = 0;
        this.index = 0;
        this.accoladeWidth = 0;
        this.isFull = !1;
        this.width = 0;
        this.computedWidth = 0;
        this.totalBarDisplayScale = 0;
        this.isLast = !1;
        this.masterBarsRenderers = [];
        this.staves = [];
        (this.layout = t),
          (this.topPadding = t.renderer.settings.display.systemPaddingTop),
          (this.bottomPadding =
            t.renderer.settings.display.systemPaddingBottom);
      }
      get firstBarIndex() {
        return this.masterBarsRenderers[0].masterBar.index;
      }
      get lastBarIndex() {
        return this.masterBarsRenderers[this.masterBarsRenderers.length - 1]
          .lastMasterBarIndex;
      }
      addMasterBarRenderers(t, e) {
        if (t.length === 0) return null;
        this.masterBarsRenderers.push(e), (e.layoutingInfo.preBeatSize = 0);
        let r = 0;
        for (let i = 0, n = this.staves.length; i < n; i++) {
          let s = this.staves[i];
          for (let a = 0, o = s.staves.length; a < o; a++) {
            let l = s.staves[a],
              u = e.renderers[r++];
            l.addBarRenderer(u);
          }
        }
        return (
          this._calculateAccoladeSpacing(t), this._updateWidthFromLastBar(), e
        );
      }
      addBars(t, e, r) {
        let i = new hc();
        (i.additionalMultiBarRestIndexes = r),
          (i.layoutingInfo = new pc()),
          (i.masterBar = t[0].score.masterBars[e]),
          this.masterBarsRenderers.push(i);
        let n = i.layoutingInfo;
        for (let s of this.staves)
          for (let a of s.staves) {
            let o = s.track.staves[a.modelStaff.index].bars[e],
              l =
                r == null
                  ? null
                  : r.map((c) => s.track.staves[a.modelStaff.index].bars[c]);
            a.addBar(o, n, l);
            let u = a.barRenderers[a.barRenderers.length - 1];
            i.renderers.push(u),
              u.isLinkedToPrevious && (i.isLinkedToPrevious = !0),
              u.canWrap || (i.canWrap = !1);
          }
        return (
          this._calculateAccoladeSpacing(t),
          n.finish(),
          (i.width = this._updateWidthFromLastBar()),
          i
        );
      }
      revertLastBar() {
        if (this.masterBarsRenderers.length > 1) {
          let t = this.masterBarsRenderers[this.masterBarsRenderers.length - 1];
          this.masterBarsRenderers.splice(
            this.masterBarsRenderers.length - 1,
            1
          );
          let e = 0,
            r = 0;
          for (let i = 0, n = this._allStaves.length; i < n; i++) {
            let a = this._allStaves[i].revertLastBar(),
              o = a.computedWidth;
            o > e && (e = o);
            let l = a.barDisplayScale;
            l > r && (r = l);
          }
          return (
            (this.width -= e),
            (this.computedWidth -= e),
            (this.totalBarDisplayScale -= r),
            t
          );
        }
        return null;
      }
      _updateWidthFromLastBar() {
        let t = 0,
          e = 0;
        for (let r = 0, i = this._allStaves.length; r < i; r++) {
          let n = this._allStaves[r],
            s = n.barRenderers[n.barRenderers.length - 1];
          s.applyLayoutingInfo(), s.computedWidth > t && (t = s.computedWidth);
          let a = s.barDisplayScale;
          a > e && (e = a);
        }
        return (
          (this.width += t),
          (this.computedWidth += t),
          (this.totalBarDisplayScale += e),
          t
        );
      }
      _calculateAccoladeSpacing(t) {
        let e = this.layout.renderer.settings;
        if (!this._accoladeSpacingCalculated) {
          (this._accoladeSpacingCalculated = !0), (this.accoladeWidth = 0);
          let r = this.layout.renderer.score.stylesheet;
          if (
            this.layout.renderer.settings.notation.isNotationElementVisible(9)
          ) {
            let a =
                this.layout.renderer.tracks.length === 1
                  ? r.singleTrackTrackNamePolicy
                  : r.multiTrackTrackNamePolicy,
              o =
                this.index === 0
                  ? r.firstSystemTrackNameMode
                  : r.otherSystemsTrackNameMode,
              l =
                this.index === 0
                  ? r.firstSystemTrackNameOrientation
                  : r.otherSystemsTrackNameOrientation,
              u = !1;
            switch (a) {
              case 0:
                break;
              case 1:
                u = this.index === 0;
                break;
              case 2:
                u = !0;
                break;
            }
            let c = !1;
            if (u) {
              let d = this.layout.renderer.canvas,
                h = e.display.resources.effectFont;
              d.font = h;
              for (let f of t) {
                let b = "";
                switch (o) {
                  case 0:
                    b = f.name;
                    break;
                  case 1:
                    b = f.shortName;
                    break;
                }
                if (b.length > 0) {
                  c = !0;
                  let y = d.measureText(b);
                  switch (l) {
                    case 0:
                      this.accoladeWidth = Math.ceil(
                        Math.max(this.accoladeWidth, y.width)
                      );
                      break;
                    case 1:
                      this.accoladeWidth = Math.ceil(
                        Math.max(this.accoladeWidth, y.height)
                      );
                      break;
                  }
                }
              }
              c &&
                ((this.accoladeWidth += e.display.systemLabelPaddingLeft),
                (this.accoladeWidth += e.display.systemLabelPaddingRight));
            }
          }
          let n = 0;
          for (let a of this._allStaves)
            (a.y = n), a.calculateHeightForAccolade(), (n += a.height);
          let s = 0;
          for (let a of this._brackets)
            a.finalizeBracket(e.display.resources.engravingSettings),
              (s = Math.max(s, a.width));
          (this.accoladeWidth += s),
            (this.width += this.accoladeWidth),
            (this.computedWidth += this.accoladeWidth);
        }
      }
      _getStaffTrackGroup(t) {
        for (let e = 0, r = this.staves.length; e < r; e++) {
          let i = this.staves[e];
          if (i.track === t) return i;
        }
        return null;
      }
      addStaff(t, e) {
        let r = this._getStaffTrackGroup(t);
        if (
          (r || ((r = new mc(this, t)), this.staves.push(r)),
          (e.staffTrackGroup = r),
          (e.system = this),
          (e.index = this._allStaves.length),
          this._allStaves.push(e),
          r.addStaff(e),
          e.isInsideBracket)
        ) {
          this._firstStaffInBrackets ||
            ((this._firstStaffInBrackets = e), (e.isFirstInSystem = !0)),
            r.firstStaffInBracket || (r.firstStaffInBracket = e),
            (this._lastStaffInBrackets = e),
            (r.lastStaffInBracket = e);
          let i = this._brackets.find((n) => n.includesStaff(e));
          if (!i)
            switch (t.score.stylesheet.bracketExtendMode) {
              case 0:
                break;
              case 1:
                (i = new fc(t)),
                  (i.index = this._brackets.length),
                  this._brackets.push(i);
                break;
              case 2:
                (i = new ph(t)),
                  (i.index = this._brackets.length),
                  this._brackets.push(i);
                break;
            }
          i &&
            (i.firstStaffInBracket || (i.firstStaffInBracket = e),
            (i.lastStaffInBracket = e),
            (r.bracket = i));
        }
      }
      get height() {
        return this._allStaves.length === 0
          ? 0
          : Math.ceil(
              this._allStaves[this._allStaves.length - 1].y +
                this._allStaves[this._allStaves.length - 1].height +
                this.topPadding +
                this.bottomPadding
            );
      }
      scaleToWidth(t) {
        for (let e = 0, r = this._allStaves.length; e < r; e++)
          this._allStaves[e].scaleToWidth(t);
        this.width = t;
      }
      paint(t, e, r) {
        if (
          (this.paintPartial(
            t + this.x,
            e + this.y + this.topPadding,
            r,
            0,
            this.masterBarsRenderers.length
          ),
          this._hasSystemSeparator)
        ) {
          var i = [];
          try {
            let o = j(i, $.track(r, 2, this._allStaves[0].modelStaff.track));
            let l =
              this.layout.renderer.settings.display.resources.engravingSettings;
            let u = Math.min(0, l.glyphBottom.get(57351) ?? 0);
            ge.fillMusicFontSymbolSafe(
              r,
              t + this.x,
              e + this.y + this.height + u,
              1,
              57351,
              !1
            );
            ge.fillMusicFontSymbolSafe(
              r,
              t + this.x + this.width - l.glyphWidths.get(57351),
              e + this.y + this.height + u,
              1,
              57351,
              !1
            );
          } catch (n) {
            var s = n,
              a = !0;
          } finally {
            ee(i, s, a);
          }
        }
      }
      paintPartial(t, e, r, i, n) {
        for (let b = 0, y = this._allStaves.length; b < y; b++)
          this._allStaves[b].paint(t, e, r, i, n);
        let s = this.layout.renderer.settings.display.resources;
        if (this.staves.length > 0 && i === 0) {
          r.color = s.barSeparatorColor;
          let b = this.layout.renderer.settings,
            y =
              this.layout.renderer.settings.notation.isNotationElementVisible(
                9
              );
          if (((r.font = s.effectFont), y)) {
            let S = this.layout.renderer.score.stylesheet,
              k =
                this.layout.renderer.tracks.length === 1
                  ? S.singleTrackTrackNamePolicy
                  : S.multiTrackTrackNamePolicy,
              T =
                this.index === 0
                  ? S.firstSystemTrackNameMode
                  : S.otherSystemsTrackNameMode,
              O =
                this.index === 0
                  ? S.firstSystemTrackNameOrientation
                  : S.otherSystemsTrackNameOrientation,
              N = !1;
            switch (k) {
              case 0:
                break;
              case 1:
                N = this.index === 0;
                break;
              case 2:
                N = !0;
                break;
            }
            if (N) {
              let R = r.textBaseline,
                g = r.textAlign;
              for (let x of this.staves)
                if (x.firstStaffInBracket && x.lastStaffInBracket) {
                  var a = [];
                  try {
                    let M = e + x.firstStaffInBracket.contentTop;
                    let P = e + x.lastStaffInBracket.contentBottom;
                    let H = "";
                    switch (T) {
                      case 0:
                        H = x.track.name;
                        break;
                      case 1:
                        H = x.track.shortName;
                        break;
                    }
                    let X = j(a, $.track(r, 0, x.track));
                    if (H.length > 0) {
                      let fe =
                        t +
                        x.firstStaffInBracket.x -
                        b.display.accoladeBarPaddingRight -
                        (x.bracket?.width ?? 0) -
                        b.display.systemLabelPaddingRight;
                      switch (O) {
                        case 0:
                          (r.textBaseline = 1),
                            (r.textAlign = 2),
                            r.fillText(H, fe, (M + P) / 2);
                          break;
                        case 1:
                          (r.textBaseline = 2),
                            (r.textAlign = 1),
                            r.beginRotate(fe, (M + P) / 2, -90 - 0.1),
                            r.fillText(H, 0, 0),
                            r.endRotate();
                          break;
                      }
                    }
                  } catch (o) {
                    var l = o,
                      u = !0;
                  } finally {
                    ee(a, l, u);
                  }
                }
              (r.textBaseline = R), (r.textAlign = g);
            }
          }
          if (this._allStaves.length > 0) {
            let S = null;
            for (let k of this._allStaves)
              if (k.isInsideBracket) {
                if (S !== null) {
                  var c = [];
                  try {
                    let T = S.contentBottom;
                    let O = k.contentTop;
                    let N = t + S.x;
                    let R = S.barRenderers[0];
                    let g = j(c, $.bar(r, R.staffLineBarSubElement, R.bar));
                    let x = Math.ceil(O - T);
                    r.fillRect(
                      N,
                      e + T,
                      s.engravingSettings.thinBarlineThickness,
                      x
                    );
                  } catch (d) {
                    var h = d,
                      f = !0;
                  } finally {
                    ee(c, h, f);
                  }
                }
                S = k;
              }
          }
          for (let S of this._brackets)
            if (S.firstStaffInBracket && S.lastStaffInBracket) {
              let k = t + S.firstStaffInBracket.x,
                T = S.width,
                O = b.display.accoladeBarPaddingRight,
                N = e + S.firstStaffInBracket.contentTop,
                R = e + S.lastStaffInBracket.contentBottom,
                g = N,
                x = R;
              if (S.drawAsBrace)
                ge.fillMusicFontSymbolSafe(
                  r,
                  k - O - T,
                  x,
                  S.braceScale,
                  57344
                );
              else if (S.firstStaffInBracket !== S.lastStaffInBracket) {
                let M = T / 2;
                (g -= M),
                  (x += M * 2),
                  r.fillRect(k - O - T, g, T, Math.ceil(x - g));
                let P = k - O - T;
                ge.fillMusicFontSymbolSafe(r, P, g, 1, 57347),
                  ge.fillMusicFontSymbolSafe(r, P, Math.floor(x), 1, 57348);
              }
            }
        }
      }
      finalizeSystem() {
        let t = this.layout.renderer.settings;
        if (
          (this.index === 0 &&
            (this.topPadding = t.display.firstSystemPaddingTop),
          this.isLast)
        )
          this.bottomPadding = t.display.lastSystemPaddingBottom;
        else if (
          this.layout.renderer.score.stylesheet.useSystemSignSeparator &&
          this.layout.renderer.tracks.length > 1
        ) {
          let r = t.display.resources.engravingSettings.glyphHeights.get(57351);
          (this.bottomPadding = Math.max(this.bottomPadding, r)),
            (this._hasSystemSeparator = !0);
        }
        let e = 0;
        for (let r of this._allStaves)
          (r.x = this.accoladeWidth),
            (r.y = e),
            r.finalizeStaff(),
            (e += r.height);
        for (let r of this._brackets)
          r.finalizeBracket(t.display.resources.engravingSettings);
      }
      buildBoundingsLookup(t, e) {
        if (this.layout.renderer.boundsLookup.isFinished) return;
        let r = this._firstStaffInBrackets,
          i = this._lastStaffInBrackets;
        if (!r || !i) return;
        e += this.topPadding;
        let n = this._allStaves[this._allStaves.length - 1],
          s = e + this.y + r.y,
          a = e + this.y + i.y + i.height,
          o = e + this.y + this._allStaves[0].y,
          l = e + this.y + n.y + n.height,
          u =
            e +
            this.y +
            r.y +
            r.topSpacing +
            r.topOverflow +
            (r.barRenderers.length > 0 ? r.barRenderers[0].topPadding : 0),
          c =
            e +
            this.y +
            n.y +
            n.height -
            n.bottomSpacing -
            n.bottomOverflow -
            (n.barRenderers.length > 0 ? n.barRenderers[0].bottomPadding : 0),
          d = a - s,
          h = c - u,
          f = l - o,
          b = this.x + r.x,
          y = new Sn();
        (y.visualBounds = new we()),
          (y.visualBounds.x = t + this.x),
          (y.visualBounds.y = e + this.y),
          (y.visualBounds.w = this.width),
          (y.visualBounds.h =
            this.height - this.topPadding - this.bottomPadding),
          (y.realBounds = new we()),
          (y.realBounds.x = t + this.x),
          (y.realBounds.y = e + this.y),
          (y.realBounds.w = this.width),
          (y.realBounds.h = this.height),
          this.layout.renderer.boundsLookup.addStaffSystem(y);
        let S = new Map();
        for (let k = 0; k < this.staves.length; k++)
          for (let T of this.staves[k].stavesRelevantForBoundsLookup)
            for (let O of T.barRenderers) {
              let N;
              S.has(O.bar.masterBar.index)
                ? (N = S.get(O.bar.masterBar.index))
                : ((N = new yn()),
                  (N.index = O.bar.masterBar.index),
                  (N.isFirstOfLine = O.isFirstOfLine),
                  (N.realBounds = new we()),
                  (N.realBounds.x = b + O.x),
                  (N.realBounds.y = o),
                  (N.realBounds.w = O.width),
                  (N.realBounds.h = f),
                  (N.visualBounds = new we()),
                  (N.visualBounds.x = b + O.x),
                  (N.visualBounds.y = s),
                  (N.visualBounds.w = O.width),
                  (N.visualBounds.h = d),
                  (N.lineAlignedBounds = new we()),
                  (N.lineAlignedBounds.x = b + O.x),
                  (N.lineAlignedBounds.y = u),
                  (N.lineAlignedBounds.w = O.width),
                  (N.lineAlignedBounds.h = h),
                  this.layout.renderer.boundsLookup.addMasterBar(N),
                  S.set(N.index, N)),
                O.buildBoundingsLookup(N, b, e + this.y + T.y);
            }
      }
      getBarX(t) {
        if (
          !this._firstStaffInBrackets ||
          this.layout.renderer.tracks.length === 0
        )
          return 0;
        let e = this.layout.renderer.tracks[0].staves[0].bars[t];
        return this.layout.getRendererForBar(
          this._firstStaffInBrackets.staffId,
          e
        ).x;
      }
    };
  var gc = class extends Ha {
    constructor(t, e) {
      super(t, e, 0);
    }
  };
  var yc = class extends rt {
    constructor(t, e, r, i) {
      super(t, e),
        (this._tuning = r),
        (this._trackLabel = i),
        (this.glyphs = []);
    }
    doLayout() {
      if (!(this.glyphs.length > 0)) {
        this._createGlyphs(this._tuning);
        for (let t of this.glyphs) (t.renderer = this.renderer), t.doLayout();
      }
    }
    paint(t, e, r) {
      let i = r.color;
      this.colorOverride && (r.color = this.colorOverride),
        super.paint(t, e, r),
        (r.color = i);
    }
    _createGlyphs(t) {
      let e = this.renderer.resources;
      if (((this.height = 0), this._trackLabel.length > 0)) {
        let s = new it(0, this.height, this._trackLabel, e.effectFont, 0);
        (s.renderer = this.renderer),
          s.doLayout(),
          (this.height += s.height),
          this.addGlyph(s);
      }
      if (t.name.length > 0) {
        let s = new it(0, this.height, t.name, e.effectFont, 0);
        (s.renderer = this.renderer),
          s.doLayout(),
          (this.height += s.height),
          this.addGlyph(s);
      }
      let r = this.renderer.smuflMetrics.tuningGlyphCircleNumberScale,
        i = this.renderer.smuflMetrics.glyphHeights.get(59443) * r;
      this.renderer.scoreRenderer.canvas.font = e.effectFont;
      let n =
        (i + this.renderer.scoreRenderer.canvas.measureText(" = Gb").width) *
        e.engravingSettings.tuningGlyphStringColumnScale;
      if (
        ((this.width = Math.max(
          this.renderer.scoreRenderer.canvas.measureText(this._trackLabel)
            .width,
          Math.max(
            this.renderer.scoreRenderer.canvas.measureText(t.name).width,
            2 * n
          )
        )),
        !t.isStandard)
      ) {
        let s = Math.ceil(t.tunings.length / 2) | 0,
          a = 0,
          o =
            this.height +
            this.renderer.smuflMetrics.tuningGlyphStringRowPadding,
          l = o;
        for (let u = 0, c = t.tunings.length; u < c; u++) {
          let d = 59443 + (u + 1);
          this.addGlyph(new ce(a, l + i, r, d));
          let h = ` = ${lt.getTextForTuning(t.tunings[u], !1)}`;
          this.addGlyph(new it(a + i, l + i / 2, h, e.effectFont, 0, 1)),
            (l += i + this.renderer.smuflMetrics.tuningGlyphStringRowPadding);
          let f = l;
          this.height < f && (this.height = f),
            u === s - 1 && ((l = o), (a += n));
        }
      }
    }
  };
  var hh = class {
    constructor(t, e) {
      (this.args = t), (this.renderCallback = e);
    }
  };
  var ws = class ws {
    constructor(t) {
      this._barRendererLookup = new Map();
      this.pagePadding = null;
      this.width = 0;
      this.height = 0;
      this.multiBarRestInfo = null;
      this.headerGlyphs = new Map();
      this.footerGlyphs = new Map();
      this.chordDiagrams = null;
      this.tuningGlyph = null;
      this.systemsLayoutMode = 0;
      this._lazyPartials = new Map();
      this.firstBarIndex = 0;
      this.lastBarIndex = 0;
      this.renderer = t;
    }
    get scaledWidth() {
      return Math.round(this.width / this.renderer.settings.display.scale);
    }
    resize() {
      this._lazyPartials.clear(), this.doResize();
    }
    layoutAndRender() {
      this._lazyPartials.clear();
      let t = this.renderer.score;
      (this.firstBarIndex = A.computeFirstDisplayedBarIndex(
        t,
        this.renderer.settings
      )),
        (this.lastBarIndex = A.computeLastDisplayedBarIndex(
          t,
          this.renderer.settings,
          this.firstBarIndex
        )),
        (this.multiBarRestInfo = A.buildMultiBarRestInfo(
          this.renderer.tracks,
          this.firstBarIndex,
          this.lastBarIndex
        )),
        (this.pagePadding = this.renderer.settings.display.padding.map(
          (e) => e / this.renderer.settings.display.scale
        )),
        this.pagePadding || (this.pagePadding = [0, 0, 0, 0]),
        this.pagePadding.length === 1
          ? (this.pagePadding = [
              this.pagePadding[0],
              this.pagePadding[0],
              this.pagePadding[0],
              this.pagePadding[0],
            ])
          : this.pagePadding.length === 2 &&
            (this.pagePadding = [
              this.pagePadding[0],
              this.pagePadding[1],
              this.pagePadding[0],
              this.pagePadding[1],
            ]),
        this._createScoreInfoGlyphs(),
        this.doLayoutAndRender();
    }
    registerPartial(t, e) {
      if (t.height === 0) return;
      let r = this.renderer.settings.display.scale;
      (t.x *= r),
        (t.y *= r),
        (t.width *= r),
        (t.height *= r),
        (t.totalWidth *= r),
        (t.totalHeight *= r),
        this.renderer.settings.core.enableLazyLoading
          ? (this._lazyPartials.set(t.id, new hh(t, e)),
            this.renderer.partialLayoutFinished.trigger(t))
          : (this.renderer.partialLayoutFinished.trigger(t),
            this._internalRenderLazyPartial(t, e));
    }
    _internalRenderLazyPartial(t, e) {
      let r = this.renderer.canvas;
      r.beginRender(t.width, t.height),
        e(r),
        (t.renderResult = r.endRender()),
        this.renderer.partialRenderFinished.trigger(t);
    }
    renderLazyPartial(t) {
      if (this._lazyPartials.has(t)) {
        let e = this._lazyPartials.get(t);
        this._internalRenderLazyPartial(e.args, e.renderCallback);
      }
    }
    _createHeaderFooterGlyph(t, e, r, i) {
      switch (r) {
        case 6:
          if (e.words !== e.music) return;
          break;
        case 4:
        case 5:
          if (e.words === e.music) return;
          break;
        case 9:
          if (!this.footerGlyphs.has(8)) return;
          break;
      }
      let n = t.display.resources,
        s = t.notation,
        o =
          e.style && e.style.headerAndFooter.has(r)
            ? e.style.headerAndFooter.get(r)
            : Jt.defaultHeaderAndFooter.get(r),
        l = o.isVisible !== void 0 ? o.isVisible : !0;
      if ((i !== void 0 && (l = s.isNotationElementVisible(i)), !l)) return;
      let u = o.buildText(e);
      if (u)
        return new it(
          0,
          0,
          u,
          n.getFontForElement(r),
          o.textAlign,
          void 0,
          $.scoreColor(n, r, e)
        );
    }
    _createScoreInfoGlyphs() {
      w.debug("ScoreLayout", "Creating score info glyphs");
      let t = this.renderer.settings,
        e = this.renderer.score;
      (this.headerGlyphs = new Map()), (this.footerGlyphs = new Map());
      let r = new ji(this.renderer, this.renderer.tracks[0].staves[0].bars[0]);
      for (let [s, a] of ws.headerElements.value) {
        let o = this._createHeaderFooterGlyph(t, e, s, a);
        o && ((o.renderer = r), o.doLayout(), this.headerGlyphs.set(s, o));
      }
      for (let [s, a] of ws.footerElements.value) {
        let o = this._createHeaderFooterGlyph(t, e, s, a);
        o && ((o.renderer = r), o.doLayout(), this.footerGlyphs.set(s, o));
      }
      let i = t.notation,
        n = t.display.resources;
      if (i.isNotationElementVisible(8)) {
        let s = [];
        for (let a of this.renderer.tracks)
          for (let o of a.staves) {
            let l =
              !o.isPercussion &&
              o.isStringed &&
              o.tuning.length > 0 &&
              o.showTablature;
            if (
              (e.stylesheet.perTrackDisplayTuning &&
                e.stylesheet.perTrackDisplayTuning.has(a.index) &&
                e.stylesheet.perTrackDisplayTuning.get(a.index) === !1 &&
                (l = !1),
              l)
            ) {
              s.push(o);
              break;
            }
          }
        if (s.length > 0 && e.stylesheet.globalDisplayTuning) {
          (this.tuningGlyph = new gc(0, 0)), (this.tuningGlyph.renderer = r);
          for (let a of s)
            if (a.stringTuning.tunings.length > 0) {
              let o = s.length > 1 ? a.track.name : "",
                l = new yc(0, 0, a.stringTuning, o);
              (l.colorOverride = $.trackColor(n, 3, a.track)),
                (l.renderer = r),
                l.doLayout(),
                this.tuningGlyph.addGlyph(l);
            }
        } else this.tuningGlyph = null;
      }
      if (i.isNotationElementVisible(10)) {
        (this.chordDiagrams = new cc(0, 0)), (this.chordDiagrams.renderer = r);
        let s = new Set();
        for (let a of this.renderer.tracks)
          if (
            e.stylesheet.globalDisplayChordDiagramsOnTop &&
            (e.stylesheet.perTrackChordDiagramsOnTop == null ||
              !e.stylesheet.perTrackChordDiagramsOnTop.has(a.index) ||
              e.stylesheet.perTrackChordDiagramsOnTop.get(a.index))
          )
            for (let l of a.staves) {
              let u = l.chords;
              if (u)
                for (let [, c] of u)
                  s.has(c.uniqueId) ||
                    (c.showDiagram &&
                      (s.add(c.uniqueId), this.chordDiagrams.addChord(c)));
            }
        this.chordDiagrams.isEmpty && (this.chordDiagrams = null);
      } else this.chordDiagrams = null;
    }
    createEmptyStaffSystem() {
      let t = new bc(this);
      for (let e = 0; e < this.renderer.tracks.length; e++) {
        let r = this.renderer.tracks[e];
        for (let i = 0; i < r.staves.length; i++) {
          let n = r.staves[i],
            s = J.staveProfiles.get(
              this.renderer.settings.display.staveProfile
            );
          for (let a of s) a.canCreate(r, n) && t.addStaff(r, new dc(e, n, a));
        }
      }
      return t;
    }
    registerBarRenderer(t, e) {
      if (
        (this._barRendererLookup.has(t) ||
          this._barRendererLookup.set(t, new Map()),
        this._barRendererLookup.get(t).set(e.bar.id, e),
        e.additionalMultiRestBars)
      )
        for (let r of e.additionalMultiRestBars)
          this._barRendererLookup.get(t).set(r.id, e);
    }
    unregisterBarRenderer(t, e) {
      if (this._barRendererLookup.has(t)) {
        let r = this._barRendererLookup.get(t);
        if ((r.delete(e.bar.id), e.additionalMultiRestBars))
          for (let i of e.additionalMultiRestBars) r.delete(i.id);
      }
    }
    getRendererForBar(t, e) {
      let r = e.id;
      return this._barRendererLookup.has(t) &&
        this._barRendererLookup.get(t).has(r)
        ? this._barRendererLookup.get(t).get(r)
        : null;
    }
    layoutAndRenderBottomScoreInfo(t) {
      t = Math.round(t);
      let e = new $t();
      (e.x = 0), (e.y = t);
      let r = 0,
        i = this.renderer.settings.display.resources,
        n = [],
        s = 0;
      for (let [a, o] of ws.footerElements.value)
        if (this.footerGlyphs.has(a)) {
          let l = this.footerGlyphs.get(a);
          (l.y = r),
            this.alignScoreInfoGlyph(l),
            (r += l.height),
            n.push(l),
            (s = Math.max(s, Math.round(l.x + l.width)));
        }
      return (
        (r = Math.round(r)),
        n.length > 0 &&
          ((e.width = s),
          (e.height = r),
          (e.totalWidth = this.scaledWidth),
          (e.totalHeight = t + e.height),
          this.registerPartial(e, (a) => {
            (a.color = i.scoreInfoColor),
              (a.textAlign = 0),
              (a.textBaseline = 0);
            for (let o of n) o.paint(0, 0, a);
          })),
        t + r
      );
    }
    alignScoreInfoGlyph(t) {
      if (
        J.getLayoutEngineFactory(this.renderer.settings.display.layoutMode)
          .vertical
      )
        switch (t.textAlign) {
          case 0:
            t.x = this.pagePadding[0];
            break;
          case 1:
            t.x = this.scaledWidth / 2;
            break;
          case 2:
            t.x = this.scaledWidth - this.pagePadding[2];
            break;
        }
      else (t.x = this.firstBarX), (t.textAlign = 0);
    }
    layoutAndRenderAnnotation(t) {
      let e = "-Chris-",
        r = this.renderer.settings.display.resources,
        i = 12,
        n = ne.withFamilyList(r.copyrightFont.families, i, 0, 1),
        s = new ji(this.renderer, this.renderer.tracks[0].staves[0].bars[0]),
        a = new it(0, 0, e, n, 1, void 0, r.mainGlyphColor);
      (a.renderer = s), a.doLayout(), this.alignScoreInfoGlyph(a);
      let o = new $t();
      return (
        (o.width = a.x + a.width),
        (o.x = 0),
        (o.height = i),
        (o.y = t),
        (o.totalWidth = this.scaledWidth),
        (o.totalHeight = t + i),
        (o.firstMasterBarIndex = -1),
        (o.lastMasterBarIndex = -1),
        this.registerPartial(o, (l) => {
          (l.color = r.mainGlyphColor),
            (l.font = n),
            (l.textAlign = 0),
            (l.textBaseline = 0),
            a.paint(0, 0, l);
        }),
        t + i
      );
    }
  };
  (ws.headerElements = new Cr(
    () =>
      new Map([
        [0, 0],
        [1, 1],
        [2, 2],
        [3, 3],
        [4, 4],
        [5, 5],
        [6, 6],
        [7, void 0],
      ])
  )),
    (ws.footerElements = new Cr(
      () =>
        new Map([
          [8, 7],
          [9, void 0],
        ])
    ));
  var Ns = ws;
  var vt = class extends rt {
    constructor() {
      super(0, 0);
      this._effectGlyphs = [];
      this._normalGlyphs = [];
      this.computedWidth = 0;
    }
    doLayout() {
      let e = 0;
      if (this.glyphs)
        for (let r = 0, i = this.glyphs.length; r < i; r++) {
          let n = this.glyphs[r];
          (n.x = e), (n.renderer = this.renderer), n.doLayout(), (e += n.width);
        }
      (this.width = e), (this.computedWidth = e);
    }
    noteLoop(e) {
      for (let r = this.container.beat.notes.length - 1; r >= 0; r--)
        e(this.container.beat.notes[r]);
    }
    addEffect(e) {
      super.addGlyph(e), this._effectGlyphs.push(e);
    }
    addNormal(e) {
      super.addGlyph(e), this._normalGlyphs.push(e);
    }
    get effectElement() {}
    paint(e, r, i) {
      this._paintEffects(e, r, i), this._paintNormal(e, r, i);
    }
    _paintNormal(e, r, i) {
      for (let n of this._normalGlyphs) n.paint(e + this.x, r + this.y, i);
    }
    _paintEffects(e, r, i) {
      var s = [];
      try {
        let n = j(
          s,
          this.effectElement
            ? $.beat(i, this.effectElement, this.container.beat)
            : void 0
        );
        for (let u of this._effectGlyphs) u.paint(e + this.x, r + this.y, i);
      } catch (a) {
        var o = a,
          l = !0;
      } finally {
        ee(s, o, l);
      }
    }
  };
  var _t = class extends vt {
    constructor() {
      super(...arguments);
      this.centerX = 0;
    }
    updateBeamingHelper() {}
    buildBoundingsLookup(e, r, i) {}
    getNoteX(e, r) {
      return 0;
    }
    getNoteY(e, r) {
      return 0;
    }
    getHighestNoteY() {
      return 0;
    }
    getLowestNoteY() {
      return 0;
    }
  };
  var Es = class p extends ue {
    constructor(e, r, i, n, s = 1) {
      super(e, r);
      this._scale = 0;
      this._symbols = [];
      (this._symbols = p.getSymbols(i)),
        (this._scale = s),
        (this._baseline = n);
    }
    static getSymbols(e) {
      let r = [];
      for (; e > 0; ) {
        let i = e % 10;
        r.unshift(p.getSymbol(i)), (e = (e / 10) | 0);
      }
      return r;
    }
    static getSymbol(e) {
      switch (e) {
        case 0:
          return 57472;
        case 1:
          return 57473;
        case 2:
          return 57474;
        case 3:
          return 57475;
        case 4:
          return 57476;
        case 5:
          return 57477;
        case 6:
          return 57478;
        case 7:
          return 57479;
        case 8:
          return 57480;
        case 9:
          return 57481;
        default:
          return -1;
      }
    }
    doLayout() {
      let e = 0;
      for (let r of this._symbols)
        e += this.renderer.smuflMetrics.glyphWidths.get(r);
      this.width = e;
    }
    paint(e, r, i) {
      switch (this._baseline) {
        case 0:
          r += this.renderer.smuflMetrics.glyphBottom.get(this._symbols[0]);
          break;
        case 2:
          r += this.renderer.smuflMetrics.glyphTop.get(this._symbols[0]);
          break;
      }
      i.fillMusicFontSymbols(
        e + this.x,
        r + this.y,
        this._scale,
        this._symbols
      );
    }
  };
  var wl = class wl extends ue {
    constructor() {
      super(0, 0);
      this._numberGlyph = [];
    }
    doLayout() {
      (this.width = wl._restSymbols.reduce(
        (r, i) => r + this.renderer.smuflMetrics.glyphWidths.get(i),
        0
      )),
        this.renderer.registerOverflowTop(this.renderer.getLineHeight(1));
      let e = this.renderer.additionalMultiRestBars.length + 1;
      this._numberGlyph = Es.getSymbols(e);
    }
    paint(e, r, i) {
      i.fillMusicFontSymbols(
        e + this.x,
        r + this.y + this.renderer.height / 2,
        1,
        wl._restSymbols
      );
      let n = this.renderer.getLineY(-1.5);
      i.fillMusicFontSymbols(
        e + this.x + this.width / 2,
        (r + this.y + n) | 0,
        1,
        this._numberGlyph,
        !0
      );
    }
  };
  wl._restSymbols = [58607, 58608, 58608, 58608, 58609];
  var Sc = wl;
  var za = class p extends ft {
    constructor(t) {
      super(p._getOrCreatePlaceholderBeat(t), t),
        (this.preNotes = new vt()),
        (this.onNotes = new _t());
    }
    doLayout() {
      this.renderer.showMultiBarRest && this.onNotes.addNormal(new Sc()),
        super.doLayout();
    }
    static _getOrCreatePlaceholderBeat(t) {
      if (t.voice.beats.length > 1) return t.voice.beats[0];
      let e = new Me();
      return (e.voice = t.voice), e;
    }
  };
  var ji = class {
    constructor(t, e) {
      this._preBeatGlyphs = new ii();
      this._voiceContainers = new Map();
      this._postBeatGlyphs = new ii();
      this._ties = [];
      this.additionalMultiRestBars = null;
      this.x = 0;
      this.y = 0;
      this.width = 0;
      this.computedWidth = 0;
      this.height = 0;
      this.index = 0;
      this.topOverflow = 0;
      this.bottomOverflow = 0;
      this.isLinkedToPrevious = !1;
      this.canWrap = !0;
      this.wasFirstOfLine = !1;
      this._appliedLayoutingInfo = 0;
      this.isFinalized = !1;
      this.topPadding = 0;
      this.bottomPadding = 0;
      (this.scoreRenderer = t),
        (this.bar = e),
        e && (this.helpers = new uc(this));
    }
    get nextRenderer() {
      return !this.bar || !this.bar.nextBar
        ? null
        : this.scoreRenderer.layout.getRendererForBar(
            this.staff.staffId,
            this.bar.nextBar
          );
    }
    get previousRenderer() {
      return !this.bar || !this.bar.previousBar
        ? null
        : this.scoreRenderer.layout.getRendererForBar(
            this.staff.staffId,
            this.bar.previousBar
          );
    }
    get lastBar() {
      return this.additionalMultiRestBars
        ? this.additionalMultiRestBars[this.additionalMultiRestBars.length - 1]
        : this.bar;
    }
    get showMultiBarRest() {
      return !1;
    }
    registerTies(t) {
      this._ties.push(...t);
    }
    get middleYPosition() {
      return 0;
    }
    registerOverflowTop(t) {
      return (
        (t = Math.ceil(t)),
        t > this.topOverflow ? ((this.topOverflow = t), !0) : !1
      );
    }
    registerOverflowBottom(t) {
      return (
        (t = Math.ceil(t)),
        t > this.bottomOverflow ? ((this.bottomOverflow = t), !0) : !1
      );
    }
    scaleToWidth(t) {
      let e = t - this._preBeatGlyphs.width - this._postBeatGlyphs.width;
      for (let r of this._voiceContainers.values()) r.scaleToWidth(e);
      (this._postBeatGlyphs.x =
        this._preBeatGlyphs.x + this._preBeatGlyphs.width + e),
        (this.width = t);
    }
    get resources() {
      return this.settings.display.resources;
    }
    get smuflMetrics() {
      return this.resources.engravingSettings;
    }
    get settings() {
      return this.scoreRenderer.settings;
    }
    get barDisplayScale() {
      return this.staff.system.staves.length > 1
        ? this.bar.masterBar.displayScale
        : this.bar.displayScale;
    }
    get barDisplayWidth() {
      return this.staff.system.staves.length > 1
        ? this.bar.masterBar.displayWidth
        : this.bar.displayWidth;
    }
    get isFirstOfLine() {
      return this.index === 0;
    }
    get isLast() {
      return (
        !this.bar || this.bar.index === this.scoreRenderer.layout.lastBarIndex
      );
    }
    registerLayoutingInfo() {
      let t = this.layoutingInfo,
        e = this._preBeatGlyphs.width;
      t.preBeatSize < e && (t.preBeatSize = e);
      let r = 0;
      for (let n of this._voiceContainers.values()) {
        n.registerLayoutingInfo(t);
        let s = n.x + n.width;
        r < s && (r = s);
      }
      let i = this._postBeatGlyphs.width;
      t.postBeatSize < i && (t.postBeatSize = i);
    }
    applyLayoutingInfo() {
      if (this._appliedLayoutingInfo >= this.layoutingInfo.version) return !1;
      (this._appliedLayoutingInfo = this.layoutingInfo.version),
        (this._preBeatGlyphs.width = this.layoutingInfo.preBeatSize);
      let t = this._preBeatGlyphs.x + this._preBeatGlyphs.width;
      for (let r of this._voiceContainers.values()) {
        (r.x = this._preBeatGlyphs.x + this._preBeatGlyphs.width),
          r.applyLayoutingInfo(this.layoutingInfo);
        let i = r.x + r.width;
        t < i && (t = i);
      }
      (this._postBeatGlyphs.x = Math.floor(t)),
        (this._postBeatGlyphs.width = this.layoutingInfo.postBeatSize),
        (this.width = Math.ceil(
          this._postBeatGlyphs.x + this._postBeatGlyphs.width
        )),
        (this.computedWidth = this.width);
      let e = this.barDisplayWidth;
      return (
        e > 0 &&
          this.scoreRenderer.layout.systemsLayoutMode === 2 &&
          ((this.width = e), (this.computedWidth = e)),
        !0
      );
    }
    finalizeRenderer() {
      this.isFinalized = !0;
      let t = !1,
        e = this.y - this.staff.topSpacing,
        r = this.y + this.height + this.staff.bottomSpacing;
      for (let i of this._ties)
        if ((i.doLayout(), i.height > 0)) {
          let n = i.y + i.height - r;
          n > 0 && this.registerOverflowBottom(n) && (t = !0);
          let s = i.y - e;
          s < 0 && this.registerOverflowTop(s * -1) && (t = !0);
        }
      return t;
    }
    doLayout() {
      if (!this.bar) return;
      this.helpers.initialize(),
        (this._ties = []),
        (this._preBeatGlyphs = new ii()),
        (this._preBeatGlyphs.renderer = this),
        this._voiceContainers.clear(),
        (this._postBeatGlyphs = new ii()),
        (this._postBeatGlyphs.renderer = this);
      for (let i = 0; i < this.bar.voices.length; i++) {
        let n = this.bar.voices[i];
        if (this.hasVoiceContainer(n)) {
          let s = new vl(0, 0, n);
          (s.renderer = this),
            this._voiceContainers.set(this.bar.voices[i].index, s);
        }
      }
      if (
        (this.bar.simileMark === 3 && (this.canWrap = !1),
        this.createPreBeatGlyphs(),
        this.additionalMultiRestBars)
      ) {
        let i = new za(this.getVoiceContainer(this.bar.voices[0]));
        this.addBeatGlyph(i);
      } else this.createBeatGlyphs();
      this.createPostBeatGlyphs(), this.updateSizes();
      for (let i of this.helpers.beamHelpers) for (let n of i) n.finish();
      this.computedWidth = this.width;
      let t = this.height,
        e = this._preBeatGlyphs.glyphs;
      if (e)
        for (let i of e) {
          let n = i.getBoundingBoxTop();
          n < 0 && this.registerOverflowTop(n * -1);
          let s = n + i.height;
          s > t && this.registerOverflowBottom(s - t);
        }
      let r = this._postBeatGlyphs.glyphs;
      if (r)
        for (let i of r) {
          let n = i.getBoundingBoxTop();
          n < 0 && this.registerOverflowTop(n * -1);
          let s = n + i.height;
          s > t && this.registerOverflowBottom(s - t);
        }
    }
    hasVoiceContainer(t) {
      return this.additionalMultiRestBars || t.index === 0 ? !0 : !t.isEmpty;
    }
    updateSizes() {
      this.staff.registerStaffTop(this.topPadding),
        this.staff.registerStaffBottom(this.height - this.bottomPadding);
      let t = this._voiceContainers,
        e = this.beatGlyphsStart,
        r = e;
      for (let i of t.values()) {
        (i.x = e), i.doLayout();
        let n = i.x + i.width;
        r < n && (r = n);
      }
      (this._postBeatGlyphs.x = Math.floor(r)),
        (this.width = Math.ceil(
          this._postBeatGlyphs.x + this._postBeatGlyphs.width
        )),
        (this.height += this.layoutingInfo.height),
        (this.height = Math.ceil(this.height));
    }
    addPreBeatGlyph(t) {
      (t.renderer = this), this._preBeatGlyphs.addGlyph(t);
    }
    addBeatGlyph(t) {
      (t.renderer = this),
        (t.preNotes.renderer = this),
        (t.onNotes.renderer = this),
        (t.onNotes.beamingHelper = this.helpers.beamHelperLookup[
          t.beat.voice.index
        ].get(t.beat.index)),
        this.getVoiceContainer(t.beat.voice).addGlyph(t);
    }
    getVoiceContainer(t) {
      return this._voiceContainers.has(t.index)
        ? this._voiceContainers.get(t.index)
        : void 0;
    }
    getBeatContainer(t) {
      return this.getVoiceContainer(t.voice)?.beatGlyphs?.[t.index];
    }
    getPreNotesGlyphForBeat(t) {
      return this.getBeatContainer(t)?.preNotes;
    }
    getOnNotesGlyphForBeat(t) {
      return this.getBeatContainer(t)?.onNotes;
    }
    paint(t, e, r) {
      this.paintBackground(t, e, r),
        (r.color = this.resources.mainGlyphColor),
        this._preBeatGlyphs.paint(t + this.x, e + this.y, r);
      for (let i of this._voiceContainers.values())
        i.paint(t + this.x, e + this.y, r);
      (r.color = this.resources.mainGlyphColor),
        this._postBeatGlyphs.paint(t + this.x, e + this.y, r);
    }
    paintBackground(t, e, r) {
      this.layoutingInfo.paint(
        t + this.x + this._preBeatGlyphs.x + this._preBeatGlyphs.width,
        e + this.y + this.height,
        r
      );
    }
    buildBoundingsLookup(t, e, r) {
      let i = new bn();
      (i.bar = this.bar),
        (i.visualBounds = new we()),
        (i.visualBounds.x = e + this.x),
        (i.visualBounds.y = r + this.y + this.topPadding),
        (i.visualBounds.w = this.width),
        (i.visualBounds.h = this.height - this.topPadding - this.bottomPadding),
        (i.realBounds = new we()),
        (i.realBounds.x = e + this.x),
        (i.realBounds.y = r + this.y),
        (i.realBounds.w = this.width),
        (i.realBounds.h = this.height),
        t.addBar(i);
      for (let [n, s] of this._voiceContainers) {
        let a = this.bar.isEmpty && n === 0;
        if (!s.voice.isEmpty || a)
          for (let o = 0, l = s.beatGlyphs.length; o < l; o++)
            s.beatGlyphs[o].buildBoundingsLookup(
              i,
              e + this.x + s.x,
              r + this.y + s.y,
              a
            );
      }
    }
    addPostBeatGlyph(t) {
      this._postBeatGlyphs.addGlyph(t);
    }
    createPreBeatGlyphs() {
      this.wasFirstOfLine = this.isFirstOfLine;
    }
    createBeatGlyphs() {
      for (let t of this.bar.voices)
        this.hasVoiceContainer(t) && this.createVoiceGlyphs(t);
    }
    createVoiceGlyphs(t) {}
    createPostBeatGlyphs() {}
    get beatGlyphsStart() {
      return this._preBeatGlyphs.x + this._preBeatGlyphs.width;
    }
    get postBeatGlyphsStart() {
      return this._postBeatGlyphs.x;
    }
    getBeatX(t, e = 0) {
      let r = this.getBeatContainer(t);
      if (r)
        switch (e) {
          case 0:
            return r.voiceContainer.x + r.x;
          case 1:
            return r.voiceContainer.x + r.x + r.onNotes.x;
          case 2:
            return r.voiceContainer.x + r.x + r.onTimeX;
          case 3:
            let i = r.onNotes.beamingHelper
              ? r.onNotes.beamingHelper.getBeatLineX(t)
              : r.onNotes.x + r.onNotes.width / 2;
            return r.voiceContainer.x + i;
          case 4:
            return r.voiceContainer.x + r.x + r.onNotes.x + r.onNotes.width;
          case 5:
            return r.voiceContainer.x + r.x + r.width;
        }
      return 0;
    }
    getRatioPositionX(t) {
      let e = this.bar.isEmpty
          ? this.beatGlyphsStart
          : this.getBeatX(this.bar.voices[0].beats[0], 1),
        r = e,
        i = this.postBeatGlyphsStart - e;
      return r + i * t;
    }
    getNoteX(t, e) {
      let r = this.getBeatContainer(t.beat);
      return r
        ? r.voiceContainer.x + r.x + r.onNotes.x + r.onNotes.getNoteX(t, e)
        : 0;
    }
    getNoteY(t, e) {
      let r = this.getOnNotesGlyphForBeat(t.beat);
      return r ? r.getNoteY(t, e) : Number.NaN;
    }
    reLayout() {
      ((this.wasFirstOfLine && !this.isFirstOfLine) ||
        (!this.wasFirstOfLine && this.isFirstOfLine)) &&
        this.recreatePreBeatGlyphs(),
        this.updateSizes(),
        this.registerLayoutingInfo();
    }
    recreatePreBeatGlyphs() {
      (this._preBeatGlyphs = new ii()),
        (this._preBeatGlyphs.renderer = this),
        this.createPreBeatGlyphs();
    }
    paintSimileMark(t, e, r) {
      var n = [];
      try {
        let i = j(n, $.voice(r, 0, this.bar.voices[0], !0));
        switch (this.bar.simileMark) {
          case 1:
            r.beginGroup(ft.getGroupId(this.bar.voices[0].beats[0])),
              ge.fillMusicFontSymbolSafe(
                r,
                t + this.x + this.width / 2,
                e + this.y + this.height / 2,
                1,
                58624,
                !0
              ),
              r.endGroup();
            break;
          case 3:
            r.beginGroup(ft.getGroupId(this.bar.voices[0].beats[0])),
              r.beginGroup(
                ft.getGroupId(this.bar.previousBar.voices[0].beats[0])
              ),
              ge.fillMusicFontSymbolSafe(
                r,
                t + this.x,
                e + this.y + this.height / 2,
                1,
                58625,
                !0
              ),
              r.endGroup(),
              r.endGroup();
            break;
        }
      } catch (s) {
        var a = s,
          o = !0;
      } finally {
        ee(n, a, o);
      }
    }
    completeBeamingHelper(t) {}
    getBeatDirection(t) {
      return this.helpers.getBeamingHelperForBeat(t).direction;
    }
  };
  var Bc = class extends ue {
    constructor(e, r) {
      super(0, 0);
      this._uniqueEffectGlyphs = [];
      this._effectGlyphs = [];
      this.isEmpty = !0;
      this.previousBand = null;
      this.isLinkedToPrevious = !1;
      this.firstBeat = null;
      this.lastBeat = null;
      this.height = 0;
      this.originalHeight = 0;
      this.slot = null;
      (this.voice = e), (this.info = r);
    }
    doLayout() {
      super.doLayout();
      for (let e = 0; e < this.renderer.bar.voices.length; e++)
        this._effectGlyphs.push(new Map()), this._uniqueEffectGlyphs.push([]);
    }
    createGlyph(e) {
      if (
        e.voice === this.voice &&
        this.info.shouldCreateGlyph(this.renderer.settings, e) &&
        (!this.info.hideOnMultiTrack || this.renderer.staff.trackIndex === 0)
      ) {
        if (
          ((this.isEmpty = !1),
          (!this.firstBeat || e.isBefore(this.firstBeat)) &&
            (this.firstBeat = e),
          !this.lastBeat || e.isAfter(this.lastBeat))
        )
          switch (((this.lastBeat = e), this.info.sizingMode)) {
            case 2:
            case 4:
              this.lastBeat.nextBeat &&
                (this.lastBeat = this.lastBeat.nextBeat);
              break;
          }
        let r = this._createOrResizeGlyph(this.info.sizingMode, e);
        r.height > this.height &&
          ((this.height = r.height), (this.originalHeight = r.height));
      }
    }
    resetHeight() {
      this.height = this.originalHeight;
    }
    _createOrResizeGlyph(e, r) {
      let i;
      switch (e) {
        case 5:
          return (
            (i = this.info.createNewGlyph(this.renderer, r)),
            (i.renderer = this.renderer),
            (i.beat = r),
            i.doLayout(),
            this._effectGlyphs[r.voice.index].set(r.index, i),
            this._uniqueEffectGlyphs[r.voice.index].push(i),
            i
          );
        case 0:
        case 1:
        case 2:
          return (
            (i = this.info.createNewGlyph(this.renderer, r)),
            (i.renderer = this.renderer),
            (i.beat = r),
            i.doLayout(),
            this._effectGlyphs[r.voice.index].set(r.index, i),
            this._uniqueEffectGlyphs[r.voice.index].push(i),
            i
          );
        case 3:
        case 4:
          let n = e === 3 ? 1 : 2;
          if (r.index > 0 || this.renderer.index > 0) {
            let s = r.previousBeat;
            if (this.info.shouldCreateGlyph(this.renderer.settings, s)) {
              let a = null;
              if (r.index > 0 && this._effectGlyphs[r.voice.index].has(s.index))
                a = this._effectGlyphs[r.voice.index].get(s.index);
              else if (this.renderer.index > 0) {
                let u = this.renderer.previousRenderer.getBand(
                  s.voice,
                  this.info.effectId
                );
                if (u) {
                  let c = u._effectGlyphs[s.voice.index];
                  c.has(s.index) && (a = c.get(s.index));
                }
              }
              let o = this._createOrResizeGlyph(n, r);
              return (
                a &&
                  this.info.canExpand(s, r) &&
                  ((a.nextGlyph = o),
                  (o.previousGlyph = a),
                  (this.isLinkedToPrevious = !0)),
                o
              );
            }
            return this._createOrResizeGlyph(n, r);
          }
          return this._createOrResizeGlyph(n, r);
        default:
          return this._createOrResizeGlyph(1, r);
      }
    }
    paint(e, r, i) {
      super.paint(e, r, i);
      for (let l = 0, u = this._uniqueEffectGlyphs.length; l < u; l++) {
        let c = this._uniqueEffectGlyphs[l];
        for (let d = 0, h = c.length; d < h; d++) {
          var n = [];
          try {
            let f = c[d];
            let b = j(n, $.beat(i, 0, f.beat, !1));
            f.paint(e + this.x, r + this.y, i);
          } catch (s) {
            var a = s,
              o = !0;
          } finally {
            ee(n, a, o);
          }
        }
      }
    }
    alignGlyphs() {
      for (let e = 0; e < this._effectGlyphs.length; e++)
        for (let r of this._effectGlyphs[e].keys())
          this._alignGlyph(
            this.info.sizingMode,
            this.renderer.bar.voices[e].beats[r]
          );
    }
    _alignGlyph(e, r) {
      let i = this._effectGlyphs[r.voice.index].get(r.index),
        n = this.renderer.getBeatContainer(r);
      switch (e) {
        case 0:
          let s = this.renderer.layoutingInfo.getPreBeatSize(r);
          i.x = this.renderer.beatGlyphsStart + n.x - s;
          break;
        case 1:
        case 3:
          i.x = this.renderer.beatGlyphsStart + n.x;
          break;
        case 2:
        case 4:
          if (
            ((i.x = this.renderer.beatGlyphsStart + n.x), n.beat.isLastOfVoice)
          )
            i.width = this.renderer.width - i.x;
          else {
            let a = this.renderer.layoutingInfo.getPostBeatSize(r);
            i.width = a;
          }
          break;
        case 5:
          i.width = this.renderer.width;
          break;
      }
    }
  };
  var mh = class {
      constructor() {
        this.uniqueEffectId = null;
        this.y = 0;
        this.height = 0;
        this.firstBeat = null;
        this.lastBeat = null;
      }
    },
    Tc = class {
      constructor() {
        (this.bands = []), (this.shared = new mh());
      }
      update(t) {
        t.info.canShareBand || (this.shared.uniqueEffectId = t.info.effectId),
          (t.slot = this),
          this.bands.push(t),
          t.height > this.shared.height && (this.shared.height = t.height),
          (!this.shared.firstBeat ||
            t.firstBeat.isBefore(this.shared.firstBeat)) &&
            (this.shared.firstBeat = t.firstBeat),
          (!this.shared.lastBeat || t.lastBeat.isAfter(this.shared.lastBeat)) &&
            (this.shared.lastBeat = t.lastBeat);
      }
      canBeUsed(t) {
        return (
          ((!this.shared.uniqueEffectId && t.info.canShareBand) ||
            t.info.effectId === this.shared.uniqueEffectId) &&
          (!this.shared.firstBeat ||
            this.shared.lastBeat.isBefore(t.firstBeat) ||
            this.shared.lastBeat.isBefore(this.shared.firstBeat))
        );
      }
    };
  var kc = class {
    constructor() {
      (this.slots = []), (this._effectSlot = new Map());
    }
    getOrCreateSlot(t) {
      if (this._effectSlot.has(t.info.effectId)) {
        let r = this._effectSlot.get(t.info.effectId);
        if (r.canBeUsed(t)) return r;
      }
      for (let r of this.slots) if (r.canBeUsed(t)) return r;
      let e = new Tc();
      return this.slots.push(e), e;
    }
    register(t) {
      let e = this.getOrCreateSlot(t);
      e.update(t), this._effectSlot.set(t.info.effectId, e);
    }
  };
  var vc = class extends ji {
    constructor(e, r, i) {
      super(e, r);
      this._bands = [];
      this._bandLookup = new Map();
      this.sizingInfo = null;
      this._infos = i;
    }
    updateSizes() {
      (this.topOverflow = 0),
        (this.bottomOverflow = 0),
        (this.topPadding = 0),
        (this.bottomPadding = 0),
        this._updateHeight(),
        super.updateSizes();
    }
    finalizeRenderer() {
      let e = super.finalizeRenderer();
      return this._updateHeight() && (e = !0), e;
    }
    _updateHeight() {
      if (!this.sizingInfo) return !1;
      let e = 0;
      for (let r of this.sizingInfo.slots) {
        r.shared.y = e;
        for (let i of r.bands) (i.y = e), (i.height = r.shared.height);
        e += r.shared.height + this.settings.display.effectBandPaddingBottom;
      }
      return (
        (e = Math.ceil(e)), e !== this.height ? ((this.height = e), !0) : !1
      );
    }
    applyLayoutingInfo() {
      let e = !super.applyLayoutingInfo();
      if (this.index > 0) {
        let r = this.previousRenderer;
        this.sizingInfo = r.sizingInfo;
      } else this.sizingInfo = new kc();
      for (let r of this._bands)
        r.resetHeight(),
          r.alignGlyphs(),
          r.isEmpty || this.sizingInfo.register(r);
      return this._updateHeight(), e;
    }
    scaleToWidth(e) {
      super.scaleToWidth(e);
      for (let r of this._bands) r.alignGlyphs();
    }
    createBeatGlyphs() {
      (this._bands = []), (this._bandLookup = new Map());
      for (let e of this.bar.voices)
        if (this.hasVoiceContainer(e))
          for (let r of this._infos) {
            let i = new Bc(e, r);
            (i.renderer = this),
              i.doLayout(),
              this._bands.push(i),
              this._bandLookup.set(`${e.index}.${r.effectId}`, i);
          }
      super.createBeatGlyphs();
      for (let e of this._bands)
        e.isLinkedToPrevious && (this.isLinkedToPrevious = !0);
    }
    createVoiceGlyphs(e) {
      for (let r of e.beats) {
        let i = new ft(r, this.getVoiceContainer(e));
        (i.preNotes = new vt()), (i.onNotes = new _t()), this.addBeatGlyph(i);
        for (let n of this._bands) n.createGlyph(r);
      }
    }
    paint(e, r, i) {
      this.paintBackground(e, r, i);
      for (let n of this._bands)
        (i.color =
          n.voice.index === 0
            ? this.resources.mainGlyphColor
            : this.resources.secondaryGlyphColor),
          n.isEmpty || n.paint(e + this.x, r + this.y, i);
    }
    getBand(e, r) {
      let i = `${e.index}.${r}`;
      return this._bandLookup.has(i) ? this._bandLookup.get(i) : null;
    }
  };
  var Di = class extends ri {
    get staffId() {
      return this._staffId;
    }
    getStaffPaddingTop(t) {
      return t.system.layout.renderer.settings.display.effectStaffPaddingTop;
    }
    getStaffPaddingBottom(t) {
      return t.system.layout.renderer.settings.display.effectStaffPaddingBottom;
    }
    constructor(t, e, r = null) {
      super(),
        (this.infos = e),
        (this._staffId = t),
        (this.isInsideBracket = !1),
        (this.isRelevantForBoundsLookup = !1),
        (this.shouldShow = r);
    }
    canCreate(t, e) {
      let r = this.shouldShow;
      return super.canCreate(t, e) && (!r || r(t, e));
    }
    create(t, e) {
      return new vc(
        t,
        e,
        this.infos.filter((r) =>
          t.settings.notation.isNotationElementVisible(r.notationElement)
        )
      );
    }
  };
  var _c = class extends Ve {
    constructor(e, r, i, n, s, a) {
      super(e, r);
      this._endingsString = "";
      (this._endings = A.getAlternateEndingsList(i)),
        (this._openLine = n),
        (this._closeLine = s),
        (this._indent = a);
    }
    doLayout() {
      super.doLayout(),
        (this.height =
          this.renderer.resources.wordsFont.size +
          this.renderer.smuflMetrics.alternateEndingsPadding * 2);
      let e = "";
      for (let r = 0, i = this._endings.length; r < i; r++)
        (e += this._endings[r] + 1), (e += ". ");
      this._endingsString = e;
    }
    paint(e, r, i) {
      let n = this._closeLine ? this.width - i.lineWidth : this.width;
      if (
        (this.renderer.bar.getActualBarLineRight() === 6 &&
          (n -=
            this.renderer.smuflMetrics.thickBarlineThickness +
            this.renderer.smuflMetrics.barlineSeparation),
        (e = (e | 0) + i.lineWidth / 2),
        (r = (r | 0) + i.lineWidth / 2),
        this._indent &&
          ((e += this.renderer.smuflMetrics.alternateEndingsPadding),
          (n -= this.renderer.smuflMetrics.alternateEndingsPadding)),
        this._openLine
          ? (i.moveTo(e + this.x, r + this.y + this.height),
            i.lineTo(e + this.x, r + this.y))
          : i.moveTo(e + this.x, r + this.y),
        i.lineTo(e + this.x + n, r + this.y),
        this._closeLine && i.lineTo(e + this.x + n, r + this.y + this.height),
        i.stroke(),
        this._openLine)
      ) {
        let a = i.textBaseline;
        i.textBaseline = 0;
        let o = this.renderer.resources;
        (i.font = o.wordsFont),
          i.fillText(
            this._endingsString,
            e + this.x + this.renderer.smuflMetrics.alternateEndingsPadding,
            r + this.y + this.renderer.smuflMetrics.alternateEndingsPadding
          ),
          (i.textBaseline = a);
      }
    }
  };
  var oe = class {
    get effectId() {
      return this.notationElement.toString();
    }
  };
  var xc = class extends oe {
    get notationElement() {
      return 14;
    }
    get hideOnMultiTrack() {
      return !0;
    }
    get canShareBand() {
      return !1;
    }
    get sizingMode() {
      return 5;
    }
    shouldCreateGlyph(t, e) {
      return (
        e.voice.index === 0 &&
        e.index === 0 &&
        e.voice.bar.masterBar.alternateEndings !== 0
      );
    }
    createNewGlyph(t, e) {
      let r = e.voice.bar.masterBar,
        i =
          r.previousMasterBar === null ||
          r.alternateEndings !== r.previousMasterBar.alternateEndings,
        n =
          r.isRepeatEnd ||
          r.nextMasterBar === null ||
          r.alternateEndings !== r.nextMasterBar.alternateEndings;
      r.repeatGroup.closings.some((a) => a.index >= r.index) || (n = !1);
      let s =
        r.previousMasterBar !== null &&
        r.alternateEndings !== r.previousMasterBar.alternateEndings &&
        r.previousMasterBar.alternateEndings > 0;
      return new _c(0, 0, r.alternateEndings, i, n, s);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var si = class extends Ve {
    constructor(e) {
      super();
      this.forceGroupedRendering = !1;
      this.endOnBarLine = !1;
      this.endPosition = e;
    }
    get isLinkedWithPrevious() {
      return (
        !!this.previousGlyph &&
        this.previousGlyph.renderer.staff.system === this.renderer.staff.system
      );
    }
    get isLinkedWithNext() {
      return (
        !!this.nextGlyph &&
        this.nextGlyph.renderer.isFinalized &&
        this.nextGlyph.renderer.staff.system === this.renderer.staff.system
      );
    }
    paint(e, r, i) {
      if (this.isLinkedWithPrevious) return;
      if (!this.isLinkedWithNext && !this.forceGroupedRendering) {
        this.paintNonGrouped(e, r, i);
        return;
      }
      let n;
      if (!this.isLinkedWithNext && this.forceGroupedRendering) n = this;
      else for (n = this.nextGlyph; n.isLinkedWithNext; ) n = n.nextGlyph;
      let s = n.renderer,
        a = n.beat,
        o = this.endPosition,
        l = e - this.renderer.x,
        u = this.calculateEndX(s, a, l, o);
      this.paintGrouped(e, r, u, i);
    }
    calculateEndX(e, r, i, n) {
      return r ? i + e.x + e.getBeatX(r, n) : i + e.x + this.x + this.width;
    }
    paintNonGrouped(e, r, i) {
      let n = e - this.renderer.x,
        s = this.calculateEndX(this.renderer, this.beat, n, this.endPosition);
      this.paintGrouped(e, r, s, i);
    }
  };
  var ir = class extends si {
    constructor(e, r = !0) {
      super(1);
      this._labelWidth = 0;
      (this._label = e), (this._dashed = r);
    }
    doLayout() {
      this.renderer.settings.notation.extendLineEffectsToBeatEnd &&
        ((this.endPosition = 5), (this.forceGroupedRendering = !0)),
        super.doLayout(),
        (this.renderer.scoreRenderer.canvas.font =
          this.renderer.resources.effectFont);
      let e = this.renderer.scoreRenderer.canvas.measureText(this._label);
      (this.height = e.height), (this._labelWidth = e.width);
    }
    paintNonGrouped(e, r, i) {
      let n = this.renderer.resources;
      i.font = n.effectFont;
      let s = i.textBaseline;
      (i.textBaseline = 1),
        i.fillText(
          this._label,
          e + this.x - this._labelWidth / 2,
          r + this.y + this.height / 2
        ),
        (i.textBaseline = s);
    }
    paintGrouped(e, r, i, n) {
      this.paintNonGrouped(e, r, n);
      let s = this.renderer.smuflMetrics.lineRangedGlyphDashGap,
        a = this.renderer.smuflMetrics.lineRangedGlyphDashSize,
        o = this.renderer.smuflMetrics.pedalLineThickness,
        l = e + this.x + this._labelWidth / 2 + s / 2,
        u = r + this.y + this.height / 2 - o / 2;
      if (this._dashed) {
        if (i > l) {
          let c = l;
          for (; c < i; ) {
            let d = Math.min(c + a, i);
            n.fillRect(c, u, d - c, o), (c += a + s);
          }
          n.fillRect(i, u - a / 2 + o / 2, o, a);
        }
      } else n.fillRect(l, u, i - l, o), n.fillRect(i - o, u, o, a / 2);
    }
  };
  var Nl = class Nl extends oe {
    get notationElement() {
      return 23;
    }
    get canShareBand() {
      return !1;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    shouldCreateGlyph(t, e) {
      return e.isBarre;
    }
    get sizingMode() {
      return 3;
    }
    createNewGlyph(t, e) {
      let r = "";
      switch (e.barreShape) {
        case 0:
        case 1:
          break;
        case 2:
          r += "1/2";
          break;
      }
      return (r += `B ${Nl.toRoman(e.barreFret)}`), new ir(r, !1);
    }
    static toRoman(t) {
      let e = "";
      if (t > 0)
        for (let [r, i] of Nl._romanLetters) {
          let n = Math.floor(t / i);
          (t -= n * i), (e += r.repeat(n));
        }
      return e;
    }
    canExpand(t, e) {
      return t.barreFret === e.barreFret && t.barreShape === e.barreShape;
    }
  };
  Nl._romanLetters = new Map([
    ["L", 50],
    ["XL", 40],
    ["X", 10],
    ["IX", 9],
    ["V", 5],
    ["IV", 4],
    ["I", 1],
  ]);
  var wc = Nl;
  var Nc = class extends Ve {
    constructor(e) {
      super(0, 0);
      this._text = "";
      this._textWidth = 0;
      this._textHeight = 0;
      this._timer = e;
    }
    doLayout() {
      let e = (this._timer / 6e4) | 0,
        r = ((this._timer - e * 6e4) / 1e3) | 0;
      this._text = `${e}:${r.toString().padStart(2, "0")}`;
      let i = this.renderer.scoreRenderer.canvas;
      i.font = this.renderer.resources.timerFont;
      let n = i.measureText(this._text);
      (this._textHeight =
        i.font.size + this.renderer.smuflMetrics.beatTimerPadding * 2),
        (this._textWidth =
          n.width + this.renderer.smuflMetrics.beatTimerPadding * 2),
        (this.height =
          this._textHeight + this.renderer.smuflMetrics.beatTimerPadding * 2);
    }
    paint(e, r, i) {
      let n = (this._textWidth / 2) | 0;
      i.strokeRect(
        e + this.x - n,
        r + this.y + this.renderer.smuflMetrics.beatTimerPadding,
        this._textWidth,
        this._textHeight
      );
      let s = i.font,
        a = i.textBaseline,
        o = i.textAlign;
      (i.font = this.renderer.resources.timerFont),
        (i.textBaseline = 1),
        (i.textAlign = 1),
        i.fillText(this._text, e + this.x, r + this.y + this.height / 2),
        (i.font = s),
        (i.textBaseline = a),
        (i.textAlign = o);
    }
  };
  var Ec = class extends oe {
    get notationElement() {
      return 49;
    }
    get hideOnMultiTrack() {
      return !0;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return e.showTimer;
    }
    createNewGlyph(t, e) {
      return new Nc(e.timer ?? 0);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var Pc = class extends oe {
    get notationElement() {
      return 15;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !1;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return (
        e.index === 0 && e.voice.bar.index === 0 && e.voice.bar.staff.capo !== 0
      );
    }
    createNewGlyph(t, e) {
      return new it(
        0,
        0,
        ` ${e.voice.bar.staff.capo}`,
        t.resources.effectFont,
        0
      );
    }
    canExpand(t, e) {
      return !1;
    }
  };
  var Ac = class extends oe {
    get notationElement() {
      return 16;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return e.hasChord;
    }
    createNewGlyph(t, e) {
      return t.settings.notation.showChordDiagramsOnBeats
        ? new xs(0, 0, e.chord)
        : new it(0, 0, e.chord.name, t.resources.effectFont, 1);
    }
    canExpand(t, e) {
      return !1;
    }
  };
  var Cc = class extends si {
    constructor(t, e, r) {
      super(5),
        (this._crescendo = 0),
        (this._crescendo = r),
        (this.x = t),
        (this.y = e);
    }
    doLayout() {
      super.doLayout(),
        (this.height = this.renderer.smuflMetrics.glyphHeights.get(58686));
    }
    paintGrouped(t, e, r, i) {
      let n = t + this.x,
        s = this.height,
        a = this.renderer.smuflMetrics.glyphWidths.get(57508) / 2;
      i.beginPath(),
        this._crescendo === 1
          ? ((r -= a),
            i.moveTo(r, e + this.y),
            i.lineTo(n, e + this.y + s / 2),
            i.lineTo(r, e + this.y + s))
          : ((r -= a),
            i.moveTo(n, e + this.y),
            i.lineTo(r, e + this.y + s / 2),
            i.lineTo(n, e + this.y + s));
      let o = i.lineWidth;
      (i.lineWidth = this.renderer.smuflMetrics.hairpinThickness),
        i.stroke(),
        (i.lineWidth = o);
    }
  };
  var Mc = class extends oe {
    get notationElement() {
      return 17;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 4;
    }
    shouldCreateGlyph(t, e) {
      return e.crescendo !== 0;
    }
    createNewGlyph(t, e) {
      return new Cc(0, 0, e.crescendo);
    }
    canExpand(t, e) {
      return t.crescendo === e.crescendo;
    }
  };
  var Xa = class extends ue {
      constructor(e) {
        super(0, 0);
        this._scale = 1;
        this._symbols = e;
      }
      doLayout() {
        this.height = 0;
        let e = this.renderer.smuflMetrics.directionsScale;
        this._scale = e;
        for (let r of this._symbols) {
          let i = this.renderer.smuflMetrics.glyphHeights.get(r) * e;
          i > this.height && (this.height = i);
        }
      }
      paint(e, r, i) {
        i.fillMusicFontSymbols(
          e + this.x,
          r + this.y + this.height,
          this._scale,
          this._symbols,
          !0
        );
      }
    },
    Gt = class extends ue {
      constructor(t) {
        super(0, 0), (this._text = t);
      }
      doLayout() {
        let t = this.renderer.scoreRenderer.canvas;
        (t.font = this.renderer.resources.directionsFont),
          (this.height = t.measureText(this._text).height);
      }
      paint(t, e, r) {
        let i = r.font,
          n = r.textBaseline,
          s = r.textAlign;
        (r.font = this.renderer.resources.directionsFont),
          (r.textBaseline = 1),
          (r.textAlign = 2),
          r.fillText(this._text, t + this.x, e + this.y + this.height / 2),
          (r.font = i),
          (r.textBaseline = n),
          (r.textAlign = s);
      }
    },
    Ic = class extends Ve {
      constructor(e, r, i) {
        super(e, r);
        this._barBeginGlyphs = [];
        this._barEndGlyphs = [];
        this._directions = i;
      }
      doLayout() {
        let e = this._directions;
        e.has(2) && this._barBeginGlyphs.push(new Xa([57415, 57415])),
          e.has(1) && this._barBeginGlyphs.push(new Xa([57415])),
          e.has(4) && this._barBeginGlyphs.push(new Xa([57416, 57416])),
          e.has(3) && this._barBeginGlyphs.push(new Xa([57416])),
          e.has(0) && this._barEndGlyphs.push(new Gt("Fine")),
          e.has(18) && this._barEndGlyphs.push(new Gt("To Double Coda")),
          e.has(17) && this._barEndGlyphs.push(new Gt("To Coda")),
          e.has(13) && this._barEndGlyphs.push(new Gt("D.S.S.")),
          e.has(14) && this._barEndGlyphs.push(new Gt("D.S.S. al Coda")),
          e.has(15) && this._barEndGlyphs.push(new Gt("D.S.S. al Double Coda")),
          e.has(16) && this._barEndGlyphs.push(new Gt("D.S.S. al Fine")),
          e.has(9) && this._barEndGlyphs.push(new Gt("D.S.")),
          e.has(10) && this._barEndGlyphs.push(new Gt("D.S. al Coda")),
          e.has(11) && this._barEndGlyphs.push(new Gt("D.S. al Double Coda")),
          e.has(12) && this._barEndGlyphs.push(new Gt("D.S. al Fine")),
          e.has(5) && this._barEndGlyphs.push(new Gt("D.C.")),
          e.has(6) && this._barEndGlyphs.push(new Gt("D.C. al Coda")),
          e.has(7) && this._barEndGlyphs.push(new Gt("D.C. al Double Coda")),
          e.has(8) && this._barEndGlyphs.push(new Gt("D.C. al Fine"));
        let r = this._doSideLayout(this._barBeginGlyphs),
          i = this._doSideLayout(this._barEndGlyphs);
        this.height = Math.max(r, i);
      }
      _doSideLayout(e) {
        let r = 0,
          i = this.renderer.settings.display.effectBandPaddingBottom;
        for (let n of e)
          (n.y = r),
            (n.renderer = this.renderer),
            n.doLayout(),
            (r += n.height + i);
        return r;
      }
      paint(e, r, i) {
        for (let n of this._barBeginGlyphs) n.paint(e + this.x, r + this.y, i);
        for (let n of this._barEndGlyphs)
          n.paint(e + this.x + this.width, r + this.y, i);
      }
    };
  var Lc = class extends oe {
    get notationElement() {
      return 48;
    }
    get hideOnMultiTrack() {
      return !0;
    }
    get canShareBand() {
      return !1;
    }
    get sizingMode() {
      return 5;
    }
    shouldCreateGlyph(t, e) {
      return (
        e.voice.index === 0 &&
        e.index === 0 &&
        e.voice.bar.masterBar.directions !== null &&
        e.voice.bar.masterBar.directions.size > 0
      );
    }
    createNewGlyph(t, e) {
      return new Ic(0, 0, e.voice.bar.masterBar.directions);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var Dc = class p extends ce {
    constructor(t, e, r) {
      super(t, e, 1, p._getSymbol(r));
    }
    doLayout() {
      super.doLayout(),
        (this.center = !0),
        (this.height = this.renderer.smuflMetrics.glyphHeights.get(58658));
      let t = this.renderer.smuflMetrics.glyphTop.get(58658);
      this.offsetY = t;
    }
    static _getSymbol(t) {
      switch (t) {
        case 0:
          return 58666;
        case 1:
          return 58667;
        case 2:
          return 58656;
        case 3:
          return 58668;
        case 4:
          return 58669;
        case 5:
          return -1;
        case 6:
          return 58671;
        case 7:
          return 58672;
        case 8:
          return 58665;
        case 9:
          return 58664;
        case 10:
          return 58664;
        case 11:
          return 58673;
        case 12:
          return 58674;
        case 13:
          return 58675;
        case 14:
          return 58678;
        case 15:
          return 58679;
        case 16:
          return 58680;
        case 17:
          return 58676;
        case 18:
          return 58684;
        case 19:
          return 58685;
        case 20:
          return 58681;
        case 21:
          return 58683;
        case 22:
          return 58677;
        case 23:
          return 58662;
        case 24:
          return 58670;
        case 25:
          return 58682;
        default:
          return -1;
      }
    }
  };
  var Fc = class extends oe {
    get notationElement() {
      return 18;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !1;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return this._internalShouldCreateGlyph(e);
    }
    _internalShouldCreateGlyph(t) {
      if (
        t.voice.bar.staff.track.score.stylesheet.hideDynamics ||
        t.isEmpty ||
        t.voice.isEmpty ||
        t.isRest
      )
        return !1;
      let e = this._getPreviousDynamicsBeat(t),
        r = (t.voice.index === 0 && !e) || t.dynamics !== e?.dynamics;
      if (r && t.voice.index > 0) {
        for (let i of t.voice.bar.voices)
          if (i.index < t.voice.index) {
            let n = i.getBeatAtPlaybackStart(t.playbackStart);
            n &&
              t.dynamics === n.dynamics &&
              this._internalShouldCreateGlyph(n) &&
              (r = !1);
          }
      }
      return r;
    }
    _getPreviousDynamicsBeat(t) {
      let e = t.previousBeat;
      for (; e != null; ) {
        if (!e.isRest) return e;
        e = e.previousBeat;
      }
      return null;
    }
    createNewGlyph(t, e) {
      return new Dc(0, 0, e.dynamics);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var Rc = class p extends ce {
    constructor(t) {
      super(0, 0, 1, p._getSymbol(t)), (this.center = !0);
    }
    static _getSymbol(t) {
      switch (t) {
        case 1:
          return 59459;
        case 2:
          return 59460;
        case 3:
          return 59461;
      }
      return -1;
    }
    paint(t, e, r) {
      super.paint(t, e + this.height, r);
    }
  };
  var Oc = class extends oe {
    get notationElement() {
      return 19;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return e.fade !== 0;
    }
    createNewGlyph(t, e) {
      return new Rc(e.fade);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var Gc = class p extends ce {
    constructor(t, e, r) {
      super(t, e, 1, p._getSymbol(r));
    }
    static _getSymbol(t) {
      switch (t) {
        case 0:
          return 58564;
        case 1:
          return 58560;
        case 2:
          return 58566;
        default:
          return -1;
      }
    }
    paint(t, e, r) {
      super.paint(t - this.width / 2, e + this.height, r);
    }
  };
  var Vc = class extends oe {
    get notationElement() {
      return 20;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !1;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return e.voice.index === 0 && !!e.fermata;
    }
    createNewGlyph(t, e) {
      return new Gc(0, 0, e.fermata.type);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var fh = class {
      constructor(t, e) {
        this.line = 0;
        (this.line = t), (this.symbols = e);
      }
    },
    Ya = class p extends rt {
      constructor() {
        super(0, 0);
        this._infos = new Map();
      }
      get isEmpty() {
        return this._infos.size === 0;
      }
      addFingers(e) {
        let r = this.renderer.settings;
        if (r.notation.fingeringMode !== 0 && r.notation.fingeringMode !== 1)
          return;
        let i = p.fingerToMusicFontSymbol(
          this.renderer.settings,
          e.beat,
          e.leftHandFinger,
          !0
        );
        i !== -1 && this._addFinger(e, i);
        let n = p.fingerToMusicFontSymbol(
          this.renderer.settings,
          e.beat,
          e.rightHandFinger,
          !1
        );
        n !== -1 && this._addFinger(e, n);
      }
      static fingerToMusicFontSymbol(e, r, i, n) {
        if (
          e.notation.fingeringMode === 1 ||
          e.notation.fingeringMode === 3 ||
          Lt.isPiano(r.voice.bar.staff.track.playbackInfo.program)
        )
          switch (i) {
            case -2:
            case -1:
              return -1;
            case 0:
              return 60689;
            case 1:
              return 60690;
            case 2:
              return 60691;
            case 3:
              return 60692;
            case 4:
              return 60693;
            default:
              return -1;
          }
        if (n)
          switch (i) {
            case -2:
              return -1;
            case -1:
              return 60688;
            case 0:
              return 60696;
            case 1:
              return 60689;
            case 2:
              return 60690;
            case 3:
              return 60691;
            case 4:
              return 60692;
            default:
              return -1;
          }
        switch (i) {
          case -2:
          case -1:
            return -1;
          case 0:
            return 60695;
          case 1:
            return 60697;
          case 2:
            return 60698;
          case 3:
            return 60699;
          case 4:
            return 60700;
          default:
            return -1;
        }
      }
      _addFinger(e, r) {
        let i = this.renderer,
          n = i.getNoteLine(e);
        if (this._infos.has(n)) this._infos.get(n).symbols.push(r);
        else {
          let s = new fh(n, [r]);
          (s.color = $.noteColor(i.resources, 3, e)), this._infos.set(n, s);
        }
      }
      doLayout() {
        let e = this.renderer;
        for (let [r, i] of this._infos) {
          let n = new Qu(0, 0, 1, i.symbols);
          (n.colorOverride = i.color),
            (n.renderer = e),
            (n.y = e.getScoreY(i.line)),
            n.doLayout(),
            (n.offsetY = n.height / 2),
            this.addGlyph(n),
            (this.width = Math.max(this.width, n.width));
        }
        for (let r of this.glyphs) {
          let i = r;
          (i.x = this.width / 2), (i.center = !0);
        }
      }
    };
  var Wc = class extends oe {
    get notationElement() {
      return 21;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return e.voice.index !== 0 ||
        e.isRest ||
        (t.notation.fingeringMode !== 2 && t.notation.fingeringMode !== 3) ||
        e.notes.length !== 1
        ? !1
        : e.notes[0].isFingering;
    }
    createNewGlyph(t, e) {
      let r = -2,
        i = !1,
        n = e.notes[0];
      n.leftHandFinger !== -2
        ? ((r = n.leftHandFinger), (i = !0))
        : n.rightHandFinger !== -2 && (r = n.rightHandFinger);
      let s = Ya.fingerToMusicFontSymbol(t.settings, e, r, i),
        a = new ce(0, 0, 1, s);
      return (
        (a.center = !0),
        (a.renderer = t),
        a.doLayout(),
        (a.offsetY = t.smuflMetrics.glyphTop.get(a.symbol)),
        a
      );
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var Hc = class extends oe {
    get notationElement() {
      return 34;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 0;
    }
    shouldCreateGlyph(t, e) {
      let r = e.voice.bar.masterBar;
      return (
        e.voice.bar.staff.index === 0 &&
        e.voice.index === 0 &&
        e.index === 0 &&
        r.isFreeTime &&
        (r.index === 0 || r.isFreeTime !== r.previousMasterBar.isFreeTime)
      );
    }
    createNewGlyph(t, e) {
      return new it(0, 0, "Free time", t.resources.effectFont, 0);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var Ja = class extends ce {
    constructor(t, e, r = !1) {
      super(t, e, ie.GraceScale, 59458), (this.center = r);
    }
    doLayout() {
      super.doLayout(), (this.offsetY = this.height);
    }
  };
  var Ps = class extends oe {
    constructor(t, e) {
      super(), (this._type = t), (this._shouldCreate = e);
    }
    get notationElement() {
      return 43;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      let r = this._shouldCreate;
      return e.golpe === this._type && (!r || r(t, e));
    }
    createNewGlyph(t, e) {
      return new Ja(0, 0, !0);
    }
    canExpand(t, e) {
      return !1;
    }
  };
  var nr = class extends oe {
    constructor() {
      super(...arguments);
      this.lastCreateInfo = null;
    }
    shouldCreateGlyph(e, r) {
      this.lastCreateInfo = [];
      for (let i = 0, n = r.notes.length; i < n; i++) {
        let s = r.notes[i];
        this.shouldCreateGlyphForNote(s) && this.lastCreateInfo.push(s);
      }
      return this.lastCreateInfo.length > 0;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    canExpand(e, r) {
      return !0;
    }
  };
  var en = class p extends nr {
    constructor(e) {
      super();
      this._beat = null;
      switch (((this._harmonicType = e), e)) {
        case 0:
          this._effectId = "harmonics-none";
          break;
        case 1:
          this._effectId = "harmonics-natural";
          break;
        case 2:
          this._effectId = "harmonics-artificial";
          break;
        case 3:
          this._effectId = "harmonics-pinch";
          break;
        case 4:
          this._effectId = "harmonics-tap";
          break;
        case 5:
          this._effectId = "harmonics-semi";
          break;
        case 6:
          this._effectId = "harmonics-feedback";
          break;
        default:
          this._effectId = "";
          break;
      }
    }
    get effectId() {
      return this._effectId;
    }
    get notationElement() {
      return 22;
    }
    shouldCreateGlyphForNote(e) {
      return !e.isHarmonic || e.harmonicType !== this._harmonicType
        ? !1
        : (e.beat !== this._beat && (this._beat = e.beat), !0);
    }
    get sizingMode() {
      return 3;
    }
    createNewGlyph(e, r) {
      return new ir(p.harmonicToString(this._harmonicType));
    }
    static harmonicToString(e) {
      switch (e) {
        case 1:
          return "N.H.";
        case 2:
          return "A.H.";
        case 3:
          return "P.H.";
        case 4:
          return "T.H.";
        case 5:
          return "S.H.";
        case 6:
          return "Fdbk.";
      }
      return "";
    }
  };
  var Uc = class extends ce {
    constructor() {
      super(0, 0, 1, 59456), (this.center = !0);
    }
    doLayout() {
      super.doLayout(),
        (this.offsetY = this.renderer.smuflMetrics.glyphTop.get(this.symbol));
    }
  };
  var El = class extends nr {
    get notationElement() {
      return 32;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyphForNote(t) {
      return t.isLeftHandTapped;
    }
    createNewGlyph(t, e) {
      return new Uc();
    }
  };
  var zc = class extends oe {
    get notationElement() {
      return 23;
    }
    get canShareBand() {
      return !1;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    shouldCreateGlyph(t, e) {
      return e.isLetRing;
    }
    get sizingMode() {
      return 3;
    }
    createNewGlyph(t, e) {
      return new ir("LetRing");
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var Xc = class extends Ve {
    constructor(t, e, r, i, n = 1) {
      super(t, e), (this._lines = r), (this.font = i), (this.textAlign = n);
    }
    doLayout() {
      super.doLayout(), (this.height = this.font.size * this._lines.length);
    }
    paint(t, e, r) {
      r.font = this.font;
      let i = r.textAlign;
      r.textAlign = this.textAlign;
      for (let n = 0; n < this._lines.length; n++)
        if (this._lines[n]) {
          let s = this._lines[n],
            a = e + this.y + n * this.font.size + 3,
            o = t + this.x;
          r.fillText(s, o, a);
        }
      r.textAlign = i;
    }
  };
  var Yc = class extends oe {
    get notationElement() {
      return 24;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !1;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return !!e.lyrics;
    }
    createNewGlyph(t, e) {
      return new Xc(0, 0, e.lyrics, t.resources.wordsFont, 1);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var Jc = class extends oe {
    get notationElement() {
      return 25;
    }
    get hideOnMultiTrack() {
      return !0;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 0;
    }
    shouldCreateGlyph(t, e) {
      return (
        e.voice.bar.staff.index === 0 &&
        e.voice.index === 0 &&
        e.index === 0 &&
        e.voice.bar.masterBar.isSectionStart
      );
    }
    createNewGlyph(t, e) {
      return new it(
        0,
        0,
        e.voice.bar.masterBar.section.marker
          ? `[${e.voice.bar.masterBar.section.marker}] ${e.voice.bar.masterBar.section.text}`
          : e.voice.bar.masterBar.section.text,
        t.resources.markerFont,
        0
      );
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var qc = class p extends ce {
    constructor(t) {
      super(0, 0, 1, p._getSymbol(t)), (this.center = !0);
    }
    static _getSymbol(t) {
      switch (t) {
        case 1:
          return 58728;
        case 2:
          return 58727;
        case 3:
          return 58732;
        case 4:
          return 58733;
      }
      return -1;
    }
    doLayout() {
      super.doLayout(),
        (this.height = this.renderer.smuflMetrics.glyphHeights.get(58733)),
        (this.offsetY = this.renderer.smuflMetrics.glyphTop.get(58733));
    }
  };
  var $c = class extends oe {
    get notationElement() {
      return 46;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return e.notes.some((r) => r.ornament !== 0);
    }
    createNewGlyph(t, e) {
      return new qc(e.notes.find((r) => r.ornament !== 0).ornament);
    }
    canExpand(t, e) {
      return !1;
    }
  };
  var Kc = class extends si {
    constructor(t, e) {
      super(4), (this._ottava = t), (this._aboveStaff = e);
    }
    doLayout() {
      super.doLayout(),
        (this.height = this.renderer.smuflMetrics.glyphHeights.get(58645));
    }
    paintNonGrouped(t, e, r) {
      this._paintOttava(t, e, r);
    }
    _paintOttava(t, e, r) {
      let i = 0;
      switch (this._ottava) {
        case 0:
          (i = this.renderer.smuflMetrics.glyphWidths.get(58645)),
            ge.fillMusicFontSymbolSafe(
              r,
              t + this.x - i / 2,
              e + this.y + this.height,
              1,
              58645,
              !1
            );
          break;
        case 1:
          (i = this.renderer.smuflMetrics.glyphWidths.get(58641)),
            ge.fillMusicFontSymbolSafe(
              r,
              t + this.x - i / 2,
              e + this.y + this.height,
              1,
              58641,
              !1
            );
          break;
        case 3:
          (i = this.renderer.smuflMetrics.glyphWidths.get(58652)),
            ge.fillMusicFontSymbolSafe(
              r,
              t + this.x - i / 2,
              e + this.y + this.height,
              1,
              58652,
              !1
            );
          break;
        case 4:
          (i =
            (this.renderer.smuflMetrics.glyphWidths.get(58644) +
              this.renderer.smuflMetrics.glyphWidths.get(60565) +
              this.renderer.smuflMetrics.glyphWidths.get(60563)) *
            1),
            ge.fillMusicFontSymbolsSafe(
              r,
              t + this.x - i / 2,
              e + this.y + this.height,
              1,
              [58644, 60565, 60563],
              !1
            );
          break;
      }
      return i / 2;
    }
    paintGrouped(t, e, r, i) {
      let n = this._paintOttava(t, e, i),
        s = this.renderer.smuflMetrics.lineRangedGlyphDashGap,
        a = t + this.x + n + s,
        o = e + this.y,
        l = this.height * 0.5;
      o += this._aboveStaff ? 0 : this.height;
      let u = this.renderer.smuflMetrics.lineRangedGlyphDashSize,
        c = i.lineWidth;
      if (
        ((i.lineWidth = this.renderer.smuflMetrics.octaveLineThickness), r > a)
      ) {
        let d = a;
        for (; d < r; )
          i.beginPath(),
            i.moveTo(d, o | 0),
            i.lineTo(Math.min(d + u, r), o | 0),
            (d += u + s),
            i.stroke();
        i.beginPath(),
          this._aboveStaff
            ? (i.moveTo(r, o), i.lineTo(r, o + l))
            : (i.moveTo(r, o), i.lineTo(r, o - l)),
          i.stroke();
      }
      i.lineWidth = c;
    }
  };
  var Pl = class extends oe {
    get effectId() {
      return `ottavia-${this._aboveStaff ? "above" : "below"}`;
    }
    get notationElement() {
      return 26;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 3;
    }
    constructor(t) {
      super(), (this._aboveStaff = t);
    }
    shouldCreateGlyph(t, e) {
      switch (e.ottava) {
        case 0:
          return this._aboveStaff;
        case 1:
          return this._aboveStaff;
        case 3:
          return !this._aboveStaff;
        case 4:
          return !this._aboveStaff;
      }
      return !1;
    }
    createNewGlyph(t, e) {
      return new Kc(e.ottava, this._aboveStaff);
    }
    canExpand(t, e) {
      return t.ottava === e.ottava;
    }
  };
  var Qc = class extends nr {
    get notationElement() {
      return 27;
    }
    shouldCreateGlyphForNote(t) {
      return t.isPalmMute;
    }
    get sizingMode() {
      return 3;
    }
    createNewGlyph(t, e) {
      return new ir("P.M.");
    }
  };
  var Zc = class extends nr {
    get notationElement() {
      return 28;
    }
    shouldCreateGlyphForNote(t) {
      return t.slideOutType === 5 || t.slideOutType === 6;
    }
    get sizingMode() {
      return 3;
    }
    createNewGlyph(t, e) {
      return new ir("P.S.");
    }
  };
  var As = class p extends ce {
    constructor(t, e, r) {
      super(t, e, ie.GraceScale, p._getSymbol(r)), (this.center = !0);
    }
    doLayout() {
      super.doLayout(), (this.offsetY = this.height);
    }
    static _getSymbol(t) {
      switch (t) {
        case 1:
          return 58898;
        case 2:
          return 58896;
        default:
          return -1;
      }
    }
  };
  var jc = class extends oe {
    get notationElement() {
      return 29;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return e.pickStroke !== 0;
    }
    createNewGlyph(t, e) {
      return new As(0, 0, e.pickStroke);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var ed = class extends oe {
    get notationElement() {
      return 47;
    }
    get canShareBand() {
      return !1;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    shouldCreateGlyph(t, e) {
      return e.hasRasgueado;
    }
    get sizingMode() {
      return 3;
    }
    createNewGlyph(t, e) {
      return new ir("rasg.");
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var Al = class extends si {
      constructor(e, r, i, n = !1) {
        super(5);
        this._symbol = -1;
        this._repeatOffsetX = 0;
        this._symbolOffsetY = 0;
        (this._type = i), (this.x = e), (this.y = r), (this._partialWaves = n);
      }
      doLayout() {
        switch ((super.doLayout(), this._type)) {
          case 1:
            this._symbol = this.slightVibratoGlyph;
            break;
          case 2:
            this._symbol = this.wideVibratoGlyph;
            break;
        }
        (this._repeatOffsetX = this.renderer.smuflMetrics.repeatOffsetX.get(
          this._symbol
        )),
          (this._symbolOffsetY = this.renderer.smuflMetrics.glyphTop.get(
            this._symbol
          )),
          (this.height = this.renderer.smuflMetrics.glyphHeights.get(
            this._symbol
          ));
      }
      paintGrouped(e, r, i, n) {
        let s = e + this.x,
          a = i - s,
          o = this._repeatOffsetX,
          l = a / o;
        this._partialWaves || (l = Math.floor(l)), l < 1 && (l = 1);
        let u = [];
        for (let c = 0; c < l; c++) u.push(this._symbol);
        n.fillMusicFontSymbols(
          e + this.x,
          r + this.y + this._symbolOffsetY,
          1,
          u,
          !1
        );
      }
    },
    Vt = class extends Al {
      get slightVibratoGlyph() {
        return 60082;
      }
      get wideVibratoGlyph() {
        return 60083;
      }
    };
  var qa = class extends Al {
    get slightVibratoGlyph() {
      return 60090;
    }
    get wideVibratoGlyph() {
      return 60091;
    }
  };
  var Cl = class extends oe {
    get notationElement() {
      return 30;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 4;
    }
    shouldCreateGlyph(t, e) {
      return e.vibrato === 1;
    }
    createNewGlyph(t, e) {
      return new qa(0, 0, 1);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var Ml = class extends nr {
    get notationElement() {
      return 31;
    }
    shouldCreateGlyphForNote(t) {
      let e =
        t.vibrato === 1 || (t.isTieDestination && t.tieOrigin.vibrato === 1);
      return (
        this._hideOnTiedBend &&
          e &&
          t.isTieDestination &&
          t.tieOrigin.hasBend &&
          (e = !1),
        e
      );
    }
    get sizingMode() {
      return 4;
    }
    createNewGlyph(t, e) {
      return new Vt(0, 0, 1);
    }
    constructor(t) {
      super(), (this._hideOnTiedBend = t);
    }
  };
  var td = class extends Ve {
    constructor() {
      super(0, 0);
    }
    doLayout() {
      super.doLayout(),
        (this.height = this.renderer.smuflMetrics.glyphHeights.get(58960));
    }
    paint(t, e, r) {
      let i = this.renderer,
        n = e + this.y,
        s = this.height,
        a = i.bar.sustainPedals,
        o = this.renderer.smuflMetrics.glyphWidths.get(58960),
        l = this.renderer.smuflMetrics.glyphWidths.get(58965),
        u = 0;
      for (; u < a.length; ) {
        let c = a[u];
        for (; c != null; ) {
          let d = t + this.renderer.getRatioPositionX(c.ratioPosition),
            h = 0;
          if (
            (c.pedalType === 0
              ? (ge.fillMusicFontSymbolSafe(r, d, n + s, 1, 58960, !0),
                (h =
                  o / 2 + this.renderer.smuflMetrics.sustainPedalLinePadding))
              : c.pedalType === 2 &&
                (ge.fillMusicFontSymbolSafe(r, d, n + s, 1, 58965, !0),
                (h =
                  l / 2 + this.renderer.smuflMetrics.sustainPedalLinePadding)),
            c.nextPedalMarker)
          )
            if (c.nextPedalMarker.bar === c.bar) {
              let f =
                t +
                this.renderer.getRatioPositionX(
                  c.nextPedalMarker.ratioPosition
                );
              switch (c.nextPedalMarker.pedalType) {
                case 0:
                  f -= o / 2;
                  break;
                case 1:
                  break;
                case 2:
                  f -= l / 2;
                  break;
              }
              let b = d + h;
              f > b &&
                r.fillRect(
                  b,
                  n + s - this.renderer.smuflMetrics.pedalLineThickness,
                  f - b,
                  this.renderer.smuflMetrics.pedalLineThickness
                );
            } else {
              let f = t + this.x + this.width,
                b = d + h;
              r.fillRect(
                b,
                n + s - this.renderer.smuflMetrics.pedalLineThickness,
                f - b,
                this.renderer.smuflMetrics.pedalLineThickness
              );
            }
          if (u === 0 && c.previousPedalMarker) {
            let f = t + this.x,
              b = d - h;
            r.fillRect(
              f,
              n + s - this.renderer.smuflMetrics.pedalLineThickness,
              b - f,
              this.renderer.smuflMetrics.pedalLineThickness
            );
          }
          u++,
            c.nextPedalMarker != null && c.nextPedalMarker.bar !== c.bar
              ? ((c = null), (u = a.length))
              : (c = c.nextPedalMarker);
        }
      }
    }
  };
  var rd = class extends oe {
    get notationElement() {
      return 42;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !1;
    }
    get sizingMode() {
      return 5;
    }
    shouldCreateGlyph(t, e) {
      return (
        e.voice.index === 0 &&
        e.index === 0 &&
        e.voice.bar.sustainPedals.length > 0
      );
    }
    createNewGlyph(t, e) {
      return new td();
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var id = class extends oe {
    get notationElement() {
      return 32;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return e.slap || e.pop || e.tap;
    }
    createNewGlyph(t, e) {
      let r = t.resources;
      return e.slap
        ? new it(0, 0, "S", r.effectFont, 1)
        : e.pop
        ? new it(0, 0, "P", r.effectFont, 1)
        : new it(0, 0, "T", r.effectFont, 1);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var nd = class extends Ve {
    constructor(t) {
      super(0, 0), (this._tempoAutomations = t);
    }
    doLayout() {
      super.doLayout();
      let t = this.renderer.resources;
      this.height =
        this.renderer.smuflMetrics.glyphHeights.get(60581) *
        t.engravingSettings.tempoNoteScale;
    }
    paint(t, e, r) {
      for (let i of this._tempoAutomations) {
        let n = t + this.renderer.getRatioPositionX(i.ratioPosition),
          s = this.renderer.resources;
        r.font = s.markerFont;
        let a =
            e +
            this.y +
            this.height +
            this.renderer.smuflMetrics.glyphBottom.get(60581) *
              s.engravingSettings.tempoNoteScale,
          o = r.textBaseline;
        if (((r.textBaseline = 3), i.text)) {
          let l = `${i.text} `,
            u = r.measureText(l);
          r.fillText(l, n, a), (n += u.width);
        } else n -= s.engravingSettings.glyphWidths.get(60581) / 2;
        ge.fillMusicFontSymbolSafe(
          r,
          n,
          a,
          s.engravingSettings.tempoNoteScale,
          60581
        ),
          (n +=
            this.renderer.smuflMetrics.glyphWidths.get(60581) *
            s.engravingSettings.tempoNoteScale),
          r.fillText(` = ${i.value.toString()}`, n, a),
          (r.textBaseline = o),
          (n += r.measureText(` = ${i.value.toString()}`).width);
      }
    }
  };
  var sd = class extends oe {
    get notationElement() {
      return 33;
    }
    get hideOnMultiTrack() {
      return !0;
    }
    get canShareBand() {
      return !1;
    }
    get sizingMode() {
      return 0;
    }
    shouldCreateGlyph(t, e) {
      return (
        e.voice.bar.staff.index === 0 &&
        e.voice.index === 0 &&
        e.index === 0 &&
        e.voice.bar.masterBar.tempoAutomations.some((r) => r.isVisible)
      );
    }
    createNewGlyph(t, e) {
      return new nd(
        e.voice.bar.masterBar.tempoAutomations.filter((r) => r.isVisible)
      );
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var ad = class extends oe {
    get notationElement() {
      return 34;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !1;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return !!e.text;
    }
    createNewGlyph(t, e) {
      return new it(0, 0, e.text, t.resources.effectFont, 0);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var od = class extends si {
    constructor(t, e) {
      super(5), (this.x = t), (this.y = e);
    }
    doLayout() {
      super.doLayout(),
        (this.height = this.renderer.smuflMetrics.glyphHeights.get(58726));
    }
    paintGrouped(t, e, r, i) {
      let n = this.renderer.smuflMetrics.glyphWidths.get(58726),
        a = t + this.x + n,
        o = this.renderer.smuflMetrics.repeatOffsetX.get(60068),
        l = Math.ceil((r - a) / o),
        u = [58726];
      for (let c = 0; c < l; c++) u.push(60068);
      i.fillMusicFontSymbols(
        t + this.x - n / 2,
        e + this.y + this.height,
        1,
        u,
        !1
      );
    }
  };
  var Il = class extends nr {
    get notationElement() {
      return 35;
    }
    shouldCreateGlyphForNote(t) {
      return t.isTrill;
    }
    get sizingMode() {
      return 4;
    }
    createNewGlyph(t, e) {
      return new od(0, 0);
    }
  };
  var ld = class extends Ve {
    constructor(e) {
      super(0, 0);
      this._tupletHeight = 0;
      this._tupletPadding = 0;
      this._tripletFeel = e;
    }
    doLayout() {
      super.doLayout();
      let e = this.renderer.smuflMetrics.tempoNoteScale;
      (this.height = this.renderer.smuflMetrics.glyphHeights.get(60581) * e),
        (this._tupletHeight =
          this.renderer.smuflMetrics.glyphHeights.get(59523) * e),
        (this._tupletPadding =
          this.renderer.smuflMetrics.tripletFeelBracketPadding),
        (this.height += this._tupletHeight);
    }
    paint(e, r, i) {
      (e += this.x), (r += this.y);
      let n = 0,
        s = 0;
      switch (this._tripletFeel) {
        case 0:
          (n = 0), (s = 0);
          break;
        case 2:
          (n = 0), (s = 2);
          break;
        case 1:
          (n = 1), (s = 3);
          break;
        case 4:
          (n = 0), (s = 4);
          break;
        case 3:
          (n = 1), (s = 5);
          break;
        case 6:
          (n = 0), (s = 6);
          break;
        case 5:
          (n = 1), (s = 7);
          break;
      }
      let a = this.renderer.smuflMetrics.tempoNoteScale,
        o = r + this.renderer.smuflMetrics.glyphTop.get(60581) * a,
        l = r + this.height,
        u = i.textBaseline;
      (i.textBaseline = 2),
        (i.font = this.renderer.resources.effectFont),
        i.fillText("(", e, l),
        (e += i.measureText("( ").width),
        (e = this._drawGroup(e, o + this._tupletHeight, i, n)),
        i.fillText(" = ", e, l),
        (e += i.measureText(" = ").width),
        (e = this._drawGroup(e, o + this._tupletHeight, i, s)),
        i.fillText(" )", e, l),
        (i.textBaseline = u);
    }
    _drawGroup(e, r, i, n) {
      let s = this.renderer.smuflMetrics.tempoNoteScale,
        a = [],
        o = [],
        l = [],
        u = -1;
      switch (n) {
        case 0:
          l.push(1), (a = [60581]), (o = [60581]);
          break;
        case 1:
          l.push(1), l.push(1), (a = [60581]), (o = [60581]);
          break;
        case 2:
          (a = [60581]), (o = [60583]), (u = 59523);
          break;
        case 3:
          l.push(1), l.push(2), (a = [60581]), (o = [60581]), (u = 59523);
          break;
        case 4:
          l.push(1), l.push(2), (a = [60581, 32, 60599]), (o = [60581]);
          break;
        case 5:
          l.push(1),
            l.push(1),
            l.push(2),
            (a = [60581, 32, 60599]),
            (o = [60581]);
          break;
        case 6:
          l.push(1), l.push(0), (a = [60581]), (o = [60581, 32, 60599]);
          break;
        case 7:
          l.push(1),
            l.push(1),
            l.push(0),
            (a = [60581]),
            (o = [60581, 32, 60599]);
          break;
      }
      let c = this.renderer.smuflMetrics.glyphWidths.get(60581) * s,
        d = e + c - this.renderer.smuflMetrics.stemThickness * s,
        h = d + c * 2 + this.renderer.smuflMetrics.stemThickness * s,
        f =
          this.renderer.smuflMetrics.tempoNoteScale *
          this.renderer.smuflMetrics.beamThickness,
        b =
          this.renderer.smuflMetrics.tempoNoteScale *
          this.renderer.smuflMetrics.beamSpacing,
        y = this.renderer.smuflMetrics.brokenBeamWidth * s,
        S = r - this.renderer.smuflMetrics.glyphHeights.get(60581) * s + f;
      if (u !== -1) {
        let O = (e + h) / 2,
          N = S - this._tupletHeight - this._tupletPadding,
          R = this.renderer.smuflMetrics.glyphTop.get(u) * s,
          g = this.renderer.smuflMetrics.glyphWidths.get(u) * s;
        ge.fillMusicFontSymbolSafe(i, O, N + R, s, u, !0);
        let x = O - g / 2 - this._tupletPadding,
          M = O + g / 2 + this._tupletPadding,
          P = this._tupletHeight / 2,
          H = i.lineWidth;
        i.beginPath(),
          i.moveTo(e, N + P + P),
          i.lineTo(e, N + P),
          i.lineTo(x, N + P),
          i.moveTo(M, N + P),
          i.lineTo(h, N + P),
          i.lineTo(h, N + P + P),
          (i.lineWidth = this.renderer.smuflMetrics.tupletBracketThickness * s),
          i.stroke(),
          (i.lineWidth = H);
      }
      i.fillMusicFontSymbols(e, r, s, a, !1),
        (e += c),
        (e += c),
        i.fillMusicFontSymbols(e, r, s, o, !1),
        (e += c),
        (o[o.length - 1] === 60599 || o[0] === 60583) && (e += c);
      for (let k of l) {
        switch (k) {
          case 0:
            i.fillRect(d, S, y, f);
            break;
          case 1:
            i.fillRect(d, S, h - d, f);
            break;
          case 2:
            i.fillRect(h - y, S, y, f);
            break;
        }
        S += f + b;
      }
      return e;
    }
  };
  var ud = class extends oe {
    get notationElement() {
      return 36;
    }
    get hideOnMultiTrack() {
      return !0;
    }
    get canShareBand() {
      return !1;
    }
    get sizingMode() {
      return 0;
    }
    shouldCreateGlyph(t, e) {
      return (
        e.index === 0 &&
        ((e.voice.bar.masterBar.index === 0 &&
          e.voice.bar.masterBar.tripletFeel !== 0) ||
          (e.voice.bar.masterBar.index > 0 &&
            e.voice.bar.masterBar.tripletFeel !==
              e.voice.bar.masterBar.previousMasterBar.tripletFeel))
      );
    }
    createNewGlyph(t, e) {
      return new ld(e.voice.bar.masterBar.tripletFeel);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var cd = class p extends ce {
    constructor(t) {
      super(0, 0, 1, p._getSymbol(t)), (this.center = !0);
    }
    static _getSymbol(t) {
      switch (t) {
        case 1:
          return 59453;
        case 2:
          return 59455;
      }
      return -1;
    }
    paint(t, e, r) {
      super.paint(t, e + this.height, r);
    }
  };
  var dd = class extends oe {
    get notationElement() {
      return 44;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 1;
    }
    shouldCreateGlyph(t, e) {
      return e.wahPedal !== 0;
    }
    createNewGlyph(t, e) {
      return new cd(e.wahPedal);
    }
    canExpand(t, e) {
      return !1;
    }
  };
  var pd = class extends oe {
    get notationElement() {
      return 37;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !1;
    }
    get sizingMode() {
      return 3;
    }
    shouldCreateGlyph(t, e) {
      return e.hasWhammyBar;
    }
    createNewGlyph(t, e) {
      return new ir("w/bar");
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var Ll = class extends oe {
    get notationElement() {
      return 38;
    }
    get hideOnMultiTrack() {
      return !1;
    }
    get canShareBand() {
      return !0;
    }
    get sizingMode() {
      return 4;
    }
    shouldCreateGlyph(t, e) {
      return e.vibrato === 2;
    }
    createNewGlyph(t, e) {
      return new qa(0, 0, 2);
    }
    canExpand(t, e) {
      return !0;
    }
  };
  var Dl = class extends nr {
    get notationElement() {
      return 39;
    }
    shouldCreateGlyphForNote(t) {
      return (
        t.vibrato === 2 || (t.isTieDestination && t.tieOrigin.vibrato === 2)
      );
    }
    get sizingMode() {
      return 4;
    }
    createNewGlyph(t, e) {
      return new Vt(0, 0, 2);
    }
  };
  var hd = class {
      constructor() {
        this.x = 0;
        this.width = 0;
        this.masterBars = [];
      }
    },
    md = class extends Ns {
      constructor() {
        super(...arguments);
        this._system = null;
      }
      get name() {
        return "HorizontalScreen";
      }
      get supportsResize() {
        return !1;
      }
      get firstBarX() {
        let e = this.pagePadding[0];
        return this._system && (e += this._system.accoladeWidth), e;
      }
      doResize() {}
      doLayoutAndRender() {
        switch (this.renderer.settings.display.systemsLayoutMode) {
          case 0:
            this.systemsLayoutMode = 0;
            break;
          case 1:
            this.systemsLayoutMode = 2;
            break;
        }
        let e = this.renderer.score,
          r = this.renderer.settings.display.startBar;
        r--, (r = Math.min(e.masterBars.length - 1, Math.max(0, r)));
        let i = r,
          n = this.renderer.settings.display.barCount;
        n <= 0 && (n = e.masterBars.length),
          (n = r + n - 1),
          (n = Math.min(e.masterBars.length - 1, Math.max(0, n))),
          (this._system = this.createEmptyStaffSystem()),
          (this._system.isLast = !0),
          (this._system.x = this.pagePadding[0]),
          (this._system.y = this.pagePadding[1]);
        let s = this.renderer.settings.display.barCountPerPartial,
          a = [],
          o = new hd(),
          l = 0;
        for (; i <= n; ) {
          let c = this.multiBarRestInfo,
            d = c !== null && c.has(i) ? c.get(i) : null,
            h = this._system.addBars(this.renderer.tracks, i, d);
          if (
            o.masterBars.length === 0 &&
            h.isLinkedToPrevious &&
            a.length > 0
          ) {
            let f = a[a.length - 1];
            f.masterBars.push(e.masterBars[i]),
              (f.width += h.width),
              (l += h.width),
              (o.x += l);
          } else
            o.masterBars.push(e.masterBars[i]),
              (o.width += h.width),
              o.masterBars.length >= s &&
                (a.length === 0 &&
                  (o.width += this._system.accoladeWidth + this.pagePadding[0]),
                (l += o.width),
                a.push(o),
                w.debug(
                  this.name,
                  `Finished partial from bar ${o.masterBars[0].index} to ${
                    o.masterBars[o.masterBars.length - 1].index
                  }`,
                  null
                ),
                (o = new hd()),
                (o.x = l));
          i++;
        }
        o.masterBars.length > 0 &&
          (a.length === 0 &&
            (o.width += this._system.accoladeWidth + this.pagePadding[0]),
          a.push(o),
          w.debug(
            this.name,
            `Finished partial from bar ${o.masterBars[0].index} to ${
              o.masterBars[o.masterBars.length - 1].index
            }`,
            null
          )),
          this._finalizeStaffSystem(),
          (this.height = Math.floor(this._system.y + this._system.height)),
          (this.width =
            this._system.x + this._system.width + this.pagePadding[2]),
          (i = 0);
        let u = 0;
        for (let c = 0; c < a.length; c++) {
          let d = a[c],
            h = new $t();
          (h.x = u),
            (h.y = 0),
            (h.totalWidth = this.width),
            (h.totalHeight = this.height),
            (h.width = d.width),
            (h.height = this.height),
            (h.firstMasterBarIndex = d.masterBars[0].index),
            (h.lastMasterBarIndex =
              d.masterBars[d.masterBars.length - 1].index),
            (u += d.width);
          let f = i,
            b = c;
          this._system.buildBoundingsLookup(0, 0),
            this.registerPartial(h, (y) => {
              let S =
                this._system.getBarX(d.masterBars[0].index) +
                this._system.accoladeWidth;
              b === 0 && (S -= this._system.x + this._system.accoladeWidth),
                (y.color =
                  this.renderer.settings.display.resources.mainGlyphColor),
                (y.textAlign = 0),
                w.debug(
                  this.name,
                  `Rendering partial from bar ${d.masterBars[0].index} to ${
                    d.masterBars[d.masterBars.length - 1].index
                  }`,
                  null
                ),
                this._system.paintPartial(
                  -S,
                  this._system.y,
                  y,
                  f,
                  d.masterBars.length
                );
            }),
            (i += d.masterBars.length);
        }
        (this.height = this.layoutAndRenderBottomScoreInfo(this.height)),
          (this.height = this.layoutAndRenderAnnotation(this.height)),
          (this.height += this.pagePadding[3]),
          (this.height *= this.renderer.settings.display.scale);
      }
      _finalizeStaffSystem() {
        this._system.scaleToWidth(this._system.width),
          this._system.finalizeSystem();
      }
    };
  var fd = class extends Ns {
    constructor() {
      super(...arguments);
      this._systems = [];
      this._allMasterBarRenderers = [];
      this._barsFromPreviousSystem = [];
    }
    get name() {
      return "PageView";
    }
    doLayoutAndRender() {
      switch (this.renderer.settings.display.systemsLayoutMode) {
        case 0:
          this.systemsLayoutMode = 0;
          break;
        case 1:
          this.systemsLayoutMode = 1;
          break;
      }
      let e = this.pagePadding[1];
      (this.width = this.renderer.width),
        (this._allMasterBarRenderers = []),
        (e = this._layoutAndRenderScoreInfo(e, -1)),
        (e = this._layoutAndRenderTunings(e, -1)),
        (e = this._layoutAndRenderChordDiagrams(e, -1)),
        (e = this._layoutAndRenderScore(e)),
        (e = this.layoutAndRenderBottomScoreInfo(e)),
        (e = this.layoutAndRenderAnnotation(e)),
        (this.height =
          (e + this.pagePadding[3]) * this.renderer.settings.display.scale);
    }
    get supportsResize() {
      return !0;
    }
    get firstBarX() {
      let e = this.pagePadding[0];
      return (
        this._systems.length > 0 && (e += this._systems[0].accoladeWidth), e
      );
    }
    doResize() {
      let e = this.pagePadding[1];
      this.width = this.renderer.width;
      let r = this.height;
      (e = this._layoutAndRenderScoreInfo(e, r)),
        (e = this._layoutAndRenderTunings(e, r)),
        (e = this._layoutAndRenderChordDiagrams(e, r)),
        (e = this._resizeAndRenderScore(e, r)),
        (e = this.layoutAndRenderBottomScoreInfo(e)),
        (e = this.layoutAndRenderAnnotation(e)),
        (this.height =
          (e + this.pagePadding[3]) * this.renderer.settings.display.scale);
    }
    _layoutAndRenderTunings(e, r = -1) {
      if (!this.tuningGlyph) return e;
      let i = this.renderer.settings.display.resources;
      (this.tuningGlyph.x = this.pagePadding[0]),
        (this.tuningGlyph.width =
          this.scaledWidth - this.pagePadding[0] - this.pagePadding[2]),
        this.tuningGlyph.doLayout();
      let n = Math.round(this.tuningGlyph.height),
        s = new $t();
      return (
        (s.x = 0),
        (s.y = e),
        (s.width = this.scaledWidth),
        (s.height = n),
        (s.totalWidth = this.scaledWidth),
        (s.totalHeight = r < 0 ? e + s.height : r),
        this.registerPartial(s, (a) => {
          (a.color = i.scoreInfoColor),
            (a.textAlign = 1),
            this.tuningGlyph.paint(0, 0, a);
        }),
        e + n
      );
    }
    _layoutAndRenderChordDiagrams(e, r = -1) {
      if (!this.chordDiagrams) return e;
      let i = this.renderer.settings.display.resources;
      (this.chordDiagrams.x = this.pagePadding[0]),
        (this.chordDiagrams.width =
          this.scaledWidth - this.pagePadding[0] - this.pagePadding[2]),
        this.chordDiagrams.doLayout();
      let n = Math.round(this.chordDiagrams.height),
        s = new $t();
      return (
        (s.x = 0),
        (s.y = e),
        (s.width = this.scaledWidth),
        (s.height = n),
        (s.totalWidth = this.scaledWidth),
        (s.totalHeight = r < 0 ? e + n : r),
        this.registerPartial(s, (a) => {
          (a.color = i.scoreInfoColor),
            (a.textAlign = 1),
            this.chordDiagrams.paint(0, 0, a);
        }),
        e + n
      );
    }
    _layoutAndRenderScoreInfo(e, r = -1) {
      w.debug(this.name, "Layouting score info");
      let i = new $t();
      (i.x = 0), (i.y = e);
      let n = 0,
        s = this.renderer.settings.display.resources,
        a = [];
      for (let [o, l] of Ns.headerElements.value)
        if (this.headerGlyphs.has(o)) {
          let u = this.headerGlyphs.get(o);
          (u.y = n), this.alignScoreInfoGlyph(u);
          let c = u.font.size;
          o === 4 &&
            this.headerGlyphs.has(5) &&
            this.headerGlyphs.get(5).textAlign !== u.textAlign &&
            (c = 0),
            (n += c),
            a.push(u);
        }
      return (
        a.length > 0 &&
          ((n = Math.floor(n + 17)),
          (i.width = this.scaledWidth),
          (i.height = n),
          (i.totalWidth = this.scaledWidth),
          (i.totalHeight = r < 0 ? e + i.height : r),
          this.registerPartial(i, (o) => {
            (o.color = s.scoreInfoColor), (o.textAlign = 1);
            for (let l of a) l.paint(0, 0, o);
          })),
        e + n
      );
    }
    _resizeAndRenderScore(e, r) {
      if (
        this.renderer.settings.display.barsPerRow > 0 ||
        this.systemsLayoutMode === 1
      )
        for (let n = 0; n < this._systems.length; n++) {
          let s = this._systems[n];
          this._fitSystem(s), (e += this._paintSystem(s, r));
        }
      else {
        this._systems = [];
        let n = 0,
          s = this._maxWidth,
          a = this.createEmptyStaffSystem();
        for (
          a.index = this._systems.length, a.x = this.pagePadding[0], a.y = e;
          n < this._allMasterBarRenderers.length;

        ) {
          let o = this._allMasterBarRenderers[n];
          if (a.width + o.width <= s || a.masterBarsRenderers.length === 0)
            a.addMasterBarRenderers(this.renderer.tracks, o), n++;
          else {
            for (; o && !o.canWrap && a.masterBarsRenderers.length > 1; )
              (o = a.revertLastBar()), n--;
            (a.isFull = !0),
              (a.isLast = this.lastBarIndex === a.lastBarIndex),
              this._systems.push(a),
              this._fitSystem(a),
              (e += this._paintSystem(a, r)),
              (a = this.createEmptyStaffSystem()),
              (a.index = this._systems.length),
              (a.x = this.pagePadding[0]),
              (a.y = e);
          }
        }
        (a.isLast = this.lastBarIndex === a.lastBarIndex),
          this._fitSystem(a),
          (e += this._paintSystem(a, r));
      }
      return e;
    }
    _layoutAndRenderScore(e) {
      let i = this.firstBarIndex,
        n = this.lastBarIndex;
      for (this._systems = []; i <= n; ) {
        let s = this._createStaffSystem(i, n);
        this._systems.push(s),
          (s.x = this.pagePadding[0]),
          (s.y = e),
          (i = s.lastBarIndex + 1),
          this._fitSystem(s),
          w.debug(
            this.name,
            `Rendering partial from bar ${s.firstBarIndex} to ${s.lastBarIndex}`,
            null
          ),
          (e += this._paintSystem(s, e));
      }
      return e;
    }
    _paintSystem(e, r) {
      let i = Math.floor(e.height),
        n = new $t();
      return (
        (n.x = 0),
        (n.y = e.y),
        (n.totalWidth = this.scaledWidth),
        (n.totalHeight = r),
        (n.width = this.scaledWidth),
        (n.height = i),
        (n.firstMasterBarIndex = e.firstBarIndex),
        (n.lastMasterBarIndex = e.lastBarIndex),
        e.buildBoundingsLookup(0, 0),
        this.registerPartial(n, (s) => {
          (this.renderer.canvas.color =
            this.renderer.settings.display.resources.mainGlyphColor),
            (this.renderer.canvas.textAlign = 0),
            e.paint(0, -(n.y / this.renderer.settings.display.scale), s);
        }),
        i
      );
    }
    _fitSystem(e) {
      e.isFull ||
      e.width > this._maxWidth ||
      this.renderer.settings.display.justifyLastSystem
        ? e.scaleToWidth(this._maxWidth)
        : e.scaleToWidth(e.width),
        e.finalizeSystem();
    }
    _getBarsPerSystem(e) {
      let r = this.renderer.settings.display.barsPerRow;
      if (this.systemsLayoutMode === 1) {
        let i, n;
        this.renderer.tracks.length > 1
          ? ((i = this.renderer.score.defaultSystemsLayout),
            (n = this.renderer.score.systemsLayout))
          : ((i = this.renderer.tracks[0].defaultSystemsLayout),
            (n = this.renderer.tracks[0].systemsLayout)),
          (r = e < n.length ? n[e] : i);
      }
      return r;
    }
    _createStaffSystem(e, r) {
      let i = this.createEmptyStaffSystem();
      i.index = this._systems.length;
      let n = this._getBarsPerSystem(i.index),
        s = this._maxWidth,
        a = r + 1,
        o = e;
      for (; o < a; ) {
        if (this._barsFromPreviousSystem.length > 0)
          for (let d of this._barsFromPreviousSystem)
            i.addMasterBarRenderers(this.renderer.tracks, d),
              (o = d.lastMasterBarIndex);
        else {
          let d = this.multiBarRestInfo,
            h = d !== null && d.has(o) ? d.get(o) : null,
            f = i.addBars(this.renderer.tracks, o, h);
          this._allMasterBarRenderers.push(f), (o = f.lastMasterBarIndex);
        }
        this._barsFromPreviousSystem = [];
        let l = !1;
        if (
          (((n === -1 && i.width >= s && i.masterBarsRenderers.length !== 0) ||
            i.masterBarsRenderers.length === n + 1) &&
            (l = !0),
          l)
        ) {
          let d = i.revertLastBar();
          if (d)
            for (
              this._barsFromPreviousSystem.push(d);
              d && !d.canWrap && i.masterBarsRenderers.length > 1;

            )
              (d = i.revertLastBar()),
                d && this._barsFromPreviousSystem.push(d);
          return (
            (i.isFull = !0),
            (i.isLast = !1),
            this._barsFromPreviousSystem.reverse(),
            i
          );
        }
        let u = !1,
          c = !0;
        for (let d of this.renderer.tracks)
          d.lineBreaks && d.lineBreaks.has(o + 1) ? (u = !0) : (c = !1);
        if (u && c) return (i.isFull = !0), (i.isLast = !1), i;
        (i.x = 0), o++;
      }
      return (i.isLast = r === i.lastBarIndex), i;
    }
    get _maxWidth() {
      return this.scaledWidth - this.pagePadding[0] - this.pagePadding[2];
    }
  };
  var Ke = class extends ue {
    constructor(t, e, r) {
      super(t, e), (this.width = r);
    }
  };
  var tn = class extends ue {
      doLayout() {
        this.width = this.renderer.smuflMetrics.thinBarlineThickness;
      }
    },
    Cs = class extends tn {
      constructor(t, e, r) {
        super(t, e), (this._isRepeat = r);
      }
      doLayout() {
        this.width = this._isRepeat
          ? this.renderer.smuflMetrics.repeatEndingLineThickness
          : this.renderer.smuflMetrics.thinBarlineThickness;
      }
      paint(t, e, r) {
        r.fillRect(
          t + this.x,
          e + this.y,
          this.renderer.smuflMetrics.thinBarlineThickness,
          this.height
        );
      }
    },
    bh = class extends tn {
      paint(t, e, r) {
        let i = this.renderer.smuflMetrics.thinBarlineThickness / 2,
          n = this.renderer.getLineHeight(1),
          s = e + this.y + n * 0.5 + i,
          a = e + this.y + this.height;
        for (; s < a; ) r.fillCircle(t + this.x, s, i), (s += n);
      }
    },
    gh = class extends tn {
      paint(t, e, r) {
        let i = this.renderer.smuflMetrics.dashedBarlineDashLength,
          n = t + this.x - this.width / 2,
          s = Math.ceil(this.height / 2 / i),
          a = e + this.y + this.height,
          o = this.renderer.smuflMetrics.dashedBarlineGapLength,
          l = r.lineWidth;
        if (
          ((r.lineWidth = this.renderer.smuflMetrics.dashedBarlineThickness),
          r.beginPath(),
          s < 1)
        )
          r.moveTo(n, e + this.y), r.lineTo(n, a);
        else {
          let u = e + this.y;
          for (; u < a; ) {
            r.moveTo(n, u);
            let c = Math.min(a - u, i);
            r.lineTo(n, u + c), (u += i + o);
          }
        }
        r.stroke(), (r.lineWidth = l);
      }
    },
    Ms = class extends tn {
      doLayout() {
        this.width = this.renderer.smuflMetrics.thickBarlineThickness;
      }
      paint(t, e, r) {
        r.fillRect(t + this.x, e + this.y, this.width, this.height);
      }
    },
    bd = class extends tn {
      doLayout() {
        this.width = this.renderer.smuflMetrics.glyphWidths.get(57412);
      }
      paint(t, e, r) {
        let i = this.renderer,
          n = i.heightLineCount % 2 === 0 ? 1 : 0.5,
          s = e + this.y + this.height / 2,
          a = i.getLineHeight(n),
          o = i.smuflMetrics.glyphTop.get(57412),
          l = i.smuflMetrics.glyphHeights.get(57412),
          u = o - l / 2;
        ge.fillMusicFontSymbolSafe(r, t + this.x, s + u - a, 1, 57412),
          ge.fillMusicFontSymbolSafe(r, t + this.x, s + u + a, 1, 57412);
      }
    },
    yh = class extends tn {
      paint(t, e, r) {
        let i = this.renderer;
        if (i.drawnLineCount - 1 <= 2) return;
        let a = i.smuflMetrics.staffLineThickness / 2,
          o = (i.drawnLineCount - 1) / 2,
          l = i.getLineY(o - 1) - a,
          u = i.getLineY(o + 1) + a;
        r.fillRect(
          t + this.x,
          e + l,
          i.smuflMetrics.thinBarlineThickness,
          u - l
        );
      }
    },
    Sh = class extends tn {
      paint(t, e, r) {
        let n = this.renderer.getLineHeight(1),
          s = -(n / 2) + 1;
        r.fillRect(t + this.x, e + this.y + s, 1, n);
      }
    },
    Is = class extends ii {
      constructor(t) {
        super(), (this._isRight = t);
      }
      doLayout() {
        let t = this.renderer.bar,
          e = t.masterBar,
          r = this._isRight
            ? t.getActualBarLineRight()
            : t.getActualBarLineLeft(this.renderer.index === 0),
          i =
            (this._isRight && e.isRepeatEnd) ||
            (!this._isRight && e.isRepeatStart),
          n = 0;
        if (!this._isRight) {
          let c = this.renderer.previousRenderer;
          if (
            c &&
            c.staff === this.renderer.staff &&
            ((n = c.bar.getActualBarLineRight()), r === n)
          )
            return;
        }
        switch (
          (this._isRight &&
            e.isRepeatEnd &&
            (this.addGlyph(new bd(0, 0)),
            (this.width +=
              this.renderer.smuflMetrics.repeatBarlineDotSeparation)),
          r)
        ) {
          case 1:
            this.addGlyph(new gh(0, 0));
            break;
          case 2:
            this.addGlyph(new bh(0, 0));
            break;
          case 3:
            n !== 6 && n !== 4 && this.addGlyph(new Ms(0, 0));
            break;
          case 4:
            n !== 6 && n !== 3 && this.addGlyph(new Ms(0, 0)),
              (this.width += this.renderer.smuflMetrics.barlineSeparation),
              this.addGlyph(new Ms(0, 0));
            break;
          case 5:
            n !== 6 && n !== 3 && n !== 4 && this.addGlyph(new Ms(0, 0)),
              (this.width +=
                this.renderer.smuflMetrics.thinThickBarlineSeparation),
              this.addGlyph(new Cs(0, 0, i));
            break;
          case 6:
            n !== 5 && n !== 9 && n !== 7 && this.addGlyph(new Cs(0, 0, i)),
              (this.width +=
                this.renderer.smuflMetrics.thinThickBarlineSeparation),
              this.addGlyph(new Ms(0, 0));
            break;
          case 7:
            n !== 5 && n !== 9 && this.addGlyph(new Cs(0, 0, i)),
              (this.width += this.renderer.smuflMetrics.barlineSeparation),
              this.addGlyph(new Cs(0, 0, i));
            break;
          case 8:
            break;
          case 9:
            n !== 5 && n !== 7 && this.addGlyph(new Cs(0, 0, i));
            break;
          case 10:
            this.addGlyph(new yh(0, 0));
            break;
          case 11:
            this.addGlyph(new Sh(0, 0));
            break;
        }
        this._isRight ||
          (e.isRepeatStart &&
            ((this.width +=
              this.renderer.smuflMetrics.repeatBarlineDotSeparation),
            this.addGlyph(new bd(0, 0))));
        let s = this.renderer,
          a = s.smuflMetrics.staffLineThickness,
          o = this.y + s.topPadding - a,
          u = this.y + this.renderer.height - this.renderer.bottomPadding - o;
        for (let c of this.glyphs) (c.y = o), (c.height = u);
      }
      paint(t, e, r) {
        var s = [];
        try {
          let i = this.renderer;
          let n = j(s, $.bar(r, i.barLineBarSubElement, this.renderer.bar, !0));
          super.paint(t, e, r);
        } catch (a) {
          var o = a,
            l = !0;
        } finally {
          ee(s, o, l);
        }
      }
    };
  var gd = class extends ue {
    constructor(e, r, i) {
      super(e, r);
      this._count = 0;
      (this._count = 0), (this._count = i);
    }
    doLayout() {
      this.width = 0;
    }
    paint(e, r, i) {
      var u = [];
      try {
        let n = j(
          u,
          $.bar(i, this.renderer.repeatsBarSubElement, this.renderer.bar)
        );
        let s = this.renderer.resources;
        let a = i.textAlign;
        i.font = s.barNumberFont;
        i.textAlign = 2;
        let o = `x${this._count}`;
        let l = i.measureText(o).width / 1.5;
        i.fillText(o, e + this.x - l, r + this.y);
        i.textAlign = a;
      } catch (c) {
        var d = c,
          h = !0;
      } finally {
        ee(u, d, h);
      }
    }
  };
  var $a = class extends ue {
    constructor(t, e, r) {
      super(t, e), (this._number = `${r}  `);
    }
    doLayout() {
      (this.renderer.scoreRenderer.canvas.font =
        this.renderer.resources.barNumberFont),
        (this.width = this.renderer.scoreRenderer.canvas.measureText(
          this._number
        ).width);
    }
    paint(t, e, r) {
      var a = [];
      try {
        if (!this.renderer.staff.isFirstInSystem) return;
        let i = j(
          a,
          $.bar(r, this.renderer.barNumberBarSubElement, this.renderer.bar, !0)
        );
        let n = this.renderer.resources;
        let s = r.textBaseline;
        r.textBaseline = 0;
        r.font = n.barNumberFont;
        r.fillText(this._number, t + this.x, e + this.y);
        r.textBaseline = s;
      } catch (o) {
        var l = o,
          u = !0;
      } finally {
        ee(a, l, u);
      }
    }
  };
  var Fi = class p extends ji {
    constructor() {
      super(...arguments);
      this.firstLineY = 0;
      this._startSpacing = !1;
      this.tupletSize = 0;
    }
    get lineOffset() {
      return this.lineSpacing;
    }
    get tupletOffset() {
      return this.smuflMetrics.oneStaffSpace * 0.5;
    }
    get topGlyphOverflow() {
      return this.smuflMetrics.oneStaffSpace;
    }
    get bottomGlyphOverflow() {
      return this.smuflMetrics.oneStaffSpace;
    }
    initLineBasedSizes() {
      (this.topPadding = this.topGlyphOverflow),
        (this.bottomPadding = this.bottomGlyphOverflow),
        (this.height =
          this.lineOffset * (this.heightLineCount - 1) +
          this.topPadding +
          this.bottomPadding);
    }
    updateSizes() {
      this.initLineBasedSizes(),
        this.adjustSizes(),
        this.updateFirstLineY(),
        super.updateSizes();
    }
    adjustSizes() {}
    updateFirstLineY() {
      let e = this.lineOffset * (this.heightLineCount - 1),
        r = (this.drawnLineCount - 1) * this.lineOffset,
        i = this.smuflMetrics.staffLineThickness / 2;
      this.firstLineY = ((this.topPadding + (e - r) / 2) | 0) - i;
    }
    doLayout() {
      this.initLineBasedSizes(),
        this.updateFirstLineY(),
        (this.tupletSize = this.smuflMetrics.glyphHeights.get(59520)),
        super.doLayout();
    }
    getLineY(e) {
      return this.firstLineY + this.getLineHeight(e);
    }
    getLineHeight(e) {
      return this.lineOffset * e;
    }
    paintBackground(e, r, i) {
      super.paintBackground(e, r, i),
        this.paintStaffLines(e, r, i),
        this.paintSimileMark(e, r, i);
    }
    paintStaffLines(e, r, i) {
      var l = [];
      try {
        let n = j(l, $.bar(i, this.staffLineBarSubElement, this.bar, !0));
        let s = [];
        for (let h = 0, f = this.drawnLineCount; h < f; h++) s.push([]);
        this.additionalMultiRestBars || this.collectSpaces(s);
        for (let h of s)
          h.sort((f, b) => (f[0] > b[0] ? 1 : f[0] < b[0] ? -1 : 0));
        let a = this.width;
        let o = this.smuflMetrics.staffLineThickness / 2;
        for (let h = 0; h < this.drawnLineCount; h++) {
          let f = this.getLineY(h) - o,
            b = 0;
          for (let y of s[h])
            i.fillRect(
              e + this.x + b,
              r + this.y + f,
              y[0] - b,
              this.smuflMetrics.staffLineThickness
            ),
              (b = y[0] + y[1]);
          i.fillRect(
            e + this.x + b,
            r + this.y + f,
            a - b,
            this.smuflMetrics.staffLineThickness
          );
        }
      } catch (u) {
        var c = u,
          d = !0;
      } finally {
        ee(l, c, d);
      }
    }
    collectSpaces(e) {}
    createStartSpacing() {
      if (this._startSpacing) return;
      let e =
        this.index === 0
          ? this.settings.display.firstStaffPaddingLeft
          : this.settings.display.staffPaddingLeft;
      this.addPreBeatGlyph(new Ke(0, 0, e)), (this._startSpacing = !0);
    }
    paintTuplets(e, r, i, n, s = !1) {
      for (let a of this.bar.voices)
        if (this.hasVoiceContainer(a)) {
          let o = this.getVoiceContainer(a);
          for (let l of o.tupletGroups)
            this._paintTupletHelper(e + this.beatGlyphsStart, r, i, l, n, s);
        }
    }
    getTupletBeamDirection(e) {
      return this.getBeamDirection(e);
    }
    _paintTupletHelper(e, r, i, n, s, a) {
      var k = [];
      try {
        let o = this.resources;
        let l = i.textAlign;
        let u = i.textBaseline;
        i.color =
          n.voice.index === 0
            ? this.resources.mainGlyphColor
            : this.resources.secondaryGlyphColor;
        i.textAlign = 1;
        i.textBaseline = 1;
        let c;
        let d = n.beats[0].tupletNumerator;
        let h = n.beats[0].tupletDenominator;
        if (d === 2 && h === 3) c = [59522];
        else if (d === 3 && h === 2) c = [59523];
        else if (d === 4 && h === 6) c = [59524];
        else if (d === 5 && h === 4) c = [59525];
        else if (d === 6 && h === 4) c = [59526];
        else if (d === 7 && h === 4) c = [59527];
        else if (d === 9 && h === 8) c = [59529];
        else if (d === 10 && h === 8) c = [59521, 59520];
        else if (d === 11 && h === 8) c = [59521, 59521];
        else if (d === 12 && h === 8) c = [59521, 59522];
        else if (d === 13 && h === 8) c = [59521, 59523];
        else {
          c = [];
          let R = 59520;
          d > 10
            ? (c.push(R + Math.floor(d / 10)), c.push(R + (d - 10)))
            : c.push(R + d),
            c.push(59530),
            h > 10
              ? (c.push(R + Math.floor(h / 10)), c.push(R + (h - 10)))
              : c.push(R + h);
        }
        let f = this.tupletOffset;
        let b = this.tupletSize;
        let y = j(k, $.beat(i, s, n.beats[0]));
        let S = i.lineWidth;
        i.lineWidth = this.smuflMetrics.tupletBracketThickness;
        if (n.beats.length === 1 || !n.isFull)
          for (let R of n.beats) {
            let g = this.helpers.beamHelperLookup[n.voice.index].get(R.index);
            if (!g) continue;
            let x = this.getTupletBeamDirection(g),
              M = g.getBeatLineX(R),
              P = this.calculateBeamYWithDirection(g, M, x);
            x === 1 ? (P += f + b) : (P -= f + b),
              i.fillMusicFontSymbols(e + this.x + M, r + this.y + P, 1, c, !0);
          }
        else {
          let R = n.beats[0],
            g = n.beats[n.beats.length - 1],
            x = null,
            M = null;
          for (let li = 0; li < n.beats.length; li++)
            if (!n.beats[li].isRest) {
              x = n.beats[li];
              break;
            }
          for (let li = n.beats.length - 1; li >= 0; li--)
            if (!n.beats[li].isRest) {
              M = n.beats[li];
              break;
            }
          let P = !1;
          x || ((x = R), (P = !0)), M || (M = g);
          let H = this.getBeatX(R, 1) - this.beatGlyphsStart,
            X = this.getBeatX(g, 4) - this.beatGlyphsStart,
            fe = this.helpers.beamHelperLookup[n.voice.index].get(x.index),
            Ee = this.helpers.beamHelperLookup[n.voice.index].get(M.index),
            be = this.getTupletBeamDirection(fe),
            Ae = this.calculateBeamYWithDirection(fe, H, be),
            U = this.calculateBeamYWithDirection(Ee, X, be);
          P && ((Ae = Math.max(Ae, U)), (U = Ae));
          let sr = f + b * 0.5;
          be === 1 ? ((Ae += sr), (U += sr)) : ((Ae -= sr), (U -= sr));
          let wt = c.reduce(
              (li, Xh) => li + o.engravingSettings.glyphWidths.get(Xh),
              0
            ),
            Nt = o.engravingSettings.oneStaffSpace * 0.5,
            Re = (H + X) / 2,
            Pr = Re - wt / 2 - Nt,
            Et = Re + wt / 2 + Nt,
            nt = (U - Ae) / (X - H),
            fp = Ae - nt * H,
            bp = nt * Pr + fp,
            Uh = nt * Re + fp,
            Dh = nt * Et + fp,
            zh = be === 1 ? Ae - b * 0.5 : Ae + b * 0.5,
            Fh = be === 1 ? U - b * 0.5 : U + b * 0.5,
            Rh = i.lineWidth % 2 === 0 ? 0 : 0.5;
          (e += Rh),
            (r += Rh),
            Pr > H &&
              (i.beginPath(),
              i.moveTo(e + this.x + H, r + this.y + zh),
              a
                ? i.quadraticCurveTo(
                    e + this.x + (Pr + H) / 2,
                    r + this.y + bp,
                    e + this.x + Pr,
                    r + this.y + bp
                  )
                : (i.lineTo(e + this.x + H, r + this.y + Ae),
                  i.lineTo(e + this.x + Pr, r + this.y + bp)),
              i.moveTo(e + this.x + Et, r + this.y + Dh),
              a
                ? i.quadraticCurveTo(
                    e + this.x + (X + Et) / 2,
                    r + this.y + Dh,
                    e + this.x + X,
                    r + this.y + Fh
                  )
                : (i.lineTo(e + this.x + X, r + this.y + U),
                  i.lineTo(e + this.x + X, r + this.y + Fh)),
              i.stroke()),
            i.fillMusicFontSymbols(
              e + this.x + Re,
              r + this.y + Uh + b * 0.5,
              1,
              c,
              !0
            );
        }
        i.textAlign = l;
        i.textBaseline = u;
        i.lineWidth = S;
      } catch (T) {
        var O = T,
          N = !0;
      } finally {
        ee(k, O, N);
      }
    }
    paintBeams(e, r, i, n, s) {
      for (let a of this.helpers.beamHelpers)
        for (let o of a)
          this._paintBeamHelper(e + this.beatGlyphsStart, r, i, o, n, s);
    }
    drawBeamHelperAsFlags(e) {
      return e.beats.length === 1;
    }
    _paintBeamHelper(e, r, i, n, s, a) {
      (i.color =
        n.voice.index === 0
          ? this.resources.mainGlyphColor
          : this.resources.secondaryGlyphColor),
        (this.drawBeamHelperAsFlags(n)
            ? this.paintFlag(e, r, i, n, s)
            : this.paintBar(e, r, i, n, a));
    }
    shouldPaintFlag(e, r) {
      return !(
        e.graceType === 3 ||
        e.deadSlapped ||
        !r.hasBeatLineX(e) ||
        (e.graceType !== 0 && this.settings.notation.notationMode === 1) ||
        e.duration === 1 ||
        e.duration === -2 ||
        e.duration === -4
      );
    }
    paintFlag(e, r, i, n, s) {
      for (let c of n.beats) {
        var a = [];
        try {
          if (!this.shouldPaintFlag(c, n)) continue;
          let d = c.graceType !== 0;
          let h = n.getBeatLineX(c);
          let f = this.getBeamDirection(n);
          let b = r + this.y + this.getFlagTopY(c, f);
          let y = r + this.y + this.getFlagBottomY(c, f);
          let S = 0;
          f === 1 ? (S = y) : (S = b);
          if (!n.hasLine(!0, c)) continue;
          this.paintBeamingStem(c, r + this.y, e + this.x + h, b, y, i);
          let k = j(a, $.beat(i, s, c));
          let T = 0;
          if (n.hasFlag(!0, c)) {
            let O = new Pa(e + this.x + h, S, c.duration, f, d);
            (O.renderer = this),
              O.doLayout(),
              O.paint(0, 0, i),
              (T = O.width / 2);
          }
          c.graceType === 2 &&
            (f === 1
              ? ge.fillMusicFontSymbolSafe(
                  i,
                  e + this.x + h + T / 2,
                  (b + y - this.smuflMetrics.glyphHeights.get(58725)) / 2,
                  ie.GraceScale,
                  58725,
                  !0
                )
              : ge.fillMusicFontSymbolSafe(
                  i,
                  e + this.x + h + T / 2,
                  (b + y + this.smuflMetrics.glyphHeights.get(58724)) / 2,
                  ie.GraceScale,
                  58724,
                  !0
                ));
        } catch (o) {
          var l = o,
            u = !0;
        } finally {
          ee(a, l, u);
        }
      }
    }
    getFlagStemSize(e, r = !1) {
      let i = 0;
      switch (e) {
        case -4:
        case 2:
        case 4:
        case 8:
        case 16:
        case 32:
        case 64:
        case 128:
        case 256:
          i =
            this.smuflMetrics.standardStemLength +
            this.smuflMetrics.stemFlagOffsets.get(e);
          break;
        default:
          i = r ? this.smuflMetrics.standardStemLength : 0;
          break;
      }
      return i;
    }
    recreatePreBeatGlyphs() {
      (this._startSpacing = !1), super.recreatePreBeatGlyphs();
    }
    calculateBeamY(e, r) {
      return this.calculateBeamYWithDirection(e, r, this.getBeamDirection(e));
    }
    createPreBeatGlyphs() {
      super.createPreBeatGlyphs(),
        this.addPreBeatGlyph(new Is(!1)),
        this.createLinePreBeatGlyphs(),
        this.addPreBeatGlyph(
          new $a(0, this.getLineHeight(-0.25), this.bar.index + 1)
        );
    }
    createPostBeatGlyphs() {
      super.createPostBeatGlyphs();
      let e = this.lastBar;
      this.addPostBeatGlyph(new Is(!0)),
        e.masterBar.isRepeatEnd &&
          e.masterBar.repeatCount > 2 &&
          this.addPostBeatGlyph(
            new gd(0, this.getLineHeight(-0.25), this.bar.masterBar.repeatCount)
          );
    }
    paintBar(e, r, i, n, s) {
      let a = this.getBeamDirection(n),
        l = n.graceType !== 0 ? ie.GraceScale : 1,
        u =
          (this.smuflMetrics.beamSpacing + this.smuflMetrics.beamThickness) * l,
        c = this.smuflMetrics.beamThickness * l;
      a === 1 && ((u = -u), (c = -c));
      for (let y = 0, S = n.beats.length; y < S; y++) {
        var d = [];
        try {
          let k = n.beats[y];
          if (!n.hasBeatLineX(k) || k.deadSlapped) continue;
          let T = n.getBeatLineX(k);
          let O = r + this.y + this.getBarLineStart(k, a);
          let N = (r + this.y + this.calculateBeamY(n, T)) | 0;
          O < N
            ? this.paintBeamingStem(k, r + this.y, e + this.x + T, O, N, i)
            : this.paintBeamingStem(k, r + this.y, e + this.x + T, N, O, i);
          let R = j(d, $.beat(i, s, k));
          let g = this.smuflMetrics.brokenBeamWidth * l;
          let x = A.getIndex(k.duration) - 2;
          let M = r + this.y;
          for (let P = 0; P < x; P++) {
            let H = 0,
              X = 0,
              fe = 0,
              Ee = 0,
              be = M + P * u;
            if (y < n.beats.length - 1) {
              let Ae = ni.isFullBarJoin(k, n.beats[y + 1], P);
              if (P === x - 1 && Ae && k.beamingMode === 3)
                (H = T),
                  (X = H + g),
                  (fe = be + this.calculateBeamY(n, H)),
                  (Ee = be + this.calculateBeamY(n, X)),
                  p.paintSingleBar(
                    i,
                    e + this.x + H,
                    fe,
                    e + this.x + X,
                    Ee,
                    c
                  ),
                  (X = n.getBeatLineX(n.beats[y + 1])),
                  (H = X - g),
                  (fe = be + this.calculateBeamY(n, H)),
                  (Ee = be + this.calculateBeamY(n, X)),
                  p.paintSingleBar(
                    i,
                    e + this.x + H,
                    fe,
                    e + this.x + X,
                    Ee,
                    c
                  );
              else {
                if (Ae) (H = T), (X = n.getBeatLineX(n.beats[y + 1]));
                else if (y === 0 || !ni.isFullBarJoin(n.beats[y - 1], k, P))
                  (H = T), (X = H + g);
                else continue;
                (fe = be + this.calculateBeamY(n, H)),
                  (Ee = be + this.calculateBeamY(n, X)),
                  P === 0 && ((fe = fe | 0), (Ee = Ee | 0)),
                  p.paintSingleBar(
                    i,
                    e + this.x + H,
                    fe,
                    e + this.x + X,
                    Ee,
                    c
                  );
              }
            } else
              y > 0 &&
                !ni.isFullBarJoin(k, n.beats[y - 1], P) &&
                ((H = T - g),
                (X = T),
                (X = T),
                (fe = be + this.calculateBeamY(n, H)),
                (Ee = be + this.calculateBeamY(n, X)),
                p.paintSingleBar(i, e + this.x + H, fe, e + this.x + X, Ee, c));
          }
        } catch (h) {
          var f = h,
            b = !0;
        } finally {
          ee(d, f, b);
        }
      }
      if (n.graceType === 2) {
        let y = n.getBeatLineX(n.beats[0]),
          S = this.smuflMetrics.glyphWidths.get(57920) * ie.GraceScale,
          k = (r + this.y + this.calculateBeamY(n, y)) | 0;
        (k += c + u),
          a === 1
            ? ge.fillMusicFontSymbolSafe(
                i,
                e + this.x + y + S / 2,
                k,
                ie.GraceScale,
                58725,
                !0
              )
            : ge.fillMusicFontSymbolSafe(
                i,
                e + this.x + y + S / 2,
                k,
                ie.GraceScale,
                58724,
                !0
              );
      }
    }
    static paintSingleBar(e, r, i, n, s, a) {
      e.beginPath(),
        e.moveTo(r, i),
        e.lineTo(n, s),
        e.lineTo(n, s + a),
        e.lineTo(r, i + a),
        e.closePath(),
        e.fill();
    }
  };
  var et = class p extends ue {
    constructor(e, r, i) {
      super(0, 0);
      this.yOffset = 0;
      this.startNoteRenderer = null;
      this.endNoteRenderer = null;
      this.tieDirection = 0;
      this._startX = 0;
      this._startY = 0;
      this._endX = 0;
      this._endY = 0;
      this._tieHeight = 0;
      this._shouldDraw = !1;
      (this.startBeat = e), (this.endBeat = r), (this.forEnd = i);
    }
    doLayout() {
      if (((this.width = 0), !this.endBeat)) {
        this._shouldDraw = !1;
        return;
      }
      let e = this.renderer.scoreRenderer.layout.getRendererForBar(
        this.renderer.staff.staffId,
        this.startBeat.voice.bar
      );
      this.startNoteRenderer = e;
      let r = this.renderer.scoreRenderer.layout.getRendererForBar(
        this.renderer.staff.staffId,
        this.endBeat.voice.bar
      );
      if (
        ((this.endNoteRenderer = r),
        (this._startX = 0),
        (this._endX = 0),
        (this._startY = 0),
        (this._endY = 0),
        (this.height = 0),
        (this._shouldDraw = !1),
        (this.tieDirection = e
          ? this.getBeamDirection(this.startBeat, e)
          : this.getBeamDirection(this.endBeat, r)),
        !this.forEnd && e
          ? (e !== r
              ? ((this._startX = e.x + this.getStartX()),
                (this._startY = e.y + this.getStartY() + this.yOffset),
                !r || e.staff !== r.staff
                  ? ((this._endX = e.x + e.width), (this._endY = this._startY))
                  : ((this._endX = r.x + this.getEndX()),
                    (this._endY = r.y + this.getEndY() + this.yOffset)))
              : ((this._startX = e.x + this.getStartX()),
                (this._endX = r.x + this.getEndX()),
                (this._startY = e.y + this.getStartY() + this.yOffset),
                (this._endY = r.y + this.getEndY() + this.yOffset)),
            (this._shouldDraw = !0))
          : (!e || e.staff !== r.staff) &&
            ((this._startX = r.x),
            (this._endX = r.x + this.getEndX()),
            (this._startY = r.y + this.getEndY() + this.yOffset),
            (this._endY = this._startY),
            (this._shouldDraw = !0)),
        this._shouldDraw)
      )
        if (
          ((this.y = Math.min(this._startY, this._endY)),
          this.shouldDrawBendSlur())
        )
          this._tieHeight = 0;
        else {
          this._tieHeight = this.getTieHeight(
            this._startX,
            this._startY,
            this._endX,
            this._endY
          );
          let i = p.calculateActualTieHeight(
            1,
            this._startX,
            this._startY,
            this._endX,
            this._endY,
            this.tieDirection === 1,
            this._tieHeight,
            this.renderer.smuflMetrics.tieMidpointThickness
          );
          if (((this.height = i.h), this.tieDirection === 0)) {
            let n = this.y - i.y;
            n > 0 && (this.y -= n);
          }
        }
    }
    paint(e, r, i) {
      this._shouldDraw &&
        (this.shouldDrawBendSlur()
          ? p.drawBendSlur(
              i,
              e + this._startX,
              r + this._startY,
              e + this._endX,
              r + this._endY,
              this.tieDirection === 1,
              1,
              this.renderer.smuflMetrics.tieHeight
            )
          : p.paintTie(
              i,
              1,
              e + this._startX,
              r + this._startY,
              e + this._endX,
              r + this._endY,
              this.tieDirection === 1,
              this._tieHeight,
              this.renderer.smuflMetrics.tieMidpointThickness
            ));
    }
    shouldDrawBendSlur() {
      return !1;
    }
    getTieHeight(e, r, i, n) {
      return this.renderer.smuflMetrics.tieHeight;
    }
    getBeamDirection(e, r) {
      return 1;
    }
    getStartY() {
      return 0;
    }
    getEndY() {
      return 0;
    }
    getStartX() {
      return 0;
    }
    getEndX() {
      return 0;
    }
    static calculateActualTieHeight(e, r, i, n, s, a, o, l) {
      let u = p._computeBezierControlPoints(e, r, i, n, s, a, o, l);
      if (u.length < 8) {
        let R = new we();
        return (R.x = r), (R.y = i), (R.w = 0), (R.h = 0), R;
      }
      (r = u[0]), (i = u[1]);
      let c = u[2],
        d = u[3];
      (n = u[6]), (s = u[7]);
      let h = (r - c) / (r - 2 * c + n),
        f = p._calculateExtrema(r, i, c, d, n, s, h),
        b = f.length > 0 ? Math.min(r, n, f[0]) : Math.min(r, n),
        y = f.length > 0 ? Math.max(r, n, f[0]) : Math.max(r, n),
        S = (i - d) / (i - 2 * d + s),
        k = p._calculateExtrema(r, i, c, d, n, s, S),
        T = k.length > 0 ? Math.min(i, s, k[1]) : Math.min(i, s),
        O = k.length > 0 ? Math.max(i, s, k[1]) : Math.max(i, s),
        N = new we();
      return (N.x = b), (N.y = T), (N.w = y - b), (N.h = O - T), N;
    }
    static _calculateExtrema(e, r, i, n, s, a, o) {
      if (o <= 0 || 1 <= o) return [];
      let l = e + (i - e) * o,
        u = r + (n - r) * o,
        c = i + (s - i) * o,
        d = n + (a - n) * o;
      return [l + (c - l) * o, u + (d - u) * o];
    }
    static _computeBezierControlPoints(e, r, i, n, s, a, o, l) {
      if ((r === n && i === s) || isNaN(o) || isNaN(l) || isNaN(e)) return [];
      if (n < r) {
        let R = r;
        (r = n), (n = R), (R = i), (i = s), (s = R);
      }
      (o *= e), (l *= e), a && ((o *= -1), (l *= -1)), e >= 1 && (l *= 1.2);
      let u = s - i,
        c = n - r,
        d = Math.sqrt(c * c + u * u),
        h = r + d * 0.25,
        f = i - o,
        b = r + d * 0.75,
        y = i - o,
        S = r + d * 0.75,
        k = i - o - l,
        T = r + d * 0.25,
        O = i - o - l,
        N = Math.atan2(u, c);
      return (
        ([h, f] = p._rotate(h, f, r, i, N)),
        ([b, y] = p._rotate(b, y, r, i, N)),
        ([S, k] = p._rotate(S, k, r, i, N)),
        ([T, O] = p._rotate(T, O, r, i, N)),
        [r, i, h, f, b, y, n, s, S, k, T, O, r, i]
      );
    }
    static _rotate(e, r, i, n, s) {
      let a = e - i,
        o = r - n,
        l = a * Math.cos(s) - o * Math.sin(s),
        u = a * Math.sin(s) + o * Math.cos(s);
      return [i + l, n + u];
    }
    static paintTie(e, r, i, n, s, a, o, l, u) {
      let c = p._computeBezierControlPoints(r, i, n, s, a, o, l, u);
      c.length < 14 ||
        c.some((h) => isNaN(h)) ||
        (e.beginPath(),
        e.moveTo(c[0], c[1]),
        e.bezierCurveTo(c[2], c[3], c[4], c[5], c[6], c[7]),
        e.bezierCurveTo(c[8], c[9], c[10], c[11], c[12], c[13]),
        e.closePath(),
        e.fill());
    }
    static drawBendSlur(e, r, i, n, s, a, o, l, u) {
      let c = s - i,
        d = n - r,
        h = Math.sqrt(c * c + d * d);
      if (h < 1e-4) return;
      a ? (c *= -1) : (d *= -1), (c /= h), (d /= h);
      let f = (n + r) / 2,
        b = (s + i) / 2,
        y = l * o;
      n - r < 20 && (y /= 2);
      let S = f + y * c,
        k = b + y * d;
      if (
        (e.beginPath(),
        e.moveTo(r, i),
        e.lineTo(S, k),
        e.lineTo(n, s),
        e.stroke(),
        u)
      ) {
        let T = e.measureText(u).width,
          O = a ? 0 : -e.font.size;
        e.fillText(u, S - T / 2, k + O);
      }
    }
  };
  var Ka = class extends et {
    constructor(t, e, r = !1) {
      super(t ? t.beat : null, e ? e.beat : null, r),
        (this.startNote = t),
        (this.endNote = e);
    }
    get _isLeftHandTap() {
      return this.startNote === this.endNote;
    }
    shouldDrawBendSlur() {
      return (
        this.renderer.settings.notation.extendBendArrowsOnTiedNotes &&
        !!this.startNote.bendOrigin &&
        this.startNote.isTieOrigin
      );
    }
    doLayout() {
      super.doLayout();
    }
    getBeamDirection(t, e) {
      return 0;
    }
    getStartY() {
      return this.startNoteRenderer.getNoteY(this.startNote, 1);
    }
    getEndY() {
      return this.getStartY();
    }
    getStartX() {
      return this._isLeftHandTap
        ? this.getEndX() -
            this.startNoteRenderer.smuflMetrics.leftHandTabTieWidth
        : this.startNoteRenderer.getNoteX(this.startNote, 1);
    }
    getEndX() {
      return this._isLeftHandTap
        ? this.endNoteRenderer.getNoteX(this.endNote, 0)
        : this.endNoteRenderer.getNoteX(this.endNote, 1);
    }
  };
  var Kd = class extends Ka {
    paint(t, e, r) {
      if (!this._shouldDraw) return;
      if (this.shouldDrawBendSlur()) {
        et.drawBendSlur(
          r,
          t + this._startX,
          e + this._startY,
          t + this._endX,
          e + this._endY,
          this.tieDirection === 1,
          1,
          this.renderer.smuflMetrics.tieHeight
        );
        return;
      }
      let i = et._computeBezierControlPoints(
        1,
        t + this._startX,
        e + this._startY,
        t + this._endX,
        e + this._endY,
        this.tieDirection === 1,
        this._tieHeight,
        this.renderer.smuflMetrics.tieMidpointThickness
      );
      if (i.length < 14 || i.some((n) => isNaN(n))) return;
      let n1 = (i[1] + i[3] + i[5] + i[7]) / 4;
      let n2 = (i[7] + i[9] + i[11] + i[13]) / 4;
      let s = r.lineWidth;
      r.lineWidth = 1;
      r.beginPath();
      if (n1 <= n2) {
        r.moveTo(i[0], i[1]);
        r.bezierCurveTo(i[2], i[3], i[4], i[5], i[6], i[7]);
      } else {
        r.moveTo(i[6], i[7]);
        r.bezierCurveTo(i[8], i[9], i[10], i[11], i[12], i[13]);
      }
      r.stroke();
      r.lineWidth = s;
    }
  };
  var ai = class p extends et {
    constructor(t, e, r = !1) {
      super(t.beat, e.beat, r), (this.startNote = t), (this.endNote = e);
    }
    get _isLeftHandTap() {
      return this.startNote === this.endNote;
    }
    getTieHeight(t, e, r, i) {
      return this._isLeftHandTap
        ? this.startNoteRenderer.smuflMetrics.tieHeight
        : super.getTieHeight(t, e, r, i);
    }
    getBeamDirection(t, e) {
      return this._isLeftHandTap
        ? 0
        : p.getBeamDirectionForNote(this.startNote);
    }
    static getBeamDirectionForNote(t) {
      return t.string > 3 ? 0 : 1;
    }
    getStartY() {
      return this._isLeftHandTap
        ? this.startNoteRenderer.getNoteY(this.startNote, 2)
        : this.tieDirection === 0
        ? this.startNoteRenderer.getNoteY(this.startNote, 1)
        : this.startNoteRenderer.getNoteY(this.startNote, 3);
    }
    getEndY() {
      return this.getStartY();
    }
    getStartX() {
      if (this._isLeftHandTap) {
        let t = this.renderer.smuflMetrics.leftHandTabTieWidth || 0;
        return this.getEndX() - t;
      }
      return this.startNoteRenderer.getNoteX(this.startNote, 1);
    }
    getEndX() {
      return this._isLeftHandTap
        ? this.endNoteRenderer.getNoteX(this.endNote, 0)
        : this.endNoteRenderer.getNoteX(this.endNote, 1);
    }
  };
  var Fl = class extends ai {
    constructor(t, e, r, i = !1) {
      super(t, e, i), (this._direction = 0), (this._forSlide = r);
    }
    getTieHeight(t, e, r, i) {
      return (
        (Math.log(r - t + 1) * this.renderer.settings.notation.slurHeight) / 2
      );
    }
    tryExpand(t, e, r, i) {
      if (
        this._forSlide !== r ||
        this.forEnd !== i ||
        this.startNote.beat.id !== t.beat.id ||
        this.endNote.beat.id !== e.beat.id
      )
        return !1;
      switch (this._direction) {
        case 0:
          t.realValue > this.startNote.realValue &&
            ((this.startNote = t), (this.startBeat = t.beat)),
            e.realValue > this.endNote.realValue &&
              ((this.endNote = e), (this.endBeat = e.beat));
          break;
        case 1:
          t.realValue < this.startNote.realValue &&
            ((this.startNote = t), (this.startBeat = t.beat)),
            e.realValue < this.endNote.realValue &&
              ((this.endNote = e), (this.endBeat = e.beat));
          break;
      }
      return !0;
    }
    paint(t, e, r) {
      let i = this.renderer.scoreRenderer.layout.getRendererForBar(
          this.renderer.staff.staffId,
          this.startBeat.voice.bar
        ),
        n = this.getBeamDirection(this.startBeat, i),
        s = `numbered.slur.${this.startNote.beat.id}.${this.endNote.beat.id}.${n}`,
        a = this.renderer;
      a.staff.getSharedLayoutData(s, !1) ||
        (a.staff.setSharedLayoutData(s, !0), super.paint(t, e, r));
    }
  };
  var yd = class extends ft {
    constructor() {
      super(...arguments);
      this._effectSlurs = [];
    }
    createTies(e) {
      if (e.isVisible) {
        if (e.isTieOrigin && e.tieDestination.isVisible) {
          let r = new Ka(e, e.tieDestination, !1);
          this.addTie(r);
        }
        if (e.isTieDestination) {
          let r = new Ka(e.tieOrigin, e, !0);
          this.addTie(r);
        }
        if (e.isLeftHandTapped && !e.isHammerPullDestination) {
          let r = new Ka(e, e, !1);
          this.addTie(r);
        }
        if (e.isEffectSlurOrigin && e.effectSlurDestination) {
          let r = !1;
          let forSlide = e.slideOutType === 2;
          for (let i of this._effectSlurs)
            if (i.tryExpand(e, e.effectSlurDestination, forSlide, !1)) {
              r = !0;
              break;
            }
          if (!r) {
            let i = new Fl(e, e.effectSlurDestination, forSlide, !1);
            this._effectSlurs.push(i), this.addTie(i);
          }
        }
        if (e.isEffectSlurDestination && e.effectSlurOrigin) {
          let r = !1;
          let forSlide = e.effectSlurOrigin.slideOutType === 2;
          for (let i of this._effectSlurs)
            if (i.tryExpand(e.effectSlurOrigin, e, forSlide, !0)) {
              r = !0;
              break;
            }
          if (!r) {
            let i = new Fl(e.effectSlurOrigin, e, forSlide, !0);
            this._effectSlurs.push(i), this.addTie(i);
          }
        }
      }
    }
  };
  var Sd = class extends ue {
    constructor(t, e, r, i, n) {
      super(t, e), (this._isGrace = i), (this._number = r), (this._beat = n);
    }
    paint(t, e, r) {
      var s = [];
      try {
        let i = j(
          s,
          this._beat.isRest
            ? $.beat(r, 21, this._beat)
            : this._beat.notes.length > 0
            ? $.note(r, 8, this._beat.notes[0])
            : void 0
        );
        let n = this.renderer.resources;
        r.font = this._isGrace
          ? n.numberedNotationGraceFont
          : n.numberedNotationFont;
        r.textBaseline = 1;
        r.textAlign = 0;
        r.fillText(this._number.toString(), t + this.x, e + this.y);
      } catch (a) {
        var o = a,
          l = !0;
      } finally {
        ee(s, o, l);
      }
    }
    doLayout() {
      let t = this.renderer.resources,
        e = this._isGrace
          ? t.numberedNotationGraceFont
          : t.numberedNotationFont,
        r = this.renderer.scoreRenderer.canvas;
      r.font = e;
      let i = r.measureText(`${this._number}`);
      (this.height = i.height), (this.width = i.width);
      // 
      if (this._isGrace) {
        this.x += 3;
        this.y -= 10;
      }
    }
  };
  var Bd = class {
      constructor() {
        this.x = 0;
        this.y = -3e3;
        this.width = 0;
      }
    },
    Qn = class extends rt {
      constructor() {
        super(0, 0);
      }
      doLayout() {
        if (!this.glyphs || this.glyphs.length === 0) {
          this.width = 0;
          return;
        }
        this.glyphs.sort((r, i) => (r.y < i.y ? -1 : r.y > i.y ? 1 : 0));
        let t = [];
        t.push(new Bd());
        for (let r = 0, i = this.glyphs.length; r < i; r++) {
          let n = this.glyphs[r];
          (n.renderer = this.renderer), n.doLayout();
          let s = 0;
          for (; t[s].y > n.y; ) s++, s === t.length && t.push(new Bd());
          (n.x = s),
            (t[s].y = n.y + n.height),
            t[s].width < n.width && (t[s].width = n.width);
        }
        this.width = 0;
        let e = this.renderer.smuflMetrics.accidentalPadding;
        for (let r of t) (this.width += r.width + e), (r.x = this.width);
        for (let r = 0, i = this.glyphs.length; r < i; r++) {
          let n = this.glyphs[r],
            s = t[n.x];
          n.x = this.width - s.x;
        }
      }
    };
  var mr = class p extends ce {
    constructor(t, e, r, i) {
      super(t, e, i, p.getMusicSymbol(r));
    }
    static getMusicSymbol(t) {
      switch (t) {
        case 1:
          return 57953;
        case 2:
          return 57954;
        case 3:
          return 57952;
        case 4:
          return 57970;
        case 5:
          return 57972;
        case 6:
          return 57968;
        case 7:
          return 57955;
        case 8:
          return 57956;
      }
      return -1;
    }
  };
  var gi = class extends ce {
    constructor(t, e) {
      super(t, e, 1, 57831);
    }
    doLayout() {
      super.doLayout(), (this.offsetX = this.width / 2), (this.width *= 1.5);
    }
  };
  var Td = class extends ue {
    constructor(t, e, r) {
      super(t, e), (this._beat = r);
    }
    doLayout() {
      (this.width =
        this.renderer.smuflMetrics.numberedDashGlyphWidth +
        this.renderer.smuflMetrics.numberedDashGlyphPadding),
        (this.height = this.renderer.smuflMetrics.numberedBarRendererBarSize);
    }
    paint(t, e, r) {
      var s = [];
      try {
        let i = j(s, $.beat(r, 19, this._beat));
        let n = this.renderer.smuflMetrics.numberedDashGlyphPadding;
        // 
        let isGrace = this._beat.graceType !== 0;
        // 
        let xOffset = isGrace ? 3 : 0;
        let yOffset = isGrace ? -14 : 0;
        if (isGrace) {
          // 1px1px
          const lineHeight = 1;
          const lineSpacing = 1;
          const startY = Math.ceil(e + this.y - this.height) + yOffset;
          // 
          r.fillRect(
            t + this.x + xOffset,
            startY,
            this.width - n,
            lineHeight
          );
          // 1px
          r.fillRect(
            t + this.x + xOffset,
            startY + lineHeight + lineSpacing,
            this.width - n,
            lineHeight
          );
        } else {
          // 
          r.fillRect(
            t + this.x + xOffset,
            Math.ceil(e + this.y - this.height) + yOffset,
            this.width - n,
            this.height
          );
        };
      } catch (a) {
        var o = a,
          l = !0;
      } finally {
        ee(s, o, l);
      }
    }
  };
  var Oi = class extends ue {
    constructor() {
      super(0, 0);
    }
    doLayout() {
      this.width = this.renderer.smuflMetrics.glyphWidths.get(57603);
    }
    paint(t, e, r) {
      let i = this.renderer,
        n = i.getLineHeight(i.heightLineCount - 1),
        s = i.getLineY(0),
        a = i.getLineHeight(i.drawnLineCount - 1),
        o = s + a / 2 - n / 2,
        l = r.lineWidth;
      (r.lineWidth = this.renderer.smuflMetrics.deadSlappedLineWidth),
        r.moveTo(t + this.x, e + o),
        r.lineTo(t + this.x + this.width, e + o + n),
        r.moveTo(t + this.x, e + o + n),
        r.lineTo(t + this.x + this.width, e + o),
        r.stroke(),
        (r.lineWidth = l);
    }
  };
  var kd = class extends vt {
      constructor() {
        super(...arguments);
        this.isNaturalizeAccidental = !1;
        this.accidental = 0;
      }
      get effectElement() {
        return 20;
      }
      doLayout() {
        if (!this.container.beat.isRest && !this.container.beat.isEmpty) {
          let e = new Qn();
          if (
            ((e.renderer = this.renderer), this.container.beat.notes.length > 0)
          ) {
            let r = this.container.beat.notes[0],
              s = 0;
            if (!r.isDead) {
              let a = this.renderer.bar.keySignatureType,
                o = this.renderer.bar.keySignature,
                l = o + 7,
                u = (
                  a === 1
                    ? Qa.minorKeySignatureOneValues
                    : Qa.majorKeySignatureOneValues
                )[l],
                c = r.displayValue - u,
                d = c < 0 ? ((c % 12) + 12) % 12 : c % 12;
              A.accidentalNotes[d] &&
                !this.container.preNotes.isNaturalizeAccidental &&
                (s = l < 7 ? 3 : 2);
            }
            if (s !== 0) {
              this.accidental = s;
              let a = this.renderer,
                o = $.noteColor(a.resources, 9, r),
                l = new mr(
                  0,
                  a.getLineY(0),
                  s,
                  r.beat.graceType !== 0
                    ? ie.GraceScale * ie.GraceScale
                    : ie.GraceScale
                );
              (l.colorOverride = o),
                (l.renderer = this.renderer),
                e.addGlyph(l),
                this.addNormal(e),
                this.addNormal(
                  new Ke(0, 0, this.renderer.smuflMetrics.preNoteEffectPadding)
                );
            }
          }
        }
        super.doLayout();
      }
    },
    Qa = class Qa extends _t {
      constructor() {
        super(...arguments);
        this.noteHeads = null;
        this.deadSlapped = null;
        this.octaveDots = 0;
      }
      get effectElement() {
        return 20;
      }
      getNoteX(e, r) {
        let i = null;
        if (
          (this.noteHeads
            ? (i = this.noteHeads)
            : this.deadSlapped && (i = this.deadSlapped),
          i)
        ) {
          let n = i.x;
          switch (r) {
            case 0:
              break;
            case 1:
              n += i.width / 2;
              break;
            case 2:
              n += i.width;
              break;
          }
          return n;
        }
        return 0;
      }
      buildBoundingsLookup(e, r, i) {
        if (this.noteHeads && this.container.beat.notes.length > 0) {
          let n = new xr();
          (n.note = this.container.beat.notes[0]),
            (n.noteHeadBounds = new we()),
            (n.noteHeadBounds.x = r + this.x + this.noteHeads.x),
            (n.noteHeadBounds.y =
              i + this.y + this.noteHeads.y - this.noteHeads.height / 2),
            (n.noteHeadBounds.w = this.width),
            (n.noteHeadBounds.h = this.height),
            e.addNote(n);
        }
      }
      getLowestNoteY() {
        return this._internalGetNoteY(2);
      }
      getHighestNoteY() {
        return this._internalGetNoteY(2);
      }
      getNoteY(e, r) {
        return this._internalGetNoteY(r);
      }
      _internalGetNoteY(e) {
        let r = null;
        if (
          (this.noteHeads
            ? (r = this.noteHeads)
            : this.deadSlapped && (r = this.deadSlapped),
          r)
        ) {
          let i = this.y + r.y;
          switch (e) {
            case 1:
            case 0:
              i -= r.height / 2;
              break;
            case 2:
              break;
            case 3:
            case 4:
              i += r.height / 2;
              break;
            case 5:
            case 6:
              break;
          }
          return i;
        }
        return 0;
      }
      updateBeamingHelper() {
        if (this.beamingHelper) {
          let e = null;
          let x = this.container.x + this.x;
          let width = 0;
          if (this.noteHeads) {
            e = this.noteHeads;
            x += e.x;
            width = e.width;
          } else if (this.deadSlapped) {
            e = this.deadSlapped;
            x += e.x;
            width = e.width;
          } else {
            // For rests and other beats without noteHeads, use the container's width
            width = this.width;
          }
          this.beamingHelper.registerBeatLineX(
            "numbered",
            this.container.beat,
            x,
            x + width
          );
        }
      }
      doLayout() {
        let e = this.renderer;
        e.shortestDuration < this.container.beat.duration &&
          (e.shortestDuration = this.container.beat.duration);
        let r = e.getLineY(e.getNoteLine());
        if (!this.container.beat.isEmpty) {
          let i = "0";
          if (this.container.beat.notes.length > 0) {
            let a = this.renderer.bar.keySignatureType,
              o = this.renderer.bar.keySignature,
              l = o + 7,
              c = (
                a === 1
                  ? Qa.minorKeySignatureOneValues
                  : Qa.majorKeySignatureOneValues
              )[l],
              d = this.container.beat.notes[0];
            if (d.isDead) i = "X";
            else {
              let h = d.displayValue - c,
                f = h < 0 ? ((h % 12) + 12) % 12 : h % 12,
                b = h < 0 ? -((Math.abs(h) % 12 === 0 ? Math.abs(h) : Math.abs(h) + 12) / 12 | 0) : (h / 12) | 0;
              (this.octaveDots = b), e.registerOctave(b);
              let S =
                (A.keySignatureIsSharp(o) || A.keySignatureIsNatural(o)
                  ? pr.flatNoteSteps
                  : pr.sharpNoteSteps)[f] + 1;
              A.accidentalNotes[f] &&
                !this.container.preNotes.isNaturalizeAccidental &&
                (l < 7 ? S++ : S--),
                (i = S.toString());
            }
          }
          if (this.container.beat.deadSlapped) {
            let a = new Oi();
            (a.renderer = this.renderer),
              a.doLayout(),
              (this.deadSlapped = a),
              this.addEffect(a);
          } else {
            let a = this.container.beat.graceType !== 0,
              o = new Sd(0, r, i, a, this.container.beat);
            (this.noteHeads = o), this.addNormal(o);
          }
          if (this.container.beat.dots > 0 && this.container.beat.duration >= 4)
            for (let a = 0; a < this.container.beat.dots; a++) {
              let o = new gi(0, e.getLineY(0));
              (o.renderer = this.renderer), this.addEffect(o);
            }
          let n = 0;
          switch (this.container.beat.duration) {
            case -4:
              n = 16;
              break;
            case -2:
              n = 8;
              break;
            case 1:
              n = 4;
              break;
            case 2:
              n = 2;
              break;
          }
          let s = n;
          for (let a = 0; a < this.container.beat.dots; a++)
            (s = (s / 2) | 0), (n += s);
          for (let a = 0; a < n - 1; a++) {
            let o = new Td(0, e.getLineY(0), this.container.beat);
            (o.renderer = this.renderer), this.addNormal(o);
          }
        }
        super.doLayout(),
          this.container.beat.isEmpty
            ? (this.centerX = this.width / 2)
            : this.noteHeads
            ? (this.centerX = this.noteHeads.x + this.noteHeads.width / 2)
            : this.deadSlapped &&
              (this.centerX = this.deadSlapped.x + this.deadSlapped.width / 2);
      }
    };
  (Qa.majorKeySignatureOneValues = [
    59, 66, 61, 68, 63, 58, 65, 60, 67, 62, 69, 64, 71, 66, 61,
  ]),
    (Qa.minorKeySignatureOneValues = [
      71, 66, 73, 68, 63, 70, 65, 72, 67, 74, 69, 64, 71, 66, 73,
    ]);
  var Rl = Qa;
  var Ls = class extends ue {
    constructor(t) {
      super(0, 0), (this._isOpen = t);
    }
    doLayout() {
      super.doLayout(),
        (this.width =
          this.renderer.smuflMetrics.ghostParenthesisWidth +
          this.renderer.smuflMetrics.ghostParenthesisPadding);
    }
    paint(t, e, r) {
      let i = r.color;
      this.colorOverride && (r.color = this.colorOverride),
        this._isOpen
          ? et.paintTie(
              r,
              1,
              t + this.x + this.renderer.smuflMetrics.ghostParenthesisWidth,
              e + this.y + this.height,
              t + this.x + this.renderer.smuflMetrics.ghostParenthesisWidth,
              e + this.y,
              !1,
              this.renderer.smuflMetrics.ghostParenthesisWidth / 2,
              this.renderer.smuflMetrics.tieMidpointThickness
            )
          : et.paintTie(
              r,
              1,
              t + this.x + this.renderer.smuflMetrics.ghostParenthesisPadding,
              e + this.y,
              t + this.x + this.renderer.smuflMetrics.ghostParenthesisPadding,
              e + this.y + this.height,
              !1,
              this.renderer.smuflMetrics.ghostParenthesisWidth / 2,
              this.renderer.smuflMetrics.tieMidpointThickness
            ),
        (r.color = i);
    }
  };
  var Za = class extends rt {
    constructor(e, r, i, n, s, a) {
      super(e, r);
      this._numerator = 0;
      this._denominator = 0;
      this.barSubElement = 16;
      (this._numerator = i),
        (this._denominator = n),
        (this._isCommon = s),
        (this._isFreeTime = a);
    }
    paint(e, r, i) {
      var s = [];
      try {
        let n = j(s, $.bar(i, this.barSubElement, this.renderer.bar));
        super.paint(e, r, i);
      } catch (a) {
        var o = a,
          l = !0;
      } finally {
        ee(s, o, l);
      }
    }
    doLayout() {
      if (this._isCommon && this._numerator === 2 && this._denominator === 2) {
        let e = new ce(0, 0, this.commonScale, 57483);
        this.addGlyph(e), super.doLayout();
      } else if (
        this._isCommon &&
        this._numerator === 4 &&
        this._denominator === 4
      ) {
        let e = new ce(0, 0, this.commonScale, 57482);
        this.addGlyph(e), super.doLayout();
      } else {
        let e = new Es(0, 0, this._numerator, 0, this.numberScale),
          r = new Es(0, 0, this._denominator, 2, this.numberScale);
        this.addGlyph(e), this.addGlyph(r), super.doLayout();
        let i = this.width;
        (e.x = (i - e.width) / 2),
          (r.x = (i - r.width) / 2),
          (this.width = Math.max(e.x + e.width, r.x + r.width));
      }
      if (this._isFreeTime) {
        let e = this.renderer.smuflMetrics.oneStaffSpace * 2,
          r = new Ls(!0);
        (r.renderer = this.renderer),
          (r.y = -e),
          (r.height = e * 2),
          r.doLayout();
        for (let n of this.glyphs) n.x += r.width;
        (this.width += r.width), this.addGlyph(r);
        let i = new Ls(!1);
        (i.renderer = this.renderer),
          (i.x = this.width),
          (i.y = -e),
          (i.height = e * 2),
          i.doLayout(),
          this.addGlyph(i),
          (this.width += i.width);
      }
    }
  };
  var Zn = class extends Za {
    get commonScale() {
      return 1;
    }
    get numberScale() {
      return 1;
    }
  };
  var vd = class extends ue {
    constructor(e, r, i, n) {
      super(e, r);
      this._text = "";
      this._accidental = 0;
      this._accidentalOffset = 0;
      (this._keySignature = i), (this._keySignatureType = n);
    }
    doLayout() {
      super.doLayout();
      let e = "1 = ",
        r = "",
        i = 0;
      switch (this._keySignatureType) {
        case 0:
          switch (this._keySignature) {
            case -7:
              (r = "  C"), (i = 3);
              break;
            case -6:
              (r = "  G"), (i = 3);
              break;
            case -5:
              (r = "  D"), (i = 3);
              break;
            case -4:
              (r = "  A"), (i = 3);
              break;
            case -3:
              (r = "  E"), (i = 3);
              break;
            case -2:
              (r = "  B"), (i = 3);
              break;
            case -1:
              r = "F";
              break;
            case 0:
              (r = "C"), (i = 0);
              break;
            case 1:
              (r = "G"), (i = 0);
              break;
            case 2:
              (r = "D"), (i = 0);
              break;
            case 3:
              (r = "A"), (i = 0);
              break;
            case 4:
              (r = "E"), (i = 0);
              break;
            case 5:
              (r = "B"), (i = 0);
              break;
            case 6:
              (r = "  F"), (i = 2);
              break;
            case 7:
              (r = "  C"), (i = 2);
              break;
          }
          break;
        case 1:
          switch (this._keySignature) {
            case -7:
              (r = "  a"), (i = 3);
              break;
            case -6:
              (r = "  e"), (i = 3);
              break;
            case -5:
              (r = "  b"), (i = 3);
              break;
            case -4:
              (r = "f"), (i = 0);
              break;
            case -3:
              (r = "c"), (i = 0);
              break;
            case -2:
              (r = "g"), (i = 0);
              break;
            case -1:
              r = "d";
              break;
            case 0:
              (r = "a"), (i = 0);
              break;
            case 1:
              (r = "e"), (i = 0);
              break;
            case 2:
              (r = "b"), (i = 0);
              break;
            case 3:
              (r = "  f"), (i = 2);
              break;
            case 4:
              (r = "  c"), (i = 2);
              break;
            case 5:
              (r = "  g"), (i = 2);
              break;
            case 6:
              (r = "  d"), (i = 2);
              break;
            case 7:
              (r = "  a"), (i = 2);
              break;
          }
          break;
      }
      (this._text = e + r), (this._accidental = i);
      let n = this.renderer.scoreRenderer.canvas,
        s = this.renderer.resources;
      (n.font = s.numberedNotationFont),
        (this._accidentalOffset = n.measureText(e).width),
        (this.width = n.measureText(e + r).width);
    }
    paint(e, r, i) {
      var a = [];
      try {
        let n = j(a, $.bar(i, 15, this.renderer.bar));
        let s = this.renderer.resources;
        i.font = s.numberedNotationFont;
        i.textBaseline = 1;
        i.fillText(this._text, e + this.x, r + this.y);
        this._accidental !== 0 &&
          ge.fillMusicFontSymbolSafe(
            i,
            e + this.x + this._accidentalOffset,
            r + this.y,
            1,
            mr.getMusicSymbol(this._accidental),
            !1
          );
      } catch (o) {
        var l = o,
          u = !0;
      } finally {
        ee(a, l, u);
      }
    }
  };
  var ja = class extends Fi {
    constructor(e, r) {
      super(e, r);
      this.simpleWhammyOverflow = 0;
      this.shortestDuration = -4;
      this.lowestOctave = null;
      this.highestOctave = null;
      this._isOnlyNumbered =
        !r.staff.showSlash &&
        !r.staff.showTablature &&
        !r.staff.showStandardNotation;
    }
    get dotSpacing() {
      return this.smuflMetrics.glyphHeights.get(57831) * 2;
    }
    registerOctave(e) {
      this.lowestOctave === null
        ? ((this.lowestOctave = e), (this.highestOctave = e))
        : (e < this.lowestOctave && (this.lowestOctave = e),
          e > this.highestOctave && (this.highestOctave = e));
    }
    get repeatsBarSubElement() {
      return 3;
    }
    get barNumberBarSubElement() {
      return 7;
    }
    get barLineBarSubElement() {
      return 11;
    }
    get staffLineBarSubElement() {
      return 23;
    }
    get lineSpacing() {
      return this.smuflMetrics.oneStaffSpace;
    }
    get heightLineCount() {
      return 5;
    }
    get drawnLineCount() {
      return 0;
    }
    get bottomGlyphOverflow() {
      return 0;
    }
    paint(e, r, i) {
      super.paint(e, r, i),
        this.paintBeams(e, r, i, 19, 19),
        this.paintTuplets(e, r, i, 22, !0);
    }
    doLayout() {
      super.doLayout();
      let e = !1;
      for (let r of this.bar.voices)
        if (
          this.hasVoiceContainer(r) &&
          this.getVoiceContainer(r).tupletGroups.length > 0
        ) {
          e = !0;
          break;
        }
      if ((e && this.registerOverflowTop(this.tupletSize), !this.bar.isEmpty)) {
        let r = A.getIndex(this.shortestDuration) - 2,
          i = this.dotSpacing;
        if (r > 0) {
          let s = this.smuflMetrics.numberedBarRendererBarSpacing,
            a = this.smuflMetrics.numberedBarRendererBarSize,
            o = (r - 1) * s + a,
            l = 0,
            u = this.lowestOctave;
          u !== null &&
            (l = Math.abs(u) * i + this.smuflMetrics.glyphHeights.get(57831)),
            this.registerOverflowBottom(o + l);
        }
        let n = this.highestOctave;
        if (n !== null) {
          let s = Math.abs(n) * i + this.smuflMetrics.glyphHeights.get(57831);
          this.registerOverflowTop(s);
        }
      }
    }
    paintFlag(e, r, i, n, s) {
      this.paintBar(e, r, i, n, s);
    }
    paintBar(e, r, i, n, s) {
      if (n.beats.length === 0) return;
      let a = this.resources;
      for (let d = 0, h = n.beats.length; d < h; d++) {
        var o = [];
        try {
          let f = n.beats[d];
          let b = j(o, $.beat(i, s, f));
          let y = this.smuflMetrics.numberedBarRendererBarSpacing;
          let S = this.smuflMetrics.numberedBarRendererBarSize;
          let k = A.getIndex(f.duration) - 2;
          let T = r + this.y;
          let O = this.getBeatX(f, 0) - this.beatGlyphsStart;
          let N = this.calculateBeamY(n, O);
          // 
          let isGrace = f.graceType !== 0;
          // 
          let xOffset = isGrace ? 3 : 0;
          let yOffset = isGrace ? -14 : 0;
          for (let X = 0; X < k; X++) {
            let fe = 0,
              Ee = 0,
              be = 0,
              Ae = T + X * y;
            d === n.beats.length - 1
              ? ((fe = O), (Ee = Math.max(O + 1, this.getBeatX(f, 4) - this.beatGlyphsStart)))
              : ((fe = O),
                (Ee = Math.max(O + 1, this.getBeatX(n.beats[d + 1], 0) - this.beatGlyphsStart))),
              (be = Ae + N);
            
            // 
            if (isGrace) {
              // 1px1px
              const lineHeight = 1;
              const lineSpacing = 1;
              const lineWidth = Ee - fe;
              const startX = e + this.x + fe + xOffset;
              const startY = be + yOffset;
              
              // 
              i.fillRect(startX, startY, lineWidth, lineHeight);
              // 1px
              i.fillRect(startX, startY + lineHeight + lineSpacing, lineWidth, lineHeight);
            } else {
              // 
              i.fillRect(e + this.x + fe + xOffset, be + yOffset, Ee - fe, S);
            }
          }
          let R = this.getBeatContainer(f).onNotes;
          let g = R instanceof Rl ? R.octaveDots : 0;
          let x = this.dotSpacing;
          let M = 0;
          let P = 0;
          g > 0
            ? ((M = T + this.getLineY(0) - a.numberedNotationFont.size),
              (P = x * -1))
            : g < 0 && ((M = T + N + k * (y + S)), (P = x));
          let H = this.getBeatX(f, 2) - this.beatGlyphsStart;
          g = Math.abs(g);
          for (let X = 0; X < g; X++)
            ge.fillMusicFontSymbolSafe(i, e + this.x + H, M, 1, 57831, !0),
              (M += P);
        } catch (l) {
          var u = l,
            c = !0;
        } finally {
          ee(o, u, c);
        }
      }
    }
    getNoteLine() {
      return 0;
    }
    get tupletOffset() {
      return (
        super.tupletOffset + this.resources.numberedNotationFont.size * 1.5
      );
    }
    getFlagTopY(e, r) {
      return this.getLineY(0) - this.resources.numberedNotationFont.size;
    }
    getFlagBottomY(e, r) {
      return this.getLineY(0) - this.resources.numberedNotationFont.size;
    }
    getBeamDirection(e) {
      return 1;
    }
    getTupletBeamDirection(e) {
      return 0;
    }
    getNoteY(e, r) {
      let i = super.getNoteY(e, r);
      return Number.isNaN(i) && (i = this.getLineY(0)), i;
    }
    calculateBeamYWithDirection(e, r, i) {
      let n = this.resources.numberedNotationFont;
      return this.getLineY(0) + n.size - 11;
    }
    getBarLineStart(e, r) {
      let i = this.smuflMetrics.glyphHeights.get(57508);
      return this.getLineY(0) - i / 2;
    }
    createPreBeatGlyphs() {
      (this.wasFirstOfLine = this.isFirstOfLine),
        (this.index === 0 ||
          (this.bar.masterBar.isRepeatStart && this._isOnlyNumbered)) &&
          this.addPreBeatGlyph(new Is(!1)),
        this.createLinePreBeatGlyphs(),
        this.addPreBeatGlyph(
          new $a(0, this.getLineHeight(-0.25), this.bar.index + 1)
        );
    }
    createLinePreBeatGlyphs() {
      (!this.bar.previousBar ||
        this.bar.keySignature !== this.bar.previousBar.keySignature) &&
        (this.createStartSpacing(), this._createKeySignatureGlyphs()),
        this._isOnlyNumbered &&
          (!this.bar.previousBar ||
            (this.bar.previousBar &&
              this.bar.masterBar.timeSignatureNumerator !==
                this.bar.previousBar.masterBar.timeSignatureNumerator) ||
            (this.bar.previousBar &&
              this.bar.masterBar.timeSignatureDenominator !==
                this.bar.previousBar.masterBar.timeSignatureDenominator) ||
            (this.bar.previousBar &&
              this.bar.masterBar.isFreeTime &&
              this.bar.masterBar.isFreeTime !==
                this.bar.previousBar.masterBar.isFreeTime)) &&
          (this.createStartSpacing(), this._createTimeSignatureGlyphs());
    }
    _createKeySignatureGlyphs() {
      this.addPreBeatGlyph(
        new vd(
          0,
          this.getLineY(0),
          this.bar.keySignature,
          this.bar.keySignatureType
        )
      );
    }
    _createTimeSignatureGlyphs() {
      this.addPreBeatGlyph(new Ke(0, 0, this.smuflMetrics.oneStaffSpace));
      let e = this.bar.masterBar,
        r = new Zn(
          0,
          this.getLineY(0),
          e.timeSignatureNumerator,
          e.timeSignatureDenominator,
          e.timeSignatureCommon,
          e.isFreeTime &&
            (e.previousMasterBar == null ||
              e.isFreeTime !== e.previousMasterBar.isFreeTime)
        );
      (r.barSubElement = 19), this.addPreBeatGlyph(r);
    }
    createPostBeatGlyphs() {
      this._isOnlyNumbered && super.createPostBeatGlyphs();
    }
    createVoiceGlyphs(e) {
      for (let r of e.beats) {
        let i = new yd(r, this.getVoiceContainer(e));
        (i.preNotes = e.index === 0 ? new kd() : new vt()),
          (i.onNotes = e.index === 0 ? new Rl() : new _t()),
          this.addBeatGlyph(i);
      }
    }
    paintBeamingStem(e, r, i, n, s, a) {}
  };
  ja.StaffId = "numbered";
  var _d = class extends ri {
    get staffId() {
      return ja.StaffId;
    }
    getStaffPaddingTop(t) {
      return t.system.layout.renderer.settings.display.notationStaffPaddingTop;
    }
    getStaffPaddingBottom(t) {
      return t.system.layout.renderer.settings.display
        .notationStaffPaddingBottom;
    }
    create(t, e) {
      return new ja(t, e);
    }
    canCreate(t, e) {
      return super.canCreate(t, e) && e.showNumbered;
    }
  };
  var xd = class p extends ce {
    constructor(t, e, r, i) {
      super(t, e, 1, p._getSymbol(r, i)),
        (this._clef = r),
        (this._clefOttava = i);
    }
    doLayout() {
      (this.center = !0),
        super.doLayout(),
        (this.width = this.renderer.smuflMetrics.glyphWidths.get(57424)),
        (this.offsetX = this.width / 2);
    }
    static _getSymbol(t, e) {
      switch (t) {
        case 0:
          return 57449;
        case 1:
        case 2:
          return e === 3 ? 57437 : 57436;
        case 3:
          switch (e) {
            case 0:
              return 57446;
            case 1:
              return 57445;
            case 3:
              return 57444;
            case 4:
              return 57443;
            default:
              return 57442;
          }
        case 4:
          switch (e) {
            case 0:
              return 57428;
            case 1:
              return 57427;
            case 3:
              return 57426;
            case 4:
              return 57425;
            default:
              return 57424;
          }
        default:
          return -1;
      }
    }
    paint(t, e, r) {
      var l = [];
      try {
        let i = j(l, $.bar(r, 12, this.renderer.bar));
        super.paint(t, e, r);
        switch (this._clef) {
          case 1:
          case 2:
            if (this._clefOttava === 3) return;
            break;
          case 3:
          case 4:
            return;
        }
        let n;
        let s = !1;
        switch (this._clefOttava) {
          case 0:
            (n = 57470), (s = !0);
            break;
          case 1:
            (n = 57469), (s = !0);
            break;
          case 3:
            n = 57469;
            break;
          case 4:
            n = 57470;
            break;
          default:
            return;
        }
        let a = this.width / 2;
        let o = s
          ? this.renderer.smuflMetrics.glyphTop.get(this.symbol)
          : this.renderer.smuflMetrics.glyphBottom.get(this.symbol) -
            this.renderer.smuflMetrics.glyphHeights.get(n);
        ge.fillMusicFontSymbolSafe(r, t + this.x + a, e + this.y - o, 1, n, !0);
      } catch (u) {
        var c = u,
          d = !0;
      } finally {
        ee(l, c, d);
      }
    }
  };
  var eo = class p extends Ve {
    constructor(t, e, r) {
      super(t, e), (this._note = r);
    }
    static _getSymbol(t, e) {
      switch (t) {
        case 0:
          return -1;
        case 1:
          return e ? 58528 : 58529;
        case 2:
          return e ? 58540 : 58541;
        case 3:
          return e ? 58532 : 58533;
        default:
          return -1;
      }
    }
    doLayout() {
      (this.width = this.renderer.smuflMetrics.glyphWidths.get(58528)),
        (this.height = this.renderer.smuflMetrics.glyphHeights.get(58528));
    }
    paint(t, e, r) {
      let i = this.renderer.getBeatDirection(this._note.beat),
        n = p._getSymbol(this._note.accentuated, i === 1),
        s = i === 0 ? e + this.y : e + this.y + this.height;
      ge.fillMusicFontSymbolSafe(r, t + this.x, s, 1, n, !0);
    }
  };
  var wd = class extends ce {
    constructor(t, e, r) {
      super(t, e, r ? ie.GraceScale : 1, 57514);
    }
  };
  var Ol = class p extends ce {
    constructor(t, e, r, i) {
      super(t, e, i ? ie.GraceScale : 1, p._getSymbol(r));
    }
    static _getSymbol(t) {
      switch (t) {
        case -4:
        case -2:
        case 1:
        case 2:
          return 57566;
        default:
          return 57564;
      }
    }
  };
  var Nd = class {
      constructor(t, e, r) {
        this.line = 0;
        (this.line = t), (this.isGhost = e), (this.color = r);
      }
    },
    rn = class extends ue {
      constructor(e) {
        super(0, 0);
        this._infos = [];
        this._glyphs = [];
        this.isEmpty = !0;
        this._isOpen = e;
      }
      addParenthesis(e) {
        let r = this.renderer,
          i = r.getNoteLine(e),
          n =
            e.isGhost ||
            (this._isTiedBend(e) &&
              r.settings.notation.isNotationElementVisible(11)),
          s = $.noteColor(r.resources, 0, e);
        this._add(new Nd(i, n, s));
      }
      addParenthesisOnLine(e, r) {
        let i = new Nd(e, r, void 0);
        this._add(i);
      }
      _add(e) {
        this._infos.push(e), e.isGhost && (this.isEmpty = !1);
      }
      _isTiedBend(e) {
        return e.isTieDestination
          ? e.tieOrigin.hasBend
            ? !0
            : this._isTiedBend(e.tieOrigin)
          : !1;
      }
      doLayout() {
        let e = this.renderer;
        this._infos.sort((n, s) => n.line - s.line);
        let r = null,
          i = e.getScoreHeight(1);
        for (let n = 0, s = this._infos.length; n < s; n++) {
          let a;
          if (!this._infos[n].isGhost) r = null;
          else if (!r)
            (a = new Ls(this._isOpen)),
              (a.colorOverride = this._infos[n].color),
              (a.renderer = this.renderer),
              (a.y = e.getScoreY(this._infos[n].line) - i),
              (a.height = i * 2),
              a.doLayout(),
              this._glyphs.push(a),
              (r = a);
          else {
            let o = e.getScoreY(this._infos[n].line) + i;
            r.height = o - r.y;
          }
        }
        this.width = this._glyphs.length > 0 ? this._glyphs[0].width : 0;
      }
      paint(e, r, i) {
        super.paint(e, r, i);
        for (let n of this._glyphs) n.paint(e + this.x, r + this.y, i);
      }
    };
  var Ed = class {
    constructor(t, e) {
      this.steps = 0;
      (this.glyph = t), (this.steps = e);
    }
  };
  var to = class extends ue {
    constructor() {
      super(0, 0);
      this._infos = [];
      this.minNote = null;
      this.maxNote = null;
      this.upLineX = 0;
      this.downLineX = 0;
      this.noteStartX = 0;
    }
    getLowestNoteY() {
      return this.maxNote ? this.renderer.getScoreY(this.maxNote.steps) : 0;
    }
    getHighestNoteY() {
      return this.minNote ? this.renderer.getScoreY(this.minNote.steps) : 0;
    }
    add(e, r) {
      let i = new Ed(e, r);
      this._infos.push(i),
        (!this.minNote || this.minNote.steps > i.steps) && (this.minNote = i),
        (!this.maxNote || this.maxNote.steps < i.steps) && (this.maxNote = i);
    }
    doLayout() {
      this._infos.sort((h, f) => f.steps - h.steps);
      let e = 0,
        r = 0,
        i = !0,
        n = 0,
        s = !1,
        a = this.direction,
        o = this.renderer.smuflMetrics,
        l = this.scale,
        u = new Map();
      for (let h = 0, f = this._infos.length; h < f; h++) {
        let b = this._infos[h].glyph;
        if (
          ((b.renderer = this.renderer),
          b.doLayout(),
          h > 0 && Math.abs(n - this._infos[h].steps) <= 1
            ? i
              ? ((i = !1), u.set(h, !1))
              : ((s = !0), (i = !0), u.set(h, !0))
            : ((i = !1), u.set(h, !1)),
          o.stemUp.has(b.symbol))
        ) {
          let S = o.stemUp.get(b.symbol).x * l;
          S > e && (e = S);
        } else {
          let y = o.glyphWidths.get(b.symbol) * l;
          y > e && (e = y);
        }
        if (o.stemDown.has(b.symbol)) {
          let S = o.stemDown.get(b.symbol).x * l;
          if (S > r) {
            let k = S - r;
            (r = S), (e += k);
          }
        }
        n = this._infos[h].steps;
      }
      let c = s || a === 0 ? e : r,
        d = 0;
      for (let h = 0, f = this._infos.length; h < f; h++) {
        let b = this._infos[h].glyph;
        u.get(h)
          ? (b.x = c)
          : ((b.x = r),
            o.stemDown.has(b.symbol) &&
              (b.x -= o.stemDown.get(b.symbol).x * l)),
          (b.x += this.noteStartX),
          (d = Math.max(d, b.x + b.width)),
          b instanceof ie && b.centerOnStem && (b.x = c);
      }
      s
        ? ((this.upLineX = c), (this.downLineX = c))
        : ((this.upLineX = e), (this.downLineX = r)),
        (this.width = d);
    }
    paint(e, r, i) {
      (e += this.x), (r += this.y), this._paintLedgerLines(e, r, i);
      let n = this._infos;
      for (let s of n)
        (s.glyph.renderer = this.renderer), s.glyph.paint(e, r, i);
    }
    _paintLedgerLines(e, r, i) {
      var S = [];
      try {
        if (!this.minNote) return;
        let n = this.renderer;
        let s = j(S, $.bar(i, 20, n.bar, !0));
        let a = this.scale;
        let o = this.renderer.smuflMetrics.legerLineExtension * a;
        let l = this.width - this.noteStartX + o * 2;
        let u = n.getLineHeight(1);
        let c = n.getLineY(-1);
        let d = n.getLineY(n.drawnLineCount);
        let h = n.getLineY(this.minNote.steps / 2);
        let f = n.getLineY(this.maxNote.steps / 2);
        let b = (this.renderer.smuflMetrics.legerLineThickness * a) / 2;
        let y = c;
        for (; y >= h; )
          i.fillRect(
            e - o + this.noteStartX,
            r + y - b,
            l,
            this.renderer.smuflMetrics.legerLineThickness * a
          ),
            (y -= u);
        y = d;
        for (; y <= f; )
          i.fillRect(
            e - o + this.noteStartX,
            r + y - b,
            l,
            this.renderer.smuflMetrics.legerLineThickness * a
          ),
            (y += u);
      } catch (k) {
        var T = k,
          O = !0;
      } finally {
        ee(S, T, O);
      }
    }
  };
  var ro = class p extends ce {
    constructor(t, e, r) {
      super(t, e, 1, p._getSymbol(r));
    }
    static _getSymbol(t) {
      switch (t) {
        case 32:
          return 57890;
        case 16:
          return 57889;
        case 8:
          return 57888;
        default:
          return -1;
      }
    }
  };
  var Pd = class extends to {
    constructor() {
      super(...arguments);
      this._noteGlyphLookup = new Map();
      this._notes = [];
      this._deadSlapped = null;
      this._tremoloPicking = null;
      this.aboveBeatEffects = new Map();
      this.belowBeatEffects = new Map();
    }
    get direction() {
      return this.beamingHelper.direction;
    }
    get scale() {
      return this.beat.graceType !== 0 ? ie.GraceScale : 1;
    }
    getNoteX(e, r) {
      if (this._noteGlyphLookup.has(e.id)) {
        let i = this._noteGlyphLookup.get(e.id),
          n = this.x + i.x;
        switch (r) {
          case 0:
            break;
          case 1:
            n += i.width / 2;
            break;
          case 2:
            n += i.width;
            break;
        }
        return n;
      }
      return 0;
    }
    getNoteY(e, r) {
      if (this._noteGlyphLookup.has(e.id)) {
        let i = this._noteGlyphLookup.get(e.id);
        return this._internalGetNoteY(i, r);
      }
      return 0;
    }
    _internalGetNoteY(e, r) {
      let i = this.y + e.y,
        n = this.beat.graceType !== 0 ? ie.GraceScale : 1;
      switch (r) {
        case 0:
          (i -=
            (this.renderer.smuflMetrics.stemUp.has(e.symbol)
              ? this.renderer.smuflMetrics.stemUp.get(e.symbol).bottomY
              : 0) * n),
            (i -= this.renderer.smuflMetrics.standardStemLength * n);
          let s = this.renderer.centerStaffStemY(this.beamingHelper);
          return Math.min(s, i);
        case 1:
          i -= e.height / 2;
          break;
        case 2:
          break;
        case 3:
          i += e.height / 2;
          break;
        case 4:
          (i -=
            (this.renderer.smuflMetrics.stemDown.has(e.symbol)
              ? this.renderer.smuflMetrics.stemDown.get(e.symbol).topY
              : -this.renderer.smuflMetrics.glyphHeights.get(e.symbol) / 2) *
            n),
            (i += this.renderer.smuflMetrics.standardStemLength * n);
          let a = this.renderer.centerStaffStemY(this.beamingHelper);
          return Math.max(a, i);
        case 5:
          i -=
            (this.renderer.smuflMetrics.stemUp.has(e.symbol)
              ? this.renderer.smuflMetrics.stemUp.get(e.symbol).bottomY
              : 0) * n;
          break;
        case 6:
          i -=
            (this.renderer.smuflMetrics.stemDown.has(e.symbol)
              ? this.renderer.smuflMetrics.stemDown.get(e.symbol).topY
              : -this.renderer.smuflMetrics.glyphHeights.get(e.symbol) / 2) * n;
          break;
      }
      return i;
    }
    addMainNoteGlyph(e, r, i) {
      super.add(e, i), this._noteGlyphLookup.set(r.id, e), this._notes.push(r);
    }
    addEffectNoteGlyph(e, r) {
      super.add(e, r);
    }
    updateBeamingHelper(e) {
      this.beamingHelper &&
        this.beamingHelper.registerBeatLineX(
          "score",
          this.beat,
          e + this.x + this.upLineX,
          e + this.x + this.downLineX
        );
    }
    doLayout() {
      super.doLayout();
      let e = this.renderer;
      this.beat.deadSlapped &&
        ((this._deadSlapped = new Oi()),
        (this._deadSlapped.renderer = this.renderer),
        this._deadSlapped.doLayout(),
        (this.width = this._deadSlapped.width));
      let r = 0,
        i = 0,
        n = this.renderer.smuflMetrics.onNoteEffectPadding;
      this.beat.deadSlapped
        ? ((i = e.getScoreY(0)), (r = e.getScoreY(e.heightLineCount)))
        : this.direction === 0
        ? ((i = this._internalGetNoteY(this.maxNote.glyph, 3) + n),
          (r = this._internalGetNoteY(this.minNote.glyph, 0) - n))
        : ((i = this._internalGetNoteY(this.maxNote.glyph, 4) + n),
          (r = this._internalGetNoteY(this.minNote.glyph, 1) - n));
      let s = null,
        a = null;
      for (let o of this.aboveBeatEffects.values())
        (o.renderer = this.renderer),
          o.doLayout(),
          (r -= o.height),
          (o.y = r),
          (s === null || s > r) && (s = r),
          (a === null || a < r) && (a = r),
          (r -= n);
      for (let o of this.belowBeatEffects.values())
        (o.renderer = this.renderer),
          o.doLayout(),
          (o.y = i),
          (s === null || s > i) && (s = i),
          (a === null || a < i) && (a = i),
          (i += o.height + n);
      if (
        (s !== null && e.registerBeatEffectOverflows(s, a ?? 0),
        this.beat.isTremolo && !this.beat.deadSlapped)
      ) {
        let o = this.direction,
          l = 0;
        if (o === 0) {
          let d = this._internalGetNoteY(this.minNote.glyph, 0),
            h = this._internalGetNoteY(this.minNote.glyph, 5);
          l = (d + h) / 2;
        } else {
          let d = this._internalGetNoteY(this.maxNote.glyph, 6),
            h = this._internalGetNoteY(this.maxNote.glyph, 4);
          l = (d + h) / 2;
        }
        let u = o === 0 ? this.upLineX : this.downLineX,
          c = this.beat.tremoloSpeed;
        this.beat.duration < 2 && (u = this.width / 2),
          (this._tremoloPicking = new ro(u, l, c)),
          (this._tremoloPicking.renderer = this.renderer),
          this._tremoloPicking.doLayout();
      }
    }
    buildBoundingsLookup(e, r, i) {
      for (let n of this._notes)
        if (this._noteGlyphLookup.has(n.id)) {
          let s = this._noteGlyphLookup.get(n.id),
            a = new xr();
          (a.note = n),
            (a.noteHeadBounds = new we()),
            (a.noteHeadBounds.x = r + this.x + s.x),
            (a.noteHeadBounds.y = i + this.y + s.y - s.height / 2),
            (a.noteHeadBounds.w = s.width),
            (a.noteHeadBounds.h = s.height),
            e.addNote(a);
        }
    }
    paint(e, r, i) {
      this._paintEffects(e, r, i), super.paint(e, r, i);
    }
    _paintEffects(e, r, i) {
      var s = [];
      try {
        let n = j(s, $.beat(i, 5, this.beat));
        for (let u of this.aboveBeatEffects.values())
          u.paint(e + this.x + this.width / 2, r + this.y, i);
        for (let u of this.belowBeatEffects.values())
          u.paint(e + this.x + this.width / 2, r + this.y, i);
        this._tremoloPicking && this._tremoloPicking.paint(e, r, i);
        this._deadSlapped && this._deadSlapped.paint(e, r, i);
      } catch (a) {
        var o = a,
          l = !0;
      } finally {
        ee(s, o, l);
      }
    }
  };
  var jn = class p extends ce {
    constructor(t, e, r) {
      super(t, e, 1, p.getSymbol(r));
    }
    static getSymbol(t) {
      switch (t) {
        case -4:
          return 58593;
        case -2:
          return 58594;
        case 1:
          return 58595;
        case 2:
          return 58596;
        case 4:
          return 58597;
        case 8:
          return 58598;
        case 16:
          return 58599;
        case 32:
          return 58600;
        case 64:
          return 58601;
        case 128:
          return 58602;
        case 256:
          return 58603;
        default:
          return -1;
      }
    }
    updateBeamingHelper(t) {
      this.beamingHelper &&
        this.beamingHelper.registerBeatLineX(
          "score",
          this.beat,
          t + this.x + this.width / 2,
          t + this.x + this.width / 2
        );
    }
    paint(t, e, r) {
      this.internalPaint(t, e, r, 6);
    }
    internalPaint(t, e, r, i) {
      var s = [];
      try {
        let n = j(s, $.beat(r, i, this.beat));
        super.paint(t, e, r);
      } catch (a) {
        var o = a,
          l = !0;
      } finally {
        ee(s, o, l);
      }
    }
  };
  var Hr = class extends to {
    constructor(e, r = !1) {
      super();
      this._showParenthesis = !1;
      this._noteValueLookup = new Map();
      this._accidentals = new Qn();
      this._preNoteParenthesis = null;
      this._postNoteParenthesis = null;
      this.isEmpty = !0;
      this.noteHeadOffset = 0;
      (this._beat = e),
        (this._showParenthesis = r),
        r &&
          ((this._preNoteParenthesis = new rn(!0)),
          (this._postNoteParenthesis = new rn(!1)));
    }
    get scale() {
      return ie.GraceScale;
    }
    get direction() {
      return 0;
    }
    containsNoteValue(e) {
      return this._noteValueLookup.has(e);
    }
    getNoteValueY(e) {
      return this._noteValueLookup.has(e)
        ? this.y + this._noteValueLookup.get(e).y
        : 0;
    }
    addGlyph(e, r, i) {
      let n = this.renderer,
        s = new ie(0, 0, 4, !0),
        a = n.accidentalHelper.applyAccidentalForValue(this._beat, e, r, !0),
        o = n.accidentalHelper.getNoteLineForValue(e, !1);
      if (
        ((s.y = n.getScoreY(o)),
        this._showParenthesis &&
          ((this._preNoteParenthesis.renderer = this.renderer),
          (this._postNoteParenthesis.renderer = this.renderer),
          this._preNoteParenthesis.addParenthesisOnLine(o, !0),
          this._postNoteParenthesis.addParenthesisOnLine(o, !0)),
        a !== 0)
      ) {
        let l = new mr(0, s.y, a, ie.GraceScale);
        (l.renderer = this.renderer),
          (this._accidentals.renderer = this.renderer),
          this._accidentals.addGlyph(l);
      }
      this._noteValueLookup.set(e, s), this.add(s, o), (this.isEmpty = !1);
    }
    doLayout() {
      let e = 0;
      this._showParenthesis &&
        ((this._preNoteParenthesis.x = e),
        (this._preNoteParenthesis.renderer = this.renderer),
        this._preNoteParenthesis.doLayout(),
        (e +=
          this._preNoteParenthesis.width +
          this.renderer.smuflMetrics.bendNoteHeadElementPadding)),
        this._accidentals.isEmpty ||
          ((e +=
            this._accidentals.width +
            this.renderer.smuflMetrics.bendNoteHeadElementPadding),
          (this._accidentals.x = e),
          (this._accidentals.renderer = this.renderer),
          this._accidentals.doLayout(),
          (e +=
            this._accidentals.width +
            this.renderer.smuflMetrics.bendNoteHeadElementPadding)),
        (this.noteStartX = e),
        super.doLayout(),
        (this.noteHeadOffset =
          this.noteStartX + (this.width - this.noteStartX) / 2),
        this._showParenthesis &&
          ((this._postNoteParenthesis.x =
            this.width + this.renderer.smuflMetrics.bendNoteHeadElementPadding),
          (this._postNoteParenthesis.renderer = this.renderer),
          this._postNoteParenthesis.doLayout(),
          (this.width +=
            this._postNoteParenthesis.width +
            this.renderer.smuflMetrics.bendNoteHeadElementPadding));
    }
    paint(e, r, i) {
      this._accidentals.isEmpty ||
        this._accidentals.paint(e + this.x, r + this.y, i),
        this._showParenthesis &&
          (this._preNoteParenthesis.paint(e + this.x, r + this.y, i),
          this._postNoteParenthesis.paint(e + this.x, r + this.y, i)),
        super.paint(e, r, i);
    }
  };
  var io = class extends ue {
    constructor() {
      super(...arguments);
      this.bendNoteHeads = [];
    }
    drawBendSlur(e, r, i, n, s, a, o, l) {
      et.drawBendSlur(
        e,
        r,
        i,
        n,
        s,
        a,
        o,
        this.renderer.smuflMetrics.tieHeight,
        l
      );
    }
    doLayout() {
      super.doLayout(), (this.width = 0);
      for (let e of this.bendNoteHeads) e.doLayout(), (this.width += e.width);
    }
    getTieDirection(e, r) {
      return r.getBeatDirection(e) === 0 ? 1 : 0;
    }
  };
  var Ad = class extends io {
    constructor(e) {
      super(0, 0);
      this._endGlyph = null;
      this._beat = e;
    }
    doLayout() {
      let e = this.renderer.settings.notation.notationMode;
      switch (this._beat.whammyBarType) {
        case 0:
        case 1:
        case 4:
          return;
        case 2:
        case 6:
          {
            let r = new Hr(this._beat, !1);
            (this._endGlyph = r), (r.renderer = this.renderer);
            let i =
              this._beat.whammyBarPoints[this._beat.whammyBarPoints.length - 1];
            for (let n of this._beat.notes)
              n.isTieOrigin ||
                r.addGlyph(
                  this._getBendNoteValue(n, i),
                  i.value % 2 !== 0,
                  void 0
                );
            r.doLayout(), this.bendNoteHeads.push(r);
          }
          break;
        case 3:
          if (e === 1) {
            let r = this.renderer.resources;
            this.renderer.simpleWhammyOverflow =
              r.tablatureFont.size +
              this.renderer.smuflMetrics.songBookWhammyDipHeight;
          } else {
            let r = new Hr(this._beat, !1);
            if (
              ((r.renderer = this.renderer),
              this.renderer.settings.notation.notationMode === 0)
            ) {
              let n = this._beat.whammyBarPoints[1];
              for (let s of this._beat.notes)
                r.addGlyph(
                  this._getBendNoteValue(s, this._beat.whammyBarPoints[1]),
                  n.value % 2 !== 0,
                  void 0
                );
            }
            r.doLayout(), this.bendNoteHeads.push(r);
            let i = new Hr(this._beat, !1);
            if (
              ((i.renderer = this.renderer),
              (this._endGlyph = i),
              this.renderer.settings.notation.notationMode === 0)
            ) {
              let n =
                this._beat.whammyBarPoints[
                  this._beat.whammyBarPoints.length - 1
                ];
              for (let s of this._beat.notes)
                i.addGlyph(
                  this._getBendNoteValue(s, n),
                  n.value % 2 !== 0,
                  void 0
                );
            }
            i.doLayout(), this.bendNoteHeads.push(i);
          }
          break;
        case 5:
          break;
      }
      super.doLayout();
    }
    paint(e, r, i) {
      var k = [];
      try {
        let n = this._beat;
        switch (n.whammyBarType) {
          case 0:
          case 1:
            return;
        }
        let s = this.renderer.settings.notation.notationMode;
        let a = this.renderer.scoreRenderer.layout.getRendererForBar(
          this.renderer.staff.staffId,
          n.voice.bar
        );
        let o = j(k, $.beat(i, 5, n));
        let l = e + a.x + a.getBeatX(n, 2);
        let u = this.getTieDirection(n, a);
        let c = this._beat.notes.length === 1 ? u : 0;
        let d = i.textAlign;
        let h = this.renderer.smuflMetrics.glyphHeights.get(57508);
        for (let R = 0; R < n.notes.length; R++) {
          var f = [];
          try {
            let g = n.notes[R];
            let x = j(f, $.note(i, 3, g));
            let M = r + a.y;
            R > 0 && R >= ((this._beat.notes.length / 2) | 0) && (c = 1);
            c === 1 ? (M += a.getNoteY(g, 3)) : (M += a.getNoteY(g, 1));
            let P = e + a.x;
            n.isLastOfVoice
              ? (P += a.postBeatGlyphsStart)
              : (P += a.getBeatX(n, 5));
            this._endGlyph && (P -= this._endGlyph.upLineX);
            let H = n.whammyStyle === 1 && R === 0 ? "grad." : "";
            let X = null;
            g.isTieOrigin &&
              ((X = this.renderer.scoreRenderer.layout.getRendererForBar(
                this.renderer.staff.staffId,
                g.tieDestination.beat.voice.bar
              )),
              X && X.staff === a.staff
                ? (P = e + X.x + X.getBeatX(g.tieDestination.beat, 2))
                : (X = null));
            let fe = h * ie.GraceScale * 0.5;
            c === 0 && (fe = -fe);
            let Ee =
              n.whammyBarPoints.length > 0
                ? this._getBendNoteValue(
                    g,
                    n.whammyBarPoints[n.whammyBarPoints.length - 1]
                  )
                : 0;
            let be = 0;
            let Ae = !1;
            this.bendNoteHeads.length > 0 &&
            this.bendNoteHeads[0].containsNoteValue(Ee)
              ? ((be = this.bendNoteHeads[0].getNoteValueY(Ee) + fe), (Ae = !0))
              : X &&
                ((g.isTieOrigin && g.tieDestination.beat.hasWhammyBar) ||
                  g.beat.isContinuedWhammy)
              ? ((be = r + X.y + X.getNoteY(g.tieDestination, 1)),
                (Ae = !0),
                c === 1 && (be += h))
              : g.isTieOrigin &&
                (X
                  ? (be = r + X.y + X.getNoteY(g.tieDestination, 1))
                  : (be = M),
                c === 1 && (be += h));
            switch (n.whammyBarType) {
              case 4:
                g.isTieOrigin &&
                  et.paintTie(
                    i,
                    1,
                    l,
                    M,
                    P,
                    be,
                    u === 1,
                    this.renderer.smuflMetrics.tieHeight,
                    this.renderer.smuflMetrics.slurMidpointThickness
                  );
                break;
              case 2:
                if (R === 0) {
                  this.bendNoteHeads[0].x =
                    P - this.bendNoteHeads[0].noteHeadOffset;
                  let wt = this.bendNoteHeads[0].y;
                  (this.bendNoteHeads[0].y = r + a.y),
                    this.bendNoteHeads[0].paint(0, 0, i),
                    this.bendNoteHeads[0].containsNoteValue(Ee) &&
                      ((be -= wt), (be += this.bendNoteHeads[0].y));
                }
                Ae
                  ? this.drawBendSlur(i, l, M, P, be, c === 1, 1, H)
                  : g.isTieOrigin &&
                    et.paintTie(
                      i,
                      1,
                      l,
                      M,
                      P,
                      be,
                      u === 1,
                      this.renderer.smuflMetrics.tieHeight,
                      this.renderer.smuflMetrics.slurMidpointThickness
                    );
                break;
              case 3:
                if (s === 1) {
                  if (R === 0) {
                    let wt = e + a.x + a.getBeatX(this._beat, 1),
                      Nt = e + a.x + a.getBeatX(this._beat, 4),
                      Re = (wt + Nt) / 2,
                      Pr = (
                        ((this._beat.whammyBarPoints[1].value -
                          this._beat.whammyBarPoints[0].value) /
                          4) |
                        0
                      ).toString();
                    (i.font = this.renderer.resources.tablatureFont),
                      i.fillText(Pr, Re, r + this.y);
                    let Et = r + this.y + i.font.size,
                      nt =
                        Et + this.renderer.smuflMetrics.songBookWhammyDipHeight;
                    this._beat.whammyBarPoints[1].value >
                    this._beat.whammyBarPoints[0].value
                      ? (i.moveTo(wt, nt), i.lineTo(Re, Et), i.lineTo(Nt, nt))
                      : (i.moveTo(wt, Et), i.lineTo(Re, nt), i.lineTo(Nt, Et)),
                      i.stroke();
                  }
                  g.isTieOrigin &&
                    et.paintTie(
                      i,
                      1,
                      l,
                      M,
                      P,
                      be,
                      u === 1,
                      this.renderer.smuflMetrics.tieHeight,
                      this.renderer.smuflMetrics.slurMidpointThickness
                    );
                } else {
                  let wt = (l + P) / 2;
                  (this.bendNoteHeads[0].x =
                    wt - this.bendNoteHeads[0].noteHeadOffset),
                    (this.bendNoteHeads[0].y = r + a.y),
                    this.bendNoteHeads[0].paint(0, 0, i);
                  let Nt = this._getBendNoteValue(g, n.whammyBarPoints[1]),
                    Re = this.bendNoteHeads[0].getNoteValueY(Nt) + fe;
                  this.drawBendSlur(i, l, M, wt, Re, c === 1, 1, H),
                    (this.bendNoteHeads[1].x =
                      P - this.bendNoteHeads[1].noteHeadOffset),
                    (this.bendNoteHeads[1].y = r + a.y),
                    this.bendNoteHeads[1].paint(0, 0, i),
                    (be = this.bendNoteHeads[1].getNoteValueY(Ee) + fe),
                    this.drawBendSlur(i, wt, Re, P, be, c === 1, 1, H);
                }
                break;
              case 6:
              case 5:
                let U = e + a.x + a.getBeatX(g.beat, 0);
                U += a.getPreNotesGlyphForBeat(g.beat).prebendNoteHeadOffset;
                let sr =
                  r +
                  a.y +
                  a.getScoreY(
                    a.accidentalHelper.getNoteLineForValue(
                      g.displayValue -
                        ((g.beat.whammyBarPoints[0].value / 2) | 0),
                      !1
                    )
                  ) +
                  fe;
                this.drawBendSlur(i, U, sr, l, M, c === 1, 1, H),
                  this.bendNoteHeads.length > 0 &&
                    ((this.bendNoteHeads[0].x =
                      P - this.bendNoteHeads[0].noteHeadOffset),
                    (this.bendNoteHeads[0].y = r + a.y),
                    this.bendNoteHeads[0].paint(0, 0, i),
                    this.drawBendSlur(i, l, M, P, be, c === 1, 1, H));
                break;
            }
          } catch (b) {
            var y = b,
              S = !0;
          } finally {
            ee(f, y, S);
          }
        }
        i.textAlign = d;
      } catch (T) {
        var O = T,
          N = !0;
      } finally {
        ee(k, O, N);
      }
    }
    _getBendNoteValue(e, r) {
      return e.displayValueWithoutBend + ((r.value / 2) | 0);
    }
  };
  var Cd = class extends ce {
    constructor(t, e, r, i, n) {
      super(t, e, n ? ie.GraceScale : 1, r.getSymbol(i)),
        (this._isGrace = n),
        (this._articulation = r);
    }
    paint(t, e, r) {
      let i = r.color;
      this.colorOverride && (r.color = this.colorOverride);
      let n = this._isGrace ? 1 : 0;
      ge.fillMusicFontSymbolSafe(
        r,
        t + this.x,
        e + this.y + n,
        this.glyphScale,
        this.symbol,
        !1
      ),
        this._articulation.techniqueSymbol !== -1 &&
          this._articulation.techniqueSymbolPlacement === 1 &&
          ge.fillMusicFontSymbolSafe(
            r,
            t + this.x,
            e + this.y + n,
            this.glyphScale,
            this._articulation.techniqueSymbol,
            !1
          ),
        (r.color = i);
    }
    doLayout() {
      super.doLayout(),
        this.width === 0 &&
          (this.height = this.renderer.smuflMetrics.glyphWidths.get(57508)),
        this.height === 0 &&
          (this.height = this.renderer.smuflMetrics.glyphHeights.get(57508));
    }
  };
  var Gl = class extends ce {
    constructor(t, e) {
      super(t, e, ie.GraceScale, 58530), (this.center = !0);
    }
    doLayout() {
      super.doLayout(), (this.offsetY = this.height);
    }
  };
  var Md = class extends ce {
    constructor(t, e) {
      super(t, e, 0.5, 59177), (this.center = !0);
    }
    doLayout() {
      super.doLayout(), (this.offsetY = this.height);
    }
  };
  var Id = class extends Ve {
    constructor() {
      super(...arguments);
      this._strings = new Set();
    }
    addString(e) {
      this._strings.add(e);
    }
    doLayout() {
      let e =
        this.renderer.smuflMetrics.glyphWidths.get(59443) *
        this.renderer.smuflMetrics.tuningGlyphCircleNumberScale;
      (this.height =
        (e + this.renderer.smuflMetrics.stringNumberCirclePadding) *
        this._strings.size),
        (this.width = e);
    }
    paint(e, r, i) {
      let n = this.renderer.bar.staff.tuning.length,
        s = 0,
        a =
          this.renderer.smuflMetrics.glyphWidths.get(59443) *
          this.renderer.smuflMetrics.tuningGlyphCircleNumberScale;
      for (let o of this._strings) {
        let l = n - o,
          u = 59444 + l;
        ge.fillMusicFontSymbolSafe(
          i,
          e + this.x,
          r + this.y + a + s,
          this.renderer.smuflMetrics.tuningGlyphCircleNumberScale,
          u,
          !0
        ),
          (s += a + this.renderer.smuflMetrics.stringNumberCirclePadding);
      }
    }
  };
  var oi = class p extends ce {
    constructor(e, r, i, n, s) {
      super(e, r, n ? ie.GraceScale : 1, p.getSymbol(i));
      this.beatEffects = new Map();
      this.noteHeadElement = 6;
      this.effectElement = 18;
      (this._symbol = p.getSymbol(i)), (this.beat = s);
    }
    paint(e, r, i) {
      var s = [];
      try {
        let n = j(
          s,
          this.beat.notes.length === 0
            ? void 0
            : $.note(i, this.noteHeadElement, this.beat.notes[0])
        );
        super.paint(e, r, i);
        this._paintEffects(e, r, i);
      } catch (a) {
        var o = a,
          l = !0;
      } finally {
        ee(s, o, l);
      }
    }
    _paintEffects(e, r, i) {
      var s = [];
      try {
        let n = j(s, $.beat(i, this.effectElement, this.beat));
        for (let u of this.beatEffects.values())
          u.paint(e + this.x, r + this.y, i);
      } catch (a) {
        var o = a,
          l = !0;
      } finally {
        ee(s, o, l);
      }
    }
    doLayout() {
      super.doLayout();
      let e = this.renderer.smuflMetrics.onNoteEffectPadding,
        r = this.renderer.smuflMetrics.glyphHeights.get(this._symbol);
      for (let i of this.beatEffects.values())
        (i.y += r),
          (i.x += this.width / 2),
          (i.renderer = this.renderer),
          i.doLayout(),
          (r += i.height + e);
    }
    static getSymbol(e) {
      switch (e) {
        case -4:
        case -2:
        case 1:
          return 57602;
        case 2:
          return 57603;
        default:
          return 57601;
      }
    }
    updateBeamingHelper(e) {
      if (this.beamingHelper) {
        let r = this._symbol,
          i = this.renderer.smuflMetrics.stemUp.has(r)
            ? this.renderer.smuflMetrics.stemUp.get(r).x
            : 0,
          n = this.renderer.smuflMetrics.stemDown.has(r)
            ? this.renderer.smuflMetrics.stemDown.get(r).x
            : 0;
        this.beamingHelper.registerBeatLineX(
          "slash",
          this.beat,
          e + this.x + i,
          e + this.x + n
        );
      }
    }
  };
  var Ld = class extends _t {
    constructor() {
      super(...arguments);
      this._collisionOffset = -1e3;
      this._skipPaint = !1;
      this.noteHeads = null;
      this.restGlyph = null;
    }
    get effectElement() {
      return 5;
    }
    getNoteX(e, r) {
      return this.noteHeads ? this.noteHeads.getNoteX(e, r) : 0;
    }
    buildBoundingsLookup(e, r, i) {
      this.noteHeads &&
        this.noteHeads.buildBoundingsLookup(e, r + this.x, i + this.y);
    }
    getLowestNoteY() {
      return this.noteHeads ? this.noteHeads.getLowestNoteY() : 0;
    }
    getHighestNoteY() {
      return this.noteHeads ? this.noteHeads.getHighestNoteY() : 0;
    }
    getNoteY(e, r) {
      return this.noteHeads ? this.noteHeads.getNoteY(e, r) : 0;
    }
    updateBeamingHelper() {
      if (this.noteHeads)
        this.noteHeads.updateBeamingHelper(this.container.x + this.x);
      else if (
        this.restGlyph &&
        (this.restGlyph.updateBeamingHelper(this.container.x + this.x),
        this.renderer.bar.isMultiVoice && this._collisionOffset === -1e3)
      ) {
        (this._collisionOffset =
          this.renderer.helpers.collisionHelper.applyRestCollisionOffset(
            this.container.beat,
            this.restGlyph.y,
            this.renderer.getScoreHeight(1)
          )),
          (this.y += this._collisionOffset);
        let e =
          this.renderer.helpers.collisionHelper.restDurationsByDisplayTime;
        e.has(this.container.beat.playbackStart) &&
          e
            .get(this.container.beat.playbackStart)
            .has(this.container.beat.playbackDuration) &&
          e
            .get(this.container.beat.playbackStart)
            .get(this.container.beat.playbackDuration) !==
            this.container.beat.id &&
          (this._skipPaint = !0);
      }
    }
    paint(e, r, i) {
      this._skipPaint || super.paint(e, r, i);
    }
    doLayout() {
      let e = this.renderer;
      if (!this.container.beat.isEmpty)
        if (this.container.beat.isRest) {
          let r =
            Math.ceil(
              (this.renderer.bar.staff.standardNotationLineCount - 1) / 2
            ) * 2;
          this.container.beat.duration === 1 &&
            this.renderer.bar.staff.standardNotationLineCount !== 1 &&
            this.renderer.bar.staff.standardNotationLineCount !== 3 &&
            (r -= 2);
          let i = new jn(0, e.getScoreY(r), this.container.beat.duration);
          if (
            ((this.restGlyph = i),
            (i.beat = this.container.beat),
            (i.beamingHelper = this.beamingHelper),
            this.addNormal(i),
            this.renderer.bar.isMultiVoice)
          )
            if (this.container.beat.voice.index === 0) {
              let n = ni.computeLineHeightsForRest(
                  this.container.beat.duration
                ),
                s = i.y - e.getScoreHeight(n[0]),
                a = i.y + e.getScoreHeight(n[1]);
              this.renderer.helpers.collisionHelper.reserveBeatSlot(
                this.container.beat,
                s,
                a
              );
            } else
              this.renderer.helpers.collisionHelper.registerRest(
                this.container.beat
              );
          if (
            (this.beamingHelper &&
              this.beamingHelper.applyRest(this.container.beat, r),
            this.container.beat.dots > 0)
          )
            for (let n = 0; n < this.container.beat.dots; n++) {
              let s = new rt(0, 0);
              (s.renderer = this.renderer),
                this._createBeatDot(r, s),
                this.addEffect(s);
            }
        } else {
          let r = new Pd();
          (this.noteHeads = r),
            (r.beat = this.container.beat),
            (r.beamingHelper = this.beamingHelper);
          let i = new rn(!1);
          i.renderer = this.renderer;
          for (let n of this.container.beat.notes)
            n.isVisible &&
              (!n.beat.slashed || n.index === 0) &&
              (this._createNoteGlyph(n), i.addParenthesis(n));
          if (
            (this.addNormal(r),
            i.isEmpty || this.addEffect(i),
            this.container.beat.hasWhammyBar)
          ) {
            let n = new Ad(this.container.beat);
            (n.renderer = this.renderer),
              n.doLayout(),
              this.container.ties.push(n);
          }
          if (this.container.beat.dots > 0)
            for (let n = 0; n < this.container.beat.dots; n++) {
              let s = new rt(0, 0);
              s.renderer = this.renderer;
              for (let a of this.container.beat.notes) {
                let o = this._createBeatDot(e.getNoteLine(a), s);
                o.colorOverride = $.noteColor(e.resources, 3, a);
              }
              this.addEffect(s);
            }
        }
      super.doLayout(),
        this.container.beat.isEmpty
          ? (this.centerX = this.width / 2)
          : this.restGlyph
          ? (this.centerX = this.restGlyph.x + this.restGlyph.width / 2)
          : this.noteHeads &&
            (this.centerX = this.noteHeads.x + this.noteHeads.width / 2);
    }
    _createBeatDot(e, r) {
      let i = this.renderer,
        n = new gi(0, i.getScoreY(e));
      return r.addGlyph(n), n;
    }
    _createNoteHeadGlyph(e) {
      let r = this.container.beat.graceType !== 0,
        i = e.style;
      if (i?.noteHead !== void 0) {
        let n = new ie(0, 0, e.beat.duration, r);
        return (
          (n.symbol = i.noteHead),
          i.noteHeadCenterOnStem && (n.centerOnStem = !0),
          n
        );
      }
      if (e.beat.voice.bar.staff.isPercussion) {
        let n = He.getArticulation(e);
        if (n) return new Cd(0, 0, n, e.beat.duration, r);
        w.warning(
          "Rendering",
          `No articulation found for percussion instrument ${e.percussionArticulation}`
        );
      }
      return e.beat.slashed
        ? new oi(0, 0, e.beat.duration, r, e.beat)
        : e.isDead
        ? new wd(0, 0, r)
        : e.beat.graceType === 3
        ? new ie(0, 0, 4, !0)
        : e.harmonicType === 1
        ? new Ol(0, 0, e.beat.duration, r)
        : new ie(0, 0, e.beat.duration, r);
    }
    _createNoteGlyph(e) {
      if (e.beat.graceType === 3 && !e.hasBend) return;
      let r = this.renderer,
        i = this._createNoteHeadGlyph(e);
      i.colorOverride = $.noteColor(r.resources, 1, e);
      let n;
      if (
        (e.beat.slashed ? (n = r.heightLineCount - 1) : (n = r.getNoteLine(e)),
        (i.y = r.getScoreY(n)),
        this.noteHeads.addMainNoteGlyph(i, e, n),
        !e.beat.slashed && e.harmonicType !== 0 && e.harmonicType !== 1)
      ) {
        let l = e.displayValue + e.harmonicPitch,
          u = new Ol(
            0,
            0,
            e.beat.duration,
            this.container.beat.graceType !== 0
          );
        (u.colorOverride = i.colorOverride),
          (n = r.accidentalHelper.getNoteLineForValue(l, !1)),
          (u.y = r.getScoreY(n)),
          this.noteHeads.addEffectNoteGlyph(u, n);
      }
      let s = this.noteHeads.belowBeatEffects,
        a = this.noteHeads.aboveBeatEffects,
        o =
          this.beamingHelper.direction === 0
            ? this.noteHeads.belowBeatEffects
            : this.noteHeads.aboveBeatEffects;
      if (
        (e.isStaccato && !s.has("Staccato") && o.set("Staccato", new Gl(0, 0)),
        e.accentuated === 1 &&
          !s.has("Accent") &&
          o.set("Accent", new eo(0, 0, e)),
        e.accentuated === 2 &&
          !s.has("HAccent") &&
          o.set("HAccent", new eo(0, 0, e)),
        e.accentuated === 3 &&
          !s.has("Tenuto") &&
          o.set("Tenuto", new eo(0, 0, e)),
        e.showStringNumber && e.isStringed)
      ) {
        let l;
        a.has("StringNumber")
          ? (l = a.get("StringNumber"))
          : ((l = new Id(0, 0)), a.set("StringNumber", l)),
          l.addString(e.string);
      }
      if (e.isPercussion) {
        let l = He.getArticulation(e);
        if (l && l.techniqueSymbolPlacement !== 1) {
          let u;
          switch (l.techniqueSymbolPlacement) {
            case 0:
              u = this.noteHeads.aboveBeatEffects;
              break;
            case 2:
              u = this.noteHeads.belowBeatEffects;
              break;
            case 3:
              u = o;
              break;
            default:
              return;
          }
          switch (l.techniqueSymbol) {
            case 59177:
              u.set("PictEdgeOfCymbal", new Md(0, 0));
              break;
            case 58530:
              u.set("ArticStaccatoAbove", new Gl(0, 0));
              break;
            case 58898:
              u.set("StringsUpBow", new As(0, 0, 1));
              break;
            case 58896:
              u.set("StringsDownBow", new As(0, 0, 2));
              break;
            case 59458:
              u.set("GuitarGolpe", new Ja(0, 0, !0));
              break;
          }
        }
      }
    }
  };
  var Dd = class extends ue {
    constructor(t) {
      super(0, 0), (this._beat = t);
    }
    doLayout() {
      if (this._beat.brushType === 3 || this._beat.brushType === 4) {
        let t = new Vt(0, 0, 1, !0);
        (t.renderer = this.renderer),
          t.doLayout(),
          (this._noteVibratoGlyph = t),
          (this.width = t.height);
      } else this.width = 0;
    }
    paint(t, e, r) {
      if (this._beat.brushType === 3 || this._beat.brushType === 4) {
        // Check if all notes in the beat are dead visual
        let allDeadVisual = true;
        for (let note of this._beat.notes) {
          if (!note.isDeadVisual) {
            allDeadVisual = false;
            break;
          }
        }
        
        let i = this.renderer,
          n = i.lineOffset,
          s = e + this.y + (i.getNoteY(this._beat.maxNote, 3) - n) - 5,
          a = e + this.y + i.getNoteY(this._beat.minNote, 1) + n - 5,
          // Only add offset if all notes are dead visual
          o = t + this.x + this.width / 2 + (allDeadVisual ? 8 : 0),
          l = this.renderer.smuflMetrics.glyphWidths.get(60284),
          u = this._noteVibratoGlyph;
        if (this._beat.brushType === 3) {
          let c = s + l,
            d = a - l;
          const waveHeight = 5;
          const waveWidth = 3;
          const waveCount = Math.floor(Math.abs(d - c) / waveHeight);
          
          // 
          r.beginPath();
          r.moveTo(o, c);
          
          let lastY = c;
          for (let i = 1; i <= waveCount; i++) {
            const y = c + i * waveHeight;
            if (i % 2 === 1) {
              r.quadraticCurveTo(o - waveWidth, y - waveHeight / 2, o, y);
            } else {
              r.quadraticCurveTo(o + waveWidth, y - waveHeight / 2, o, y);
            }
            lastY = y;
          }
          
          // 
          if (lastY < d) {
            const remainingHeight = d - lastY;
            const controlX = waveCount % 2 === 1 ? o + waveWidth : o - waveWidth;
            r.quadraticCurveTo(controlX, lastY + remainingHeight / 2, o, d);
          }
          
          r.stroke();
          
          // 
          r.beginPath(),
            r.moveTo(o, a),
            r.lineTo(o + l / 2, a - l),
            r.lineTo(o - l / 2, a - l),
            r.closePath(),
            r.fill();
          
          // 
          r.beginPath(),
            r.moveTo(o, a - l),
            r.lineTo(o, a),
            r.stroke();
        } else if (this._beat.brushType === 4) {
          let c = s + l,
            d = a;
          const waveHeight = 5;
          const waveWidth = 3;
          const waveCount = Math.floor(Math.abs(d - c) / waveHeight);
          
          // 
          r.beginPath();
          r.moveTo(o, c);
          
          for (let i = 1; i <= waveCount; i++) {
            const y = c + i * waveHeight;
            if (i % 2 === 1) {
              r.quadraticCurveTo(o + waveWidth, y - waveHeight / 2, o, y);
            } else {
              r.quadraticCurveTo(o - waveWidth, y - waveHeight / 2, o, y);
            }
          }
          r.stroke();
          
          // 
          r.beginPath(),
            r.moveTo(o, s),
            r.lineTo(o + l / 2, s + l),
            r.lineTo(o - l / 2, s + l),
            r.closePath(),
            r.fill();
          
          // 
          r.beginPath(),
            r.moveTo(o, s),
            r.lineTo(o, s + l),
            r.stroke();
        }
      }
    }
  };
  var Fd = class extends vt {
    constructor() {
      super(...arguments);
      this._prebends = null;
      this.accidentals = null;
    }
    get prebendNoteHeadOffset() {
      return this._prebends
        ? this._prebends.x + this._prebends.noteHeadOffset
        : 0;
    }
    get effectElement() {
      return 5;
    }
    doLayout() {
      if (!this.container.beat.isRest) {
        let e = new Qn();
        e.renderer = this.renderer;
        let r = new Ya();
        r.renderer = this.renderer;
        let i = new rn(!0);
        i.renderer = this.renderer;
        let n = new Hr(this.container.beat, !0);
        (this._prebends = n), (n.renderer = this.renderer);
        let s = !1;
        for (let a of this.container.beat.notes) {
          let o = $.noteColor(this.renderer.resources, 3, a);
          if (a.isVisible) {
            if (a.hasBend)
              switch (a.bendType) {
                case 7:
                case 6:
                case 8:
                  n.addGlyph(
                    a.displayValue - ((a.bendPoints[0].value / 2) | 0),
                    !1,
                    o
                  );
                  break;
              }
            else if (a.beat.hasWhammyBar)
              switch (a.beat.whammyBarType) {
                case 6:
                case 5:
                  this._prebends.addGlyph(
                    a.displayValue -
                      ((a.beat.whammyBarPoints[0].value / 2) | 0),
                    !1,
                    o
                  );
                  break;
              }
            switch (
              (this._createAccidentalGlyph(a, e),
              i.addParenthesis(a),
              r.addFingers(a),
              a.slideInType)
            ) {
              case 1:
              case 2:
                s = !0;
                break;
            }
          }
        }
        s &&
          this.addNormal(
            new Ke(
              0,
              0,
              this.renderer.smuflMetrics.simpleSlideWidth *
                (this.container.beat.graceType !== 0 ? ie.GraceScale : 1)
            )
          ),
          n.isEmpty ||
            (this.addEffect(n),
            this.addNormal(
              new Ke(
                0,
                0,
                this.renderer.smuflMetrics.preNoteEffectPadding *
                  (this.container.beat.graceType !== 0 ? ie.GraceScale : 1)
              )
            )),
          this.container.beat.brushType !== 0 &&
            (this.addEffect(new Dd(this.container.beat)),
            this.addNormal(
              new Ke(
                0,
                0,
                this.renderer.smuflMetrics.preNoteEffectPadding *
                  (this.container.beat.graceType !== 0 ? ie.GraceScale : 1)
              )
            )),
          r.isEmpty ||
            (this.isEmpty ||
              this.addNormal(
                new Ke(
                  0,
                  0,
                  this.renderer.smuflMetrics.preNoteEffectPadding *
                    (this.container.beat.graceType !== 0 ? ie.GraceScale : 1)
                )
              ),
            this.addEffect(r),
            this.addNormal(
              new Ke(
                0,
                0,
                this.renderer.smuflMetrics.preNoteEffectPadding *
                  (this.container.beat.graceType !== 0 ? ie.GraceScale : 1)
              )
            )),
          i.isEmpty || this.addEffect(i),
          e.isEmpty ||
            ((this.accidentals = e),
            this.isEmpty ||
              this.addNormal(
                new Ke(
                  0,
                  0,
                  this.renderer.smuflMetrics.preNoteEffectPadding *
                    (this.container.beat.graceType !== 0 ? ie.GraceScale : 1)
                )
              ),
            this.addNormal(e),
            this.addNormal(
              new Ke(
                0,
                0,
                this.renderer.smuflMetrics.preNoteEffectPadding *
                  (this.container.beat.graceType !== 0 ? ie.GraceScale : 1)
              )
            ));
      }
      super.doLayout();
    }
    _createAccidentalGlyph(e, r) {
      let i = this.renderer,
        n = i.accidentalHelper.applyAccidental(e),
        s = i.getNoteLine(e),
        a = this.container.beat.graceType !== 0,
        o = $.noteColor(i.resources, 2, e),
        l = a ? ie.GraceScale : 1;
      if (n !== 0) {
        let u = new mr(0, i.getScoreY(s), n, l);
        (u.colorOverride = o), (u.renderer = this.renderer), r.addGlyph(u);
      }
      if (e.harmonicType !== 0 && e.harmonicType !== 1) {
        let u = e.displayValue + e.harmonicPitch;
        (n = i.accidentalHelper.applyAccidentalForValue(e.beat, u, a, !1)),
          (s = i.accidentalHelper.getNoteLineForValue(u, !1));
        let c = new mr(0, i.getScoreY(s), n, l);
        (c.colorOverride = o), (c.renderer = this.renderer), r.addGlyph(c);
      }
    }
  };
  var Rd = class extends io {
    constructor(e) {
      super(0, 0);
      this._notes = [];
      this._endNoteGlyph = null;
      this._middleNoteGlyph = null;
      this._beat = e;
    }
    addBends(e) {
      if ((this._notes.push(e), e.isTieOrigin)) return;
      let r = $.noteColor(this.renderer.resources, 3, e);
      switch (e.bendType) {
        case 2:
        case 8:
        case 7:
          {
            let i = this._endNoteGlyph;
            i ||
              ((i = new Hr(e.beat, !1)),
              (i.renderer = this.renderer),
              (this._endNoteGlyph = i),
              this.bendNoteHeads.push(i));
            let n = e.bendPoints[e.bendPoints.length - 1];
            i.addGlyph(this._getBendNoteValue(e, n), n.value % 2 !== 0, r);
          }
          break;
        case 3:
          if (!e.isTieOrigin) {
            let i = this._endNoteGlyph;
            i ||
              ((i = new Hr(e.beat, !1)),
              (i.renderer = this.renderer),
              (this._endNoteGlyph = i),
              this.bendNoteHeads.push(i));
            let n = e.bendPoints[e.bendPoints.length - 1];
            i.addGlyph(this._getBendNoteValue(e, n), n.value % 2 !== 0, r);
          }
          break;
        case 4:
          {
            let i = this._middleNoteGlyph;
            i ||
              ((i = new Hr(e.beat, !1)),
              (this._middleNoteGlyph = i),
              (i.renderer = this.renderer),
              this.bendNoteHeads.push(i));
            let n = e.bendPoints[1];
            i.addGlyph(
              this._getBendNoteValue(e, e.bendPoints[1]),
              n.value % 2 !== 0,
              r
            );
            let s = this._endNoteGlyph;
            s ||
              ((s = new Hr(e.beat, !1)),
              (s.renderer = this.renderer),
              (this._endNoteGlyph = s),
              this.bendNoteHeads.push(s));
            let a = e.bendPoints[e.bendPoints.length - 1];
            s.addGlyph(this._getBendNoteValue(e, a), a.value % 2 !== 0, r);
          }
          break;
      }
    }
    paint(e, r, i) {
      let n = this.renderer.scoreRenderer.layout.getRendererForBar(
          this.renderer.staff.staffId,
          this._beat.voice.bar
        ),
        s = e + n.x + n.getBeatX(this._beat, 2),
        a = e + n.x;
      this._beat.isLastOfVoice
        ? (a += n.postBeatGlyphsStart)
        : (a += n.getBeatX(this._beat.nextBeat, 0)),
        this._endNoteGlyph && (a -= this._endNoteGlyph.upLineX);
      let o = (s + a) / 2;
      this._middleNoteGlyph &&
        ((this._middleNoteGlyph.x = o - this._middleNoteGlyph.noteHeadOffset),
        (this._middleNoteGlyph.y = r + n.y),
        this._middleNoteGlyph.paint(0, 0, i)),
        this._endNoteGlyph &&
          ((this._endNoteGlyph.x = a - this._endNoteGlyph.noteHeadOffset),
          (this._endNoteGlyph.y = r + n.y),
          this._endNoteGlyph.paint(0, 0, i)),
        this._notes.sort((y, S) => S.displayValue - y.displayValue);
      let l = this._beat.graceType === 3 ? this._beat.nextBeat : this._beat,
        u = this._notes.length === 1 ? this.getTieDirection(l, n) : 0,
        c = this.renderer.smuflMetrics.glyphHeights.get(57508);
      for (let y = 0; y < this._notes.length; y++) {
        var d = [];
        try {
          let S = this._notes[y];
          let k = j(d, $.note(i, 3, S));
          y > 0 && y >= ((this._notes.length / 2) | 0) && (u = 1);
          let T = r + n.y + n.getNoteY(S, 1);
          let O = c * ie.GraceScale * 0.5;
          u === 1 && (T += c);
          let N = S.bendStyle === 1 ? "grad." : "";
          if (S.isTieOrigin) {
            let R = S.tieDestination,
              g = R
                ? this.renderer.scoreRenderer.layout.getRendererForBar(
                    this.renderer.staff.staffId,
                    R.beat.voice.bar
                  )
                : null;
            if (!g || g.staff !== n.staff) {
              let x = e + n.x + n.width,
                M = S.tieDestination.realValue;
              n.accidentalHelper.applyAccidentalForValue(S.beat, M, !1, !0);
              let P =
                r +
                n.y +
                n.getScoreY(n.accidentalHelper.getNoteLineForValue(M, !1));
              S.bendType === 5 || S.bendType === 6
                ? et.paintTie(
                    i,
                    1,
                    s,
                    T,
                    x,
                    P,
                    u === 1,
                    this.renderer.smuflMetrics.tieHeight,
                    this.renderer.smuflMetrics.slurMidpointThickness
                  )
                : this.drawBendSlur(i, s, T, x, P, u === 1, 1, N);
            } else {
              let x = e + g.x + g.getBeatX(R.beat, 2),
                M = r + g.y + g.getNoteY(R, 1);
              u === 1 && (M += c),
                S.bendType === 5 || S.bendType === 6
                  ? et.paintTie(
                      i,
                      1,
                      s,
                      T,
                      x,
                      M,
                      u === 1,
                      this.renderer.smuflMetrics.tieHeight,
                      this.renderer.smuflMetrics.slurMidpointThickness
                    )
                  : this.drawBendSlur(i, s, T, x, M, u === 1, 1, N);
            }
            switch (S.bendType) {
              case 6:
              case 7:
              case 8:
                let x = e + n.x + n.getBeatX(S.beat, 0);
                x += n.getPreNotesGlyphForBeat(S.beat).prebendNoteHeadOffset;
                let M =
                  r +
                  n.y +
                  n.getScoreY(
                    n.accidentalHelper.getNoteLineForValue(
                      S.displayValue - ((S.bendPoints[0].value / 2) | 0),
                      !1
                    )
                  ) +
                  O;
                this.drawBendSlur(i, x, M, s, T, u === 1, 1);
                break;
            }
          } else {
            u === 0 && (O = -O);
            let R = 0,
              g = 0;
            switch (S.bendType) {
              case 2:
                (R = this._getBendNoteValue(
                  S,
                  S.bendPoints[S.bendPoints.length - 1]
                )),
                  (g = this._endNoteGlyph.getNoteValueY(R) + O),
                  this.drawBendSlur(i, s, T, a, g, u === 1, 1, N);
                break;
              case 4:
                let x = this._getBendNoteValue(S, S.bendPoints[1]),
                  M = this._middleNoteGlyph.getNoteValueY(x) + O;
                this.drawBendSlur(i, s, T, o, M, u === 1, 1, N),
                  (R = this._getBendNoteValue(
                    S,
                    S.bendPoints[S.bendPoints.length - 1]
                  )),
                  (g = this._endNoteGlyph.getNoteValueY(R) + O),
                  this.drawBendSlur(i, o, M, a, g, u === 1, 1, N);
                break;
              case 3:
                this.bendNoteHeads.length > 0 &&
                  ((R = this._getBendNoteValue(
                    S,
                    S.bendPoints[S.bendPoints.length - 1]
                  )),
                  (g = this.bendNoteHeads[0].getNoteValueY(R) + O),
                  this.drawBendSlur(i, s, T, a, g, u === 1, 1, N));
                break;
              case 6:
              case 7:
              case 8:
                let P = e + n.x + n.getBeatX(S.beat, 0);
                P += n.getPreNotesGlyphForBeat(S.beat).prebendNoteHeadOffset;
                let H =
                  r +
                  n.y +
                  n.getScoreY(
                    n.accidentalHelper.getNoteLineForValue(
                      S.displayValue - ((S.bendPoints[0].value / 2) | 0),
                      !1
                    )
                  ) +
                  O;
                this.drawBendSlur(i, P, H, s, T, u === 1, 1),
                  this.bendNoteHeads.length > 0 &&
                    ((R = this._getBendNoteValue(
                      S,
                      S.bendPoints[S.bendPoints.length - 1]
                    )),
                    (g = this.bendNoteHeads[0].getNoteValueY(R) + O),
                    this.drawBendSlur(i, s, T, a, g, u === 1, 1, N));
                break;
            }
          }
        } catch (h) {
          var f = h,
            b = !0;
        } finally {
          ee(d, f, b);
        }
      }
    }
    _getBendNoteValue(e, r) {
      return e.displayValueWithoutBend + ((r.value / 2) | 0);
    }
  };
  var Ds = class extends et {
    constructor(t, e, r = !1) {
      super(t, e, r);
    }
    doLayout() {
      super.doLayout();
    }
    getBeamDirection(t, e) {
      return t.isRest ? 0 : e.getBeatDirection(t) === 0 ? 1 : 0;
    }
    getStartY() {
      return this.startBeat.isRest
        ? this.startNoteRenderer.getScoreY(9)
        : this.tieDirection === 0
        ? this.startNoteRenderer.getNoteY(this.startBeat.maxNote, 1)
        : this.startNoteRenderer.getNoteY(this.startBeat.minNote, 3);
    }
    getEndY() {
      let t = this.endNoteRenderer;
      if (this.endBeat.isRest)
        return this.tieDirection === 0 ? t.getScoreY(9) : t.getScoreY(0);
      let e = this.startNoteRenderer.getBeatDirection(this.startBeat),
        r = t.getBeatDirection(this.endBeat);
      return e !== r && this.startBeat.graceType === 0
        ? r === this.tieDirection
          ? this.tieDirection === 0
            ? t.getNoteY(this.endBeat.maxNote, 0)
            : t.getNoteY(this.endBeat.minNote, 4)
          : this.tieDirection === 0
          ? t.getNoteY(this.endBeat.maxNote, 4)
          : t.getNoteY(this.endBeat.minNote, 0)
        : this.tieDirection === 0
        ? t.getNoteY(this.endBeat.maxNote, 1)
        : t.getNoteY(this.endBeat.minNote, 3);
    }
    getStartX() {
      return this.startNoteRenderer.getBeatX(this.startBeat, 2);
    }
    getEndX() {
      let t = this.endNoteRenderer.getBeatDirection(this.endBeat);
      return this.endNoteRenderer.getBeatX(
        this.endBeat,
        this.endBeat.duration > 1 && t === this.tieDirection ? 3 : 2
      );
    }
  };
  var Od = class extends ue {
    constructor(t, e, r, i) {
      super(0, 0),
        (this._outType = e),
        (this._inType = t),
        (this._startNote = r),
        (this._parent = i);
    }
    doLayout() {
      this.width = 0;
    }
    paint(t, e, r) {
      this._paintSlideIn(t, e, r), this._drawSlideOut(t, e, r);
    }
    _paintSlideIn(t, e, r) {
      let i = this.renderer,
        n = i.smuflMetrics.simpleSlideWidth,
        s =
          t +
          i.x +
          i.getNoteX(this._startNote, 0) -
          i.smuflMetrics.preNoteEffectPadding,
        a = e + i.y + i.getNoteY(this._startNote, 2),
        o = s - n,
        l = e + i.y;
      switch (this._inType) {
        case 1:
          l += i.getNoteY(this._startNote, 3);
          break;
        case 2:
          l += i.getNoteY(this._startNote, 1);
          break;
        default:
          return;
      }
      let u = this._getAccidentalsWidth(i, this._startNote.beat);
      (o -= u), (s -= u), this._paintSlideLine(r, !1, o, s, l, a);
    }
    _getAccidentalsWidth(t, e) {
      let r = t.getPreNotesGlyphForBeat(e);
      return r && r.accidentals ? r.accidentals.width : 0;
    }
    _drawSlideOut(t, e, r) {
      let i = this.renderer,
        n = i.smuflMetrics.simpleSlideWidth,
        s = i.smuflMetrics.postNoteEffectPadding,
        a = 0,
        o = 0,
        l = 0,
        u = 0,
        c = !1;
      switch (this._outType) {
        case 1:
        case 2:
          if (
            ((a = t + i.x + i.getBeatX(this._startNote.beat, 4) + s),
            (o = e + i.y + i.getNoteY(this._startNote, 2)),
            this._startNote.slideTarget)
          ) {
            let d = this.renderer.scoreRenderer.layout.getRendererForBar(
              this.renderer.staff.staffId,
              this._startNote.slideTarget.beat.voice.bar
            );
            !d || d.staff !== i.staff
              ? ((l = t + i.x + i.width),
                this._startNote.slideTarget.realValue >
                this._startNote.realValue
                  ? (u = e + i.y + i.getNoteY(this._startNote, 1))
                  : (u = e + i.y + i.getNoteY(this._startNote, 3)))
              : ((l =
                  t +
                  d.x +
                  d.getBeatX(this._startNote.slideTarget.beat, 0) -
                  s),
                (u = e + d.y + d.getNoteY(this._startNote.slideTarget, 2)));
          } else (l = t + i.x + this._parent.x), (u = o);
          break;
        case 3:
          (a = t + i.x + i.getNoteX(this._startNote, 2) + s),
            (o = e + i.y + i.getNoteY(this._startNote, 2)),
            (l = a + n),
            (u = e + i.y + i.getNoteY(this._startNote, 1));
          break;
        case 4:
          (a = t + i.x + i.getNoteX(this._startNote, 2) + s),
            (o = e + i.y + i.getNoteY(this._startNote, 2)),
            (l = a + n),
            (u = e + i.y + i.getNoteY(this._startNote, 3));
          break;
        case 6:
          (a = t + i.x + i.getNoteX(this._startNote, 2) + s * 2),
            (o = e + i.y + i.getNoteY(this._startNote, 2)),
            (u = e + i.y + i.getNoteY(this._startNote, 1)),
            (l = t + i.x + i.width),
            this._startNote.beat.nextBeat &&
              this._startNote.beat.nextBeat.voice ===
                this._startNote.beat.voice &&
              (l = t + i.x + i.getBeatX(this._startNote.beat.nextBeat, 0)),
            (c = !0);
          break;
        case 5:
          (a = t + i.x + i.getNoteX(this._startNote, 2) + s * 2),
            (o = e + i.y + i.getNoteY(this._startNote, 2)),
            (u = e + i.y + i.getNoteY(this._startNote, 3)),
            (l = t + i.x + i.width),
            this._startNote.beat.nextBeat &&
              this._startNote.beat.nextBeat.voice ===
                this._startNote.beat.voice &&
              (l = t + i.x + i.getBeatX(this._startNote.beat.nextBeat, 0)),
            (c = !0);
          break;
        default:
          return;
      }
      this._paintSlideLine(r, c, a, l, o, u);
    }
    _paintSlideLine(t, e, r, i, n, s) {
      if (e) {
        let a = new Vt(0, 0, 1);
        (a.renderer = this.renderer),
          a.doLayout(),
          (n -= a.height / 2),
          (s -= a.height / 2);
        let o = i - r,
          l = s - n,
          u = Math.sqrt(Math.pow(l, 2) + Math.pow(o, 2));
        a.width = o;
        let c = Math.asin(l / u) * (180 / Math.PI);
        t.beginRotate(r, n, c), a.paint(0, 0, t), t.endRotate();
      } else t.beginPath(), t.moveTo(r, n), t.lineTo(i, s), t.stroke();
    }
  };
  var Fs = class extends Ds {
    constructor(t, e, r = !1) {
      super(t.beat, e.beat, r), (this._startNote = t), (this._endNote = e);
    }
    getTieHeight(t, e, r, i) {
      return (
        (Math.log2(r - t + 1) * this.renderer.settings.notation.slurHeight) / 2
      );
    }
    getStartY() {
      return this._isStartCentered()
        ? this.tieDirection === 0
          ? this.startNoteRenderer.getNoteY(this._startNote, 1)
          : this.startNoteRenderer.getNoteY(this._startNote, 3)
        : this.startNoteRenderer.getNoteY(this._startNote, 2);
    }
    getEndY() {
      return this._isEndCentered()
        ? this._isEndOnStem()
          ? this.tieDirection === 0
            ? this.endNoteRenderer.getNoteY(this._endNote, 0)
            : this.endNoteRenderer.getNoteY(this._endNote, 4)
          : this.tieDirection === 0
          ? this.endNoteRenderer.getNoteY(this._endNote, 1)
          : this.endNoteRenderer.getNoteY(this._endNote, 3)
        : this.endNoteRenderer.getNoteY(this._endNote, 2);
    }
    _isStartCentered() {
      return (
        (this._startNote === this._startNote.beat.maxNote &&
          this.tieDirection === 0) ||
        (this._startNote === this._startNote.beat.minNote &&
          this.tieDirection === 1)
      );
    }
    _isEndCentered() {
      return (
        this._startNote.beat.graceType === 0 &&
        ((this._endNote === this._endNote.beat.maxNote &&
          this.tieDirection === 0) ||
          (this._endNote === this._endNote.beat.minNote &&
            this.tieDirection === 1))
      );
    }
    _isEndOnStem() {
      let t = this.endNoteRenderer,
        e = this.startNoteRenderer.getBeatDirection(this.startBeat),
        r = t.getBeatDirection(this.endBeat);
      return e !== r && this.startBeat.graceType === 0;
    }
    getStartX() {
      return this._isStartCentered()
        ? this.startNoteRenderer.getBeatX(this._startNote.beat, 2)
        : this.startNoteRenderer.getNoteX(this._startNote, 2);
    }
    getEndX() {
      return this._isEndCentered()
        ? this._isEndOnStem()
          ? this.endNoteRenderer.getBeatX(this._endNote.beat, 3)
          : this.endNoteRenderer.getNoteX(this._endNote, 1)
        : this.endNoteRenderer.getBeatX(this._endNote.beat, 0);
    }
  };
  var Vl = class extends et {
    constructor(t, e, r = !1) {
      super(t ? t.beat : null, e ? e.beat : null, r),
        (this.startNote = t),
        (this.endNote = e);
    }
    shouldDrawBendSlur() {
      return (
        this.renderer.settings.notation.extendBendArrowsOnTiedNotes &&
        !!this.startNote.bendOrigin &&
        this.startNote.isTieOrigin
      );
    }
    doLayout() {
      super.doLayout();
    }
    getBeamDirection(t, e) {
      return e.getBeatDirection(t) === 0 ? 1 : 0;
    }
    getStartY() {
      return this.startBeat.isRest
        ? this.startNoteRenderer.getScoreY(9)
        : this.tieDirection === 0
        ? this.startNoteRenderer.getNoteY(this.startNote, 1)
        : this.startNoteRenderer.getNoteY(this.startNote, 3);
    }
    getEndY() {
      let t = this.endNoteRenderer;
      return this.endBeat.isRest
        ? this.tieDirection === 0
          ? t.getScoreY(9)
          : t.getScoreY(0)
        : this.tieDirection === 0
        ? t.getNoteY(this.endNote, 1)
        : t.getNoteY(this.endNote, 3);
    }
    getStartX() {
      return this.startNoteRenderer.getBeatX(this.startNote.beat, 4);
    }
    getEndX() {
      return this.endNoteRenderer.getBeatX(this.endNote.beat, 0);
    }
  };
  var Gd = class extends ft {
    constructor() {
      super(...arguments);
      this._bend = null;
      this._effectSlur = null;
      this._effectEndSlur = null;
    }
    doLayout() {
      (this._effectSlur = null),
        (this._effectEndSlur = null),
        super.doLayout(),
        this._bend &&
          ((this._bend.renderer = this.renderer),
          this._bend.doLayout(),
          this.updateWidth());
    }
    createTies(e) {
      if (e.isVisible) {
        if (
          e.isTieOrigin &&
          !e.hasBend &&
          !e.beat.hasWhammyBar &&
          e.beat.graceType !== 3 &&
          e.tieDestination &&
          e.tieDestination.isVisible
        ) {
          let r = new Vl(e, e.tieDestination, !1);
          this.addTie(r);
        }
        if (
          e.isTieDestination &&
          !e.tieOrigin.hasBend &&
          !e.beat.hasWhammyBar
        ) {
          let r = new Vl(e.tieOrigin, e, !0);
          this.addTie(r);
        }
        if (e.slideInType !== 0 || e.slideOutType !== 0) {
          let r = new Od(e.slideInType, e.slideOutType, e, this);
          this.addTie(r);
        }
        if (
          e.isSlurOrigin &&
          e.slurDestination &&
          e.slurDestination.isVisible
        ) {
          let r = new Fs(e, e.slurDestination, !1);
          this.addTie(r);
        }
        if (e.isSlurDestination) {
          let r = new Fs(e.slurOrigin, e, !0);
          this.addTie(r);
        }
        if (
          !this._effectSlur &&
          e.isEffectSlurOrigin &&
          e.effectSlurDestination
        ) {
          let r = new Fs(e, e.effectSlurDestination, !1);
          (this._effectSlur = r), this.addTie(r);
        }
        if (
          !this._effectEndSlur &&
          e.beat.isEffectSlurDestination &&
          e.beat.effectSlurOrigin
        ) {
          let r = this.onNotes.beamingHelper.direction,
            i =
              r === 0
                ? e.beat.effectSlurOrigin.minNote
                : e.beat.effectSlurOrigin.maxNote,
            n = r === 0 ? e.beat.minNote : e.beat.maxNote,
            s = new Fs(i, n, !0);
          (this._effectEndSlur = s), this.addTie(s);
        }
        if (e.hasBend) {
          if (!this._bend) {
            let r = new Rd(e.beat);
            (this._bend = r), (r.renderer = this.renderer), this.addTie(r);
          }
          this._bend.addBends(e);
        }
        if (this.beat.isLegatoOrigin) {
          if (
            !this.beat.previousBeat ||
            !this.beat.previousBeat.isLegatoOrigin
          ) {
            let r = this.beat.nextBeat;
            for (; r.nextBeat && r.nextBeat.isLegatoDestination; )
              r = r.nextBeat;
            this.addTie(new Ds(this.beat, r, !1));
          }
        } else if (this.beat.isLegatoDestination && !this.beat.isLegatoOrigin) {
          let r = this.beat.previousBeat;
          for (; r.previousBeat && r.previousBeat.isLegatoOrigin; )
            r = r.previousBeat;
          this.addTie(new Ds(r, this.beat, !0));
        }
      }
    }
  };
  var Vd = class extends ii {
    paint(t, e, r) {
      var n = [];
      try {
        let i = j(n, $.bar(r, 14, this.renderer.bar));
        super.paint(t, e, r);
      } catch (s) {
        var a = s,
          o = !0;
      } finally {
        ee(n, a, o);
      }
    }
  };
  var nn = class nn extends Fi {
    constructor(e, r) {
      super(e, r);
      this.simpleWhammyOverflow = 0;
      this.beatEffectsMinY = null;
      this.beatEffectsMaxY = null;
      this.accidentalHelper = new pr(this);
    }
    get repeatsBarSubElement() {
      return 0;
    }
    get barNumberBarSubElement() {
      return 4;
    }
    get barLineBarSubElement() {
      return 8;
    }
    get staffLineBarSubElement() {
      return 20;
    }
    get showMultiBarRest() {
      return !0;
    }
    get lineSpacing() {
      return this.smuflMetrics.oneStaffSpace;
    }
    get heightLineCount() {
      return 5;
    }
    get drawnLineCount() {
      return this.bar.staff.standardNotationLineCount;
    }
    registerBeatEffectOverflows(e, r) {
      let i = this.beatEffectsMinY;
      (i == null || e < i) && (this.beatEffectsMinY = e);
      let n = this.beatEffectsMaxY;
      (n == null || r > n) && (this.beatEffectsMaxY = r);
    }
    getScoreY(e) {
      return super.getLineY(e / 2);
    }
    getScoreHeight(e) {
      return super.getLineHeight(e / 2);
    }
    doLayout() {
      if (
        (super.doLayout(),
        !this.bar.isEmpty && this.accidentalHelper.maxLineBeat)
      ) {
        let e = this.getScoreY(-2),
          r = this.getScoreY(this.heightLineCount * 2),
          i = this.simpleWhammyOverflow,
          n = this.beatEffectsMinY;
        if (n !== null) {
          let u = e - n;
          u > 0 && this.registerOverflowTop(u);
        }
        let s = this.beatEffectsMaxY;
        if (s !== null) {
          let u = s - r;
          u > 0 && this.registerOverflowBottom(u);
        }
        this.registerOverflowTop(i);
        let a = this.getScoreHeight(1),
          o = 0,
          l = 0;
        for (let u of this.helpers.beamHelpers)
          for (let c of u)
            if (c.isRestBeamHelper) {
              if (c.minRestLine) {
                let d = this.getScoreY(c.maxRestLine) - a;
                d < o && (o = d);
              }
              if (c.maxRestLine) {
                let d = this.getScoreY(c.maxRestLine) + a;
                d < o && (o = d);
              }
            } else if (c.beats.length === 1)
              if (c.beats[0].duration >= 2)
                if (c.direction === 0) {
                  let d = this.getFlagTopY(c.beats[0], c.direction);
                  c.hasTuplet && (d -= this.tupletSize + this.tupletOffset),
                    d < o && (o = d);
                  let h = this.getFlagBottomY(c.beats[0], c.direction) + a;
                  h > l && (l = h);
                } else {
                  let d = this.getFlagBottomY(c.beats[0], c.direction);
                  c.hasTuplet && (d += this.tupletSize + this.tupletOffset),
                    d > l && (l = d);
                  let h = this.getFlagTopY(c.beats[0], c.direction) - a;
                  h < o && (o = h);
                }
              else {
                let d = this.getBeatContainer(c.beats[0]);
                if (d) {
                  let h = d.onNotes.getHighestNoteY() - a,
                    f = d.onNotes.getLowestNoteY() + a;
                  c.direction === 0
                    ? c.hasTuplet && (h -= this.tupletSize + this.tupletOffset)
                    : c.hasTuplet && (f += this.tupletSize + this.tupletOffset),
                    f > l && (l = f),
                    h < o && (o = h);
                }
              }
            else {
              this._ensureDrawingInfo(c, c.direction);
              let d = c.drawingInfos.get(c.direction);
              if (c.direction === 0) {
                let h = Math.min(d.startY, d.endY);
                c.hasTuplet && (h -= this.tupletSize + this.tupletOffset),
                  h < o && (o = h);
                let f =
                  this.getBarLineStart(c.beatOfLowestNote, c.direction) + a;
                f > l && (l = f);
              } else {
                let h = Math.max(d.startY, d.endY);
                c.hasTuplet && (h += this.tupletSize + this.tupletOffset),
                  h > l && (l = h);
                let f =
                  this.getBarLineStart(c.beatOfHighestNote, c.direction) - a;
                f < o && (o = f);
              }
            }
        o < e && this.registerOverflowTop(Math.abs(o) + i),
          l > r && this.registerOverflowBottom(Math.abs(l) - r);
      }
    }
    paint(e, r, i) {
      super.paint(e, r, i),
        this.paintBeams(e, r, i, 2, 3),
        this.paintTuplets(e, r, i, 4);
    }
    _getSlashFlagY() {
      let e = (this.heightLineCount - 1) / 2;
      return this.getLineY(e);
    }
    getFlagTopY(e, r) {
      if (e.slashed) {
        let s = this._getSlashFlagY(),
          a = oi.getSymbol(e.duration),
          o = e.graceType !== 0 ? ie.GraceScale : 1;
        return (
          r === 1
            ? (s -= this.smuflMetrics.stemDown.has(a)
                ? this.smuflMetrics.stemDown.get(a).topY * o
                : 0)
            : ((s -= this.smuflMetrics.stemUp.has(a)
                ? this.smuflMetrics.stemUp.get(a).bottomY * o
                : 0),
              (s -= this.smuflMetrics.standardStemLength + o)),
          s
        );
      }
      let i = this.accidentalHelper.getMinLineNote(e);
      if (i)
        return this.getBeatContainer(e).onNotes.getNoteY(i, r === 0 ? 0 : 6);
      let n = this.getScoreY(this.accidentalHelper.getMinLine(e));
      if (r === 0) {
        let s = e.graceType !== 0 ? ie.GraceScale : 1;
        n -= this.smuflMetrics.standardStemLength * s;
      }
      return n;
    }
    getFlagBottomY(e, r) {
      if (e.slashed) {
        let s = this._getSlashFlagY(),
          a = oi.getSymbol(e.duration),
          o = e.graceType !== 0 ? ie.GraceScale : 1;
        return (
          r === 1
            ? ((s -= this.smuflMetrics.stemDown.has(a)
                ? this.smuflMetrics.stemDown.get(a).topY * o
                : 0),
              (s += this.smuflMetrics.standardStemLength + o))
            : (s -= this.smuflMetrics.stemUp.has(a)
                ? this.smuflMetrics.stemUp.get(a).bottomY * o
                : 0),
          s
        );
      }
      let i = this.accidentalHelper.getMaxLineNote(e);
      if (i)
        return this.getBeatContainer(e).onNotes.getNoteY(i, r === 0 ? 5 : 4);
      let n = this.getScoreY(this.accidentalHelper.getMaxLine(e));
      if (r === 1) {
        let s = e.graceType !== 0 ? ie.GraceScale : 1;
        n += this.smuflMetrics.standardStemLength * s;
      }
      return n;
    }
    getBeamDirection(e) {
      return e.direction;
    }
    centerStaffStemY(e) {
      return this.bar.staff.standardNotationLineCount ===
        _r.DefaultStandardNotationLineCount
        ? this.getScoreY(this.bar.staff.standardNotationLineCount - 1)
        : e.direction === 0
        ? this.getScoreY(this.bar.staff.standardNotationLineCount * 2)
        : this.getScoreY(0);
    }
    getStemBottomY(e) {
      throw new Error("Method not implemented.");
    }
    get middleYPosition() {
      return this.getScoreY(this.bar.staff.standardNotationLineCount - 1);
    }
    getNoteY(e, r) {
      if (e.beat.slashed) {
        let n = (this.heightLineCount - 1) / 2;
        return this.getLineY(n);
      }
      let i = super.getNoteY(e, r);
      if (Number.isNaN(i)) {
        let n = pr.computeLineWithoutAccidentals(this.bar, e);
        i = this.getScoreY(n);
        let s = e.beat.graceType === 0 ? 1 : ie.GraceScale,
          a = this.smuflMetrics.standardStemLength * s,
          o =
            this.smuflMetrics.glyphHeights.get(ie.getSymbol(e.beat.duration)) *
            s;
        switch (r) {
          case 0:
            i -= a;
            break;
          case 1:
            i -= o / 2;
            break;
          case 2:
            break;
          case 3:
            i += o / 2;
            break;
          case 4:
            i += a;
            break;
          case 5:
            break;
          case 6:
            break;
        }
      }
      return i;
    }
    applyLayoutingInfo() {
      let e = super.applyLayoutingInfo();
      if (e && this.bar.isMultiVoice) {
        let r = this.getScoreY(-2),
          i = this.getScoreY(this.heightLineCount * 2),
          n = this.helpers.collisionHelper.getBeatMinMaxY();
        n[0] < r && this.registerOverflowTop(Math.abs(n[0])),
          n[1] > i && this.registerOverflowBottom(Math.abs(n[1]) - i);
      }
      return e;
    }
    calculateBeamYWithDirection(e, r, i) {
      return e.beats.length === 0
        ? i === 0
          ? this.getFlagTopY(e.beats[0], i)
          : this.getFlagBottomY(e.beats[0], i)
        : (this._ensureDrawingInfo(e, i), e.drawingInfos.get(i).calcY(r));
    }
    _ensureDrawingInfo(e, r) {
      if (!e.drawingInfos.has(r)) {
        let i = e.graceType !== 0 ? ie.GraceScale : 1,
          n = A.getIndex(e.shortestDuration) - 2,
          s = this.smuflMetrics.standardStemLength * i;
        if (e.tremoloDuration) {
          let d =
            (this.smuflMetrics.beamThickness + this.smuflMetrics.beamSpacing) *
            i;
          e.shortestDuration > 8
            ? e.tremoloDuration === 8
              ? (s += d)
              : (s += d * 1.5)
            : e.tremoloDuration === 32 && (s += d * 1.5);
        }
        let a = new oc();
        e.drawingInfos.set(r, a);
        let o = e.beats[0],
          l = e.beats[e.beats.length - 1],
          u = e.isRestBeamHelper;
        (a.startBeat = o),
          (a.startX = e.getBeatLineX(o)),
          u
            ? (a.startY =
                r === 0
                  ? this.getScoreY(e.minRestLine)
                  : this.getScoreY(e.maxRestLine))
            : (a.startY =
                r === 0 ? this.getFlagTopY(o, r) : this.getFlagBottomY(o, r)),
          (a.endBeat = l),
          (a.endX = e.getBeatLineX(l)),
          u
            ? (a.endY =
                r === 0
                  ? this.getScoreY(e.minRestLine)
                  : this.getScoreY(e.maxRestLine))
            : (a.endY =
                r === 0 ? this.getFlagTopY(l, r) : this.getFlagBottomY(l, r));
        let c = this.smuflMetrics.oneStaffSpace;
        if (
          (r === 1 &&
            a.startY > a.endY &&
            a.startY - a.endY > c &&
            (a.endY = a.startY - c),
          r === 1 &&
            a.endY > a.startY &&
            a.endY - a.startY > c &&
            (a.startY = a.endY - c),
          r === 0 &&
            a.startY < a.endY &&
            a.endY - a.startY > c &&
            (a.endY = a.startY + c),
          r === 0 &&
            a.endY < a.startY &&
            a.startY - a.endY > c &&
            (a.startY = a.endY + c),
          e.beats.length > 1)
        ) {
          if (r === 0) {
            let d =
                this.getScoreY(
                  this.accidentalHelper.getMinLine(e.beatOfHighestNote)
                ) - s,
              f = a.calcY(e.getBeatLineX(e.beatOfHighestNote)) - d;
            f > 0 && ((a.startY -= f), (a.endY -= f));
          } else {
            let d =
                this.getScoreY(
                  this.accidentalHelper.getMaxLine(e.beatOfLowestNote)
                ) + s,
              h = a.calcY(e.getBeatLineX(e.beatOfLowestNote)),
              f = d - h;
            f > 0 && ((a.startY += f), (a.endY += f));
          }
          if (e.minRestLine !== null || e.maxRestLine !== null) {
            let d = e.graceType !== 0 ? ie.GraceScale : 1,
              h =
                n *
                (this.smuflMetrics.beamSpacing +
                  this.smuflMetrics.beamThickness) *
                d;
            if (
              ((h += this.smuflMetrics.beamSpacing),
              r === 0 && e.minRestLine !== null)
            ) {
              let f = this.getScoreY(e.minRestLine) - h,
                y = a.calcY(e.getBeatLineX(e.beatOfMinRestLine)) - f;
              y > 0 && ((a.startY -= y), (a.endY -= y));
            } else if (r === 1 && e.maxRestLine !== null) {
              let f = this.getScoreY(e.maxRestLine) + h,
                b = a.calcY(e.getBeatLineX(e.beatOfMaxRestLine)),
                y = f - b;
              y > 0 && ((a.startY += y), (a.endY += y));
            }
          }
          if (e.slashBeats.length > 0)
            for (let d of e.slashBeats) {
              let h = a.calcY(e.getBeatLineX(d)),
                b =
                  (e.direction === 0
                    ? this.getFlagTopY(d, e.direction)
                    : this.getFlagBottomY(d, e.direction)) - h;
              b > 0 && ((a.startY += b), (a.endY += b));
            }
        }
        if (n > 2 && !u) {
          let d = this.smuflMetrics.beamSpacing * i,
            h = this.smuflMetrics.beamThickness * i,
            f = n * h + (n - 1) * d;
          if (r === 0) {
            let y = a.startY + 2 * h + d - f,
              S = a.startY - y;
            S > 0 && ((a.startY -= S), (a.endY -= S));
          } else {
            let S = a.startY - 2 * h + d + f - a.startY;
            S > 0 && ((a.startY += S), (a.endY += S));
          }
        }
      }
    }
    getBarLineStart(e, r) {
      if (e.slashed)
        return r === 1 ? this.getFlagTopY(e, r) : this.getFlagBottomY(e, r);
      if (r === 0) {
        let n = this.accidentalHelper.getMaxLineNote(e);
        return n
          ? this.getBeatContainer(e).onNotes.getNoteY(n, 5)
          : this.getScoreY(this.accidentalHelper.getMaxLine(e));
      }
      let i = this.accidentalHelper.getMinLineNote(e);
      return i
        ? this.getBeatContainer(e).onNotes.getNoteY(i, 6)
        : this.getScoreY(this.accidentalHelper.getMinLine(e));
    }
    createLinePreBeatGlyphs() {
      let e = !1;
      if (
        this.isFirstOfLine ||
        this.bar.clef !== this.bar.previousBar.clef ||
        this.bar.clefOttava !== this.bar.previousBar.clefOttava
      ) {
        let r = 0;
        switch (this.bar.clef) {
          case 0:
            r = this.bar.staff.standardNotationLineCount - 1;
            break;
          case 3:
            r = 2;
            break;
          case 1:
            r = 4;
            break;
          case 2:
            r = 2;
            break;
          case 4:
            r = 6;
            break;
        }
        this.createStartSpacing(),
          this.addPreBeatGlyph(
            new xd(0, this.getScoreY(r), this.bar.clef, this.bar.clefOttava)
          ),
          this.addPreBeatGlyph(
            new Ke(0, 0, this.smuflMetrics.preBeatGlyphSpacing)
          ),
          (e = !0);
      }
      (e ||
        (this.index === 0 && this.bar.keySignature !== 0) ||
        (this.bar.previousBar &&
          this.bar.keySignature !== this.bar.previousBar.keySignature)) &&
        (this.createStartSpacing(), this._createKeySignatureGlyphs()),
        (!this.bar.previousBar ||
          (this.bar.previousBar &&
            this.bar.masterBar.timeSignatureNumerator !==
              this.bar.previousBar.masterBar.timeSignatureNumerator) ||
          (this.bar.previousBar &&
            this.bar.masterBar.timeSignatureDenominator !==
              this.bar.previousBar.masterBar.timeSignatureDenominator) ||
          (this.bar.previousBar &&
            this.bar.masterBar.isFreeTime &&
            this.bar.masterBar.isFreeTime !==
              this.bar.previousBar.masterBar.isFreeTime)) &&
          (this.createStartSpacing(), this._createTimeSignatureGlyphs());
    }
    _createKeySignatureGlyphs() {
      let e = 0,
        r = this.bar.keySignature,
        i = this.bar.previousBar ? this.bar.previousBar.keySignature : 0;
      switch (this.bar.clef) {
        case 0:
          e = 0;
          break;
        case 4:
          e = 1;
          break;
        case 3:
          e = 3;
          break;
        case 1:
          e = 2;
          break;
        case 2:
          e = 0;
          break;
      }
      let n = new Vd();
      (n.gap = this.smuflMetrics.accidentalPadding), (n.renderer = this);
      let s = new Map(),
        a = [];
      if (A.keySignatureIsSharp(r))
        for (let o = 0; o < Math.abs(r); o++) {
          let l = nn._sharpKsSteps[o] + e;
          a.push(new mr(0, this.getScoreY(l), 2, 1)), s.set(l, !0);
        }
      else
        for (let o = 0; o < Math.abs(r); o++) {
          let l = nn._flatKsSteps[o] + e;
          a.push(new mr(0, this.getScoreY(l), 3, 1)), s.set(l, !0);
        }
      if (this.bar.keySignature === 0) {
        let o = Math.abs(i),
          l = A.keySignatureIsSharp(i) ? nn._sharpKsSteps : nn._flatKsSteps;
        for (let u = 0; u < o; u++) {
          let c = l[u] + e;
          s.has(c) || n.addGlyph(new mr(0, this.getScoreY(l[u] + e), 1, 1));
        }
      }
      for (let o of a) n.addGlyph(o);
      this.addPreBeatGlyph(n),
        n.isEmpty ||
          this.addPreBeatGlyph(
            new Ke(0, 0, this.smuflMetrics.preBeatGlyphSpacing)
          );
    }
    _createTimeSignatureGlyphs() {
      let e = this.bar.staff.standardNotationLineCount - 1;
      this.addPreBeatGlyph(
        new Zn(
          0,
          this.getScoreY(e),
          this.bar.masterBar.timeSignatureNumerator,
          this.bar.masterBar.timeSignatureDenominator,
          this.bar.masterBar.timeSignatureCommon,
          this.bar.masterBar.isFreeTime
        )
      ),
        this.addPreBeatGlyph(
          new Ke(0, 0, this.smuflMetrics.preBeatGlyphSpacing)
        );
    }
    createVoiceGlyphs(e) {
      for (let r of e.beats) {
        let i = new Gd(r, this.getVoiceContainer(e));
        (i.preNotes = new Fd()), (i.onNotes = new Ld()), this.addBeatGlyph(i);
      }
    }
    getNoteLine(e) {
      return this.accidentalHelper.getNoteLine(e);
    }
    completeBeamingHelper(e) {
      if (
        this.bar.isMultiVoice &&
        e.highestNoteInHelper &&
        e.lowestNoteInHelper
      ) {
        let r = 0,
          i = 0,
          n = 0;
        e.hasTuplet && (n += this.resources.effectFont.size * 2),
          e.direction === 0
            ? ((r = this.getNoteY(e.highestNoteInHelper, 0) - n),
              (i = this.getNoteY(e.lowestNoteInHelper, 3)))
            : ((r = this.getNoteY(e.highestNoteInHelper, 1)),
              (i = this.getNoteY(e.lowestNoteInHelper, 4) + n));
        for (let s of e.beats)
          this.helpers.collisionHelper.reserveBeatSlot(s, r, i);
      }
    }
    paintBeamingStem(e, r, i, n, s, a) {
      var l = [];
      try {
        let o = j(l, $.beat(a, 1, e));
        a.fillRect(i, n, this.smuflMetrics.stemThickness, s - n);
      } catch (u) {
        var c = u,
          d = !0;
      } finally {
        ee(l, c, d);
      }
    }
  };
  (nn.StaffId = "score"),
    (nn._sharpKsSteps = [-1, 2, -2, 1, 4, 0, 3]),
    (nn._flatKsSteps = [3, 0, 4, 1, 5, 2, 6]);
  var Rs = nn;
  var Wd = class extends ri {
    get staffId() {
      return Rs.StaffId;
    }
    getStaffPaddingTop(t) {
      return t.system.layout.renderer.settings.display.notationStaffPaddingTop;
    }
    getStaffPaddingBottom(t) {
      return t.system.layout.renderer.settings.display
        .notationStaffPaddingBottom;
    }
    create(t, e) {
      return new Rs(t, e);
    }
    canCreate(t, e) {
      return super.canCreate(t, e) && e.showStandardNotation;
    }
  };
  var Wl = class extends et {
    constructor(t, e, r = !1) {
      super(t.beat, e.beat, r), (this.startNote = t), (this.endNote = e);
    }
    get _isLeftHandTap() {
      return this.startNote === this.endNote;
    }
    getTieHeight(t, e, r, i) {
      return this._isLeftHandTap
        ? this.startNoteRenderer.smuflMetrics.tieHeight
        : super.getTieHeight(t, e, r, i);
    }
    getBeamDirection(t, e) {
      return 1;
    }
    static getBeamDirectionForNote(t) {
      return 1;
    }
    getStartY() {
      return this.startNoteRenderer.getNoteY(this.startNote, 2);
    }
    getEndY() {
      return this.getStartY();
    }
    getStartX() {
      return this._isLeftHandTap
        ? this.getEndX() - this.renderer.smuflMetrics.leftHandTabTieWidth
        : this.startNoteRenderer.getNoteX(this.startNote, 2);
    }
    getEndX() {
      return this.endNoteRenderer.getNoteX(this.endNote, 0);
    }
  };
  var Hd = class extends ft {
    constructor() {
      super(...arguments);
      this._tiedNoteTie = null;
    }
    createTies(e) {
      if (e.isVisible) {
        if (!this._tiedNoteTie && e.isTieOrigin && e.tieDestination.isVisible) {
          let r = new Wl(e, e.tieDestination, !1);
          (this._tiedNoteTie = r), this.addTie(r);
        }
        if (!this._tiedNoteTie && e.isTieDestination) {
          let r = new Wl(e.tieOrigin, e, !0);
          (this._tiedNoteTie = r), this.addTie(r);
        }
      }
    }
  };
  var Ud = class extends jn {
    updateBeamingHelper(t) {
      this.beamingHelper &&
        this.beamingHelper.registerBeatLineX(
          "slash",
          this.beat,
          t + this.x + this.width / 2,
          t + this.x + this.width / 2
        );
    }
    paint(t, e, r) {
      super.internalPaint(t, e, r, 17);
    }
  };
  var zd = class extends _t {
    constructor() {
      super(...arguments);
      this.noteHeads = null;
      this.deadSlapped = null;
      this.restGlyph = null;
    }
    get effectElement() {
      return 18;
    }
    getNoteX(e, r) {
      let i = null;
      if (
        (this.noteHeads
          ? (i = this.noteHeads)
          : this.deadSlapped && (i = this.deadSlapped),
        i)
      ) {
        let n = i.x;
        switch (r) {
          case 0:
            break;
          case 1:
            n += i.width / 2;
            break;
          case 2:
            n += i.width;
            break;
        }
        return n;
      }
      return 0;
    }
    buildBoundingsLookup(e, r, i) {
      if (this.noteHeads && this.container.beat.notes.length > 0) {
        let n = new xr();
        (n.note = this.container.beat.notes[0]),
          (n.noteHeadBounds = new we()),
          (n.noteHeadBounds.x = r + this.x + this.noteHeads.x),
          (n.noteHeadBounds.y =
            i + this.y + this.noteHeads.y - this.noteHeads.height / 2),
          (n.noteHeadBounds.w = this.width),
          (n.noteHeadBounds.h = this.height),
          e.addNote(n);
      }
    }
    getLowestNoteY() {
      return this.noteHeads ? this.noteHeads.y : 0;
    }
    getHighestNoteY() {
      return this.noteHeads ? this.noteHeads.y : 0;
    }
    getNoteY(e, r) {
      let i = null,
        n = -1;
      if (
        (this.noteHeads
          ? ((i = this.noteHeads), (n = oi.getSymbol(e.beat.duration)))
          : this.deadSlapped && (i = this.deadSlapped),
        i)
      ) {
        let s = this.y + i.y;
        switch (r) {
          case 1:
          case 0:
            s -= i.height / 2;
            break;
          case 2:
            break;
          case 3:
          case 4:
            s += i.height / 2;
            break;
          case 5:
            s -= this.renderer.smuflMetrics.stemUp.has(n)
              ? this.renderer.smuflMetrics.stemUp.get(n).bottomY
              : 0;
            break;
          case 6:
            s -= this.renderer.smuflMetrics.stemDown.has(n)
              ? this.renderer.smuflMetrics.stemDown.get(n).topY
              : 0;
            break;
        }
        return s;
      }
      return 0;
    }
    updateBeamingHelper() {
      this.noteHeads
        ? this.noteHeads.updateBeamingHelper(this.container.x + this.x)
        : this.deadSlapped
        ? this.beamingHelper &&
          this.beamingHelper.registerBeatLineX(
            "slash",
            this.container.beat,
            this.container.x + this.x + this.deadSlapped.x + this.width,
            this.container.x + this.x + this.deadSlapped.x
          )
        : this.restGlyph &&
          this.restGlyph.updateBeamingHelper(this.container.x + this.x);
    }
    doLayout() {
      let e = this.renderer,
        r = e.getNoteLine(),
        i = e.getLineY(r);
      if (this.container.beat.deadSlapped) {
        let n = new Oi();
        (n.renderer = this.renderer),
          n.doLayout(),
          (this.deadSlapped = n),
          this.addEffect(n);
      } else if (!this.container.beat.isEmpty)
        if (this.container.beat.isRest) {
          let n = new Ud(0, i, this.container.beat.duration);
          (this.restGlyph = n),
            (n.beat = this.container.beat),
            (n.beamingHelper = this.beamingHelper),
            this.addNormal(n),
            this.beamingHelper &&
              this.beamingHelper.applyRest(this.container.beat, 0);
        } else {
          let n = this.container.beat.graceType !== 0,
            s = new oi(
              0,
              i,
              this.container.beat.duration,
              n,
              this.container.beat
            );
          (this.noteHeads = s),
            (s.beat = this.container.beat),
            (s.beamingHelper = this.beamingHelper),
            this.addNormal(s);
        }
      if (this.container.beat.dots > 0)
        for (let n = 0; n < this.container.beat.dots; n++)
          this.addEffect(
            new gi(0, e.getLineY(e.getNoteLine()) - e.getLineHeight(0.5))
          );
      super.doLayout(),
        this.container.beat.isEmpty
          ? (this.centerX = this.width / 2)
          : this.restGlyph
          ? (this.centerX = this.restGlyph.x + this.restGlyph.width / 2)
          : this.noteHeads
          ? (this.centerX = this.noteHeads.x + this.noteHeads.width / 2)
          : this.deadSlapped &&
            (this.centerX = this.deadSlapped.x + this.deadSlapped.width / 2);
    }
  };
  var no = class extends Fi {
    constructor(e, r) {
      super(e, r);
      this.simpleWhammyOverflow = 0;
      (this._isOnlySlash =
        !r.staff.showTablature && !r.staff.showStandardNotation),
        (this.helpers.preferredBeamDirection = 0);
    }
    get repeatsBarSubElement() {
      return 2;
    }
    get barNumberBarSubElement() {
      return 6;
    }
    get barLineBarSubElement() {
      return 10;
    }
    get staffLineBarSubElement() {
      return 22;
    }
    get lineSpacing() {
      return this.smuflMetrics.oneStaffSpace;
    }
    get heightLineCount() {
      return 5;
    }
    get drawnLineCount() {
      return 1;
    }
    get bottomGlyphOverflow() {
      return 0;
    }
    paint(e, r, i) {
      super.paint(e, r, i),
        this.paintBeams(e, r, i, 14, 15),
        this.paintTuplets(e, r, i, 16);
    }
    doLayout() {
      super.doLayout();
      let e = !1;
      for (let r of this.bar.voices)
        if (
          this.hasVoiceContainer(r) &&
          this.getVoiceContainer(r).tupletGroups.length > 0
        ) {
          e = !0;
          break;
        }
      e && this.registerOverflowTop(this.tupletSize);
    }
    getNoteLine() {
      return 0;
    }
    getFlagTopY(e, r) {
      let i = this.smuflMetrics.glyphHeights.get(57603),
        n = this.getLineY(0) - i / 2;
      return r === 0 && (n -= this.getFlagStemSize(e.duration, !0)), n;
    }
    getFlagBottomY(e, r) {
      let i = this.smuflMetrics.glyphHeights.get(57603),
        n = this.getLineY(0) - i / 2;
      return r === 1 && (n += this.getFlagStemSize(e.duration, !0)), n;
    }
    getBeamDirection(e) {
      return 0;
    }
    getNoteY(e, r) {
      let i = super.getNoteY(e, r);
      return Number.isNaN(i) && (i = this.getLineY(0)), i;
    }
    calculateBeamYWithDirection(e, r, i) {
      return this.getLineY(0) - this.getFlagStemSize(e.shortestDuration);
    }
    getBarLineStart(e, r) {
      let i = this.smuflMetrics.glyphHeights.get(57603);
      return this.getLineY(0) - i / 2;
    }
    createLinePreBeatGlyphs() {
      this._isOnlySlash &&
        (!this.bar.previousBar ||
          (this.bar.previousBar &&
            this.bar.masterBar.timeSignatureNumerator !==
              this.bar.previousBar.masterBar.timeSignatureNumerator) ||
          (this.bar.previousBar &&
            this.bar.masterBar.timeSignatureDenominator !==
              this.bar.previousBar.masterBar.timeSignatureDenominator) ||
          (this.bar.previousBar &&
            this.bar.masterBar.isFreeTime &&
            this.bar.masterBar.isFreeTime !==
              this.bar.previousBar.masterBar.isFreeTime)) &&
        (this.createStartSpacing(), this._createTimeSignatureGlyphs());
    }
    _createTimeSignatureGlyphs() {
      this.addPreBeatGlyph(new Ke(0, 0, this.smuflMetrics.oneStaffSpace));
      let e = this.bar.masterBar,
        r = new Zn(
          0,
          this.getLineY(0),
          e.timeSignatureNumerator,
          e.timeSignatureDenominator,
          e.timeSignatureCommon,
          e.isFreeTime &&
            (e.previousMasterBar == null ||
              e.isFreeTime !== e.previousMasterBar.isFreeTime)
        );
      (r.barSubElement = 18), this.addPreBeatGlyph(r);
    }
    createVoiceGlyphs(e) {
      for (let r of e.beats) {
        let i = new Hd(r, this.getVoiceContainer(e));
        (i.preNotes = new vt()),
          (i.onNotes = e.index === 0 ? new zd() : new _t()),
          this.addBeatGlyph(i);
      }
    }
    paintBeamingStem(e, r, i, n, s, a) {
      var u = [];
      try {
        let o = j(u, $.beat(a, 13, e));
        let l = a.lineWidth;
        a.lineWidth = this.smuflMetrics.stemThickness;
        a.beginPath();
        a.moveTo(i, n);
        a.lineTo(i, s);
        a.stroke();
        a.lineWidth = l;
      } catch (c) {
        var d = c,
          h = !0;
      } finally {
        ee(u, d, h);
      }
    }
  };
  no.StaffId = "slash";
  var Xd = class extends ri {
    get staffId() {
      return no.StaffId;
    }
    getStaffPaddingTop(t) {
      return t.system.layout.renderer.settings.display.notationStaffPaddingTop;
    }
    getStaffPaddingBottom(t) {
      return t.system.layout.renderer.settings.display
        .notationStaffPaddingBottom;
    }
    create(t, e) {
      return new no(t, e);
    }
    canCreate(t, e) {
      return super.canCreate(t, e) && e.showSlash;
    }
  };
  var yi = class extends I {
    constructor(e = 0, r = 0) {
      super(e, r);
      this.lineValue = 0;
      this.lineValue = r;
    }
  };
  var so = class p extends ue {
    constructor() {
      super(0, 0);
      this._notes = [];
      this._renderPoints = new Map();
      this._preBendMinValue = -1;
      this._bendMiddleMinValue = -1;
      this._bendEndMinValue = -1;
      this._bendEndContinuedMinValue = -1;
      this._releaseMinValue = -1;
      this._releaseContinuedMinValue = -1;
      this._maxBendValue = -1;
    }
    addBends(e) {
      this._notes.push(e);
      let r = this._createRenderingPoints(e);
      this._renderPoints.set(e.id, r),
        (this._maxBendValue === -1 ||
          this._maxBendValue < e.maxBendPoint.value) &&
          (this._maxBendValue = e.maxBendPoint.value);
      let i = 0;
      switch (e.bendType) {
        case 2:
          (i = r[1].value),
            e.isTieOrigin
              ? (this._bendEndContinuedMinValue === -1 ||
                  i < this._bendEndContinuedMinValue) &&
                (this._bendEndContinuedMinValue = i)
              : (this._bendEndMinValue === -1 || i < this._bendEndMinValue) &&
                (this._bendEndMinValue = i);
          break;
        case 3:
          (i = r[1].value),
            e.isTieOrigin
              ? (this._releaseContinuedMinValue === -1 ||
                  i < this._releaseContinuedMinValue) &&
                (this._releaseContinuedMinValue = i)
              : i > 0 &&
                (this._releaseMinValue === -1 || i < this._releaseMinValue) &&
                (this._releaseMinValue = i);
          break;
        case 4:
          (i = r[1].value),
            (this._bendMiddleMinValue === -1 || i < this._bendMiddleMinValue) &&
              (this._bendMiddleMinValue = i),
            (i = r[2].value),
            e.isTieOrigin
              ? (this._releaseContinuedMinValue === -1 ||
                  i < this._releaseContinuedMinValue) &&
                (this._releaseContinuedMinValue = i)
              : i > 0 &&
                (this._releaseMinValue === -1 || i < this._releaseMinValue) &&
                (this._releaseMinValue = i);
          break;
        case 6:
          (i = r[0].value),
            (this._preBendMinValue === -1 || i < this._preBendMinValue) &&
              (this._preBendMinValue = i);
          break;
        case 7:
          (i = r[0].value),
            (this._preBendMinValue === -1 || i < this._preBendMinValue) &&
              (this._preBendMinValue = i),
            (i = r[1].value),
            e.isTieOrigin
              ? (this._bendEndContinuedMinValue === -1 ||
                  i < this._bendEndContinuedMinValue) &&
                (this._bendEndContinuedMinValue = i)
              : (this._bendEndMinValue === -1 || i < this._bendEndMinValue) &&
                (this._bendEndMinValue = i);
          break;
        case 8:
          (i = r[0].value),
            (this._preBendMinValue === -1 || i < this._preBendMinValue) &&
              (this._preBendMinValue = i),
            (i = r[1].value),
            e.isTieOrigin
              ? (this._releaseContinuedMinValue === -1 ||
                  i < this._releaseContinuedMinValue) &&
                (this._releaseContinuedMinValue = i)
              : i > 0 &&
                (this._releaseMinValue === -1 || i < this._releaseMinValue) &&
                (this._releaseMinValue = i);
          break;
      }
    }
    doLayout() {
      super.doLayout();
      let e =
        this._maxBendValue * this.renderer.smuflMetrics.tabBendPerValueHeight;
      this.renderer.registerOverflowTop(e);
      let r = 0;
      for (let i of this._notes) {
        let n = this._renderPoints.get(i.id);
        switch (i.bendType) {
          case 2:
            n[1].lineValue = i.isTieOrigin
              ? this._bendEndContinuedMinValue
              : this._bendEndMinValue;
            break;
          case 3:
            (r = i.isTieOrigin
              ? this._releaseContinuedMinValue
              : this._releaseMinValue),
              r >= 0 && (n[1].lineValue = r);
            break;
          case 4:
            (n[1].lineValue = this._bendMiddleMinValue),
              (r = i.isTieOrigin
                ? this._releaseContinuedMinValue
                : this._releaseMinValue),
              r >= 0 && (n[2].lineValue = r);
            break;
          case 6:
            n[0].lineValue = this._preBendMinValue;
            break;
          case 7:
            (n[0].lineValue = this._preBendMinValue),
              (n[1].lineValue = i.isTieOrigin
                ? this._bendEndContinuedMinValue
                : this._bendEndMinValue);
            break;
          case 8:
            (n[0].lineValue = this._preBendMinValue),
              (r = i.isTieOrigin
                ? this._releaseContinuedMinValue
                : this._releaseMinValue),
              r >= 0 && (n[1].lineValue = r);
            break;
        }
      }
      (this.width = 0),
        this._notes.sort((i, n) =>
          i.isStringed ? i.string - n.string : i.realValue - n.realValue
        );
    }
    _createRenderingPoints(e) {
      let r = [];
      switch (e.bendType) {
        case 1:
          for (let i of e.bendPoints) r.push(new yi(i.offset, i.value));
          break;
        case 4:
          r.push(new yi(0, e.bendPoints[0].value)),
            r.push(new yi((I.MaxPosition / 2) | 0, e.bendPoints[1].value)),
            r.push(new yi(I.MaxPosition, e.bendPoints[3].value));
          break;
        case 2:
        case 5:
        case 6:
        case 7:
        case 8:
        case 3:
          r.push(new yi(0, e.bendPoints[0].value)),
            r.push(new yi(I.MaxPosition, e.bendPoints[1].value));
          break;
      }
      return r;
    }
    paint(e, r, i) {
      let n = i.color;
      this._notes.length > 1 &&
        (i.color = this.renderer.resources.secondaryGlyphColor);
      for (let s of this._notes) {
        let a = this._renderPoints.get(s.id),
          o = this.renderer,
          l = s,
          u = !1,
          c = null,
          d = !1,
          h = s.bendStyle === 1 ? "grad." : "",
          f = null;
        for (; l.isTieOrigin; ) {
          let N = l.tieDestination;
          if (
            ((c = this.renderer.scoreRenderer.layout.getRendererForBar(
              this.renderer.staff.staffId,
              N.beat.voice.bar
            )),
            !c || o.staff !== c.staff)
          )
            break;
          if (
            ((l = N),
            (u = !0),
            l.hasBend ||
              !this.renderer.settings.notation.extendBendArrowsOnTiedNotes ||
              l.vibrato !== 0)
          ) {
            d = !0;
            break;
          }
        }
        (f = l.beat),
          (c = this.renderer.scoreRenderer.layout.getRendererForBar(
            this.renderer.staff.staffId,
            f.voice.bar
          )),
          f.isLastOfVoice &&
            !l.hasBend &&
            this.renderer.settings.notation.extendBendArrowsOnTiedNotes &&
            (f = null);
        let b = 0,
          y = 0,
          S = r + o.y,
          k = this.renderer.smuflMetrics.glyphWidths.get(60284);
        (b = e + o.x),
          a[0].value > 0 || s.isContinuedBend
            ? (b += o.getBeatX(s.beat, 2))
            : (b += o.getNoteX(s, 2)),
          !f || (f.isLastOfVoice && !d)
            ? (y = e + c.x + c.postBeatGlyphsStart)
            : d || !f.nextBeat
            ? (y = e + c.x + c.getBeatX(f, 2))
            : s.bendType === 5
            ? (y = e + c.x + c.getBeatX(f.nextBeat, 1))
            : (y = e + c.x + c.getBeatX(f.nextBeat, 0)),
          u || (y -= k);
        let O = (y - b) / I.MaxPosition;
        i.beginPath();
        for (let N = 0, R = a.length - 1; N < R; N++) {
          let g = a[N],
            x = a[N + 1];
          N === 0 &&
            g.value !== 0 &&
            !s.isTieDestination &&
            this._paintBend(s, new yi(0, 0), g, b, S, O, h, i),
            s.bendType !== 6
              ? (N === 0 &&
                  (b += this.renderer.smuflMetrics.postNoteEffectPadding),
                this._paintBend(s, g, x, b, S, O, h, i))
              : s.isTieOrigin &&
                s.tieDestination.hasBend &&
                ((x = new yi(I.MaxPosition, g.value)),
                (x.lineValue = g.lineValue),
                this._paintBend(s, g, x, b, S, O, h, i));
        }
        if (l.vibrato !== 0) {
          let N = y - e + k - c.x,
            R =
              S -
              r -
              this.renderer.smuflMetrics.tabBendPerValueHeight *
                a[a.length - 1].lineValue,
            g = new Vt(N, R, l.vibrato);
          (g.beat = l.beat),
            (g.renderer = c),
            g.doLayout(),
            g.paint(e + c.x, r, i);
        }
        i.color = n;
      }
    }
    _paintBend(e, r, i, n, s, a, o, l) {
      let u = this.renderer,
        c = this.renderer.resources,
        d = u.lineOffset / 2,
        h = n + a * r.offset,
        f = this.renderer.smuflMetrics.tabBendPerValueHeight,
        b = s - f * r.lineValue;
      r.value === 0
        ? i.offset === r.offset
          ? (b += u.getNoteY(e.beat.maxStringNote, 1) - d / 2)
          : (b += u.getNoteY(e, 2))
        : (b += d);
      let y = n + a * i.offset,
        S = s - f * i.lineValue;
      i.lineValue === 0 ? (S += u.getNoteY(e, 2)) : (S += d);
      let k = 0,
        T = this.renderer.smuflMetrics.glyphWidths.get(60284) ?? 0;
      if (isNaN(T) || isNaN(h) || isNaN(y) || isNaN(b) || isNaN(S)) return;
      i.value > r.value
        ? (S + T > b && (S = b - T),
          l.beginPath(),
          l.moveTo(y, S),
          l.lineTo(y - T * 0.5, S + T),
          l.lineTo(y + T * 0.5, S + T),
          l.closePath(),
          l.fill(),
          (k = T))
        : i.value !== r.value &&
          (S < b && (S = b + T),
          l.beginPath(),
          l.moveTo(y, S),
          l.lineTo(y - T * 0.5, S - T),
          l.lineTo(y + T * 0.5, S - T),
          l.closePath(),
          l.fill(),
          (k = -T));
      let O = l.lineWidth;
      if (
        ((l.lineWidth = this.renderer.smuflMetrics.arrowShaftThickness),
        l.beginPath(),
        r.value === i.value)
      ) {
        if (r.lineValue > 0) {
          let N = y,
            R = this.renderer.smuflMetrics.tabBendDashSize,
            g = h + R;
          if ((N - h) / (R * 2) < 1) l.moveTo(N, b), l.lineTo(h, b);
          else for (; N > g; ) l.moveTo(N, b), l.lineTo(N - R, b), (N -= R * 2);
          l.stroke();
        }
      } else
        y > h
          ? (l.moveTo(h, b),
            l.bezierCurveTo((h + y) / 2, b, y, b, y, S + k),
            l.stroke())
          : (l.moveTo(h, b), l.lineTo(y, S), l.stroke());
      if (o && r.offset < i.offset) {
        l.font = c.graceFont;
        let N = l.measureText(o),
          R = 0,
          g = 0;
        if (b > S) {
          let x = Math.abs(b - S);
          (R = x > N.height ? b - x / 2 : b), (g = (h + y - N.width) / 2);
        } else (R = b), (g = y - N.width);
        l.fillText(o, g, R);
      }
      if (i.value !== 0 && r.value !== i.value) {
        let N = i.value,
          R = i.value > r.value;
        N = Math.abs(N);
        let g = "";
        if (N === 4) (g = "full"), (N -= 4);
        else if (N >= 4 || N <= -4) {
          let x = (N / 4) | 0;
          (g += x), (N -= x * 4);
        }
        if ((N > 0 && (g += p.getFractionSign(N)), g !== "")) {
          S = s - f * i.value;
          let x = S;
          R || (x = b + (Math.abs(S - b) * 1) / 3), (l.font = c.tablatureFont);
          let M = l.measureText(g),
            P = x - M.height / 1.5,
            H = y - M.width / 2;
          l.fillText(g, H, P - c.engravingSettings.tabBendLabelPadding);
        }
      }
      l.lineWidth = O;
    }
    static getFractionSign(e) {
      switch (e) {
        case 1:
          return "\xBC";
        case 2:
          return "\xBD";
        case 3:
          return "\xBE";
        default:
          return `${e}/ 4`;
      }
    }
  };
  var Yd = class extends ue {
    constructor(t, e, r, i) {
      super(0, 0),
        (this._inType = t),
        (this._outType = e),
        (this._startNote = r),
        (this._parent = i);
    }
    doLayout() {
      this.width = 0;
    }
    paint(t, e, r) {
      this._paintSlideIn(t, e, r), this._paintSlideOut(t, e, r);
    }
    _paintSlideIn(t, e, r) {
      let i = this.renderer,
        n = this.renderer.smuflMetrics.simpleSlideWidth,
        s = this.renderer.smuflMetrics.simpleSlideHeight,
        a = 0,
        o = 0,
        l = 0,
        u = 0,
        c = this.renderer.smuflMetrics.preNoteEffectPadding;
      switch (this._inType) {
        case 1:
          (l = t + i.x + i.getNoteX(this._startNote, 0) - c),
            (u = e + i.y + i.getNoteY(this._startNote, 2) - s),
            (a = l - n),
            (o = e + i.y + i.getNoteY(this._startNote, 2) + s);
          break;
        case 2:
          (l = t + i.x + i.getNoteX(this._startNote, 0) - c),
            (u = e + i.y + i.getNoteY(this._startNote, 2) + s),
            (a = l - n),
            (o = e + i.y + i.getNoteY(this._startNote, 2) - s);
          break;
        default:
          return;
      }
      this._paintSlideLine(r, !1, a, l, o, u);
    }
    _paintSlideOut(t, e, r) {
      let i = this.renderer,
        n = this.renderer.smuflMetrics.simpleSlideWidth,
        s = this.renderer.smuflMetrics.simpleSlideHeight,
        a = 0,
        o = 0,
        l = 0,
        u = 0,
        c = !1,
        d = this.renderer.smuflMetrics.postNoteEffectPadding;
      switch (this._outType) {
        case 1:
        case 2:
          if (
            ((a = t + i.x + i.getBeatX(this._startNote.beat, 4) + d),
            (o = e + i.y + i.getNoteY(this._startNote, 2)),
            this._startNote.slideTarget)
          ) {
            let h = this.renderer.scoreRenderer.layout.getRendererForBar(
              this.renderer.staff.staffId,
              this._startNote.slideTarget.beat.voice.bar
            );
            !h || h.staff !== i.staff
              ? ((l = t + i.x + i.width), (u = o))
              : ((l =
                  t +
                  h.x +
                  h.getBeatX(this._startNote.slideTarget.beat, 1) -
                  d),
                (u = e + h.y + h.getNoteY(this._startNote.slideTarget, 2))),
              this._startNote.slideTarget.fret > this._startNote.fret
                ? ((o += s), (u -= s))
                : ((o -= s), (u += s));
          } else (l = t + i.x + this._parent.x), (u = o);
          break;
        case 3:
          (a = t + i.x + i.getNoteX(this._startNote, 2) + d),
            (o = e + i.y + i.getNoteY(this._startNote, 2) + s),
            (l = a + n),
            (u = e + i.y + i.getNoteY(this._startNote, 2) - s);
          break;
        case 4:
          (a = t + i.x + i.getNoteX(this._startNote, 2) + d),
            (o = e + i.y + i.getNoteY(this._startNote, 2) - s),
            (l = a + n),
            (u = e + i.y + i.getNoteY(this._startNote, 2) + s);
          break;
        case 5:
          (a = t + i.x + i.getNoteX(this._startNote, 2) + d * 2),
            (o = e + i.y + i.getNoteY(this._startNote, 2)),
            (l = t + i.x + i.width),
            (u = o + s * 3),
            this._startNote.beat.nextBeat &&
              this._startNote.beat.nextBeat.voice ===
                this._startNote.beat.voice &&
              (l = t + i.x + i.getBeatX(this._startNote.beat.nextBeat, 0)),
            (c = !0);
          break;
        case 6:
          (a = t + i.x + i.getNoteX(this._startNote, 2) + d * 2),
            (o = e + i.y + i.getNoteY(this._startNote, 2)),
            (l = t + i.x + i.width),
            (u = o - s * 3),
            this._startNote.beat.nextBeat &&
              this._startNote.beat.nextBeat.voice ===
                this._startNote.beat.voice &&
              (l = t + i.x + i.getBeatX(this._startNote.beat.nextBeat, 0)),
            (c = !0);
          break;
        default:
          return;
      }
      this._paintSlideLine(r, c, a, l, o, u);
    }
    _paintSlideLine(t, e, r, i, n, s) {
      if (e) {
        let a = new Vt(0, 0, 1);
        (a.renderer = this.renderer),
          a.doLayout(),
          (n -= a.height / 2),
          (s -= a.height / 2);
        let o = i - r,
          l = s - n,
          u = Math.sqrt(Math.pow(l, 2) + Math.pow(o, 2));
        a.width = o;
        let c = Math.asin(l / u) * (180 / Math.PI);
        t.beginRotate(r, n, c), a.paint(0, 0, t), t.endRotate();
      } else t.beginPath(), t.moveTo(r, n), t.lineTo(i, s), t.stroke();
    }
  };
  var Hl = class extends ai {
    constructor(t, e, r, i = !1) {
      super(t, e, i),
        (this._direction = ai.getBeamDirectionForNote(t)),
        (this._forSlide = r);
    }
    getTieHeight(t, e, r, i) {
      let n = Math.max(0, r - t);
      return (Math.log(n + 1) * this.renderer.settings.notation.slurHeight) / 2;
    }
    tryExpand(t, e, r, i) {
      if (
        this._forSlide !== r ||
        this.forEnd !== i ||
        this.startNote.beat.id !== t.beat.id ||
        this.endNote.beat.id !== e.beat.id ||
        this._direction !== ai.getBeamDirectionForNote(t)
      )
        return !1;
      switch (this._direction) {
        case 0:
          t.realValue > this.startNote.realValue &&
            ((this.startNote = t), (this.startBeat = t.beat)),
            e.realValue > this.endNote.realValue &&
              ((this.endNote = e), (this.endBeat = e.beat));
          break;
        case 1:
          t.realValue < this.startNote.realValue &&
            ((this.startNote = t), (this.startBeat = t.beat)),
            e.realValue < this.endNote.realValue &&
              ((this.endNote = e), (this.endBeat = e.beat));
          break;
      }
      return !0;
    }
    paint(t, e, r) {
      let i = this.renderer.scoreRenderer.layout.getRendererForBar(
          this.renderer.staff.staffId,
          this.startBeat.voice.bar
        ),
        n = this.getBeamDirection(this.startBeat, i),
        s = `tab.slur.${this.startNote.beat.id}.${this.endNote.beat.id}.${n}`,
        a = this.renderer;
      a.staff.getSharedLayoutData(s, !1) ||
        (a.staff.setSharedLayoutData(s, !0), super.paint(t, e, r));
    }
  };
  var Jd = class extends ft {
    constructor() {
      super(...arguments);
      this._bend = null;
      this._effectSlurs = [];
    }
    drawBeamHelperAsFlags(e) {
      return e.hasFlag(this.renderer.drawBeamHelperAsFlags(e), this.beat);
    }
    doLayout() {
      (this._effectSlurs = []),
        super.doLayout(),
        this._bend &&
          ((this._bend.renderer = this.renderer),
          this._bend.doLayout(),
          this.updateWidth());
    }
    createTies(e) {
      if (!e.isVisible) return;
      let r = this.renderer;
      if (e.isTieOrigin && r.showTiedNotes && e.tieDestination.isVisible) {
        let i = new ai(e, e.tieDestination, !1);
        this.addTie(i);
      }
      if (e.isTieDestination && r.showTiedNotes) {
        let i = new ai(e.tieOrigin, e, !0);
        this.addTie(i);
      }
      if (e.isLeftHandTapped && !e.isHammerPullDestination) {
        let i = new ai(e, e, !1);
        this.addTie(i);
      }
      if (e.isEffectSlurOrigin && e.effectSlurDestination) {
        let i = !1;
        for (let n of this._effectSlurs)
          if (n.tryExpand(e, e.effectSlurDestination, !1, !1)) {
            i = !0;
            break;
          }
        if (!i) {
          let n = new Hl(e, e.effectSlurDestination, !1, !1);
          this._effectSlurs.push(n), this.addTie(n);
        }
      }
      if (e.isEffectSlurDestination && e.effectSlurOrigin) {
        let i = !1;
        for (let n of this._effectSlurs)
          if (n.tryExpand(e.effectSlurOrigin, e, !1, !0)) {
            i = !0;
            break;
          }
        if (!i) {
          let n = new Hl(e.effectSlurOrigin, e, !1, !0);
          this._effectSlurs.push(n), this.addTie(n);
        }
      }
      if (e.slideInType !== 0 || e.slideOutType !== 0) {
        let i = new Yd(e.slideInType, e.slideOutType, e, this);
        this.addTie(i);
      }
      if (e.hasBend) {
        if (!this._bend) {
          let i = new so();
          (this._bend = i), (i.renderer = this.renderer), this.addTie(i);
        }
        this._bend.addBends(e);
      }
    }
  };
  var qd = class extends ue {
    constructor(e, r, i) {
      super(e, r);
      this._noteString = null;
      this._trillNoteString = null;
      this._trillNoteStringWidth = 0;
      this.isEmpty = !1;
      this.noteStringWidth = 0;
      this._note = i;
    }
    doLayout() {
      let e = this._note,
        r = e.fret - e.beat.voice.bar.staff.transpositionPitch;
      if (
        (e.harmonicType === 1 &&
          e.harmonicValue !== 0 &&
          (r = e.harmonicValue - e.beat.voice.bar.staff.transpositionPitch),
        e.isTieDestination)
      )
        (e.beat.index === 0 &&
          this.renderer.settings.notation.notationMode === 0) ||
        ((e.bendType === 2 || e.bendType === 4) &&
          this.renderer.settings.notation.isNotationElementVisible(12))
          ? (this._noteString = `(${(
              e.tieOrigin.fret - e.beat.voice.bar.staff.transpositionPitch
            ).toString()})`)
          : (this._noteString = "");
      else {
        let allDeadVisual = true;
        let beat = e.beat;
        for (let note of beat.notes) {
          if (!note.isDeadVisual) {
            allDeadVisual = false;
            break;
          }
        }
        let isBrushEffect = beat.brushType >= 1 && beat.brushType <= 4;
        
        // Check if we should hide both X and normal notes
        if (allDeadVisual && isBrushEffect) {
          // Don't render any note string (neither X nor normal notes)
          this._noteString = "";
        } else {
          let isDead = e.isDead || (e.isDeadVisual && !(allDeadVisual && isBrushEffect));
          this._noteString = isDead ? "X" : r.toString();
          if (e.isGhost) {
            this._noteString = `(${this._noteString})`;
          }
          if (e.harmonicType === 1) {
            let i = this._noteString.indexOf(".");
            i >= 0 && (this._noteString = this._noteString.substr(0, i + 2)),
              (this._noteString = `<${this._noteString}>`);
          }
        }
      }
      if (e.isTrill)
        this._trillNoteString = `(${(
          e.trillFret - e.beat.voice.bar.staff.transpositionPitch
        ).toString()})`;
      else if (A.isAlmostEqualTo(e.harmonicValue, 0))
        this._trillNoteString = "";
      else
        switch (e.harmonicType) {
          case 2:
          case 3:
          case 4:
          case 5:
          case 6:
            let i = (r + e.harmonicValue).toString(),
              n = i.indexOf(".");
            n >= 0 && (i = i.substr(0, n + 2)),
              (this._trillNoteString = `<${i}>`);
            break;
          default:
            this._trillNoteString = "";
            break;
        }
      if (((this.isEmpty = !this._noteString), !this.isEmpty)) {
        this.renderer.scoreRenderer.canvas.font =
          this.renderer.resources.tablatureFont;
        let i = !!this._trillNoteString;
        (this.noteStringWidth = this.renderer.scoreRenderer.canvas.measureText(
          this._noteString + (i ? " " : "")
        ).width),
          (this.width = this.noteStringWidth),
          (this.height = this.renderer.scoreRenderer.canvas.font.size),
          i &&
            ((this.renderer.scoreRenderer.canvas.font =
              this.renderer.resources.graceFont),
            (this._trillNoteStringWidth =
              3 +
              this.renderer.scoreRenderer.canvas.measureText(
                this._trillNoteString
              ).width),
            (this.width += this._trillNoteStringWidth));
      }
    }
    paint(e, r, i) {
      var o = [];
      try {
        if (this.isEmpty) return;
        let n = this.noteStringWidth + this._trillNoteStringWidth;
        let s = e + this.x + (this.width - n) / 2;
        // 2x
        if (this._note.beat.graceType !== 0) {
          s += 2;
        }
        this.paintTrill(s, r, i);
        let a = j(o, $.note(i, 4, this._note));
        i.fillText(this._noteString, s, r + this.y);
      } catch (l) {
        var u = l,
          c = !0;
      } finally {
        ee(o, u, c);
      }
    }
    paintTrill(e, r, i) {
      var a = [];
      try {
        let n = j(a, $.note(i, 4, this._note));
        let s = this.renderer.scoreRenderer.canvas.font;
        this.renderer.scoreRenderer.canvas.font =
          this.renderer.resources.graceFont;
        i.fillText(this._trillNoteString, e + this.noteStringWidth, r + this.y);
        this.renderer.scoreRenderer.canvas.font = s;
      } catch (o) {
        var l = o,
          u = !0;
      } finally {
        ee(a, l, u);
      }
    }
    buildBoundingsLookup(e, r, i) {
      let n = new xr();
      (n.note = this._note),
        (n.noteHeadBounds = new we()),
        (n.noteHeadBounds.x = r + this.x),
        (n.noteHeadBounds.y = i + this.y - this.height / 2),
        (n.noteHeadBounds.w = this.width),
        (n.noteHeadBounds.h = this.height),
        e.addNote(n);
    }
  };
  var $d = class extends ue {
    constructor(e, r, i) {
      super(e, r);
      this._notes = [];
      this._deadSlapped = null;
      this.maxStringNote = null;
      this.minStringNote = null;
      this.beatEffects = new Map();
      this.notesPerString = new Map();
      this.noteStringWidth = 0;
      this._isGrace = i;
    }
    buildBoundingsLookup(e, r, i) {
      for (let n of this._notes)
        n.buildBoundingsLookup(e, r + this.x, i + this.y);
    }
    getNoteX(e, r) {
      if (this.notesPerString.has(e.string)) {
        let i = this.notesPerString.get(e.string),
          n = this.x + i.x;
        switch (r) {
          case 0:
            break;
          case 1:
            n += i.noteStringWidth / 2;
            break;
          case 2:
            n += i.width;
            break;
        }
        return n;
      }
      return 0;
    }
    getLowestNoteY() {
      return this.maxStringNote ? this.getNoteY(this.maxStringNote, 2) : 0;
    }
    getHighestNoteY() {
      return this.minStringNote ? this.getNoteY(this.minStringNote, 2) : 0;
    }
    getNoteY(e, r) {
      if (this.notesPerString.has(e.string)) {
        let i = this.notesPerString.get(e.string),
          n = this.y + i.y;
        switch (r) {
          case 1:
          case 0:
            n -= i.height / 2;
            break;
          case 2:
            break;
          case 3:
          case 4:
            n += i.height / 2;
            break;
          case 5:
          case 6:
            break;
        }
        return n;
      }
      return 0;
    }
    doLayout() {
      let e = 0;
      if (this.beat.deadSlapped)
        (this._deadSlapped = new Oi()),
          (this._deadSlapped.renderer = this.renderer),
          this._deadSlapped.doLayout(),
          (e = this._deadSlapped.width),
          (this.noteStringWidth = e);
      else {
        let r = 0;
        for (let a = 0, o = this._notes.length; a < o; a++) {
          let l = this._notes[a];
          (l.renderer = this.renderer),
            l.doLayout(),
            l.width > e && (e = l.width),
            l.noteStringWidth > r && (r = l.noteStringWidth);
        }
        this.noteStringWidth = r;
        let i = this.renderer.resources.tablatureFont.size,
          n = this.getNoteY(this.minStringNote, 2) + i / 2,
          s = this.renderer.smuflMetrics.onNoteEffectPadding;
        for (let a of this.beatEffects.values())
          (a.y += n),
            (a.x += this.width / 2),
            (a.renderer = this.renderer),
            (n += a.height + s),
            a.doLayout();
      }
      this.width = e;
    }
    addNoteGlyph(e, r) {
      this._notes.push(e),
        this.notesPerString.set(r.string, e),
        (!this.minStringNote || r.string < this.minStringNote.string) &&
          (this.minStringNote = r),
        (!this.maxStringNote || r.string > this.maxStringNote.string) &&
          (this.maxStringNote = r);
    }
    paint(e, r, i) {
      if (((e += this.x), (r += this.y), this.beat.deadSlapped))
        this._deadSlapped?.paint(e, r, i);
      else {
        var n = [];
        try {
          let l = this.renderer.resources;
          let u = i.textBaseline;
          i.textBaseline = 1;
          i.font = this._isGrace ? l.graceFont : l.tablatureFont;
          let c = this._notes;
          let d = this.width;
          let h = !1;
          for (let f of this.beat.notes)
            if (f.isDead) {
              h = !0;
              break;
            }
          if (h) {
            let f = Number.POSITIVE_INFINITY;
            let b = Number.NEGATIVE_INFINITY;
            let y = Number.POSITIVE_INFINITY;
            let S = Number.NEGATIVE_INFINITY;
            for (let p of c) {
              if (p.isEmpty) continue;
              let m = p.noteStringWidth + (p._trillNoteStringWidth || 0);
              let g = e + p.x + (d - m) / 2;
              if (p._note.beat.graceType !== 0) {
                g += 2;
              }
              f = Math.min(f, g);
              b = Math.max(b, g + p.noteStringWidth);
              let v = r + p.y - p.height / 2;
              y = Math.min(y, v);
              S = Math.max(S, v + p.height);
            }
            if (f !== Number.POSITIVE_INFINITY) {
              let p = 1;
              let m = i.lineWidth;
              i.lineWidth = 1;
              let g = i.lineWidth % 2 === 0 ? 0 : 0.5;
              let v = 1;
              i.strokeRect(
                f - p - g + 0.3,
                y - p - g,
                Math.max(1, b - f + p * 2 - v),
                Math.max(1, S - y + p * 2 - v)
              );
              i.lineWidth = m;
            }
          }
          for (let f of c)
            (f.renderer = this.renderer), (f.width = d), f.paint(e, r, i);
          i.textBaseline = u;
          let f = j(n, $.beat(i, 11, this.beat));
          for (let f of this.beatEffects.values()) f.paint(e, r, i);
        } catch (s) {
          var a = s,
            o = !0;
        } finally {
          ee(n, a, o);
        }
      }
    }
    updateBeamingHelper(e) {
      this.beamingHelper &&
        this.beamingHelper.isPositionFrom("tab", this.beat) &&
        this.beamingHelper.registerBeatLineX(
          "tab",
          this.beat,
          e + this.x + this.width / 2,
          e + this.x + this.width / 2
        );
    }
  };
  var Kd = class extends ce {
    constructor(t, e, r, i) {
      super(t, e, 1, jn.getSymbol(i)), (this._isVisibleRest = r);
    }
    doLayout() {
      super.doLayout();
    }
    updateBeamingHelper(t) {
      this.beamingHelper &&
        this.beamingHelper.isPositionFrom("tab", this.beat) &&
        this.beamingHelper.registerBeatLineX(
          "tab",
          this.beat,
          t + this.x + this.width / 2,
          t + this.x + this.width / 2
        );
    }
    paint(t, e, r) {
      if (this._isVisibleRest) {
        var i = [];
        try {
          let o = j(i, $.beat(r, 12, this.beat));
          super.paint(t, e, r);
        } catch (n) {
          var s = n,
            a = !0;
        } finally {
          ee(i, s, a);
        }
      }
    }
  };
  var sn = class sn extends ue {
    constructor(e) {
      super(0, 0);
      this._isSimpleDip = !1;
      (this._beat = e), (this._renderPoints = this._createRenderingPoints(e));
    }
    _createRenderingPoints(e) {
      if (e.whammyBarType === 1) return e.whammyBarPoints;
      let r = [];
      switch (e.whammyBarType) {
        case 2:
        case 4:
        case 6:
        case 5:
          r.push(new I(0, e.whammyBarPoints[0].value)),
            r.push(new I(I.MaxPosition, e.whammyBarPoints[1].value));
          break;
        case 3:
          r.push(new I(0, e.whammyBarPoints[0].value)),
            r.push(new I((I.MaxPosition / 2) | 0, e.whammyBarPoints[1].value)),
            r.push(
              new I(
                I.MaxPosition,
                e.whammyBarPoints[e.whammyBarPoints.length - 1].value
              )
            );
          break;
      }
      return r;
    }
    doLayout() {
      super.doLayout(),
        (this._isSimpleDip =
          this.renderer.settings.notation.notationMode === 1 &&
          this._beat.whammyBarType === 3);
      let e = null,
        r = null,
        i = this._beat;
      for (; i && i.hasWhammyBar; )
        (!e || e.value > i.minWhammyPoint.value) && (e = i.minWhammyPoint),
          (!r || r.value < i.maxWhammyPoint.value) && (r = i.maxWhammyPoint),
          (i = i.nextBeat);
      let n = r.value > 0 ? Math.abs(this._getOffset(r.value)) : 0;
      (n > 0 ||
        this._beat.whammyBarPoints[0].value !== 0 ||
        this.renderer.settings.notation.isNotationElementVisible(13)) &&
        (n +=
          this.renderer.resources.tablatureFont.size +
          this.renderer.smuflMetrics.tabWhammyTextPadding);
      let s = e.value < 0 ? Math.abs(this._getOffset(e.value)) : 0,
        a = this.renderer.staff.getSharedLayoutData(
          sn._topOffsetSharedDataKey,
          -1
        ),
        o = a;
      n > a &&
        (this.renderer.staff.setSharedLayoutData(sn._topOffsetSharedDataKey, n),
        (o = n));
      let l = this.renderer.staff.getSharedLayoutData(
          sn._bottomOffsetSharedDataKey,
          -1
        ),
        u = l;
      s > l &&
        (this.renderer.staff.setSharedLayoutData(
          sn._bottomOffsetSharedDataKey,
          s
        ),
        (u = l)),
        (this.height = n + s),
        this.renderer.registerOverflowTop(o + u);
    }
    _getOffset(e) {
      if (e === 0) return 0;
      let r =
        this.renderer.smuflMetrics.tabWhammyPerHalfHeight +
        Math.log2(Math.abs(e) / 2) *
          this.renderer.smuflMetrics.tabWhammyPerHalfHeight;
      return e < 0 && (r = -r), r;
    }
    paint(e, r, i) {
      var f = [];
      try {
        let n = j(f, $.beat(i, 5, this._beat));
        let s = this.renderer;
        let a = this._beat.nextBeat;
        let o = null;
        let l = 0;
        a &&
          ((o = this.renderer.scoreRenderer.layout.getRendererForBar(
            this.renderer.staff.staffId,
            a.voice.bar
          )),
          !o || o.staff !== s.staff || (o !== s && !a.hasWhammyBar)
            ? ((a = null), (o = null))
            : (l =
                a.hasWhammyBar &&
                (s.settings.notation.notationMode !== 1 ||
                  a.whammyBarType !== 3)
                  ? 2
                  : 0));
        let u = 0;
        let c = 0;
        this._isSimpleDip
          ? ((u = e + s.x + s.getBeatX(this._beat, 1)),
            (c = e + s.x + s.getBeatX(this._beat, 4)))
          : ((u = e + s.x + s.getBeatX(this._beat, 2)),
            (c = o
              ? e + o.x + o.getBeatX(a, l)
              : e + s.x + s.postBeatGlyphsStart));
        let d = i.textAlign;
        let h = i.textBaseline;
        i.textAlign = 1;
        i.textBaseline = 3;
        if (this._renderPoints.length >= 2) {
          let k = (c - u) / I.MaxPosition;
          i.beginPath();
          let T = this.renderer.staff.getSharedLayoutData(
              sn._topOffsetSharedDataKey,
              0
            ),
            O = r + T,
            N = this._beat.whammyStyle === 1 ? "grad." : "";
          for (let R = 0, g = this._renderPoints.length - 1; R < g; R++) {
            let x = this._renderPoints[R],
              M = this._renderPoints[R + 1],
              P = R === 0;
            R === 0 &&
              x.value !== 0 &&
              !this._beat.isContinuedWhammy &&
              (this._paintWhammy(!1, new I(0, 0), x, u, O, k, i), (P = !1)),
              this._paintWhammy(P, x, M, u, O, k, i, N),
              (N = "");
          }
          i.stroke();
        }
        i.textAlign = d;
        i.textBaseline = h;
      } catch (b) {
        var y = b,
          S = !0;
      } finally {
        ee(f, y, S);
      }
    }
    _paintWhammy(e, r, i, n, s, a, o, l) {
      let u = n + a * r.offset,
        c = n + a * i.offset,
        d = s - this._getOffset(r.value),
        h = s - this._getOffset(i.value);
      if (r.offset === i.offset) {
        let y = this.renderer.smuflMetrics.tabWhammyDashSize;
        if (Math.abs(h - d) / (y * 2) < 1) o.moveTo(u, d), o.lineTo(c, h);
        else {
          let k = Math.max(d, h),
            T = Math.min(d, h);
          for (; k > T; ) o.moveTo(u, T), o.lineTo(u, T + y), (T += y * 2);
        }
        o.stroke();
      } else if (r.value === i.value) {
        let y = this.renderer.smuflMetrics.tabWhammyDashSize;
        if (Math.abs(c - u) / (y * 2) < 1) o.moveTo(u, d), o.lineTo(c, h);
        else {
          let k = Math.max(u, c),
            T = Math.min(u, c);
          for (; k > T; ) o.moveTo(k, d), o.lineTo(k - y, d), (k -= y * 2);
        }
        o.stroke();
      } else o.moveTo(u, d), o.lineTo(c, h);
      let f = this.renderer.smuflMetrics.tabWhammyTextPadding;
      e &&
        !this._beat.isContinuedWhammy &&
        !this._isSimpleDip &&
        (this.renderer.settings.notation.isNotationElementVisible(13) &&
          o.fillText("0", u, d - f),
        l && o.fillText(l, u, d - f));
      let b = Math.abs(i.value);
      if (
        (b !== 0 ||
          (this.renderer.settings.notation.isNotationElementVisible(13) &&
            !this._isSimpleDip)) &&
        r.value !== i.value
      ) {
        let y = "";
        if ((i.value < 0 && (y += "-"), b >= 4)) {
          let T = (b / 4) | 0;
          (y += T), (b -= T * 4);
        } else b === 0 && (y += "0");
        b > 0 && (y += so.getFractionSign(b));
        let S = 0;
        this._isSimpleDip
          ? (S = Math.min(d, h))
          : (S = r.offset === i.offset ? Math.min(d, h) : h);
        let k = c;
        o.fillText(y, k, S - f);
      }
    }
  };
  (sn._topOffsetSharedDataKey = "tab.whammy.topoffset"),
    (sn._bottomOffsetSharedDataKey = "tab.whammy.bottomffset");
  var Qd = sn;
  var Zd = class extends _t {
    constructor() {
      super(...arguments);
      this.slash = null;
      this.noteNumbers = null;
      this.restGlyph = null;
    }
    get effectElement() {
      return 11;
    }
    getNoteX(e, r) {
      return this.noteNumbers ? this.noteNumbers.getNoteX(e, r) : 0;
    }
    getNoteY(e, r) {
      return this.noteNumbers ? this.noteNumbers.getNoteY(e, r) : 0;
    }
    getLowestNoteY() {
      return this.noteNumbers ? this.noteNumbers.getLowestNoteY() : 0;
    }
    getHighestNoteY() {
      return this.noteNumbers ? this.noteNumbers.getHighestNoteY() : 0;
    }
    buildBoundingsLookup(e, r, i) {
      this.noteNumbers &&
        this.noteNumbers.buildBoundingsLookup(e, r + this.x, i + this.y);
    }
    doLayout() {
      let e = this.renderer,
        r = [];
      if (this.container.beat.isRest) {
        let n = Math.floor((this.renderer.bar.staff.tuning.length - 1) / 2),
          s = e.getTabY(n),
          a = new Kd(0, s, e.showRests, this.container.beat.duration);
        if (
          ((this.restGlyph = a),
          (a.beat = this.container.beat),
          (a.beamingHelper = this.beamingHelper),
          this.addNormal(a),
          this.container.beat.dots > 0 && e.showRests)
        )
          for (let o = 0; o < this.container.beat.dots; o++)
            this.addEffect(new gi(0, s));
      } else {
        let n =
            this.renderer.settings.notation.smallGraceTabNotes &&
            this.container.beat.graceType !== 0,
          s;
        if (
          this.container.beat.slashed &&
          !this.container.beat.notes.some((a) => a.isTieDestination)
        ) {
          let a = Math.floor((this.renderer.bar.staff.tuning.length - 1) / 2),
            o = e.getLineY(a),
            l = new oi(
              0,
              o,
              this.container.beat.duration,
              n,
              this.container.beat
            );
          (l.noteHeadElement = 4),
            (l.effectElement = 11),
            (this.slash = l),
            (l.beat = this.container.beat),
            (l.beamingHelper = this.beamingHelper),
            this.addNormal(l),
            (s = l.beatEffects);
        } else {
          let a = new $d(0, 0, n);
          (this.noteNumbers = a),
            (a.beat = this.container.beat),
            (a.beamingHelper = this.beamingHelper);
          for (let o of this.container.beat.notes)
            o.isVisible && this._createNoteGlyph(o);
          this.addNormal(a), (s = a.beatEffects);
        }
        if (this.container.beat.hasWhammyBar) {
          let a = new Qd(this.container.beat);
          (a.renderer = this.renderer),
            a.doLayout(),
            this.container.ties.push(a);
        }
        if (this.container.beat.isTremolo && !s.has("tremolo")) {
          let a = this.container.beat.tremoloSpeed,
            o = new ro(0, 0, a);
          (o.offsetY = this.renderer.smuflMetrics.glyphTop.get(o.symbol)),
            s.set("tremolo", o),
            r.push(o);
        }
        if (this.container.beat.dots > 0 && e.rhythmMode !== 0)
          for (let a = 0; a < this.container.beat.dots; a++)
            this.addEffect(
              new gi(
                0,
                e.lineOffset * e.bar.staff.tuning.length +
                  e.settings.notation.rhythmHeight
              )
            );
      }
      if (this.isEmpty) return;
      let i = 0;
      for (let n = 0, s = this.glyphs.length; n < s; n++) {
        let a = this.glyphs[n];
        (a.x = i), (a.renderer = this.renderer), a.doLayout(), (i += a.width);
      }
      (this.width = i),
        (this.computedWidth = i),
        this.container.beat.isEmpty
          ? (this.centerX = this.width / 2)
          : this.restGlyph
          ? (this.centerX = this.restGlyph.x + this.restGlyph.width / 2)
          : this.noteNumbers
          ? (this.centerX =
              this.noteNumbers.x + this.noteNumbers.noteStringWidth / 2)
          : this.slash && (this.centerX = this.slash.x + this.slash.width / 2);
      for (let n of r) n.x = this.centerX;
    }
    updateBeamingHelper() {
      this.noteNumbers
        ? this.noteNumbers.updateBeamingHelper(this.container.x + this.x)
        : this.restGlyph
        ? this.restGlyph.updateBeamingHelper(this.container.x + this.x)
        : this.slash &&
          this.slash.updateBeamingHelper(this.container.x + this.x);
    }
    _createNoteGlyph(e) {
      let r = this.renderer,
        i = new qd(0, 0, e),
        n = e.beat.voice.bar.staff.tuning.length - e.string;
      (i.y = r.getTabY(n)),
        (i.renderer = this.renderer),
        i.doLayout(),
        this.noteNumbers.addNoteGlyph(i, e);
      let s = i.y - i.height / 2,
        a = s + i.height;
      this.renderer.helpers.collisionHelper.reserveBeatSlot(
        this.container.beat,
        s,
        a
      );
    }
  };
  var jd = class extends ue {
    constructor(t) {
      super(0, 0), (this._beat = t);
    }
    doLayout() {
      if (
        ((this.width = this.renderer.smuflMetrics.glyphWidths.get(60284)),
        this._beat.brushType === 3)
      ) {
        let t = new Vt(0, 0, 1, !0);
        (t.renderer = this.renderer),
          t.doLayout(),
          (this._noteVibratoGlyph = t);
      } else if (this._beat.brushType === 4) {
        let t = new Vt(0, 0, 1, !0);
        (t.renderer = this.renderer),
          t.doLayout(),
          (this._noteVibratoGlyph = t);
      }
    }
    paint(t, e, r) {
      let i = this.renderer,
        n = e + this.x + i.getNoteY(this._beat.maxStringNote, 1) - 4,
        s = e + this.y + i.getNoteY(this._beat.minStringNote, 3) - 4,
        // Check if all notes in the beat are dead visual
        allDeadVisual = true;
      for (let note of this._beat.notes) {
        if (!note.isDeadVisual) {
          allDeadVisual = false;
          break;
        }
      }
      let a = t + this.x + this.width / 2 + (allDeadVisual ? 8 : 0),
        o = this.renderer.smuflMetrics.glyphWidths.get(60284);
      if (this._beat.brushType !== 0) {
        if (this._beat.brushType === 1 || this._beat.brushType === 2)
          r.beginPath(), r.moveTo(a, n), r.lineTo(a, s + 10), r.stroke();
        else if (this._beat.brushType === 3) {
          // SVG
          let u = n,
            c = s - o + 10;
          const waveHeight = 5;
          const waveWidth = 3;
          const waveCount = Math.floor(Math.abs(c - u) / waveHeight);
          
          r.beginPath();
          r.moveTo(a, u);
          
          let lastY = u;
          for (let i = 1; i <= waveCount; i++) {
            const y = u + i * waveHeight;
            if (i % 2 === 1) {
              r.quadraticCurveTo(a - waveWidth, y - waveHeight / 2, a, y);
            } else {
              r.quadraticCurveTo(a + waveWidth, y - waveHeight / 2, a, y);
            }
            lastY = y;
          }
          
          // 
          if (lastY < c) {
            const remainingHeight = c - lastY;
            const controlX = waveCount % 2 === 1 ? a + waveWidth : a - waveWidth;
            r.quadraticCurveTo(controlX, lastY + remainingHeight / 2, a, c);
          }
          
          r.stroke();
        } else if (this._beat.brushType === 4) {
          // SVG
          let u = n + o,
            c = s + 10;
          const waveHeight = 5;
          const waveWidth = 3;
          const waveCount = Math.floor(Math.abs(c - u) / waveHeight);
          
          r.beginPath();
          r.moveTo(a, u);
          
          for (let i = 1; i <= waveCount; i++) {
            const y = u + i * waveHeight;
            if (i % 2 === 1) {
              r.quadraticCurveTo(a + waveWidth, y - waveHeight / 2, a, y);
            } else {
              r.quadraticCurveTo(a - waveWidth, y - waveHeight / 2, a, y);
            }
          }
          r.stroke();
        }
        if (this._beat.brushType === 1 || this._beat.brushType === 3) {
          // /
          r.beginPath();
          r.moveTo(a + o / 2, s + 10 - o);
          r.lineTo(a, s + 10);
          r.lineTo(a - o / 2, s + 10 - o);
          r.stroke();
          // 
          r.beginPath();
          r.moveTo(a, s + 10);
          r.lineTo(a, s + 10 - o);
          r.stroke();
        } else {
          // /
          r.beginPath();
          r.moveTo(a + o / 2, n + o);
          r.lineTo(a, n);
          r.lineTo(a - o / 2, n + o);
          r.stroke();
          // 
          r.beginPath();
          r.moveTo(a, n);
          r.lineTo(a, n + o);
          r.stroke();
        };
      }
    }
  };
  var ep = class extends vt {
    doLayout() {
      this.container.beat.brushType !== 0 &&
        !this.container.beat.isRest &&
        (this.addEffect(new jd(this.container.beat)),
        this.addNormal(
          new Ke(0, 0, this.renderer.smuflMetrics.preNoteEffectPadding)
        )),
        super.doLayout();
    }
    get effectElement() {
      return 11;
    }
  };
  var tp = class extends ce {
    constructor(t, e) {
      super(t, e, 1, 57453);
    }
    doLayout() {
      (this.symbol =
        this.renderer.bar.staff.tuning.length <= 4 ? 57454 : 57453),
        (this.center = !0),
        super.doLayout(),
        (this.width = this.renderer.smuflMetrics.glyphWidths.get(57424)),
        (this.offsetX = this.width / 2);
    }
  };
  var rp = class extends Za {
    doLayout() {
      (this.barSubElement = 17), super.doLayout();
    }
    get commonScale() {
      return 1;
    }
    get numberScale() {
      return this.renderer.bar.staff.tuning.length <= 4 ? ie.GraceScale : 1;
    }
  };
  var es = class extends Fi {
    constructor(e, r) {
      super(e, r);
      this._hasTuplets = !1;
      this.showTimeSignature = !1;
      this.showRests = !1;
      this.showTiedNotes = !1;
      this._showMultiBarRest = !1;
      r.staff.showStandardNotation ||
        ((this.showTimeSignature = !0),
        (this.showRests = !0),
        (this.showTiedNotes = !0),
        (this._showMultiBarRest = !0));
    }
    get showMultiBarRest() {
      return this._showMultiBarRest;
    }
    get repeatsBarSubElement() {
      return 1;
    }
    get barNumberBarSubElement() {
      return 5;
    }
    get barLineBarSubElement() {
      return 9;
    }
    get staffLineBarSubElement() {
      return 21;
    }
    get lineSpacing() {
      return this.smuflMetrics.tabLineSpacing;
    }
    get heightLineCount() {
      return this.bar.staff.tuning.length;
    }
    get drawnLineCount() {
      return this.bar.staff.tuning.length;
    }
    get rhythmMode() {
      let e = this.settings.notation.rhythmMode;
      return e === 3 && (e = this.bar.staff.showStandardNotation ? 0 : 2), e;
    }
    getTabY(e) {
      return super.getLineY(e);
    }
    getTabHeight(e) {
      return super.getLineHeight(e);
    }
    collectSpaces(e) {
      let r = this.smuflMetrics.staffLineThickness;
      for (let i of this.bar.voices)
        if (this.hasVoiceContainer(i)) {
          let n = this.getVoiceContainer(i);
          for (let s of n.beatGlyphs) {
            let a = s.onNotes,
              o = a.noteNumbers;
            if (o)
              for (let [l, u] of o.notesPerString)
                u.isEmpty ||
                  e[this.bar.staff.tuning.length - l].push(
                    new Float32Array([
                      n.x + s.x + a.x + o.x - r,
                      o.width + r * 2,
                    ])
                  );
          }
        }
    }
    adjustSizes() {
      if (this.rhythmMode !== 0) {
        let e = 1;
        for (let r of this.helpers.beamHelpers)
          for (let i of r)
            i.tremoloDuration &&
              (!e || e < i.tremoloDuration) &&
              (e = i.tremoloDuration);
        switch (e) {
          case 8:
            this.height += this.smuflMetrics.glyphHeights.get(57888);
            break;
          case 16:
            this.height += this.smuflMetrics.glyphHeights.get(57889);
            break;
          case 32:
            this.height += this.smuflMetrics.glyphHeights.get(57890);
            break;
        }
        (this.height += this.settings.notation.rhythmHeight),
          (this.bottomPadding += this.settings.notation.rhythmHeight);
      }
    }
    doLayout() {
      if ((super.doLayout(), this.rhythmMode !== 0)) {
        this._hasTuplets = !1;
        for (let e of this.bar.voices)
          if (
            this.hasVoiceContainer(e) &&
            this.getVoiceContainer(e).tupletGroups.length > 0
          ) {
            this._hasTuplets = !0;
            break;
          }
        this._hasTuplets && this.registerOverflowBottom(this.tupletSize);
      }
    }
    createLinePreBeatGlyphs() {
      if (this.isFirstOfLine) {
        let e = (this.bar.staff.tuning.length - 1) / 2;
        this.createStartSpacing(),
          this.addPreBeatGlyph(new tp(0, this.getTabY(e)));
      }
      this.showTimeSignature &&
        (!this.bar.previousBar ||
          (this.bar.previousBar &&
            this.bar.masterBar.timeSignatureNumerator !==
              this.bar.previousBar.masterBar.timeSignatureNumerator) ||
          (this.bar.previousBar &&
            this.bar.masterBar.timeSignatureDenominator !==
              this.bar.previousBar.masterBar.timeSignatureDenominator) ||
          (this.bar.previousBar &&
            this.bar.masterBar.isFreeTime &&
            this.bar.masterBar.isFreeTime !==
              this.bar.previousBar.masterBar.isFreeTime)) &&
        (this.createStartSpacing(), this._createTimeSignatureGlyphs());
    }
    _createTimeSignatureGlyphs() {
      this.addPreBeatGlyph(new Ke(0, 0, this.smuflMetrics.oneStaffSpace));
      let e = (this.bar.staff.tuning.length + 1) / 2 - 1;
      this.addPreBeatGlyph(
        new rp(
          0,
          this.getTabY(e),
          this.bar.masterBar.timeSignatureNumerator,
          this.bar.masterBar.timeSignatureDenominator,
          this.bar.masterBar.timeSignatureCommon,
          this.bar.masterBar.isFreeTime
        )
      );
    }
    createVoiceGlyphs(e) {
      if (this.additionalMultiRestBars) {
        let r = new za(this.getVoiceContainer(e));
        this.addBeatGlyph(r);
      } else
        for (let r of e.beats) {
          let i = new Jd(r, this.getVoiceContainer(e));
          (i.preNotes = new ep()), (i.onNotes = new Zd()), this.addBeatGlyph(i);
        }
    }
    paint(e, r, i) {
      super.paint(e, r, i),
        this.rhythmMode !== 0 &&
          (this.paintBeams(e, r, i, 8, 9), this.paintTuplets(e, r, i, 10));
    }
    drawBeamHelperAsFlags(e) {
      return super.drawBeamHelperAsFlags(e) || this.rhythmMode === 1;
    }
    getFlagTopY(e, r) {
      let i = this.getOnNotesGlyphForBeat(e);
      return !i.noteNumbers || e.duration === 2
        ? this.height - this.settings.notation.rhythmHeight - this.tupletSize
        : i.noteNumbers.getNoteY(i.noteNumbers.minStringNote, 3) +
            this.smuflMetrics.staffLineThickness;
    }
    getFlagBottomY(e, r) {
      return this.getFlagAndBarPos();
    }
    getFlagStemSize(e, r = !1) {
      return 0;
    }
    getBarLineStart(e, r) {
      return this.getFlagTopY(e, r);
    }
    getBeamDirection(e) {
      return 1;
    }
    getFlagAndBarPos() {
      return this.height - (this._hasTuplets ? this.tupletSize / 2 : 0);
    }
    calculateBeamYWithDirection(e, r, i) {
      return this.getFlagAndBarPos();
    }
    shouldPaintFlag(e, r) {
      return !super.shouldPaintFlag(e, r) || e.graceType !== 0
        ? !1
        : this.drawBeamHelperAsFlags(r);
    }
    paintBeamingStem(e, r, i, n, s, a) {
      var c = [];
      try {
        if (s < n) {
          let b = s;
          (s = n), (n = b);
        }
        let o = j(c, $.beat(a, 7, e));
        let l = [];
        this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.has(
          e.displayStart
        ) &&
          ((l = this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime
            .get(e.displayStart)
            .slots.slice()),
          l.sort((b, y) => b.topY - y.topY));
        let u = s;
        for (; u > n; ) {
          let b = n + 8;
          if (l.length > 0 && l[l.length - 1].bottomY > b) {
            let y = l.pop();
            (b = r + y.bottomY),
              a.fillRect(i, b, this.smuflMetrics.stemThickness, u - b),
              (u = r + y.topY);
          } else {
            a.fillRect(i, b, this.smuflMetrics.stemThickness, u - b);
            break;
          }
        }
      } catch (d) {
        var h = d,
          f = !0;
      } finally {
        ee(c, h, f);
      }
    }
  };
  es.StaffId = "tab";
  var ao = class extends ri {
    constructor() {
      super();
      this.showTimeSignature = null;
      this.showRests = null;
      this.showTiedNotes = null;
      this.hideOnPercussionTrack = !0;
    }
    get staffId() {
      return es.StaffId;
    }
    getStaffPaddingTop(e) {
      return e.system.layout.renderer.settings.display.notationStaffPaddingTop;
    }
    getStaffPaddingBottom(e) {
      return e.system.layout.renderer.settings.display
        .notationStaffPaddingBottom;
    }
    canCreate(e, r) {
      return r.showTablature && r.tuning.length > 0 && super.canCreate(e, r);
    }
    create(e, r) {
      let i = new es(e, r);
      return (
        this.showRests !== null && (i.showRests = this.showRests),
        this.showTimeSignature !== null &&
          (i.showTimeSignature = this.showTimeSignature),
        this.showTiedNotes !== null && (i.showTiedNotes = this.showTiedNotes),
        i
      );
    }
  };
  var Wh = {},
    ip = class {
      constructor(t, e) {
        (this.vertical = t), (this.createLayout = e);
      }
    },
    Os = class {
      constructor(t, e) {
        (this.supportsWorkers = t), (this.createCanvas = e);
      }
    },
    V = class V {
      static get globalThis() {
        if (V._globalThis === void 0) {
          try {
            V._globalThis = globalThis;
          } catch {}
          typeof V._globalThis > "u" && (V._globalThis = self),
            typeof V._globalThis > "u" && (V._globalThis = global),
            typeof V._globalThis > "u" && (V._globalThis = window),
            typeof V._globalThis > "u" &&
              (V._globalThis = Function("return this")());
        }
        return V._globalThis;
      }
      static get isRunningInWorker() {
        return "WorkerGlobalScope" in V.globalThis;
      }
      static get isRunningInAudioWorklet() {
        return "AudioWorkletGlobalScope" in V.globalThis;
      }
      static throttle(t, e) {
        let r = 0;
        return () => {
          V.globalThis.clearTimeout(r), (r = V.globalThis.setTimeout(t, e));
        };
      }
      static _detectScriptFile() {
        if (!V.isRunningInWorker && V.globalThis.ALPHATAB_ROOT) {
          let t = V.globalThis.ALPHATAB_ROOT;
          return (t = V.ensureFullUrl(t)), (t = V._appendScriptName(t)), t;
        }
        try {
          let t = Wh.url;
          if (t && t.indexOf("file://") === -1) return t;
        } catch {}
        return "document" in V.globalThis &&
          document.currentScript &&
          document.currentScript instanceof HTMLScriptElement
          ? document.currentScript.src
          : null;
      }
      static ensureFullUrl(t) {
        if (!t) return "";
        if (
          !t.startsWith("http") &&
          !t.startsWith("https") &&
          !t.startsWith("file")
        ) {
          let e = "",
            r = V.globalThis.location;
          if (
            ((e += r.protocol?.toString()),
            (e += "//"),
            r.hostname && (e += r.hostname?.toString()),
            r.port && ((e += ":"), (e += r.port?.toString())),
            !t.startsWith("/"))
          ) {
            let i = r.pathname.split("/").slice(0, -1).join("/");
            i.length > 0 &&
              (i.startsWith("/") || (e += "/"), (e += i?.toString()));
          }
          return t.startsWith("/") || (e += "/"), (e += t?.toString()), e;
        }
        return t;
      }
      static _appendScriptName(t) {
        return (
          t &&
            !t.endsWith(".js") &&
            (t.endsWith("/") || (t += "/"), (t += "alphaTab.js")),
          t
        );
      }
      static _detectFontDirectory() {
        if (!V.isRunningInWorker && V.globalThis.ALPHATAB_FONT)
          return V.ensureFullUrl(V.globalThis.ALPHATAB_FONT);
        let t = V.scriptFile;
        if (t) {
          let e = t.lastIndexOf("/");
          if (e >= 0) return `${t.substr(0, e)}/font/`;
        }
        return null;
      }
      static _registerJQueryPlugin() {
        if (!V.isRunningInWorker && V.globalThis && "jQuery" in V.globalThis) {
          let t = V.globalThis.jQuery,
            e = new kl();
          (t.fn.alphaTab = function (r) {
            let i = Array.prototype.slice.call(arguments, 1);
            return this.length === 1
              ? e.exec(this[0], r, i)
              : this.each((n, s) => {
                  e.exec(s, r, i);
                });
          }),
            (t.alphaTab = { restore: kl.restore }),
            (t.fn.alphaTab.fn = e);
        }
      }
      static getRenderEngineFactory(t) {
        return !t || !V.renderEngines.has(t)
          ? V.renderEngines.get("default")
          : V.renderEngines.get(t);
      }
      static getLayoutEngineFactory(t) {
        return !t || !V.layoutEngines.has(t)
          ? V.layoutEngines.get(0)
          : V.layoutEngines.get(t);
      }
      static buildImporters() {
        return [new du(), new fu(), new hu(), new bu(), new cu(), new Ei()];
      }
      static _createDefaultRenderEngines() {
        let t = new Map();
        return (
          t.set("svg", new Os(!0, () => new Wa())),
          t.set("default", t.get("svg")),
          t.set("skia", new Os(!1, () => new Ga())),
          V._createPlatformSpecificRenderEngines(t),
          t
        );
      }
      static enableAlphaSkia(t, e) {
        Ga.enable(t, e);
      }
      static registerAlphaSkiaCustomFont(t) {
        return Ga.registerFont(t);
      }
      static _createPlatformSpecificRenderEngines(t) {
        t.set("html5", new Os(!1, () => new qu()));
      }
      static _createDefaultRenderers() {
        return [
          new Di(V._staffIdBeforeSlashAlways, [
            new sd(),
            new ud(),
            new Jc(),
            new Lc(),
            new xc(),
            new Hc(),
            new ad(),
            new Ec(),
            new Ac(),
          ]),
          new Xd(),
          new Di(V._staffIdBeforeScoreAlways, [
            new Vc(),
            new wc(),
            new $c(),
            new ed(),
            new dd(),
          ]),
          new Di(
            V._staffIdBeforeScoreHideable,
            [
              new pd(),
              new Il(),
              new Pl(!0),
              new Ll(),
              new Cl(),
              new Dl(),
              new Ml(!1),
              new El(),
              new Ps(2),
            ],
            (t, e) => e.showStandardNotation
          ),
          new Wd(),
          new Di(V._staffIdBeforeNumberedAlways, [
            new Mc(),
            new Pl(!1),
            new Fc(),
            new Ps(1, (t, e) => e.voice.bar.staff.showStandardNotation),
            new rd(),
          ]),
          new _d(),
          new Di(V._staffIdBeforeTabAlways, [new Yc()]),
          new Di(
            V._staffIdBeforeTabHideable,
            [
              new Il(),
              new Ll(),
              new Cl(),
              new Dl(),
              new Ml(!0),
              new id(),
              new Oc(),
              new en(1),
              new en(2),
              new en(3),
              new en(4),
              new en(5),
              new en(6),
              new zc(),
              new Pc(),
              new Wc(),
              new Qc(),
              new jc(),
              new Zc(),
              new El(),
              new Ps(2, (t, e) => !e.voice.bar.staff.showStandardNotation),
            ],
            (t, e) => e.showTablature
          ),
          new ao(),
          new Di(V._staffIdBeforeEndAlways, [
            new Ps(1, (t, e) => !e.voice.bar.staff.showStandardNotation),
          ]),
        ];
      }
      static _createDefaultStaveProfiles() {
        let t = new Map(),
          e = V._createDefaultRenderers();
        t.set(0, e), t.set(1, e);
        let r = new Set([
          V._staffIdBeforeSlashAlways,
          V._staffIdBeforeScoreAlways,
          V._staffIdBeforeNumberedAlways,
          V._staffIdBeforeTabAlways,
          Rs.StaffId,
          V._staffIdBeforeEndAlways,
        ]);
        t.set(
          2,
          e.filter((n) => r.has(n.staffId))
        );
        let i = new Set([
          V._staffIdBeforeSlashAlways,
          V._staffIdBeforeScoreAlways,
          V._staffIdBeforeNumberedAlways,
          V._staffIdBeforeTabAlways,
          es.StaffId,
          V._staffIdBeforeEndAlways,
        ]);
        return (
          t.set(
            3,
            V._createDefaultRenderers().filter((n) => {
              if (n instanceof ao) {
                let s = n;
                (s.showTimeSignature = !0),
                  (s.showRests = !0),
                  (s.showTiedNotes = !0);
              }
              return i.has(n.staffId);
            })
          ),
          t.set(
            4,
            V._createDefaultRenderers().filter((n) => {
              if (n instanceof ao) {
                let s = n;
                (s.showTimeSignature = !1),
                  (s.showRests = !1),
                  (s.showTiedNotes = !1);
              }
              return i.has(n.staffId);
            })
          ),
          t
        );
      }
      static _createDefaultLayoutEngines() {
        let t = new Map();
        return (
          t.set(0, new ip(!0, (e) => new fd(e))),
          t.set(1, new ip(!1, (e) => new md(e))),
          t
        );
      }
      static initializeMain(t, e) {
        V.isRunningInWorker ||
          V.isRunningInAudioWorklet ||
          ((V.webPlatform === 0 || V.webPlatform === 2) &&
            (V._registerJQueryPlugin(),
            (V.highDpiFactor = window.devicePixelRatio)),
          (V.createWebWorker = t),
          (V.createAudioWorklet = e));
      }
      static get alphaTabWorker() {
        return V.globalThis.Worker;
      }
      static get alphaTabUrl() {
        return V.globalThis.URL;
      }
      static initializeWorker() {
        if (!V.isRunningInWorker)
          throw new te(
            0,
            "Not running in worker, cannot run worker initialization"
          );
        Ju.init(),
          Yu.init(),
          (V.createWebWorker = (t) => {
            throw new te(0, "Nested workers are not supported");
          });
      }
      static initializeAudioWorklet() {
        if (!V.isRunningInAudioWorklet)
          throw new te(
            0,
            "Not running in audio worklet, cannot run worklet initialization"
          );
        yu.init();
      }
      static _detectWebPack() {
        try {
          if (typeof __webpack_require__ == "function") return !0;
        } catch {}
        return !1;
      }
      static _detectVite() {
        try {
          if (typeof __BASE__ == "string") return !0;
        } catch {}
        return !1;
      }
      static _detectWebPlatform() {
        if (
          !(
            typeof V.globalThis.Window < "u" &&
            V.globalThis instanceof V.globalThis.Window
          )
        )
          try {
            if (
              Object.prototype.toString.call(
                typeof process < "u" ? process : 0
              ) === "[object process]"
            )
              return 1;
          } catch {}
        try {
          let e = Wh.url;
          if (e && typeof e == "string" && !e.startsWith("file://")) return 2;
        } catch {}
        return 0;
      }
      static printEnvironmentInfo(t = !0) {
        let e = t
          ? (r) => {
              w.log.debug("VersionInfo", r);
            }
          : (r) => {
              w.debug("VersionInfo", r);
            };
        Gi.print(e), e(`High DPI: ${V.highDpiFactor}`), V._printPlatformInfo(e);
      }
      static _printPlatformInfo(t) {
        t(`Platform: ${Yn[V.webPlatform]}`),
          t(`WebPack: ${V.isWebPackBundled}`),
          t(`Vite: ${V.isViteBundled}`),
          V.webPlatform !== 1 &&
            (t(`Browser: ${navigator.userAgent}`),
            t(`Window Size: ${window.outerWidth}x${window.outerHeight}`),
            t(`Screen Size: ${window.screen.width}x${window.screen.height}`));
      }
      static prepareForPostMessage(t) {
        if (!t) return t;
        if (typeof t == "object") {
          let e = t.__v_raw;
          if (e) return V.prepareForPostMessage(e);
        }
        return t;
      }
      static quoteJsonString(t) {
        return JSON.stringify(t);
      }
    };
  (V._staffIdBeforeSlashAlways = "before-slash-always"),
    (V._staffIdBeforeScoreAlways = "before-score-always"),
    (V._staffIdBeforeScoreHideable = "before-score-hideable"),
    (V._staffIdBeforeNumberedAlways = "before-numbered-always"),
    (V._staffIdBeforeTabAlways = "before-tab-always"),
    (V._staffIdBeforeTabHideable = "before-tab-hideable"),
    (V._staffIdBeforeEndAlways = "before-end-always"),
    (V.highDpiFactor = 1),
    (V._globalThis = void 0),
    (V.webPlatform = V._detectWebPlatform()),
    (V.isWebPackBundled = V._detectWebPack()),
    (V.isViteBundled = V._detectVite()),
    (V.scriptFile = V._detectScriptFile()),
    (V.fontDirectory = V._detectFontDirectory()),
    (V.renderEngines = V._createDefaultRenderEngines()),
    (V.layoutEngines = V._createDefaultLayoutEngines()),
    (V.staveProfiles = V._createDefaultStaveProfiles());
  var J = V;
  var ga = ((s) => (
      (s[(s.EmbeddedOpenType = 0)] = "EmbeddedOpenType"),
      (s[(s.Woff = 1)] = "Woff"),
      (s[(s.Woff2 = 2)] = "Woff2"),
      (s[(s.OpenType = 3)] = "OpenType"),
      (s[(s.TrueType = 4)] = "TrueType"),
      (s[(s.Svg = 5)] = "Svg"),
      s
    ))(ga || {}),
    zn = class {
      constructor() {
        this.scriptFile = null;
        this.fontDirectory = null;
        this.smuflFontSources = null;
        this.file = null;
        this.tex = !1;
        this.tracks = null;
        this.enableLazyLoading = !0;
        this.engine = "default";
        this.logLevel = 2;
        this.useWorkers = !0;
        this.includeNoteBounds = !1;
        (this.scriptFile = J.scriptFile),
          (this.fontDirectory = J.fontDirectory);
      }
      static buildDefaultSmuflFontSources(t) {
        let e = new Map(),
          r = t ?? "";
        return (
          e.set(2, `${r}Bravura.woff2`),
          e.set(1, `${r}Bravura.woff`),
          e.set(3, `${r}Bravura.otf`),
          e
        );
      }
    };
  var Th = {};
  Bi(Th, {
    AlphaTexErrorWithDiagnostics: () => Zs,
    AlphaTexImporter: () => Ei,
    ScoreImporter: () => Kt,
    ScoreLoader: () => Zi,
    UnsupportedFormatError: () => ke,
    alphaTex: () => Bh,
  });
  var Bh = {};
  Bi(Bh, {
    AlphaTexAccidentalMode: () => $s,
    AlphaTexDiagnosticBag: () => Ni,
    AlphaTexDiagnosticCode: () => pn,
    AlphaTexDiagnosticsSeverity: () => Hi,
    AlphaTexLexer: () => Qs,
    AlphaTexNodeType: () => St,
    AlphaTexParser: () => cs,
    AlphaTexStaffNoteKind: () => ls,
  });
  var kh = {};
  Bi(kh, { ByteBuffer: () => Se, IOHelper: () => B });
  var wh = {};
  Bi(wh, {
    AlphaTexExporter: () => np,
    Gp7Exporter: () => dp,
    ScoreExporter: () => ts,
  });
  var ts = class {
    init(t, e) {
      (this.data = t), (this.settings = e);
    }
    export(t, e = null) {
      let r = Se.withCapacity(1024);
      return this.init(r, e ?? new kt()), this.writeScore(t), r.toArray();
    }
  };
  var vh = class {
      constructor() {
        this.tex = "";
        this.isStartOfLine = !0;
        this.indentString = "";
        this.currentIndent = 0;
      }
      indent() {
        this.indentString.length > 0 && this.currentIndent++;
      }
      outdent() {
        this.indentString.length > 0 && this.currentIndent--;
      }
      _preWrite() {
        if (this.isStartOfLine && this.indentString.length > 0)
          for (let t = 0; t < this.currentIndent; t++)
            this.tex += this.indentString;
        this.isStartOfLine = !1;
      }
      write(t) {
        this._preWrite(), (this.tex += t), (this.isStartOfLine = !1);
      }
      writeString(t) {
        this._preWrite(), (this.tex += J.quoteJsonString(t));
      }
      writeLine(t) {
        this._preWrite(),
          t !== void 0 && (this.tex += t),
          this.indentString.length > 0
            ? (this.tex += `
`)
            : this.tex.endsWith(" ") || (this.tex += " "),
          (this.isStartOfLine = !0);
      }
    },
    _h = class {
      constructor(t) {
        this._comments = !1;
        this._trackIndex = 0;
        this._staffIndex = 0;
        this._voiceIndex = 0;
        let e = new vh();
        (this._comments = t.exporter.comments),
          (e.indentString =
            t.exporter.indent > 0 ? " ".repeat(t.exporter.indent) : ""),
          (this._writer = e);
      }
      get tex() {
        return this._writer.tex;
      }
      writeScoreNode(t) {
        this._writeComments(t.leadingComments);
        for (let e of t.bars) this._writeBar(e);
        this._writeComments(t.trailingComments);
      }
      _writeBar(t) {
        this._writeComments(t.leadingComments),
          this._writeMetaDataList(t.metaData),
          this._writer.indent();
        for (let e of t.beats) this._writeBeat(e);
        this._writer.outdent(),
          this._writeComments(t.trailingComments),
          this._writeToken(t.pipe, !0);
      }
      _writeBeat(t) {
        this._writeComments(t.leadingComments),
          t.durationChange && this._writeDurationChange(t.durationChange),
          t.rest
            ? this._writeValue(t.rest)
            : t.notes && this._writeNotes(t.notes),
          this._writeToken(t.durationDot, !1),
          this._writeValue(t.durationValue),
          this._writeToken(t.beatMultiplier, !1),
          this._writeValue(t.beatMultiplierValue),
          t.beatEffects && this._writeProperties(t.beatEffects, !1),
          this._writeComments(t.trailingComments),
          this._writer.writeLine();
      }
      _writeNotes(t) {
        this._writeComments(t.leadingComments),
          this._writeToken(t.openParenthesis, !1);
        let e = !0;
        for (let r of t.notes)
          e || this._writer.write(" "), this._writeNote(r), (e = !1);
        this._writeToken(t.closeParenthesis, !1),
          this._writeComments(t.trailingComments);
      }
      _writeNote(t) {
        this._writeComments(t.leadingComments),
          this._writeValue(t.noteValue),
          this._writeToken(t.noteStringDot, !1),
          this._writeValue(t.noteString),
          t.noteEffects && this._writeProperties(t.noteEffects, !1),
          this._writeComments(t.trailingComments);
      }
      _writeDurationChange(t) {
        this._writeComments(t.leadingComments),
          this._writeToken(t.colon, !1),
          this._writeValue(t.value),
          t.properties &&
            (this._writer.write(" "), this._writeProperties(t.properties, !1)),
          this._writeComments(t.trailingComments),
          this._writer.write(" ");
      }
      _writeMetaDataList(t) {
        for (let e of t) this._writeMetaData(e);
      }
      _writeMetaData(t) {
        switch (t.tag.tag.text) {
          case "track":
            this._trackIndex > 0 && this._writer.outdent();
            break;
          case "staff":
            this._staffIndex > 0 && this._writer.outdent();
            break;
          case "voice":
            this._voiceIndex > 0 && this._writer.outdent();
            break;
        }
        this._writeComments(t.leadingComments),
          this._writeToken(t.tag.prefix, !1),
          this._writeValue(t.tag.tag);
        let e = !0;
        switch (
          (t.propertiesBeforeValues
            ? (t.properties &&
                (this._writer.write(" "),
                this._writeProperties(t.properties, !1)),
              t.values &&
                (this._writer.write(" "), this._writeValues(t.values)))
            : (t.values &&
                (this._writer.write(" "), this._writeValues(t.values)),
              t.properties &&
                (this._writer.write(" "),
                this._writeProperties(t.properties, !0),
                (e = !1))),
          t.trailingComments &&
            (this._writer.write(" "), this._writeComments(t.trailingComments)),
          t.tag.tag.text)
        ) {
          case "track":
            this._trackIndex++,
              (this._staffIndex = 0),
              (this._voiceIndex = 0),
              this._writer.indent();
            break;
          case "staff":
            this._staffIndex++, (this._voiceIndex = 0), this._writer.indent();
            break;
          case "voice":
            this._voiceIndex++, this._writer.indent();
            break;
        }
        e && this._writer.writeLine();
      }
      _writeProperties(t, e) {
        this._writeComments(t.leadingComments),
          this._writeToken(t.openBrace, e),
          e && this._writer.indent();
        let r = !0;
        for (let i of t.properties)
          !r && !e && this._writer.write(" "),
            this._writeProperty(i),
            (r = !1),
            e && this._writer.writeLine();
        e && this._writer.outdent(),
          this._writeToken(t.closeBrace, e),
          this._writeComments(t.trailingComments);
      }
      _writeProperty(t) {
        this._writeComments(t.leadingComments),
          this._writeValue(t.property),
          t.values && (this._writer.write(" "), this._writeValues(t.values)),
          this._writeComments(t.trailingComments);
      }
      _writeValues(t) {
        this._writeComments(t.leadingComments),
          this._writeToken(t.openParenthesis, !1);
        let e = !0;
        for (let r of t.values)
          e || this._writer.write(" "), this._writeValue(r), (e = !1);
        this._writeToken(t.closeParenthesis, !1),
          this._writeComments(t.trailingComments);
      }
      _writeValue(t) {
        if (t) {
          switch ((this._writeComments(t.leadingComments), t.nodeType)) {
            case 10:
              this._writer.write(t.text);
              break;
            case 13:
              this._writeValues(t);
              break;
            case 16:
              this._writer.write(t.value.toString());
              break;
            case 17:
              this._writer.writeString(t.text);
              break;
          }
          this._writeComments(t.trailingComments);
        }
      }
      _writeToken(t, e) {
        if (t) {
          switch ((this._writeComments(t.leadingComments), t.nodeType)) {
            case 0:
              this._writer.write(".");
              break;
            case 1:
              this._writer.write("\\");
              break;
            case 2:
              this._writer.write("\\\\");
              break;
            case 3:
              this._writer.write("|");
              break;
            case 4:
              this._writer.write("{");
              break;
            case 5:
              this._writer.write("}");
              break;
            case 6:
              this._writer.write("(");
              break;
            case 7:
              this._writer.write(")");
              break;
            case 8:
              this._writer.write(":");
              break;
            case 9:
              this._writer.write("*");
              break;
          }
          this._writeComments(t.trailingComments),
            e && this._writer.writeLine();
        }
      }
      _writeComments(t) {
        if (!(!this._comments || !t))
          for (let e of t) {
            let r = e.text;
            r.startsWith(" ") || (r = ` ${r}`),
              e.multiLine
                ? (r.endsWith(" ") || (r += " "),
                  this._writer.write(`/*${r}*/`))
                : this._writer.writeLine(`//${r}`);
          }
      }
    },
    np = class extends ts {
      constructor() {
        super(...arguments);
        this._handler = us.instance;
      }
      get name() {
        return "alphaTex";
      }
      exportToString(e, r = null) {
        return (this.settings = r ?? new kt()), this.scoreToAlphaTexString(e);
      }
      writeScore(e) {
        let r = B.stringToBytes(this.scoreToAlphaTexString(e));
        this.data.write(r, 0, r.length);
      }
      scoreToAlphaTexString(e) {
        let r = new _h(this.settings);
        return r.writeScoreNode(this._score(e)), r.tex;
      }
      _score(e) {
        let r = { nodeType: 18, bars: [] };
        for (let i of e.tracks) this._track(r, i);
        return (
          r.bars.length === 0
            ? r.bars.push({
                nodeType: 19,
                metaData: this._handler.buildScoreMetaDataNodes(e),
                beats: [],
              })
            : (r.bars[0].metaData = this._handler
                .buildScoreMetaDataNodes(e)
                .concat(r.bars[0].metaData)),
          r.bars.push({
            nodeType: 19,
            metaData: this._handler.buildSyncPointNodes(e),
            beats: [],
          }),
          r
        );
      }
      _track(e, r) {
        for (let i of r.staves) this._staff(e, i);
      }
      _staff(e, r) {
        let i = Math.max(...r.filledVoices) + 1;
        if (r.bars.length === 0) {
          let n = {
            nodeType: 19,
            metaData: this._handler.buildBarMetaDataNodes(r, void 0, 0, !1),
            beats: [],
            pipe: void 0,
          };
          e.bars.push(n);
        } else for (let n = 0; n < i; n++) this._voice(e, n, r, i > 1);
      }
      _voice(e, r, i, n) {
        for (let s of i.bars) this._bar(e, s, r, n);
      }
      _bar(e, r, i, n) {
        var a;
        let s = {
          nodeType: 19,
          metaData: this._handler.buildBarMetaDataNodes(r.staff, r, i, n),
          beats: [],
          pipe: void 0,
        };
        if (r.isEmpty)
          s.trailingComments = [
            {
              multiLine: !1,
              text: `Bar ${r.index + 1} / Voice ${i + 1} no contents`,
            },
          ];
        else {
          let o = r.voices[i];
          if (o.isEmpty)
            s.trailingComments = [
              {
                multiLine: !1,
                text: `Bar ${r.index + 1} / Voice ${i + 1} no contents`,
              },
            ];
          else {
            for (let l of o.beats) s.beats.push(this._beat(l));
            s.beats.length > 0 &&
              ((a = s.beats[0]).leadingComments ?? (a.leadingComments = []),
              s.beats[0].leadingComments.unshift({
                multiLine: !1,
                text: `Bar ${r.index + 1} / Voice ${i + 1} contents`,
              }));
          }
        }
        r.index < r.staff.bars.length - 1 && (s.pipe = { nodeType: 3 }),
          e.bars.push(s);
      }
      _beat(e) {
        let r = {
          nodeType: 20,
          durationChange: void 0,
          notes: void 0,
          rest: void 0,
          beatEffects: void 0,
        };
        return (
          e.isRest
            ? (r.rest = { nodeType: 10, text: "r" })
            : (r.notes = this._notes(e.notes)),
          (r.durationDot = { nodeType: 0 }),
          (r.durationValue = { nodeType: 16, value: e.duration }),
          (r.beatEffects = this._beatEffects(e)),
          r
        );
      }
      _beatEffects(e) {
        let r = this._handler.buildBeatEffects(e);
        return r.length > 0
          ? {
              nodeType: 14,
              openBrace: { nodeType: 4 },
              properties: r,
              closeBrace: { nodeType: 5 },
            }
          : void 0;
      }
      _notes(e) {
        let r = {
          nodeType: 22,
          openParenthesis: void 0,
          notes: [],
          closeParenthesis: void 0,
        };
        (e.length === 0 || e.length > 1) &&
          ((r.openParenthesis = { nodeType: 6 }),
          (r.closeParenthesis = { nodeType: 7 }));
        for (let i of e) r.notes.push(this._note(i));
        return r;
      }
      _note(e) {
        let r = { nodeType: 23, noteValue: { nodeType: 10, text: "" } };
        if (e.isPercussion)
          r.noteValue = { nodeType: 17, text: He.getArticulationName(e) };
        else if (e.isPiano)
          r.noteValue = {
            nodeType: 10,
            text: lt.getTextForTuning(e.realValueWithoutHarmonic, !0),
          };
        else if (e.isStringed) {
          (r.noteValue = { nodeType: 16, value: e.fret }),
            (r.noteStringDot = { nodeType: 0 });
          let i = e.beat.voice.bar.staff.tuning.length - e.string + 1;
          r.noteString = { nodeType: 16, value: i };
        } else throw new Error("What kind of note");
        return (r.noteEffects = this._noteEffects(e)), r;
      }
      _noteEffects(e) {
        let r = this._handler.buildNoteEffects(e);
        return r.length > 0
          ? {
              nodeType: 14,
              openBrace: { nodeType: 4 },
              properties: r,
              closeBrace: { nodeType: 5 },
            }
          : void 0;
      }
    };
  var L = class {
      constructor(t, e, r = null) {
        this.icon = 10;
        if (((this.icon = t), (this.instrumentSetName = e), r))
          this.instrumentSetType = r;
        else {
          let i = e.split(" ");
          (i[0] = i[0].substr(0, 1).toLowerCase() + i[0].substr(1)),
            (this.instrumentSetType = i.join(""));
        }
      }
    },
    xt = class xt {
      constructor() {
        this._rhythmIdLookup = new Map();
      }
      writeXml(t) {
        let e = new pi();
        return (
          (this._rhythmIdLookup = new Map()),
          this._writeDom(e, t),
          e.toFormattedString("", !0)
        );
      }
      _writeDom(t, e) {
        let r = t.addElement("GPIF");
        r.addElement("GPVersion").innerText = "8.1.3";
        let i = r.addElement("GPRevision");
        i.attributes.set("required", "12024"),
          i.attributes.set("recommended", "13000"),
          (i.innerText = "13007");
        let n = r.addElement("Encoding");
        n.addElement("EncodingDescription").innerText = "GP8";
        let s = new wr();
        (s.nodeType = 6),
          (s.value = `Written by alphaTab ${Gi.version} (${Gi.commit})`),
          n.addChild(s),
          this._writeScoreNode(r, e),
          this._writeMasterTrackNode(r, e),
          this._writeBackingTrackNode(r, e),
          this._writeAudioTracksNode(r, e),
          this._writeTracksNode(r, e),
          this._writeMasterBarsNode(r, e),
          this._writeAssets(r, e);
        let a = r.addElement("Bars"),
          o = r.addElement("Voices"),
          l = r.addElement("Beats"),
          u = r.addElement("Notes"),
          c = r.addElement("Rhythms");
        for (let d of e.tracks)
          for (let h of d.staves)
            for (let f of h.bars) {
              this._writeBarNode(a, f);
              for (let b of f.voices) {
                this._writeVoiceNode(o, b);
                for (let y of b.beats) {
                  this._writeBeatNode(l, y, c);
                  for (let S of y.notes) this._writeNoteNode(u, S);
                }
              }
            }
      }
      _writeAssets(t, e) {
        if (!e.backingTrack?.rawAudioFile) return;
        let i = t.addElement("Assets").addElement("Asset");
        i.attributes.set("id", this._backingTrackAssetId),
          (this.backingTrackAssetFileName = "Content/Assets/backing-track"),
          i
            .addElement("EmbeddedFilePath")
            .setCData(this.backingTrackAssetFileName);
      }
      _writeBackingTrackNode(t, e) {
        if (!e.backingTrack?.rawAudioFile) return;
        let r = t.addElement("BackingTrack"),
          i = "0";
        (this._backingTrackAssetId = i),
          (r.addElement("IconId").innerText = "21"),
          (r.addElement("Color").innerText = "0 0 0"),
          r.addElement("Name").setCData("Audio Track"),
          r.addElement("ShortName").setCData("a.track"),
          (r.addElement("PlaybackState").innerText = "Default"),
          (r.addElement("Enabled").innerText = "true"),
          (r.addElement("Source").innerText = "Local"),
          (r.addElement("AssetId").innerText = i);
        let n = r.addElement("ChannelStrip");
        (n.addElement("Parameters").innerText =
          "0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.000000 0.500000 0.500000 0.800000 0.500000 0.500000 0.500000"),
          (n.addElement("YouTubeVideoUrl").innerText = ""),
          (n.addElement("Filter").innerText = "6"),
          (n.addElement("FramesPerPixel").innerText = "400");
        let s =
          this._backingTrackFramePadding !== void 0
            ? this._backingTrackFramePadding
            : 0;
        (r.addElement("FramePadding").innerText = `${s}`),
          (r.addElement("Semitones").innerText = "0"),
          (r.addElement("Cents").innerText = "0");
      }
      _writeNoteNode(t, e) {
        let r = t.addElement("Note");
        r.attributes.set("id", e.id.toString()),
          this._writeNoteProperties(r, e),
          e.isGhost && (r.addElement("AntiAccent").innerText = "normal"),
          e.isLetRing && r.addElement("LetRing"),
          e.isTrill &&
            (r.addElement("Trill").innerText = e.trillValue.toString());
        let i = 0;
        switch ((e.isStaccato && (i |= 1), e.accentuated)) {
          case 1:
            i |= 8;
            break;
          case 2:
            i |= 4;
            break;
          case 3:
            i |= 16;
            break;
        }
        if (
          (i > 0 && (r.addElement("Accent").innerText = i.toString()),
          e.isTieOrigin || e.isTieDestination)
        ) {
          let n = r.addElement("Tie");
          n.attributes.set("origin", e.isTieOrigin ? "true" : "false"),
            n.attributes.set(
              "destination",
              e.isTieDestination ? "true" : "false"
            );
        }
        switch (e.vibrato) {
          case 1:
            r.addElement("Vibrato").innerText = "Slight";
            break;
          case 2:
            r.addElement("Vibrato").innerText = "Wide";
            break;
        }
        if (e.isFingering) {
          switch (e.leftHandFinger) {
            case 0:
              r.addElement("LeftFingering").innerText = "P";
              break;
            case 1:
              r.addElement("LeftFingering").innerText = "I";
              break;
            case 2:
              r.addElement("LeftFingering").innerText = "M";
              break;
            case 3:
              r.addElement("LeftFingering").innerText = "A";
              break;
            case 4:
              r.addElement("LeftFingering").innerText = "C";
              break;
          }
          switch (e.rightHandFinger) {
            case 0:
              r.addElement("RightFingering").innerText = "P";
              break;
            case 1:
              r.addElement("RightFingering").innerText = "I";
              break;
            case 2:
              r.addElement("RightFingering").innerText = "M";
              break;
            case 3:
              r.addElement("RightFingering").innerText = "A";
              break;
            case 4:
              r.addElement("RightFingering").innerText = "C";
              break;
          }
        }
        e.percussionArticulation >= 0
          ? (r.addElement("InstrumentArticulation").innerText =
              e.percussionArticulation.toString())
          : (r.addElement("InstrumentArticulation").innerText = "0"),
          e.ornament !== 0 &&
            (r.addElement("Ornament").innerText = Br[e.ornament]);
      }
      _writeNoteProperties(t, e) {
        let r = t.addElement("Properties");
        if (
          (this._writeConcertPitch(r, e),
          this._writeTransposedPitch(r, e),
          e.isStringed &&
            (this._writeSimplePropertyNode(
              r,
              "String",
              "String",
              (e.string - 1).toString()
            ),
            this._writeSimplePropertyNode(r, "Fret", "Fret", e.fret.toString()),
            this._writeSimplePropertyNode(
              r,
              "Midi",
              "Number",
              e.realValue.toString()
            ),
            e.showStringNumber &&
              this._writeSimplePropertyNode(
                r,
                "ShowStringNumber",
                "Enable",
                null
              )),
          e.isPiano &&
            (this._writeSimplePropertyNode(
              r,
              "Octave",
              "Number",
              e.octave.toString()
            ),
            this._writeSimplePropertyNode(r, "Tone", "Step", e.tone.toString()),
            this._writeSimplePropertyNode(
              r,
              "Midi",
              "Number",
              e.realValue.toString()
            )),
          e.beat.tap &&
            this._writeSimplePropertyNode(r, "Tapped", "Enable", null),
          e.harmonicType !== 0)
        ) {
          switch (e.harmonicType) {
            case 1:
              this._writeSimplePropertyNode(
                r,
                "HarmonicType",
                "HType",
                "Natural"
              );
              break;
            case 2:
              this._writeSimplePropertyNode(
                r,
                "HarmonicType",
                "HType",
                "Artificial"
              );
              break;
            case 3:
              this._writeSimplePropertyNode(
                r,
                "HarmonicType",
                "HType",
                "Pinch"
              );
              break;
            case 4:
              this._writeSimplePropertyNode(r, "HarmonicType", "HType", "Tap");
              break;
            case 5:
              this._writeSimplePropertyNode(r, "HarmonicType", "HType", "Semi");
              break;
            case 6:
              this._writeSimplePropertyNode(
                r,
                "HarmonicType",
                "HType",
                "Feedback"
              );
              break;
          }
          e.harmonicValue !== 0 &&
            this._writeSimplePropertyNode(
              r,
              "HarmonicFret",
              "HFret",
              e.harmonicValue.toString()
            );
        }
        e.isDead && this._writeSimplePropertyNode(r, "Muted", "Enable", null),
          e.isPalmMute &&
            this._writeSimplePropertyNode(r, "PalmMuted", "Enable", null),
          e.hasBend && this._writeBend(r, e),
          e.isHammerPullOrigin &&
            this._writeSimplePropertyNode(r, "HopoOrigin", "Enable", null),
          e.isHammerPullDestination &&
            this._writeSimplePropertyNode(r, "HopoDestination", "Enable", null),
          e.isLeftHandTapped &&
            this._writeSimplePropertyNode(r, "LeftHandTapped", "Enable", null);
        let i = 0;
        switch (e.slideInType) {
          case 2:
            i |= 32;
            break;
          case 1:
            i |= 16;
            break;
        }
        switch (e.slideOutType) {
          case 1:
            i |= 1;
            break;
          case 2:
            i |= 2;
            break;
          case 4:
            i |= 4;
            break;
          case 3:
            i |= 8;
            break;
          case 5:
            i |= 64;
            break;
          case 6:
            i |= 128;
            break;
        }
        i > 0 &&
          this._writeSimplePropertyNode(r, "Slide", "Flags", i.toString());
      }
      _writeTransposedPitch(t, e) {
        e.isPercussion
          ? this._writePitch(t, "ConcertPitch", "C", "-1", "")
          : this._writePitchForValue(
              t,
              "TransposedPitch",
              e.displayValueWithoutBend,
              e.accidentalMode,
              e.beat.voice.bar.keySignature
            );
      }
      _writeConcertPitch(t, e) {
        e.isPercussion
          ? this._writePitch(t, "ConcertPitch", "C", "-1", "")
          : this._writePitchForValue(
              t,
              "ConcertPitch",
              e.realValueWithoutHarmonic,
              e.accidentalMode,
              e.beat.voice.bar.keySignature
            );
      }
      _writePitchForValue(t, e, r, i, n) {
        let s = 0,
          a = 0,
          o = "",
          l = "",
          u = () => {
            switch (
              ((s = r % 12),
              (a = (r / 12) | 0),
              (o = xt._defaultSteps[s]),
              A.computeAccidental(n, 0, r, !1))
            ) {
              case 0:
              case 1:
                l = "";
                break;
              case 2:
                l = "#";
                break;
              case 3:
                l = "b";
                break;
              case 7:
                l = "x";
                break;
              case 8:
                l = "bb";
                break;
            }
          };
        switch ((u(), i)) {
          case 0:
            break;
          case 1:
            l = "";
            break;
          case 2:
            l = "";
            break;
          case 3:
            l = "#";
            break;
          case 4:
            l === "#" && ((r -= 2), u()), (l = "x");
            break;
          case 5:
            l === "#" && ((r += 1), u()), (l = "b");
            break;
          case 6:
            l === "#" && ((r += 2), u()), (l = "bb");
            break;
        }
        this._writePitch(t, e, o, a.toString(), l);
      }
      _writePitch(t, e, r, i, n) {
        let s = t.addElement("Property");
        s.attributes.set("name", e);
        let a = s.addElement("Pitch");
        (a.addElement("Step").innerText = r),
          (a.addElement("Accidental").innerText = n),
          (a.addElement("Octave").innerText = i);
      }
      _writeBend(t, e) {
        e.hasBend &&
          e.bendPoints.length <= 4 &&
          this._writeStandardBend(t, e.bendPoints);
      }
      _writeStandardBend(t, e) {
        this._writeSimplePropertyNode(t, "Bended", "Enable", null);
        let r = e[0],
          i = e[e.length - 1],
          n,
          s;
        switch (e.length) {
          case 4:
            (n = e[1]), (s = e[2]);
            break;
          case 3:
            (n = e[1]), (s = e[1]);
            break;
          default:
            (n = new I((r.offset + i.offset) / 2, (r.value + i.value) / 2)),
              (s = n);
            break;
        }
        this._writeSimplePropertyNode(
          t,
          "BendDestinationOffset",
          "Float",
          this._toBendOffset(i.offset).toString()
        ),
          this._writeSimplePropertyNode(
            t,
            "BendDestinationValue",
            "Float",
            this._toBendValue(i.value).toString()
          ),
          this._writeSimplePropertyNode(
            t,
            "BendMiddleOffset1",
            "Float",
            this._toBendOffset(n.offset).toString()
          ),
          this._writeSimplePropertyNode(
            t,
            "BendMiddleOffset2",
            "Float",
            this._toBendOffset(s.offset).toString()
          ),
          this._writeSimplePropertyNode(
            t,
            "BendMiddleValue",
            "Float",
            this._toBendValue(n.value).toString()
          ),
          this._writeSimplePropertyNode(
            t,
            "BendOriginOffset",
            "Float",
            this._toBendOffset(r.offset).toString()
          ),
          this._writeSimplePropertyNode(
            t,
            "BendOriginValue",
            "Float",
            this._toBendValue(r.value).toString()
          );
      }
      _toBendValue(t) {
        return t * 25;
      }
      _toBendOffset(t) {
        return (t / I.MaxPosition) * 100;
      }
      _writeBeatNode(t, e, r) {
        let i = t.addElement("Beat");
        if (
          (i.attributes.set("id", e.id.toString()),
          (i.addElement("Dynamic").innerText = st[e.dynamics]),
          e.fade !== 0 && (i.addElement("Fadding").innerText = Tr[e.fade]),
          e.isTremolo)
        )
          switch (e.tremoloSpeed) {
            case 8:
              i.addElement("Tremolo").innerText = "1/2";
              break;
            case 16:
              i.addElement("Tremolo").innerText = "1/4";
              break;
            case 32:
              i.addElement("Tremolo").innerText = "1/8";
              break;
          }
        switch (
          (e.hasChord && i.addElement("Chord").setCData(e.chordId),
          e.crescendo !== 0 &&
            (i.addElement("Hairpin").innerText = br[e.crescendo]),
          e.brushType)
        ) {
          case 3:
            i.addElement("Arpeggio").innerText = "Up";
            break;
          case 4:
            i.addElement("Arpeggio").innerText = "Down";
            break;
        }
        switch (
          (e.text && i.addElement("FreeText").setCData(e.text), e.graceType)
        ) {
          case 1:
          case 2:
            i.addElement("GraceNotes").innerText = Ce[e.graceType];
            break;
        }
        if (
          (e.ottava !== 2 &&
            (i.addElement("Ottavia").innerText = Ze[e.ottava].substr(1)),
          e.hasWhammyBar && this._writeWhammyNode(i, e),
          e.isLegatoOrigin || e.isLegatoDestination)
        ) {
          let n = i.addElement("Legato");
          n.attributes.set("origin", e.isLegatoOrigin ? "true" : "false"),
            n.attributes.set(
              "destination",
              e.isLegatoDestination ? "true" : "false"
            );
        }
        if ((this._writeRhythm(i, e, r), e.preferredBeamDirection !== null))
          switch (e.preferredBeamDirection) {
            case 0:
              (i.addElement("TransposedPitchStemOrientation").innerText =
                "Upward"),
                (i.addElement("UserTransposedPitchStemOrientation").innerText =
                  "Upward");
              break;
            case 1:
              (i.addElement("TransposedPitchStemOrientation").innerText =
                "Downward"),
                (i.addElement("UserTransposedPitchStemOrientation").innerText =
                  "Downward");
              break;
          }
        (i.addElement("ConcertPitchStemOrientation").innerText = "Undefined"),
          e.slashed && i.addElement("Slashed"),
          e.deadSlapped && i.addElement("DeadSlapped"),
          e.notes.length > 0 &&
            (i.addElement("Notes").innerText = e.notes
              .map((n) => n.id)
              .join(" ")),
          e.golpe !== 0 && (i.addElement("Golpe").innerText = Jr[e.golpe]),
          e.wahPedal !== 0 && (i.addElement("Wah").innerText = Lr[e.wahPedal]),
          e.showTimer &&
            (i.addElement("Timer").innerText = (e.timer ?? 0).toString()),
          this._writeBeatProperties(i, e),
          this._writeBeatXProperties(i, e),
          e.lyrics && e.lyrics.length > 0 && this._writeBeatLyrics(i, e.lyrics);
      }
      _writeBeatLyrics(t, e) {
        let r = t.addElement("Lyrics");
        for (let i of e) r.addElement("Line").setCData(i);
      }
      _writeBeatXProperties(t, e) {
        let r = t.addElement("XProperties");
        switch (
          (e.brushDuration > 0 &&
            this._writeSimpleXPropertyNode(
              r,
              "687935489",
              "Int",
              e.brushDuration.toString()
            ),
          e.beamingMode)
        ) {
          case 1:
            this._writeSimpleXPropertyNode(r, "1124204546", "Int", "2");
            break;
          case 2:
            this._writeSimpleXPropertyNode(r, "1124204546", "Int", "1");
            break;
          case 3:
            this._writeSimpleXPropertyNode(r, "1124204552", "Int", "1");
            break;
        }
      }
      _writeBeatProperties(t, e) {
        let r = t.addElement("Properties");
        switch (e.brushType) {
          case 1:
            this._writeSimplePropertyNode(r, "Brush", "Direction", "Up");
            break;
          case 2:
            this._writeSimplePropertyNode(r, "Brush", "Direction", "Down");
            break;
        }
        switch (e.pickStroke) {
          case 1:
            this._writeSimplePropertyNode(r, "PickStroke", "Direction", "Up");
            break;
          case 2:
            this._writeSimplePropertyNode(r, "PickStroke", "Direction", "Down");
            break;
        }
        switch (
          (e.slap &&
            this._writeSimplePropertyNode(r, "Slapped", "Enable", null),
          e.pop && this._writeSimplePropertyNode(r, "Popped", "Enable", null),
          e.vibrato)
        ) {
          case 2:
            this._writeSimplePropertyNode(
              r,
              "VibratoWTremBar",
              "Strength",
              "Wide"
            );
            break;
          case 1:
            this._writeSimplePropertyNode(
              r,
              "VibratoWTremBar",
              "Strength",
              "Slight"
            );
            break;
        }
        if (e.isBarre)
          switch (
            (this._writeSimplePropertyNode(
              r,
              "BarreFret",
              "Fret",
              e.barreFret.toString()
            ),
            e.barreShape)
          ) {
            case 1:
              this._writeSimplePropertyNode(r, "BarreString", "String", "0");
              break;
            case 2:
              this._writeSimplePropertyNode(r, "BarreString", "String", "1");
              break;
          }
        if (e.rasgueado !== 0) {
          let i = "";
          switch (e.rasgueado) {
            case 1:
              i = "ii_1";
              break;
            case 2:
              i = "mi_1";
              break;
            case 3:
              i = "mii_1";
              break;
            case 4:
              i = "mii_2";
              break;
            case 5:
              i = "pmp_1";
              break;
            case 6:
              i = "pmp_2";
              break;
            case 7:
              i = "pei_1";
              break;
            case 8:
              i = "pei_2";
              break;
            case 9:
              i = "pai_1";
              break;
            case 10:
              i = "pai_2";
              break;
            case 11:
              i = "ami_1";
              break;
            case 12:
              i = "ami_2";
              break;
            case 13:
              i = "ppp_1";
              break;
            case 14:
              i = "amii_1";
              break;
            case 15:
              i = "amip_1";
              break;
            case 16:
              i = "eami_1";
              break;
            case 17:
              i = "eamii_1";
              break;
            case 18:
              i = "peami_1";
              break;
          }
          this._writeSimplePropertyNode(r, "Rasgueado", "Rasgueado", i);
        }
      }
      _writeRhythm(t, e, r) {
        let i = `${e.duration}_${e.dots}_${e.tupletNumerator}_${e.tupletDenominator}';`,
          n;
        if (this._rhythmIdLookup.has(i)) n = this._rhythmIdLookup.get(i);
        else {
          (n = this._rhythmIdLookup.size.toString()),
            this._rhythmIdLookup.set(i, n);
          let s = r.addElement("Rhythm");
          if ((s.attributes.set("id", n), e.hasTuplet)) {
            let o = s.addElement("PrimaryTuplet");
            o.attributes.set("num", e.tupletNumerator.toString()),
              o.attributes.set("den", e.tupletDenominator.toString());
          }
          e.dots > 0 &&
            s
              .addElement("AugmentationDot")
              .attributes.set("count", e.dots.toString());
          let a = "Quarter";
          switch (e.duration) {
            case -4:
              a = "Long";
              break;
            case -2:
              a = "DoubleWhole";
              break;
            case 1:
              a = "Whole";
              break;
            case 2:
              a = "Half";
              break;
            case 4:
              a = "Quarter";
              break;
            case 8:
              a = "Eighth";
              break;
            case 16:
              a = "16th";
              break;
            case 32:
              a = "32nd";
              break;
            case 64:
              a = "64th";
              break;
            case 128:
              a = "128th";
              break;
            case 256:
              a = "256th";
              break;
          }
          s.addElement("NoteValue").innerText = a;
        }
        t.addElement("Rhythm").attributes.set("ref", n);
      }
      _writeWhammyNode(t, e) {
        e.hasWhammyBar &&
          e.whammyBarPoints.length <= 4 &&
          this._writeStandardWhammy(t, e.whammyBarPoints);
      }
      _writeStandardWhammy(t, e) {
        let r = t.addElement("Whammy"),
          i = e[0],
          n = e[e.length - 1],
          s,
          a;
        switch (e.length) {
          case 4:
            (s = e[1]), (a = e[2]);
            break;
          case 3:
            (s = e[1]), (a = e[1]);
            break;
          default:
            (s = new I((i.offset + n.offset) / 2, (i.value + n.value) / 2)),
              (a = s);
            break;
        }
        r.attributes.set(
          "destinationOffset",
          this._toBendOffset(n.offset).toString()
        ),
          r.attributes.set(
            "destinationValue",
            this._toBendValue(n.value).toString()
          ),
          r.attributes.set(
            "middleOffset1",
            this._toBendOffset(s.offset).toString()
          ),
          r.attributes.set(
            "middleOffset2",
            this._toBendOffset(a.offset).toString()
          ),
          r.attributes.set(
            "middleValue",
            this._toBendValue(s.value).toString()
          ),
          r.attributes.set(
            "originOffset",
            this._toBendOffset(i.offset).toString()
          ),
          r.attributes.set(
            "originValue",
            this._toBendValue(i.value).toString()
          );
      }
      _writeScoreNode(t, e) {
        let r = t.addElement("Score");
        r.addElement("Title").setCData(e.title),
          r.addElement("SubTitle").setCData(e.subTitle),
          r.addElement("Artist").setCData(e.artist),
          r.addElement("Album").setCData(e.album),
          r.addElement("Words").setCData(e.words),
          r.addElement("Music").setCData(e.music),
          r
            .addElement("WordsAndMusic")
            .setCData(e.words === e.music ? e.words : ""),
          r.addElement("Copyright").setCData(e.copyright),
          r.addElement("Tabber").setCData(e.tab),
          r.addElement("Instructions").setCData(e.instructions),
          r.addElement("Notices").setCData(e.notices),
          r.addElement("FirstPageHeader").setCData(""),
          r.addElement("FirstPageFooter").setCData(""),
          r.addElement("PageHeader").setCData(""),
          r.addElement("PageFooter").setCData(""),
          r
            .addElement("ScoreSystemsDefaultLayout")
            .setCData(e.defaultSystemsLayout.toString()),
          r
            .addElement("ScoreSystemsLayout")
            .setCData(e.systemsLayout.join(" ")),
          (r.addElement("ScoreZoomPolicy").innerText = "Value"),
          (r.addElement("ScoreZoom").innerText = "1"),
          (r.addElement("MultiVoice").innerText = "1>");
      }
      _writeMasterTrackNode(t, e) {
        let r = t.addElement("MasterTrack");
        r.addElement("Tracks").innerText = e.tracks
          .map((o) => o.index)
          .join(" ");
        let i = r.addElement("Automations");
        if (
          (e.masterBars.length > 0 &&
            e.masterBars[0].isAnacrusis &&
            r.addElement("Anacrusis"),
          e.masterBars[0].tempoAutomations.length === 0)
        ) {
          let o = i.addElement("Automation");
          (o.addElement("Type").innerText = "Tempo"),
            (o.addElement("Linear").innerText = "false"),
            (o.addElement("Bar").innerText = "0"),
            (o.addElement("Position").innerText = "0"),
            (o.addElement("Visible").innerText = "true"),
            (o.addElement("Value").innerText = `${e.tempo} 2`),
            e.tempoLabel && (o.addElement("Text").innerText = e.tempoLabel);
        }
        let n = e.masterBars[0].syncPoints
            ? e.masterBars[0].syncPoints.find(
                (o) =>
                  o.ratioPosition === 0 && o.syncPointValue.barOccurence === 0
              )
            : void 0,
          s = n ? n.syncPointValue.millisecondOffset : 0;
        this._backingTrackFramePadding =
          (-1 * ((s / 1e3) * xt._sampleRate)) | 0;
        let a = new Cr(() => Er.buildModifiedTempoLookup(e));
        for (let o of e.masterBars) {
          for (let l of o.tempoAutomations) {
            let u = i.addElement("Automation");
            (u.addElement("Type").innerText = "Tempo"),
              (u.addElement("Linear").innerText = l.isLinear
                ? "true"
                : "false"),
              (u.addElement("Bar").innerText = o.index.toString()),
              (u.addElement("Position").innerText = l.ratioPosition.toString()),
              (u.addElement("Visible").innerText = l.isVisible
                ? "true"
                : "false"),
              (u.addElement("Value").innerText = `${l.value} 2`),
              l.text && (u.addElement("Text").innerText = l.text);
          }
          if (o.syncPoints)
            for (let l of o.syncPoints) {
              let u = i.addElement("Automation");
              (u.addElement("Type").innerText = "SyncPoint"),
                (u.addElement("Linear").innerText = "false"),
                (u.addElement("Bar").innerText = o.index.toString()),
                (u.addElement("Position").innerText =
                  l.ratioPosition.toString()),
                (u.addElement("Visible").innerText = l.isVisible
                  ? "true"
                  : "false");
              let c = u.addElement("Value");
              (c.addElement("BarIndex").innerText = o.index.toString()),
                (c.addElement("BarOccurrence").innerText =
                  l.syncPointValue.barOccurence.toString()),
                (c.addElement("ModifiedTempo").innerText = a.value
                  .get(l)
                  .syncBpm.toString()),
                (c.addElement("OriginalTempo").innerText = e.tempo.toString());
              let d =
                ((l.syncPointValue.millisecondOffset - s) / 1e3) *
                xt._sampleRate;
              (d = Math.floor(d + 0.5)),
                (c.addElement("FrameOffset").innerText = d.toString());
            }
        }
      }
      _writeAudioTracksNode(t, e) {
        t.addElement("AudioTracks");
      }
      _writeTracksNode(t, e) {
        let r = t.addElement("Tracks");
        for (let i of e.tracks) this._writeTrackNode(r, i);
      }
      _writeTrackNode(t, e) {
        let r = t.addElement("Track");
        r.attributes.set("id", e.index.toString()),
          r.addElement("Name").setCData(e.name),
          r.addElement("ShortName").setCData(e.shortName),
          (r.addElement(
            "Color"
          ).innerText = `${e.color.r} ${e.color.g} ${e.color.b}`),
          (r.addElement("SystemsDefautLayout").innerText =
            e.defaultSystemsLayout.toString()),
          (r.addElement("SystemsLayout").innerText = e.systemsLayout.join(" ")),
          r.addElement("AutoBrush"),
          (r.addElement("PalmMute").innerText = "0"),
          (r.addElement("PlayingStyle").innerText = Lt.isGuitar(
            e.playbackInfo.program
          )
            ? "StringedPick"
            : "Default"),
          r.addElement("UseOneChannelPerString"),
          (r.addElement("IconId").innerText = xt
            ._getIconId(e.playbackInfo)
            .toString()),
          this._writeInstrumentSetNode(r, e),
          this._writeTransposeNode(r, e),
          this._writeRseNode(r, e),
          (r.addElement("ForcedSound").innerText = "-1"),
          this._writeMidiConnectionNode(r, e),
          e.playbackInfo.isSolo
            ? (r.addElement("PlaybackState").innerText = "Solo")
            : e.playbackInfo.isMute
            ? (r.addElement("PlaybackState").innerText = "Mute")
            : (r.addElement("PlaybackState").innerText = "Default"),
          (r.addElement("AudioEngineState").innerText = "MIDI"),
          this._writeLyricsNode(r, e),
          this._writeStavesNode(r, e),
          this._writeSoundsAndAutomations(r, e);
      }
      static _getIconId(t) {
        return t.primaryChannel === 9
          ? xt._drumKitProgramInfo.icon
          : xt._midiProgramInfoLookup.has(t.program)
          ? xt._midiProgramInfoLookup.get(t.program).icon
          : 1;
      }
      _writeSoundAndAutomation(t, e, r, i, n, s, a, o, l = 0) {
        let u = t.addElement("Sound");
        u.addElement("Name").setCData(r),
          u.addElement("Label").setCData(r),
          u.addElement("Path").setCData(i),
          u.addElement("Role").setCData(n);
        let c = u.addElement("MIDI"),
          d = Lt.bankToLsbMsb(o);
        (c.addElement("LSB").innerText = d[0].toString()),
          (c.addElement("MSB").innerText = d[1].toString()),
          (c.addElement("Program").innerText = a.toString());
        let h = e.addElement("Automation");
        (h.addElement("Type").innerText = "Sound"),
          (h.addElement("Linear").innerText = "false"),
          (h.addElement("Bar").innerText = s.toString()),
          (h.addElement("Position").innerText = l.toString()),
          (h.addElement("Visible").innerText = "true"),
          h.addElement("Value").setCData(`${i};${r};${n}`);
      }
      _writeSoundsAndAutomations(t, e) {
        let r = t.addElement("Sounds"),
          i = t.addElement("Automations");
        if (e.staves.length > 0 && e.staves[0].bars.length > 0) {
          let n = `Track_${e.index}_Initial`,
            s = `Midi/${e.playbackInfo.program}`,
            a = "Factory",
            o = !1,
            l = e.playbackInfo.bank;
          for (let u of e.staves)
            for (let c of u.bars)
              for (let d of c.voices)
                for (let h of d.beats) {
                  let f = h.getAutomation(2),
                    b = c.index === 0 && h.index === 0,
                    y = h.getAutomation(4);
                  if ((y && (l = y.value), f)) {
                    let S = b ? n : `ProgramChange_${h.id}`,
                      k = b ? s : `Midi/${f.value}`,
                      T = b ? a : "User";
                    !b &&
                      !o &&
                      (this._writeSoundAndAutomation(
                        r,
                        i,
                        n,
                        s,
                        a,
                        e.staves[0].bars[0].index,
                        e.playbackInfo.program,
                        e.playbackInfo.bank
                      ),
                      (o = !0)),
                      this._writeSoundAndAutomation(
                        r,
                        i,
                        S,
                        k,
                        T,
                        c.index,
                        f.value,
                        l,
                        f.ratioPosition
                      ),
                      b && (o = !0);
                  }
                }
        }
        for (let n of e.staves)
          for (let s of n.bars)
            for (let a of s.sustainPedals)
              if (a.pedalType !== 1) {
                let o = i.addElement("Automation");
                switch (
                  ((o.addElement("Type").innerText = "SustainPedal"),
                  (o.addElement("Linear").innerText = "false"),
                  (o.addElement("Bar").innerText = s.index.toString()),
                  (o.addElement("Position").innerText =
                    a.ratioPosition.toString()),
                  (o.addElement("Visible").innerText = "true"),
                  a.pedalType)
                ) {
                  case 0:
                    o.addElement("Value").innerText = "0 1";
                    break;
                  case 2:
                    o.addElement("Value").innerText = "0 3";
                    break;
                }
              }
      }
      _writeMidiConnectionNode(t, e) {
        let r = t.addElement("MidiConnection");
        (r.addElement("Port").innerText = e.playbackInfo.port.toString()),
          (r.addElement("PrimaryChannel").innerText =
            e.playbackInfo.primaryChannel.toString()),
          (r.addElement("SecondaryChannel").innerText =
            e.playbackInfo.secondaryChannel.toString()),
          (r.addElement("ForeOneChannelPerString").innerText = "false");
      }
      _writeRseNode(t, e) {
        let i = t.addElement("RSE").addElement("ChannelStrip");
        i.attributes.set("version", "E56");
        let n = i.addElement("Parameters");
        n.innerText = `0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 1 0.5 ${
          e.playbackInfo.balance / 16
        } ${e.playbackInfo.volume / 16} 0.5 0.5 0.5`;
      }
      _writeStavesNode(t, e) {
        let r = t.addElement("Staves");
        for (let i of e.staves) this._writeStaffNode(r, i);
      }
      _writeStaffNode(t, e) {
        let i = t.addElement("Staff").addElement("Properties");
        if (
          (this._writeSimplePropertyNode(
            i,
            "CapoFret",
            "Fret",
            e.capo.toString()
          ),
          this._writeSimplePropertyNode(i, "FretCount", "Fret", "24"),
          e.tuning.length > 0)
        ) {
          let n = i.addElement("Property");
          switch (
            (n.attributes.set("name", "Tuning"),
            (n.addElement("Pitches").innerText = e.tuning
              .slice()
              .reverse()
              .join(" ")),
            n.addElement("Label").setCData(e.tuningName),
            (n.addElement("LabelVisible").innerText = e.tuningName
              ? "true"
              : "false"),
            n.addElement("Flat"),
            e.tuning.length)
          ) {
            case 3:
              n.addElement("Instrument").innerText = "Shamisen";
              break;
            case 4:
              e.track.playbackInfo.program === 105
                ? (n.addElement("Instrument").innerText = "Banjo")
                : e.track.playbackInfo.program === 42
                ? (n.addElement("Instrument").innerText = "Cello")
                : e.track.playbackInfo.program === 43
                ? (n.addElement("Instrument").innerText = "Contrabass")
                : e.track.playbackInfo.program === 40
                ? (n.addElement("Instrument").innerText = "Violin")
                : e.track.playbackInfo.program === 41
                ? (n.addElement("Instrument").innerText = "Viola")
                : (n.addElement("Instrument").innerText = "Bass");
              break;
            case 5:
              e.track.playbackInfo.program === 105
                ? (n.addElement("Instrument").innerText = "Banjo")
                : (n.addElement("Instrument").innerText = "Bass");
              break;
            case 6:
              e.track.playbackInfo.program === 105
                ? (n.addElement("Instrument").innerText = "Banjo")
                : e.track.playbackInfo.program <= 39
                ? (n.addElement("Instrument").innerText = "Bass")
                : (n.addElement("Instrument").innerText = "Guitar");
              break;
            case 7:
              e.track.playbackInfo.program <= 39
                ? (n.addElement("Instrument").innerText = "Bass")
                : (n.addElement("Instrument").innerText = "Guitar");
              break;
            default:
              n.addElement("Instrument").innerText = "Guitar";
              break;
          }
        }
        this._writeSimplePropertyNode(i, "PartialCapoFret", "Fret", "0"),
          this._writeSimplePropertyNode(
            i,
            "PartialCapoStringFlags",
            "Bitset",
            e.tuning.map((n) => "0").join("")
          ),
          this._writeSimplePropertyNode(i, "TuningFlat", "Enable", null),
          this._writeDiagramCollection(i, e, "DiagramCollection"),
          this._writeDiagramCollection(i, e, "DiagramWorkingSet");
      }
      _writeDiagramCollection(t, e, r) {
        let i = t.addElement("Property");
        i.attributes.set("name", r);
        let n = i.addElement("Items"),
          s = e.chords;
        if (s)
          for (let [a, o] of s) {
            let l = n.addElement("Item");
            l.attributes.set("id", a), l.attributes.set("name", o.name);
            let u = l.addElement("Diagram");
            u.attributes.set("stringCount", o.strings.length.toString()),
              u.attributes.set("fretCount", "5"),
              u.attributes.set("baseFret", (o.firstFret - 1).toString()),
              u.attributes.set(
                "barStates",
                o.strings.map((R) => "1").join(" ")
              );
            let c = [],
              d = new Map();
            for (let R = 0; R < o.strings.length; R++) {
              let g = o.strings[R];
              if (g !== -1) {
                let x = u.addElement("Fret"),
                  M = o.strings.length - 1 - R;
                x.attributes.set("string", M.toString()),
                  x.attributes.set("fret", (g - o.firstFret + 1).toString()),
                  d.has(g) || (d.set(g, []), c.push(g)),
                  d.get(g).push(M);
              }
            }
            c.sort();
            let h = u.addElement("Fingering");
            if (o.barreFrets.length > 0) {
              let R = [4, 3, 2, 1];
              for (let g of c) {
                let x = d.get(g);
                if (x.length > 1 && o.barreFrets.indexOf(g) >= 0) {
                  let M = R.length > 0 ? R.pop() : 1;
                  for (let P of x) {
                    let H = h.addElement("Position");
                    switch (M) {
                      case 4:
                        H.attributes.set("finger", "Pinky");
                        break;
                      case 3:
                        H.attributes.set("finger", "Ring");
                        break;
                      case 2:
                        H.attributes.set("finger", "Middle");
                        break;
                      case 1:
                        H.attributes.set("finger", "Index");
                        break;
                    }
                    H.attributes.set("fret", (g - o.firstFret + 1).toString()),
                      H.attributes.set("string", P.toString());
                  }
                }
              }
            }
            let f = u.addElement("Property");
            f.attributes.set("name", "ShowName"),
              f.attributes.set("type", "bool"),
              f.attributes.set("value", o.showName ? "true" : "false");
            let b = u.addElement("Property");
            b.attributes.set("name", "ShowDiagram"),
              b.attributes.set("type", "bool"),
              b.attributes.set("value", o.showDiagram ? "true" : "false");
            let y = u.addElement("Property");
            y.attributes.set("name", "ShowFingering"),
              y.attributes.set("type", "bool"),
              y.attributes.set("value", o.showFingering ? "true" : "false");
            let S = u.addElement("Chord"),
              k = S.addElement("KeyNote");
            k.attributes.set("step", "C"),
              k.attributes.set("accidental", "Natural");
            let T = S.addElement("BassNote");
            T.attributes.set("step", "C"),
              T.attributes.set("accidental", "Natural");
            let O = S.addElement("Degree");
            O.attributes.set("interval", "Third"),
              O.attributes.set("alteration", "Major"),
              O.attributes.set("omitted", "false");
            let N = S.addElement("Degree");
            N.attributes.set("interval", "Fifth"),
              N.attributes.set("alteration", "Perfect"),
              N.attributes.set("omitted", "false");
          }
      }
      _writeSimplePropertyNode(t, e, r, i) {
        let n = t.addElement("Property");
        n.attributes.set("name", e);
        let s = n.addElement(r);
        return i !== null && (s.innerText = i), n;
      }
      _writeSimpleXPropertyNode(t, e, r, i) {
        let n = t.addElement("XProperty");
        n.attributes.set("id", e);
        let s = n.addElement(r);
        return i !== null && (s.innerText = i), n;
      }
      _writeLyricsNode(t, e) {
        let r = t.addElement("Lyrics");
        r.attributes.set("dispatched", "true");
        let i = [];
        for (let n of e.staves[0].bars)
          for (let s of n.voices)
            if (!s.isEmpty) {
              for (let a of s.beats)
                if (a.lyrics)
                  for (let o = 0; o < a.lyrics.length; o++) {
                    for (; o >= i.length; ) {
                      let u = new Rr();
                      (u.startBar = n.index), (u.text = "[Empty]"), i.push(u);
                    }
                    let l = i[o];
                    l.text =
                      l.text === "[Empty]"
                        ? a.lyrics[o]
                        : `${l.text} ${a.lyrics[o].split(" ").join("+")}`;
                  }
            }
        for (let n = 0; n < i.length; n++) {
          let s = r.addElement("Line");
          s.addElement("Text").setCData(i[n].text),
            (s.addElement("Offset").innerText = i[n].startBar.toString());
        }
      }
      _writeTransposeNode(t, e) {
        let r = t.addElement("Transpose"),
          i = Math.floor(e.staves[0].displayTranspositionPitch / 12),
          n = e.staves[0].displayTranspositionPitch - i * 12;
        (r.addElement("Chromatic").innerText = n.toString()),
          (r.addElement("Octave").innerText = i.toString());
      }
      _writeInstrumentSetNode(t, e) {
        let r = t.addElement("InstrumentSet"),
          i = e.staves[0];
        if (
          ((r.addElement("LineCount").innerText =
            i.standardNotationLineCount.toString()),
          e.percussionArticulations.length > 0 || i.isPercussion)
        ) {
          let n =
            e.percussionArticulations.length > 0
              ? e.percussionArticulations
              : Array.from(He.instrumentArticulations.values());
          (r.addElement("Name").innerText =
            xt._drumKitProgramInfo.instrumentSetName),
            (r.addElement("Type").innerText =
              xt._drumKitProgramInfo.instrumentSetType);
          let s = "",
            a = "",
            o = new wr(),
            l = new Map(),
            u = r.addElement("Elements");
          for (let c of n) {
            if (!s || s !== c.elementType) {
              let h = u.addElement("Element"),
                f = c.elementType;
              if (l.has(f)) {
                let b = l.get(f);
                (f += ` ${b}`), l.set(f, b + 1);
              } else l.set(f, 1);
              (a = f),
                (h.addElement("Name").innerText = f),
                (h.addElement("Type").innerText = c.elementType),
                (o = h.addElement("Articulations"));
            }
            let d = o.addElement("Articulation");
            switch (
              ((d.addElement("Name").innerText = `${a} ${o.childNodes.length}`),
              (d.addElement("StaffLine").innerText = c.staffLine.toString()),
              (d.addElement("Noteheads").innerText = [
                this._mapMusicSymbol(c.noteHeadDefault),
                this._mapMusicSymbol(c.noteHeadHalf),
                this._mapMusicSymbol(c.noteHeadWhole),
              ].join(" ")),
              c.techniqueSymbolPlacement)
            ) {
              case 2:
                d.addElement("TechniquePlacement").innerText = "below";
                break;
              case 3:
                d.addElement("TechniquePlacement").innerText = "outside";
                break;
              case 1:
                d.addElement("TechniquePlacement").innerText = "inside";
                break;
              case 0:
                d.addElement("TechniquePlacement").innerText = "above";
                break;
            }
            (d.addElement("TechniqueSymbol").innerText = this._mapMusicSymbol(
              c.techniqueSymbol
            )),
              (d.addElement("InputMidiNumbers").innerText = ""),
              (d.addElement("OutputMidiNumber").innerText =
                c.outputMidiNumber.toString());
          }
        } else {
          let n = xt._midiProgramInfoLookup.has(e.playbackInfo.program)
            ? xt._midiProgramInfoLookup.get(e.playbackInfo.program)
            : xt._midiProgramInfoLookup.get(0);
          (r.addElement("Name").innerText = n.instrumentSetName),
            (r.addElement("Type").innerText = n.instrumentSetType);
          let a = r.addElement("Elements").addElement("Element");
          (a.addElement("Pitched").innerText = "Pitched"),
            (a.addElement("Type").innerText = "pitched"),
            (a.addElement("SoundbankName").innerText = "");
          let l = a.addElement("Articulations").addElement("Articulation");
          (l.addElement("Name").innerText = ""),
            (l.addElement("StaffLine").innerText = "0"),
            (l.addElement("Noteheads").innerText =
              "noteheadBlack noteheadHalf noteheadWhole"),
            (l.addElement("TechniquePlacement").innerText = "outside"),
            (l.addElement("TechniqueSymbol").innerText = ""),
            (l.addElement("InputMidiNumbers").innerText = ""),
            (l.addElement("OutputRSESound").innerText = ""),
            (l.addElement("OutputMidiNumber").innerText = "0");
        }
      }
      _mapMusicSymbol(t) {
        if (t === -1) return "";
        let e = K[t];
        return e.substring(0, 1).toLowerCase() + e.substring(1);
      }
      _writeMasterBarsNode(t, e) {
        let r = t.addElement("MasterBars");
        for (let i of e.masterBars) this._writeMasterBarNode(r, i);
      }
      _writeMasterBarNode(t, e) {
        let r = t.addElement("MasterBar"),
          i = r.addElement("Key"),
          n = e.score.tracks[0].staves[0].bars[e.index].keySignature,
          s = e.score.tracks[0].staves[0].bars[e.index].keySignatureType,
          a = A.flooredDivision(
            e.score.tracks[0].staves[0].displayTranspositionPitch,
            12
          );
        (n = A.transposeKey(n, -a)),
          (i.addElement("AccidentalCount").innerText = n.toString()),
          (i.addElement("Mode").innerText = Sr[s]),
          (i.addElement("Sharps").innerText = "Sharps"),
          (r.addElement(
            "Time"
          ).innerText = `${e.timeSignatureNumerator}/${e.timeSignatureDenominator}`),
          e.isFreeTime && r.addElement("FreeTime");
        let o = [];
        for (let l of e.score.tracks)
          for (let u of l.staves) o.push(u.bars[e.index].id.toString());
        if (
          ((r.addElement("Bars").innerText = o.join(" ")),
          e.isDoubleBar && r.addElement("DoubleBar"),
          e.isSectionStart)
        ) {
          let l = r.addElement("Section");
          l.addElement("Letter").setCData(e.section.marker),
            l.addElement("Text").setCData(e.section.text);
        }
        if (e.isRepeatStart || e.isRepeatEnd) {
          let l = r.addElement("Repeat");
          l.attributes.set("start", e.isRepeatStart ? "true" : "false"),
            l.attributes.set("end", e.isRepeatEnd ? "true" : "false"),
            e.isRepeatEnd &&
              l.attributes.set("count", e.repeatCount.toString());
        }
        if (e.alternateEndings > 0) {
          let l = e.alternateEndings,
            u = [],
            c = 0;
          for (; l > 0; )
            ((l >> c) & 1) === 1 && (u.push(c + 1), (l &= ~(1 << c))), c++;
          r.addElement("AlternateEndings").innerText = u.join(" ");
        }
        if (
          (e.tripletFeel !== 0 &&
            (r.addElement("TripletFeel").innerText = Ct[e.tripletFeel]),
          e.directions && e.directions.size > 0)
        ) {
          let l = r.addElement("Directions");
          for (let u of e.directions)
            switch (u) {
              case 0:
                l.addElement("Target").innerText = "Fine";
                break;
              case 1:
                l.addElement("Target").innerText = "Segno";
                break;
              case 2:
                l.addElement("Target").innerText = "SegnoSegno";
                break;
              case 3:
                l.addElement("Target").innerText = "Coda";
                break;
              case 4:
                l.addElement("Target").innerText = "DoubleCoda";
                break;
              case 5:
                l.addElement("Jump").innerText = "DaCapo";
                break;
              case 6:
                l.addElement("Jump").innerText = "DaCapoAlCoda";
                break;
              case 7:
                l.addElement("Jump").innerText = "DaCapoAlDoubleCoda";
                break;
              case 8:
                l.addElement("Jump").innerText = "DaCapoAlFine";
                break;
              case 9:
                l.addElement("Jump").innerText = "DaSegno";
                break;
              case 10:
                l.addElement("Jump").innerText = "DaSegnoAlCoda";
                break;
              case 11:
                l.addElement("Jump").innerText = "DaSegnoAlDoubleCoda";
                break;
              case 12:
                l.addElement("Jump").innerText = "DaSegnoAlFine";
                break;
              case 13:
                l.addElement("Jump").innerText = "DaSegnoSegno";
                break;
              case 14:
                l.addElement("Jump").innerText = "DaSegnoSegnoAlCoda";
                break;
              case 15:
                l.addElement("Jump").innerText = "DaSegnoSegnoAlDoubleCoda";
                break;
              case 16:
                l.addElement("Jump").innerText = "DaSegnoSegnoAlFine";
                break;
              case 17:
                l.addElement("Jump").innerText = "DaCoda";
                break;
              case 18:
                l.addElement("Jump").innerText = "DaDoubleCoda";
                break;
            }
        }
        this._writeFermatas(r, e);
      }
      _writeFermatas(t, e) {
        let r = e.fermata?.size ?? 0;
        if (r !== 0 && r > 0) {
          let i = t.addElement("Fermatas");
          for (let [n, s] of e.fermata) this._writeFermata(i, n, s);
        }
      }
      _writeFermata(t, e, r) {
        let i = -1,
          n = 1;
        if (e > 0)
          for (
            ;
            n < 10 && ((i = (e / E.QuarterTime) * n), i !== Math.floor(i));

          )
            (i = -1), n++;
        else (i = 0), (n = 1);
        if (i === -1) return;
        let s = t.addElement("Fermata");
        (s.addElement("Type").innerText = Fr[r.type]),
          (s.addElement("Length").innerText = r.length.toString()),
          (s.addElement("Offset").innerText = `${i}/${n}`);
      }
      _writeBarNode(t, e) {
        let r = t.addElement("Bar");
        r.attributes.set("id", e.id.toString()),
          (r.addElement("Voices").innerText = e.voices
            .map((i) => (i.isEmpty ? "-1" : i.id.toString()))
            .join(" ")),
          (r.addElement("Clef").innerText = yt[e.clef]),
          e.clefOttava !== 2 &&
            (r.addElement("Ottavia").innerText = Ze[e.clefOttava].substr(1)),
          e.simileMark !== 0 &&
            (r.addElement("SimileMark").innerText = ur[e.simileMark]);
      }
      _writeVoiceNode(t, e) {
        if (e.isEmpty) return;
        let r = t.addElement("Voice");
        r.attributes.set("id", e.id.toString()),
          (r.addElement("Beats").innerText = e.beats
            .map((i) => i.id)
            .join(" "));
      }
    };
  (xt._sampleRate = 44100),
    (xt._midiProgramInfoLookup = new Map([
      [0, new L(10, "Acoustic Piano")],
      [1, new L(10, "Acoustic Piano")],
      [2, new L(10, "Electric Piano")],
      [3, new L(10, "Acoustic Piano")],
      [4, new L(10, "Electric Piano")],
      [5, new L(10, "Electric Piano")],
      [6, new L(10, "Harpsichord")],
      [7, new L(10, "Harpsichord")],
      [8, new L(17, "Celesta")],
      [9, new L(17, "Vibraphone")],
      [10, new L(17, "Vibraphone")],
      [11, new L(17, "Vibraphone")],
      [12, new L(17, "Xylophone")],
      [13, new L(17, "Xylophone")],
      [14, new L(17, "Vibraphone")],
      [15, new L(8, "Banjo")],
      [16, new L(10, "Electric Organ")],
      [17, new L(10, "Electric Organ")],
      [18, new L(10, "Electric Organ")],
      [19, new L(10, "Electric Organ")],
      [20, new L(10, "Electric Organ")],
      [21, new L(10, "Electric Organ")],
      [22, new L(15, "Recorder")],
      [23, new L(10, "Electric Organ")],
      [24, new L(23, "Nylon Guitar")],
      [25, new L(1, "Steel Guitar")],
      [26, new L(1, "Electric Guitar")],
      [27, new L(4, "Electric Guitar")],
      [28, new L(4, "Electric Guitar")],
      [29, new L(4, "Electric Guitar")],
      [30, new L(1, "Electric Guitar")],
      [31, new L(1, "Electric Guitar")],
      [32, new L(5, "Acoustic Bass")],
      [33, new L(5, "Electric Bass")],
      [34, new L(5, "Electric Bass")],
      [35, new L(5, "Acoustic Bass")],
      [36, new L(5, "Electric Bass")],
      [37, new L(5, "Electric Bass")],
      [38, new L(12, "Synth Bass")],
      [39, new L(12, "Synth Bass")],
      [40, new L(11, "Violin")],
      [41, new L(11, "Viola")],
      [42, new L(11, "Cello")],
      [43, new L(11, "Contrabass")],
      [44, new L(11, "Violin")],
      [45, new L(11, "Violin")],
      [46, new L(10, "Harp")],
      [47, new L(20, "Timpani")],
      [48, new L(11, "Violin")],
      [49, new L(11, "Violin")],
      [50, new L(11, "Violin")],
      [51, new L(11, "Violin")],
      [52, new L(16, "Voice")],
      [53, new L(16, "Voice")],
      [54, new L(16, "Voice")],
      [55, new L(12, "Pad Synthesizer")],
      [56, new L(13, "Trumpet")],
      [57, new L(13, "Trombone")],
      [58, new L(13, "Tuba")],
      [59, new L(13, "Trumpet")],
      [60, new L(13, "French Horn")],
      [61, new L(13, "Trumpet")],
      [62, new L(13, "Trumpet")],
      [63, new L(13, "Trumpet")],
      [64, new L(14, "Saxophone")],
      [65, new L(14, "Saxophone")],
      [66, new L(14, "Saxophone")],
      [67, new L(14, "Saxophone")],
      [68, new L(14, "Oboe")],
      [69, new L(14, "English Horn")],
      [70, new L(14, "Bassoon")],
      [71, new L(14, "Clarinet")],
      [72, new L(14, "Piccolo")],
      [73, new L(15, "Flute")],
      [74, new L(15, "Recorder")],
      [75, new L(15, "Flute")],
      [76, new L(15, "Recorder")],
      [77, new L(15, "Flute")],
      [78, new L(15, "Recorder")],
      [79, new L(15, "Flute")],
      [80, new L(12, "Lead Synthesizer")],
      [81, new L(12, "Lead Synthesizer")],
      [82, new L(12, "Lead Synthesizer")],
      [83, new L(12, "Lead Synthesizer")],
      [84, new L(12, "Lead Synthesizer")],
      [85, new L(12, "Lead Synthesizer")],
      [86, new L(12, "Lead Synthesizer")],
      [87, new L(12, "Lead Synthesizer")],
      [88, new L(12, "Pad Synthesizer")],
      [89, new L(12, "Pad Synthesizer")],
      [90, new L(12, "Pad Synthesizer")],
      [91, new L(12, "Pad Synthesizer")],
      [92, new L(12, "Pad Synthesizer")],
      [93, new L(12, "Pad Synthesizer")],
      [94, new L(12, "Pad Synthesizer")],
      [95, new L(12, "Pad Synthesizer")],
      [96, new L(21, "Pad Synthesizer")],
      [97, new L(21, "Pad Synthesizer")],
      [98, new L(21, "Pad Synthesizer")],
      [99, new L(21, "Pad Synthesizer")],
      [100, new L(21, "Lead Synthesizer")],
      [101, new L(21, "Lead Synthesizer")],
      [102, new L(21, "Lead Synthesizer")],
      [103, new L(21, "Trumpet")],
      [104, new L(4, "Banjo")],
      [105, new L(8, "Banjo")],
      [106, new L(7, "Ukulele")],
      [107, new L(8, "Banjo")],
      [108, new L(17, "Xylophone")],
      [109, new L(14, "Bassoon")],
      [110, new L(11, "Violin")],
      [111, new L(15, "Flute")],
      [112, new L(17, "Xylophone")],
      [113, new L(19, "Celesta")],
      [114, new L(17, "Vibraphone")],
      [115, new L(19, "Xylophone")],
      [116, new L(20, "Xylophone")],
      [117, new L(20, "Xylophone")],
      [118, new L(20, "Xylophone")],
      [119, new L(19, "Celesta")],
      [120, new L(21, "Steel Guitar")],
      [121, new L(21, "Recorder")],
      [122, new L(21, "Recorder")],
      [123, new L(21, "Recorder")],
      [124, new L(21, "Recorder")],
      [125, new L(21, "Recorder")],
      [126, new L(21, "Recorder")],
      [127, new L(21, "Timpani")],
    ])),
    (xt._drumKitProgramInfo = new L(18, "Drums", "drumKit")),
    (xt._defaultSteps = [
      "C",
      "C",
      "D",
      "D",
      "E",
      "F",
      "F",
      "G",
      "G",
      "A",
      "A",
      "B",
    ]);
  var sp = xt;
  var rs = class rs {
    constructor() {
      this._checkValue = rs._crcInit;
      this.reset();
    }
    static _buildCrc32Lookup() {
      let e = new Uint32Array(256);
      for (let r = 0; r < e.length; r++) {
        let i = r;
        for (let n = 0; n < 8; n++)
          i = (i & 1) === 1 ? (i >>> 1) ^ 3988292384 : i >>> 1;
        e[r] = i;
      }
      return e;
    }
    get value() {
      return ~this._checkValue;
    }
    update(t, e, r) {
      for (let i = 0; i < r; i++)
        this._checkValue =
          rs._crc32Lookup[(this._checkValue ^ t[e + i]) & 255] ^
          (this._checkValue >>> 8);
    }
    reset() {
      this._checkValue = rs._crcInit;
    }
  };
  (rs._crc32Lookup = rs._buildCrc32Lookup()), (rs._crcInit = 4294967295);
  var oo = rs;
  var We = class We {};
  (We.maxWbits = 15),
    (We.wsize = 1 << We.maxWbits),
    (We.wmask = We.wsize - 1),
    (We.minMatch = 3),
    (We.maxMatch = 258),
    (We.defaultMemLevel = 8),
    (We.pendingBufSize = 1 << (We.defaultMemLevel + 8)),
    (We.hashBits = We.defaultMemLevel + 7),
    (We.hashSize = 1 << We.hashBits),
    (We.hashShift = (We.hashBits + We.minMatch - 1) / We.minMatch),
    (We.hashMask = We.hashSize - 1),
    (We.minLookahead = We.maxMatch + We.minMatch + 1),
    (We.maxDist = We.wsize - We.minLookahead);
  var de = We;
  var Si = class Si {
    constructor(t, e, r, i) {
      this.length = null;
      this.numCodes = 0;
      this._codes = null;
      (this._huffman = t),
        (this.minNumCodes = r),
        (this._maxLength = i),
        (this.freqs = new Int16Array(e)),
        (this._bitLengthCounts = new Int32Array(i));
    }
    reset() {
      for (let t = 0; t < this.freqs.length; t++) this.freqs[t] = 0;
      (this._codes = null), (this.length = null);
    }
    buildTree() {
      let t = this.freqs.length,
        e = new Int32Array(t),
        r = 0,
        i = 0;
      for (let l = 0; l < t; l++) {
        let u = this.freqs[l];
        if (u !== 0) {
          let c = r++;
          for (; c > 0; ) {
            let d = Math.floor((c - 1) / 2);
            if (this.freqs[e[d]] > u) (e[c] = e[d]), (c = d);
            else break;
          }
          (e[c] = l), (i = l);
        }
      }
      for (; r < 2; ) {
        let l = i < 2 ? ++i : 0;
        e[r++] = l;
      }
      this.numCodes = Math.max(i + 1, this.minNumCodes);
      let n = r,
        s = new Int32Array(4 * r - 2),
        a = new Int32Array(2 * r - 1),
        o = n;
      for (let l = 0; l < r; l++) {
        let u = e[l];
        (s[2 * l] = u),
          (s[2 * l + 1] = -1),
          (a[l] = this.freqs[u] << 8),
          (e[l] = l);
      }
      do {
        let l = e[0],
          u = e[--r],
          c = 0,
          d = 1;
        for (; d < r; )
          d + 1 < r && a[e[d]] > a[e[d + 1]] && d++,
            (e[c] = e[d]),
            (c = d),
            (d = d * 2 + 1);
        let h = a[u];
        for (; (d = c), c > 0; )
          if (((c = Math.floor((d - 1) / 2)), a[e[c]] > h)) e[d] = e[c];
          else break;
        e[d] = u;
        let f = e[0];
        (u = o++), (s[2 * u] = l), (s[2 * u + 1] = f);
        let b = Math.min(a[l] & 255, a[f] & 255);
        for (h = a[l] + a[f] - b + 1, a[u] = h, c = 0, d = 1; d < r; )
          d + 1 < r && a[e[d]] > a[e[d + 1]] && d++,
            (e[c] = e[d]),
            (c = d),
            (d = c * 2 + 1);
        for (; (d = c), d > 0; )
          if (((c = Math.floor((d - 1) / 2)), a[e[c]] > h)) e[d] = e[c];
          else break;
        e[d] = u;
      } while (r > 1);
      this._buildLength(s);
    }
    _buildLength(t) {
      this.length = new Uint8Array(this.freqs.length);
      let e = Math.floor(t.length / 2),
        r = Math.floor((e + 1) / 2),
        i = 0;
      for (let o = 0; o < this._maxLength; o++) this._bitLengthCounts[o] = 0;
      let n = new Int32Array(e);
      n[e - 1] = 0;
      for (let o = e - 1; o >= 0; o--)
        if (t[2 * o + 1] !== -1) {
          let l = n[o] + 1;
          l > this._maxLength && ((l = this._maxLength), i++),
            (n[t[2 * o]] = l),
            (n[t[2 * o + 1]] = l);
        } else {
          let l = n[o];
          this._bitLengthCounts[l - 1]++, (this.length[t[2 * o]] = n[o]);
        }
      if (i === 0) return;
      let s = this._maxLength - 1;
      do {
        for (; this._bitLengthCounts[--s] === 0; );
        do
          this._bitLengthCounts[s]--,
            this._bitLengthCounts[++s]++,
            (i -= 1 << (this._maxLength - 1 - s));
        while (i > 0 && s < this._maxLength - 1);
      } while (i > 0);
      (this._bitLengthCounts[this._maxLength - 1] += i),
        (this._bitLengthCounts[this._maxLength - 2] -= i);
      let a = 2 * r;
      for (let o = this._maxLength; o !== 0; o--) {
        let l = this._bitLengthCounts[o - 1];
        for (; l > 0; ) {
          let u = 2 * t[a++];
          t[u + 1] === -1 && ((this.length[t[u]] = o), l--);
        }
      }
    }
    getEncodedLength() {
      let t = 0;
      for (let e = 0; e < this.freqs.length; e++)
        t += this.freqs[e] * this.length[e];
      return t;
    }
    calcBLFreq(t) {
      let e,
        r,
        i,
        n = -1,
        s = 0;
      for (; s < this.numCodes; ) {
        i = 1;
        let a = this.length[s];
        for (
          a === 0
            ? ((e = 138), (r = 3))
            : ((e = 6), (r = 3), n !== a && (t.freqs[a]++, (i = 0))),
            n = a,
            s++;
          s < this.numCodes && n === this.length[s] && (s++, !(++i >= e));

        );
        i < r
          ? (t.freqs[n] += i)
          : n !== 0
          ? t.freqs[Si._repeat3To6]++
          : i <= 10
          ? t.freqs[Si._repeat3To10]++
          : t.freqs[Si._repeat11To138]++;
      }
    }
    setStaticCodes(t, e) {
      (this._codes = t), (this.length = e);
    }
    buildCodes() {
      let t = new Int32Array(this._maxLength),
        e = 0;
      this._codes = new Int16Array(this.freqs.length);
      for (let r = 0; r < this._maxLength; r++)
        (t[r] = e), (e += this._bitLengthCounts[r] << (15 - r));
      for (let r = 0; r < this.numCodes; r++) {
        let i = this.length[r];
        i > 0 &&
          ((this._codes[r] = lo.bitReverse(t[i - 1])),
          (t[i - 1] += 1 << (16 - i)));
      }
    }
    writeTree(t) {
      let e,
        r,
        i,
        n = -1,
        s = 0;
      for (; s < this.numCodes; ) {
        i = 1;
        let a = this.length[s];
        for (
          a === 0
            ? ((e = 138), (r = 3))
            : ((e = 6), (r = 3), n !== a && (t.writeSymbol(a), (i = 0))),
            n = a,
            s++;
          s < this.numCodes && n === this.length[s] && (s++, !(++i >= e));

        );
        if (i < r) for (; i-- > 0; ) t.writeSymbol(n);
        else
          n !== 0
            ? (t.writeSymbol(Si._repeat3To6),
              this._huffman.pending.writeBits(i - 3, 2))
            : i <= 10
            ? (t.writeSymbol(Si._repeat3To10),
              this._huffman.pending.writeBits(i - 3, 3))
            : (t.writeSymbol(Si._repeat11To138),
              this._huffman.pending.writeBits(i - 11, 7));
      }
    }
    writeSymbol(t) {
      this._huffman.pending.writeBits(this._codes[t] & 65535, this.length[t]);
    }
  };
  (Si._repeat3To6 = 16), (Si._repeat3To10 = 17), (Si._repeat11To138 = 18);
  var Ul = Si,
    se = class se {
      constructor(t) {
        this._lastLit = 0;
        this._extraBits = 0;
        (this.pending = t),
          (this._literalTree = new Ul(this, se._literalNum, 257, 15)),
          (this._distTree = new Ul(this, se._distNum, 1, 15)),
          (this._blTree = new Ul(this, se._bitLenNum, 4, 7)),
          (this._dBuf = new Int16Array(se._bufSize)),
          (this._lBuf = new Uint8Array(se._bufSize));
      }
      static staticInit() {
        let t = 0;
        for (; t < 144; )
          (se._staticLCodes[t] = se.bitReverse((48 + t) << 8)),
            (se._staticLLength[t++] = 8);
        for (; t < 256; )
          (se._staticLCodes[t] = se.bitReverse((256 + t) << 7)),
            (se._staticLLength[t++] = 9);
        for (; t < 280; )
          (se._staticLCodes[t] = se.bitReverse((-256 + t) << 9)),
            (se._staticLLength[t++] = 7);
        for (; t < se._literalNum; )
          (se._staticLCodes[t] = se.bitReverse((-88 + t) << 8)),
            (se._staticLLength[t++] = 8);
        for (t = 0; t < se._distNum; t++)
          (se._staticDCodes[t] = se.bitReverse(t << 11)),
            (se._staticDLength[t] = 5);
      }
      static bitReverse(t) {
        return (
          (se._bit4Reverse[t & 15] << 12) |
          (se._bit4Reverse[(t >> 4) & 15] << 8) |
          (se._bit4Reverse[(t >> 8) & 15] << 4) |
          se._bit4Reverse[t >> 12]
        );
      }
      isFull() {
        return this._lastLit >= se._bufSize;
      }
      reset() {
        (this._lastLit = 0),
          (this._extraBits = 0),
          this._literalTree.reset(),
          this._distTree.reset(),
          this._blTree.reset();
      }
      flushStoredBlock(t, e, r, i) {
        this.pending.writeBits((se.storedBlock << 1) + (i ? 1 : 0), 3),
          this.pending.alignToByte(),
          this.pending.writeShort(r),
          this.pending.writeShort(~r),
          this.pending.writeBlock(t, e, r),
          this.reset();
      }
      flushBlock(t, e, r, i) {
        this._literalTree.freqs[se._eofSymbol]++,
          this._literalTree.buildTree(),
          this._distTree.buildTree(),
          this._literalTree.calcBLFreq(this._blTree),
          this._distTree.calcBLFreq(this._blTree),
          this._blTree.buildTree();
        let n = 4;
        for (let o = 18; o > n; o--)
          this._blTree.length[se._blOrder[o]] > 0 && (n = o + 1);
        let s =
            14 +
            n * 3 +
            this._blTree.getEncodedLength() +
            this._literalTree.getEncodedLength() +
            this._distTree.getEncodedLength() +
            this._extraBits,
          a = this._extraBits;
        for (let o = 0; o < se._literalNum; o++)
          a += this._literalTree.freqs[o] * se._staticLLength[o];
        for (let o = 0; o < se._distNum; o++)
          a += this._distTree.freqs[o] * se._staticDLength[o];
        s >= a && (s = a),
          e >= 0 && r + 4 < s >> 3
            ? this.flushStoredBlock(t, e, r, i)
            : s === a
            ? (this.pending.writeBits((se.staticTrees << 1) + (i ? 1 : 0), 3),
              this._literalTree.setStaticCodes(
                se._staticLCodes,
                se._staticLLength
              ),
              this._distTree.setStaticCodes(
                se._staticDCodes,
                se._staticDLength
              ),
              this.compressBlock(),
              this.reset())
            : (this.pending.writeBits((se.dynTrees << 1) + (i ? 1 : 0), 3),
              this.sendAllTrees(n),
              this.compressBlock(),
              this.reset());
      }
      sendAllTrees(t) {
        this._blTree.buildCodes(),
          this._literalTree.buildCodes(),
          this._distTree.buildCodes(),
          this.pending.writeBits(this._literalTree.numCodes - 257, 5),
          this.pending.writeBits(this._distTree.numCodes - 1, 5),
          this.pending.writeBits(t - 4, 4);
        for (let e = 0; e < t; e++)
          this.pending.writeBits(this._blTree.length[se._blOrder[e]], 3);
        this._literalTree.writeTree(this._blTree),
          this._distTree.writeTree(this._blTree);
      }
      compressBlock() {
        for (let t = 0; t < this._lastLit; t++) {
          let e = this._lBuf[t] & 255,
            r = this._dBuf[t];
          if (r-- !== 0) {
            let i = se._lCode(e);
            this._literalTree.writeSymbol(i);
            let n = Math.floor((i - 261) / 4);
            n > 0 && n <= 5 && this.pending.writeBits(e & ((1 << n) - 1), n);
            let s = se._dCode(r);
            this._distTree.writeSymbol(s),
              (n = Math.floor(s / 2) - 1),
              n > 0 && this.pending.writeBits(r & ((1 << n) - 1), n);
          } else this._literalTree.writeSymbol(e);
        }
        this._literalTree.writeSymbol(se._eofSymbol);
      }
      tallyDist(t, e) {
        (this._dBuf[this._lastLit] = t), (this._lBuf[this._lastLit++] = e - 3);
        let r = se._lCode(e - 3);
        this._literalTree.freqs[r]++,
          r >= 265 && r < 285 && (this._extraBits += Math.floor((r - 261) / 4));
        let i = se._dCode(t - 1);
        return (
          this._distTree.freqs[i]++,
          i >= 4 && (this._extraBits += Math.floor(i / 2) - 1),
          this.isFull()
        );
      }
      tallyLit(t) {
        return (
          (this._dBuf[this._lastLit] = 0),
          (this._lBuf[this._lastLit++] = t),
          this._literalTree.freqs[t]++,
          this.isFull()
        );
      }
      static _lCode(t) {
        if (t === 255) return 285;
        let e = 257;
        for (; t >= 8; ) (e += 4), (t = t >> 1);
        return e + t;
      }
      static _dCode(t) {
        let e = 0;
        for (; t >= 4; ) (e += 2), (t = t >> 1);
        return e + t;
      }
    };
  (se._bufSize = 1 << (de.defaultMemLevel + 6)),
    (se._literalNum = 286),
    (se.storedBlock = 0),
    (se.staticTrees = 1),
    (se.dynTrees = 2),
    (se._distNum = 30),
    (se._staticLCodes = new Int16Array(se._literalNum)),
    (se._staticLLength = new Uint8Array(se._literalNum)),
    (se._staticDCodes = new Int16Array(se._distNum)),
    (se._staticDLength = new Uint8Array(se._distNum)),
    (se._blOrder = [
      16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15,
    ]),
    (se._bit4Reverse = new Uint8Array([
      0, 8, 4, 12, 2, 10, 6, 14, 1, 9, 5, 13, 3, 11, 7, 15,
    ])),
    (se._bitLenNum = 19),
    (se._eofSymbol = 256);
  var lo = se;
  lo.staticInit();
  var op = class op {
    constructor(t) {
      this._maxChain = 128;
      this._niceLength = 128;
      this._goodLength = 8;
      this._insertHashIndex = 0;
      this._lookahead = 0;
      this._inputBuf = null;
      this._inputOff = 0;
      this._inputEnd = 0;
      this._prevAvailable = !1;
      this._matchStart = 0;
      this._matchLen = 0;
      (this._pending = t),
        (this._huffman = new lo(t)),
        (this.inputCrc = new oo()),
        (this._window = new Uint8Array(2 * de.wsize)),
        (this._head = new Int16Array(de.hashSize)),
        (this._prev = new Int16Array(de.wsize)),
        (this._blockStart = 1),
        (this._strstart = 1);
    }
    reset() {
      this._huffman.reset(),
        this.inputCrc.reset(),
        (this._blockStart = 1),
        (this._strstart = 1),
        (this._lookahead = 0),
        (this._prevAvailable = !1),
        (this._matchLen = de.minMatch - 1);
      for (let t = 0; t < de.hashSize; t++) this._head[t] = 0;
      for (let t = 0; t < de.wsize; t++) this._prev[t] = 0;
    }
    _updateHash() {
      this._insertHashIndex =
        (this._window[this._strstart] << de.hashShift) ^
        this._window[this._strstart + 1];
    }
    needsInput() {
      return this._inputEnd === this._inputOff;
    }
    setInput(t, e, r) {
      let i = e + r;
      (this._inputBuf = t), (this._inputOff = e), (this._inputEnd = i);
    }
    deflate(t, e) {
      let r;
      do {
        this.fillWindow();
        let i = t && this._inputOff === this._inputEnd;
        r = this._deflateSlow(i, e);
      } while (this._pending.isFlushed && r);
      return r;
    }
    _deflateSlow(t, e) {
      if (this._lookahead < de.minLookahead && !t) return !1;
      for (; this._lookahead >= de.minLookahead || t; ) {
        if (this._lookahead === 0)
          return (
            this._prevAvailable &&
              this._huffman.tallyLit(this._window[this._strstart - 1] & 255),
            (this._prevAvailable = !1),
            this._huffman.flushBlock(
              this._window,
              this._blockStart,
              this._strstart - this._blockStart,
              e
            ),
            (this._blockStart = this._strstart),
            !1
          );
        this._strstart >= 2 * de.wsize - de.minLookahead && this._slideWindow();
        let r = this._matchStart,
          i = this._matchLen;
        if (this._lookahead >= de.minMatch) {
          let n = this._insertString();
          n !== 0 &&
            this._strstart - n <= de.maxDist &&
            this._findLongestMatch(n) &&
            this._matchLen === de.minMatch &&
            this._strstart - this._matchStart > op._tooFar &&
            (this._matchLen = de.minMatch - 1);
        }
        if (i >= de.minMatch && this._matchLen <= i) {
          this._huffman.tallyDist(this._strstart - 1 - r, i), (i -= 2);
          do
            this._strstart++,
              this._lookahead--,
              this._lookahead >= de.minMatch && this._insertString();
          while (--i > 0);
          this._strstart++,
            this._lookahead--,
            (this._prevAvailable = !1),
            (this._matchLen = de.minMatch - 1);
        } else
          this._prevAvailable &&
            this._huffman.tallyLit(this._window[this._strstart - 1] & 255),
            (this._prevAvailable = !0),
            this._strstart++,
            this._lookahead--;
        if (this._huffman.isFull()) {
          let n = this._strstart - this._blockStart;
          this._prevAvailable && n--;
          let s = e && this._lookahead === 0 && !this._prevAvailable;
          return (
            this._huffman.flushBlock(this._window, this._blockStart, n, s),
            (this._blockStart += n),
            !s
          );
        }
      }
      return !0;
    }
    _findLongestMatch(t) {
      let e,
        r = this._strstart,
        i = r + Math.min(de.maxMatch, this._lookahead) - 1,
        n = Math.max(r - de.maxDist, 0),
        s = this._window,
        a = this._prev,
        o = this._maxChain,
        l = Math.min(this._niceLength, this._lookahead);
      if (
        ((this._matchLen = Math.max(this._matchLen, de.minMatch - 1)),
        r + this._matchLen > i)
      )
        return !1;
      let u = s[r + this._matchLen - 1],
        c = s[r + this._matchLen];
      this._matchLen >= this._goodLength && (o >>= 2);
      do
        if (
          ((e = t),
          (r = this._strstart),
          !(
            s[e + this._matchLen] !== c ||
            s[e + this._matchLen - 1] !== u ||
            s[e] !== s[r] ||
            s[++e] !== s[++r]
          ))
        ) {
          switch ((i - r) % 8) {
            case 1:
              if (s[++r] === s[++e]) break;
              break;
            case 2:
              if (s[++r] === s[++e] && s[++r] === s[++e]) break;
              break;
            case 3:
              if (s[++r] === s[++e] && s[++r] === s[++e] && s[++r] === s[++e])
                break;
              break;
            case 4:
              if (
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e]
              )
                break;
              break;
            case 5:
              if (
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e]
              )
                break;
              break;
            case 6:
              if (
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e]
              )
                break;
              break;
            case 7:
              if (
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e] &&
                s[++r] === s[++e]
              )
                break;
              break;
          }
          if (s[r] === s[e])
            do
              if (r === i) {
                ++r, ++e;
                break;
              }
            while (
              s[++r] === s[++e] &&
              s[++r] === s[++e] &&
              s[++r] === s[++e] &&
              s[++r] === s[++e] &&
              s[++r] === s[++e] &&
              s[++r] === s[++e] &&
              s[++r] === s[++e] &&
              s[++r] === s[++e]
            );
          if (r - this._strstart > this._matchLen) {
            if (
              ((this._matchStart = t),
              (this._matchLen = r - this._strstart),
              this._matchLen >= l)
            )
              break;
            (u = s[r - 1]), (c = s[r]);
          }
          t = a[t & de.wmask] & 65535;
        }
      while (t > n && --o !== 0);
      return this._matchLen >= de.minMatch;
    }
    _insertString() {
      let t =
          ((this._insertHashIndex << de.hashShift) ^
            this._window[this._strstart + (de.minMatch - 1)]) &
          de.hashMask,
        e = this._head[t];
      return (
        (this._prev[this._strstart & de.wmask] = e),
        (this._head[t] = this._strstart),
        (this._insertHashIndex = t),
        e & 65535
      );
    }
    fillWindow() {
      if (
        (this._strstart >= de.wsize + de.maxDist && this._slideWindow(),
        this._lookahead < de.minLookahead && this._inputOff < this._inputEnd)
      ) {
        let t = 2 * de.wsize - this._lookahead - this._strstart;
        t > this._inputEnd - this._inputOff &&
          (t = this._inputEnd - this._inputOff),
          this._window.set(
            this._inputBuf.subarray(this._inputOff, this._inputOff + t),
            this._strstart + this._lookahead
          ),
          this.inputCrc.update(this._inputBuf, this._inputOff, t),
          (this._inputOff += t),
          (this._lookahead += t);
      }
      this._lookahead >= de.minMatch && this._updateHash();
    }
    _slideWindow() {
      this._window.set(this._window.subarray(de.wsize, de.wsize + de.wsize), 0),
        (this._matchStart -= de.wsize),
        (this._strstart -= de.wsize),
        (this._blockStart -= de.wsize);
      for (let t = 0; t < de.hashSize; ++t) {
        let e = this._head[t] & 65535;
        this._head[t] = e >= de.wsize ? e - de.wsize : 0;
      }
      for (let t = 0; t < de.wsize; t++) {
        let e = this._prev[t] & 65535;
        this._prev[t] = e >= de.wsize ? e - de.wsize : 0;
      }
    }
  };
  op._tooFar = 4096;
  var ap = op;
  var lp = class {
    constructor(t) {
      this._start = 0;
      this._end = 0;
      this._bits = 0;
      this.bitCount = 0;
      this._buffer = new Uint8Array(t);
    }
    get isFlushed() {
      return this._end === 0;
    }
    reset() {
      (this._start = 0), (this._end = 0), (this.bitCount = 0);
    }
    writeShortMSB(t) {
      (this._buffer[this._end++] = (t >> 8) & 255),
        (this._buffer[this._end++] = t & 255);
    }
    writeShort(t) {
      (this._buffer[this._end++] = t), (this._buffer[this._end++] = t >> 8);
    }
    writeBlock(t, e, r) {
      this._buffer.set(t.subarray(e, e + r), this._end), (this._end += r);
    }
    flush(t, e, r) {
      return (
        this.bitCount >= 8 &&
          ((this._buffer[this._end++] = this._bits & 255),
          (this._bits >>= 8),
          (this.bitCount -= 8)),
        r > this._end - this._start
          ? ((r = this._end - this._start),
            t.set(this._buffer.subarray(this._start, this._start + r), e),
            (this._start = 0),
            (this._end = 0))
          : (t.set(this._buffer.subarray(this._start, this._start + r), e),
            (this._start += r)),
        r
      );
    }
    writeBits(t, e) {
      (this._bits |= t << this.bitCount),
        (this.bitCount += e),
        this.bitCount >= 16 &&
          ((this._buffer[this._end++] = this._bits & 255),
          (this._buffer[this._end++] = (this._bits >> 8) & 255),
          (this._bits >>= 16),
          (this.bitCount -= 16));
    }
    alignToByte() {
      this.bitCount > 0 &&
        ((this._buffer[this._end++] = this._bits & 255),
        this.bitCount > 8 &&
          (this._buffer[this._end++] = (this._bits >> 8) & 255)),
        (this._bits = 0),
        (this.bitCount = 0);
    }
  };
  var bt = class bt {
    constructor() {
      this._state = 0;
      (this._pending = new lp(de.pendingBufSize)),
        (this._engine = new ap(this._pending)),
        this.reset();
    }
    get inputCrc() {
      return this._engine.inputCrc.value;
    }
    get isNeedingInput() {
      return this._engine.needsInput();
    }
    get isFinished() {
      return this._state === bt._finishedState && this._pending.isFlushed;
    }
    reset() {
      (this._state = bt._busyState),
        this._pending.reset(),
        this._engine.reset();
    }
    setInput(t, e, r) {
      this._engine.setInput(t, e, r);
    }
    deflate(t, e, r) {
      let i = r;
      for (;;) {
        let n = this._pending.flush(t, e, r);
        if (((e += n), (r -= n), r === 0 || this._state === bt._finishedState))
          break;
        if (
          !this._engine.deflate(
            (this._state & bt._isFlushing) !== 0,
            (this._state & bt.isFinishing) !== 0
          )
        )
          switch (this._state) {
            case bt._busyState:
              return i - r;
            case bt._flushingState:
              let s = 8 + (-this._pending.bitCount & 7);
              for (; s > 0; ) this._pending.writeBits(2, 10), (s -= 10);
              this._state = bt._busyState;
              break;
            case bt._finishingState:
              this._pending.alignToByte(), (this._state = bt._finishedState);
              break;
          }
      }
      return i - r;
    }
    finish() {
      this._state |= bt._isFlushing | bt.isFinishing;
    }
  };
  (bt._isFlushing = 4),
    (bt.isFinishing = 8),
    (bt._busyState = 16),
    (bt._flushingState = 20),
    (bt._finishingState = 28),
    (bt._finishedState = 30);
  var up = bt;
  var xh = class {
      constructor(t, e, r, i, n) {
        (this.entry = t),
          (this.crc32 = e),
          (this.localHeaderOffset = r),
          (this.compressionMode = i),
          (this.compressedSize = n);
      }
    },
    cp = class {
      constructor(t) {
        this._centralDirectoryHeaders = [];
        this._deflater = new up();
        this._data = t;
      }
      writeEntry(t) {
        let e = qe.CompressionMethodDeflate,
          r = Se.empty(),
          i = this._compress(r, t.data, e),
          n = r.toArray(),
          s = new xh(t, i, this._data.bytesWritten, e, r.length);
        this._centralDirectoryHeaders.push(s),
          B.writeInt32LE(this._data, qe.LocalFileHeaderSignature),
          B.writeUInt16LE(this._data, 10),
          B.writeUInt16LE(this._data, 2048),
          B.writeUInt16LE(this._data, e),
          B.writeInt16LE(this._data, 0),
          B.writeInt16LE(this._data, 0),
          B.writeInt32LE(this._data, i),
          B.writeInt32LE(this._data, n.length),
          B.writeInt32LE(this._data, t.data.length),
          B.writeInt16LE(this._data, t.fullName.length),
          B.writeInt16LE(this._data, 0);
        let a = B.stringToBytes(t.fullName);
        this._data.write(a, 0, a.length), this._data.write(n, 0, n.length);
      }
      _compress(t, e, r) {
        if (r !== qe.CompressionMethodDeflate) {
          let n = new oo();
          return n.update(e, 0, e.length), t.write(e, 0, e.length), n.value;
        }
        let i = new Uint8Array(512);
        for (
          this._deflater.reset(), this._deflater.setInput(e, 0, e.length);
          !this._deflater.isNeedingInput;

        ) {
          let n = this._deflater.deflate(i, 0, i.length);
          if (n <= 0) break;
          t.write(i, 0, n);
        }
        for (this._deflater.finish(); !this._deflater.isFinished; ) {
          let n = this._deflater.deflate(i, 0, i.length);
          if (n <= 0) break;
          t.write(i, 0, n);
        }
        return this._deflater.inputCrc;
      }
      end() {
        let t = this._data.bytesWritten;
        for (let r of this._centralDirectoryHeaders)
          this._writeCentralDirectoryHeader(r);
        let e = this._data.bytesWritten;
        this._writeEndOfCentralDirectoryRecord(t, e);
      }
      _writeEndOfCentralDirectoryRecord(t, e) {
        B.writeInt32LE(this._data, qe.EndOfCentralDirSignature),
          B.writeInt16LE(this._data, 0),
          B.writeInt16LE(this._data, 0),
          B.writeInt16LE(this._data, this._centralDirectoryHeaders.length),
          B.writeInt16LE(this._data, this._centralDirectoryHeaders.length),
          B.writeInt32LE(this._data, e - t),
          B.writeInt32LE(this._data, t),
          B.writeInt16LE(this._data, 0);
      }
      _writeCentralDirectoryHeader(t) {
        B.writeInt32LE(this._data, qe.CentralFileHeaderSignature),
          B.writeUInt16LE(this._data, 10),
          B.writeUInt16LE(this._data, 10),
          B.writeUInt16LE(this._data, 2048),
          B.writeUInt16LE(this._data, t.compressionMode),
          B.writeInt16LE(this._data, 0),
          B.writeInt16LE(this._data, 0),
          B.writeInt32LE(this._data, t.crc32),
          B.writeInt32LE(this._data, t.compressedSize),
          B.writeInt32LE(this._data, t.entry.data.length),
          B.writeInt16LE(this._data, t.entry.fullName.length),
          B.writeInt16LE(this._data, 0),
          B.writeInt16LE(this._data, 0),
          B.writeInt16LE(this._data, 0),
          B.writeInt16LE(this._data, 0),
          B.writeInt32LE(this._data, 0),
          B.writeInt32LE(this._data, t.localHeaderOffset);
        let e = B.stringToBytes(t.entry.fullName);
        this._data.write(e, 0, e.length);
      }
    };
  var dp = class extends ts {
    get name() {
      return "Guitar Pro 7-8";
    }
    writeScore(t) {
      w.debug(this.name, "Writing data entries");
      let e = new sp(),
        r = e.writeXml(t),
        i = kn.writeForScore(t),
        n = _n.writeForScore(t),
        s = xn.writeForScore(t);
      w.debug(this.name, "Writing ZIP entries");
      let a = new cp(this.data);
      a.writeEntry(new qe("VERSION", B.stringToBytes("7.0"))),
        a.writeEntry(new qe("Content/", new Uint8Array(0))),
        a.writeEntry(new qe("Content/BinaryStylesheet", i)),
        a.writeEntry(new qe("Content/PartConfiguration", n)),
        a.writeEntry(new qe("Content/LayoutConfiguration", s)),
        a.writeEntry(new qe("Content/score.gpif", B.stringToBytes(r))),
        e.backingTrackAssetFileName &&
          a.writeEntry(
            new qe(e.backingTrackAssetFileName, t.backingTrack.rawAudioFile)
          ),
        a.end();
    }
  };
  var Ah = {};
  Bi(Ah, {
    AlphaSynthMidiFileHandler: () => bi,
    AlphaTabMetronomeEvent: () => Pn,
    AlphaTabRestEvent: () => An,
    AlphaTabSysExEvent: () => En,
    AlphaTabSystemExclusiveEvents: () => Ph,
    BeatTickLookup: () => Ot,
    BeatTickLookupItem: () => gl,
    ControlChangeEvent: () => In,
    ControllerType: () => Wo,
    DeprecatedMidiEvent: () => Gs,
    EndOfTrackEvent: () => On,
    MasterBarTickLookup: () => Jn,
    MasterBarTickLookupTempoChange: () => Qi,
    MetaDataEvent: () => pp,
    MetaEvent: () => uo,
    MetaEventType: () => Nh,
    MetaNumberEvent: () => hp,
    Midi20PerNotePitchBendEvent: () => mp,
    MidiEvent: () => hr,
    MidiEventType: () => Gn,
    MidiFile: () => Ft,
    MidiFileFormat: () => ko,
    MidiFileGenerator: () => Er,
    MidiTickLookup: () => Ea,
    MidiTickLookupFindBeatResult: () => yl,
    MidiTickLookupFindBeatResultCursorMode: () => Ku,
    MidiTrack: () => bs,
    NoteBendEvent: () => Rn,
    NoteEvent: () => ia,
    NoteOffEvent: () => Mn,
    NoteOnEvent: () => Cn,
    PitchBendEvent: () => Fn,
    ProgramChangeEvent: () => Ln,
    SystemCommonEvent: () => Xl,
    SystemCommonType: () => Eh,
    SystemExclusiveEvent: () => zl,
    TempoChangeEvent: () => Dn,
    TimeSignatureEvent: () => Nn,
  });
  var Gs = class extends hr {
      constructor() {
        super(0, 0, 47);
      }
      writeTo(t) {
        throw new te(0, "Deprecated event, serialization not supported");
      }
    },
    Nh = ((k) => (
      (k[(k.SequenceNumber = 0)] = "SequenceNumber"),
      (k[(k.TextEvent = 1)] = "TextEvent"),
      (k[(k.CopyrightNotice = 2)] = "CopyrightNotice"),
      (k[(k.SequenceOrTrackName = 3)] = "SequenceOrTrackName"),
      (k[(k.InstrumentName = 4)] = "InstrumentName"),
      (k[(k.LyricText = 5)] = "LyricText"),
      (k[(k.MarkerText = 6)] = "MarkerText"),
      (k[(k.CuePoint = 7)] = "CuePoint"),
      (k[(k.PatchName = 8)] = "PatchName"),
      (k[(k.PortName = 9)] = "PortName"),
      (k[(k.MidiChannel = 32)] = "MidiChannel"),
      (k[(k.MidiPort = 33)] = "MidiPort"),
      (k[(k.EndOfTrack = 47)] = "EndOfTrack"),
      (k[(k.Tempo = 81)] = "Tempo"),
      (k[(k.SmpteOffset = 84)] = "SmpteOffset"),
      (k[(k.TimeSignature = 88)] = "TimeSignature"),
      (k[(k.KeySignature = 89)] = "KeySignature"),
      (k[(k.SequencerSpecific = 127)] = "SequencerSpecific"),
      k
    ))(Nh || {}),
    uo = class extends Gs {
      get metaStatus() {
        return 47;
      }
    },
    pp = class extends uo {
      constructor() {
        super(...arguments);
        this.data = new Uint8Array();
      }
    },
    hp = class extends uo {
      constructor() {
        super(...arguments);
        this.value = 0;
      }
    },
    mp = class extends Gs {
      constructor() {
        super(...arguments);
        this.noteKey = 0;
        this.pitch = 0;
      }
    },
    Eh = ((s) => (
      (s[(s.SystemExclusive = 240)] = "SystemExclusive"),
      (s[(s.MtcQuarterFrame = 241)] = "MtcQuarterFrame"),
      (s[(s.SongPosition = 242)] = "SongPosition"),
      (s[(s.SongSelect = 243)] = "SongSelect"),
      (s[(s.TuneRequest = 246)] = "TuneRequest"),
      (s[(s.SystemExclusive2 = 247)] = "SystemExclusive2"),
      s
    ))(Eh || {}),
    Xl = class extends Gs {},
    Ph = ((e) => (
      (e[(e.MetronomeTick = 0)] = "MetronomeTick"),
      (e[(e.Rest = 1)] = "Rest"),
      e
    ))(Ph || {}),
    zl = class extends Xl {
      constructor() {
        super(...arguments);
        this.data = new Uint8Array();
      }
      get isMetronome() {
        return !1;
      }
      get metronomeNumerator() {
        return -1;
      }
      get metronomeDurationInTicks() {
        return -1;
      }
      get metronomeDurationInMilliseconds() {
        return -1;
      }
      get isRest() {
        return !1;
      }
      get manufacturerId() {
        return 0;
      }
    };
  zl.AlphaTabManufacturerId = 125;
  var Ch = {};
  Bi(Ch, {
    AccentuationType: () => or,
    AccidentalType: () => Ir,
    Automation: () => he,
    AutomationType: () => ar,
    BackingTrack: () => vn,
    Bar: () => at,
    BarLineStyle: () => cr,
    BarStyle: () => Hs,
    BarSubElement: () => Yt,
    BarreShape: () => qr,
    Beat: () => Me,
    BeatBeamingMode: () => Dr,
    BeatStyle: () => Ys,
    BeatSubElement: () => Je,
    BendPoint: () => I,
    BendStyle: () => Pt,
    BendType: () => fr,
    BracketExtendMode: () => ln,
    BrushType: () => Wt,
    Chord: () => Bt,
    Clef: () => yt,
    Color: () => ae,
    CrescendoType: () => br,
    Direction: () => Kr,
    Duration: () => _e,
    DynamicValue: () => st,
    ElementStyle: () => zt,
    FadeType: () => Tr,
    Fermata: () => kr,
    FermataType: () => Fr,
    Fingers: () => Ar,
    Font: () => ne,
    FontStyle: () => Ci,
    FontWeight: () => Mi,
    GolpeType: () => Jr,
    GraceGroup: () => Vi,
    GraceType: () => Ce,
    HarmonicType: () => Ht,
    HeaderFooterStyle: () => ct,
    InstrumentArticulation: () => W,
    JsonConverter: () => $e,
    KeySignature: () => zr,
    KeySignatureType: () => Sr,
    Lyrics: () => Rr,
    MasterBar: () => ot,
    MusicFontSymbol: () => K,
    Note: () => Xe,
    NoteAccidentalMode: () => lr,
    NoteOrnament: () => Br,
    NoteStyle: () => cn,
    NoteSubElement: () => qt,
    Ottavia: () => Ze,
    PickStroke: () => dr,
    PlaybackInformation: () => mn,
    Rasgueado: () => $r,
    RenderStylesheet: () => Ws,
    RepeatGroup: () => as,
    Score: () => tt,
    ScoreStyle: () => Jt,
    ScoreSubElement: () => Mr,
    Section: () => vr,
    SimileMark: () => ur,
    SlideInType: () => Ut,
    SlideOutType: () => At,
    Staff: () => _r,
    SustainPedalMarker: () => Xt,
    SustainPedalMarkerType: () => _i,
    SyncPointData: () => Ur,
    TechniqueSymbolPlacement: () => xi,
    Track: () => Tt,
    TrackNameMode: () => ki,
    TrackNameOrientation: () => vi,
    TrackNamePolicy: () => Ti,
    TrackStyle: () => Ks,
    TrackSubElement: () => fn,
    TripletFeel: () => Ct,
    Tuning: () => lt,
    TupletGroup: () => zs,
    VibratoType: () => Ue,
    Voice: () => ze,
    VoiceStyle: () => Us,
    VoiceSubElement: () => os,
    WahPedal: () => Lr,
    WhammyType: () => Yr,
  });
  var Mh = {};
  Bi(Mh, {
    CssFontSvgCanvas: () => Wa,
    Cursors: () => Fa,
    FontSizeDefinition: () => Na,
    FontSizes: () => ti,
    MeasuredText: () => Xr,
    SvgCanvas: () => Va,
    TextAlign: () => xe,
    TextBaseline: () => je,
  });
  var Ih = {};
  Bi(Ih, {
    ActiveBeatsChangedEventArgs: () => _s,
    AlphaSynth: () => la,
    AlphaSynthAudioWorkletOutput: () => ta,
    AlphaSynthBase: () => Ss,
    AlphaSynthScriptProcessorOutput: () => Da,
    AlphaSynthWebAudioOutputBase: () => Zr,
    AlphaSynthWebWorkerApi: () => qn,
    AudioExportChunk: () => oa,
    AudioExportOptions: () => aa,
    BackingTrackSyncPoint: () => mi,
    CircularSampleBuffer: () => wn,
    MidiEventsPlayedEventArgs: () => Wn,
    PlaybackRange: () => Ca,
    PlaybackRangeChangedEventArgs: () => fi,
    PlayerState: () => gs,
    PlayerStateChangedEventArgs: () => Or,
    PositionChangedEventArgs: () => er,
  });
  var Hh = {};
  var Lh = {};
  J.isRunningInWorker
    ? J.initializeWorker()
    : J.isRunningInAudioWorklet
    ? J.initializeAudioWorklet()
    : J.initializeMain(
        (p) => {
          if (J.webPlatform === 1)
            throw new te(0, "Workers not yet supported in Node.js");
          if (J.webPlatform === 2 || J.isWebPackBundled || J.isViteBundled) {
            w.debug("AlphaTab", "Creating webworker");
            try {
              return new J.alphaTabWorker(
                new J.alphaTabUrl("./alphaTab.worker.ts", Lh.url),
                { type: "module" }
              );
            } catch (e) {
              w.debug(
                "AlphaTab",
                "ESM webworker construction with direct URL failed",
                e
              );
            }
            let t = "";
            try {
              t = new J.alphaTabUrl("./alphaTab.worker.ts", Lh.url);
              let e = `import ${JSON.stringify(t)}`,
                r = new Blob([e], { type: "application/javascript" });
              return new Worker(URL.createObjectURL(r), { type: "module" });
            } catch (e) {
              w.debug(
                "AlphaTab",
                "ESM webworker construction with blob import failed",
                t,
                e
              );
            }
            try {
              if (!p.core.scriptFile)
                throw new Error("Could not detect alphaTab script file");
              t = p.core.scriptFile;
              let e = `import ${JSON.stringify(p.core.scriptFile)}`,
                r = new Blob([e], { type: "application/javascript" });
              return new Worker(URL.createObjectURL(r), { type: "module" });
            } catch (e) {
              w.debug(
                "AlphaTab",
                "ESM webworker construction with blob import failed",
                p.core.scriptFile,
                e
              );
            }
          }
          if (!p.core.scriptFile)
            throw new te(
              0,
              "Could not detect alphaTab script file, cannot initialize renderer"
            );
          try {
            w.debug("AlphaTab", "Creating Blob worker");
            let t = `importScripts('${p.core.scriptFile}')`,
              e = new Blob([t], { type: "application/javascript" });
            return new Worker(URL.createObjectURL(e));
          } catch {
            return (
              w.warning(
                "Rendering",
                "Could not create inline worker, fallback to normal worker"
              ),
              new Worker(p.core.scriptFile)
            );
          }
        },
        (p, t) => {
          if (J.webPlatform === 1)
            throw new te(0, "Audio Worklets not yet supported in Node.js");
          return J.webPlatform === 2 || J.isWebPackBundled || J.isViteBundled
            ? (w.debug("AlphaTab", "Creating Module worklet"),
              p.audioWorklet.addModule(
                new J.alphaTabUrl("./alphaTab.worklet.ts", Lh.url)
              ))
            : (w.debug("AlphaTab", "Creating Script worklet"),
              p.audioWorklet.addModule(t.core.scriptFile));
        }
      );
  return Kh(im);
})();
